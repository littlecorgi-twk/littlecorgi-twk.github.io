<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>å°æŸ¯åŸº</title>
    <link>https://www.littlecorgi.top/</link>
    
    <atom:link href="https://www.littlecorgi.top/atom.xml" rel="self" type="application/rss+xml"/>
    
    <description>å…´è¶£ä½¿ç„¶çš„ä¸ªäººå°ç«™ï¼Œä¸å®šæ—¶åˆ†äº«Androidç­‰æŠ€æœ¯åšå®¢</description>
    <pubDate>Mon, 05 Jun 2023 11:23:59 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>macOS æ— æ³•è‡ªåŠ¨åˆ‡æ¢åˆ°æ·±è‰²æ¨¡å¼</title>
      <link>https://www.littlecorgi.top/posts/461f9d52.html</link>
      <guid>https://www.littlecorgi.top/posts/461f9d52.html</guid>
      <pubDate>Mon, 05 Jun 2023 11:23:59 GMT</pubDate>
      
      <description>åœ¨ macOS çš„è®¾ç½®é‡Œé¢æ˜æ˜å°†ã€Œå¤–è§‚ã€è®¾ç½®çš„æ˜¯è‡ªåŠ¨ï¼Œä½†æ˜¯æ¯æ¬¡ macOS éƒ½ä¸èƒ½åŠæ—¶çš„å°†é¢œè‰²ä¸»é¢˜åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼ã€‚æ’æŸ¥åæ‰å‘ç°ï¼ŒåŸæ¥æ˜¯ã€Œå¤œè§ˆã€æçš„é¬¼ï¼Œè®°å½•ä¸‹è§£å†³æ–¹æ¡ˆã€‚</description>
      
      
      
      <content:encoded><![CDATA[<p>åœ¨ macOS çš„è®¾ç½®é‡Œé¢æ˜æ˜å°†ã€Œå¤–è§‚ã€è®¾ç½®çš„æ˜¯è‡ªåŠ¨ï¼Œä½†æ˜¯æ¯æ¬¡ macOS éƒ½ä¸èƒ½åŠæ—¶çš„å°†é¢œè‰²ä¸»é¢˜åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼ã€‚æ’æŸ¥åæ‰å‘ç°ï¼ŒåŸæ¥æ˜¯ã€Œå¤œè§ˆã€æçš„é¬¼ï¼Œè®°å½•ä¸‹è§£å†³æ–¹æ¡ˆã€‚</p><h3 id="macOS-å¥‡æ€ªçš„é€»è¾‘"><a href="#macOS-å¥‡æ€ªçš„é€»è¾‘" class="headerlink" title="macOS å¥‡æ€ªçš„é€»è¾‘"></a>macOS å¥‡æ€ªçš„é€»è¾‘</h3><p>macOS çš„å¥‡æ€ªé€»è¾‘ï¼Œæ·±è‰²æ¨¡å¼å’Œå¤œè§ˆæ˜¯ç»‘å®šçš„ï¼šå“ªæ€• mac è®¤ä¸ºå·²ç»åˆ°äº†æ·±è‰²æ¨¡å¼çš„æ—¶é—´ç‚¹äº†ï¼Œæ¯”å¦‚æ”¯æŒåˆ‡æ¢é¢œè‰²çš„å£çº¸å·²ç»å˜é»‘äº†ï¼Œä½†æ˜¯ APP è¿˜æ˜¯æŒ‰æµ…è‰²å¤–è§‚å±•ç¤ºçš„ã€‚åŸå› å°±æ˜¯å¤œè§ˆè®¤ä¸ºè‡ªå·±è¿˜æ²¡åˆ°ã€Œå¤œé—´ã€å¯ä»¥å±•ç¤ºå¤œè§ˆçš„æ—¶å€™ï¼Œä¹Ÿå°±ä¸å…è®¸ mac åˆ‡æ¢åˆ°æ·±è‰²æ¨¡å¼ã€‚</p><h3 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h3><p>æ‰€ä»¥è§£å†³åŠæ³•å°±æ˜¯ï¼š</p><ol><li>å¤–è§‚é€‰æ‹©è‡ªåŠ¨ï¼Œå…³é—­å¤œè§ˆï¼ˆâœ…æ¨èï¼ï¼ï¼‰</li><li>å¤–è§‚é€‰æ‹©è‡ªåŠ¨ï¼Œå¤œè§ˆé€‰æ‹©æ‰‹åŠ¨è°ƒæ•´æ—¶é—´</li></ol>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Apple/">Apple</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Apple/">Apple</category>
      
      <category domain="https://www.littlecorgi.top/tags/macOS/">macOS</category>
      
      
      <comments>https://www.littlecorgi.top/posts/461f9d52.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>é¦™æ¸¯é“¶è¡Œå¼€æˆ·-æ°¸éš†</title>
      <link>https://www.littlecorgi.top/posts/5a1fdd14.html</link>
      <guid>https://www.littlecorgi.top/posts/5a1fdd14.html</guid>
      <pubDate>Fri, 26 May 2023 13:49:47 GMT</pubDate>
      
        
        
          
          
      <description></description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="å»é¦™æ¸¯å‡†å¤‡å·¥ä½œ"><a href="#å»é¦™æ¸¯å‡†å¤‡å·¥ä½œ" class="headerlink" title="å»é¦™æ¸¯å‡†å¤‡å·¥ä½œ"></a>å»é¦™æ¸¯å‡†å¤‡å·¥ä½œ</h1><ul><li>ğŸ“±å¼€é€šæ¼«æ¸¸åŒ…ï¼Œè¿è¥å•†APP æˆ–è€…æ”¯ä»˜å®ä¸Šè´­ä¹°å³å¯ï¼›</li><li>ğŸš‡åœ°é“ï¼šæ”¯ä»˜å®ï¼ˆåˆ‡æ¢åˆ°é¦™æ¸¯ï¼‰ã€å¾®ä¿¡ï¼ˆæ­è½¦ç  å°ç¨‹åºï¼‰å‡å¯ï¼Œä½†æ˜¯å¾—æ‰¾ç´«è‰²çš„é—¸æœºï¼ˆæ¯ä¸ªå…¥å£éƒ½ä¼šæœ‰ 2-3 å°ï¼‰ï¼Œä¸æ˜¯ç´«è‰²çš„ä¸èƒ½åˆ·äºŒç»´ç ï¼›</li><li>ğŸ’³å…«è¾¾é€šï¼šå¯æ ¹æ®æƒ…å†µåœ¨ 711 æˆ–è€…åœ°é“ç«™ä¹°ä¸€å¼ ï¼Œä¸ä»…å¯ä»¥åˆ·åœ°é“ã€å·´å£«ï¼Œå¾ˆå¤šåº—éƒ½æ”¯æŒå…«è¾¾é€šåˆ·å¡æ”¯ä»˜ï¼›</li><li>ğŸ“±APPï¼š<ul><li>åœ°å›¾è½¯ä»¶ï¼šé«˜å¾·å’Œ GoogleMapã€‚è®°å¾—æå‰ä¸‹è½½ç¦»çº¿åœ°å›¾ï¼ŒèŠ‚çœæµé‡ï¼›</li><li>ZA Bankï¼šé¦™æ¸¯çš„ä¸€å®¶è™šæ‹Ÿé“¶è¡Œï¼Œå¯ä»¥åˆ°é¦™æ¸¯åï¼Œç›´æ¥é€šè¿‡ APP å¼€æˆ·ï¼Œé—¨æ§›ä½ï¼ŒåŸºæœ¬ä¸Šéƒ½èƒ½æˆåŠŸã€‚å¼€æˆ·åå¯ä»¥ç”³è¯·å®ä½“å¡ï¼Œå…è´¹é‚®å¯„åˆ°å¤§é™†ä½ çš„é€šä¿¡åœ°å€ã€‚ï¼ˆ23 å¹´ 6 æœˆ 1 å·åéé¦™æ¸¯åœ°å€éœ€è¦æ”¶ 25HKD é‚®å¯„è´¹ï¼‰</li></ul></li></ul><h1 id="å‡†å¤‡ææ–™"><a href="#å‡†å¤‡ææ–™" class="headerlink" title="å‡†å¤‡ææ–™"></a>å‡†å¤‡ææ–™</h1><ul><li>ğŸªªèº«ä»½è¯</li><li>ğŸªªæ¸¯æ¾³é€šè¡Œè¯</li><li>ğŸ§¾è¿‡å…³å°ç™½æ¡</li><li>ğŸ§¾åœ°å€è¯æ˜ï¼ˆé“¶è¡Œå¡æ˜¯å¿«é€’å¯„è¿‡æ¥çš„ï¼Œå¦‚æœé‚®å¯„åœ°å€å’Œèº«ä»½è¯åœ°å€ä¸ä¸€è‡´ï¼Œåˆ™éœ€è¦åœ°å€è¯æ˜ï¼‰<ul><li>åœ°å€ä¸èƒ½æ˜¯å…¬å¸åœ°å€ï¼Œä¸èƒ½åŒ…å« xx åº—ç­‰ç‰¹æ®Šå­—æ ·ã€‚æˆ‘æœ‰æœ‹å‹å› ä¸ºç§Ÿçš„å…¬å¯“ï¼Œåœ°å€åŒ…å«äº†ï¼ˆäºŒåº—ï¼‰è¿™æ ·çš„å­—æ ·ï¼Œå½“åœºè¢«æ‹’ï¼›</li><li>å¯ä»¥ä½¿ç”¨å°æœ‰ä½ åå­—å’Œåœ°å€çš„æ°´ç”µç‡ƒæ°”ç¼´è´¹å•ï¼›</li><li>æˆ–è€…ä½¿ç”¨å°æœ‰åå­—å’Œåœ°å€çš„è¿‘ 3 ä¸ªæœˆä»»æ„ä¸€æœˆçš„ä¿¡ç”¨å¡è´¦å•ï¼Œæ¯”å¦‚æ‹›è¡Œã€‚å»é“¶è¡ŒæŸœå°ç”³è¯·å³å¯ï¼Œæˆ–è€… APP ç”³è¯·äº†è‡ªå·±æ‰“å°ï¼ˆAPP ä¸Šç”³è¯·çš„ç›–ç« ä¼šåŒ…å«ã€Œç”µå­ã€ä¸¤ä¸ªå­—ï¼Œæœ‰ä¸ªæŸœå‘˜å¯èƒ½ä¼šä»‹æ„è¿™ä¸ªç„¶åæ‹’ç»ï¼‰ï¼›</li></ul></li><li>ğŸ’°å»ºè®®å‡†å¤‡ 1w HKD ç°é‡‘ï¼Œæ°¸éš†éœ€è¦ä¿æŒè´¦æˆ·é‡Œé¢æœ‰ 1w HKDï¼Œè¿™æ ·å¯ä»¥ä¸æ”¶è´¦æˆ·ç®¡ç†è´¹ã€‚å¯ä»¥åœ¨å» HK å‰æå‰é¢„çº¦é“¶è¡Œç½‘ç‚¹å…‘æ¢æˆæ¸¯å¸ï¼Œé“¶è¡ŒæŸœå°ä¼šæŒ‰å®æ—¶æ±‡ç‡å¸®ä½ å…‘ï¼›</li><li>ğŸ“±æ‹›å•†æ°¸éš†ä¸€ç‚¹é€š APP</li></ul><h1 id="APP-ä¸Šç”³è¯·"><a href="#APP-ä¸Šç”³è¯·" class="headerlink" title="APP ä¸Šç”³è¯·"></a>APP ä¸Šç”³è¯·</h1><p>æ‰“å¼€ APPï¼Œé¦–é¡µå·¦ä¸Šè§’æ›´å¤šæŒ‰é’® - è´¦æˆ· - æˆ‘è¦å¼€æˆ·ã€‚</p><p>å¼€æˆ·é¡µé¢é€‰æ‹©ã€Œå…¨æ–°ç”¨æˆ·ç½‘ç‚¹å¼€æˆ·ã€ï¼Œæ ¹æ®å®é™…æƒ…å†µå¡«å†™å°±è¡Œã€‚</p><p><img src="https://cos.littlecorgi.top/picgo/2023-05-26-APP%E9%A6%96%E9%A1%B5.png" alt=""><br><img src="https://cos.littlecorgi.top/picgo/2023-05-26-APP%E6%9B%B4%E5%A4%9A%E9%A1%B5.png" alt=""></p><h1 id="ç½‘ç‚¹æƒ…å†µ"><a href="#ç½‘ç‚¹æƒ…å†µ" class="headerlink" title="ç½‘ç‚¹æƒ…å†µ"></a>ç½‘ç‚¹æƒ…å†µ</h1><ul><li>è¥ä¸šæ—¶é—´ï¼šå·¥ä½œæ—¥ 9:00-17:00ï¼Œå‘¨å…­9:00-13:00ï¼Œå‘¨æ—¥ä¼‘æ¯ã€‚</li><li>ä»»æ„ç½‘ç‚¹å‡å¯ï¼Œä¸è¿‡å»äº†åæœ€å¥½å…ˆé—®ä¸‹è¿˜æœ‰å¼€å¡åé¢ä¸ï¼Œæ²¡æœ‰çš„è¯ç«‹é©¬å»ä¸‹ä¸€ä¸ªã€‚</li></ul>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/%E7%94%9F%E6%B4%BB/">ç”Ÿæ´»</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/%E9%A6%99%E6%B8%AF/">é¦™æ¸¯</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E9%93%B6%E8%A1%8C/">é“¶è¡Œ</category>
      
      
      <comments>https://www.littlecorgi.top/posts/5a1fdd14.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>æ·±å…¥ç†è§£JVM-Referenceæºç </title>
      <link>https://www.littlecorgi.top/posts/79199b37.html</link>
      <guid>https://www.littlecorgi.top/posts/79199b37.html</guid>
      <pubDate>Sun, 21 Mar 2021 14:15:24 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;Referenceæºç åˆ†æ&quot;&gt;&lt;a href=&quot;#Referenceæºç åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;Referenceæºç åˆ†æ&quot;&gt;&lt;/a&gt;Referenceæºç åˆ†æ&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;  æœ¬æ–‡åŸºäºJDK1.8.0_271åˆ†æï¼Œnativeæºç ä¸‹è½½è‡ª&lt;a href=&quot;http://jdk.java.net/java-se-ri/8-MR3&quot;&gt;openJDKå®˜ç½‘(build 1.8.0_41-b04)&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;0-å‰è¨€&quot;&gt;&lt;a href=&quot;#0-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0. å‰è¨€&quot;&gt;&lt;/a&gt;0. å‰è¨€&lt;/h1&gt;&lt;p&gt;JDK1.2å¼€å§‹ï¼Œå¼•å…¥äº†ä¸€ä¸ªæ–°çš„åŒ…ï¼Œ&lt;code&gt;java.lang.ref&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;java.lang.ref&lt;ul&gt;
&lt;li&gt;Finalizer.class&lt;/li&gt;
&lt;li&gt;FinalizerHistogram.class&lt;/li&gt;
&lt;li&gt;FinalReference.class&lt;/li&gt;
&lt;li&gt;PhantomReference.class&lt;/li&gt;
&lt;li&gt;Reference.class&lt;/li&gt;
&lt;li&gt;ReferenceQueue.class&lt;/li&gt;
&lt;li&gt;SoftReference.classs&lt;/li&gt;
&lt;li&gt;WeakReference.class&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é¢å¤–çš„è¿˜æœ‰ä¸€ä¸ªåœ¨sun.miscåŒ…ä¸‹&lt;ul&gt;
&lt;li&gt;Cleaner.class&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;éšä¹‹å¸¦æ¥äº†å››ä¸ªæ–°çš„æ¦‚å¿µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¼ºå¼•ç”¨Storn Referencesï¼šéšå¤„å¯è§ï¼Œæˆ‘ä»¬ç›´æ¥newå‡ºæ¥çš„ä»£ç å°±æ˜¯å¼ºå¼•ç”¨ã€‚å†…å­˜ä¸è¶³æ—¶ï¼Œå®æ„¿æŠ›å‡º&lt;code&gt;OutOfMemoryError&lt;/code&gt;ä¹Ÿä¸æ„¿æ„å›æ”¶è¿™äº›å¯¹è±¡ã€‚æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨çš„è®¾ç½®ä¸ºnullè®©GCå›æ”¶ä»–ã€‚&lt;/li&gt;
&lt;li&gt;è½¯å¼•ç”¨SoftReferenceï¼šç­‰çº§æ¯”å¼ºå¼•ç”¨ä½ï¼Œåªæœ‰åœ¨å†…å­˜ä¸è¶³çš„æ—¶å€™æ‰å›å»å›æ”¶ã€‚æˆ‘ä»¬å¯ä»¥å®ç°å†…å­˜æ•æ„Ÿçš„é«˜é€Ÿç¼“å­˜ã€‚&lt;/li&gt;
&lt;li&gt;å¼±å¼•ç”¨WeakReferenceï¼šç­‰çº§æ¯”è½¯å¼•ç”¨ä½ï¼Œä¸ç®¡å†…å­˜è¶³ä¸è¶³ï¼Œå‘ç”ŸGCæ—¶ï¼Œå°±æœ‰å¯èƒ½è¢«å›æ”¶ã€‚å¦‚æœè¿™ä¸ªå¯¹è±¡æ˜¯ä¸€ä¸ªå¶å°”ä½¿ç”¨çš„å¯¹è±¡ï¼Œå¹¶ä¸”éœ€è¦åœ¨ä½¿ç”¨çš„æ—¶å€™å°±èƒ½è·å–åˆ°ï¼Œä½†åˆä¸æƒ³å½±å“ç”Ÿå‘½å‘¨æœŸï¼Œå°±å¯ä»¥ä½¿ç”¨WeakReferenceï¼Œæ¯”å¦‚å¤„ç†å†…éƒ¨ç±»å†…å­˜æ³„æ¼çš„é—®é¢˜æ—¶ã€‚&lt;/li&gt;
&lt;li&gt;è™šå¼•ç”¨PhantomReferenceï¼šç­‰çº§æ¯”å¼±å¼•ç”¨ä½ï¼Œå½¢åŒè™šè®¾ï¼Œä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«å›æ”¶ã€‚å®ƒå¯ä»¥å’Œå¼•ç”¨é˜Ÿåˆ—é…åˆç”¨äºç›‘æ§å¯¹è±¡æ˜¯å¦è¢«å›æ”¶&lt;/li&gt;
&lt;/ul&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="Referenceæºç åˆ†æ"><a href="#Referenceæºç åˆ†æ" class="headerlink" title="Referenceæºç åˆ†æ"></a>Referenceæºç åˆ†æ</h1><blockquote><p>  æœ¬æ–‡åŸºäºJDK1.8.0_271åˆ†æï¼Œnativeæºç ä¸‹è½½è‡ª<a href="http://jdk.java.net/java-se-ri/8-MR3">openJDKå®˜ç½‘(build 1.8.0_41-b04)</a></p></blockquote><h1 id="0-å‰è¨€"><a href="#0-å‰è¨€" class="headerlink" title="0. å‰è¨€"></a>0. å‰è¨€</h1><p>JDK1.2å¼€å§‹ï¼Œå¼•å…¥äº†ä¸€ä¸ªæ–°çš„åŒ…ï¼Œ<code>java.lang.ref</code>ï¼š</p><blockquote><ul><li>java.lang.ref<ul><li>Finalizer.class</li><li>FinalizerHistogram.class</li><li>FinalReference.class</li><li>PhantomReference.class</li><li>Reference.class</li><li>ReferenceQueue.class</li><li>SoftReference.classs</li><li>WeakReference.class</li></ul></li><li>é¢å¤–çš„è¿˜æœ‰ä¸€ä¸ªåœ¨sun.miscåŒ…ä¸‹<ul><li>Cleaner.class</li></ul></li></ul></blockquote><p>éšä¹‹å¸¦æ¥äº†å››ä¸ªæ–°çš„æ¦‚å¿µï¼š</p><ul><li>å¼ºå¼•ç”¨Storn Referencesï¼šéšå¤„å¯è§ï¼Œæˆ‘ä»¬ç›´æ¥newå‡ºæ¥çš„ä»£ç å°±æ˜¯å¼ºå¼•ç”¨ã€‚å†…å­˜ä¸è¶³æ—¶ï¼Œå®æ„¿æŠ›å‡º<code>OutOfMemoryError</code>ä¹Ÿä¸æ„¿æ„å›æ”¶è¿™äº›å¯¹è±¡ã€‚æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨çš„è®¾ç½®ä¸ºnullè®©GCå›æ”¶ä»–ã€‚</li><li>è½¯å¼•ç”¨SoftReferenceï¼šç­‰çº§æ¯”å¼ºå¼•ç”¨ä½ï¼Œåªæœ‰åœ¨å†…å­˜ä¸è¶³çš„æ—¶å€™æ‰å›å»å›æ”¶ã€‚æˆ‘ä»¬å¯ä»¥å®ç°å†…å­˜æ•æ„Ÿçš„é«˜é€Ÿç¼“å­˜ã€‚</li><li>å¼±å¼•ç”¨WeakReferenceï¼šç­‰çº§æ¯”è½¯å¼•ç”¨ä½ï¼Œä¸ç®¡å†…å­˜è¶³ä¸è¶³ï¼Œå‘ç”ŸGCæ—¶ï¼Œå°±æœ‰å¯èƒ½è¢«å›æ”¶ã€‚å¦‚æœè¿™ä¸ªå¯¹è±¡æ˜¯ä¸€ä¸ªå¶å°”ä½¿ç”¨çš„å¯¹è±¡ï¼Œå¹¶ä¸”éœ€è¦åœ¨ä½¿ç”¨çš„æ—¶å€™å°±èƒ½è·å–åˆ°ï¼Œä½†åˆä¸æƒ³å½±å“ç”Ÿå‘½å‘¨æœŸï¼Œå°±å¯ä»¥ä½¿ç”¨WeakReferenceï¼Œæ¯”å¦‚å¤„ç†å†…éƒ¨ç±»å†…å­˜æ³„æ¼çš„é—®é¢˜æ—¶ã€‚</li><li>è™šå¼•ç”¨PhantomReferenceï¼šç­‰çº§æ¯”å¼±å¼•ç”¨ä½ï¼Œå½¢åŒè™šè®¾ï¼Œä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«å›æ”¶ã€‚å®ƒå¯ä»¥å’Œå¼•ç”¨é˜Ÿåˆ—é…åˆç”¨äºç›‘æ§å¯¹è±¡æ˜¯å¦è¢«å›æ”¶</li></ul><span id="more"></span><p>å¹¶ä¸”ï¼Œé™¤äº†å¼ºå¼•ç”¨ä¹‹å¤–ï¼Œå…¶ä»–ä¸‰ä¸ªéƒ½å¯ä»¥å’Œå¼•ç”¨é˜Ÿåˆ—é…åˆä½¿ç”¨ï¼Œå°±æ˜¯åœ¨è°ƒç”¨ä»–ä»¬çš„æ„é€ æ–¹æ³•æ—¶ï¼Œé™¤äº†ä¼ å…¥Objectå¤–ï¼Œè¿˜å¯ä»¥ä¼ å…¥ä¸€ä¸ªReferenceQueueï¼Œä»–çš„ä½œç”¨å°±æ˜¯å½“Objectè¢«å›æ”¶æ—¶ï¼ŒJVMä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬æŠŠè¿™ä¸ªè½¯/å¼±/è™šå¼•ç”¨æ·»åŠ åˆ°è¿™ä¸ªQueueä¸­ã€‚é€šè¿‡è¿™ä¸ªåŠŸèƒ½å¯ä»¥ç›‘æ§å¯¹è±¡æ˜¯å¦è¢«å›æ”¶ã€‚</p><p>ç›´åˆ°JDK8ä¸ºæ­¢ï¼Œåªå­˜åœ¨å››ç§å¼•ç”¨ï¼Œè¿™äº›å¼•ç”¨æ˜¯ç”±JVMåˆ›å»ºï¼Œå› æ­¤ç›´æ¥ç»§æ‰¿<code>java.lang.ref.Reference</code>åˆ›å»ºè‡ªå®šä¹‰çš„å¼•ç”¨ç±»å‹æ˜¯æ— æ•ˆçš„ï¼Œä½†æ˜¯å¯ä»¥ç›´æ¥ç»§æ‰¿å·²ç»å­˜åœ¨çš„å¼•ç”¨ç±»å‹ï¼Œå¦‚<code>sun.misc.Cleaner</code>å°±æ˜¯ç»§æ‰¿è‡ª<code>java.lang.ref.PhantomReference</code>ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥æºç ï¼Œä½†æ˜¯åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å¾—å¸¦ç€é—®é¢˜çœ‹ï¼š</p><ul><li>è½¯å¼•ç”¨æ˜¯å†…å­˜ä¸è¶³æ‰ä¼šå›æ”¶ï¼Œé‚£ä¹ˆä»€ä¹ˆå«å†…å­˜ä¸è¶³ï¼Ÿ</li><li>å¼±å¼•ç”¨åªè¦å‘ç”ŸGCæ—¶å°±å›æ”¶ï¼Œä½†æ˜¯ä»–ä¸æ˜¯å¼•ç”¨ç€å¯¹åº”çš„å¼ºå¼•ç”¨ï¼Œé‚£ä¹ˆä»–ä¸ºå•¥èƒ½è¢«å›æ”¶ï¼Ÿ</li><li>è™šå¼•ç”¨å½¢åŒè™šè®¾ï¼Œä»»ä½•æ—¶å€™éƒ½ä¼šè¢«å›æ”¶ï¼Œé‚£ä¹ˆåˆ°åº•ä»€ä¹ˆæ—¶å€™ä¼šè¢«å›æ”¶ï¼Ÿ</li><li>å½“å¼•ç”¨å¯¹è±¡è¢«å›æ”¶æ—¶ï¼Œä»–ä»¬æ˜¯æ€ä¹ˆè¢«æ·»åŠ åˆ°è‹¥å¼•ç”¨é˜Ÿåˆ—çš„ï¼Ÿ</li></ul><h1 id="1-Reference-java"><a href="#1-Reference-java" class="headerlink" title="1. Reference.java"></a>1. Reference.java</h1><h2 id="1-1-æºç "><a href="#1-1-æºç " class="headerlink" title="1.1 æºç "></a>1.1 æºç </h2><p>é¦–å…ˆæ¥çœ‹ä¸‹ä»–çš„æ„é€ æ–¹æ³•å’Œæˆå‘˜å˜é‡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Reference</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> T referent;         <span class="comment">/* Treated specially by GC */</span></span><br><span class="line"><span class="keyword">volatile</span> ReferenceQueue&lt;? <span class="built_in">super</span> T&gt; queue;</span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;rawtypes&quot;)</span></span><br><span class="line">    <span class="keyword">volatile</span> Reference next;</span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">private</span> Reference&lt;T&gt; discovered;  <span class="comment">/* used by VM */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">Lock</span> &#123; &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Lock</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Reference&lt;Object&gt; pending = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    Reference(T referent) &#123;</span><br><span class="line">        <span class="built_in">this</span>(referent, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Reference(T referent, ReferenceQueue&lt;? <span class="built_in">super</span> T&gt; queue) &#123;</span><br><span class="line">        <span class="built_in">this</span>.referent = referent;</span><br><span class="line">        <span class="built_in">this</span>.queue = (queue == <span class="literal">null</span>) ? ReferenceQueue.NULL : queue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-1-1-æ„é€ æ–¹æ³•"><a href="#1-1-1-æ„é€ æ–¹æ³•" class="headerlink" title="1.1.1 æ„é€ æ–¹æ³•"></a>1.1.1 æ„é€ æ–¹æ³•</h3><p>æ„é€ æ–¹æ³•æœ‰ä¸¤ç§ï¼Œä¸€ç§åªä¼ å…¥referentï¼Œå¦ä¸€ç§è¿˜è¦ä¼ å…¥ä¸€ä¸ªQueueï¼Œå¦‚æœä¼ å…¥çš„queueä¸ºnullçš„è¯ï¼Œæˆå‘˜å˜é‡queueå°±ç­‰äº<code>ReferenceQueue.NULL</code>ã€‚</p><h3 id="1-1-2-æˆå‘˜å˜é‡"><a href="#1-1-2-æˆå‘˜å˜é‡" class="headerlink" title="1.1.2 æˆå‘˜å˜é‡"></a>1.1.2 æˆå‘˜å˜é‡</h3><ul><li><p>referenceï¼šä»£è¡¨æˆ‘ä»¬ä¼ å…¥çš„å¯¹è±¡ã€‚</p></li><li><p>queue: ReferenceQueueï¼Œå°±æ˜¯å¼•ç”¨é˜Ÿåˆ—ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">volatile</span> ReferenceQueue&lt;? <span class="built_in">super</span> T&gt; queue;</span><br></pre></td></tr></table></figure></li><li><p>nextï¼šä¸‹ä¸€ä¸ªReferenceå®ä¾‹çš„å¼•ç”¨ï¼Œä¸»è¦æ˜¯åœ¨ReferenceQueueä¸­ä½¿ç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* When active:   NULL</span></span><br><span class="line"><span class="comment"> *     pending:   this</span></span><br><span class="line"><span class="comment"> *    Enqueued:   next reference in queue (or this if last)</span></span><br><span class="line"><span class="comment"> *    Inactive:   this</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;rawtypes&quot;)</span></span><br><span class="line"><span class="keyword">volatile</span> Reference next;</span><br></pre></td></tr></table></figure></li><li><p>discoveredï¼šæ³¨æ„è¿™ä¸ªå±æ€§ç”±transientä¿®é¥°ï¼ŒåŸºäºçŠ¶æ€è¡¨ç¤ºä¸åŒé“¾è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªå¾…å¤„ç†çš„å¯¹è±¡ï¼Œä¸»è¦æ˜¯PendingListçš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œé€šè¿‡JVMç›´æ¥è°ƒç”¨èµ‹å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* When active:   next element in a discovered reference list maintained by GC (or this if last)</span></span><br><span class="line"><span class="comment"> *     pending:   next element in the pending list (or null if last)</span></span><br><span class="line"><span class="comment"> *   otherwise:   NULL</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> Reference&lt;T&gt; discovered;</span><br></pre></td></tr></table></figure></li><li><p>lock: çº¿ç¨‹å®‰å…¨çš„é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Object used to synchronize with the garbage collector.  The collector</span></span><br><span class="line"><span class="comment"> * must acquire this lock at the beginning of each collection cycle.  It is</span></span><br><span class="line"><span class="comment"> * therefore critical that any code holding this lock complete as quickly</span></span><br><span class="line"><span class="comment"> * as possible, allocate no new objects, and avoid calling user code.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">Lock</span> &#123; &#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Lock</span>();</span><br></pre></td></tr></table></figure></li><li><p>pendingï¼šç­‰å¾…åŠ å…¥queueçš„Referenceå¯¹è±¡ï¼Œåœ¨GCæ—¶ç”±JVMè®¾ç½®ï¼Œä¼šæœ‰ä¸€ä¸ªjavaå±‚çš„çº¿ç¨‹(ReferenceHandler)æºæºä¸æ–­ä»PendingListä¸­å–å‡ºå…ƒç´ åŠ å…¥åˆ°queueä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* List of References waiting to be enqueued.  The collector adds</span></span><br><span class="line"><span class="comment"> * References to this list, while the Reference-handler thread removes</span></span><br><span class="line"><span class="comment"> * them.  This list is protected by the above lock object. The</span></span><br><span class="line"><span class="comment"> * list uses the discovered field to link its elements.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Reference&lt;Object&gt; pending = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure></li></ul><h3 id="1-1-3-æ–¹æ³•"><a href="#1-1-3-æ–¹æ³•" class="headerlink" title="1.1.3 æ–¹æ³•"></a>1.1.3 æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns this reference object&#x27;s referent.  If this reference object has</span></span><br><span class="line"><span class="comment"> * been cleared, either by the program or by the garbage collector, then</span></span><br><span class="line"><span class="comment"> * this method returns &lt;code&gt;null&lt;/code&gt;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span>   The object to which this reference refers, or</span></span><br><span class="line"><span class="comment"> *           &lt;code&gt;null&lt;/code&gt; if this reference object has been cleared</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// è·å–referentå®ä¾‹</span></span><br><span class="line"><span class="meta">@HotSpotIntrinsicCandidate</span></span><br><span class="line"><span class="keyword">public</span> T <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.referent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Clears this reference object.  Invoking this method will not cause this</span></span><br><span class="line"><span class="comment"> * object to be enqueued.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; This method is invoked only by Java code; when the garbage collector</span></span><br><span class="line"><span class="comment"> * clears references it does so directly, without invoking this method.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// æ¸…é™¤referentå®ä¾‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.referent = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* -- Queue operations -- */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Tells whether or not this reference object has been enqueued, either by</span></span><br><span class="line"><span class="comment"> * the program or by the garbage collector.  If this reference object was</span></span><br><span class="line"><span class="comment"> * not registered with a queue when it was created, then this method will</span></span><br><span class="line"><span class="comment"> * always return &lt;code&gt;false&lt;/code&gt;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span>   &lt;code&gt;true&lt;/code&gt; if and only if this reference object has</span></span><br><span class="line"><span class="comment"> *           been enqueued</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// åˆ¤æ–­å¼•ç”¨é˜Ÿåˆ—æ˜¯å¦å¤„äºENQUEUEDçŠ¶æ€</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEnqueued</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">this</span>.queue == ReferenceQueue.ENQUEUED);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Adds this reference object to the queue with which it is registered,</span></span><br><span class="line"><span class="comment"> * if any.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt; This method is invoked only by Java code; when the garbage collector</span></span><br><span class="line"><span class="comment"> * enqueues references it does so directly, without invoking this method.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span>   &lt;code&gt;true&lt;/code&gt; if this reference object was successfully</span></span><br><span class="line"><span class="comment"> *           enqueued; &lt;code&gt;false&lt;/code&gt; if it was already enqueued or if</span></span><br><span class="line"><span class="comment"> *           it was not registered with a queue when it was created</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// å…¥é˜Ÿ</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">enqueue</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.queue.enqueue(<span class="built_in">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="1-2-ReferenceHandlerçº¿ç¨‹"><a href="#1-2-ReferenceHandlerçº¿ç¨‹" class="headerlink" title="1.2 ReferenceHandlerçº¿ç¨‹"></a>1.2 ReferenceHandlerçº¿ç¨‹</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* High-priority thread to enqueue pending References</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ReferenceHandler</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// ç¡®ä¿è¯¥ç±»å·²ç»åŠ è½½å®Œæˆï¼ŒåŸç†å°±æ˜¯é€šè¿‡forNameå»æå‰åŠ è½½</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">ensureClassInitialized</span><span class="params">(Class&lt;?&gt; clazz)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(clazz.getName(), <span class="literal">true</span>, clazz.getClassLoader());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> (Error) <span class="keyword">new</span> <span class="title class_">NoClassDefFoundError</span>(e.getMessage()).initCause(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">// pre-load and initialize InterruptedException and Cleaner classes</span></span><br><span class="line">        <span class="comment">// so that we don&#x27;t get into trouble later in the run loop if there&#x27;s</span></span><br><span class="line">        <span class="comment">// memory shortage while loading/initializing them lazily.</span></span><br><span class="line">      <span class="comment">// æå‰åŠ è½½è¿™ä¸¤ä¸ªç±»</span></span><br><span class="line">        ensureClassInitialized(InterruptedException.class);</span><br><span class="line">        ensureClassInitialized(Cleaner.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ReferenceHandler(ThreadGroup g, String name) &#123;</span><br><span class="line">        <span class="built_in">super</span>(g, name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">          <span class="comment">// æ­»å¾ªç¯è°ƒç”¨æ­¤æ–¹æ³•</span></span><br><span class="line">            tryHandlePending(<span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æºç å¾ˆç®€å•ï¼Œè¿™ä¸ªçº¿ç¨‹çš„ä¸»è¦ä½œç”¨å°±æ˜¯ä¸æ–­çš„å»è°ƒç”¨<code>tryHandlePending()</code>æ–¹æ³•</p><p>æˆ‘ä»¬å†çœ‹çœ‹ä»–çš„å¯åŠ¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">  <span class="comment">// å¤§è‡´æ„æ€å°±æ˜¯è·å–å½“å‰çº¿ç¨‹ç»„çš„ä¸Šä¸€å±‚çº¿ç¨‹ç»„ï¼Œä¸€å±‚å±‚è·å–ä¸Šå»ï¼Œç›´åˆ°æœ€é«˜å±‚çš„çº¿ç¨‹ç»„ï¼Œå†å»åˆ›å»ºReferenceHandlerï¼Œä»¥ä¿è¯ä»–è¢«åˆ›å»ºåœ¨JVMçš„systemçº¿ç¨‹ç»„ä¸­</span></span><br><span class="line">    <span class="type">ThreadGroup</span> <span class="variable">tg</span> <span class="operator">=</span> Thread.currentThread().getThreadGroup();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">ThreadGroup</span> <span class="variable">tgn</span> <span class="operator">=</span> tg;</span><br><span class="line">         tgn != <span class="literal">null</span>;</span><br><span class="line">         tg = tgn, tgn = tg.getParent());</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReferenceHandler</span>(tg, <span class="string">&quot;Reference Handler&quot;</span>);</span><br><span class="line">    <span class="comment">/* If there were a special system-only priority greater than</span></span><br><span class="line"><span class="comment">     * MAX_PRIORITY, it would be used here</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">  <span class="comment">// è®¾ç½®é«˜ä¼˜å…ˆçº§</span></span><br><span class="line">    handler.setPriority(Thread.MAX_PRIORITY);</span><br><span class="line">  <span class="comment">// è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹</span></span><br><span class="line">    handler.setDaemon(<span class="literal">true</span>);</span><br><span class="line">  <span class="comment">// å¯åŠ¨</span></span><br><span class="line">    handler.start();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// provide access in SharedSecrets</span></span><br><span class="line">    SharedSecrets.setJavaLangRefAccess(<span class="keyword">new</span> <span class="title class_">JavaLangRefAccess</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryHandlePendingReference</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> tryHandlePending(<span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="1-3-æ ¸å¿ƒæ–¹æ³•ï¼štryHandlePending"><a href="#1-3-æ ¸å¿ƒæ–¹æ³•ï¼štryHandlePending" class="headerlink" title="1.3 æ ¸å¿ƒæ–¹æ³•ï¼štryHandlePending"></a>1.3 æ ¸å¿ƒæ–¹æ³•ï¼štryHandlePending</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Try handle pending &#123;<span class="doctag">@link</span> Reference&#125; if there is one.&lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Return &#123;<span class="doctag">@code</span> true&#125; as a hint that there might be another</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> Reference&#125; pending or &#123;<span class="doctag">@code</span> false&#125; when there are no more pending</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> Reference&#125;s at the moment and the program can do some other</span></span><br><span class="line"><span class="comment"> * useful work instead of looping.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> waitForNotify if &#123;<span class="doctag">@code</span> true&#125; and there was no pending</span></span><br><span class="line"><span class="comment"> *                      &#123;<span class="doctag">@link</span> Reference&#125;, wait until notified from VM</span></span><br><span class="line"><span class="comment"> *                      or interrupted; if &#123;<span class="doctag">@code</span> false&#125;, return immediately</span></span><br><span class="line"><span class="comment"> *                      when there is no pending &#123;<span class="doctag">@link</span> Reference&#125;.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> true&#125; if there was a &#123;<span class="doctag">@link</span> Reference&#125; pending and it</span></span><br><span class="line"><span class="comment"> *         was processed, or we waited for notification and either got it</span></span><br><span class="line"><span class="comment"> *         or thread was interrupted before being notified;</span></span><br><span class="line"><span class="comment"> *         &#123;<span class="doctag">@code</span> false&#125; otherwise.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">tryHandlePending</span><span class="params">(<span class="type">boolean</span> waitForNotify)</span> &#123;</span><br><span class="line">    Reference&lt;Object&gt; r;</span><br><span class="line">    Cleaner c;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// åŠ é”ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨</span></span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">            <span class="keyword">if</span> (pending != <span class="literal">null</span>) &#123;</span><br><span class="line">                r = pending;</span><br><span class="line">                <span class="comment">// &#x27;instanceof&#x27; might throw OutOfMemoryError sometimes</span></span><br><span class="line">                <span class="comment">// so do this before un-linking &#x27;r&#x27; from the &#x27;pending&#x27; chain...</span></span><br><span class="line">              <span class="comment">// åˆ¤æ–­æ˜¯ä¸æ˜¯Cleanerï¼Œå¦‚æœæ˜¯ï¼Œåç»­æœ‰ç‰¹æ®Šå¤„ç†</span></span><br><span class="line">                c = r <span class="keyword">instanceof</span> Cleaner ? (Cleaner) r : <span class="literal">null</span>;</span><br><span class="line">                <span class="comment">// unlink &#x27;r&#x27; from &#x27;pending&#x27; chain</span></span><br><span class="line">              <span class="comment">// å†æŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶å°†å½“å‰å…ƒç´ ç½®ç©ºï¼Œç†Ÿæ‚‰çš„é“¾è¡¨çš„å¤„ç†</span></span><br><span class="line">                pending = r.discovered;</span><br><span class="line">                r.discovered = <span class="literal">null</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="comment">// å¦‚æœpendingä¸ä¸ºnullçš„è¯ï¼Œåˆ™è¯æ˜å½“å‰æ²¡æœ‰å…ƒç´ è¦è¢«åŠ å…¥åˆ°queueäº†ï¼Œåˆ™æŒ‚èµ·å½“å‰çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯ReferenceHandler</span></span><br><span class="line">                <span class="comment">// The waiting on the lock may cause an OutOfMemoryError</span></span><br><span class="line">                <span class="comment">// because it may try to allocate exception objects.</span></span><br><span class="line">                <span class="keyword">if</span> (waitForNotify) &#123;</span><br><span class="line">                    lock.wait();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// retry if waited</span></span><br><span class="line">                <span class="keyword">return</span> waitForNotify;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (OutOfMemoryError x) &#123;</span><br><span class="line">        <span class="comment">// Give other threads CPU time so they hopefully drop some live references</span></span><br><span class="line">        <span class="comment">// and GC reclaims some space.</span></span><br><span class="line">        <span class="comment">// Also prevent CPU intensive spinning in case &#x27;r instanceof Cleaner&#x27; above</span></span><br><span class="line">        <span class="comment">// persistently throws OOME for some time...</span></span><br><span class="line">        Thread.<span class="keyword">yield</span>();</span><br><span class="line">        <span class="comment">// retry</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException x) &#123;</span><br><span class="line">        <span class="comment">// retry</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Fast path for cleaners</span></span><br><span class="line">  <span class="comment">// å¦‚æœæ˜¯Cleanerï¼Œåˆ™è°ƒç”¨clearè¿›è¡Œå›æ”¶</span></span><br><span class="line">    <span class="keyword">if</span> (c != <span class="literal">null</span>) &#123;</span><br><span class="line">        c.clean();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// å¦‚æœReferenceæœ‰queueï¼Œåˆ™åŠ å…¥è¿›å»</span></span><br><span class="line">    ReferenceQueue&lt;? <span class="built_in">super</span> Object&gt; q = r.queue;</span><br><span class="line">    <span class="keyword">if</span> (q != ReferenceQueue.NULL) q.enqueue(r);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æºç å¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯çº¿ç¨‹æ­»å¾ªç¯æºæºä¸æ–­çš„ä»PendingListä¸­å–å‡ºpendingï¼Œç„¶åå°†å…¶åŠ å…¥åˆ°ReferenceQueueä¸­å»ï¼Œè€ŒPendingListåˆæ˜¯æ ¹æ®discoveredæ¥ç§»åŠ¨çš„ã€‚</p><p>å¹¶ä¸”å¯¹äºCleanerç±»å‹æœ‰ç‰¹åˆ«å¤„ç†ï¼Œå½“å…¶æŒ‡å‘çš„å¯¹è±¡è¢«å›æ”¶æ—¶ï¼Œä¼šè°ƒç”¨cleanè¿›è¡Œèµ„æºå›æ”¶ã€‚</p><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬çŸ¥é“äº†å¯¹pendingçš„å¤„ç†ï¼Œé‚£ä¹ˆï¼Œé‚£äº›å¯¹è±¡ä»€ä¹ˆæ—¶å€™ä¼šè¢«åŠ å…¥åˆ°PendingListä¸­å»å‘¢ï¼Ÿæ ¹æ®æ³¨é‡Šå¯ä»¥å¾—çŸ¥ï¼Œæˆ‘ä»¬éœ€è¦ä»nativeå±‚å»æ‰¾åˆ°ç­”æ¡ˆã€‚</p><h1 id="2-referenceProcessor-cpp"><a href="#2-referenceProcessor-cpp" class="headerlink" title="2. referenceProcessor.cpp"></a>2. referenceProcessor.cpp</h1><p>Referenceå¯¹åº”çš„nativeä»£ç ä¸»è¦åœ¨referenceProcessor.cppæ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªæ–‡ä»¶åœ¨<code>hotspot\src\share\vm\memory</code>è·¯å¾„ä¸‹ã€‚</p><p>åŠ å…¥PendingListçš„æ ¸å¿ƒæ–¹æ³•æ˜¯<code>process_discovered_references()</code>:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ReferenceProcessorStats <span class="title">ReferenceProcessor::process_discovered_references</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  BoolObjectClosure*           is_alive,</span></span></span><br><span class="line"><span class="params"><span class="function">  OopClosure*                  keep_alive,</span></span></span><br><span class="line"><span class="params"><span class="function">  VoidClosure*                 complete_gc,</span></span></span><br><span class="line"><span class="params"><span class="function">  AbstractRefProcTaskExecutor* task_executor,</span></span></span><br><span class="line"><span class="params"><span class="function">  GCTimer*                     gc_timer,</span></span></span><br><span class="line"><span class="params"><span class="function">  GCId                         gc_id)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">NOT_PRODUCT</span>(<span class="built_in">verify_ok_to_handle_reflists</span>());</span><br><span class="line"></span><br><span class="line">  <span class="built_in">assert</span>(!<span class="built_in">enqueuing_is_done</span>(), <span class="string">&quot;If here enqueuing should not be complete&quot;</span>);</span><br><span class="line">  <span class="comment">// Stop treating discovered references specially.</span></span><br><span class="line">  <span class="built_in">disable_discovery</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// If discovery was concurrent, someone could have modified</span></span><br><span class="line">  <span class="comment">// the value of the static field in the j.l.r.SoftReference</span></span><br><span class="line">  <span class="comment">// class that holds the soft reference timestamp clock using</span></span><br><span class="line">  <span class="comment">// reflection or Unsafe between when discovery was enabled and</span></span><br><span class="line">  <span class="comment">// now. Unconditionally update the static field in ReferenceProcessor</span></span><br><span class="line">  <span class="comment">// here so that we use the new value during processing of the</span></span><br><span class="line">  <span class="comment">// discovered soft refs.</span></span><br><span class="line"></span><br><span class="line">  _soft_ref_timestamp_clock = java_lang_ref_SoftReference::<span class="built_in">clock</span>();</span><br><span class="line"></span><br><span class="line">  <span class="type">bool</span> trace_time = PrintGCDetails &amp;&amp; PrintReferenceGC;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¤„ç†è½¯å¼•ç”¨</span></span><br><span class="line">  <span class="comment">// Soft references</span></span><br><span class="line">  <span class="type">size_t</span> soft_count = <span class="number">0</span>;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="function">GCTraceTime <span class="title">tt</span><span class="params">(<span class="string">&quot;SoftReference&quot;</span>, trace_time, <span class="literal">false</span>, gc_timer, gc_id)</span></span>;</span><br><span class="line">    soft_count =</span><br><span class="line">      <span class="built_in">process_discovered_reflist</span>(_discoveredSoftRefs, _current_soft_ref_policy, <span class="literal">true</span>,</span><br><span class="line">                                 is_alive, keep_alive, complete_gc, task_executor);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">update_soft_ref_master_clock</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¤„ç†å¼±å¼•ç”¨</span></span><br><span class="line">  <span class="comment">// Weak references</span></span><br><span class="line">  <span class="type">size_t</span> weak_count = <span class="number">0</span>;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="function">GCTraceTime <span class="title">tt</span><span class="params">(<span class="string">&quot;WeakReference&quot;</span>, trace_time, <span class="literal">false</span>, gc_timer, gc_id)</span></span>;</span><br><span class="line">    weak_count =</span><br><span class="line">      <span class="built_in">process_discovered_reflist</span>(_discoveredWeakRefs, <span class="literal">NULL</span>, <span class="literal">true</span>,</span><br><span class="line">                                 is_alive, keep_alive, complete_gc, task_executor);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Final references</span></span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¤„ç†è™šå¼•ç”¨</span></span><br><span class="line">  <span class="comment">// Phantom references</span></span><br><span class="line">  <span class="type">size_t</span> phantom_count = <span class="number">0</span>;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="function">GCTraceTime <span class="title">tt</span><span class="params">(<span class="string">&quot;PhantomReference&quot;</span>, trace_time, <span class="literal">false</span>, gc_timer, gc_id)</span></span>;</span><br><span class="line">    phantom_count =</span><br><span class="line">      <span class="built_in">process_discovered_reflist</span>(_discoveredPhantomRefs, <span class="literal">NULL</span>, <span class="literal">false</span>,</span><br><span class="line">                                 is_alive, keep_alive, complete_gc, task_executor);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Process cleaners, but include them in phantom statistics.  We expect</span></span><br><span class="line">    <span class="comment">// Cleaner references to be temporary, and don&#x27;t want to deal with</span></span><br><span class="line">    <span class="comment">// possible incompatibilities arising from making it more visible.</span></span><br><span class="line">    phantom_count +=</span><br><span class="line">      <span class="built_in">process_discovered_reflist</span>(_discoveredCleanerRefs, <span class="literal">NULL</span>, <span class="literal">false</span>,</span><br><span class="line">                                 is_alive, keep_alive, complete_gc, task_executor);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Weak global JNI references. It would make more sense (semantically) to</span></span><br><span class="line">  <span class="comment">// traverse these simultaneously with the regular weak references above, but</span></span><br><span class="line">  <span class="comment">// that is not how the JDK1.2 specification is. See #4126360. Native code can</span></span><br><span class="line">  <span class="comment">// thus use JNI weak references to circumvent the phantom references and</span></span><br><span class="line">  <span class="comment">// resurrect a &quot;post-mortem&quot; object.</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="function">GCTraceTime <span class="title">tt</span><span class="params">(<span class="string">&quot;JNI Weak Reference&quot;</span>, trace_time, <span class="literal">false</span>, gc_timer, gc_id)</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (task_executor != <span class="literal">NULL</span>) &#123;</span><br><span class="line">      task_executor-&gt;<span class="built_in">set_single_threaded_mode</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">process_phaseJNI</span>(is_alive, keep_alive, complete_gc);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">ReferenceProcessorStats</span>(soft_count, weak_count, final_count, phantom_count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢æ³¨é‡Šï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¤§è‡´çš„å¤„ç†è¿‡ç¨‹æ˜¯ï¼š</p><ol><li>å¤„ç†è½¯å¼•ç”¨</li><li>å¤„ç†å¼±å¼•ç”¨</li><li>å¤„ç†éœ€å¼•ç”¨</li></ol><p>ä½†æ˜¯ä»–ä»¬éƒ½è°ƒç”¨äº†process_discovered_reflistè¿™ä¸ªæ–¹æ³•ï¼Œå”¯ä¸€çš„åŒºåˆ«åªæ˜¯ä¼ å…¥çš„refs_listä¸åŒã€‚</p><h2 id="2-1-process-discovered-reflist"><a href="#2-1-process-discovered-reflist" class="headerlink" title="2.1 process_discovered_reflist()"></a>2.1 process_discovered_reflist()</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">size_t</span></span></span><br><span class="line"><span class="function"><span class="title">ReferenceProcessor::process_discovered_reflist</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  DiscoveredList               refs_lists[],</span></span></span><br><span class="line"><span class="params"><span class="function">  ReferencePolicy*             policy,</span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="type">bool</span>                         clear_referent,</span></span></span><br><span class="line"><span class="params"><span class="function">  BoolObjectClosure*           is_alive,</span></span></span><br><span class="line"><span class="params"><span class="function">  OopClosure*                  keep_alive,</span></span></span><br><span class="line"><span class="params"><span class="function">  VoidClosure*                 complete_gc,</span></span></span><br><span class="line"><span class="params"><span class="function">  AbstractRefProcTaskExecutor* task_executor)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">bool</span> mt_processing = task_executor != <span class="literal">NULL</span> &amp;&amp; _processing_is_mt;</span><br><span class="line">  <span class="comment">// If discovery used MT and a dynamic number of GC threads, then</span></span><br><span class="line">  <span class="comment">// the queues must be balanced for correctness if fewer than the</span></span><br><span class="line">  <span class="comment">// maximum number of queues were used.  The number of queue used</span></span><br><span class="line">  <span class="comment">// during discovery may be different than the number to be used</span></span><br><span class="line">  <span class="comment">// for processing so don&#x27;t depend of _num_q &lt; _max_num_q as part</span></span><br><span class="line">  <span class="comment">// of the test.</span></span><br><span class="line">  <span class="type">bool</span> must_balance = _discovery_is_mt;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ((mt_processing &amp;&amp; ParallelRefProcBalancingEnabled) ||</span><br><span class="line">      must_balance) &#123;</span><br><span class="line">    <span class="built_in">balance_queues</span>(refs_lists);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="type">size_t</span> total_list_count = <span class="built_in">total_count</span>(refs_lists);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (PrintReferenceGC &amp;&amp; PrintGCDetails) &#123;</span><br><span class="line">    gclog_or_tty-&gt;<span class="built_in">print</span>(<span class="string">&quot;, %u refs&quot;</span>, total_list_count);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Phase 1 (soft refs only):</span></span><br><span class="line">  <span class="comment">// . Traverse the list and remove any SoftReferences whose</span></span><br><span class="line">  <span class="comment">//   referents are not alive, but that should be kept alive for</span></span><br><span class="line">  <span class="comment">//   policy reasons. Keep alive the transitive closure of all</span></span><br><span class="line">  <span class="comment">//   such referents.</span></span><br><span class="line">  <span class="comment">// åªå¤„ç†è½¯å¼•ç”¨</span></span><br><span class="line">  <span class="comment">// å°†æ‰€æœ‰ä¸å­˜æ´»ä½†æ˜¯è¿˜ä¸èƒ½è¢«å›æ”¶çš„è½¯å¼•ç”¨ä»refs_listsä¸­ç§»é™¤ï¼ˆåªæœ‰refs_listsä¸ºè½¯å¼•ç”¨çš„æ—¶å€™ï¼Œè¿™é‡Œpolicyæ‰ä¸ä¸ºnullï¼‰</span></span><br><span class="line">  <span class="keyword">if</span> (policy != <span class="literal">NULL</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (mt_processing) &#123;</span><br><span class="line">      <span class="function">RefProcPhase1Task <span class="title">phase1</span><span class="params">(*<span class="keyword">this</span>, refs_lists, policy, <span class="literal">true</span> <span class="comment">/*marks_oops_alive*/</span>)</span></span>;</span><br><span class="line">      task_executor-&gt;<span class="built_in">execute</span>(phase1);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (uint i = <span class="number">0</span>; i &lt; _max_num_q; i++) &#123;</span><br><span class="line">        <span class="built_in">process_phase1</span>(refs_lists[i], policy,</span><br><span class="line">                       is_alive, keep_alive, complete_gc);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// policy == NULL</span></span><br><span class="line">    <span class="built_in">assert</span>(refs_lists != _discoveredSoftRefs,</span><br><span class="line">           <span class="string">&quot;Policy must be specified for soft references.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Phase 2:</span></span><br><span class="line">  <span class="comment">// . Traverse the list and remove any refs whose referents are alive.</span></span><br><span class="line">  <span class="comment">// ç§»é™¤æ‰€æœ‰æŒ‡å‘å¯¹è±¡è¿˜å­˜æ´»çš„å¼•ç”¨</span></span><br><span class="line">  <span class="keyword">if</span> (mt_processing) &#123;</span><br><span class="line">    <span class="function">RefProcPhase2Task <span class="title">phase2</span><span class="params">(*<span class="keyword">this</span>, refs_lists, !discovery_is_atomic() <span class="comment">/*marks_oops_alive*/</span>)</span></span>;</span><br><span class="line">    task_executor-&gt;<span class="built_in">execute</span>(phase2);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (uint i = <span class="number">0</span>; i &lt; _max_num_q; i++) &#123;</span><br><span class="line">      <span class="built_in">process_phase2</span>(refs_lists[i], is_alive, keep_alive, complete_gc);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Phase 3:</span></span><br><span class="line">  <span class="comment">// . Traverse the list and process referents as appropriate.</span></span><br><span class="line">  <span class="comment">// æ ¹æ®clear_referentçš„å€¼å†³å®šæ˜¯å¦å°†ä¸å­˜æ´»å¯¹è±¡å›æ”¶</span></span><br><span class="line">  <span class="keyword">if</span> (mt_processing) &#123;</span><br><span class="line">    <span class="function">RefProcPhase3Task <span class="title">phase3</span><span class="params">(*<span class="keyword">this</span>, refs_lists, clear_referent, <span class="literal">true</span> <span class="comment">/*marks_oops_alive*/</span>)</span></span>;</span><br><span class="line">    task_executor-&gt;<span class="built_in">execute</span>(phase3);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (uint i = <span class="number">0</span>; i &lt; _max_num_q; i++) &#123;</span><br><span class="line">      <span class="built_in">process_phase3</span>(refs_lists[i], clear_referent,</span><br><span class="line">                     is_alive, keep_alive, complete_gc);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> total_list_count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-2-process-phase1"><a href="#2-2-process-phase1" class="headerlink" title="2.2 process_phase1()"></a>2.2 process_phase1()</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span></span></span><br><span class="line"><span class="function"><span class="title">ReferenceProcessor::process_phase1</span><span class="params">(DiscoveredList&amp;    refs_list,</span></span></span><br><span class="line"><span class="params"><span class="function">                                   ReferencePolicy*   policy,</span></span></span><br><span class="line"><span class="params"><span class="function">                                   BoolObjectClosure* is_alive,</span></span></span><br><span class="line"><span class="params"><span class="function">                                   OopClosure*        keep_alive,</span></span></span><br><span class="line"><span class="params"><span class="function">                                   VoidClosure*       complete_gc)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">assert</span>(policy != <span class="literal">NULL</span>, <span class="string">&quot;Must have a non-NULL policy&quot;</span>);</span><br><span class="line">  <span class="function">DiscoveredListIterator <span class="title">iter</span><span class="params">(refs_list, keep_alive, is_alive)</span></span>;</span><br><span class="line">  <span class="comment">// Decide which softly reachable refs should be kept alive.</span></span><br><span class="line">  <span class="comment">// éå†refs_listä¸­çš„æ‰€æœ‰å…ƒç´ </span></span><br><span class="line">  <span class="keyword">while</span> (iter.<span class="built_in">has_next</span>()) &#123;</span><br><span class="line">    iter.<span class="built_in">load_ptrs</span>(<span class="built_in">DEBUG_ONLY</span>(!<span class="built_in">discovery_is_atomic</span>() <span class="comment">/* allow_null_referent */</span>));</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ‰€å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦å­˜æ´»</span></span><br><span class="line">    <span class="type">bool</span> referent_is_dead = (iter.<span class="built_in">referent</span>() != <span class="literal">NULL</span>) &amp;&amp; !iter.<span class="built_in">is_referent_alive</span>();</span><br><span class="line">    <span class="comment">// å¦‚æœå·²ç»ä¸å­˜æ´»ï¼Œåˆ™æ ¹æ®ReferencePolicyå»åˆ¤æ–­æ˜¯å¦åº”è¯¥å›æ”¶ï¼Œshould_clear_referenceè¿”å›falseï¼Œåˆ™ä»refs_listä¸­ç§»é™¤ï¼Œä¹Ÿå°±æ˜¯ä¸å›æ”¶</span></span><br><span class="line">    <span class="keyword">if</span> (referent_is_dead &amp;&amp;</span><br><span class="line">        !policy-&gt;<span class="built_in">should_clear_reference</span>(iter.<span class="built_in">obj</span>(), _soft_ref_timestamp_clock)) &#123;</span><br><span class="line">      <span class="comment">// å›æ”¶å¯¹è±¡</span></span><br><span class="line">      <span class="keyword">if</span> (TraceReferenceGC) &#123;</span><br><span class="line">        gclog_or_tty-&gt;<span class="built_in">print_cr</span>(<span class="string">&quot;Dropping reference (&quot;</span> INTPTR_FORMAT <span class="string">&quot;: %s&quot;</span>  <span class="string">&quot;) by policy&quot;</span>,</span><br><span class="line">                               (<span class="type">void</span> *)iter.<span class="built_in">obj</span>(), iter.<span class="built_in">obj</span>()-&gt;<span class="built_in">klass</span>()-&gt;<span class="built_in">internal_name</span>());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// Remove Reference object from list</span></span><br><span class="line">      iter.<span class="built_in">remove</span>();</span><br><span class="line">      <span class="comment">// Make the Reference object active again</span></span><br><span class="line">      iter.<span class="built_in">make_active</span>();</span><br><span class="line">      <span class="comment">// keep the referent around</span></span><br><span class="line">      iter.<span class="built_in">make_referent_alive</span>();</span><br><span class="line">      iter.<span class="built_in">move_to_next</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// è·³è¿‡å½“å‰ï¼Œç»§ç»­éå†</span></span><br><span class="line">      iter.<span class="built_in">next</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Close the reachable set</span></span><br><span class="line">  complete_gc-&gt;<span class="built_in">do_void</span>();</span><br><span class="line">  <span class="built_in">NOT_PRODUCT</span>(</span><br><span class="line">    <span class="keyword">if</span> (PrintGCDetails &amp;&amp; TraceReferenceGC) &#123;</span><br><span class="line">      gclog_or_tty-&gt;<span class="built_in">print_cr</span>(<span class="string">&quot; Dropped %d dead Refs out of %d &quot;</span></span><br><span class="line">        <span class="string">&quot;discovered Refs by policy, from list &quot;</span> INTPTR_FORMAT,</span><br><span class="line">        iter.<span class="built_in">removed</span>(), iter.<span class="built_in">processed</span>(), (address)refs_list.<span class="built_in">head</span>());</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç å¾ˆå¥½ç†è§£ï¼Œéå†refs_listï¼Œå–å‡ºé‡Œé¢çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦åº”è¯¥ç§»é™¤ï¼Œåˆ¤æ–­çš„ä¾æ®åŒ…æ‹¬è¿™ä¸ªå…ƒç´ æ‰€å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦å­˜æ´»ä»¥åŠReferencePolicyã€‚é‚£ä¹ˆè¿™ä¸ªReferencePolicyæ˜¯å•¥ï¼Ÿ</p><h3 id="2-2-1-referencePolicy-hpp"><a href="#2-2-1-referencePolicy-hpp" class="headerlink" title="2.2.1 referencePolicy.hpp"></a>2.2.1 referencePolicy.hpp</h3><p>æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ReferencePolicyçš„å®šä¹‰ï¼Œé™¤äº†è¿™ä¸ªç±»ä»¥å¤–ï¼Œè¿˜æœ‰4ä¸ªä»–çš„å­ç±»ï¼š</p><ul><li>NeverClearPolicy</li><li>AlwaysClearPolicy</li><li>LRUCurrentHeapPolicy</li><li>LRUMaxHeapPolicy</li></ul><p>å¯¹äºå‰ä¸¤ä¸ªç±»çš„should_clear_reference()æ–¹æ³•å¾ˆç®€å•ï¼Œä¸€ä¸ªæ°¸è¿œè¿”å›falseï¼Œä¸€ä¸ªæ°¸è¿œè¿”å›trueã€‚é‚£ä¸‹é¢ä¸¤ä¸ªæ˜¯å•¥ï¼Ÿ</p><h4 id="referencePolicy-cpp"><a href="#referencePolicy-cpp" class="headerlink" title="referencePolicy.cpp"></a>referencePolicy.cpp</h4><p>æˆªå–ä¸‹ä¸»è¦ä»£ç ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// M = 1024 * 1024</span></span><br><span class="line"><span class="comment">// SoftRefLRUPolicyMSPerMB = 1000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Capture state (of-the-VM) information needed to evaluate the policy</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">LRUCurrentHeapPolicy::setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  _max_interval = (Universe::<span class="built_in">get_heap_free_at_last_gc</span>() / M) * SoftRefLRUPolicyMSPerMB;</span><br><span class="line">  <span class="built_in">assert</span>(_max_interval &gt;= <span class="number">0</span>,<span class="string">&quot;Sanity check&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The oop passed in is the SoftReference object, and not</span></span><br><span class="line"><span class="comment">// the object the SoftReference points to.</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">LRUCurrentHeapPolicy::should_clear_reference</span><span class="params">(oop p,</span></span></span><br><span class="line"><span class="params"><span class="function">                                                  jlong timestamp_clock)</span> </span>&#123;</span><br><span class="line">  jlong interval = timestamp_clock - java_lang_ref_SoftReference::<span class="built_in">timestamp</span>(p);</span><br><span class="line">  <span class="built_in">assert</span>(interval &gt;= <span class="number">0</span>, <span class="string">&quot;Sanity check&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// The interval will be zero if the ref was accessed since the last scavenge/gc.</span></span><br><span class="line">  <span class="keyword">if</span>(interval &lt;= _max_interval) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Capture state (of-the-VM) information needed to evaluate the policy</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">LRUMaxHeapPolicy::setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="type">size_t</span> max_heap = MaxHeapSize;</span><br><span class="line">  max_heap -= Universe::<span class="built_in">get_heap_used_at_last_gc</span>();</span><br><span class="line">  max_heap /= M;</span><br><span class="line"></span><br><span class="line">  _max_interval = max_heap * SoftRefLRUPolicyMSPerMB;</span><br><span class="line">  <span class="built_in">assert</span>(_max_interval &gt;= <span class="number">0</span>,<span class="string">&quot;Sanity check&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The oop passed in is the SoftReference object, and not</span></span><br><span class="line"><span class="comment">// the object the SoftReference points to.</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">LRUMaxHeapPolicy::should_clear_reference</span><span class="params">(oop p,</span></span></span><br><span class="line"><span class="params"><span class="function">                                             jlong timestamp_clock)</span> </span>&#123;</span><br><span class="line"><span class="comment">// æ­¤æ–¹æ³•å’Œä¸Šé¢çš„ä¸€æ¨¡ä¸€æ ·ï¼Œæ‰€ä»¥ä¸å†å•ç‹¬æ‹¿å‡ºæ¥</span></span><br></pre></td></tr></table></figure><p>å•çº¯çœ‹ä»–ä¸¤çš„setupæ–¹æ³•ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_max_interval = (Universe::<span class="built_in">get_heap_free_at_last_gc</span>() / M) * SoftRefLRUPolicyMSPerMB;</span><br><span class="line">_max_interval = (MaxHeapSize - Universe::<span class="built_in">get_heap_used_at_last_gc</span>()) / M * SoftRefLRUPolicyMSPerMB;</span><br></pre></td></tr></table></figure><p>å‰è€…è®¡ç®—çš„æ˜¯ä¸Šæ¬¡GCåçš„å¯ç”¨å †å¤§å°ï¼Œåè€…è®¡ç®—çš„æ˜¯(å †å¤§å°-ä¸Šæ¬¡GCæ—¶ä½¿ç”¨çš„å¤§å°)</p><p>è€Œshould_clear_referenceæ–¹æ³•ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">jlong interval = timestamp_clock - java_lang_ref_SoftReference::<span class="built_in">timestamp</span>(p);</span><br><span class="line"><span class="built_in">assert</span>(interval &gt;= <span class="number">0</span>, <span class="string">&quot;Sanity check&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// The interval will be zero if the ref was accessed since the last scavenge/gc.</span></span><br><span class="line"><span class="keyword">if</span>(interval &lt;= _max_interval) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œ<code>timestamp_clock</code>å’Œ<code>java_lang_ref_SoftReference::timestamp(p)</code>æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>ç¬¬ä¸€ä¸ªä¸è¯´ï¼Œç¬¬äºŒä¸ªçœ‹è¿™ä¸ªå½¢å¼ï¼Œæ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œè¿™ä¸å°±æ˜¯jniå˜›ï¼Œæˆ‘ä»¬å†æ¬¡å›åˆ°javaå±‚ã€‚</p><h4 id="è½¯å¼•ç”¨ã€å¼±å¼•ç”¨å’Œè™šå¼•ç”¨"><a href="#è½¯å¼•ç”¨ã€å¼±å¼•ç”¨å’Œè™šå¼•ç”¨" class="headerlink" title="è½¯å¼•ç”¨ã€å¼±å¼•ç”¨å’Œè™šå¼•ç”¨"></a>è½¯å¼•ç”¨ã€å¼±å¼•ç”¨å’Œè™šå¼•ç”¨</h4><p>Referenceä¸»è¦çš„ä¸‰ä¸ªå­ç±»ï¼Œå¼±å¼•ç”¨å’Œè™šå¼•ç”¨è™½ç„¶ç»§æ‰¿è‡ªReferenceï¼Œä½†æ˜¯ä»–ä»¬æ”¹åŠ¨ä¸å¤§ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WeakReference</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">Reference</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WeakReference</span><span class="params">(T referent)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(referent);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WeakReference</span><span class="params">(T referent, ReferenceQueue&lt;? <span class="built_in">super</span> T&gt; q)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(referent, q);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PhantomReference</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">Reference</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PhantomReference</span><span class="params">(T referent, ReferenceQueue&lt;? <span class="built_in">super</span> T&gt; q)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(referent, q);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åå€’æ˜¯å¼±å¼•ç”¨ï¼Œæ”¹åŠ¨äº†è¾ƒå¤šï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SoftReference</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">Reference</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="comment">// æ—¶é—´æˆ³æ—¶é’Ÿï¼Œç”±GCæ›´æ–°ã€‚</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">private</span> <span class="type">long</span> clock;</span><br><span class="line">  <span class="comment">// æ¯æ¬¡è°ƒç”¨getæ–¹æ³•æ‰€æ›´æ–°çš„æ—¶é—´æˆ³ã€‚è™šæ‹Ÿæœºåœ¨é€‰æ‹©è¦æ¸…é™¤çš„è½¯å¼•ç”¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¤å­—æ®µï¼Œä½†ä¸è¦æ±‚è¿™æ ·åšã€‚</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> timestamp;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SoftReference</span><span class="params">(T referent)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(referent);</span><br><span class="line">        <span class="built_in">this</span>.timestamp = clock;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SoftReference</span><span class="params">(T referent, ReferenceQueue&lt;? <span class="built_in">super</span> T&gt; q)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(referent, q);</span><br><span class="line">        <span class="built_in">this</span>.timestamp = clock;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">T</span> <span class="variable">o</span> <span class="operator">=</span> <span class="built_in">super</span>.get();</span><br><span class="line">        <span class="keyword">if</span> (o != <span class="literal">null</span> &amp;&amp; <span class="built_in">this</span>.timestamp != clock)</span><br><span class="line">            <span class="built_in">this</span>.timestamp = clock;</span><br><span class="line">        <span class="keyword">return</span> o;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>clock</code>å°±æ˜¯ä¸Šé¢nativeä»£ç çš„<code>timestamp_clock</code>ï¼Œ<code>timestamp</code>å°±æ˜¯<code>java_lang_ref_SoftReference::timestamp(p)</code>ã€‚å¦‚æœä¸Šæ¬¡GCæ—¶æœ‰è°ƒç”¨è¿‡<code>get()</code>é‚£ä¹ˆintervalä¸º0ï¼Œå¦åˆ™å°±æ˜¯ä»–ä»¬ä¹‹é—´çš„å·®å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœGCé—´éš”æ—¶é—´å¤ªé•¿äº†ï¼Œå°±å›è¢«å›æ”¶ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬æ›´æ–°ä¸‹ï¼Œåˆ¤æ–­è½¯å¼•ç”¨æ˜¯å¦æ”¹è¢«ç§»é™¤çš„ä¾æ®åŒ…æ‹¬è¿™ä¸ªå…ƒç´ æ‰€å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦å­˜æ´»ã€Policyç­–ç•¥ä»¥åŠå­˜æ´»æ—¶é—´ã€‚</p><h2 id="2-3-process-phase2"><a href="#2-3-process-phase2" class="headerlink" title="2.3 process_phase2()"></a>2.3 process_phase2()</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Traverse the list and remove any Refs that are not active, or</span></span><br><span class="line"><span class="comment">// whose referents are either alive or NULL.</span></span><br><span class="line"><span class="function"><span class="type">void</span></span></span><br><span class="line"><span class="function"><span class="title">ReferenceProcessor::pp2_work</span><span class="params">(DiscoveredList&amp;    refs_list,</span></span></span><br><span class="line"><span class="params"><span class="function">                             BoolObjectClosure* is_alive,</span></span></span><br><span class="line"><span class="params"><span class="function">                             OopClosure*        keep_alive)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">assert</span>(<span class="built_in">discovery_is_atomic</span>(), <span class="string">&quot;Error&quot;</span>);</span><br><span class="line">  <span class="function">DiscoveredListIterator <span class="title">iter</span><span class="params">(refs_list, keep_alive, is_alive)</span></span>;</span><br><span class="line">  <span class="comment">// éå†refs_listä¸­çš„æ‰€æœ‰å…ƒç´ </span></span><br><span class="line">  <span class="keyword">while</span> (iter.<span class="built_in">has_next</span>()) &#123;</span><br><span class="line">    iter.<span class="built_in">load_ptrs</span>(<span class="built_in">DEBUG_ONLY</span>(<span class="literal">false</span> <span class="comment">/* allow_null_referent */</span>));</span><br><span class="line">    <span class="built_in">DEBUG_ONLY</span>(oop next = java_lang_ref_Reference::<span class="built_in">next</span>(iter.<span class="built_in">obj</span>());)</span><br><span class="line">    <span class="built_in">assert</span>(next == <span class="literal">NULL</span>, <span class="string">&quot;Should not discover inactive Reference&quot;</span>);</span><br><span class="line">    <span class="comment">// åˆ¤æ–­å¼•ç”¨æ˜¯å¦å­˜æ´»ï¼Œå­˜æ´»åˆ™ä»refs_listä¸­ç§»é™¤ï¼Œå¦åˆ™éå†ä¸‹ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">    <span class="keyword">if</span> (iter.<span class="built_in">is_referent_alive</span>()) &#123;</span><br><span class="line">      <span class="keyword">if</span> (TraceReferenceGC) &#123;</span><br><span class="line">        gclog_or_tty-&gt;<span class="built_in">print_cr</span>(<span class="string">&quot;Dropping strongly reachable reference (&quot;</span> INTPTR_FORMAT <span class="string">&quot;: %s)&quot;</span>,</span><br><span class="line">                               (<span class="type">void</span> *)iter.<span class="built_in">obj</span>(), iter.<span class="built_in">obj</span>()-&gt;<span class="built_in">klass</span>()-&gt;<span class="built_in">internal_name</span>());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// The referent is reachable after all.</span></span><br><span class="line">      <span class="comment">// Remove Reference object from list.</span></span><br><span class="line">      iter.<span class="built_in">remove</span>();</span><br><span class="line">      <span class="comment">// Update the referent pointer as necessary: Note that this</span></span><br><span class="line">      <span class="comment">// should not entail any recursive marking because the</span></span><br><span class="line">      <span class="comment">// referent must already have been traversed.</span></span><br><span class="line">      iter.<span class="built_in">make_referent_alive</span>();</span><br><span class="line">      iter.<span class="built_in">move_to_next</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      iter.<span class="built_in">next</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">NOT_PRODUCT</span>(</span><br><span class="line">    <span class="keyword">if</span> (PrintGCDetails &amp;&amp; TraceReferenceGC &amp;&amp; (iter.<span class="built_in">processed</span>() &gt; <span class="number">0</span>)) &#123;</span><br><span class="line">      gclog_or_tty-&gt;<span class="built_in">print_cr</span>(<span class="string">&quot; Dropped %d active Refs out of %d &quot;</span></span><br><span class="line">        <span class="string">&quot;Refs in discovered list &quot;</span> INTPTR_FORMAT,</span><br><span class="line">        iter.<span class="built_in">removed</span>(), iter.<span class="built_in">processed</span>(), (address)refs_list.<span class="built_in">head</span>());</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä»£ç å¾ˆç®€å•ï¼Œå°±æ˜¯éå†refs_listï¼Œå¦‚æœæ‰€æŒ‡å‘çš„å¯¹è±¡è¿˜å­˜æ´»ï¼Œåˆ™ä»listä¸­ç§»é™¤ï¼Œå¦åˆ™ä¿ç•™ç€ç»§ç»­éå†ã€‚</p><h2 id="2-4-process-phase3"><a href="#2-4-process-phase3" class="headerlink" title="2.4 process_phase3()"></a>2.4 process_phase3()</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Traverse the list and process the referents, by either</span></span><br><span class="line"><span class="comment">// clearing them or keeping them (and their reachable</span></span><br><span class="line"><span class="comment">// closure) alive.</span></span><br><span class="line"><span class="function"><span class="type">void</span></span></span><br><span class="line"><span class="function"><span class="title">ReferenceProcessor::process_phase3</span><span class="params">(DiscoveredList&amp;    refs_list,</span></span></span><br><span class="line"><span class="params"><span class="function">                                   <span class="type">bool</span>               clear_referent,</span></span></span><br><span class="line"><span class="params"><span class="function">                                   BoolObjectClosure* is_alive,</span></span></span><br><span class="line"><span class="params"><span class="function">                                   OopClosure*        keep_alive,</span></span></span><br><span class="line"><span class="params"><span class="function">                                   VoidClosure*       complete_gc)</span> </span>&#123;</span><br><span class="line">  ResourceMark rm;</span><br><span class="line">  <span class="function">DiscoveredListIterator <span class="title">iter</span><span class="params">(refs_list, keep_alive, is_alive)</span></span>;</span><br><span class="line">  <span class="comment">// éå†refs_listï¼Œæ­¤æ—¶è¿™é‡Œå·²ç»æ˜¯ç»è¿‡phase1å’Œ2è¿‡æ»¤åçš„å‰©ä¸‹çš„å…ƒç´ </span></span><br><span class="line">  <span class="keyword">while</span> (iter.<span class="built_in">has_next</span>()) &#123;</span><br><span class="line">    <span class="comment">// æ›´æ–°discoveredå˜é‡ï¼Œdiscoveredçš„å€¼æ›´æ–°ä¸ºä¸Šä¸€ä¸ªå…ƒç´ çš„discovered</span></span><br><span class="line">    iter.<span class="built_in">update_discovered</span>();</span><br><span class="line">    iter.<span class="built_in">load_ptrs</span>(<span class="built_in">DEBUG_ONLY</span>(<span class="literal">false</span> <span class="comment">/* allow_null_referent */</span>));</span><br><span class="line">    <span class="keyword">if</span> (clear_referent) &#123;</span><br><span class="line">      <span class="comment">// NULL out referent pointer</span></span><br><span class="line">      <span class="comment">// æ¸…é™¤å¼•ç”¨ï¼Œä¹‹åä¼šè¢«GCå›æ”¶</span></span><br><span class="line">      iter.<span class="built_in">clear_referent</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// keep the referent around</span></span><br><span class="line">      <span class="comment">// æ ‡è®°å¼•ç”¨çš„å¯¹è±¡ä¸ºå­˜æ´»ï¼Œè¯¥å¯¹è±¡åœ¨è¿™æ¬¡GCä¸ä¼šè¢«å›æ”¶</span></span><br><span class="line">      iter.<span class="built_in">make_referent_alive</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (TraceReferenceGC) &#123;</span><br><span class="line">      gclog_or_tty-&gt;<span class="built_in">print_cr</span>(<span class="string">&quot;Adding %sreference (&quot;</span> INTPTR_FORMAT <span class="string">&quot;: %s) as pending&quot;</span>,</span><br><span class="line">                             clear_referent ? <span class="string">&quot;cleared &quot;</span> : <span class="string">&quot;&quot;</span>,</span><br><span class="line">                             (<span class="type">void</span> *)iter.<span class="built_in">obj</span>(), iter.<span class="built_in">obj</span>()-&gt;<span class="built_in">klass</span>()-&gt;<span class="built_in">internal_name</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">assert</span>(iter.<span class="built_in">obj</span>()-&gt;<span class="built_in">is_oop</span>(UseConcMarkSweepGC), <span class="string">&quot;Adding a bad reference&quot;</span>);</span><br><span class="line">    iter.<span class="built_in">next</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Remember to update the next pointer of the last ref.</span></span><br><span class="line">  <span class="comment">// æ›´æ–°discoveredå˜é‡</span></span><br><span class="line">  iter.<span class="built_in">update_discovered</span>();</span><br><span class="line">  <span class="comment">// Close the reachable set</span></span><br><span class="line">  complete_gc-&gt;<span class="built_in">do_void</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="3-æ€»ç»“"><a href="#3-æ€»ç»“" class="headerlink" title="3. æ€»ç»“"></a>3. æ€»ç»“</h1><p>çœ‹å®Œäº†ä»£ç ï¼Œæˆ‘ä»¬æ¥å›ç­”ä¸‹ä¹‹å‰æå‡ºçš„é—®é¢˜ï¼š</p><ul><li><p>è½¯å¼•ç”¨æ˜¯å†…å­˜ä¸è¶³æ‰ä¼šå›æ”¶ï¼Œé‚£ä¹ˆä»€ä¹ˆå«å†…å­˜ä¸è¶³ï¼Ÿ</p><p>æ ¹æ®<code>process_phase1()</code>ä¸­ReferencePolicyçš„å››ä¸ªå­ç±»ï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œå†…å­˜ä¸è¶³çš„å®šä¹‰å’Œè¯¥å¼•ç”¨å¯¹è±¡getçš„æ—¶é—´ä»¥åŠå½“å‰å †å¯ç”¨å†…å­˜å¤§å°éƒ½æœ‰å…³ç³»ã€‚å…·ä½“å¯ä»¥çœ‹LRUCurrentHeapPolicyå’ŒLRUMaxHeapPolicy</p></li><li><p>å¼±å¼•ç”¨åªè¦å‘ç”ŸGCæ—¶å°±å›æ”¶ï¼Œä½†æ˜¯ä»–ä¸æ˜¯å¼•ç”¨ç€å¯¹åº”çš„å¼ºå¼•ç”¨ï¼Œé‚£ä¹ˆä»–ä¸ºå•¥èƒ½è¢«å›æ”¶ï¼Ÿ</p><p>è¿™ä¸ªé—®é¢˜å¯ä»¥å›é¡¾<code>process_phase3()</code>ï¼Œå®ƒé‡Œé¢ä¼šæœ‰ä¸€ä¸ªifåˆ¤æ–­ï¼Œå¦‚æœ<code>clear_referent</code>ä¸ºtrueï¼Œå°±å›æ”¶ï¼Œå¹¶æŠŠ<code>reference</code>ç½®ä¸ºnullï¼Œå¦åˆ™ä¸å›æ”¶ã€‚é‚£ä¹ˆè¿™ä¸ªå˜é‡æ˜¯åœ¨å“ªè¢«èµ‹å€¼çš„å‘¢ï¼Ÿæˆ‘ä»¬ä¸€ä¸ªä¸ªè°ƒç”¨çœ‹ä¸Šå»ï¼Œå°±ä¼šç¥å¥‡çš„å‘ç°ï¼Œåœ¨<code>process_discovered_references()</code>æ–¹æ³•ä¸­ï¼Œè½¯å¼•ç”¨å’Œå¼±å¼•ç”¨çš„<code>clear_referent</code>ç›´æ¥ä¸ºtrueï¼Œè™šå¼•ç”¨ä¸ºfalseã€‚æ‰€ä»¥åªè¦å‘ç”Ÿäº†GCï¼Œå¼±å¼•ç”¨å°±ä¼šè¢«å›æ”¶ã€‚(è€Œè½¯å¼•ç”¨å¦‚æœå†…å­˜å……è¶³çš„æƒ…å†µä¸‹ï¼Œåœ¨<code>process_phase1()</code>æ—¶å°±å·²ç»è¢«ä»é˜Ÿåˆ—ä¸­ç§»é™¤äº†ï¼Œå¹¶ä¸ä¼šèµ°åˆ°<code>process_phase2()</code>)</p></li><li><p>è™šå¼•ç”¨å½¢åŒè™šè®¾ï¼Œä»»ä½•æ—¶å€™éƒ½ä¼šè¢«å›æ”¶ï¼Œé‚£ä¹ˆåˆ°åº•ä»€ä¹ˆæ—¶å€™ä¼šè¢«å›æ”¶ï¼Ÿ</p><p>è™šå¼•ç”¨æ˜¯ä¼šå½±å“å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„ï¼Œå¦‚æœä¸åšä»»ä½•å¤„ç†ï¼Œåªè¦è™šå¼•ç”¨ä¸è¢«å›æ”¶ï¼Œé‚£å…¶å¼•ç”¨çš„å¯¹è±¡æ°¸è¿œä¸ä¼šè¢«å›æ”¶ã€‚æ‰€ä»¥ä¸€èˆ¬æ¥è¯´ï¼Œä»ReferenceQueueä¸­è·å¾—PhantomReferenceå¯¹è±¡åï¼Œå¦‚æœPhantomReferenceå¯¹è±¡ä¸ä¼šè¢«å›æ”¶çš„è¯ï¼ˆæ¯”å¦‚è¢«å…¶ä»–GC ROOTå¯è¾¾çš„å¯¹è±¡å¼•ç”¨ï¼‰ï¼Œéœ€è¦è°ƒç”¨<code>clear</code>æ–¹æ³•è§£é™¤PhantomReferenceå’Œå…¶å¼•ç”¨å¯¹è±¡çš„å¼•ç”¨å…³ç³»ã€‚</p></li><li><p>å½“å¼•ç”¨å¯¹è±¡è¢«å›æ”¶æ—¶ï¼Œä»–ä»¬æ˜¯æ€ä¹ˆè¢«æ·»åŠ åˆ°è‹¥å¼•ç”¨é˜Ÿåˆ—çš„ï¼Ÿ</p><p>çœ‹<code>tryHandlePending()</code>ã€‚</p></li></ul>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Java/">Java</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Java/">Java</category>
      
      <category domain="https://www.littlecorgi.top/tags/JVM/">JVM</category>
      
      
      <comments>https://www.littlecorgi.top/posts/79199b37.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Koin-12-Koin for Android</title>
      <link>https://www.littlecorgi.top/posts/f5a785d7.html</link>
      <guid>https://www.littlecorgi.top/posts/f5a785d7.html</guid>
      <pubDate>Wed, 07 Oct 2020 13:25:34 GMT</pubDate>
      
        
        
          
          
      <description></description>
          
        
      
      
      
      <content:encoded><![CDATA[<blockquote><p><a href="https://start.insert-koin.io/#/getting-started/koin-for-android">https://start.insert-koin.io/#/getting-started/koin-for-android</a></p><p>å¼€å§‹</p><ul><li><a href="/posts/fd6f0996.html">Intro(ä»‹ç»)</a></li><li><a href="/posts/b075de90.html">Setup(åˆå§‹åŒ–)</a></li></ul><p>Koin in 5 minutes (5åˆ†é’Ÿå¿«é€Ÿå…¥æ‰‹Koin)</p><ul><li><a href="/posts/f88fedb6.html">Kotlin</a></li><li><a href="/posts/2a806fe1.html">Android</a></li><li><a href="/posts/e7ad0613.html">Android Java</a></li><li><a href="/posts/6d1e0fe7.html">Android ViewModel</a></li></ul><p>Getting Started (å¼€å§‹)</p><ul><li><a href="/posts/c99907a8.html">Starting Koin(å¼€å§‹ä½¿ç”¨Koin)</a></li><li><a href="/posts/d8ca0532.html">Modules &amp; definitions(æ¨¡å—å’Œå®šä¹‰)</a></li><li><a href="/posts/f85e8eae.html">Koin Components(Koinç»„ä»¶)</a></li><li><a href="/posts/63fa5724.html">Testing(æµ‹è¯•)</a></li><li><a href="/posts/ebed2a69.html">Koin for Java</a></li><li><a href="/posts/f5a785d7.html">Koin for Android</a></li></ul></blockquote><h2 id="åœ¨Androidä¸­å¼€å§‹"><a href="#åœ¨Androidä¸­å¼€å§‹" class="headerlink" title="åœ¨Androidä¸­å¼€å§‹"></a><a href="https://start.insert-koin.io/#/getting-started/koin-for-android?id=starting-koin-for-android">åœ¨Androidä¸­å¼€å§‹</a></h2><p>åœ¨ä»»ä½•ä¸€ä¸ªAndroidç±»ä¸­ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainApplication</span> : <span class="type">Application</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate()</span><br><span class="line"></span><br><span class="line">        startKoin &#123;</span><br><span class="line">            <span class="comment">// use AndroidLogger as Koin Logger - default Level.INFO</span></span><br><span class="line">            <span class="comment">// ä½¿ç”¨AndroidLoggerä»£æ›¿KoinLogger - é»˜è®¤Lovel.INFO</span></span><br><span class="line">            androidLogger()</span><br><span class="line"></span><br><span class="line">            <span class="comment">// use the Android context given there åœ¨è¿™ä½¿ç”¨ç»™å®šçš„AndroidContext</span></span><br><span class="line">            androidContext(<span class="keyword">this</span><span class="symbol">@MainApplication</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment">// load properties from assets/koin.properties file</span></span><br><span class="line">            <span class="comment">// ä»assets/koin.propertiesæ–‡ä»¶ä¸­åŠ è½½å±æ€§</span></span><br><span class="line">            androidFileProperties()</span><br><span class="line"></span><br><span class="line">            <span class="comment">// module list æ¨¡å—åˆ—è¡¨</span></span><br><span class="line">            modules(offlineWeatherApp)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ ä¸èƒ½æ³¨å…¥Androidä¸Šä¸‹æ–‡æˆ–è€…applicationï¼Œè¯·ç¡®ä¿ä½¿ç”¨ <code>androidContext()</code> å‡½æ•°åœ¨ä½ çš„Koinåº”ç”¨ç¨‹åºå£°æ˜ã€‚</p><h2 id="ä½¿ç”¨Android-Context"><a href="#ä½¿ç”¨Android-Context" class="headerlink" title="ä½¿ç”¨Android Context"></a><a href="https://start.insert-koin.io/#/getting-started/koin-for-android?id=use-the-android-context">ä½¿ç”¨Android Context</a></h2><p>åœ¨ä½ çš„å®šä¹‰ä¸­ï¼Œä½ èƒ½é€šè¿‡ <code>androidContext()</code> å’Œ <code>androidApplication()</code> å‡½æ•°æ³¨å…¥ <code>Context</code> å’Œ <code>Application</code> ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">module &#123;</span><br><span class="line">    single &#123; MyAndroidComponent(androidContext()) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Androidç»„ä»¶ä½œä¸ºKoinç»„ä»¶"><a href="#Androidç»„ä»¶ä½œä¸ºKoinç»„ä»¶" class="headerlink" title="Androidç»„ä»¶ä½œä¸ºKoinç»„ä»¶"></a><a href="https://start.insert-koin.io/#/getting-started/koin-for-android?id=android-components-as-koincomponents">Androidç»„ä»¶ä½œä¸ºKoinç»„ä»¶</a></h2><p>Koinå¯¹ <code>Activity</code>, <code>Fragment</code> &amp; <code>Service</code> è¿›è¡Œäº†æ‰©å±•ï¼Œä»¥å°†å…¶è§†ä¸ºç°æˆçš„KoinComponentsï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyActivity</span> : <span class="type">AppCompatActivity</span>()&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Inject MyPresenter</span></span><br><span class="line">    <span class="keyword">val</span> presenter : MyPresenter <span class="keyword">by</span> inject()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// or directly retrieve instance</span></span><br><span class="line">        <span class="keyword">val</span> presenter : MyPresenter = <span class="keyword">get</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™äº›ç±»èƒ½è¢«ä½¿ç”¨ï¼š</p><ul><li><code>get()</code> or <code>by inject()</code> instance retrieving æ£€ç´¢å®ä¾‹</li><li><code>getKoin()</code> to access th current <code>Koin</code> instance è®¿é—®å½“å‰ <code>Koin</code> å®ä¾‹</li></ul><p>å¦‚æœæ‚¨éœ€è¦æ³¨å…¥æ¥è‡ªå¦ä¸€ä¸ªç±»çš„ä¾èµ–é¡¹ï¼Œå¹¶ä¸”æ— æ³•åœ¨æ¨¡å—ä¸­å£°æ˜å®ƒï¼Œåˆ™ä»ç„¶å¯ä»¥ä½¿ç”¨ <code>KoinComponent</code> æ¥å£å¯¹å…¶è¿›è¡Œæ ‡è®°ã€‚</p><h2 id="Extended-Scope-API"><a href="#Extended-Scope-API" class="headerlink" title="Extended Scope API"></a><a href="https://start.insert-koin.io/#/getting-started/koin-for-android?id=extended-scope-api">Extended Scope API</a></h2><blockquote><p>for Android (koin-android-scope or koin-androidx-scope projects)</p></blockquote><p>Scope APIæ›´æ¥è¿‘Androidå¹³å°ã€‚<code>Activity</code> å’Œ <code>Fragment</code> éƒ½å…·æœ‰Scope APIçš„æ‰©å±•ï¼š<code>currentScope</code> è·å–å½“å‰å…³è”çš„Koin scoprã€‚ æ­¤scopeå·²åˆ›å»ºå¹¶ç»‘å®šåˆ°ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><p>ä½ èƒ½ç›´æ¥ä½¿ç”¨å…³è”çš„Koin scopeæ¥æ£€ç´¢ç»„ä»¶ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DetailActivity</span> : <span class="type">AppCompatActivity</span>(), DetailContract.View &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// inject from current activity scope instance</span></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">val</span> presenter: DetailContract.Presenter <span class="keyword">by</span> currentScope.inject()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆå®¹æ˜“æ¥å£°æ˜ä½ çš„Androidç»„ä»¶scope:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">module &#123;</span><br><span class="line">    <span class="comment">// declare a scope for DetailActivity</span></span><br><span class="line">    scope(named&lt;DetailActivity&gt;)&gt; &#123;</span><br><span class="line">        scoped&lt;DetailContract.Presenter&gt; &#123; DetailPresenter(<span class="keyword">get</span>(), <span class="keyword">get</span>()) &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»»ä½•Activityå’ŒFragmentéƒ½èƒ½ç›´æ¥ä½¿ç”¨scopeAPIï¼š <code>createScope()</code>, <code>getScope()</code> and <code>deleteScope()</code>ã€‚</p><h2 id="Android-ViewModel"><a href="#Android-ViewModel" class="headerlink" title="Android ViewModel"></a><a href="https://start.insert-koin.io/#/getting-started/koin-for-android?id=android-viewmodel">Android ViewModel</a></h2><blockquote><p>(koin-android-viewmodel or koin-androidx-viewmodel projects)</p></blockquote><p>Koinä¹Ÿå¸¦æ¥äº†ä¸€äº›ç‰¹æ®Šçš„ç‰¹æ€§æ¥ç®¡ç†ViewModelï¼š</p><ul><li><code>viewModel</code> ç‰¹æ®Šçš„DSLå…³é”®æ¥æ¥å£°æ˜ä¸€ä¸ªViewModel</li><li><code>by viewModel()</code> &amp; <code>getViewModel()</code> æ³¨å…¥ViewModelå®ä¾‹(from <code>Activity</code> &amp; <code>Fragment</code>)</li><li><code>by sharedViewModel()</code> &amp; <code>getSharedViewModel()</code> ä»å®¿ä¸»Activityä¸­å¤ç”¨ViewModelå®ä¾‹(æ¥è‡ªFragment)</li></ul><p>è®©æˆ‘ä»¬åœ¨æ¨¡å—ä¸­å£°æ˜ä¸€ä¸ªViewModelï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> myModule : Module = module &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ViewModel instance of MyViewModel</span></span><br><span class="line">    <span class="comment">// get() will resolve Repository instance</span></span><br><span class="line">    viewModel &#123; MyViewModel(<span class="keyword">get</span>()) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Single instance of Repository</span></span><br><span class="line">    single&lt;Repository&gt; &#123; MyRepository() &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸€ä¸ªActivityä¸­æ³¨å…¥å®ƒï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyActivity</span> : <span class="type">AppCompatActivity</span>()&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Lazy inject MyViewModel</span></span><br><span class="line">    <span class="keyword">val</span> model : MyViewModel <span class="keyword">by</span> viewModel()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// or also direct retrieve instance</span></span><br><span class="line">        <span class="keyword">val</span> model : MyViewModel = getViewModel()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Koin/">Koin</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Kotlin/">Kotlin</category>
      
      <category domain="https://www.littlecorgi.top/tags/Koin/">Koin</category>
      
      
      <comments>https://www.littlecorgi.top/posts/f5a785d7.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Koin-11-Koin for Java</title>
      <link>https://www.littlecorgi.top/posts/ebed2a69.html</link>
      <guid>https://www.littlecorgi.top/posts/ebed2a69.html</guid>
      <pubDate>Wed, 07 Oct 2020 13:25:27 GMT</pubDate>
      
        
        
          
          
      <description></description>
          
        
      
      
      
      <content:encoded><![CDATA[<blockquote><p><a href="https://start.insert-koin.io/#/getting-started/koin-for-java">https://start.insert-koin.io/#/getting-started/koin-for-java</a></p><p>å¼€å§‹</p><ul><li><a href="/posts/fd6f0996.html">Intro(ä»‹ç»)</a></li><li><a href="/posts/b075de90.html">Setup(åˆå§‹åŒ–)</a></li></ul><p>Koin in 5 minutes (5åˆ†é’Ÿå¿«é€Ÿå…¥æ‰‹Koin)</p><ul><li><a href="/posts/f88fedb6.html">Kotlin</a></li><li><a href="/posts/2a806fe1.html">Android</a></li><li><a href="/posts/e7ad0613.html">Android Java</a></li><li><a href="/posts/6d1e0fe7.html">Android ViewModel</a></li></ul><p>Getting Started (å¼€å§‹)</p><ul><li><a href="/posts/c99907a8.html">Starting Koin(å¼€å§‹ä½¿ç”¨Koin)</a></li><li><a href="/posts/d8ca0532.html">Modules &amp; definitions(æ¨¡å—å’Œå®šä¹‰)</a></li><li><a href="/posts/f85e8eae.html">Koin Components(Koinç»„ä»¶)</a></li><li><a href="/posts/63fa5724.html">Testing(æµ‹è¯•)</a></li><li><a href="/posts/ebed2a69.html">Koin for Java</a></li><li><a href="/posts/f5a785d7.html">Koin for Android</a></li></ul></blockquote><p>ä¸‹é¢æ˜¯ <code>koin-java</code> ç‰¹æ€§çš„ç®€çŸ­æè¿°ã€‚è¿™ä¸ªé¡¹ç›®æ˜¯å¸®åŠ©javaå¼€å‘äººå‘˜çš„é™æ€utilsçš„ä¸€ä¸ªå°å­é›†ã€‚</p><h2 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a><a href="https://start.insert-koin.io/#/getting-started/koin-for-java?id=start-koin">å¼€å§‹</a></h2><p>Just use the <code>startKoin()</code> static function (with the static import to reduce the syntax):</p><p>åªéœ€è¦ä½¿ç”¨ <code>startKoin()</code> é™æ€å‡½æ•°(é€šè¿‡é™æ€å¯¼å…¥æ¥å‡å°‘è¯­æ³•)ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.koin.core.context.GlobalContext.start;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Build KoinApplication instance</span></span><br><span class="line"><span class="comment">// Builder API style</span></span><br><span class="line"><span class="type">KoinApplication</span> <span class="variable">koinApp</span> <span class="operator">=</span> KoinApplication.create()</span><br><span class="line">                .printLogger()</span><br><span class="line">                .modules(koinModule);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Statr KoinApplication instance</span></span><br><span class="line">start(koinApp);</span><br></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥è®¿é—®ä¸Kotlin <code>startKoin()</code> <a href="(/docs//quick-references/koin-core/#start-koin">ç›¸åŒçš„é€‰é¡¹</a>)ã€‚</p><h2 id="Kotlinä¸­çš„Javaå‹å¥½æ¨¡å—"><a href="#Kotlinä¸­çš„Javaå‹å¥½æ¨¡å—" class="headerlink" title="Kotlinä¸­çš„Javaå‹å¥½æ¨¡å—"></a><a href="https://start.insert-koin.io/#/getting-started/koin-for-java?id=java-friendly-module-in-kotlin">Kotlinä¸­çš„Javaå‹å¥½æ¨¡å—</a></h2><p>ä½ éœ€è¦ä½¿ç”¨ <code>@JvmField</code> æ ‡è®°ä½ çš„moduleå˜é‡ï¼Œä»¥ä¾¿å…¶å¯ä»¥ä»Javaä¸­è¯»å–ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JvmField</span></span><br><span class="line"><span class="keyword">val</span> koinModule = module &#123;</span><br><span class="line">    single &#123; ComponentA() &#125;</span><br><span class="line">    single &#123; ComponentB(<span class="keyword">get</span>()) &#125;</span><br><span class="line">    single &#123; ComponentC(<span class="keyword">get</span>(), <span class="keyword">get</span>()) &#125;</span><br><span class="line"></span><br><span class="line">    module(<span class="string">&quot;anotherModule&quot;</span>) &#123;</span><br><span class="line">        single &#123; ComponentD(<span class="keyword">get</span>()) &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åœ¨é™æ€å‡½æ•°ä¸­æ³¨å…¥"><a href="#åœ¨é™æ€å‡½æ•°ä¸­æ³¨å…¥" class="headerlink" title="åœ¨é™æ€å‡½æ•°ä¸­æ³¨å…¥"></a><a href="https://start.insert-koin.io/#/getting-started/koin-for-java?id=inject-with-static-functions">åœ¨é™æ€å‡½æ•°ä¸­æ³¨å…¥</a></h2><p><code>KoinJavaComponent</code> ç±»æ˜¯ç¬¬ä¸€ä¸ªé™æ€çš„helperï¼Œä»–èƒ½å°†Koinçš„åŠŸèƒ½å¼•å…¥Javaï¼š</p><ul><li><code>inject()</code> - å»¶è¿Ÿæ³¨å…¥ä¸€ä¸ªå®ä¾‹</li><li><code>get()</code> - æ£€ç´¢å®ä¾‹</li><li><code>getKoin()</code> - è·å–Koinä¸Šä¸‹æ–‡</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.koin.java.standalone.KoinJavaComponent.*;</span><br><span class="line"></span><br><span class="line"><span class="type">ComponentA</span> <span class="variable">a</span> <span class="operator">=</span> get(ComponentA.class);</span><br><span class="line">Lazy&lt;ComponentA&gt; lazy_a = inject(ComponentA.class);</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Koin/">Koin</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Kotlin/">Kotlin</category>
      
      <category domain="https://www.littlecorgi.top/tags/Koin/">Koin</category>
      
      
      <comments>https://www.littlecorgi.top/posts/ebed2a69.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Koin-10-Testing(æµ‹è¯•)</title>
      <link>https://www.littlecorgi.top/posts/63fa5724.html</link>
      <guid>https://www.littlecorgi.top/posts/63fa5724.html</guid>
      <pubDate>Wed, 07 Oct 2020 13:25:15 GMT</pubDate>
      
        
        
          
          
      <description></description>
          
        
      
      
      
      <content:encoded><![CDATA[<blockquote><p><a href="https://start.insert-koin.io/#/getting-started/testing">https://start.insert-koin.io/#/getting-started/testing</a></p><p>å¼€å§‹</p><ul><li><a href="/posts/fd6f0996.html">Intro(ä»‹ç»)</a></li><li><a href="/posts/b075de90.html">Setup(åˆå§‹åŒ–)</a></li></ul><p>Koin in 5 minutes (5åˆ†é’Ÿå¿«é€Ÿå…¥æ‰‹Koin)</p><ul><li><a href="/posts/f88fedb6.html">Kotlin</a></li><li><a href="/posts/2a806fe1.html">Android</a></li><li><a href="/posts/e7ad0613.html">Android Java</a></li><li><a href="/posts/6d1e0fe7.html">Android ViewModel</a></li></ul><p>Getting Started (å¼€å§‹)</p><ul><li><a href="/posts/c99907a8.html">Starting Koin(å¼€å§‹ä½¿ç”¨Koin)</a></li><li><a href="/posts/d8ca0532.html">Modules &amp; definitions(æ¨¡å—å’Œå®šä¹‰)</a></li><li><a href="/posts/f85e8eae.html">Koin Components(Koinç»„ä»¶)</a></li><li><a href="/posts/63fa5724.html">Testing(æµ‹è¯•)</a></li><li><a href="/posts/ebed2a69.html">Koin for Java</a></li><li><a href="/posts/f5a785d7.html">Koin for Android</a></li></ul></blockquote><p><code>Koin-test</code> é¡¹ç›®èƒ½æä¾›ç»™ä½ è½»é‡ä½†æ˜¯å¼ºå¤§çš„å·¥å…·æ¥æµ‹è¯•ä½ çš„Koinåº”ç”¨ç¨‹åºã€‚</p><h2 id="è·å–ç»„ä»¶"><a href="#è·å–ç»„ä»¶" class="headerlink" title="è·å–ç»„ä»¶"></a><a href="https://start.insert-koin.io/#/getting-started/testing?id=getting-your-components">è·å–ç»„ä»¶</a></h2><p>åªè¦ç”¨ <code>KoinTest</code> æ ‡è®°ä½ çš„æµ‹è¯•ç±»ï¼Œä½ å°±å¯ä»¥è§£é”KoinComponent &amp;æµ‹è¯•ç‰¹æ€§ï¼š</p><ul><li><code>by inject()</code> - å»¶è¿Ÿæ³¨å…¥ä¸€ä¸ªå®ä¾‹</li><li><code>get()</code> - æ£€ç´¢ä¸€ä¸ªå®ä¾‹</li></ul><p>æŒ‰ç…§ä»¥ä¸‹æ¥å®šä¹‰ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> appModule = module &#123;</span><br><span class="line">    single &#123; ComponentA() &#125;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å°±èƒ½åƒä¸‹é¢è¿™æ ·æ¥å†™ä¸€ä¸ªæµ‹è¯•ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyTest</span> : <span class="type">KoinTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Lazy inject property</span></span><br><span class="line">    <span class="keyword">val</span> componentA : ComponentA <span class="keyword">by</span> inject()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// use it in your tests :)</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> `make a test with Koin`<span class="params">()</span></span> &#123;</span><br><span class="line">        startKoin &#123; modules(appModule) &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// use componentA here!</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ èƒ½ä½¿ç”¨ <code>KoinTestRule</code> JUnitè§„åˆ™æ¥å¼€å¯æˆ–å…³é—­ä½ çš„Koinä¸Šä¸‹æ–‡ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyTest</span> : <span class="type">KoinTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@get:Rule</span></span><br><span class="line">    <span class="keyword">val</span> koinTestRule = KoinTestRule.create &#123;</span><br><span class="line">        modules(appModule)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Lazy inject property</span></span><br><span class="line">    <span class="keyword">val</span> componentA : ComponentA <span class="keyword">by</span> inject()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// use it in your tests :)</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> `make a test with Koin`<span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">// use componentA here!</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ£€æŸ¥ä½ çš„æ¨¡å—"><a href="#æ£€æŸ¥ä½ çš„æ¨¡å—" class="headerlink" title="æ£€æŸ¥ä½ çš„æ¨¡å—"></a><a href="https://start.insert-koin.io/#/getting-started/testing?id=checking-your-modules">æ£€æŸ¥ä½ çš„æ¨¡å—</a></h2><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Koin Gradleæ’ä»¶æ¥è®©æˆ‘ä»¬è¿è¡Œæˆ‘ä»¬çš„æ¨¡å—æ£€æŸ¥ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">buildscript</span> &#123;</span><br><span class="line">    <span class="keyword">repositories</span> &#123;</span><br><span class="line">        jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">dependencies</span> &#123;</span><br><span class="line">        <span class="keyword">classpath</span> <span class="string">&quot;org.koin:koin-gradle-plugin:$koin_version&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">apply plugin: <span class="string">&#x27;koin&#x27;</span></span><br></pre></td></tr></table></figure><p>æŒ‰ç…§å¦‚ä¸‹æ¥å†™æ£€æŸ¥æµ‹è¯•ï¼š</p><ul><li>ä½¿ç”¨ä¸€ä¸ªJUnit <code>CheckModuleTest</code> ç±»åˆ«</li><li>é€šè¿‡ <code>checkModules &#123; &#125;</code> APIæ¥æµ‹è¯•æ¨¡å—</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Category(CheckModuleTest::class)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModuleCheckTest</span> : <span class="type">AutoCloseKoinTest</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">checkModules</span><span class="params">()</span></span> = checkModules &#123;</span><br><span class="line">        modules(appModule)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬é€šè¿‡Gradleå‘½ä»¤æ¥æ£€æŸ¥æˆ‘ä»¬çš„æ¨¡å—ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew checkModules</span><br></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew checkModules --continuous</span><br></pre></td></tr></table></figure><h2 id="åŠ¨æ€Mock"><a href="#åŠ¨æ€Mock" class="headerlink" title="åŠ¨æ€Mock"></a><a href="https://start.insert-koin.io/#/getting-started/testing?id=mocking-on-the-fly">åŠ¨æ€Mock</a></h2><p>Once you have tagged your class with <code>KoinTest</code> interface, you can use the <code>declareMock</code> function to declare mocks &amp; behavior on the fly:</p><p>ä¸€æ—¦ä½ ç”¨ <code>KoinTest</code> æ¥å£æ ‡è®°äº†ä½ çš„ç±»ï¼Œä½ å°±èƒ½ä½¿ç”¨ <code>declareMock</code> å‡½æ•°æ¥åŠ¨æ€å£°æ˜mocks(æ¨¡æ‹Ÿ)æˆ–è€…behavior(è¡Œä¸º):</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyTest</span> : <span class="type">KoinTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@get:Rule</span></span><br><span class="line">    <span class="keyword">val</span> koinTestRule = KoinTestRule.create &#123;</span><br><span class="line">        modules(appModule)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// required to make your Mock via Koin</span></span><br><span class="line">    <span class="meta">@get:Rule</span></span><br><span class="line">    <span class="keyword">val</span> mockProvider = MockProviderRule.create &#123; clazz -&gt;</span><br><span class="line">        Mockito.mock(clazz.java)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> componentA : ComponentA <span class="keyword">by</span> inject()</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> `declareMock with KoinTest`<span class="params">()</span></span> &#123;</span><br><span class="line">        declareMock&lt;ComponentA&gt; &#123;</span><br><span class="line">            <span class="comment">// do your given behavior here</span></span><br><span class="line">            given(<span class="keyword">this</span>.sayHello()).willReturn(<span class="string">&quot;Hello mock&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¼€å§‹æˆ–åœæ­¢æµ‹è¯•"><a href="#å¼€å§‹æˆ–åœæ­¢æµ‹è¯•" class="headerlink" title="å¼€å§‹æˆ–åœæ­¢æµ‹è¯•"></a><a href="https://start.insert-koin.io/#/getting-started/testing?id=starting-amp-stopping-for-tests">å¼€å§‹æˆ–åœæ­¢æµ‹è¯•</a></h2><p>è¯·æ³¨æ„åœ¨æ¯ä¸ªæµ‹è¯•ä¹‹é—´éƒ½éœ€è¦é€šçŸ¥ä½ çš„Koinå®ä¾‹(å¦‚æœä½ ä½¿ç”¨ <code>startKoin</code> åœ¨ä½ çš„æµ‹è¯•ä¸­)ã€‚å¦åˆ™ï¼Œè¯·ç¡®ä¿å¯¹æœ¬åœ°koinå®ä¾‹ä½¿ç”¨ <code>koinApplication</code> æˆ– <code>stopKoin()</code> æ¥åœæ­¢å½“å‰çš„å…¨å±€å®ä¾‹ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Koin/">Koin</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Kotlin/">Kotlin</category>
      
      <category domain="https://www.littlecorgi.top/tags/Koin/">Koin</category>
      
      
      <comments>https://www.littlecorgi.top/posts/63fa5724.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Koin-9-Koin Components(ç»„ä»¶)</title>
      <link>https://www.littlecorgi.top/posts/f85e8eae.html</link>
      <guid>https://www.littlecorgi.top/posts/f85e8eae.html</guid>
      <pubDate>Wed, 07 Oct 2020 13:25:00 GMT</pubDate>
      
        
        
          
          
      <description></description>
          
        
      
      
      
      <content:encoded><![CDATA[<blockquote><p><a href="https://start.insert-koin.io/#/getting-started/koin-components">https://start.insert-koin.io/#/getting-started/koin-components</a></p><p>å¼€å§‹</p><ul><li><a href="/posts/fd6f0996.html">Intro(ä»‹ç»)</a></li><li><a href="/posts/b075de90.html">Setup(åˆå§‹åŒ–)</a></li></ul><p>Koin in 5 minutes (5åˆ†é’Ÿå¿«é€Ÿå…¥æ‰‹Koin)</p><ul><li><a href="/posts/f88fedb6.html">Kotlin</a></li><li><a href="/posts/2a806fe1.html">Android</a></li><li><a href="/posts/e7ad0613.html">Android Java</a></li><li><a href="/posts/6d1e0fe7.html">Android ViewModel</a></li></ul><p>Getting Started (å¼€å§‹)</p><ul><li><a href="/posts/c99907a8.html">Starting Koin(å¼€å§‹ä½¿ç”¨Koin)</a></li><li><a href="/posts/d8ca0532.html">Modules &amp; definitions(æ¨¡å—å’Œå®šä¹‰)</a></li><li><a href="/posts/f85e8eae.html">Koin Components(Koinç»„ä»¶)</a></li><li><a href="/posts/63fa5724.html">Testing(æµ‹è¯•)</a></li><li><a href="/posts/ebed2a69.html">Koin for Java</a></li><li><a href="/posts/f5a785d7.html">Koin for Android</a></li></ul></blockquote><p>æœ‰æ—¶ä¸èƒ½ä»…é€šè¿‡Koinå£°æ˜ç»„ä»¶ã€‚ä¾èµ–äºä½ çš„è¿è¡Œæ—¶æŠ€æœ¯ï¼Œä½ å¯èƒ½éœ€è¦åœ¨ä¸€ä¸ªä¸æ˜¯ç”¨Koinåˆ›å»ºçš„ç±»ä¸­ä»Koinæ£€ç´¢å®ä¾‹ï¼ˆä¾‹å¦‚Androidï¼‰ã€‚</p><h2 id="Koinç»„ä»¶å®ä¾‹"><a href="#Koinç»„ä»¶å®ä¾‹" class="headerlink" title="Koinç»„ä»¶å®ä¾‹"></a><a href="https://start.insert-koin.io/#/getting-started/koin-components?id=the-koincomponent-interface">Koinç»„ä»¶å®ä¾‹</a></h2><p>é€šè¿‡ <code>KoinComponent</code> æ¥å£æ¥æ ‡è®°ä½ çš„ç±»å°±èƒ½è§£é”Koinçš„æ³¨å…¥åŠŸèƒ½ï¼š</p><ul><li><code>by inject()</code> - å»¶è¿Ÿæ³¨å…¥ä¸€ä¸ªå®ä¾‹</li><li><code>get()</code> - æ£€ç´¢ä¸€ä¸ªå®ä¾‹</li><li><code>getProperty()</code> - è·å¾—ä¸€ä¸ªKoinå±æ€§</li></ul><p>æˆ‘ä»¬å¯ä»¥å°†ä¸Šé¢çš„æ¨¡å—æ³¨å…¥åˆ°ç±»å±æ€§ä¸­ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Tag class with KoinComponent</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HelloApp</span> : <span class="type">KoinComponent</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// lazy inject dependency</span></span><br><span class="line">    <span class="keyword">val</span> helloService: HelloServiceImpl <span class="keyword">by</span> inject()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">sayHello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        helloService.sayHello()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å°±åªéœ€è¦å¼€å¯Koinå¹¶è¿è¡Œæˆ‘ä»¬çš„ç±»ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a module with our declared Koin dependencies </span></span><br><span class="line"><span class="keyword">val</span> helloModule = module &#123;</span><br><span class="line">    single &#123; HelloServiceImpl() &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(<span class="keyword">vararg</span> args: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start Koin</span></span><br><span class="line">    startKoin &#123;</span><br><span class="line">        modules(helloModule)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Run our Koin component</span></span><br><span class="line">    HelloApp().sayHello()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¼•å¯¼"><a href="#å¼•å¯¼" class="headerlink" title="å¼•å¯¼"></a><a href="https://start.insert-koin.io/#/getting-started/koin-components?id=bootstrapping">å¼•å¯¼</a></h4><blockquote><p><code>KoinComponent</code> æ¥å£ä¹Ÿèƒ½è¢«ç”¨æ¥ååŠ©ä½ ä»Koinå¤–éƒ¨å¼•å¯¼ä¸€ä¸ªåº”ç”¨ç¨‹åºã€‚å¦å¤–ï¼Œæ‚¨å¯ä»¥é€šè¿‡æ‰©å±•å‡½æ•°ç›´æ¥åœ¨ä¸€äº›ç›®æ ‡ç±»ä¸Šå¼•å…¥â€œKoinComponentâ€ç‰¹æ€§ï¼ˆå³ï¼šAndroidä¸­çš„Activityã€Fragment have KoinComponentç‰¹æ€§ï¼‰ã€‚</p></blockquote><h2 id="Bridge-with-Koin-instance"><a href="#Bridge-with-Koin-instance" class="headerlink" title="Bridge with Koin instance"></a><a href="https://start.insert-koin.io/#/getting-started/koin-components?id=bridge-with-koin-instance">Bridge with Koin instance</a></h2><p><code>KoinComponent</code> æ¥å£ä¸»è¦å¸¦æ¥äº†å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">KoinComponent</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get the associated Koin instance</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getKoin</span><span class="params">()</span></span>: Koin = GlobalContext.<span class="keyword">get</span>().koin</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»–å¸¦æ¥äº†å¦‚ä¸‹çš„å¯èƒ½æ€§ï¼š</p><blockquote><p>ç„¶åå¯ä»¥é‡æ–°å®šä¹‰ <code>getKoin()</code> å‡½æ•°ï¼Œä»¥é‡å®šå‘åˆ°æœ¬åœ°è‡ªå®šä¹‰Koinå®ä¾‹</p></blockquote>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Koin/">Koin</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Kotlin/">Kotlin</category>
      
      <category domain="https://www.littlecorgi.top/tags/Koin/">Koin</category>
      
      
      <comments>https://www.littlecorgi.top/posts/f85e8eae.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Koin-8-Modules &amp; definitions(æ¨¡å—å’Œå®šä¹‰)</title>
      <link>https://www.littlecorgi.top/posts/d8ca0532.html</link>
      <guid>https://www.littlecorgi.top/posts/d8ca0532.html</guid>
      <pubDate>Wed, 07 Oct 2020 13:24:36 GMT</pubDate>
      
        
        
          
          
      <description></description>
          
        
      
      
      
      <content:encoded><![CDATA[<blockquote><p><a href="https://start.insert-koin.io/#/getting-started/modules-definitions">https://start.insert-koin.io/#/getting-started/modules-definitions</a></p><p>å¼€å§‹</p><ul><li><a href="/posts/fd6f0996.html">Intro(ä»‹ç»)</a></li><li><a href="/posts/b075de90.html">Setup(åˆå§‹åŒ–)</a></li></ul><p>Koin in 5 minutes (5åˆ†é’Ÿå¿«é€Ÿå…¥æ‰‹Koin)</p><ul><li><a href="/posts/f88fedb6.html">Kotlin</a></li><li><a href="/posts/2a806fe1.html">Android</a></li><li><a href="/posts/e7ad0613.html">Android Java</a></li><li><a href="/posts/6d1e0fe7.html">Android ViewModel</a></li></ul><p>Getting Started (å¼€å§‹)</p><ul><li><a href="/posts/c99907a8.html">Starting Koin(å¼€å§‹ä½¿ç”¨Koin)</a></li><li><a href="/posts/d8ca0532.html">Modules &amp; definitions(æ¨¡å—å’Œå®šä¹‰)</a></li><li><a href="/posts/f85e8eae.html">Koin Components(Koinç»„ä»¶)</a></li><li><a href="/posts/63fa5724.html">Testing(æµ‹è¯•)</a></li><li><a href="/posts/ebed2a69.html">Koin for Java</a></li><li><a href="/posts/f5a785d7.html">Koin for Android</a></li></ul></blockquote><p>ç”¨Koinç¼–å†™å®šä¹‰æ˜¯é€šè¿‡Kotlinå‡½æ•°å®Œæˆçš„ï¼Œè¯¥å‡½æ•°æè¿°äº†å®ä¾‹çš„æ„å»ºæ–¹å¼ã€‚ </p><p>é…ç½®å®ŒKoinåº”ç”¨ç¨‹åºåï¼Œè®©æˆ‘ä»¬æ¥ç¼–å†™ä¸€äº›æ¨¡å—å’Œå®šä¹‰ã€‚</p><h2 id="æ¨¡å—-amp-å®šä¹‰"><a href="#æ¨¡å—-amp-å®šä¹‰" class="headerlink" title="æ¨¡å— &amp; å®šä¹‰"></a><a href="https://start.insert-koin.io/#/getting-started/modules-definitions?id=module-amp-definitions">æ¨¡å— &amp; å®šä¹‰</a></h2><p>ç»™å‡ºæˆ‘ä»¬éœ€è¦å»æ³¨å…¥çš„ç±»ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DataRepository</span>()</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Presenter</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPresenter</span>(<span class="keyword">val</span> repository : Repository) : Presenter</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HttpClient</span>(<span class="keyword">val</span> url : String)</span><br></pre></td></tr></table></figure><p>ä¸‹é¢å±•ç¤ºå¦‚ä½•å®šä¹‰è¿™äº›ç»„ä»¶ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// declare a module</span></span><br><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªmodule</span></span><br><span class="line"><span class="keyword">val</span> myModule = module &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Define a singleton for type DataRepository</span></span><br><span class="line">    <span class="comment">// ä¸ºDataRepositoryå®šä¹‰ä¸€ä¸ªå•ä¾‹</span></span><br><span class="line">    single &#123; DataRepository() &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Define a factory (create a new instance each time) for type Presenter (infered parameter in &lt;&gt;)</span></span><br><span class="line">    <span class="comment">// Resolve constructor dependency with get()</span></span><br><span class="line">    <span class="comment">// ä¸ºPresenter(åœ¨&lt;&gt;ä¸­æ¨æ–­ç±»å‹)å®šä¹‰ä¸€ä¸ªfactory(æ¯æ¬¡éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹)</span></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ get() è§£ææ„é€ å‡½æ•°ä¾èµ–</span></span><br><span class="line">    factory&lt;Presenter&gt; &#123; MyPresenter(<span class="keyword">get</span>()) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Define a singleton of type HttpClient</span></span><br><span class="line">    <span class="comment">// inject property &quot;server_url&quot; from Koin properties</span></span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ªHttpClientç±»çš„å•åˆ©</span></span><br><span class="line">    <span class="comment">// ä»Koinå±æ€§ä¸­æ³¨å…¥&quot;server_url&quot;è¿™ä¸ªå±æ€§</span></span><br><span class="line">    single &#123; HttpClient(getProperty(<span class="string">&quot;server_url&quot;</span>)) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¿®é¥°ç¬¦"><a href="#ä¿®é¥°ç¬¦" class="headerlink" title="ä¿®é¥°ç¬¦"></a><a href="https://start.insert-koin.io/#/getting-started/modules-definitions?id=qualifiers">ä¿®é¥°ç¬¦</a></h2><p>ä½ å¯ä»¥ç»™ç»„ä»¶æä¾›ä¸€ä¸ªä¿®é¥°ç¬¦ã€‚è¿™ä¸ªä¿®é¥°ç¬¦å¯ä»¥æ˜¯stringæˆ–è€…typeï¼Œå¹¶é€šè¿‡ <code>named()</code> å‡½æ•°è¿›è¡Œé…ç½®ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> myModule = module &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Define a singleton for type  DataRepository</span></span><br><span class="line">    <span class="comment">// ä¸ºDataRepositoryå®šä¹‰ä¸€ä¸ªå•ä¾‹</span></span><br><span class="line">    single &#123; DataRepository() &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Mock</span></span><br><span class="line">    single(named(<span class="string">&quot;mock&quot;</span>)) &#123; MockDataRepository() &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¿®é¥°ç¬¦å¯ä»¥ä¸æšä¸¾ç±»å…³è”ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¸ç±»å‹å…³è”ï¼š</p></blockquote><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Type qualifier</span></span><br><span class="line">single(named&lt;MyClass&gt;()) &#123; MockDataRepository() &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Enum qualifier</span></span><br><span class="line">single(named&lt;MyEnum.MyValue&gt;()) &#123; MockDataRepository() &#125;</span><br></pre></td></tr></table></figure><h2 id="å…¶å®ƒç±»å‹"><a href="#å…¶å®ƒç±»å‹" class="headerlink" title="å…¶å®ƒç±»å‹"></a><a href="https://start.insert-koin.io/#/getting-started/modules-definitions?id=additional-types">å…¶å®ƒç±»å‹</a></h2><p>åœ¨DLSæ¨¡å—ä¸­ï¼Œå¯¹äºä¸€ä¸ªå®šä¹‰ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>bind</code> æ“ä½œç¬¦(KClassåˆ—è¡¨ä½¿ç”¨ <code>binds</code>)æ¥ç»™å®šä¸€äº›é¢å¤–çš„ç±»å‹å»ç»‘å®šï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">module &#123;</span><br><span class="line">    single &#123; Component1() &#125; bind ComponentInterface1::<span class="keyword">class</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åä½ å°±èƒ½é€šè¿‡ <code>get&lt;Component1&gt;()</code> æˆ–è€… <code>get&lt;ComponentInterface1&gt;()</code> æ¥è¯·æ±‚åˆ°ä½ çš„å®ä¾‹äº†ã€‚</p><p>ä½ ä¹Ÿèƒ½ç»™å¤šä¸ªå®šä¹‰ç»‘å®šåŒä¸€ä¸ªtypeï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">module &#123;</span><br><span class="line">    single &#123; Component1() &#125; bind ComponentInterface1::<span class="keyword">class</span></span><br><span class="line">    <span class="title class_">single</span> &#123; Component2() &#125; bind ComponentInterface1::<span class="keyword">class</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åœ¨è¿™ä½ ä¸èƒ½é€šè¿‡ <code>get&lt;Simple.ComponentInterface1&gt;()</code> æ¥è¯·æ±‚ä¸€ä¸ªå®ä¾‹ã€‚ä½ åªèƒ½ä½¿ç”¨ <code>koin.bind&lt;Component1,ComponentInterface1&gt;()</code> æ¥æ£€ç´¢ä¸€ä¸ªå…·æœ‰ <code>Component1</code> å®ç°çš„ <code>ComponentInterface1</code> çš„å®ä¾‹ã€‚</p><p>è¯·æ³¨æ„ï¼Œæ‚¨è¿˜å¯ä»¥æŸ¥æ‰¾ç»‘å®šç»™å®šç±»å‹çš„æ‰€æœ‰ç»„ä»¶ï¼š <code>getAll&lt;ComponentInterface1&gt;()</code> å°†è¯·æ±‚æ‰€æœ‰ç»‘å®š <code>ComponentInterface1</code> ç±»çš„å®ä¾‹ã€‚</p><h2 id="ç»„åˆæ¨¡å—"><a href="#ç»„åˆæ¨¡å—" class="headerlink" title="ç»„åˆæ¨¡å—"></a><a href="https://start.insert-koin.io/#/getting-started/modules-definitions?id=combining-several-modules">ç»„åˆæ¨¡å—</a></h2><p>Koinæ²¡æœ‰å¯¼å…¥(import)çš„æ¦‚å¿µã€‚æ‰€ä»¥åªéœ€ç»“åˆå‡ ä¸ªäº’è¡¥çš„æ¨¡å—å®šä¹‰ã€‚</p><p>è®©æˆ‘ä»¬åœ¨ä¸¤ä¸ªæ¨¡å—ä¸­åˆ†å‘å®šä¹‰ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> module1 = module &#123;</span><br><span class="line">    single &#123; DataRepository() &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">val</span> module2 = module &#123;</span><br><span class="line">    factory&lt;Presenter&gt; &#123; MyPresenter(<span class="keyword">get</span>()) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åªéœ€è¦ä¸ºKoinåˆ—å‡ºä»–ä»¬ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">startKoin &#123;</span><br><span class="line">    modules(module1,module2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¯åŠ¨ååŠ è½½"><a href="#å¯åŠ¨ååŠ è½½" class="headerlink" title="å¯åŠ¨ååŠ è½½"></a><a href="https://start.insert-koin.io/#/getting-started/modules-definitions?id=loading-after-start">å¯åŠ¨ååŠ è½½</a></h2><p>åœ¨Koiné€šè¿‡ <code>startKoin &#123; &#125;</code> å‡½æ•°å¯åŠ¨åï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ <code>loadKoinModules(modules...)</code> å‡½æ•°æ¥åŠ è½½å…¶å®ƒå®šä¹‰æ¨¡å—ã€‚</p><h2 id="åˆ é™¤å®šä¹‰"><a href="#åˆ é™¤å®šä¹‰" class="headerlink" title="åˆ é™¤å®šä¹‰"></a><a href="https://start.insert-koin.io/#/getting-started/modules-definitions?id=dropping-definitions">åˆ é™¤å®šä¹‰</a></h2><p>ä¸€æ—¦ä¸€ä¸ªæ¨¡å—è¢«åŠ è½½åˆ°äº†Koinä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥å–æ¶ˆåŠ è½½ä»–ç„¶ååˆ é™¤æ‰ä¸è¿™äº›å®šä¹‰ç›¸å…³çš„å®šä¹‰å’Œå®ä¾‹ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>unloadKoinModules(modules...)</code> ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> module = module &#123;</span><br><span class="line">    single &#123; (id: <span class="built_in">Int</span>) -&gt; Simple.MySingle(id) &#125;</span><br><span class="line">&#125;</span><br><span class="line">startKoin &#123;</span><br><span class="line">    printLogger(Level.DEBUG)</span><br><span class="line">    modules(module)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">get</span>&lt;Simple.MySingle&gt; &#123; parametersOf(<span class="number">42</span>) &#125; -&gt; id <span class="keyword">is</span> <span class="number">42</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// unload definitions for given module</span></span><br><span class="line">unloadKoinModules(module)</span><br><span class="line"><span class="comment">// load definitions for given module</span></span><br><span class="line">loadKoinModules(module)</span><br><span class="line"></span><br><span class="line"><span class="keyword">get</span>&lt;Simple.MySingle&gt; &#123; parametersOf(<span class="number">24</span>) &#125; -&gt; id <span class="keyword">is</span> <span class="number">24</span></span><br></pre></td></tr></table></figure><h2 id="å³æ—¶å£°æ˜"><a href="#å³æ—¶å£°æ˜" class="headerlink" title="å³æ—¶å£°æ˜"></a><a href="https://start.insert-koin.io/#/getting-started/modules-definitions?id=declare-on-the-fly">å³æ—¶å£°æ˜</a></h2><p>Koin 1.0çš„æœ€åä¸€ä¸ªå‘åç§»æ¤<em>(è¯‘è€…æ³¨ï¼šåŸæ–‡æ˜¯backport)</em>åŠŸèƒ½ä¹‹ä¸€æ˜¯èƒ½å¤ŸåŠ¨æ€å£°æ˜å®ä¾‹ã€‚ç°åœ¨å¯ä»¥åœ¨Koin.declareï¼ˆï¼‰æˆ–Scope.declareï¼ˆï¼‰ä¸Šä½¿ç”¨ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> koin = koinApplication &#123;</span><br><span class="line">    <span class="comment">// no def</span></span><br><span class="line">    modules()</span><br><span class="line">&#125;.koin</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create an instance</span></span><br><span class="line"><span class="keyword">val</span> a = Simple.ComponentA()</span><br><span class="line"></span><br><span class="line"><span class="comment">// declare it</span></span><br><span class="line">koin.declare(a)</span><br><span class="line"></span><br><span class="line"><span class="comment">// retrieve it</span></span><br><span class="line">assertEquals(a, koin.<span class="keyword">get</span>&lt;Simple.ComponentA&gt;())</span><br></pre></td></tr></table></figure><p>ä½ ä¹Ÿèƒ½é€šè¿‡ä¸€ä¸ªä¿®é¥°ç¬¦æˆ–è€…æ¬¡è¦ç±»å‹æ¥å¸®åŠ©ä½ åˆ›å»ºå®šä¹‰ï¼š</p><ul><li><code>koin.declare(myInstance, named(&quot;qualifier&quot;))</code></li><li><code>koin.declare(myInstance, secondaryTypes = listOf())</code></li></ul><h2 id="DSLå›é¡¾"><a href="#DSLå›é¡¾" class="headerlink" title="DSLå›é¡¾"></a><a href="https://start.insert-koin.io/#/getting-started/modules-definitions?id=dsl-recap">DSLå›é¡¾</a></h2><p>å¿«é€Ÿå›é¡¾ä¸‹è¿™äº›Koinå…³é”®å­—ï¼š</p><ul><li><code>module &#123; &#125;</code> - åˆ›å»ºä¸€ä¸ªKoinæ¨¡å—æˆ–è€…å­æ¨¡å—(åœ¨ä¸€ä¸ªæ¨¡å—é‡Œé¢)</li><li><code>factory &#123; &#125;</code> - æä¾›ä¸€ä¸ª <em>factoryå·¥å‚</em> beanå®šä¹‰</li><li><code>single &#123; &#125;</code> - æä¾›ä¸€ä¸ªbeanå®šä¹‰</li><li><code>get()</code> - è§£æä¸€ä¸ªç»„ä»¶ä¾èµ–</li><li><code>named()</code> - é€šè¿‡typeã€æšä¸¾æˆ–è€…å­—ç¬¦ä¸²æ¥å®šä¹‰ä¸€ä¸ªä¿®é¥°ç¬¦</li><li><code>bind</code> - ç»™ç»™å®šçš„beanå®šä¹‰ç»‘å®šå…¶å®ƒKolinç±»å‹</li><li><code>binds</code> - ç»™ç»™å®šçš„beanå®šä¹‰ç»‘å®šå…¶ä»–Kotlinç±»å‹åˆ—è¡¨</li><li><code>getProperty()</code> - è§£æä¸€ä¸ªKoinå±æ€§</li></ul>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Koin/">Koin</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Kotlin/">Kotlin</category>
      
      <category domain="https://www.littlecorgi.top/tags/Koin/">Koin</category>
      
      
      <comments>https://www.littlecorgi.top/posts/d8ca0532.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Koin-7-Starting_Koin</title>
      <link>https://www.littlecorgi.top/posts/c99907a8.html</link>
      <guid>https://www.littlecorgi.top/posts/c99907a8.html</guid>
      <pubDate>Wed, 07 Oct 2020 13:24:01 GMT</pubDate>
      
        
        
          
          
      <description></description>
          
        
      
      
      
      <content:encoded><![CDATA[<blockquote><p><a href="https://start.insert-koin.io/#/getting-started/starting-koin">https://start.insert-koin.io/#/getting-started/starting-koin</a></p><p>å¼€å§‹</p><ul><li><a href="/posts/fd6f0996.html">Intro(ä»‹ç»)</a></li><li><a href="/posts/b075de90.html">Setup(åˆå§‹åŒ–)</a></li></ul><p>Koin in 5 minutes (5åˆ†é’Ÿå¿«é€Ÿå…¥æ‰‹Koin)</p><ul><li><a href="/posts/f88fedb6.html">Kotlin</a></li><li><a href="/posts/2a806fe1.html">Android</a></li><li><a href="/posts/e7ad0613.html">Android Java</a></li><li><a href="/posts/6d1e0fe7.html">Android ViewModel</a></li></ul><p>Getting Started (å¼€å§‹)</p><ul><li><a href="/posts/c99907a8.html">Starting Koin(å¼€å§‹ä½¿ç”¨Koin)</a></li><li><a href="/posts/d8ca0532.html">Modules &amp; definitions(æ¨¡å—å’Œå®šä¹‰)</a></li><li><a href="/posts/f85e8eae.html">Koin Components(Koinç»„ä»¶)</a></li><li><a href="/posts/63fa5724.html">Testing(æµ‹è¯•)</a></li><li><a href="/posts/ebed2a69.html">Koin for Java</a></li><li><a href="/posts/f5a785d7.html">Koin for Android</a></li></ul><p>Koin is a DSL, a container &amp; a pragamtic API to leverage your dependencies.</p><p>Koinæ˜¯ä¸€ä¸ªDSLã€ä¸€ä¸ªå®¹å™¨ã€ä¸€ä¸ªå®ç”¨çš„APIæ¥æœ‰æ•ˆåˆ©ç”¨æˆ‘ä»¬çš„ä¾èµ–</p></blockquote><p>Koin DSLåŒ…å«è¿™äº›ï¼š</p><ul><li>KoinApplication DSL: æè¿°å¦‚ä½•é…ç½®ä½ çš„Koin Application</li><li>Module DSL: æè¿°ä½ çš„å®šä¹‰</li></ul><p>å¼€å§‹ä½¿ç”¨Koinå¯ä»¥é€šè¿‡å¦‚ä¸‹å‡ ç§ä½¿ç”¨ <code>startKoin</code> çš„å½¢å¼ï¼š</p><h2 id="StartKoin"><a href="#StartKoin" class="headerlink" title="StartKoin"></a><a href="https://start.insert-koin.io/#/getting-started/starting-koin?id=startkoin">StartKoin</a></h2><p>åœ¨ä¸€ä¸ªKotlinæ–‡ä»¶ä¸­ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(<span class="keyword">vararg</span> args: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    startKoin &#123;</span><br><span class="line">        <span class="comment">// enable Printlogger with default Level.INFO ä½¿ç”¨é»˜è®¤Level.INFOæ¥å¼€å¯Printlogger</span></span><br><span class="line">        <span class="comment">// can have Level &amp; implementation æœ‰Levelå’Œimplementation</span></span><br><span class="line">        <span class="comment">// equivalent to logger(Level.INFO, PrintLogger()) ç›¸å½“äºLogger</span></span><br><span class="line">        printlogger() </span><br><span class="line"></span><br><span class="line">        <span class="comment">// declare properties from given map ä»ç»™å®šçš„mapä¸­å£°æ˜å±æ€§</span></span><br><span class="line">        properties( <span class="comment">/* properties map */</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// load properties from koin.properties file or given file name </span></span><br><span class="line">        <span class="comment">// ä»koin.propertiesæ–‡ä»¶æˆ–è€…ç»™å®šçš„æ–‡ä»¶åä¸­åŠ è½½å±æ€§</span></span><br><span class="line">        fileProperties()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// load properties from environment ä»ç¯å¢ƒä¸­åŠ è½½å±æ€§</span></span><br><span class="line">        environmentProperties()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// list all used modules åˆ—å‡ºæ‰€æœ‰çš„module</span></span><br><span class="line">        <span class="comment">// as list or vararg é€šè¿‡listæˆ–è€…å¯å˜é•¿åº¦çš„å‚æ•°</span></span><br><span class="line">        modules(myModules) </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Starting-for-Android"><a href="#Starting-for-Android" class="headerlink" title="Starting for Android"></a><a href="https://start.insert-koin.io/#/getting-started/starting-koin?id=starting-for-android">Starting for Android</a></h2><p>åœ¨ä»»ä½•ä¸€ä¸ªAndroidç±»ä¸­ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainApplication</span> : <span class="type">Application</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate()</span><br><span class="line"></span><br><span class="line">        startKoin &#123;</span><br><span class="line">            <span class="comment">// use AndroidLogger as Koin Logger - default Level.INFO</span></span><br><span class="line">            <span class="comment">// ä½¿ç”¨AndroidLoggerä½œä¸ºKoin Logger - é»˜è®¤Level.INFO</span></span><br><span class="line">            androidLogger()</span><br><span class="line"></span><br><span class="line">            <span class="comment">// use the Android context given there ä½¿ç”¨è¿™ç»™å‡ºçš„Android context</span></span><br><span class="line">            androidContext(<span class="keyword">this</span><span class="symbol">@MainApplication</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment">// load properties from assets/koin.properties file ä»assets/koin.propertiesæ–‡ä»¶ä¸­åŠ è½½å±æ€§</span></span><br><span class="line">            androidFileProperties()</span><br><span class="line"></span><br><span class="line">            <span class="comment">// module list</span></span><br><span class="line">            modules(myModules)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ ä¸èƒ½æ³¨å…¥Android contextæˆ–è€…applicationï¼Œé‚£å°±ç¡®ä¿åœ¨ä½ çš„Koin applicationå£°æ˜ä¸­ä½¿ç”¨ <code>androidContext()</code> å‡½æ•°ã€‚</p><h2 id="Starting-for-Ktor"><a href="#Starting-for-Ktor" class="headerlink" title="Starting for Ktor"></a><a href="https://start.insert-koin.io/#/getting-started/starting-koin?id=starting-for-ktor">Starting for Ktor</a></h2><p>Starting Koin from your <code>Application</code> extension function:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> Application.<span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// Install Ktor features</span></span><br><span class="line">    install(Koin) &#123;</span><br><span class="line">        <span class="comment">// Use SLF4J Koin Logger at Level.INFO</span></span><br><span class="line">        slf4jLogger()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// declare used modules</span></span><br><span class="line">        modules(myModules)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è‡ªå®šä¹‰Koinå®ä¾‹"><a href="#è‡ªå®šä¹‰Koinå®ä¾‹" class="headerlink" title="è‡ªå®šä¹‰Koinå®ä¾‹"></a><a href="https://start.insert-koin.io/#/getting-started/starting-koin?id=custom-koin-instance">è‡ªå®šä¹‰Koinå®ä¾‹</a></h2><p>Here below are the KoinApplication builders:</p><p>ä¸‹é¢è¿™äº›æ˜¯KoinApplicatioon builders(æ„é€ è€…)ï¼š</p><ul><li><code>startKoin &#123; &#125;</code> - åˆ›å»ºå¹¶æ³¨å†Œå¦‚ä¸‹çš„KoinApplicationå®ä¾‹</li><li><code>koinApplication &#123; &#125;</code> - åˆ›å»ºKoinApplicationå®ä¾‹</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create and register following KoinApplication instance</span></span><br><span class="line">startKoin &#123;</span><br><span class="line">    logger()</span><br><span class="line">    modules(coffeeAppModule)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// create KoinApplication instance</span></span><br><span class="line">koinApplication &#123;</span><br><span class="line">    logger()</span><br><span class="line">    modules(coffeeAppModule)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Logging"><a href="#Logging" class="headerlink" title="Logging"></a><a href="https://start.insert-koin.io/#/getting-started/starting-koin?id=logging">Logging</a></h2><p>å¼€å§‹æ—¶ï¼ŒKoin logå°±éœ€è¦è¢«å®šä¹‰ä»–çš„åå­—æˆ–ç±»å‹(å¦‚æœlogæ˜¯æ´»è·ƒçŠ¶æ€)ï¼š(<em>At start, Koin log what definition is bound by name or type (if log is activated):</em>)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[INFO] [Koin] bind type:&#x27;org.koin.example.CoffeeMaker&#x27; ~ [type:Single,class:&#x27;org.koin.example.CoffeeMaker&#x27;]</span><br><span class="line">[INFO] [Koin] bind type:&#x27;org.koin.example.Pump&#x27; ~ [type:Single,class:&#x27;org.koin.example.Pump&#x27;]</span><br><span class="line">[INFO] [Koin] bind type:&#x27;org.koin.example.Heater&#x27; ~ [type:Single,class:&#x27;org.koin.example.Heater&#x27;]</span><br></pre></td></tr></table></figure><h2 id="DSL"><a href="#DSL" class="headerlink" title="DSL"></a><a href="https://start.insert-koin.io/#/getting-started/starting-koin?id=dsl">DSL</a></h2><p>å¿«é€Ÿå›é¡¾ä¸€ä¸‹Koin DSLå…³é”®å­—ï¼š</p><ul><li><code>startKoin &#123; &#125;</code> - åˆ›å»ºå’Œæ³¨å†Œå¦‚ä¸‹çš„KoinApplicationå®ä¾‹</li><li><code>koinApplication &#123; &#125;</code> - åˆ›å»ºKoinApplicationå®ä¾‹</li><li><code>modules(...)</code> - å£°æ˜ä½¿ç”¨çš„modules</li><li><code>logger()</code> - å£°æ˜Printlogger</li><li><code>properties(...)</code> - å£°æ˜mapå±æ€§</li><li><code>fileProperties()</code> - ä»æ–‡ä»¶ä¸­ä½¿ç”¨å±æ€§</li><li><code>environmentProperties()</code> - ä»ç¯å¢ƒä¸­ä½¿ç”¨å±æ€§</li><li><code>androidLogger()</code> - å£°æ˜ Android Koin logger</li><li><code>androidContext(...)</code> - ä½¿ç”¨ç»™å‡ºçš„Android context</li><li><code>androidFileProperties()</code> - ä½¿ç”¨ Android assets ä¸­çš„å±æ€§æ–‡ä»¶</li><li><code>slf4jLogger(...)</code> - ä½¿ç”¨SLF4J Logger</li></ul>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Koin/">Koin</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Kotlin/">Kotlin</category>
      
      <category domain="https://www.littlecorgi.top/tags/Koin/">Koin</category>
      
      
      <comments>https://www.littlecorgi.top/posts/c99907a8.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Koin-6-Android_ViewModel</title>
      <link>https://www.littlecorgi.top/posts/6d1e0fe7.html</link>
      <guid>https://www.littlecorgi.top/posts/6d1e0fe7.html</guid>
      <pubDate>Wed, 07 Oct 2020 13:23:46 GMT</pubDate>
      
        
        
          
          
      <description></description>
          
        
      
      
      
      <content:encoded><![CDATA[<blockquote><p><a href="https://start.insert-koin.io/#/quickstart/android-viewmodel">https://start.insert-koin.io/#/quickstart/android-viewmodel</a></p><p>å¼€å§‹</p><ul><li><a href="/posts/fd6f0996.html">Intro(ä»‹ç»)</a></li><li><a href="/posts/b075de90.html">Setup(åˆå§‹åŒ–)</a></li></ul><p>Koin in 5 minutes (5åˆ†é’Ÿå¿«é€Ÿå…¥æ‰‹Koin)</p><ul><li><a href="/posts/f88fedb6.html">Kotlin</a></li><li><a href="/posts/2a806fe1.html">Android</a></li><li><a href="/posts/e7ad0613.html">Android Java</a></li><li><a href="/posts/6d1e0fe7.html">Android ViewModel</a></li></ul><p>Getting Started (å¼€å§‹)</p><ul><li><a href="/posts/c99907a8.html">Starting Koin(å¼€å§‹ä½¿ç”¨Koin)</a></li><li><a href="/posts/d8ca0532.html">Modules &amp; definitions(æ¨¡å—å’Œå®šä¹‰)</a></li><li><a href="/posts/f85e8eae.html">Koin Components(Koinç»„ä»¶)</a></li><li><a href="/posts/63fa5724.html">Testing(æµ‹è¯•)</a></li><li><a href="/posts/ebed2a69.html">Koin for Java</a></li><li><a href="/posts/f5a785d7.html">Koin for Android</a></li></ul></blockquote><h1 id="åœ¨Android-ViewModel-applicationä¸­ä½¿ç”¨"><a href="#åœ¨Android-ViewModel-applicationä¸­ä½¿ç”¨" class="headerlink" title="åœ¨Android ViewModel applicationä¸­ä½¿ç”¨"></a><a href="https://start.insert-koin.io/#/quickstart/android-viewmodel?id=getting-started-with-android-viewmodel-application">åœ¨Android ViewModel applicationä¸­ä½¿ç”¨</a></h1><blockquote><p>è¿™ä¸ªæ•™ç¨‹å°†ä¼šå‘Šè¯‰ä½ å¦‚ä½•ä½¿ç”¨Koinæ³¨å…¥å’Œæ£€ç´¢ViewModelç»„ä»¶æ¥ç¼–å†™ä¸€ä¸ªAndroid/Kotlin applicationã€‚</p></blockquote><h2 id="Get-the-code"><a href="#Get-the-code" class="headerlink" title="Get the code"></a><a href="https://start.insert-koin.io/#/quickstart/android-viewmodel?id=get-the-code">Get the code</a></h2><p>å¯ä»¥ç›´æ¥åœ¨Githubä¸ŠæŸ¥çœ‹é¡¹ç›®æˆ–è€…ä¸‹è½½zip</p><blockquote><p>ğŸš€ Go to <a href="https://github.com/InsertKoinIO/getting-started-koin-android">Github</a> or <a href="https://github.com/InsertKoinIO/getting-started-koin-android/archive/master.zip">download Zip</a></p></blockquote><h2 id="é…ç½®Gradle"><a href="#é…ç½®Gradle" class="headerlink" title="é…ç½®Gradle"></a><a href="https://start.insert-koin.io/#/quickstart/android-viewmodel?id=gradle-setup">é…ç½®Gradle</a></h2><p>é€šè¿‡å¦‚ä¸‹æ–¹å¼æ·»åŠ  Koin Android çš„ä¾èµ–ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Add Jcenter to your repositories if needed</span></span><br><span class="line">repositories &#123;</span><br><span class="line">    jcenter()    </span><br><span class="line">&#125;</span><br><span class="line">dependencies &#123;</span><br><span class="line">    <span class="comment">// Koin for Android - Scope feature</span></span><br><span class="line">    <span class="comment">// include koin-android-scope &amp; koin-android</span></span><br><span class="line">    compile <span class="string">&quot;org.koin:koin-android-viewmodel:$koin_version&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æˆ‘ä»¬çš„ç»„ä»¶"><a href="#æˆ‘ä»¬çš„ç»„ä»¶" class="headerlink" title="æˆ‘ä»¬çš„ç»„ä»¶"></a><a href="https://start.insert-koin.io/#/quickstart/android-viewmodel?id=our-components">æˆ‘ä»¬çš„ç»„ä»¶</a></h2><p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <code>HelloRepository</code> æ¥æä¾›ä¸€äº›æ•°æ®ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">HelloRepository</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">giveHello</span><span class="params">()</span></span>: String</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HelloRepositoryImpl</span>() : HelloRepository &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">giveHello</span><span class="params">()</span></span> = <span class="string">&quot;Hello Koin&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªViewModelç±»ï¼Œæ¥æ¶ˆè´¹è¿™äº›æ•°æ®ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyViewModel</span>(<span class="keyword">val</span> repo : HelloRepository) : ViewModel() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">sayHello</span><span class="params">()</span></span> = <span class="string">&quot;<span class="subst">$&#123;repo.giveHello()&#125;</span> from <span class="variable">$this</span>&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¼–å†™Koin-module"><a href="#ç¼–å†™Koin-module" class="headerlink" title="ç¼–å†™Koin module"></a><a href="https://start.insert-koin.io/#/quickstart/android-viewmodel?id=writing-the-koin-module">ç¼–å†™Koin module</a></h2><p>ä½¿ç”¨ <code>module</code> å‡½æ•°æ¥å£°æ˜ä¸€ä¸ªmoduleã€‚è®©æˆ‘ä»¬å£°æ˜æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªç»„ä»¶ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> appModule = module &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// single instance of HelloRepository</span></span><br><span class="line">    single&lt;HelloRepository&gt; &#123; HelloRepositoryImpl() &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// MyViewModel ViewModel</span></span><br><span class="line">    viewModel &#123; MyViewModel(<span class="keyword">get</span>()) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸€ä¸ª <code>module</code> ä¸­ï¼Œæˆ‘ä»¬å°†æˆ‘ä»¬çš„ <code>MyViewModel</code> ç±»å£°æ˜æˆä¸€ä¸ª <code>viewModel</code>ã€‚Koinå°†ä¼šå°†è¿™ä¸ª <code>MyViewModel</code> äº¤ç»™Lifecycle ViewModelFactoryå¹¶å¸®æˆ‘ä»¬å°†å®ƒç»‘å®šåˆ°å½“å‰çš„ç»„ä»¶ä¸Šã€‚</p><h2 id="å¼€å§‹ä½¿ç”¨Koin"><a href="#å¼€å§‹ä½¿ç”¨Koin" class="headerlink" title="å¼€å§‹ä½¿ç”¨Koin"></a><a href="https://start.insert-koin.io/#/quickstart/android-viewmodel?id=start-koin">å¼€å§‹ä½¿ç”¨Koin</a></h2><p>ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªmoduleï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨Koinäº†ã€‚æ‰“å¼€ä½ çš„Applicationç±»ï¼Œæˆ–è€…åˆ›å»ºä¸€ä¸ª(ä¸è¦å¿˜äº†åœ¨ä½ çš„Manifest.xmlä¸­å£°æ˜å®ƒ)ã€‚ç„¶ååªéœ€è¦è°ƒç”¨ <code>startKoin()</code> å‡½æ•°ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyApplication</span> : <span class="type">Application</span>()&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate()</span><br><span class="line">        <span class="comment">// Start Koin</span></span><br><span class="line">        startKoin&#123;</span><br><span class="line">            androidLogger()</span><br><span class="line">            androidContext(<span class="keyword">this</span><span class="symbol">@MyApplication</span>)</span><br><span class="line">            modules(appModule)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ³¨å…¥ä¾èµ–"><a href="#æ³¨å…¥ä¾èµ–" class="headerlink" title="æ³¨å…¥ä¾èµ–"></a><a href="https://start.insert-koin.io/#/quickstart/android-viewmodel?id=injecting-dependencies">æ³¨å…¥ä¾èµ–</a></h2><p><code>MyViewModel</code> ç»„ä»¶å°†ä¼šè¢«é€šè¿‡ <code>HelloRepository</code> å®ä¾‹æ‰€åˆ›å»ºã€‚ä¸ºäº†åœ¨æˆ‘ä»¬çš„Activityä¸­è·å–åˆ°å®ƒï¼Œå°±éœ€è¦ä½¿ç”¨ <code>by viewModel()</code> å§”æ‰˜æ³¨å…¥å™¨æ¥æ³¨å…¥å®ƒï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyViewModelActivity</span> : <span class="type">AppCompatActivity</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Lazy Inject ViewModel</span></span><br><span class="line">    <span class="keyword">val</span> myViewModel: MyViewModel <span class="keyword">by</span> viewModel()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_simple)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>by viewModel()</code> å‡½æ•°å…è®¸æˆ‘ä»¬ä»Koinä¸­æ£€ç´¢ä¸€ä¸ªViewModelå®ä¾‹ï¼Œé“¾æ¥åˆ°Android ViewModelFactoryã€‚</p><p><code>getViewModel()</code> å‡½æ•°èƒ½éå»¶è¿Ÿçš„ç›´æ¥æ£€ç´¢ä¸€ä¸ªå®ä¾‹ã€‚</p></blockquote>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Koin/">Koin</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Kotlin/">Kotlin</category>
      
      <category domain="https://www.littlecorgi.top/tags/Koin/">Koin</category>
      
      
      <comments>https://www.littlecorgi.top/posts/6d1e0fe7.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Koin-5-Android_Java</title>
      <link>https://www.littlecorgi.top/posts/e7ad0613.html</link>
      <guid>https://www.littlecorgi.top/posts/e7ad0613.html</guid>
      <pubDate>Wed, 07 Oct 2020 13:23:37 GMT</pubDate>
      
        
        
          
          
      <description></description>
          
        
      
      
      
      <content:encoded><![CDATA[<blockquote><p><a href="https://start.insert-koin.io/#/quickstart/android-java">https://start.insert-koin.io/#/quickstart/android-java</a></p><p>å¼€å§‹</p><ul><li><a href="/posts/fd6f0996.html">Intro(ä»‹ç»)</a></li><li><a href="/posts/b075de90.html">Setup(åˆå§‹åŒ–)</a></li></ul><p>Koin in 5 minutes (5åˆ†é’Ÿå¿«é€Ÿå…¥æ‰‹Koin)</p><ul><li><a href="/posts/f88fedb6.html">Kotlin</a></li><li><a href="/posts/2a806fe1.html">Android</a></li><li><a href="/posts/e7ad0613.html">Android Java</a></li><li><a href="/posts/6d1e0fe7.html">Android ViewModel</a></li></ul><p>Getting Started (å¼€å§‹)</p><ul><li><a href="/posts/c99907a8.html">Starting Koin(å¼€å§‹ä½¿ç”¨Koin)</a></li><li><a href="/posts/d8ca0532.html">Modules &amp; definitions(æ¨¡å—å’Œå®šä¹‰)</a></li><li><a href="/posts/f85e8eae.html">Koin Components(Koinç»„ä»¶)</a></li><li><a href="/posts/63fa5724.html">Testing(æµ‹è¯•)</a></li><li><a href="/posts/ebed2a69.html">Koin for Java</a></li><li><a href="/posts/f5a785d7.html">Koin for Android</a></li></ul></blockquote><h1 id="åœ¨Android-Java-applicationä¸­ä½¿ç”¨"><a href="#åœ¨Android-Java-applicationä¸­ä½¿ç”¨" class="headerlink" title="åœ¨Android Java applicationä¸­ä½¿ç”¨"></a><a href="https://start.insert-koin.io/#/quickstart/android-java?id=getting-started-with-android-java-application">åœ¨Android Java applicationä¸­ä½¿ç”¨</a></h1><blockquote><p>è¿™ä¸ªæ•™ç¨‹å°†ä¼šå‘Šè¯‰ä½ å¦‚ä½•ä½¿ç”¨Koinæ³¨å…¥å’Œæ£€ç´¢ç»„ä»¶æ¥ç¼–å†™ä¸€ä¸ªAndroid Java applicationã€‚</p></blockquote><h2 id="Get-the-code"><a href="#Get-the-code" class="headerlink" title="Get the code"></a><a href="https://start.insert-koin.io/#/quickstart/android-java?id=get-the-code">Get the code</a></h2><p>å¯ä»¥ç›´æ¥åœ¨Githubä¸ŠæŸ¥çœ‹é¡¹ç›®æˆ–è€…ä¸‹è½½zip</p><blockquote><p>ğŸš€ Go to <a href="https://github.com/InsertKoinIO/getting-started-koin-android">Github</a> or <a href="https://github.com/InsertKoinIO/getting-started-koin-android/archive/master.zip">download Zip</a></p></blockquote><h2 id="é…ç½®Gradle"><a href="#é…ç½®Gradle" class="headerlink" title="é…ç½®Gradle"></a><a href="https://start.insert-koin.io/#/quickstart/android-java?id=gradle-setup">é…ç½®Gradle</a></h2><p>é€šè¿‡å¦‚ä¸‹æ–¹å¼æ·»åŠ  Koin Android çš„ä¾èµ–ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Add Jcenter to your repositories if needed</span></span><br><span class="line">repositories &#123;</span><br><span class="line">    jcenter()    </span><br><span class="line">&#125;</span><br><span class="line">dependencies &#123;</span><br><span class="line">    <span class="comment">// Koin for Android</span></span><br><span class="line">    compile <span class="string">&quot;org.koin:koin-android:$koin_version&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æˆ‘ä»¬çš„ç»„ä»¶-Java-amp-Kotlin"><a href="#æˆ‘ä»¬çš„ç»„ä»¶-Java-amp-Kotlin" class="headerlink" title="æˆ‘ä»¬çš„ç»„ä»¶ (Java &amp; Kotlin)"></a><a href="https://start.insert-koin.io/#/quickstart/android-java?id=our-components-java-amp-kotlin">æˆ‘ä»¬çš„ç»„ä»¶ (Java &amp; Kotlin)</a></h2><p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <code>HelloRepository</code> æ¥æä¾›ä¸€äº›æ•°æ®ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">HelloRepository</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">giveHello</span><span class="params">()</span></span>: String</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HelloRepositoryImpl</span>() : HelloRepository &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">giveHello</span><span class="params">()</span></span> = <span class="string">&quot;Hello Koin&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªJava presenterç±»ï¼Œæ¥æ¶ˆè´¹è¿™äº›æ•°æ®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyJavaPresenter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> HelloRepository repository;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyJavaPresenter</span><span class="params">(HelloRepository repository)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.repository = repository;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHello</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">hello</span> <span class="operator">=</span> repository.giveHello();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> hello+<span class="string">&quot; from &quot;</span>+<span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¼–å†™Koin-Module"><a href="#ç¼–å†™Koin-Module" class="headerlink" title="ç¼–å†™Koin Module"></a><a href="https://start.insert-koin.io/#/quickstart/android-java?id=writing-the-koin-module">ç¼–å†™Koin Module</a></h2><p>ä½¿ç”¨ <code>module</code> å‡½æ•°æ¥å£°æ˜ä¸€ä¸ªmoduleã€‚è®©æˆ‘ä»¬æ¥å£°æ˜æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªç»„ä»¶ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> appModule = module &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// single instance of HelloRepository</span></span><br><span class="line">    single&lt;HelloRepository&gt; &#123; HelloRepositoryImpl() &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Simple Presenter Factory</span></span><br><span class="line">    factory &#123; MyJavaPresenter(<span class="keyword">get</span>()) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°† <code>MyJavaPresenter</code> ç±»å£°æ˜æˆ <code>factory</code> æ¥è®©æ¯å½“æˆ‘ä»¬çš„Activityéœ€è¦ä¸€ä¸ªæ—¶å°±åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚</p><h2 id="å¼€å§‹ä½¿ç”¨Koin"><a href="#å¼€å§‹ä½¿ç”¨Koin" class="headerlink" title="å¼€å§‹ä½¿ç”¨Koin"></a><a href="https://start.insert-koin.io/#/quickstart/android-java?id=start-koin">å¼€å§‹ä½¿ç”¨Koin</a></h2><p>ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªmoduleï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨Koinäº†ã€‚æ‰“å¼€ä½ çš„Applicationç±»ï¼Œæˆ–è€…åˆ›å»ºä¸€ä¸ª(ä¸è¦å¿˜äº†åœ¨ä½ çš„Manifest.xmlä¸­å£°æ˜å®ƒ)ã€‚ç„¶ååªéœ€è¦è°ƒç”¨ <code>startKoin()</code> å‡½æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyApplication</span> <span class="keyword">extends</span> <span class="title class_">Application</span> &#123;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate();</span><br><span class="line">        <span class="comment">// Start Koin</span></span><br><span class="line">        <span class="type">KoinApplication</span> <span class="variable">koin</span> <span class="operator">=</span> KoinAndroidApplication.create(<span class="built_in">this</span>)</span><br><span class="line">            .modules(appModule);</span><br><span class="line">        startKoin(<span class="keyword">new</span> <span class="title class_">GlobalContext</span>(), koin);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åœ¨Java-Activityä¸­æ³¨å…¥ä¾èµ–"><a href="#åœ¨Java-Activityä¸­æ³¨å…¥ä¾èµ–" class="headerlink" title="åœ¨Java Activityä¸­æ³¨å…¥ä¾èµ–"></a><a href="https://start.insert-koin.io/#/quickstart/android-java?id=injecting-dependencies-into-java-activity">åœ¨Java Activityä¸­æ³¨å…¥ä¾èµ–</a></h2><p><code>MyJavaPresenter</code> ç»„ä»¶å°†ä¼šè¢«é€šè¿‡ <code>HelloRepository</code> å®ä¾‹æ‰€åˆ›å»ºã€‚ä¸ºäº†åœ¨æˆ‘ä»¬çš„Activityä¸­è·å–åˆ°å®ƒï¼Œå°±éœ€è¦ä½¿ç”¨ <code>by inject()</code> å§”æ‰˜æ³¨å…¥å™¨æ¥æ³¨å…¥å®ƒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// import inject</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.koin.java.standalone.KoinJavaComponent.inject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavaActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Lazy&lt;MySimplePresenter&gt; presenter = inject(MySimplePresenter.class);</span><br><span class="line">    <span class="keyword">private</span> Lazy&lt;MyJavaPresenter&gt; javaPresenter = inject(MyJavaPresenter.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(<span class="meta">@Nullable</span> Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_simple);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>by inject()</code> å‡½æ•°å…è®¸æˆ‘ä»¬åœ¨Androidç»„ä»¶(Activity, fragment, Serviceâ€¦)è¿è¡Œæ—¶å†æ¥æ£€ç´¢Koinå®ä¾‹ã€‚</p><p><code>get()</code> å‡½æ•°åœ¨è¿™å¯ä»¥éå»¶è¿Ÿçš„ç›´æ¥æ£€ç´¢ä¸€ä¸ªå®ä¾‹ã€‚</p></blockquote>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Koin/">Koin</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Kotlin/">Kotlin</category>
      
      <category domain="https://www.littlecorgi.top/tags/Koin/">Koin</category>
      
      
      <comments>https://www.littlecorgi.top/posts/e7ad0613.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Koin-4-Android</title>
      <link>https://www.littlecorgi.top/posts/2a806fe1.html</link>
      <guid>https://www.littlecorgi.top/posts/2a806fe1.html</guid>
      <pubDate>Wed, 07 Oct 2020 13:23:27 GMT</pubDate>
      
        
        
          
          
      <description></description>
          
        
      
      
      
      <content:encoded><![CDATA[<blockquote><p><a href="https://start.insert-koin.io/#/quickstart/android">https://start.insert-koin.io/#/quickstart/android</a></p><p>å¼€å§‹</p><ul><li><a href="/posts/fd6f0996.html">Intro(ä»‹ç»)</a></li><li><a href="/posts/b075de90.html">Setup(åˆå§‹åŒ–)</a></li></ul><p>Koin in 5 minutes (5åˆ†é’Ÿå¿«é€Ÿå…¥æ‰‹Koin)</p><ul><li><a href="/posts/f88fedb6.html">Kotlin</a></li><li><a href="/posts/2a806fe1.html">Android</a></li><li><a href="/posts/e7ad0613.html">Android Java</a></li><li><a href="/posts/6d1e0fe7.html">Android ViewModel</a></li></ul><p>Getting Started (å¼€å§‹)</p><ul><li><a href="/posts/c99907a8.html">Starting Koin(å¼€å§‹ä½¿ç”¨Koin)</a></li><li><a href="/posts/d8ca0532.html">Modules &amp; definitions(æ¨¡å—å’Œå®šä¹‰)</a></li><li><a href="/posts/f85e8eae.html">Koin Components(Koinç»„ä»¶)</a></li><li><a href="/posts/63fa5724.html">Testing(æµ‹è¯•)</a></li><li><a href="/posts/ebed2a69.html">Koin for Java</a></li><li><a href="/posts/f5a785d7.html">Koin for Android</a></li></ul></blockquote><h1 id="åœ¨Android-applicationä¸­ä½¿ç”¨"><a href="#åœ¨Android-applicationä¸­ä½¿ç”¨" class="headerlink" title="åœ¨Android applicationä¸­ä½¿ç”¨"></a><a href="https://start.insert-koin.io/#/quickstart/android?id=getting-started-with-android-application">åœ¨Android applicationä¸­ä½¿ç”¨</a></h1><blockquote><p>è¿™ä¸ªæ•™ç¨‹å°†ä¼šå‘Šè¯‰ä½ å¦‚ä½•ä½¿ç”¨Koinæ³¨å…¥å’Œæ£€ç´¢ç»„ä»¶æ¥ç¼–å†™ä¸€ä¸ªAndroid/Kotlin applicationã€‚</p></blockquote><h2 id="Get-the-code"><a href="#Get-the-code" class="headerlink" title="Get the code"></a><a href="https://start.insert-koin.io/#/quickstart/android?id=get-the-code">Get the code</a></h2><p>å¯ä»¥ç›´æ¥åœ¨Githubä¸ŠæŸ¥çœ‹é¡¹ç›®æˆ–è€…ä¸‹è½½zip</p><blockquote><p>ğŸš€ Go to <a href="https://github.com/InsertKoinIO/getting-started-koin-android">Github</a> or <a href="https://github.com/InsertKoinIO/getting-started-koin-android/archive/master.zip">download Zip</a></p></blockquote><h2 id="é…ç½®Gradle"><a href="#é…ç½®Gradle" class="headerlink" title="é…ç½®Gradle"></a><a href="https://start.insert-koin.io/#/quickstart/android?id=gradle-setup">é…ç½®Gradle</a></h2><p>é€šè¿‡å¦‚ä¸‹æ–¹å¼æ·»åŠ  Koin Android çš„ä¾èµ–ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Add Jcenter to your repositories if needed</span></span><br><span class="line">repositories &#123;</span><br><span class="line">    jcenter()    </span><br><span class="line">&#125;</span><br><span class="line">dependencies &#123;</span><br><span class="line">    <span class="comment">// Koin for Android</span></span><br><span class="line">    compile <span class="string">&quot;org.koin:koin-android:$koin_version&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»„ä»¶"><a href="#ç»„ä»¶" class="headerlink" title="ç»„ä»¶"></a><a href="https://start.insert-koin.io/#/quickstart/android?id=our-components">ç»„ä»¶</a></h2><p>è®©æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ª <code>HelloRepository</code> æ¥æä¾›ä¸€äº›æ•°æ®ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">HelloRepository</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">giveHello</span><span class="params">()</span></span>: String</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HelloRepositoryImpl</span>() : HelloRepository &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">giveHello</span><span class="params">()</span></span> = <span class="string">&quot;Hello Koin&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨åˆ›å»ºä¸€ä¸ªpresenterç±»æ¥æ¶ˆè´¹è¿™ä¸ªæ•°æ®ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MySimplePresenter</span>(<span class="keyword">val</span> repo: HelloRepository) &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">sayHello</span><span class="params">()</span></span> = <span class="string">&quot;<span class="subst">$&#123;repo.giveHello()&#125;</span> from <span class="variable">$this</span>&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¼–å†™Koin-Module"><a href="#ç¼–å†™Koin-Module" class="headerlink" title="ç¼–å†™Koin Module"></a><a href="https://start.insert-koin.io/#/quickstart/android?id=writing-the-koin-module">ç¼–å†™Koin Module</a></h2><p>ä½¿ç”¨ <code>module</code> å‡½æ•°æ¥å£°æ˜ä¸€ä¸ªmoduleï¼Œè®©æˆ‘ä»¬æ¥å£°æ˜æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªç»„ä»¶ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> appModule = module &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// single instance of HelloRepository</span></span><br><span class="line">    single&lt;HelloRepository&gt; &#123; HelloRepositoryImpl() &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Simple Presenter Factory</span></span><br><span class="line">    factory &#123; MySimplePresenter(<span class="keyword">get</span>()) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†æˆ‘ä»¬çš„ <code>MySimplePresenter</code> ç±»å£°æ˜ä¸ºä¸€ä¸ª <code>factory</code> æ¥è®©æ¯å½“æˆ‘ä»¬çš„Activityéœ€è¦ä¸€ä¸ªæ—¶å°±åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚</p><h2 id="å¼€å§‹ä½¿ç”¨Koin"><a href="#å¼€å§‹ä½¿ç”¨Koin" class="headerlink" title="å¼€å§‹ä½¿ç”¨Koin"></a><a href="https://start.insert-koin.io/#/quickstart/android?id=start-koin">å¼€å§‹ä½¿ç”¨Koin</a></h2><p>ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªmoduleï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨Koinäº†ã€‚æ‰“å¼€ä½ çš„Applicationç±»ï¼Œæˆ–è€…åˆ›å»ºä¸€ä¸ª(ä¸è¦å¿˜äº†åœ¨ä½ çš„Manifest.xmlä¸­å£°æ˜å®ƒ)ã€‚ç„¶ååªéœ€è¦è°ƒç”¨ <code>startKoin()</code> å‡½æ•°ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyApplication</span> : <span class="type">Application</span>()&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate()</span><br><span class="line">        <span class="comment">// Start Koin</span></span><br><span class="line">        startKoin&#123;</span><br><span class="line">            androidLogger()</span><br><span class="line">            androidContext(<span class="keyword">this</span><span class="symbol">@MyApplication</span>)</span><br><span class="line">            modules(appModule)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ³¨å…¥ä¾èµ–"><a href="#æ³¨å…¥ä¾èµ–" class="headerlink" title="æ³¨å…¥ä¾èµ–"></a><a href="https://start.insert-koin.io/#/quickstart/android?id=injecting-dependencies">æ³¨å…¥ä¾èµ–</a></h2><p><code>MySimplePresenter</code> ç»„ä»¶å°†ä¼šè¢«é€šè¿‡ <code>HelloRepository</code> å®ä¾‹æ‰€åˆ›å»ºã€‚ä¸ºäº†åœ¨æˆ‘ä»¬çš„Activityä¸­è·å–åˆ°å®ƒï¼Œå°±éœ€è¦ä½¿ç”¨ <code>by inject()</code> å§”æ‰˜æ³¨å…¥å™¨æ¥æ³¨å…¥å®ƒï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MySimpleActivity</span> : <span class="type">AppCompatActivity</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Lazy injected MySimplePresenter</span></span><br><span class="line">    <span class="keyword">val</span> firstPresenter: MySimplePresenter <span class="keyword">by</span> inject()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>by inject()</code> å‡½æ•°å…è®¸æˆ‘ä»¬åœ¨Androidç»„ä»¶(Activity, fragment, Serviceâ€¦)è¿è¡Œæ—¶å†æ¥æ£€ç´¢Koinå®ä¾‹ã€‚</p><p><code>get()</code> å‡½æ•°åœ¨è¿™å¯ä»¥éå»¶è¿Ÿçš„ç›´æ¥æ£€ç´¢ä¸€ä¸ªå®ä¾‹ã€‚</p></blockquote>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Koin/">Koin</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Kotlin/">Kotlin</category>
      
      <category domain="https://www.littlecorgi.top/tags/Koin/">Koin</category>
      
      
      <comments>https://www.littlecorgi.top/posts/2a806fe1.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Koin-3-Kotlin</title>
      <link>https://www.littlecorgi.top/posts/f88fedb6.html</link>
      <guid>https://www.littlecorgi.top/posts/f88fedb6.html</guid>
      <pubDate>Wed, 07 Oct 2020 13:23:21 GMT</pubDate>
      
        
        
          
          
      <description></description>
          
        
      
      
      
      <content:encoded><![CDATA[<blockquote><p><a href="https://start.insert-koin.io/#/quickstart/kotlin?id=getting-started-with-kotlin-app">https://start.insert-koin.io/#/quickstart/kotlin?id=getting-started-with-kotlin-app</a></p><p>å¼€å§‹</p><ul><li><a href="/posts/fd6f0996.html">Intro(ä»‹ç»)</a></li><li><a href="/posts/b075de90.html">Setup(åˆå§‹åŒ–)</a></li></ul><p>Koin in 5 minutes (5åˆ†é’Ÿå¿«é€Ÿå…¥æ‰‹Koin)</p><ul><li><a href="/posts/f88fedb6.html">Kotlin</a></li><li><a href="/posts/2a806fe1.html">Android</a></li><li><a href="/posts/e7ad0613.html">Android Java</a></li><li><a href="/posts/6d1e0fe7.html">Android ViewModel</a></li></ul><p>Getting Started (å¼€å§‹)</p><ul><li><a href="/posts/c99907a8.html">Starting Koin(å¼€å§‹ä½¿ç”¨Koin)</a></li><li><a href="/posts/d8ca0532.html">Modules &amp; definitions(æ¨¡å—å’Œå®šä¹‰)</a></li><li><a href="/posts/f85e8eae.html">Koin Components(Koinç»„ä»¶)</a></li><li><a href="/posts/63fa5724.html">Testing(æµ‹è¯•)</a></li><li><a href="/posts/ebed2a69.html">Koin for Java</a></li><li><a href="/posts/f5a785d7.html">Koin for Android</a></li></ul></blockquote><h1 id="åœ¨Kotlin-appä¸­ä½¿ç”¨"><a href="#åœ¨Kotlin-appä¸­ä½¿ç”¨" class="headerlink" title="åœ¨Kotlin appä¸­ä½¿ç”¨"></a><a href="https://start.insert-koin.io/#/quickstart/kotlin?id=getting-started-with-kotlin-app">åœ¨Kotlin appä¸­ä½¿ç”¨</a></h1><blockquote><p>æœ¬æ•™ç¨‹å°†ä¼šå‘Šè¯‰ä½ å¦‚ä½•ä½¿ç”¨Koinæ³¨å…¥å’Œæ£€ç´¢ç»„ä»¶æ¥ç¼–å†™ä¸€ä¸ªKotlin appã€‚</p></blockquote><h2 id="è·å–å®ä¾‹ä»£ç "><a href="#è·å–å®ä¾‹ä»£ç " class="headerlink" title="è·å–å®ä¾‹ä»£ç "></a><a href="https://start.insert-koin.io/#/quickstart/kotlin?id=get-the-code">è·å–å®ä¾‹ä»£ç </a></h2><p>å¯ä»¥ç›´æ¥åœ¨Githubä¸ŠæŸ¥çœ‹é¡¹ç›®æˆ–è€…ä¸‹è½½zip</p><blockquote><p>ğŸš€ Go to <a href="https://github.com/InsertKoinIO/getting-started-koin-core">Github</a> or <a href="https://github.com/InsertKoinIO/getting-started-koin-core/archive/master.zip">download Zip</a></p></blockquote><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a><a href="https://start.insert-koin.io/#/quickstart/kotlin?id=setup">é…ç½®</a></h2><p>é¦–å…ˆï¼Œæ£€æŸ¥ä¸‹ <code>koin-core</code> ä¾èµ–æ˜¯ä¸æ˜¯æŒ‰ç…§å¦‚ä¸‹å½¢å¼æ·»åŠ äº†ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Add Jcenter to your repositories if needed</span></span><br><span class="line">repositories &#123;</span><br><span class="line">    jcenter()    </span><br><span class="line">&#125;</span><br><span class="line">dependencies &#123;</span><br><span class="line">    <span class="comment">// Koin for Kotlin apps</span></span><br><span class="line">    compile <span class="string">&quot;org.koin:koin-core:$koin_version&quot;</span></span><br><span class="line">    <span class="comment">// Testing</span></span><br><span class="line">    testCompile <span class="string">&quot;org.koin:koin-test:$koin_version&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Application"><a href="#Application" class="headerlink" title="Application"></a><a href="https://start.insert-koin.io/#/quickstart/kotlin?id=the-application">Application</a></h2><p>åœ¨æˆ‘ä»¬çš„å°å‹Appä¸Šï¼Œæˆ‘ä»¬åªéœ€è¦æœ‰2ä¸ªç»„ä»¶ï¼š</p><ul><li>HelloMessageData - æŒæœ‰æ•°æ®(data)</li><li>HelloService - ä½¿ç”¨å’Œæ˜¾ç¤ºHelloMessageDataä¸Šçš„æ•°æ®</li><li>HelloApplication - æ£€ç´¢å’Œä½¿ç”¨HelloService</li></ul><h3 id="Data-holder"><a href="#Data-holder" class="headerlink" title="Data holder"></a><a href="https://start.insert-koin.io/#/quickstart/kotlin?id=data-holder">Data holder</a></h3><p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <code>HelloMessageData</code> æ•°æ®ç±»æ¥æŒæœ‰æˆ‘ä»¬çš„æ•°æ®ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A class to hold our message data</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">HelloMessageData</span>(<span class="keyword">val</span> message : String = <span class="string">&quot;Hello Koin!&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a><a href="https://start.insert-koin.io/#/quickstart/kotlin?id=service">Service</a></h3><p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªserviceæ¥æ˜¾ç¤º <code>HelloMessageData</code> ä¸­çš„æ•°æ®ã€‚å†™ä¸€ä¸ª <code>HelloServiceImpl</code> ç±»ä»¥åŠä»–çš„æ¥å£ <code>HelloService</code> ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Hello Service - interface</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">HelloService</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">hello</span><span class="params">()</span></span>: String</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Hello Service Impl</span></span><br><span class="line"><span class="comment"> * Will use HelloMessageData data</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HelloServiceImpl</span>(<span class="keyword">private</span> <span class="keyword">val</span> helloMessageData: HelloMessageData) : HelloService &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">hello</span><span class="params">()</span></span> = <span class="string">&quot;Hey, <span class="subst">$&#123;helloMessageData.message&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="The-application-class"><a href="#The-application-class" class="headerlink" title="The application class"></a><a href="https://start.insert-koin.io/#/quickstart/kotlin?id=the-application-class">The application class</a></h2><p>ä¸ºäº†è®©HelloServiceç»„ä»¶èƒ½è¿è¡Œï¼Œæˆ‘ä»¬è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªruntimeç»„ä»¶ã€‚</p><p>è®©æˆ‘ä»¬å†™ä¸€ä¸ª <code>HelloApplication</code> ç±»å¹¶è®©ä»–å®ç° <code>KoinComponent</code> æ¥å£ã€‚è¿™èƒ½è®©æˆ‘ä»¬ç¨åå¯ä»¥é€šè¿‡ <code>by inject()</code> å‡½æ•°æ¥æ£€ç´¢æˆ‘ä»¬çš„ç»„ä»¶ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * HelloApplication - Application Class</span></span><br><span class="line"><span class="comment"> * use HelloService</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HelloApplication</span> : <span class="type">KoinComponent</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Inject HelloService</span></span><br><span class="line">    <span class="keyword">val</span> helloService <span class="keyword">by</span> inject&lt;HelloService&gt;()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// display our data</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">sayHello</span><span class="params">()</span></span> = println(helloService.hello())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å£°æ˜ä¾èµ–"><a href="#å£°æ˜ä¾èµ–" class="headerlink" title="å£°æ˜ä¾èµ–"></a><a href="https://start.insert-koin.io/#/quickstart/kotlin?id=declaring-dependencies">å£°æ˜ä¾èµ–</a></h2><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨Koin moduleæ¥å°† <code>HelloMessageData</code> å’Œ <code>HelloService</code> ç»„è£…åœ¨ä¸€èµ·ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> helloModule = module &#123;</span><br><span class="line"></span><br><span class="line">    single &#123; HelloMessageData() &#125;</span><br><span class="line"></span><br><span class="line">    single &#123; HelloServiceImpl(<span class="keyword">get</span>()) <span class="keyword">as</span> HelloService &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä½¿ç”¨ <code>single</code> æ¥å°†æ¯ä¸€ä¸ªç»„ä»¶å£°æ˜æˆå•ä¾‹å¯¹è±¡ã€‚</p><ul><li><code>single &#123; HelloMessageData() &#125;</code> : å£°æ˜ä¸€ä¸ªå•ä¾‹çš„ <code>HelloMessageData</code> å¯¹è±¡</li><li><code>single &#123; HelloServiceImpl(get()) as HelloService &#125;</code> : ä½¿ç”¨æ³¨å…¥çš„ <code>HelloMessageData</code> æ¥æ„é€ <code>HelloServiceImpl</code> å¯¹è±¡ï¼Œå¹¶å£°æ˜æˆ <code>HelloService</code> çš„å•ä¾‹å¯¹è±¡ã€‚</li></ul><h2 id="è¿™å°±å®Œæˆå•¦ï¼"><a href="#è¿™å°±å®Œæˆå•¦ï¼" class="headerlink" title="è¿™å°±å®Œæˆå•¦ï¼"></a><a href="https://start.insert-koin.io/#/quickstart/kotlin?id=thats-it">è¿™å°±å®Œæˆå•¦ï¼</a></h2><p>åªéœ€è¦é€šè¿‡ä¸€ä¸ª <code>main</code> å‡½æ•°æ¥å¯åŠ¨æˆ‘ä»¬çš„appï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(<span class="keyword">vararg</span> args: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    startKoin &#123;</span><br><span class="line">        <span class="comment">// use Koin logger</span></span><br><span class="line">        printLogger()</span><br><span class="line">        <span class="comment">// declare modules</span></span><br><span class="line">        modules(helloModule)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    HelloApplication().sayHello()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Koin/">Koin</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Kotlin/">Kotlin</category>
      
      <category domain="https://www.littlecorgi.top/tags/Koin/">Koin</category>
      
      
      <comments>https://www.littlecorgi.top/posts/f88fedb6.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Koin-2-Setup(åˆå§‹åŒ–)</title>
      <link>https://www.littlecorgi.top/posts/b075de90.html</link>
      <guid>https://www.littlecorgi.top/posts/b075de90.html</guid>
      <pubDate>Wed, 07 Oct 2020 13:23:05 GMT</pubDate>
      
        
        
          
          
      <description></description>
          
        
      
      
      
      <content:encoded><![CDATA[<blockquote><p><a href="https://start.insert-koin.io/#/setup/index">https://start.insert-koin.io/#/setup/index</a></p><p>å¼€å§‹</p><ul><li><a href="/posts/fd6f0996.html">Intro(ä»‹ç»)</a></li><li><a href="/posts/b075de90.html">Setup(åˆå§‹åŒ–)</a></li></ul><p>Koin in 5 minutes (5åˆ†é’Ÿå¿«é€Ÿå…¥æ‰‹Koin)</p><ul><li><a href="/posts/f88fedb6.html">Kotlin</a></li><li><a href="/posts/2a806fe1.html">Android</a></li><li><a href="/posts/e7ad0613.html">Android Java</a></li><li><a href="/posts/6d1e0fe7.html">Android ViewModel</a></li></ul><p>Getting Started (å¼€å§‹)</p><ul><li><a href="/posts/c99907a8.html">Starting Koin(å¼€å§‹ä½¿ç”¨Koin)</a></li><li><a href="/posts/d8ca0532.html">Modules &amp; definitions(æ¨¡å—å’Œå®šä¹‰)</a></li><li><a href="/posts/f85e8eae.html">Koin Components(Koinç»„ä»¶)</a></li><li><a href="/posts/63fa5724.html">Testing(æµ‹è¯•)</a></li><li><a href="/posts/ebed2a69.html">Koin for Java</a></li><li><a href="/posts/f5a785d7.html">Koin for Android</a></li></ul></blockquote><h1 id="ä¸ºæ‚¨çš„é¡¹ç›®é…ç½®Koin"><a href="#ä¸ºæ‚¨çš„é¡¹ç›®é…ç½®Koin" class="headerlink" title="ä¸ºæ‚¨çš„é¡¹ç›®é…ç½®Koin"></a>ä¸ºæ‚¨çš„é¡¹ç›®é…ç½®Koin</h1><h3 id="æœ€æ–°ç‰ˆæœ¬"><a href="#æœ€æ–°ç‰ˆæœ¬" class="headerlink" title="æœ€æ–°ç‰ˆæœ¬"></a><a href="https://start.insert-koin.io/#/setup/index?id=current-version">æœ€æ–°ç‰ˆæœ¬</a></h3><p>Koinçš„æœ€æ–°ç‰ˆæœ¬ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœ€æ–°çš„stableç‰ˆæœ¬</span></span><br><span class="line">koin_version= <span class="string">&quot;2.1.6&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ€æ–°çš„unstableç‰ˆæœ¬</span></span><br><span class="line">koin_version= <span class="string">&quot;2.2.0-rc-1&quot;</span></span><br></pre></td></tr></table></figure><h3 id="Gradle-ä¾èµ–"><a href="#Gradle-ä¾èµ–" class="headerlink" title="Gradle ä¾èµ–"></a><a href="https://start.insert-koin.io/#/setup/index?id=gradle-dependencies">Gradle ä¾èµ–</a></h3><p>æ·»åŠ ä¸‹é¢è¿™äº›Gradleä¾èµ–æ¥å°†Koinæ·»åŠ åˆ°æ‚¨çš„é¡¹ç›®ä¸­ï¼š</p><blockquote><p>Koinå·²ç»åœ¨Jcenterä¸Šå‘å¸ƒ</p></blockquote><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Add Jcenter to your repositories if needed</span></span><br><span class="line">repositories &#123;</span><br><span class="line">    jcenter()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Kotlin</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Koin for Kotlin</span></span><br><span class="line">implementation <span class="string">&quot;org.koin:koin-core:$koin_version&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Koin Extended &amp; experimental features</span></span><br><span class="line">implementation <span class="string">&quot;org.koin:koin-core-ext:$koin_version&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Koin for Unit tests</span></span><br><span class="line">testImplementation <span class="string">&quot;org.koin:koin-test:$koin_version&quot;</span></span><br></pre></td></tr></table></figure><p>Gradle Plugin</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath <span class="string">&quot;org.koin:koin-gradle-plugin:$koin_version&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">apply <span class="attr">plugin:</span> <span class="string">&#x27;koin&#x27;</span></span><br></pre></td></tr></table></figure><p>Android</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Koin for Android</span></span><br><span class="line">implementation <span class="string">&quot;org.koin:koin-android:$koin_version&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Koin Android Scope feature</span></span><br><span class="line">implementation <span class="string">&quot;org.koin:koin-android-scope:$koin_version&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Koin Android ViewModel feature</span></span><br><span class="line">implementation <span class="string">&quot;org.koin:koin-android-viewmodel:$koin_version&quot;</span></span><br></pre></td></tr></table></figure><p>AndroidX</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Koin AndroidX Scope feature</span></span><br><span class="line">implementation <span class="string">&quot;org.koin:koin-androidx-scope:$koin_version&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Koin AndroidX ViewModel feature</span></span><br><span class="line">implementation <span class="string">&quot;org.koin:koin-androidx-viewmodel:$koin_version&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Koin AndroidX Fragment Factory</span></span><br><span class="line">implementation <span class="string">&quot;org.koin:koin-androidx-fragment:$koin_version&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Koin AndroidX Work Manager (unstable version)</span></span><br><span class="line">implementation <span class="string">&quot;org.koin:koin-androidx-workmanager:$koin_version&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Koin AndroidX Compose (unstable version)</span></span><br><span class="line">implementation <span class="string">&quot;org.koin:koin-androidx-compose:$koin_version&quot;</span></span><br></pre></td></tr></table></figure><p>Ktor</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Koin for Ktor Kotlin</span></span><br><span class="line">implementation <span class="string">&quot;org.koin:koin-ktor:$koin_version&quot;</span></span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Koin/">Koin</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Kotlin/">Kotlin</category>
      
      <category domain="https://www.littlecorgi.top/tags/Koin/">Koin</category>
      
      
      <comments>https://www.littlecorgi.top/posts/b075de90.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Koin-1-Intro(ä»‹ç»)</title>
      <link>https://www.littlecorgi.top/posts/fd6f0996.html</link>
      <guid>https://www.littlecorgi.top/posts/fd6f0996.html</guid>
      <pubDate>Wed, 07 Oct 2020 13:22:45 GMT</pubDate>
      
        
        
          
          
      <description></description>
          
        
      
      
      
      <content:encoded><![CDATA[<blockquote><p><a href="https://start.insert-koin.io/#/introduction">https://start.insert-koin.io/#/introduction</a></p><p>å¼€å§‹</p><ul><li><a href="/posts/fd6f0996.html">Intro(ä»‹ç»)</a></li><li><a href="/posts/b075de90.html">Setup(åˆå§‹åŒ–)</a></li></ul><p>Koin in 5 minutes (5åˆ†é’Ÿå¿«é€Ÿå…¥æ‰‹Koin)</p><ul><li><a href="/posts/f88fedb6.html">Kotlin</a></li><li><a href="/posts/2a806fe1.html">Android</a></li><li><a href="/posts/e7ad0613.html">Android Java</a></li><li><a href="/posts/6d1e0fe7.html">Android ViewModel</a></li></ul><p>Getting Started (å¼€å§‹)</p><ul><li><a href="/posts/c99907a8.html">Starting Koin(å¼€å§‹ä½¿ç”¨Koin)</a></li><li><a href="/posts/d8ca0532.html">Modules &amp; definitions(æ¨¡å—å’Œå®šä¹‰)</a></li><li><a href="/posts/f85e8eae.html">Koin Components(Koinç»„ä»¶)</a></li><li><a href="/posts/63fa5724.html">Testing(æµ‹è¯•)</a></li><li><a href="/posts/ebed2a69.html">Koin for Java</a></li><li><a href="/posts/f5a785d7.html">Koin for Android</a></li></ul></blockquote><h2 id="KOINæ˜¯ä»€ä¹ˆ"><a href="#KOINæ˜¯ä»€ä¹ˆ" class="headerlink" title="KOINæ˜¯ä»€ä¹ˆ?"></a><a href="https://start.insert-koin.io/#/introduction?id=what-is-koin">KOINæ˜¯ä»€ä¹ˆ?</a></h2><p>ç»™Kotlinå¼€å‘è€…çš„ä¸€ä¸ªå®ç”¨çš„è½»é‡çº§çš„Kotlinä¾èµ–æ³¨å…¥æ¡†æ¶ã€‚</p><p>ç”¨çº¯Kotlinç¼–å†™ï¼Œä»…ä½¿ç”¨å‡½æ•°æ¥è§£å†³ï¼šæ— ä»£ç†ï¼Œæ— ä»£ç ç”Ÿæˆï¼Œæ— åå°„ã€‚</p><p><code>Koin is a DSL, a light container and a pragmatic API</code></p><h3 id="æœ€æ–°æ¶ˆæ¯-ğŸŒ"><a href="#æœ€æ–°æ¶ˆæ¯-ğŸŒ" class="headerlink" title="æœ€æ–°æ¶ˆæ¯ ğŸŒ"></a><a href="https://start.insert-koin.io/#/introduction?id=latest-news-ğŸŒ">æœ€æ–°æ¶ˆæ¯ ğŸŒ</a></h3><ul><li>åœ¨Twitterä¸ŠFollow usæ¥è·å–æœ€æ–°æ¶ˆæ¯: <a href="https://twitter.com/insertkoin_io">@insertkoin_io</a></li><li>Koin developers on Medium: <a href="https://medium.com/koin-developers">koin developers hub</a></li></ul><h3 id="è·å–å¸®åŠ©-ğŸš’"><a href="#è·å–å¸®åŠ©-ğŸš’" class="headerlink" title="è·å–å¸®åŠ© ğŸš’"></a><a href="https://start.insert-koin.io/#/introduction?id=getting-help-ğŸš’">è·å–å¸®åŠ© ğŸš’</a></h3><p>å…³äºKoinä½¿ç”¨çš„ä»»ä½•é—®é¢˜</p><ul><li>åœ¨slackä¸Šå’Œæˆ‘ä»¬è®¨è®º <a href="https://kotlinlang.slack.com/?redir=%2Fmessages%2Fkoin">#koin channel</a></li><li>åœ¨ <a href="https://stackoverflow.com/questions/tagged/koin">Stackoverflow - #koin tag</a> ä¸Šå‘æˆ‘ä»¬æé—®</li></ul><h3 id="æäº¤-issues-ğŸ› "><a href="#æäº¤-issues-ğŸ› " class="headerlink" title="æäº¤ issues ğŸ› "></a><a href="https://start.insert-koin.io/#/introduction?id=reporting-issues-ğŸ› ">æäº¤ issues ğŸ› </a></h3><p>å‘ç°äº†ä¸€ä¸ªbugæˆ–è€…é—®é¢˜ï¼Ÿåœ¨<a href="https://github.com/InsertKoinIO/koin/issues">Github issues</a>ä¸Šå¼€å¯ä¸€ä¸ªissue</p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Koin/">Koin</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Kotlin/">Kotlin</category>
      
      <category domain="https://www.littlecorgi.top/tags/Koin/">Koin</category>
      
      
      <comments>https://www.littlecorgi.top/posts/fd6f0996.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Jetpackæºç  ä¹‹ ViewModel</title>
      <link>https://www.littlecorgi.top/posts/b309316d.html</link>
      <guid>https://www.littlecorgi.top/posts/b309316d.html</guid>
      <pubDate>Thu, 10 Sep 2020 03:23:56 GMT</pubDate>
      
        
        
          
          
      <description></description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="0-å‰è¨€"><a href="#0-å‰è¨€" class="headerlink" title="0. å‰è¨€"></a>0. å‰è¨€</h1><p>ViewModelä½œä¸ºMVVMä¸­æœ€é‡è¦çš„ä¸€å±‚ï¼Œä»–çš„ä½œç”¨å°±æ˜¯å¯¹æ•°æ®çŠ¶æ€çš„æŒæœ‰ä¸ç»´æŠ¤ã€‚</p><p>æ ¹æ®æºç é‡Œé¢çš„æ³¨é‡Šï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå®ƒåœ¨Androidä¸­äº‹å®ä¸Šæ˜¯ä¸ºäº†è§£å†³ä¸€ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li>UIç»„ä»¶é—´å®ç°æ•°æ®å…±äº«</li><li>Activityé…ç½®æ›´æ”¹é‡å»ºæ—¶ä¿ç•™æ•°æ®</li></ul><p>å¯¹äºç¬¬ä¸€æ¡ï¼Œå¦‚æœä¸åŒVMï¼Œé‚£ä¹ˆå„ä¸ªUIç»„ä»¶éƒ½éœ€è¦æŒæœ‰å…±äº«æ•°æ®çš„å¼•ç”¨ï¼Œè¿™æ ·ä¼šå¸¦æ¥ä¸¤ä¸ªéº»çƒ¦ï¼š</p><ul><li>å¦‚æœæ–°å¢å…±äº«æ•°æ®ï¼Œåˆ™å„ä¸ªUIç»„ä»¶éœ€è¦å†æ¬¡å£°æ˜å¹¶åˆå§‹åŒ–æ–°å¢çš„å…±äº«æ•°æ®</li><li>æŸä¸ªç»„ä»¶å¯¹äºæ•°æ®çš„ä¿®æ”¹ï¼Œæ²¡åŠæ³•ç›´æ¥é€šçŸ¥å…¶ä»–UIç»„ä»¶ï¼Œéœ€æ‰‹åŠ¨å®ç°è§‚å¯Ÿè€…æ¨¡å¼</li></ul><p>å¯¹äºç¬¬äºŒæ¡ï¼Œå¦‚æœä¸ä½¿ç”¨VMï¼Œé‚£ä¹ˆè¿˜æ˜¯å¯ä»¥é€šè¿‡onSaveInstanceStateä¿å­˜çš„ï¼Œä½†æ˜¯å¦‚æœæ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œæ•°æ®çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–éƒ½ä¼šäº§ç”Ÿä¸€å®šçš„æ€§èƒ½å¼€é”€ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬çœ‹ViewModelçš„æºç ï¼Œå°±éœ€è¦ä»è¿™ä¸¤ä¸ªé—®é¢˜å…¥æ‰‹ï¼š</p><ul><li>ViewModelæ˜¯å¦‚ä½•è§£å†³UIç»„ä»¶é—´å…±äº«æ•°æ®çš„</li><li>ViewModelæ˜¯æ€ä¹ˆè§£å†³é‡å»ºæ—¶ä¿ç•™æ•°æ®çš„</li></ul><h1 id="1-ViewModelæ˜¯ä»€ä¹ˆ"><a href="#1-ViewModelæ˜¯ä»€ä¹ˆ" class="headerlink" title="1. ViewModelæ˜¯ä»€ä¹ˆ"></a>1. ViewModelæ˜¯ä»€ä¹ˆ</h1><p>æˆ‘ä»¬ç›´æ¥çœ‹ä¸‹æºç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">ViewModel</span> &#123;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; mBagOfTags = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// ç”¨äºæ ‡è®°å½“å‰ViewModelæ˜¯å¦å·²ç»ä¸å†è¢«ä½¿ç”¨</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">mCleared</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™ä¸ªæ–¹æ³•ä¼šåœ¨ViewModelä¸å†è¢«ä½¿ç”¨å¹¶ä¸”å³å°†è¢«é”€æ¯æ—¶è°ƒç”¨</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;WeakerAccess&quot;)</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCleared</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ³¨é‡Šé‡Œé¢å†™åˆ°ï¼š</span></span><br><span class="line">    <span class="comment">//   ç”±äºclear()æ–¹æ³•æ˜¯finalçš„ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•ä»ç„¶ä¼šè¢«åœ¨æ¨¡æ‹Ÿå¯¹è±¡ä¸­è¢«è°ƒç”¨ï¼Œ</span></span><br><span class="line">    <span class="comment">//   å¹¶ä¸”åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒmBagOfTagsä¸ºnull</span></span><br><span class="line">    <span class="meta">@MainThread</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line">        mCleared = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (mBagOfTags != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (mBagOfTags) &#123;</span><br><span class="line">                <span class="keyword">for</span> (Object value : mBagOfTags.values()) &#123;</span><br><span class="line">                    closeWithRuntimeException(value);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        onCleared();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    &lt;T&gt; T <span class="title function_">setTagIfAbsent</span><span class="params">(String key, T newValue)</span> &#123;</span><br><span class="line">        T previous;</span><br><span class="line">        <span class="comment">// å½“å½“å‰keyä¸å­˜åœ¨æ—¶æ‰å°†æ•°æ®ä¿å­˜è¿›å»</span></span><br><span class="line">        <span class="comment">// ç±»ä¼¼äºConcurrentHashMapçš„ putIfAbsent()</span></span><br><span class="line">        <span class="keyword">synchronized</span> (mBagOfTags) &#123;</span><br><span class="line">            previous = (T) mBagOfTags.get(key);</span><br><span class="line">            <span class="keyword">if</span> (previous == <span class="literal">null</span>) &#123;</span><br><span class="line">                mBagOfTags.put(key, newValue);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">T</span> <span class="variable">result</span> <span class="operator">=</span> previous == <span class="literal">null</span> ? newValue : previous;</span><br><span class="line">        <span class="comment">// å½“mClearedæ—¶ï¼Œå¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">if</span> (mCleared) &#123;</span><br><span class="line">            closeWithRuntimeException(result);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@SuppressWarnings(&#123;&quot;TypeParameterUnusedInFormals&quot;, &quot;unchecked&quot;&#125;)</span></span><br><span class="line">    &lt;T&gt; T <span class="title function_">getTag</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (mBagOfTags == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">synchronized</span> (mBagOfTags) &#123;</span><br><span class="line">            <span class="keyword">return</span> (T) mBagOfTags.get(key);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨äºå…³é—­</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">closeWithRuntimeException</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Closeable) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                ((Closeable) obj).close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ä¸Šé¢åŸºæœ¬ä¸Šå¯¹ViewModelè¿™ä¸ªæŠ½è±¡ç±»æœ‰äº†ä¸€ä¸ªå¤§è‡´çš„äº†è§£ï¼Œé‚£æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸‹ViewModelæ˜¯å¦‚ä½•è¢«åˆ›å»ºçš„ã€‚</p><h1 id="2-ViewModelçš„åˆ›å»º"><a href="#2-ViewModelçš„åˆ›å»º" class="headerlink" title="2. ViewModelçš„åˆ›å»º"></a>2. ViewModelçš„åˆ›å»º</h1><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½ä¼šé€šè¿‡è¿™ä¸ªä»£ç åˆ›å»ºViewModelï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mViewModel = ViewModelProvider(<span class="keyword">this</span>).<span class="keyword">get</span>(MvvmViewModel::<span class="keyword">class</span>.java)</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œçš„thisè¦æ±‚ä¼ å…¥ViewModelStoreOwnerï¼Œä¸€èˆ¬æˆ‘ä»¬çš„Activityå’ŒFragmentéƒ½å®ç°äº†è¿™ä¸ªæ¥å£ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹è¿™ä¸ªViewModelProviderçš„æ„é€ æ–¹æ³•ï¼š</p><h2 id="2-1-ViewModelProvider"><a href="#2-1-ViewModelProvider" class="headerlink" title="2.1 ViewModelProvider"></a>2.1 ViewModelProvider</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ViewModelProvider</span><span class="params">(<span class="meta">@NonNull</span> ViewModelStoreOwner owner)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>(owner.getViewModelStore(), owner <span class="keyword">instanceof</span> HasDefaultViewModelProviderFactory</span><br><span class="line">            ? ((HasDefaultViewModelProviderFactory) owner).getDefaultViewModelProviderFactory()</span><br><span class="line">            : NewInstanceFactory.getInstance());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ViewModelProvider</span><span class="params">(<span class="meta">@NonNull</span> ViewModelStoreOwner owner, <span class="meta">@NonNull</span> Factory factory)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>(owner.getViewModelStore(), factory);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ViewModelProvider</span><span class="params">(<span class="meta">@NonNull</span> ViewModelStore store, <span class="meta">@NonNull</span> Factory factory)</span> &#123;</span><br><span class="line">    mFactory = factory;</span><br><span class="line">    mViewModelStore = store;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ³¨é‡Š1ï¼šComponentActivity # getDefaultViewModelProviderFactory()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> ViewModelProvider.Factory <span class="title function_">getDefaultViewModelProviderFactory</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (getApplication() == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Your activity is not yet attached to the &quot;</span></span><br><span class="line">                + <span class="string">&quot;Application instance. You can&#x27;t request ViewModel before onCreate call.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mDefaultFactory == <span class="literal">null</span>) &#123;</span><br><span class="line">        mDefaultFactory = <span class="keyword">new</span> <span class="title class_">SavedStateViewModelFactory</span>(</span><br><span class="line">                getApplication(),</span><br><span class="line">                <span class="built_in">this</span>,</span><br><span class="line">                getIntent() != <span class="literal">null</span> ? getIntent().getExtras() : <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mDefaultFactory;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ³¨é‡Š2ï¼šFragment # getDefaultViewModelProviderFactory()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> ViewModelProvider.Factory <span class="title function_">getDefaultViewModelProviderFactory</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (mFragmentManager == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Can&#x27;t access ViewModels from detached fragment&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mDefaultFactory == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">Application</span> <span class="variable">application</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Context</span> <span class="variable">appContext</span> <span class="operator">=</span> requireContext().getApplicationContext();</span><br><span class="line">        <span class="keyword">while</span> (appContext <span class="keyword">instanceof</span> ContextWrapper) &#123;</span><br><span class="line">            <span class="keyword">if</span> (appContext <span class="keyword">instanceof</span> Application) &#123;</span><br><span class="line">                application = (Application) appContext;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            appContext = ((ContextWrapper) appContext).getBaseContext();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (application == <span class="literal">null</span> &amp;&amp; FragmentManager.isLoggingEnabled(Log.DEBUG)) &#123;</span><br><span class="line">            Log.d(FragmentManager.TAG, <span class="string">&quot;Could not find Application instance from &quot;</span></span><br><span class="line">                    + <span class="string">&quot;Context &quot;</span> + requireContext().getApplicationContext() + <span class="string">&quot;, you will &quot;</span></span><br><span class="line">                    + <span class="string">&quot;not be able to use AndroidViewModel with the default &quot;</span></span><br><span class="line">                    + <span class="string">&quot;ViewModelProvider.Factory&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        mDefaultFactory = <span class="keyword">new</span> <span class="title class_">SavedStateViewModelFactory</span>(</span><br><span class="line">                application,</span><br><span class="line">                <span class="built_in">this</span>,</span><br><span class="line">                getArguments());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mDefaultFactory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è°ƒç”¨çš„æ˜¯ç¬¬ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸­è°ƒç”¨äº†ç¬¬ä¸‰ä¸ªæ„é€ æ–¹æ³•ï¼Œç„¶åé€šè¿‡<code>getViewModelStore()</code>è·å–åˆ°äº†ViewModelStoreï¼Œå¹¶åˆ¤æ–­æˆ‘ä»¬è¿™ä¸ª<code>owner</code>æ˜¯ä¸æ˜¯HasDefaultViewModelProviderFactoryå­ç±»ï¼Œå¦‚æœæ˜¯å°±è°ƒç”¨HasDefaultViewModelProviderFactoryçš„<code>getDefaultViewModelProviderFactory()</code>å¦åˆ™è°ƒç”¨<code>NewInstanceFactory.getInstance()</code>ã€‚</p><blockquote><p>è¿™å—è¿˜æ˜¯åˆ«çœ‹AndroidStudioè‡ªå¸¦çš„SDKçš„æºç äº†ï¼Œè¿™ä¸ªæ—¶å€™æœ€æ–°çš„æºç æ˜¯API30ï¼Œä½†æ˜¯ComponentActivityå¹¶æ²¡æœ‰å®ç°HasDefaultViewModelProviderFactoryï¼Œè€Œä»<a href="https://github.com/androidx/androidx/blob/androidx-master-dev/activity/activity/src/main/java/androidx/activity/ComponentActivity.java">å®˜æ–¹Github</a>çœ‹åˆ°çš„æºç æ˜¯å·²ç»å®ç°äº†çš„ã€‚</p></blockquote><p>è€Œæˆ‘ä»¬çš„Activityå’ŒFragmentéƒ½æ˜¯å®ç°äº†è¿™ä¸ªæ¥å£çš„ã€‚<br>ä»–ä»¬çš„<code>getDefaultViewModelProviderFactory()</code>æœ€åéƒ½åˆ›å»ºäº†è¿™æ ·ä¸€ä¸ªä¸œè¥¿ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mDefaultFactory = <span class="keyword">new</span> <span class="title class_">SavedStateViewModelFactory</span>(</span><br><span class="line">        getApplication(),</span><br><span class="line">        <span class="built_in">this</span>,</span><br><span class="line">        getIntent() != <span class="literal">null</span> ? getIntent().getExtras() : <span class="literal">null</span>);</span><br></pre></td></tr></table></figure></p><p>é‚£æˆ‘ä»¬å†æ¥çœ‹ä¸‹<code>get()</code>æ–¹æ³•ï¼š</p><h2 id="2-1-ViewModelProvider-get"><a href="#2-1-ViewModelProvider-get" class="headerlink" title="2.1 ViewModelProvider # get()"></a>2.1 ViewModelProvider # get()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="keyword">public</span> &lt;T <span class="keyword">extends</span> <span class="title class_">ViewModel</span>&gt; T <span class="title function_">get</span><span class="params">(<span class="meta">@NonNull</span> Class&lt;T&gt; modelClass)</span> &#123;</span><br><span class="line">    <span class="comment">// é€šè¿‡Classè·å–åˆ°ä»–çš„ç±»å</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">canonicalName</span> <span class="operator">=</span> modelClass.getCanonicalName();</span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰åå­—ï¼Œåˆ™è¯æ˜æ˜¯å±€éƒ¨å†…éƒ¨ç±»æˆ–è€…åŒ¿åå†…éƒ¨ç±»ï¼Œåˆ™æŠ›å¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">if</span> (canonicalName == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Local and anonymous classes can not be ViewModels&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> get(DEFAULT_KEY + <span class="string">&quot;:&quot;</span> + canonicalName, modelClass);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="keyword">public</span> &lt;T <span class="keyword">extends</span> <span class="title class_">ViewModel</span>&gt; T <span class="title function_">get</span><span class="params">(<span class="meta">@NonNull</span> String key, <span class="meta">@NonNull</span> Class&lt;T&gt; modelClass)</span> &#123;</span><br><span class="line">    <span class="comment">// ä»ViewModelStoreä¸­å–å€¼ï¼Œåˆšå¼€å§‹æ˜¯å–ä¸åˆ°çš„ï¼Œå› ä¸ºæ²¡æœ‰å­˜å†…å®¹</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯å·²ç»è°ƒç”¨è¿‡getæ–¹æ³•åå†è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ—¶å€™æ˜¯èƒ½å–å‡ºå€¼çš„</span></span><br><span class="line">    <span class="type">ViewModel</span> <span class="variable">viewModel</span> <span class="operator">=</span> mViewModelStore.get(key);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å› ä¸ºç¬¬ä¸€æ¬¡è¿›å…¥è¿˜æ²¡æœ‰å€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å–å‡ºçš„æ˜¯nullï¼ŒisInstanceä¹Ÿå°±è¿”å›falseäº†</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯å·²ç»è¢«ç¼“å­˜ä¹‹åå†è°ƒç”¨çš„è¿™ä¸ªå°±èƒ½å–å‡ºå€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ä¸€èˆ¬è¿”å›true</span></span><br><span class="line">    <span class="keyword">if</span> (modelClass.isInstance(viewModel)) &#123;</span><br><span class="line">        <span class="comment">// SavedStateViewModelFactoryæ˜¯OnRequeryFactoryçš„å­™ç±»(å­ç±»çš„å­ç±»)</span></span><br><span class="line">        <span class="comment">// æ‰€ä»¥è¿”å›trueï¼Œè¿›å…¥if</span></span><br><span class="line">        <span class="keyword">if</span> (mFactory <span class="keyword">instanceof</span> OnRequeryFactory) &#123;</span><br><span class="line">            <span class="comment">// è·å–åˆ°ViewModel</span></span><br><span class="line">            ((OnRequeryFactory) mFactory).onRequery(viewModel);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (T) viewModel;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//noinspection StatementWithEmptyBody</span></span><br><span class="line">        <span class="keyword">if</span> (viewModel != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> log a warning.</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mFactory <span class="keyword">instanceof</span> KeyedFactory) &#123;</span><br><span class="line">        viewModel = ((KeyedFactory) (mFactory)).create(key, modelClass);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// createæ–¹æ³•ä¸­é€šè¿‡åå°„çš„newInstanceå»åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">        <span class="comment">// -&gt;&gt; æ³¨é‡Š1</span></span><br><span class="line">        viewModel = (mFactory).create(modelClass);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å­˜èµ·æ¥</span></span><br><span class="line">    mViewModelStore.put(key, viewModel);</span><br><span class="line">    <span class="keyword">return</span> (T) viewModel;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ³¨é‡Š1ï¼šNewInstanceFactory # create()</span></span><br><span class="line"><span class="comment"> * ä½œç”¨ï¼šé€šè¿‡åå°„å»åˆ›å»ºå¯¹è±¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> &lt;T <span class="keyword">extends</span> <span class="title class_">ViewModel</span>&gt; T <span class="title function_">create</span><span class="params">(<span class="meta">@NonNull</span> Class&lt;T&gt; modelClass)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> modelClass.newInstance();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Cannot create an instance of &quot;</span> + modelClass, e);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Cannot create an instance of &quot;</span> + modelClass, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°è¿™å—ï¼Œæˆ‘ä»¬çš„åˆ›å»ºViewModelå°±è¯´å®Œäº†ï¼Œæœ€åæ€»ç»“ä¸‹ï¼š</p><ul><li>ViewModelStoreæ˜¯ç”¨æ¥ä¿å­˜ViewModelå¯¹è±¡çš„HashMapï¼ŒActivityå’ŒFragmentéƒ½ä¼šæ„é€ è¿™ä¸ªçš„å¯¹è±¡ï¼›</li><li>ViewModelProviderä¸­ä¼šé€šè¿‡<code>get()</code>æ–¹æ³•åˆ›å»ºä¸€ä¸ªViewModelï¼Œåˆ›å»ºä¹‹å‰ä¼šæ£€æµ‹ViewModelStoreä¸­æœ‰æ²¡æœ‰ç¼“å­˜äº†çš„ï¼Œå¦‚æœæœ‰ç›´æ¥è¿”å›ï¼Œæ²¡æœ‰å°±é€šè¿‡åå°„å»åˆ›å»ºã€‚</li></ul><h1 id="3-é‡å»ºæ—¶å¦‚ä½•ä¿è¯ViewModelä¸ä¼šé‡å»º"><a href="#3-é‡å»ºæ—¶å¦‚ä½•ä¿è¯ViewModelä¸ä¼šé‡å»º" class="headerlink" title="3. é‡å»ºæ—¶å¦‚ä½•ä¿è¯ViewModelä¸ä¼šé‡å»º"></a>3. é‡å»ºæ—¶å¦‚ä½•ä¿è¯ViewModelä¸ä¼šé‡å»º</h1><p>äº†è§£åˆ°VieModelçš„åˆ›å»ºåï¼Œæˆ‘ä»¬ç°åœ¨æ¥çœ‹ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šViewModelæ˜¯æ€ä¹ˆè§£å†³é‡å»ºæ—¶ä¿ç•™æ•°æ®çš„ï¼Ÿ</p><p>æˆ‘ä»¬å›é¡¾ä¸‹åˆšåˆšåˆ›å»ºçš„ViewModelçš„æµç¨‹ï¼Œåœ¨<code>get()</code>æ–¹æ³•ä¸­ä¸»è¦æ˜¯é€šè¿‡ViewModelStoreæ¥å¸®æˆ‘ä»¬ä¿å­˜ViewModelçš„ï¼Œé‚£ä¹ˆViewModelStoreæ˜¯æ€ä¹ˆåˆ›å»ºçš„ï¼Ÿ</p><h2 id="3-1-ViewModelStoreçš„åˆ›å»º"><a href="#3-1-ViewModelStoreçš„åˆ›å»º" class="headerlink" title="3.1 ViewModelStoreçš„åˆ›å»º"></a>3.1 ViewModelStoreçš„åˆ›å»º</h2><h3 id="3-1-1-Activityä¸­"><a href="#3-1-1-Activityä¸­" class="headerlink" title="3.1.1 Activityä¸­"></a>3.1.1 Activityä¸­</h3><p>åœ¨ComponentActivityä¸­æœ‰<code>getViewModelStore()</code>è¿™æ ·çš„ä¸€ä¸ªæ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ViewModelStore <span class="title function_">getViewModelStore</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (getApplication() == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Your activity is not yet attached to the &quot;</span></span><br><span class="line">                + <span class="string">&quot;Application instance. You can&#x27;t request ViewModel before onCreate call.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mViewModelStore == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">NonConfigurationInstances</span> <span class="variable">nc</span> <span class="operator">=</span></span><br><span class="line">                (NonConfigurationInstances) getLastNonConfigurationInstance();</span><br><span class="line">        <span class="keyword">if</span> (nc != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// é€šè¿‡NonConfigurationInstancesè·å–åˆ°ViewModelStore</span></span><br><span class="line">            mViewModelStore = nc.viewModelStore;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœè·å–ä¸åˆ°ï¼Œåˆ™æ–°å»ºä¸€ä¸ªViewmodelStore</span></span><br><span class="line">        <span class="keyword">if</span> (mViewModelStore == <span class="literal">null</span>) &#123;</span><br><span class="line">            mViewModelStore = <span class="keyword">new</span> <span class="title class_">ViewModelStore</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mViewModelStore;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™å—å°±æ¶‰åŠåˆ°äº†ä¸€ä¸ªNonConfigurationInstancesï¼Œè€Œç†Ÿæ‚‰Activityé‡å»ºæœºåˆ¶çš„å°ä¼™ä¼´åº”è¯¥ä¼šå¾ˆç†Ÿæ‚‰è¿™ä¸ªï¼Œè¿™ä¸ªå°±æ˜¯ä¸æˆ‘ä»¬çš„é‡å»ºæœºåˆ¶æœ‰å…³ã€‚</p><p>å½“æˆ‘ä»¬éœ€è¦é‡å»ºActivityçš„æ—¶å€™ï¼Œé™¤äº†é€šè¿‡<code>onSaveInstanceState()</code>ä¿å­˜æ•°æ®ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡<code>onRetainNonConfigurationInstance()</code>è¿™ä¸ªæ–¹æ³•ï¼š</p><h4 id="ComponentActivity-onRetainNonConfigurationInstance"><a href="#ComponentActivity-onRetainNonConfigurationInstance" class="headerlink" title="ComponentActivity # onRetainNonConfigurationInstance()"></a>ComponentActivity # onRetainNonConfigurationInstance()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title function_">onRetainNonConfigurationInstance</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">custom</span> <span class="operator">=</span> onRetainCustomNonConfigurationInstance();</span><br><span class="line"></span><br><span class="line">    <span class="type">ViewModelStore</span> <span class="variable">viewModelStore</span> <span class="operator">=</span> mViewModelStore;</span><br><span class="line">    <span class="keyword">if</span> (viewModelStore == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ˜¯nullï¼Œè¯´æ˜ä»¥å‰æ²¡æœ‰è°ƒç”¨è¿‡ getViewModelStore()æ–¹æ³•,</span></span><br><span class="line">        <span class="comment">// ä¹Ÿå°±æ˜¯æ²¡æœ‰è°ƒç”¨è¿‡ViewModelProvider(requireActivity()).get(DemoViewModel::class.java)çš„æ–¹æ³•æ¥è·å–ViewModelã€‚</span></span><br><span class="line">        <span class="comment">// æ‰€ä»¥æˆ‘ä»¬çœ‹ä¸€ä¸‹æœ€åä¸€ä¸ªçš„NonConfigurationInstanceé‡Œé¢æ˜¯å¦å­˜åœ¨viewModelStore</span></span><br><span class="line">        <span class="type">NonConfigurationInstances</span> <span class="variable">nc</span> <span class="operator">=</span></span><br><span class="line">                (NonConfigurationInstances) getLastNonConfigurationInstance();</span><br><span class="line">        <span class="comment">// å¦‚æœnc ä¸ç­‰äºnullï¼Œå°±è¯æ˜ä»¥å‰å­˜å‚¨è¿‡ï¼Œæ‰€ä»¥ä»è¿™é‡Œå–å‡ºæ¥</span></span><br><span class="line">        <span class="keyword">if</span> (nc != <span class="literal">null</span>) &#123;</span><br><span class="line">            viewModelStore = nc.viewModelStore;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (viewModelStore == <span class="literal">null</span> &amp;&amp; custom == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœviewModelStoreä¸æ˜¯nullï¼Œä¹Ÿå°±æ˜¯è¯´æœ€åä¸€ä¸ªNonConfigurationInstanceé‡Œé¢æœ‰å€¼ï¼Œç›´æ¥newå‡ºæ¥NonConfigurationInstanceså¹¶èµ‹å€¼ï¼Œè¿”å›å‡ºå»</span></span><br><span class="line">    <span class="type">NonConfigurationInstances</span> <span class="variable">nci</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NonConfigurationInstances</span>();</span><br><span class="line">    nci.custom = custom;</span><br><span class="line">    nci.viewModelStore = viewModelStore;</span><br><span class="line">    <span class="keyword">return</span> nci;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é‚£ä¹ˆonRetainNonConfigurationInstance-ä»€ä¹ˆæ—¶å€™å›è¢«è°ƒç”¨å‘¢"><a href="#é‚£ä¹ˆonRetainNonConfigurationInstance-ä»€ä¹ˆæ—¶å€™å›è¢«è°ƒç”¨å‘¢" class="headerlink" title="é‚£ä¹ˆonRetainNonConfigurationInstance()ä»€ä¹ˆæ—¶å€™å›è¢«è°ƒç”¨å‘¢"></a>é‚£ä¹ˆonRetainNonConfigurationInstance()ä»€ä¹ˆæ—¶å€™å›è¢«è°ƒç”¨å‘¢</h4><p>åœ¨Activityçš„å¯åŠ¨æµç¨‹ä¸­ï¼Œå½“ActivityThreadæ‰§è¡Œåˆ°<code>performDestroyActivity()</code>è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œå°±ä¼šè°ƒç”¨Activityçš„<code>retainNonConfigurationInstances()</code>æ–¹æ³•å°†ä¿å­˜çš„æ•°æ®ä¿å­˜åˆ°ActivityClientRecordä¸­ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">NonConfigurationInstances <span class="title function_">retainNonConfigurationInstances</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨äº† onRetainNonConfigurationInstance() è·å–åˆ° NonConfigurationInstances</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">activity</span> <span class="operator">=</span> onRetainNonConfigurationInstance();</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="type">NonConfigurationInstances</span> <span class="variable">nci</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NonConfigurationInstances</span>();</span><br><span class="line">    nci.activity = activity;</span><br><span class="line">    nci.children = children;</span><br><span class="line">    nci.fragments = fragments;</span><br><span class="line">    nci.loaders = loaders;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> nci;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å¯ä»¥çœ‹åˆ°ä»–å…ˆè°ƒç”¨<code>onRetainNonConfigurationInstance()</code>è·å–åˆ°ComponentActivityè¿”å›æ¥çš„<code>nci</code>ï¼Œç„¶åç”±æ„å»ºäº†ä¸€ä¸ª<code>nci</code>ï¼Œå¹¶å°†ä¹‹å‰ComponentActivityçš„é‚£ä¸ª<code>nci</code>ä¿å­˜åˆ°äº†è¿™ä¸ª<code>nci</code>çš„<code>activity</code>ä¸­ã€‚</p><h4 id="ActivityThread-performDestroyActivity-ä¿å­˜nci"><a href="#ActivityThread-performDestroyActivity-ä¿å­˜nci" class="headerlink" title="ActivityThread # performDestroyActivity() ä¿å­˜nci"></a>ActivityThread # performDestroyActivity() ä¿å­˜nci</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">ActivityClientRecord <span class="title function_">performDestroyActivity</span><span class="params">(IBinder token, <span class="type">boolean</span> finishing,</span></span><br><span class="line"><span class="params">        <span class="type">int</span> configChanges, <span class="type">boolean</span> getNonConfigInstance, String reason)</span> &#123;</span><br><span class="line">    <span class="type">ActivityClientRecord</span> <span class="variable">r</span> <span class="operator">=</span> mActivities.get(token);</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">if</span> (r != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">if</span> (getNonConfigInstance) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                r.lastNonConfigurationInstances</span><br><span class="line">                        = r.activity.retainNonConfigurationInstances();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!mInstrumentation.onException(r.activity, e)) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(</span><br><span class="line">                            <span class="string">&quot;Unable to retain activity &quot;</span></span><br><span class="line">                            + r.intent.getComponent().toShortString()</span><br><span class="line">                            + <span class="string">&quot;: &quot;</span> + e.toString(), e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é‚£ä¹ˆä»€ä¹ˆæ—¶å€™æ¢å¤å‘¢"><a href="#é‚£ä¹ˆä»€ä¹ˆæ—¶å€™æ¢å¤å‘¢" class="headerlink" title="é‚£ä¹ˆä»€ä¹ˆæ—¶å€™æ¢å¤å‘¢"></a>é‚£ä¹ˆä»€ä¹ˆæ—¶å€™æ¢å¤å‘¢</h4><p>å½“é¡µé¢é‡æ„å®Œæˆï¼Œå°±ä¼šè°ƒç”¨ActivityThreadçš„<code>performLaunchActivity()</code>ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Activity <span class="title function_">performLaunchActivity</span><span class="params">(ActivityClientRecord r, Intent customIntent)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">            activity.attach(appContext, <span class="built_in">this</span>, getInstrumentation(), r.token,</span><br><span class="line">                    r.ident, app, r.intent, r.activityInfo, title, r.parent,</span><br><span class="line">                    r.embeddedID, r.lastNonConfigurationInstances, config,</span><br><span class="line">                    r.referrer, r.voiceInteractor, window, r.configCallback,</span><br><span class="line">                    r.assistToken);</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> activity;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="Activity-attach"><a href="#Activity-attach" class="headerlink" title="Activity # attach()"></a>Activity # attach()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">attach</span><span class="params">(Context context, ActivityThread aThread,</span></span><br><span class="line"><span class="params">        Instrumentation instr, IBinder token, <span class="type">int</span> ident,</span></span><br><span class="line"><span class="params">        Application application, Intent intent, ActivityInfo info,</span></span><br><span class="line"><span class="params">        CharSequence title, Activity parent, String id,</span></span><br><span class="line"><span class="params">        NonConfigurationInstances lastNonConfigurationInstances,</span></span><br><span class="line"><span class="params">        Configuration config, String referrer, IVoiceInteractor voiceInteractor,</span></span><br><span class="line"><span class="params">        Window window, ActivityConfigCallback activityConfigCallback, IBinder assistToken)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    mLastNonConfigurationInstances = lastNonConfigurationInstances;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å—å°±å°†å€¼èµ‹ç»™äº†Activityçš„<code>mLastNonConfigurationInstances</code>ã€‚</p><p>ç„¶åæˆ‘ä»¬åœ¨å›åˆ°3.1.1èŠ‚çš„<code>getViewModelStore()</code>æ–¹æ³•ä¸­ï¼Œå¦‚æœè°ƒç”¨<code>getLastNonConfigurationInstance()</code>è¿”å›çš„<code>nc</code>ä¸ä¸ºnullçš„è¯ï¼Œå°±ç›´æ¥å–å‡ºä»–çš„<code>viewModelStore</code>ï¼Œè¿™æ ·æˆ‘ä»¬ä¸å°±å®ç°äº†Activityé‡å»ºä½†æ˜¯ViewModelä»ç„¶ä¸ä¼šé‡å»ºçš„é—®é¢˜å˜›ã€‚</p><h3 id="3-1-2-Fragmentä¸­"><a href="#3-1-2-Fragmentä¸­" class="headerlink" title="3.1.2 Fragmentä¸­"></a>3.1.2 Fragmentä¸­</h3><p>ä¸€æ ·çš„ï¼Œä¹Ÿæ¥çœ‹ä¸‹Fragmentçš„<code>getViewModelStore()</code>æ–¹æ³•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ViewModelStore <span class="title function_">getViewModelStore</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (mFragmentManager == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Can&#x27;t access ViewModels from detached fragment&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mFragmentManager.getViewModelStore(<span class="built_in">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°ä»–é‡Œé¢è°ƒç”¨äº†FragmentManagerçš„<code>getViewModelStore()</code>æ–¹æ³•:</p><h4 id="FragmentManagerImpl-getViewModelStore"><a href="#FragmentManagerImpl-getViewModelStore" class="headerlink" title="FragmentManagerImpl # getViewModelStore()"></a>FragmentManagerImpl # getViewModelStore()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ViewModelStore <span class="title function_">getViewModelStore</span><span class="params">(<span class="meta">@NonNull</span> Fragment f)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> mNonConfig.getViewModelStore(f);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé¢ç›´æ¥è°ƒç”¨äº†mNonConfigçš„getViewModelStoreæ–¹æ³•ã€‚</p><p>é‚£ä¹ˆè¿™ä¸ªmNonConfigæ˜¯ä¸ªå•¥å‘¢ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> FragmentManagerViewModel mNonConfig;</span><br></pre></td></tr></table></figure><p>å°±æ˜¯ä¸€ä¸ªFragmentManagerViewModelï¼Œé‚£ä¹ˆä»–æ˜¯åœ¨å“ªèµ‹å€¼çš„ï¼š</p><h4 id="FragmentManagerImpl-attachController"><a href="#FragmentManagerImpl-attachController" class="headerlink" title="FragmentManagerImpl # attachController()"></a>FragmentManagerImpl # attachController()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">attachController</span><span class="params">(<span class="meta">@NonNull</span> FragmentHostCallback host,</span></span><br><span class="line"><span class="params">        <span class="meta">@NonNull</span> FragmentContainer container, <span class="meta">@Nullable</span> <span class="keyword">final</span> Fragment parent)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// å½“parentä¸ä¸ºnullæ—¶ï¼Œå°±è·å–åˆ°ä»–çš„FragmentManagerçš„getChildNonConfig</span></span><br><span class="line">    <span class="keyword">if</span> (parent != <span class="literal">null</span>) &#123;</span><br><span class="line">        mNonConfig = parent.mFragmentManager.getChildNonConfig(parent);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (host <span class="keyword">instanceof</span> ViewModelStoreOwner) &#123;</span><br><span class="line">        <span class="comment">// ä¸€èˆ¬éƒ½ä¼šè¿›å…¥åˆ°è¿™ä¸ªåˆ†æ”¯ä¸­ï¼Œæ‰§è¡Œä¸‹é¢ä»£ç </span></span><br><span class="line">        <span class="type">ViewModelStore</span> <span class="variable">viewModelStore</span> <span class="operator">=</span> ((ViewModelStoreOwner) host).getViewModelStore();</span><br><span class="line">        mNonConfig = FragmentManagerViewModel.getInstance(viewModelStore);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        mNonConfig = <span class="keyword">new</span> <span class="title class_">FragmentManagerViewModel</span>(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•ä¸­å°±æ˜¯æ ¹æ®ä¸åŒçš„åˆ†æ”¯è¿”å›ä¸åŒçš„mNonConfigï¼Œè€Œè¿™ä¸ªæ–¹æ³•åˆ™ä¼šè¢«FragmentControllerçš„attachHostè°ƒç”¨:</p><h4 id="FragmentController-attachHost"><a href="#FragmentController-attachHost" class="headerlink" title="FragmentController # attachHost()"></a>FragmentController # attachHost()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">attachHost</span><span class="params">(<span class="meta">@Nullable</span> Fragment parent)</span> &#123;</span><br><span class="line">    mHost.mFragmentManager.attachController(</span><br><span class="line">            mHost, mHost <span class="comment">/*container*/</span>, parent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œè¿™ä¸ªæ–¹æ³•æ¥ç€ä¼šè¢«FragmetActivityä¸­çš„onCreateè°ƒç”¨ã€‚</p><h4 id="FragmentActivity-onCreate"><a href="#FragmentActivity-onCreate" class="headerlink" title="FragmentActivity # onCreate()"></a>FragmentActivity # onCreate()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(<span class="meta">@Nullable</span> Bundle savedInstanceState)</span> &#123;</span><br><span class="line">    mFragments.attachHost(<span class="literal">null</span> <span class="comment">/*parent*/</span>);</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€ŒattachHostä¸­çš„é‚£ä¸ªhoståˆ™æ˜¯åœ¨FragmentControlleræ„é€ æ–¹æ³•ä¸­ä¼ å…¥çš„ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="title function_">FragmentController</span><span class="params">(FragmentHostCallback&lt;?&gt; callbacks)</span> &#123;</span><br><span class="line">    mHost = callbacks;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> FragmentController <span class="title function_">createController</span><span class="params">(<span class="meta">@NonNull</span> FragmentHostCallback&lt;?&gt; callbacks)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FragmentController</span>(checkNotNull(callbacks, <span class="string">&quot;callbacks == null&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="type">FragmentController</span> <span class="variable">mFragments</span> <span class="operator">=</span> FragmentController.createController(<span class="keyword">new</span> <span class="title class_">HostCallbacks</span>());</span><br></pre></td></tr></table></figure></p><p>è€Œè¿™ä¸ªHostCallbacksåˆ™å®ç°äº†ViewModelStoreOwnerï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">HostCallbacks</span> <span class="keyword">extends</span> <span class="title class_">FragmentHostCallback</span>&lt;FragmentActivity&gt; <span class="keyword">implements</span></span><br><span class="line">        <span class="title class_">ViewModelStoreOwner</span>,</span><br><span class="line">        OnBackPressedDispatcherOwner &#123;</span><br></pre></td></tr></table></figure></p><h1 id="4-UIç»„ä»¶é—´æ•°æ®å…±äº«"><a href="#4-UIç»„ä»¶é—´æ•°æ®å…±äº«" class="headerlink" title="4. UIç»„ä»¶é—´æ•°æ®å…±äº«"></a>4. UIç»„ä»¶é—´æ•°æ®å…±äº«</h1><p>åªè¦æˆ‘ä»¬åœ¨è°ƒç”¨<code>ViewModelProvider(this).get(MvvmViewModel::class.java)</code>æ—¶ä¼ å…¥çš„thisæ˜¯åŒä¸€ä¸ªï¼Œé‚£ä¹ˆå°±èƒ½è·å–åˆ°åŒä¸€ä¸ªViewModelStoreï¼Œå¯¹åº”çš„è¿”å›çš„ViewModelä¹Ÿæ˜¯åŒä¸€ä¸ªäº†ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Android/">Android</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Jetpack/">Jetpack</category>
      
      <category domain="https://www.littlecorgi.top/tags/MVVM/">MVVM</category>
      
      <category domain="https://www.littlecorgi.top/tags/ViewModel/">ViewModel</category>
      
      
      <comments>https://www.littlecorgi.top/posts/b309316d.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Jetpackæºç  ä¹‹ LiveData</title>
      <link>https://www.littlecorgi.top/posts/28011e4e.html</link>
      <guid>https://www.littlecorgi.top/posts/28011e4e.html</guid>
      <pubDate>Sat, 22 Aug 2020 08:24:50 GMT</pubDate>
      
      <description>LiveDataæ˜¯Jetpackä¸­ä¸€ä¸ªå“åº”å¼å¼€å‘æ¡†æ¶ï¼Œå®˜æ–¹æ–‡æ¡£å¯¹å®ƒçš„è¯´æ˜æ˜¯ä¸€ç§å¯è§‚å¯Ÿçš„æ•°æ®å­˜å‚¨å™¨ç±»ï¼Œå…·æœ‰ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥èƒ½åŠ›ã€‚æœ‰ç‚¹ç±»ä¼¼äºæ„ŸçŸ¥ç”Ÿå‘½å‘¨æœŸçš„RxJavaã€‚</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="Jetpackæºç -ä¹‹-LiveData"><a href="#Jetpackæºç -ä¹‹-LiveData" class="headerlink" title="Jetpackæºç  ä¹‹ LiveData"></a>Jetpackæºç  ä¹‹ LiveData</h1><h1 id="0-å‰è¨€"><a href="#0-å‰è¨€" class="headerlink" title="0. å‰è¨€"></a>0. å‰è¨€</h1><p>LiveDataæ˜¯Jetpackä¸­ä¸€ä¸ªå“åº”å¼å¼€å‘æ¡†æ¶ï¼Œå®˜æ–¹æ–‡æ¡£å¯¹å®ƒçš„è¯´æ˜æ˜¯ä¸€ç§å¯è§‚å¯Ÿçš„æ•°æ®å­˜å‚¨å™¨ç±»ï¼Œå…·æœ‰ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥èƒ½åŠ›ã€‚æœ‰ç‚¹ç±»ä¼¼äºæ„ŸçŸ¥ç”Ÿå‘½å‘¨æœŸçš„RxJavaã€‚</p><h2 id="0-1-ç”¨æ³•"><a href="#0-1-ç”¨æ³•" class="headerlink" title="0.1 ç”¨æ³•"></a>0.1 ç”¨æ³•</h2><p>é€šå¸¸LiveDataéƒ½æ˜¯ç»“åˆç€ViewModelä½¿ç”¨çš„ï¼Œä¸€èˆ¬éƒ½æ˜¯åœ¨ViewModelä¸­åˆ›å»ºLiveDataï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MvvmViewModel</span> : <span class="type">ViewModel</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡MutableLiveDataåˆ›å»ºä¸€ä¸ªå¯è¯»å¯å†™çš„LiveData</span></span><br><span class="line">    <span class="comment">// è®¾ç½®ä¸ºPrivateï¼Œé¿å…å¤–éƒ¨å¯¹æ•°æ®ç›´æ¥è¿›è¡Œä¿®æ”¹ï¼Œå¹¶æš´éœ²å¯¹å¤–æ¥å£ï¼Œè®©å¤–éƒ¨é€šè¿‡æ¥å£æ¥ä¿®æ”¹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> _count = MutableLiveData(<span class="number">0</span>)</span><br><span class="line">    <span class="comment">// æš´éœ²ç»™å¤–éƒ¨ä¸€ä¸ªåªè¯»çš„LiveDataå‰¯æœ¬ï¼Œè®©å¤–éƒ¨ç›‘å¬æ•°æ®é€šè¿‡æ­¤LiveDataç›‘å¬</span></span><br><span class="line">    <span class="keyword">val</span> count: LiveData&lt;<span class="built_in">Int</span>&gt;</span><br><span class="line">        <span class="keyword">get</span>() = _count</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">increaseCount</span><span class="params">()</span></span> &#123;</span><br><span class="line">        _count.value = _count.value?.plus(<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">clearCount</span><span class="params">()</span></span> &#123;</span><br><span class="line">        _count.value = <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="0-2-æºç "><a href="#0-2-æºç " class="headerlink" title="0.2 æºç "></a>0.2 æºç </h2><p>LiveDataæºç å…¶å®æŒºç®€å•çš„ï¼Œä½†æ˜¯åœ¨çœ‹ä»–çš„æºç ä¹‹å‰å¾—å…ˆäº†è§£Lifecycleçš„æºç ï¼Œå› ä¸ºLiveDataå…¶å®æ˜¯å¤§é‡é€šè¿‡Lifecycleå®ç°çš„ã€‚å…³äºLifecycleçš„æºç æˆ‘ä»¬ä¹‹å‰çœ‹è¿‡äº†ï¼Œæ‰€ä»¥æ­¤ç¯‡åšå®¢ä¸ä¼šè®¨è®ºLifecycleçš„ç›¸å…³é—®é¢˜ã€‚</p><p>æˆ‘ä»¬åœ¨é˜…è¯»æºç å‰ï¼Œé¦–å…ˆå¾—æ¸…é™¤æˆ‘ä»¬éœ€è¦ä»æºç é‡Œé¢ææ‡‚å“ªäº›é—®é¢˜ï¼š</p><ol><li>é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨ç”¨æ³•ä¸Šæœ‰MutableLiveDataå’ŒLiveDataï¼Œ é‚£ä¹ˆä»–ä»¬çš„åŒºåˆ«æ˜¯å•¥</li><li>å®˜æ–¹ç»™LiveDataå®šä¹‰æ˜¯ä¸€ä¸ªå¯è¢«è§‚å¯Ÿçš„æ•°æ®å­˜å‚¨ç±»ï¼Œé‚£ä¹ˆä»–çš„å¯è¢«è§‚å¯Ÿæ˜¯æ€ä¹ˆå®ç°çš„</li><li>å®˜æ–¹è¿˜è¯´ä»–æ˜¯ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥çš„ï¼Œé‚£ä¹ˆæ˜¯æ€ä¹ˆå®ç°çš„</li></ol><p>å¸¦ç€è¿™ä¸‰ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ¥çœ‹æºç ï¼š</p><h1 id="1-MutableLiveData"><a href="#1-MutableLiveData" class="headerlink" title="1. MutableLiveData"></a>1. MutableLiveData</h1><p>è¿™ä¸ªç±»æ˜¯æˆ‘ä»¬ç”¨æ¥å¯è¯»å¯å†™çš„LiveDataï¼Œæˆ‘ä»¬å¯¹å€¼çš„ä¿®æ”¹éƒ½æ˜¯é€šè¿‡è¿™ä¸ªç±»çš„ï¼Œé‚£æˆ‘ä»¬æ¥çœ‹ä¸‹ä»–çš„æºç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MutableLiveData</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">LiveData</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MutableLiveData</span><span class="params">(T value)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(value);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    MutableLiveData() &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postValue</span><span class="params">(T value)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.postValue(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(T value)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.setValue(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æºç å°±è¿™ä¹ˆç‚¹ï¼Œå…¨æ˜¯è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼Œè€Œä»–çš„çˆ¶ç±»å°±æ˜¯LiveDataç±»ã€‚<br>é‚£ä¹ˆæ—¢ç„¶è¿™äº›æ–¹æ³•éƒ½æ˜¯è°ƒç”¨çš„LiveDataçš„ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸ç›´æ¥ä½¿ç”¨LiveDataè€Œè¦å»ä½¿ç”¨MutableLiveDataå‘¢ï¼Ÿ</p><p>å½“ä½ çœ‹åˆ°LiveDataæºç æ—¶å°±èƒ½çŸ¥é“ï¼ŒLiveDataè™½ç„¶æœ‰è¿™äº›æ–¹æ³•ï¼Œä½†æ˜¯ä»–æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæ²¡åŠæ³•ç›´æ¥æ„é€ å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦é€šè¿‡MutableLiveDataæ¥æ“ä½œã€‚<br>åŒæ—¶ï¼ŒLiveDataçš„<code>setValue()</code>å’Œ<code>postValue()</code>æ–¹æ³•éƒ½æ˜¯è¢«protectedä¿®é¥°çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å¤–éƒ¨å¹¶æ²¡æœ‰åŠæ³•ç›´æ¥è®¿é—®åˆ°ï¼Œè€ŒMutableLiveDataçš„è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯publicçš„ï¼Œæ‰€ä»¥å¯ä»¥åœ¨å¤–éƒ¨ç›´æ¥è°ƒç”¨ã€‚</p><h1 id="2-LiveData"><a href="#2-LiveData" class="headerlink" title="2. LiveData"></a>2. LiveData</h1><h2 id="2-1-åŸºæœ¬å±æ€§"><a href="#2-1-åŸºæœ¬å±æ€§" class="headerlink" title="2.1 åŸºæœ¬å±æ€§"></a>2.1 åŸºæœ¬å±æ€§</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">LiveData</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="comment">// æ•°æ®é”ï¼Œé€šè¿‡Synchronizedçº¿ç¨‹åŒæ­¥</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;WeakerAccess&quot;)</span> <span class="comment">/* synthetic access */</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">mDataLock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="comment">// LiveDataçš„åˆå§‹åŒ–ç‰ˆæœ¬</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ„é€ æ–¹æ³•ä¸­æ²¡æœ‰ç»™å€¼ï¼Œé‚£ä¹ˆ mVersion ç›´æ¥ä½¿ç”¨æ­¤å€¼</span></span><br><span class="line">    <span class="comment">// å¦‚æœç»™å€¼ï¼Œé‚£ä¹ˆ mVersion=START_VERSION+1</span></span><br><span class="line">    <span class="comment">// è§ä¸‹é¢æ„é€ æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">START_VERSION</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">    <span class="comment">// mDataçš„é»˜è®¤å€¼</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ„é€ æ–¹æ³•ä¼ å€¼ï¼Œé‚£ä¹ˆmDataä½¿ç”¨ä¼ å…¥çš„å€¼</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰ï¼Œåˆ™ä½¿ç”¨æ­¤å€¼</span></span><br><span class="line">    <span class="comment">// è§ä¸‹é¢æ„é€ æ–¹æ³•</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;WeakerAccess&quot;)</span> <span class="comment">/* synthetic access */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">NOT_SET</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸€ä¸ªSafeIterableMapï¼Œç”¨æ¥ä¿å­˜ç›‘å¬çš„å¯¹è±¡ï¼Œkeyæ˜¯è§‚å¯Ÿè€…å¯¹è±¡ï¼Œvalueæ˜¯è§‚å¯Ÿè€…å’ŒmActiveã€mVersionæ„æˆçš„ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">    <span class="comment">// SafeIterableMapæ˜¯ä¸€ä¸ªå¯ä»¥å®‰å…¨é€’å½’çš„HashMap</span></span><br><span class="line">    <span class="keyword">private</span> SafeIterableMap&lt;Observer&lt;? <span class="built_in">super</span> T&gt;, ObserverWrapper&gt; mObservers =</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">SafeIterableMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ´»è·ƒçš„Obseverçš„æ•°é‡</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;WeakerAccess&quot;)</span> <span class="comment">/* synthetic access */</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">mActiveCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// å½“å‰LiveDataçš„æ•°æ®</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> Object mData;</span><br><span class="line">    <span class="comment">// å½“setDataè¢«è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬å°±è®¾ç½®æŒ‚èµ·çš„æ•°æ®ï¼Œå®é™…çš„æ•°æ®äº¤æ¢å‘ç”Ÿåœ¨ä¸»çº¿ç¨‹ä¸Š</span></span><br><span class="line">    <span class="comment">// å’‹ä¸€çœ‹æœ‰ç‚¹è¿·ï¼Œçœ‹ä¸æ‡‚è¿™ä¸ªæ³¨é‡Šçš„æ„æ€ï¼Œä½†æ˜¯å½“æˆ‘ä»¬çœ‹å®ŒpostValueæ–¹æ³•åå†æ¥çœ‹è¿™ä¸ªå°±èƒ½ç†è§£äº†</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;WeakerAccess&quot;)</span> <span class="comment">/* synthetic access */</span></span><br><span class="line">    <span class="keyword">volatile</span> <span class="type">Object</span> <span class="variable">mPendingData</span> <span class="operator">=</span> NOT_SET;</span><br><span class="line">    <span class="comment">// LiveDataç‰ˆæœ¬</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> mVersion;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ˜¯å¦æ­£åœ¨åˆ†å‘æ•°æ®çš„flag</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> mDispatchingValue;</span><br><span class="line">    <span class="comment">// æ˜¯å¦åˆ†å‘æ— æ•ˆçš„flag</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;FieldCanBeLocal&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> mDispatchInvalidated;</span><br><span class="line">    <span class="comment">// å®ç°åŒæ­¥é”æ›´æ–°æ•°æ®çš„çº¿ç¨‹ï¼Œåœ¨postValueä¸­è¢«è°ƒç”¨ï¼Œä¼šè¢«å‘é€åˆ°ä¸»çº¿ç¨‹ä¸­å»æ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Runnable</span> <span class="variable">mPostValueRunnable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">        <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            Object newValue;</span><br><span class="line">            <span class="comment">// å°†postValueå‘è¿‡æ¥çš„æ•°æ®è¿›è¡Œä¿®æ”¹</span></span><br><span class="line">            <span class="keyword">synchronized</span> (mDataLock) &#123;</span><br><span class="line">                newValue = mPendingData;</span><br><span class="line">                mPendingData = NOT_SET;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// è°ƒç”¨setValueæ›´æ–°æ•°æ®</span></span><br><span class="line">            setValue((T) newValue);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LiveData</span><span class="params">(T value)</span> &#123;</span><br><span class="line">        mData = value;</span><br><span class="line">        mVersion = START_VERSION + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LiveData</span><span class="params">()</span> &#123;</span><br><span class="line">        mData = NOT_SET;</span><br><span class="line">        mVersion = START_VERSION;</span><br><span class="line">    &#125;</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">## <span class="number">2.2</span> LiveData # setValue()</span><br><span class="line">```java</span><br><span class="line"><span class="comment">// é€šè¿‡æ³¨è§£è¡¨æ˜åªèƒ½åœ¨ä¸»çº¿ç¨‹ä½¿ç”¨</span></span><br><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(T value)</span> &#123;</span><br><span class="line">    assertMainThread(<span class="string">&quot;setValue&quot;</span>);</span><br><span class="line">    <span class="comment">// ç‰ˆæœ¬å¢åŠ </span></span><br><span class="line">    mVersion++;</span><br><span class="line">    <span class="comment">// æ›´æ–°æ•°æ®</span></span><br><span class="line">    mData = value;</span><br><span class="line">    <span class="comment">// åˆ†å‘äº‹ä»¶</span></span><br><span class="line">    dispatchingValue(<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä»£ç å¾ˆç®€å•ï¼Œå¢åŠ ç‰ˆæœ¬ã€æ›´æ–°æ•°æ®ã€åˆ†å‘äº‹ä»¶ã€‚<br>å› ä¸ºè¿™ä¸ªæ–¹æ³•åªèƒ½åœ¨ä¸»çº¿ç¨‹ä¸­è¢«è°ƒç”¨(@MainThread)ï¼Œæ‰€ä»¥å®ç°æ‰è¿™ä¹ˆç®€å•ï¼Œä¸éœ€è¦è€ƒè™‘çº¿ç¨‹åŒæ­¥å•¥çš„ã€‚</p><h2 id="2-3-LiveData-postValue"><a href="#2-3-LiveData-postValue" class="headerlink" title="2.3 LiveData # postValue()"></a>2.3 LiveData # postValue()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">postValue</span><span class="params">(T value)</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> postTask;</span><br><span class="line">    <span class="comment">// å¯¹æ•°æ®æ›´æ–°åŠ é”</span></span><br><span class="line">    <span class="keyword">synchronized</span> (mDataLock) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ²¡æœ‰è®¾ç½®è¿‡å€¼ï¼Œé‚£ä¹ˆmPendingData == NOT_SET</span></span><br><span class="line">        <span class="comment">// å…ˆå°†å€¼ä¿å­˜åˆ°mPendingDataï¼Œåœ¨é€šè¿‡ä¸‹é¢çš„Runableæ¥æ›´æ–°æ•°æ®ï¼Œå°†mPendingDataçš„å€¼æ›´æ–°åˆ°mValue</span></span><br><span class="line">        postTask = mPendingData == NOT_SET;</span><br><span class="line">        mPendingData = value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// postTaskä¸ºfalseï¼Œå°±ä»£è¡¨æ•°æ®è¿˜æ²¡æœ‰æ›´æ–°åˆ°mValueä¸­å»ï¼Œå°±ä¸è®©æ›´æ–°æ•°æ®</span></span><br><span class="line">    <span class="comment">// å› ä¸ºpostValueå’ŒmPostValueRunnableæ‰§è¡Œä¹‹é—´è¿˜æœ‰ä¸€å®šçš„æ—¶é—´é—´éš”</span></span><br><span class="line">    <span class="keyword">if</span> (!postTask) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é€šè¿‡çº¿ç¨‹æ± å°†æ•°æ®æ›´æ–°å‘é€åˆ°ä¸»çº¿ç¨‹ä¸­å»æ›´æ–°æ•°æ®</span></span><br><span class="line">    ArchTaskExecutor.getInstance().postToMainThread(mPostValueRunnable);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>postValueä¼šæ¯”setValueå¤æ‚ä¸€ç‚¹ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥ä»æœ€åä¸€è¡Œçœ‹å‡ºï¼ŒpostValueæ˜¯æä¾›ç»™æˆ‘ä»¬åœ¨å…¶å®ƒçº¿ç¨‹ä¸­è°ƒç”¨çš„ï¼Œç„¶åè°ƒç”¨ä¹‹åä»–å°±ä¼šé€šè¿‡çº¿ç¨‹æ± ä¼ å›ä¸»çº¿ç¨‹ï¼Œå†åœ¨ä¸»çº¿ç¨‹ä¸­æ›´æ–°æ•°æ®å¹¶è°ƒç”¨setValueã€‚</p><p>é‚£ä¹ˆä¸ºä»€ä¹ˆä¼šéœ€è¦mPendingDataè¿™ä¸ªä¸­é—´é‡å‘¢?<br>åŸå› ä¹Ÿå¾ˆç®€å•ï¼Œå› ä¸ºæˆ‘ä»¬æœ€ç»ˆæ˜¯è¦åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨setValueçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆæŠŠæœ€æ–°çš„å€¼ä¼ é€’ç»™setValueå‘¢ï¼Œå†µä¸”è¿™å—è¿˜æ¶‰åŠåˆ°äº†çº¿ç¨‹åˆ‡æ¢ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¿…é¡»é€šè¿‡ä¸€ä¸ªä¸­é—´å˜é‡æ¥å°†è¿™ä¸ªæ•°æ®ä»å­çº¿ç¨‹ä¼ è¾“åˆ°ä¸»çº¿ç¨‹äº†ã€‚å¹¶ä¸”ç”±äºä¸ºäº†é¿å…å¤šçº¿ç¨‹æƒ…å†µä¸‹å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹é€ æˆæ•°æ®æ··ä¹±ï¼Œæ‰€ä»¥æ‰å¯¹mPendingDataåŠ äº†é”ï¼Œå¹¶ä¸”è¿˜åœ¨postValueå¤„å¦‚æœæ•°æ®è¿˜æ²¡æ›´æ–°çš„è¯ï¼Œåé¢æ¥çš„æ•°æ®éƒ½ç›´æ¥ä¸¢å¼ƒäº†ã€‚</p><h2 id="2-4-LiveData-observer"><a href="#2-4-LiveData-observer" class="headerlink" title="2.4 LiveData # observer()"></a>2.4 LiveData # observer()</h2><p>ä¸Šé¢è¯´åˆ°äº†è®¾ç½®æ•°æ®ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ•°æ®è®¾ç½®ä¹‹åè°æ¥ç›¸åº”å‘¢ï¼Ÿ<br>æˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™éƒ½æ˜¯é€šè¿‡observeræ–¹æ³•æ¥æ³¨å†Œè§‚å¯Ÿè€…çš„ï¼Œé‚£æˆ‘ä»¬å°±çœ‹ä¸‹è¿™ä¸ªæ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åªè®¸ä¸»çº¿ç¨‹ä¸­è°ƒç”¨</span></span><br><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">observe</span><span class="params">(<span class="meta">@NonNull</span> LifecycleOwner owner, <span class="meta">@NonNull</span> Observer&lt;? <span class="built_in">super</span> T&gt; observer)</span> &#123;</span><br><span class="line">    assertMainThread(<span class="string">&quot;observe&quot;</span>);</span><br><span class="line">    <span class="comment">// Activityå’ŒFragmentéƒ½å®ç°äº†Owneræ¥å£ï¼Œæ‰€ä»¥è¿™ä¸ªOwnerå°±ç›¸å½“äºä»–ä»¬</span></span><br><span class="line">    <span class="comment">// å½“ä»–ä»¬çš„çŠ¶æ€æ˜¯DESTROYEDæ—¶ï¼Œä»£è¡¨åˆšåˆ›å»ºæˆ–è€…è¦æ‘§æ¯äº†ï¼Œæ­¤æ—¶å°±ä¸éœ€è¦æ³¨å†Œäº†</span></span><br><span class="line">    <span class="keyword">if</span> (owner.getLifecycle().getCurrentState() == DESTROYED) &#123;</span><br><span class="line">        <span class="comment">// ignore</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ„é€ ä¸€ä¸ªLifecycleBundleOvserver</span></span><br><span class="line">    <span class="type">LifecycleBoundObserver</span> <span class="variable">wrapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LifecycleBoundObserver</span>(owner, observer);</span><br><span class="line">    <span class="comment">// å­˜å…¥mObserversè¿™ä¸ªmapä¸­å»</span></span><br><span class="line">    <span class="type">ObserverWrapper</span> <span class="variable">existing</span> <span class="operator">=</span> mObservers.putIfAbsent(observer, wrapper);</span><br><span class="line">    <span class="comment">// å¦‚æœå·²ç»å­˜åœ¨äº†ï¼Œå¹¶ä¸”ä»–çš„ownerå¹¶ä¸æ˜¯æˆ‘ä»¬è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶ä¼ å…¥çš„ownerï¼Œå°±æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">if</span> (existing != <span class="literal">null</span> &amp;&amp; !existing.isAttachedTo(owner)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Cannot add the same observer&quot;</span></span><br><span class="line">                + <span class="string">&quot; with different lifecycles&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœå·²ç»å­˜åœ¨ï¼Œå°±æ²¡å¿…è¦å†æ·»åŠ äº†</span></span><br><span class="line">    <span class="keyword">if</span> (existing != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é€šè¿‡Lifecycleå»ç›‘å¬å’Œåˆ†å‘äº‹ä»¶</span></span><br><span class="line">    owner.getLifecycle().addObserver(wrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>observeræ–¹æ³•çš„æºç å¾ˆç®€å•ã€‚</p><p>å…ˆæ ¹æ®ä¼ å…¥çš„ownerå’Œobserveræ„é€ ä¸€ä¸ªLifecycleBoundObserverï¼Œç„¶åæŠŠä»–ä»¬å­˜å…¥åˆ°mObserversè¿™ä¸ªSafeIterableMapä¸­å»ï¼Œç„¶ååœ¨å­˜çš„æ—¶å€™ï¼Œå¦‚æœåŸæœ¬å°±æœ‰å€¼ï¼Œå¹¶ä¸”è¿™ä¸ªçš„ownerè¿˜ä¸æ˜¯æˆ‘ä»¬è¿™æ¬¡ä¼ å…¥çš„è¿™ä¸ªownerï¼Œå°±æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœåŸæœ¬æœ‰å€¼ï¼Œé‚£ä¹ˆå°±ç›´æ¥è¿”å›ï¼Œä¹Ÿå°±ä¸å­˜äº†ã€‚ç„¶åæœ€åè¿˜æ˜¯è°ƒç”¨Lifecycleçš„addObserverå­˜å…¥åˆ°Lifecycleä¸­å»ã€‚</p><h2 id="2-5-LiveData-dispatchingValue"><a href="#2-5-LiveData-dispatchingValue" class="headerlink" title="2.5 LiveData # dispatchingValue()"></a>2.5 LiveData # dispatchingValue()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">dispatchingValue</span><span class="params">(<span class="meta">@Nullable</span> ObserverWrapper initiator)</span> &#123;</span><br><span class="line">    <span class="comment">// æ˜¯å¦æœ‰äº‹ä»¶æ­£åœ¨è¢«åˆ†å‘</span></span><br><span class="line">    <span class="keyword">if</span> (mDispatchingValue) &#123;</span><br><span class="line">        <span class="comment">// åˆ†å‘æ— æ•ˆ</span></span><br><span class="line">        mDispatchInvalidated = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç”±äºå½“å‰éœ€è¦åˆ†å‘äº‹ä»¶ï¼Œäºæ˜¯è¿™ä¸ªflagä¸ºtrue</span></span><br><span class="line">    mDispatchingValue = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="comment">// æ­£åœ¨åˆ†å‘ï¼Œæ‰€ä»¥æ­¤flagä¸ºfalse</span></span><br><span class="line">        mDispatchInvalidated = <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">// ä¼ å…¥çš„ä¸ä¸ºnull</span></span><br><span class="line">        <span class="keyword">if</span> (initiator != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// é€šè¿‡considerNotifyå»åˆ†å‘</span></span><br><span class="line">            considerNotify(initiator);</span><br><span class="line">            initiator = <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// ä¼ å…¥çš„ä¸ºnullï¼Œä¹Ÿå°±æ˜¯setValueä¸­çš„è°ƒç”¨</span></span><br><span class="line">            <span class="comment">//éå†mObserversï¼Œå¹¶ä¸”è¿˜æ˜¯èƒ½éå†è¢«æ·»åŠ çš„æ•°æ®</span></span><br><span class="line">            <span class="keyword">for</span> (Iterator&lt;Map.Entry&lt;Observer&lt;? <span class="built_in">super</span> T&gt;, ObserverWrapper&gt;&gt; iterator =</span><br><span class="line">                    mObservers.iteratorWithAdditions(); iterator.hasNext(); ) &#123;</span><br><span class="line">                <span class="comment">// é€šè¿‡considerNotifyå»åˆ†å‘</span></span><br><span class="line">                considerNotify(iterator.next().getValue());</span><br><span class="line">                <span class="comment">// åˆ†å‘æ— æ•ˆå°±break</span></span><br><span class="line">                <span class="keyword">if</span> (mDispatchInvalidated) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">while</span> (mDispatchInvalidated);</span><br><span class="line">    <span class="comment">// åˆ†å‘ç»“æŸï¼Œè®¾ç½®ä¸ºfalse</span></span><br><span class="line">    mDispatchingValue = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-6-LiveData-considerNotify"><a href="#2-6-LiveData-considerNotify" class="headerlink" title="2.6 LiveData # considerNotify()"></a>2.6 LiveData # considerNotify()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">considerNotify</span><span class="params">(ObserverWrapper observer)</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœä¸æ˜¯activeçŠ¶æ€äº†ï¼Œå°±ä¸ç”¨åˆ†å‘äº†</span></span><br><span class="line">    <span class="keyword">if</span> (!observer.mActive) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Check latest state b4 dispatch. Maybe it changed state but we didn&#x27;t get the event yet.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// we still first check observer.active to keep it as the entrance for events. So even if</span></span><br><span class="line">    <span class="comment">// the observer moved to an active state, if we&#x27;ve not received that event, we better not</span></span><br><span class="line">    <span class="comment">// notify for a more predictable notification order.</span></span><br><span class="line">    <span class="comment">// å¦‚æœçŠ¶æ€ä¸æ˜¯STARTEDä¹‹åçš„è¯ï¼Œé‚£ä¹ˆå°±æ›´æ–°çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">if</span> (!observer.shouldBeActive()) &#123;</span><br><span class="line">        observer.activeStateChanged(<span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœObserverçš„Versioné«˜äºå½“å‰Versionï¼Œé‚£ä¹ˆå°±æ²¡å¿…è¦å»åˆ†å‘</span></span><br><span class="line">    <span class="keyword">if</span> (observer.mLastVersion &gt;= mVersion) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ›´æ–°Version</span></span><br><span class="line">    observer.mLastVersion = mVersion;</span><br><span class="line">    <span class="comment">// äº‹ä»¶åˆ†å‘ï¼Œè°ƒç”¨æˆ‘ä»¬å®ç°çš„Observerçš„onChangedæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å†™çš„ä»£ç </span></span><br><span class="line">    observer.mObserver.onChanged((T) mData);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="3-LifecycleWrapper"><a href="#3-LifecycleWrapper" class="headerlink" title="3. LifecycleWrapper"></a>3. LifecycleWrapper</h1><h2 id="3-1-LifecycleWrapper"><a href="#3-1-LifecycleWrapper" class="headerlink" title="3.1 LifecycleWrapper"></a>3.1 LifecycleWrapper</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">ObserverWrapper</span> &#123;</span><br><span class="line">    <span class="comment">// Observer</span></span><br><span class="line">    <span class="keyword">final</span> Observer&lt;? <span class="built_in">super</span> T&gt; mObserver;</span><br><span class="line">    <span class="comment">// å½“å‰Observerçš„çŠ¶æ€</span></span><br><span class="line">    <span class="type">boolean</span> mActive;</span><br><span class="line">    <span class="comment">// Observerçš„æœ€æ–°çš„Version</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">mLastVersion</span> <span class="operator">=</span> START_VERSION;</span><br><span class="line">    <span class="comment">// æ„é€ æ–¹æ³•</span></span><br><span class="line">    ObserverWrapper(Observer&lt;? <span class="built_in">super</span> T&gt; observer) &#123;</span><br><span class="line">        mObserver = observer;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">abstract</span> <span class="type">boolean</span> <span class="title function_">shouldBeActive</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isAttachedTo</span><span class="params">(LifecycleOwner owner)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">detachObserver</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">activeStateChanged</span><span class="params">(<span class="type">boolean</span> newActive)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (newActive == mActive) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// immediately set active state, so we&#x27;d never dispatch anything to inactive</span></span><br><span class="line">        <span class="comment">// owner</span></span><br><span class="line">        <span class="comment">// æ›´æ–°çŠ¶æ€</span></span><br><span class="line">        mActive = newActive;</span><br><span class="line">        <span class="comment">// å¦‚æœmActivityCount==0é‚£å°±æ„å‘³ç€æ²¡æœ‰Observer</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">wasInactive</span> <span class="operator">=</span> LiveData.<span class="built_in">this</span>.mActiveCount == <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// æ›´æ–°mActiveCount</span></span><br><span class="line">        LiveData.<span class="built_in">this</span>.mActiveCount += mActive ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (wasInactive &amp;&amp; mActive) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœmActive=1ï¼Œé‚£ä¹ˆå°±onActiveå»æ›´æ–°</span></span><br><span class="line">            onActive();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (LiveData.<span class="built_in">this</span>.mActiveCount == <span class="number">0</span> &amp;&amp; !mActive) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœå½“å‰mActiveCountåˆšåˆšä¸º0ï¼Œé‚£ä¹ˆå°±onInactive</span></span><br><span class="line">            onInactive();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœmActive=trueï¼Œé‚£ä¹ˆå°±åˆ†å‘</span></span><br><span class="line">        <span class="keyword">if</span> (mActive) &#123;</span><br><span class="line">            dispatchingValue(<span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-2-LifecycleBoundObserver"><a href="#3-2-LifecycleBoundObserver" class="headerlink" title="3.2 LifecycleBoundObserver"></a>3.2 LifecycleBoundObserver</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LifecycleBoundObserver</span> <span class="keyword">extends</span> <span class="title class_">ObserverWrapper</span> <span class="keyword">implements</span> <span class="title class_">LifecycleEventObserver</span> &#123;</span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">final</span> LifecycleOwner mOwner;</span><br><span class="line"></span><br><span class="line">    LifecycleBoundObserver(<span class="meta">@NonNull</span> LifecycleOwner owner, Observer&lt;? <span class="built_in">super</span> T&gt; observer) &#123;</span><br><span class="line">        <span class="built_in">super</span>(observer);</span><br><span class="line">        mOwner = owner;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">shouldBeActive</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­å½“å‰Lifecycleçš„çŠ¶æ€æ˜¯ä¸æ˜¯åœ¨STARTEDä¹‹å</span></span><br><span class="line">        <span class="keyword">return</span> mOwner.getLifecycle().getCurrentState().isAtLeast(STARTED);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onStateChanged</span><span class="params">(<span class="meta">@NonNull</span> LifecycleOwner source,</span></span><br><span class="line"><span class="params">            <span class="meta">@NonNull</span> Lifecycle.Event event)</span> &#123;</span><br><span class="line">        <span class="comment">// ç›‘å¬Lifecycleçš„çŠ¶æ€å‘ç”Ÿå˜åŒ–</span></span><br><span class="line">        <span class="comment">// å¦‚æœçŠ¶æ€æ—¶DESTROYEDï¼Œ</span></span><br><span class="line">        <span class="keyword">if</span> (mOwner.getLifecycle().getCurrentState() == DESTROYED) &#123;</span><br><span class="line">            <span class="comment">// ç§»é™¤æ‰è¿™ä¸ªObserver</span></span><br><span class="line">            removeObserver(mObserver);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ›´æ–°Active</span></span><br><span class="line">        activeStateChanged(shouldBeActive());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isAttachedTo</span><span class="params">(LifecycleOwner owner)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mOwner == owner;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">detachObserver</span><span class="params">()</span> &#123;</span><br><span class="line">        mOwner.getLifecycle().removeObserver(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="4-æ€»ç»“"><a href="#4-æ€»ç»“" class="headerlink" title="4. æ€»ç»“"></a>4. æ€»ç»“</h1><h2 id="4-1-æ€»ç»“å’Œæµç¨‹"><a href="#4-1-æ€»ç»“å’Œæµç¨‹" class="headerlink" title="4.1 æ€»ç»“å’Œæµç¨‹"></a>4.1 æ€»ç»“å’Œæµç¨‹</h2><p>LiveDataä¸»è¦ç”±2ä¸ªç±»æ„æˆï¼š</p><ul><li><code>LiveData</code>ï¼šæŠ½è±¡ç±»ï¼Œå®ç°ç±»å°±æ˜¯<code>MutableLiveData</code>ï¼Œåªä¸è¿‡<code>MutableLiveData</code>ä¸­çš„æ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯ç›´æ¥è°ƒç”¨äº†<code>LiveData</code>çš„æ–¹æ³•ï¼Œæœ¬è´¨ä¸Šå’Œ<code>LiveData</code>æ²¡å•¥åŒºåˆ«ã€‚</li><li><code>LifecycleWrapper</code>ï¼šæŠ½è±¡ç±»ï¼Œä¸»è¦ç”¨æ¥å¯¹<code>Observer</code>å’Œ<code>Version</code>ã€<code>Active</code>è¿›è¡Œç®¡ç†ï¼Œè€Œæˆ‘ä»¬ä½¿ç”¨çš„éƒ½æ˜¯<code>LifecycleBoundObserver</code>ï¼Œè¿™ä¸ªç±»ç»§æ‰¿è‡ª<code>LifecycleWrapper</code>ï¼Œå¹¶å®ç°äº†<code>LifecycleEventObserver</code>æ¥å£ã€‚</li></ul><p>å¹¶ä¸”åº•å±‚è¿˜æ˜¯é€šè¿‡Lifecycleå»å®ç°çš„ï¼Œå°±æ˜¯å¯¹Lifecycleè¿›è¡Œäº†ä¸€ä¸‹å°è£…ã€‚</p><p>LiveDataçš„æ“ä½œä¸»è¦åˆ†ä¸ºä¸¤ç§ï¼š</p><ul><li>æ·»åŠ è§‚å¯Ÿè€…ï¼š<code>observer()</code></li><li>è®¾ç½®æ•°æ®ï¼š<ul><li><code>setValue()</code></li><li><code>postValue()</code></li></ul></li></ul><h3 id="4-1-1-æ·»åŠ è§‚å¯Ÿè€…"><a href="#4-1-1-æ·»åŠ è§‚å¯Ÿè€…" class="headerlink" title="4.1.1 æ·»åŠ è§‚å¯Ÿè€…"></a>4.1.1 æ·»åŠ è§‚å¯Ÿè€…</h3><ol><li>è°ƒç”¨<code>observer()</code>æ–¹æ³•ï¼Œ<ol><li>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ä¼šå…ˆæ„é€ ä¸€ä¸ªLifecycleBoundObserverçš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¿å­˜äº†è¿™ä¸ª<code>mObserver</code>ä»¥åŠæ¿€æ´»çŠ¶æ€<code>mActive</code>ï¼›</li><li>æ¥ç€æŠŠè¿™ä¸ªå¯¹è±¡é€šè¿‡<code>mObservers.putIfAbsent()</code>æ·»åŠ åˆ°mObserversè¿™ä¸ªmapä¸­å»ï¼›</li><li>å¹¶è°ƒç”¨<code>owner.getLifecycle().addObserver(wrapper)</code>æ·»åŠ åˆ°Lifecycleä¸­è¿›è¡Œç›‘å¬ã€‚</li></ol></li><li>ä¹‹åæ¯å½“<code>owner</code>ç”Ÿå‘½å‘¨æœŸå˜åŒ–æ—¶ï¼Œå°±ä¼šè°ƒç”¨LifecycleBoundObserverçš„<code>onStateChanged()</code>æ–¹æ³• (å…·ä½“å¯è§Lifecycleçš„æºç )<ol><li>å¦‚æœå½“å‰<code>owner</code>çš„çŠ¶æ€ä¸º<code>DESTROYED</code>çš„æ—¶å€™ï¼Œå°±ä¼šå°†è¿™ä¸ª<code>observer</code>ä»<code>mObservers</code>ä¸­ç§»é™¤</li><li>å¦‚æœä¸æ˜¯ï¼Œå°±è°ƒç”¨<code>activeStateChanged()</code>å»æ›´æ–°<code>mActive</code></li></ol></li></ol><h3 id="4-1-2-è®¾ç½®æ•°æ®"><a href="#4-1-2-è®¾ç½®æ•°æ®" class="headerlink" title="4.1.2 è®¾ç½®æ•°æ®"></a>4.1.2 è®¾ç½®æ•°æ®</h3><ol><li><code>postValue()</code>ï¼šè¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯æä¾›ç»™æˆ‘ä»¬åœ¨éä¸»çº¿ç¨‹ä¸­å»è°ƒç”¨çš„<ol><li>è¿™ä¸ªæ–¹æ³•ä¸­ä¼šå…ˆåŠ é”ï¼Œç„¶åå°†æ•°æ®ä¿å­˜åˆ°<code>mPendingData</code>ä¸­ï¼Œå¹¶æ ¹æ®<code>mPendingData</code>çš„å€¼åˆ¤æ–­ä¸Šæ¬¡postçš„å€¼æ˜¯å¦æ›´æ–°åˆ°<code>mData</code>ä¸­äº†ï¼š<ol><li>å¦‚æœæ›´æ–°åˆ°äº†ï¼Œåˆ™é€šè¿‡<code>ArchTaskExecutor</code>å°†<code>mPostValueRunnable</code>è¿™ä¸ªRunnable<code>post</code>åˆ°äº†ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œ<ol><li><code>mPostValueRunnable</code>ä¸­ä¼šå°†åŠ é”ï¼Œå°†<code>mPendingData</code>ä¸­çš„å€¼æ›´æ–°åˆ°<code>newData</code>ä¸­ï¼Œå¹¶å°†<code>mPendingData</code>å€¼è®¾ç½®ä¸º<code>NOT_SET</code>ï¼Œç„¶åä¼šè°ƒç”¨<code>setValue(newData)</code></li></ol></li><li>å¦‚æœæ²¡æœ‰æ›´æ–°ï¼Œåˆ™ä¼šç›´æ¥returné€€å‡ºè¿™æ¬¡<code>postValue()</code>ï¼Œä¸æ›´æ–°æ•°æ®ï¼Œç›´æ¥ä¸¢å¼ƒ</li></ol></li></ol></li><li><code>setValue()</code>ï¼šè¿™ä¸ªæ–¹æ³•åªèƒ½åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨<ol><li>ä»–å°±ä¼šç›´æ¥è°ƒç”¨<code>dispatchingValue(null)</code>è¿›è¡Œåˆ†å‘</li><li>è¿™ä¸ªæ–¹æ³•ä¸­å¦‚æœä¼ å…¥çš„æ˜¯<code>null</code>ï¼Œå°±ä»£è¡¨éœ€è¦åˆ†å‘ç»™æ‰€æœ‰çš„Observerï¼Œé‚£ä¹ˆä»–ä¼šéå†<code>mObservers</code>ï¼Œå¯¹æ¯ä¸€ä¸ªObserverè°ƒç”¨<code>considerNotify(iterator.next().getValue());</code></li><li>åœ¨<code>considerNotify(observer)</code>ä¸­ä¼šå…ˆåˆ¤æ–­ä¼ å…¥çš„è¿™ä¸ªObserverçš„<code>mActive</code>æ˜¯å¦ä¸º<code>false</code>ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œå°±ä»£è¡¨æ²¡æœ‰æ¿€æ´»ï¼Œä¹Ÿå°±æ˜¯ä»–çš„<code>owner</code>å¤„äº<code>STARTED</code>ä¹‹åï¼Œå°±æ²¡æœ‰å¿…è¦å»æ›´æ–°Viewäº†ï¼›è€Œå¦‚æœä¸æ˜¯å°±ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼š<ol><li>å…ˆè°ƒç”¨<code>shouldBeActive</code>åˆ¤æ–­<code>owner</code>æ˜¯å¦å¤„äº<code>STARTED</code>ä¹‹åï¼Œå¦‚æœæ˜¯å°±è°ƒç”¨<code>activeStateChanged(false)</code>å»æ›´æ–°<code>mActive</code>ä¸ºfalseï¼Œå¹¶returnï¼Œä¸åˆ†å‘äº‹ä»¶</li><li>åœ¨åˆ¤æ–­<code>observer</code>çš„<code>mLastVersion</code>æ˜¯å¦å¤§äºå½“å‰çš„<code>mVersion</code>ï¼Œå¦‚æœå¤§äºç­‰äºï¼Œåˆ™ä¹Ÿæ²¡æœ‰å¿…è¦ç»§ç»­åˆ†å‘</li><li>ä¹‹åæ›´æ–°<code>observer</code>çš„<code>mLastVersion</code>ä¸ºå½“å‰çš„<code>mVersion</code></li><li>è°ƒç”¨<code>observer.mObserver.onChanged((T) mData);</code>å»æ‰§è¡Œæˆ‘ä»¬å®ç°çš„Observer</li></ol></li></ol></li></ol><h3 id="4-1-3-æµç¨‹å›¾"><a href="#4-1-3-æµç¨‹å›¾" class="headerlink" title="4.1.3 æµç¨‹å›¾"></a>4.1.3 æµç¨‹å›¾</h3><p>å¯¹äºæµç¨‹æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹å›¾è¡¨ç¤ºï¼š<br><img src="https://cdn.littlecorgi.top/mweb/2020-08-22/Jetpack%E6%BA%90%E7%A0%81-%E4%B9%8B-LiveData-LiveData%E6%B5%81%E7%A8%8B%E5%9B%BE.jpg" alt="Jetpackæºç -ä¹‹-LiveData-LiveDataæµç¨‹å›¾"></p><h2 id="4-2-LiveDataçœŸçš„å¯ä»¥è¢«ç”¨äºäº‹ä»¶åˆ†å‘å—"><a href="#4-2-LiveDataçœŸçš„å¯ä»¥è¢«ç”¨äºäº‹ä»¶åˆ†å‘å—" class="headerlink" title="4.2 LiveDataçœŸçš„å¯ä»¥è¢«ç”¨äºäº‹ä»¶åˆ†å‘å—"></a>4.2 LiveDataçœŸçš„å¯ä»¥è¢«ç”¨äºäº‹ä»¶åˆ†å‘å—</h2><p>LiveDataæœ¬è´¨ä¸Šæ˜¯å¯è§‚å¯Ÿçš„æ•°æ®å­˜å‚¨ç±»ï¼Œä½†æ˜¯å¯è§‚å¯Ÿè¿™ä¸ªç‰¹æ€§ä¸å°±å¯ä»¥è¢«ç”¨æ¥äº‹ä»¶åˆ†å‘å—(EventBus)ï¼Œè€Œä¸”è¿˜é€šè¿‡Lifecycleå®ç°äº†ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥ï¼Œè¿™äº›ç›¸å¯¹æ¥è¯´æ¯”EventBusæ›´åŠ ç®€å•ã€‚</p><p>ä½†æ˜¯LiveDataçœŸçš„æœ‰è¡¨é¢ä¸Šçœ‹ä¸Šå»çš„è¿™ä¸ªç®€å•å—ï¼ŸçœŸçš„æœ‰è¿™ä¹ˆå¥½å—ï¼Ÿ</p><h3 id="4-2-1-postValue-æ•°æ®ä¸¢å¤±"><a href="#4-2-1-postValue-æ•°æ®ä¸¢å¤±" class="headerlink" title="4.2.1 postValue æ•°æ®ä¸¢å¤±"></a>4.2.1 postValue æ•°æ®ä¸¢å¤±</h3><p>åœ¨postValueæ–¹æ³•ä¸­ï¼Œå¦‚æœmPendingData == NOT_SETçš„è¯ï¼Œå°±ä¼šç›´æ¥ä¸¢å¼ƒè°ƒè¿™æ¬¡çš„æ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸Šæ¬¡çš„äº‹ä»¶è¿˜åœ¨åˆ†å‘ï¼Œè¿˜æ²¡å®Œæˆçš„è¯ï¼Œé‚£ä¹ˆè¿™æ¬¡çš„äº‹ä»¶å°±ä¼šç›´æ¥ä¸¢å¼ƒã€‚</p><p>è¿™æ ·å°±å¯¼è‡´äº†äº‹ä»¶ä¸¢å¤±ã€‚</p><h3 id="4-2-2-considerNotify-ä¸å›è°ƒè§‚å¯Ÿè€…"><a href="#4-2-2-considerNotify-ä¸å›è°ƒè§‚å¯Ÿè€…" class="headerlink" title="4.2.2 considerNotify ä¸å›è°ƒè§‚å¯Ÿè€…"></a>4.2.2 considerNotify ä¸å›è°ƒè§‚å¯Ÿè€…</h3><p>é™¤äº†postValueå­˜æ”¾äº‹ä»¶è¿™å—æœ‰é—®é¢˜ï¼ŒconsiderNotifyé€šçŸ¥äº‹ä»¶ä¹Ÿæœ‰é—®é¢˜ã€‚</p><p>considerNotifyè¿™ä¸ªæ–¹æ³•ç¬¬ä¸€è¡Œå°±æ˜¯å¦‚æœObserverå¤„äºéæ¿€æ´»çŠ¶æ€(mActive == false)ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ä»–å°±ä¸ä¼šå›è°ƒè¿™ä¸ªObserverå»åˆ†å‘äº‹ä»¶ã€‚</p><p>åªæœ‰å½“Observerå¤„äºæ¿€æ´»çŠ¶æ€ï¼Œä»–æ‰ä¼šè¿›è¡Œåˆ†å‘ã€‚</p><p>è¿™æ ·å°±é€ æˆäº†äº‹ä»¶ä¸¢å¤±ï¼Œä¸­é—´ä¼ è¾“çš„æ•°æ®éƒ½æ— æ³•æ”¶åˆ°ã€‚</p><h3 id="4-2-3-LiveDataæœ¬æ¥å°±ä¸æ˜¯ä¸ºäº‹ä»¶åˆ†å‘æ‰“é€ çš„"><a href="#4-2-3-LiveDataæœ¬æ¥å°±ä¸æ˜¯ä¸ºäº‹ä»¶åˆ†å‘æ‰“é€ çš„" class="headerlink" title="4.2.3 LiveDataæœ¬æ¥å°±ä¸æ˜¯ä¸ºäº‹ä»¶åˆ†å‘æ‰“é€ çš„"></a>4.2.3 LiveDataæœ¬æ¥å°±ä¸æ˜¯ä¸ºäº‹ä»¶åˆ†å‘æ‰“é€ çš„</h3><p>åœ¨å®˜æ–¹æ–‡æ¡£ä¸Šç¬¬ä¸€å¥è¯å°±è¡¨æ˜äº†ï¼ŒLiveDataåªæ˜¯ä¸€ä¸ªå¯è§‚å¯Ÿçš„æ•°æ®å­˜å‚¨ç±»ï¼Œä»–çš„æ ¸å¿ƒåœ¨äºä»–èƒ½å°†æœ€æ–°çš„æ•°æ®é€šçŸ¥ç»™è§‚å¯Ÿè€…ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»–æœ¬æ¥å°±ä¸ä¼šåœ¨æ„ä¸­é—´çŠ¶æ€ï¼Œå®ƒåªè¦ä¿è¯å½“Viewå¤„äºæ¿€æ´»çŠ¶æ€èƒ½å¾—åˆ°æœ€æ–°çš„æ•°æ®ä¿è¯UIæ—¶æ­£ç¡®çš„å°±è¡Œï¼Œå¦‚æœè¿˜è¦å»çº ç»“ä¸­é—´çŠ¶æ€çš„è¯ï¼Œé‚£ä¹ˆUIå±•ç¤ºå²‚ä¸ä¼šå˜å¾—å¾ˆå¥‡æ€ªï¼›å¹¶ä¸”å¦‚æœå¯¹äºæ²¡æœ‰æ˜¾ç¤ºçš„Viewéƒ½è¦å»é€šçŸ¥è¿™ä¸ªViewçš„è¯ï¼Œè¿™æ ·ä¸å°±ä¼šæ˜¾å¾—å¾ˆå¤šæ­¤ä¸€ä¸¾ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Android/">Android</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Jetpack/">Jetpack</category>
      
      <category domain="https://www.littlecorgi.top/tags/MVVM/">MVVM</category>
      
      <category domain="https://www.littlecorgi.top/tags/LiveData/">LiveData</category>
      
      
      <comments>https://www.littlecorgi.top/posts/28011e4e.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Jetpackæºç  ä¹‹ Lifecycle</title>
      <link>https://www.littlecorgi.top/posts/53c3ccc1.html</link>
      <guid>https://www.littlecorgi.top/posts/53c3ccc1.html</guid>
      <pubDate>Fri, 14 Aug 2020 08:49:20 GMT</pubDate>
      
      <description>Lifecycleæ˜¯Jetpackä¸­æœ€åŸºç¡€çš„ä¸€ç±»åº“ï¼Œä»–çš„ä¸»è¦ä½œç”¨å°±æ˜¯å¸®æˆ‘ä»¬å®ç°è‡ªåŠ¨çš„ç”Ÿå‘½å‘¨æœŸç›‘å¬ï¼Œé‚£ä¹ˆå¥¹æ˜¯æ€ä¹ˆå»å®ç°çš„å‘¢ï¼Ÿå°±è®©æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹å§</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="0-å‰è¨€"><a href="#0-å‰è¨€" class="headerlink" title="0. å‰è¨€"></a>0. å‰è¨€</h1><h2 id="0-1-ç”¨æ³•"><a href="#0-1-ç”¨æ³•" class="headerlink" title="0.1 ç”¨æ³•"></a>0.1 ç”¨æ³•</h2><p>Lifecycleå¯ä»¥è¯´æ˜¯Jetpackä¸­æœ€åŸºç¡€çš„ä¸€ä¸ªåº“ï¼Œä»–çš„ä¸»è¦ä½œç”¨å°±æ˜¯å¸®æˆ‘ä»¬å®ç°çš„ç”Ÿå‘½å‘¨æœŸç›‘å¬ã€‚</p><p>å¯¹äºä»–çš„ç”¨æ³•ä¹Ÿå¾ˆç®€å•ï¼Œç”±äºæˆ‘ä»¬çš„Activity(é—´æ¥é€šè¿‡<code>ComponentActivity</code>å®ç°)ã€Fragment(ç›´æ¥å®ç°)éƒ½å·²ç»å®ç°äº†<code>LifecycleOwner</code>æ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ä»–ä»¬ä¸­è°ƒç”¨<code>getLifecycle()</code>è·å¾—åˆ°<code>Lifecycle</code>å¯¹è±¡ï¼Œç„¶åè°ƒç”¨ä»–çš„<code>addObserver()</code>å°†æˆ‘ä»¬è‡ªå®šä¹‰çš„<code>LifecycleObserver</code>ä¼ å…¥è¿›å…¥å³å¯ã€‚<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ä»¥Activityä¸ºä¾‹ */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// MainActivity</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">AppCompatActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_lifecycle_test)</span><br><span class="line">        lifecycle.addObserver(LifecycleObserverTest)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// LifecycleObserverTest</span></span><br><span class="line"><span class="keyword">object</span> LifecycleObserverTest : LifecycleObserver &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">val</span> TAG = <span class="string">&quot;LifecycleTest&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnLifecycleEvent(Lifecycle.Event.ON_CREATE)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">prepare</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">// todo æ’­æ”¾å™¨å‡†å¤‡å·¥ä½œ</span></span><br><span class="line">        Log.d(TAG, <span class="string">&quot;prepare: Createæ—¶æ’­æ”¾å™¨å‡†å¤‡å·¥ä½œ&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnLifecycleEvent(Lifecycle.Event.ON_DESTROY)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">release</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">// todo é‡Šæ”¾èµ„æº</span></span><br><span class="line">        Log.d(TAG, <span class="string">&quot;release: Destroyæ—¶é‡Šæ”¾èµ„æº&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">play</span><span class="params">(context: <span class="type">Context</span>)</span></span> &#123;</span><br><span class="line">        <span class="comment">// todo å¼€å§‹æ’­æ”¾</span></span><br><span class="line">        Log.d(TAG, <span class="string">&quot;play&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¿™æ ·å½“MainActivityæ‰§è¡Œ<code>onCreate()</code>æ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œ<code>prepare()</code>æ–¹æ³•ï¼Œæ‰§è¡Œ<code>onDestroy()</code>æ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œ<code>release()</code>æ–¹æ³•ï¼Œå°±ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨çš„å»è°ƒç”¨äº†ã€‚</p><p>ä½†æ˜¯è¿™å—éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›æ·»åŠ äº†ç”Ÿå‘½å‘¨æœŸçš„æ–¹æ³•ï¼Œä¸€å®šä¸è¦ä¼ å…¥ä»»ä½•å‚æ•°ï¼Œå› ä¸ºéƒ½å·²ç»æ˜¯è‡ªåŠ¨è°ƒç”¨çš„äº†ï¼Œä¹Ÿå°±æˆ‘ä»¬æ‰‹åŠ¨å¹²é¢„ä¸äº†ï¼Œé‚£ä¹ˆç³»ç»Ÿæ€ä¹ˆçŸ¥é“ä½ è¦ä¼ å…¥çš„å‚æ•°æ˜¯è°å‘¢ã€‚æ²¡æœ‰æ·»åŠ ç”Ÿå‘½å‘¨æœŸçš„æ–¹æ³•ä¸å—å½±å“ã€‚</p><p>å¦å¤–ä¸€ä¸ªæ³¨æ„çš„ç‚¹æ˜¯ï¼Œæˆ‘ä»¬è°ƒç”¨<code>addObserver()</code>å¹¶ä¸æ˜¯ä¸€å®šå¾—åœ¨<code>onCreate()</code>æ–¹æ³•ä¸­è°ƒç”¨ï¼Œæˆ‘ä»¬åœ¨ä»»ä½•åœ°æ–¹ä»»ä½•ç”Ÿå‘½å‘¨æœŸæ—¶è°ƒç”¨å³å¯ï¼Œæ¯”æ–¹è¯´æˆ‘ä»¬ä¸Šé¢åœ¨<code>onCreate()</code>ä¸­è°ƒç”¨äº†ï¼Œè¿™æ ·æ‰“å°å‡ºæ¥çš„logå°±å¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://cdn.littlecorgi.top/mweb/2020-08-14/Jetpack%E6%BA%90%E7%A0%81%20%E4%B9%8B%20Lifecycle-1-.png" alt="Jetpackæºç  ä¹‹ Lifecycle-1-"></p><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬æŠŠ<code>addObserver()</code>æ”¾åœ¨<code>onResume()</code>ä¸­è°ƒç”¨ï¼Œç»“æœå°±å˜æˆäº†è¿™æ ·ï¼š<br><img src="https://cdn.littlecorgi.top/mweb/2020-08-14/Jetpack%E6%BA%90%E7%A0%81%20%E4%B9%8B%20Lifecycle-2-.png" alt="Jetpackæºç  ä¹‹ Lifecycle-2-"><br>æˆ‘ä»¬å°±ä¼šå‘ç°ï¼ŒåŸæœ¬åº”è¯¥åœ¨<code>onCreate()</code>æ—¶æ‰§è¡Œçš„æ–¹æ³•å´åˆ°äº†<code>onResume()</code>æ‰æ‰§è¡Œã€‚</p><p>æ‰€ä»¥è¿™ç‚¹æˆ‘ä»¬ä¸€å®šè¦æ³¨æ„ï¼Œæˆ‘ä»¬è°ƒç”¨<code>addObserver()</code>ä¸€å®šå¾—åœ¨æˆ‘ä»¬ç›‘å¬çš„ç”Ÿå‘½å‘¨æœŸé‡Œé¢æˆ–è€…ä¹‹å‰ã€‚</p><h2 id="0-2-çœŸ-Â·-å‰è¨€"><a href="#0-2-çœŸ-Â·-å‰è¨€" class="headerlink" title="0.2 çœŸ Â· å‰è¨€"></a>0.2 çœŸ Â· å‰è¨€</h2><p>çœ‹å®Œåˆšåˆšçš„ç”¨æ³•ï¼Œæˆ‘ä»¬èƒ½å¾—åˆ°çš„ç¬¬ä¸€ä¸ªè¦ç´ å°±æ˜¯Lifecycleä¸€å®šæ˜¯é€šè¿‡è§‚å¯Ÿè€…æ¨¡å¼å®ç°çš„ï¼Œè¿™ä¸ªä»<code>addObserver()</code>å°±èƒ½çœ‹å‡ºæ¥ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¤§èƒ†çŒœæƒ³ä¸‹Lifecycleçš„å®ç°åŸç†ï¼š<br>å½“è°ƒåŠ¨<code>addObserver()</code>ä¹‹åï¼ŒLifecycleå°±é€šè¿‡ä¸€ç§æ•°æ®æ¥å£å°†è¿™ä¸ªLifecycleObserverçš„å¯¹è±¡ä¿å­˜äº†èµ·æ¥ï¼Œå½“Activityç”Ÿå‘½å‘¨æœŸå˜åŒ–æ—¶ï¼Œä»–å°±ä¼šéå†è¿™ä¸ªæ•°æ®ç»“æ„ï¼Œç„¶åè°ƒç”¨æ¯ä¸€ä¸ªçš„å¯¹åº”çš„ç”Ÿå‘½å‘¨æœŸçš„å›è°ƒä»£ç ã€‚</p><p>å¯¹åº”çš„ä¹Ÿå°±åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p><ol><li>æ³¨å†Œ</li><li>åˆ†å‘</li><li>æ‰§è¡Œå›è°ƒ</li></ol><p>(PS:çªç„¶æ„Ÿè§‰å¥½åƒEventBusğŸ˜‚)</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥å¼€å§‹çœ‹æºç ï¼Œæ¥éªŒè¯æˆ‘ä»¬çš„çŒœæƒ³åˆ°åº•æ­£ä¸æ­£ç¡®ã€‚</p><h1 id="1-æ³¨å†Œ"><a href="#1-æ³¨å†Œ" class="headerlink" title="1. æ³¨å†Œ"></a>1. æ³¨å†Œ</h1><p>æ³¨å†Œè‚¯å®šæ˜¯ä»<code>getLifecycle().addObserver(LifecycleObserver observer)</code>å¼€å§‹å˜›ã€‚</p><p>é¦–å…ˆï¼Œ<code>getLifecycle()</code>æ˜¯è°çš„æ–¹æ³•ï¼Ÿ</p><p>ç›´æ¥é€šè¿‡AndroidStudioçš„è·³è½¬åŠŸèƒ½å°±èƒ½çœ‹åˆ°ï¼Œæˆ‘ä»¬è°ƒç”¨çš„<code>getLifecycle()</code>å…¶å®æ˜¯ComponentActivityçš„ä¸€ä¸ªæ–¹æ³•ï¼Œè¿›ä¸€æ­¥è·³è½¬å°±èƒ½çœ‹åˆ°å…¶å®æ˜¯LifecycleOwnerè¿™ä¸ªæ¥å£çš„ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ã€‚</p><p>æ‰€ä»¥ä¹Ÿå°±æ˜¯è¯´ï¼ŒActivityç»§æ‰¿è‡ªComponentActivityï¼Œè€ŒComponentActivityå®ç°äº†LifecycleOwneræ¥å£ï¼Œè¿™ä¸ªæ¥å£ä¸­åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œé‚£å°±æ˜¯<code>getLifecycle()</code>ã€‚(FragmentåŒç†)</p><p>è€Œè¿™ä¸ªæ–¹æ³•è¿”å›çš„æ˜¯Lifecycleï¼Œé‚£ä¹ˆLifecycleé‡Œé¢æœ‰äº›å•¥ä¸œè¥¿ï¼Ÿ</p><h2 id="1-1-LifecycleæŠ½è±¡ç±»"><a href="#1-1-LifecycleæŠ½è±¡ç±»" class="headerlink" title="1.1 LifecycleæŠ½è±¡ç±»"></a>1.1 LifecycleæŠ½è±¡ç±»</h2><p>è¿›å…¥Lifecycleçš„æºç å°±èƒ½çœ‹åˆ°å®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä»£ç ä¹Ÿå¾ˆå°‘ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Lifecycle</span> &#123;</span><br><span class="line"></span><br><span class="line">    AtomicReference&lt;Object&gt; mInternalScopeRef = <span class="keyword">new</span> <span class="title class_">AtomicReference</span>&lt;&gt;();</span><br><span class="line">   </span><br><span class="line">    <span class="meta">@MainThread</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">addObserver</span><span class="params">(<span class="meta">@NonNull</span> LifecycleObserver observer)</span>;</span><br><span class="line">    <span class="meta">@MainThread</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">removeObserver</span><span class="params">(<span class="meta">@NonNull</span> LifecycleObserver observer)</span>;</span><br><span class="line">    <span class="meta">@MainThread</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> State <span class="title function_">getCurrentState</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;WeakerAccess&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Event</span> &#123;</span><br><span class="line">        ON_CREATE,</span><br><span class="line">        ON_START,</span><br><span class="line">        ON_RESUME,</span><br><span class="line">        ON_PAUSE,</span><br><span class="line">        ON_STOP,</span><br><span class="line">        ON_DESTROY,</span><br><span class="line">        ON_ANY</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">State</span> &#123;</span><br><span class="line">        DESTROYED,</span><br><span class="line">        INITIALIZED,</span><br><span class="line">        CREATED,</span><br><span class="line">        STARTED,</span><br><span class="line">        RESUMED;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAtLeast</span><span class="params">(<span class="meta">@NonNull</span> State state)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> compareTo(state) &gt;= <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Lifecycleä¸­æœ‰ä¸‰ä¸ªæ–¹æ³•å’Œä¸¤ä¸ªæšä¸¾ï¼š</p><ul><li>ä¸‰ä¸ªæ–¹æ³•<ul><li><code>addObserver()</code>ï¼šAdds a LifecycleObserver that will be notified when the LifecycleOwner changes.<br>ï¼ˆæ·»åŠ ä¸€ä¸ªLifecycleObserverï¼Œè¿™ä¸ªLifecycleObserveråœ¨LifecycleOwnerå˜åŒ–æ—¶èƒ½å¾—åˆ°é€šçŸ¥ï¼‰</li><li><code>removeObserver()</code>ï¼šRemoves the given observer from the observers list.<br>ï¼ˆä»observersçš„é›†åˆä¸­ç§»é™¤è¿™ä¸ªobserverï¼‰</li><li><code>getCurrentState()</code>ï¼šReturns the current state of the Lifecycle.<br>ï¼ˆè¿”å›å½“å‰çš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€(State)ï¼‰</li></ul></li><li>ä¸¤ä¸ªæšä¸¾<ul><li><code>Event</code>ï¼šè¿™ä¸ªä¸ç”¨å¤šè¯´ï¼Œå¯¹åº”ç€Activityã€Fragmentçš„åŸºæœ¬ç”Ÿå‘½å‘¨æœŸ</li><li><code>State</code>ï¼šè¿™ä¸ªæ˜¯è¿”å›çš„å½“å‰Activityã€Fragmentçš„çŠ¶æ€ï¼Œå…·ä½“è½¬æ¢çœ‹ä¸‹å›¾ï¼š</li></ul></li></ul><p><img src="https://cdn.littlecorgi.top/mweb/2020-08-14/15973104823930.jpg" alt="å…³äºè¿™ä¸ªå›¾çš„æ¥æºå¯ä»¥çœ‹LifecycleRegistry.getStateAfter()æºç "></p><p>ä»ä¸Šå¯å¾—çŸ¥ï¼ŒLifecycleè¿™ä¸ªæŠ½è±¡ç±»ä¸»è¦çš„ä½œç”¨å°±æ˜¯</p><ul><li>æ·»åŠ å’Œç§»é™¤Observer</li><li>è·å–å½“å‰LifecycleOwnerçš„çŠ¶æ€ï¼Œå¹¶è´Ÿè´£å¯¹åº”çš„çŠ¶æ€å’Œäº‹ä»¶çš„è½¬æ¢</li></ul><p>é‚£ä¹ˆæˆ‘ä»¬å›è¿‡å¤´æ¥ï¼Œ<code>getLifecycle()</code>è¦æ±‚è¿”å›ä¸€ä¸ªLifecycleå¯¹è±¡ï¼Œä½†æ˜¯Lifecycleæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæ²¡åŠæ³•ç›´æ¥æ„é€ å¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•è¿”å›çš„æ˜¯è°ï¼Ÿ<br>æˆ‘ä»¬ç›´æ¥çœ‹ComponentActivityçš„<code>getLifecycle()</code>æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Lifecycle <span class="title function_">getLifecycle</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> mLifecycleRegistry;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è€Œè¿™ä¸ª<code>mLifecycleRegistry</code>æ˜¯LifecycleRegistryçš„å¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥å¾—çŸ¥ï¼ŒLifecycleå…¶ä¸­ä¸€ä¸ª(å®é™…ä¸Šæ˜¯å”¯ä¸€)å®ç°ç±»æ˜¯LifecycleRegistryã€‚</p><h2 id="1-2-LifecycleRegistry"><a href="#1-2-LifecycleRegistry" class="headerlink" title="1.2 LifecycleRegistry"></a>1.2 LifecycleRegistry</h2><p>Lifecycleåªæœ‰å”¯ä¸€ä¸€ä¸ªå®ç°ç±»ï¼Œé‚£å°±æ˜¯LifecycleRegistryã€‚</p><p>åˆšåˆšè¯´åˆ°ï¼Œæ³¨å†Œè‚¯å®šæ˜¯æœ‰ä¸€ä¸ªObserverçš„é›†åˆï¼ŒåˆšåˆšLifecycleæºç ä¸­çš„æ³¨é‡Šä¹Ÿè¯´æ˜äº†è¿™ä¸€ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆä»è¿™ä¸ªç±»çš„å±æ€§å¼€å§‹çœ‹èµ·ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LifecycleRegistry</span> <span class="keyword">extends</span> <span class="title class_">Lifecycle</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> FastSafeIterableMap&lt;LifecycleObserver, ObserverWithState&gt; mObserverMap =</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">FastSafeIterableMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> State mState;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WeakReference&lt;LifecycleOwner&gt; mLifecycleOwner;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">mAddingObserverCounter</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">mHandlingEvent</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">mNewEventOccurred</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li><code>mObserverMap</code>ï¼šç”¨äºä¿å­˜Observerçš„é›†åˆï¼Œæ˜¯ä¸€ä¸ªFastSafeIterableMapé›†åˆï¼Œè€Œè¿™ä¸ªFastSafeIterableMapæ ¹æ®æºç æ³¨é‡Šï¼Œæ˜¯ç±»ä¼¼äºLinkedHashMapçš„ï¼Œå¹¶ä¸”å®ƒæ˜¯çº¿ç¨‹ä¸å®‰å…¨ï¼Œå…è®¸ä½¿ç”¨è¿­ä»£å™¨æ—¶ä¿®æ”¹é›†åˆçš„ã€‚</li><li><code>mState</code>ï¼šå½“å‰çš„çŠ¶æ€(State)ã€‚å°±æ˜¯Lifecycleä¸­çš„é‚£ä¸ªStateæšä¸¾ç±»ã€‚</li><li><code>mLifecycleOwner</code>ï¼šå°±æ˜¯è¿™ä¸ªLifecycleRegistryçš„æŒæœ‰è€…ï¼Œè¿™å—ä½¿ç”¨äº†å¼±å¼•ç”¨ï¼Œæ˜¯ä¸ºäº†é¿å…å¯¹Fragmentã€Activityç›´æ¥å¼•ç”¨è€Œé€ æˆå†…å­˜æ³„æ¼ã€‚</li><li><code>mAddingObserverCounter</code>ï¼šæ­£åœ¨æ·»åŠ åˆ°mObserverMapä¸­çš„Observerçš„æ•°é‡ã€‚</li><li><code>mHandlingEvent</code>ï¼šæ˜¯å¦æ­£åœ¨åˆ†å‘äº‹ä»¶çš„æ ‡è®°ã€‚</li><li><code>mNewEventOccurred</code>ï¼šæ˜¯å¦æœ‰æ–°çš„äº‹ä»¶å‘ç”Ÿçš„æ ‡è®°ã€‚</li></ul><p>æ¥ç€å°±æ¥åˆ†æaddObserveræ–¹æ³•ï¼š</p><h3 id="1-2-1-addObserver-NonNull-LifecycleObserver-observer"><a href="#1-2-1-addObserver-NonNull-LifecycleObserver-observer" class="headerlink" title="1.2.1 addObserver(@NonNull LifecycleObserver observer)"></a>1.2.1 addObserver(@NonNull LifecycleObserver observer)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addObserver</span><span class="params">(<span class="meta">@NonNull</span> LifecycleObserver observer)</span> &#123;</span><br><span class="line">    <span class="type">State</span> <span class="variable">initialState</span> <span class="operator">=</span> mState == DESTROYED ? DESTROYED : INITIALIZED;</span><br><span class="line">    <span class="comment">// æ ¹æ®çŠ¶æ€å’Œobserveræ„é€ å‡ºä¸€ä¸ªstatefulObserver</span></span><br><span class="line">    <span class="type">ObserverWithState</span> <span class="variable">statefulObserver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObserverWithState</span>(observer, initialState);</span><br><span class="line">    <span class="comment">// é€šè¿‡observerå»mObserverMapæŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªkeyæˆ–è€…å€¼ä¸ºnullï¼Œå°±å°†valueä¿å­˜è¿›å»ï¼Œå¦‚æœæœ‰valueï¼Œå°±å–å‡ºæ¥èµ‹å€¼ç»™previous</span></span><br><span class="line">    <span class="type">ObserverWithState</span> <span class="variable">previous</span> <span class="operator">=</span> mObserverMap.putIfAbsent(observer, statefulObserver);</span><br><span class="line">    <span class="comment">// å¦‚æœpreviousä¸ä¸ºnullï¼Œå°±è¯æ˜mObserverMapä¸­å·²ç»ä¿å­˜äº†è¿™ä¸ªobserverï¼Œå°±ç›´æ¥return</span></span><br><span class="line">    <span class="keyword">if</span> (previous != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è·å–åˆ°lifecycleOwnerå¼±å¼•ç”¨å¼•ç”¨å¯¹è±¡</span></span><br><span class="line">    <span class="type">LifecycleOwner</span> <span class="variable">lifecycleOwner</span> <span class="operator">=</span> mLifecycleOwner.get();</span><br><span class="line">    <span class="comment">// ä¸ºnullï¼Œå°±è¯æ˜è¿™ä¸ªActivityæˆ–è€…Fragmentå·²ç»Destroyäº†</span></span><br><span class="line">    <span class="keyword">if</span> (lifecycleOwner == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// it is null we should be destroyed. Fallback quickly</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœæœ‰observeræ­£åœ¨è¢«åŠ å…¥æˆ–è€…æ­£åœ¨åˆ†å‘æ—¶é—´ï¼Œè¿™ä¸ªæ ‡è®°å°±ä¼šä¸ºtrue</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isReentrance</span> <span class="operator">=</span> mAddingObserverCounter != <span class="number">0</span> || mHandlingEvent;</span><br><span class="line">    <span class="comment">// è®¡ç®—å‡ºç›®å‰çš„Stateâ€”â€”targetStateã€‚</span></span><br><span class="line">    <span class="comment">// -&gt;&gt;&gt; è§1.2.2</span></span><br><span class="line">    <span class="type">State</span> <span class="variable">targetState</span> <span class="operator">=</span> calculateTargetState(observer);</span><br><span class="line">    <span class="comment">// ä»£è¡¨æœ‰ä¸€ä¸ªObserveræ­£åœ¨è¢«æ·»åŠ </span></span><br><span class="line">    mAddingObserverCounter++;</span><br><span class="line">    <span class="comment">// å¦‚æœå½“å‰è¿™ä¸ªObserverçš„çŠ¶æ€ä½äºtargetStateå¹¶ä¸”mObserverMapä¸­è¿˜æœ‰è¿™ä¸ªObserverçš„è¯ï¼Œå°±éœ€è¦åŒæ­¥åˆ°targetState</span></span><br><span class="line">    <span class="keyword">while</span> ((statefulObserver.mState.compareTo(targetState) &lt; <span class="number">0</span></span><br><span class="line">            &amp;&amp; mObserverMap.contains(observer))) &#123;</span><br><span class="line">        <span class="comment">// åŒæ­¥æ—¶å…ˆpushè¿›å»ï¼Œä¸´æ—¶ä¿å­˜ä¸‹</span></span><br><span class="line">        pushParentState(statefulObserver.mState);</span><br><span class="line">        <span class="comment">// åˆ†å‘äº‹ä»¶</span></span><br><span class="line">        statefulObserver.dispatchEvent(lifecycleOwner, upEvent(statefulObserver.mState));</span><br><span class="line">        <span class="comment">// åˆ†å‘å®Œæˆå†popå‡ºæ¥</span></span><br><span class="line">        popParentState();</span><br><span class="line">        <span class="comment">// mState / subling may have been changed recalculate</span></span><br><span class="line">        <span class="comment">// é‡æ–°è®¡ç®—targetState</span></span><br><span class="line">        targetState = calculateTargetState(observer);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœä¸å¯é‡å…¥ï¼Œå°±æ‰§è¡Œsyncæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">if</span> (!isReentrance) &#123;</span><br><span class="line">        <span class="comment">// we do sync only on the top level.</span></span><br><span class="line">        <span class="comment">// syncæ¶‰åŠåˆ°äº†äº‹ä»¶åˆ†å‘ï¼Œæˆ‘ä»¬æ”¾åˆ°åé¢è¯´</span></span><br><span class="line">        <span class="comment">// -&gt;&gt;&gt; è§ 2.2.4</span></span><br><span class="line">        sync();</span><br><span class="line">    &#125;</span><br><span class="line">    mAddingObserverCounter--;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥è¿™ä¸ªæ–¹æ³•ä¸»è¦æ‰§è¡Œäº†ä¸‹é¢å‡ ä»¶äº‹</p><ol><li>å…ˆæ„é€ ä¸€ä¸ªé»˜è®¤çŠ¶æ€ï¼Œè¦ä¹ˆæ˜¯<code>DESTROYED</code>è¦ä¹ˆæ˜¯<code>INITIALIZED</code></li><li>ç„¶åæ ¹æ®è¿™ä¸ª<code>observer</code>å’Œè¿™ä¸ªçŠ¶æ€æ„å»ºå‡ºä¸€ä¸ª<code>statefulObserver</code></li><li>å°±å»è®¡ç®—<code>targetState</code>ï¼Œå¹¶å¯¹äºè¿™ä¸ª<code>statefulObserver</code>ï¼Œå¦‚æœä»–çš„<code>state</code>å°äº<code>targetState</code>ï¼Œå°±è¿›è¡Œåˆ†å‘æ—¶é—´ï¼Œå¹¶é‡æ–°è®¡ç®—<code>targetState</code></li><li>å¦‚æœæ˜¯ä¸å¯é‡å…¥çŠ¶æ€ï¼Œåˆ™æ‰§è¡Œ<code>sync()</code>æ–¹æ³•</li></ol><h3 id="1-2-2-calculateTargetState-LifecycleObserver-observer"><a href="#1-2-2-calculateTargetState-LifecycleObserver-observer" class="headerlink" title="1.2.2 calculateTargetState(LifecycleObserver observer)"></a>1.2.2 calculateTargetState(LifecycleObserver observer)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> State <span class="title function_">calculateTargetState</span><span class="params">(LifecycleObserver observer)</span> &#123;</span><br><span class="line">    <span class="comment">// å–å‡ºå½“å‰observerçš„å‰ä¸€ä¸ªObserver</span></span><br><span class="line">    Entry&lt;LifecycleObserver, ObserverWithState&gt; previous = mObserverMap.ceil(observer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‹¿åˆ°previousçš„State</span></span><br><span class="line">    <span class="type">State</span> <span class="variable">siblingState</span> <span class="operator">=</span> previous != <span class="literal">null</span> ? previous.getValue().mState : <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// å–å‡ºparentStateæœ€åä¸€ä¸ªå…ƒç´ çš„State</span></span><br><span class="line">    <span class="type">State</span> <span class="variable">parentState</span> <span class="operator">=</span> !mParentStates.isEmpty() ? mParentStates.get(mParentStates.size() - <span class="number">1</span>)</span><br><span class="line">            : <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// å–å‡ºè¿™äº›ä¸­æœ€å°çš„State</span></span><br><span class="line">    <span class="keyword">return</span> min(min(mState, siblingState), parentState);</span><br><span class="line">&#125;                                                                                          </span><br></pre></td></tr></table></figure><p>æ‰€ä»¥è¿™ä¸ªæ–¹æ³•çš„ä¸»è¦ä½œç”¨å°±æ˜¯è®¡ç®—<code>targetState</code>ï¼Œè¿™ä¸ª<code>targetState</code>ä¸€å®šå°äºç­‰äºå½“å‰<code>mState</code>ã€‚<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ å¤šä¸ªObserverï¼Œä½†æ˜¯æ¯æ¬¡æ·»åŠ æ–°çš„Observerçš„æ—¶å€™ï¼Œåˆå§‹çŠ¶æ€éƒ½æ˜¯<code>INITIALIZED</code>ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦æŠŠå®ƒåŒæ­¥åˆ°å½“å‰çš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€ã€‚</p><p>å¹¶ä¸”åœ¨æ›´æ–°çŠ¶æ€çš„æ—¶å€™ï¼Œæ¯æ¬¡æ›´æ–°ä¹‹åéƒ½ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•å†é‡æ–°è®¡ç®—<code>targetState</code>ã€‚</p><p>ä¸Šé¢å°±å®Œæˆäº†äº‹ä»¶çš„æ·»åŠ äº†ï¼Œé‚£æˆ‘ä»¬ç°åœ¨å†æ¥çœ‹ä¸‹å®ƒæ˜¯æ€ä¹ˆåˆ†å‘äº‹ä»¶çš„ã€‚</p><h1 id="2-åˆ†å‘"><a href="#2-åˆ†å‘" class="headerlink" title="2. åˆ†å‘"></a>2. åˆ†å‘</h1><p>æˆ‘ä»¬å†æ¬¡å›åˆ°ComponentActivityï¼Œä»–åœ¨<code>onCreate()</code>æ–¹æ³•ä¸­æ‰§è¡Œäº†ä¸€è¡Œä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(<span class="meta">@Nullable</span> Bundle savedInstanceState)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    mSavedStateRegistryController.performRestore(savedInstanceState);</span><br><span class="line">    ReportFragment.injectIfNeededIn(<span class="built_in">this</span>); <span class="comment">// !!!</span></span><br><span class="line">    <span class="keyword">if</span> (mContentLayoutId != <span class="number">0</span>) &#123;</span><br><span class="line">        setContentView(mContentLayoutId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>é‚£æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸ªReportFragmentåˆ°åº•æ˜¯å•¥ï¼š</p><h2 id="2-1-ReportFragment"><a href="#2-1-ReportFragment" class="headerlink" title="2.1 ReportFragment"></a>2.1 ReportFragment</h2><h3 id="2-1-1-ReportFragment-injectIfNeededIn"><a href="#2-1-1-ReportFragment-injectIfNeededIn" class="headerlink" title="2.1.1 ReportFragment # injectIfNeededIn()"></a>2.1.1 ReportFragment # injectIfNeededIn()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">injectIfNeededIn</span><span class="params">(Activity activity)</span> &#123;</span><br><span class="line">    <span class="comment">// ProcessLifecycleOwner should always correctly work and some activities may not extend</span></span><br><span class="line">    <span class="comment">// FragmentActivity from support lib, so we use framework fragments for activities</span></span><br><span class="line">    <span class="comment">// è·å–åˆ°FragmentManager</span></span><br><span class="line">    android.app.<span class="type">FragmentManager</span> <span class="variable">manager</span> <span class="operator">=</span> activity.getFragmentManager();</span><br><span class="line">    <span class="comment">// åˆ¤æ–­å½“å‰çš„FragmentManageré‡Œé¢æœ‰æ²¡æœ‰æˆ‘ä»¬éœ€è¦çš„Fragmentï¼Œæ²¡æœ‰çš„è¯å°±æ·»åŠ è¿›å»</span></span><br><span class="line">    <span class="keyword">if</span> (manager.findFragmentByTag(REPORT_FRAGMENT_TAG) == <span class="literal">null</span>) &#123;</span><br><span class="line">        manager.beginTransaction().add(<span class="keyword">new</span> <span class="title class_">ReportFragment</span>(), REPORT_FRAGMENT_TAG).commit();</span><br><span class="line">        <span class="comment">// Hopefully, we are the first to make a transaction.</span></span><br><span class="line">        manager.executePendingTransactions();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°è¿™å—æ˜¯ä¸æ˜¯æ„Ÿè§‰å¾ˆçœ¼ç†Ÿï¼ŒAndroidä¸­æœ€å¸¸ç”¨çš„ç›‘å¬ç”Ÿå‘½å‘¨æœŸçš„æ–¹æ³•å°±æ˜¯å¾€Activityä¸­æ·»åŠ ä¸€ä¸ªæ²¡æœ‰ç•Œé¢çš„Fragmentï¼Œè¿™å—æ­£æ˜¯è¿™ä¸ªæ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬å…·ä½“çœ‹ä¸€ä¸‹ReportFragmentçš„å®ç°ã€‚</p><h3 id="2-1-2-ReportFragment-ç”Ÿå‘½å‘¨æœŸç›‘å¬"><a href="#2-1-2-ReportFragment-ç”Ÿå‘½å‘¨æœŸç›‘å¬" class="headerlink" title="2.1.2 ReportFragment # ç”Ÿå‘½å‘¨æœŸç›‘å¬"></a>2.1.2 ReportFragment # ç”Ÿå‘½å‘¨æœŸç›‘å¬</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onActivityCreated</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onActivityCreated(savedInstanceState);</span><br><span class="line">    dispatchCreate(mProcessListener);</span><br><span class="line">    dispatch(Lifecycle.Event.ON_CREATE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onStart</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onStart();</span><br><span class="line">    dispatchStart(mProcessListener);</span><br><span class="line">    dispatch(Lifecycle.Event.ON_START);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onResume</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onResume();</span><br><span class="line">    dispatchResume(mProcessListener);</span><br><span class="line">    dispatch(Lifecycle.Event.ON_RESUME);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPause</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onPause();</span><br><span class="line">    dispatch(Lifecycle.Event.ON_PAUSE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onStop</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onStop();</span><br><span class="line">    dispatch(Lifecycle.Event.ON_STOP);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDestroy</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onDestroy();</span><br><span class="line">    dispatch(Lifecycle.Event.ON_DESTROY);</span><br><span class="line">    <span class="comment">// just want to be sure that we won&#x27;t leak reference to an activity</span></span><br><span class="line">    mProcessListener = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ReportFragmentä¸­å¯¹ç”Ÿå‘½å‘¨æœŸç›‘å¬çš„æ‰€æœ‰æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™äº›æ–¹æ³•éƒ½æœ‰ä¸¤ä¸ªå…±æ€§ï¼š</p><ul><li>ä»–ä»¬éƒ½è°ƒç”¨äº†<code>dispatch()</code>æ–¹æ³•å»åˆ†å‘ç”Ÿå‘½å‘¨æœŸ</li><li>ä»–ä»¬éƒ½é€šçŸ¥äº†<code>mProcessListener</code></li></ul><p>å¯¹äº<code>mProcessListener</code>ï¼Œè¿™ä¸ªæ˜¯å¤„ç†åº”ç”¨ç¨‹åºè¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸçš„ï¼Œè¿™ä¸ªæˆ‘ä»¬å…ˆä¸å»ç®¡å®ƒï¼Œæˆ‘ä»¬éœ€è¦é‡è§†çš„æ˜¯è¿™ä¸ª<code>dispatch()</code>æ–¹æ³•</p><h3 id="2-1-3-ReportFragment-dispatch"><a href="#2-1-3-ReportFragment-dispatch" class="headerlink" title="2.1.3 ReportFragment # dispatch()"></a>2.1.3 ReportFragment # dispatch()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">dispatch</span><span class="params">(Lifecycle.Event event)</span> &#123;</span><br><span class="line">    <span class="type">Activity</span> <span class="variable">activity</span> <span class="operator">=</span> getActivity();</span><br><span class="line">    <span class="keyword">if</span> (activity <span class="keyword">instanceof</span> LifecycleRegistryOwner) &#123;</span><br><span class="line">        ((LifecycleRegistryOwner) activity).getLifecycle().handleLifecycleEvent(event);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (activity <span class="keyword">instanceof</span> LifecycleOwner) &#123;</span><br><span class="line">        <span class="type">Lifecycle</span> <span class="variable">lifecycle</span> <span class="operator">=</span> ((LifecycleOwner) activity).getLifecycle();</span><br><span class="line">        <span class="keyword">if</span> (lifecycle <span class="keyword">instanceof</span> LifecycleRegistry) &#123;</span><br><span class="line">            ((LifecycleRegistry) lifecycle).handleLifecycleEvent(event);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºæˆ‘ä»¬æ¢ç©¶çš„æ˜¯ComponentActivityï¼Œæ‰€ä»¥è‚¯å®šæ˜¯èµ°çš„ç¬¬8è¡Œçš„ifï¼Œç„¶åä»–å°±ä¼šé€šè¿‡<code>getLifecycle()</code>æ‹¿åˆ°<code>mLifecycleRegistry</code>ï¼Œç„¶åè°ƒç”¨äº†ä»–çš„<code>handleLifecycleEvent(event)</code></p><h2 id="2-2-LifecycleRegistry"><a href="#2-2-LifecycleRegistry" class="headerlink" title="2.2 LifecycleRegistry"></a>2.2 LifecycleRegistry</h2><h3 id="2-2-1-LifecycleRegistry-handleLifecycleEvent"><a href="#2-2-1-LifecycleRegistry-handleLifecycleEvent" class="headerlink" title="2.2.1 LifecycleRegistry # handleLifecycleEvent()"></a>2.2.1 LifecycleRegistry # handleLifecycleEvent()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleLifecycleEvent</span><span class="params">(<span class="meta">@NonNull</span> Lifecycle.Event event)</span> &#123;</span><br><span class="line">    <span class="type">State</span> <span class="variable">next</span> <span class="operator">=</span> getStateAfter(event);</span><br><span class="line">    moveToState(next);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»–é¦–å…ˆè°ƒç”¨äº†<code>getSateAfter()</code>æ–¹æ³•ï¼Œè·å–åˆ°äº†å½“å‰<code>event</code>å¯¹åº”çš„Stateï¼ˆè¿™ä¸ªå¯¹åº”å…³ç³»è§ä¸Šé¢é‚£ä¸ªStateå’ŒEventçš„å¯¹åº”å…³ç³»å›¾ï¼‰ã€‚<br>ç„¶åè°ƒç”¨<code>moveToSate()</code>å»åˆ†å‘äº‹ä»¶ä»¥åŠç§»åŠ¨çŠ¶æ€ã€‚</p><h3 id="2-2-2-LifecycleRegistry-getStateAfter"><a href="#2-2-2-LifecycleRegistry-getStateAfter" class="headerlink" title="2.2.2 LifecycleRegistry # getStateAfter()"></a>2.2.2 LifecycleRegistry # getStateAfter()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> State <span class="title function_">getStateAfter</span><span class="params">(Event event)</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (event) &#123;</span><br><span class="line">        <span class="keyword">case</span> ON_CREATE:</span><br><span class="line">        <span class="keyword">case</span> ON_STOP:</span><br><span class="line">            <span class="keyword">return</span> CREATED;</span><br><span class="line">        <span class="keyword">case</span> ON_START:</span><br><span class="line">        <span class="keyword">case</span> ON_PAUSE:</span><br><span class="line">            <span class="keyword">return</span> STARTED;</span><br><span class="line">        <span class="keyword">case</span> ON_RESUME:</span><br><span class="line">            <span class="keyword">return</span> RESUMED;</span><br><span class="line">        <span class="keyword">case</span> ON_DESTROY:</span><br><span class="line">            <span class="keyword">return</span> DESTROYED;</span><br><span class="line">        <span class="keyword">case</span> ON_ANY:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Unexpected event value &quot;</span> + event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢è¯´çš„Eventå’ŒStateå¯¹ç…§å›¾çš„æ¥æºã€‚</p><h3 id="2-2-3-LifecycleRegistry-moveToState"><a href="#2-2-3-LifecycleRegistry-moveToState" class="headerlink" title="2.2.3 LifecycleRegistry # moveToState()"></a>2.2.3 LifecycleRegistry # moveToState()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">moveToState</span><span class="params">(State next)</span> &#123;</span><br><span class="line">    <span class="comment">// å½“å‰çŠ¶æ€å·²ç»æ˜¯ç›®æ ‡çŠ¶æ€äº†ï¼Œå°±ä¸éœ€è¦æ”¹å˜</span></span><br><span class="line">    <span class="keyword">if</span> (mState == next) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ”¹å˜å½“å‰çŠ¶æ€</span></span><br><span class="line">    mState = next;</span><br><span class="line">    <span class="comment">// å¦‚æœæ­£åœ¨åˆ†å‘çŠ¶æ€ï¼Œæˆ–è€…æœ‰Observeræ­£åœ¨æ·»åŠ çš„è¯</span></span><br><span class="line">    <span class="keyword">if</span> (mHandlingEvent || mAddingObserverCounter != <span class="number">0</span>) &#123;</span><br><span class="line">        mNewEventOccurred = <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">// we will figure out what to do on upper level.</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åˆ†å‘çŠ¶æ€æ ‡å¿—ä½è®¾ç½®ä¸ºtrue</span></span><br><span class="line">    mHandlingEvent = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// è°ƒç”¨syncæ–¹æ³•è¿›è¡Œäº‹ä»¶åˆ†å‘</span></span><br><span class="line">    sync();</span><br><span class="line">    <span class="comment">// åˆ†å‘çŠ¶æ€æ ‡å¿—ä½è®¾ç½®ä¸ºfalse</span></span><br><span class="line">    mHandlingEvent = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•å°±æ˜¯å°†<code>next</code>åŒæ­¥åˆ°<code>mState</code>ï¼Œå¹¶è¿›è¡Œå¯¹åº”çš„çŠ¶æ€çš„åˆ†å‘ã€‚</p><h3 id="2-2-4-LifecycleRegistry-sync"><a href="#2-2-4-LifecycleRegistry-sync" class="headerlink" title="2.2.4 LifecycleRegistry # sync()"></a>2.2.4 LifecycleRegistry # sync()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sync</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// å–å‡ºå½“å‰çš„lifecycleOwnerï¼ŒæŒ‰ç…§æˆ‘ä»¬ä¸Šé¢çš„æµç¨‹ï¼Œæ­¤å¤„å–å‡ºçš„æ˜¯ComponentActivity</span></span><br><span class="line">    <span class="comment">// (å¹¶ä¸ä¸€å®šæ˜¯è¿™ä¸ªActivityï¼Œåªæ˜¯å› ä¸ºæˆ‘ä»¬æ˜¯ä»ComponentActivityå…¥æ‰‹åˆ†æçš„ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯Fragment)</span></span><br><span class="line">    <span class="type">LifecycleOwner</span> <span class="variable">lifecycleOwner</span> <span class="operator">=</span> mLifecycleOwner.get();</span><br><span class="line">    <span class="comment">// å¦‚æœOwnerä¸å­˜åœ¨äº†ï¼Œå°±æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">if</span> (lifecycleOwner == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;LifecycleOwner of this LifecycleRegistry is already&quot;</span></span><br><span class="line">                + <span class="string">&quot;garbage collected. It is too late to change lifecycle state.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é€šè¿‡isSyncedå»åˆ¤æ–­ï¼Œ</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯åˆ¤æ–­mObserverMapçš„é˜Ÿå¤´å’Œé˜Ÿå°¾å…ƒç´ çš„Stateæ˜¯å¦ç›¸ç­‰ï¼Œä»¥åŠé˜Ÿå°¾å…ƒç´ çš„Stateæ˜¯å¦ç­‰äºmState</span></span><br><span class="line">    <span class="comment">// å¦‚æœå‡ç›¸ç­‰åˆ™è¿”å›true(ä¸éœ€è¦è¿›è¡Œåˆ†å‘)ï¼Œå¦åˆ™è¿”å›false</span></span><br><span class="line">    <span class="keyword">while</span> (!isSynced()) &#123;</span><br><span class="line">        mNewEventOccurred = <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">// no need to check eldest for nullability, because isSynced does it for us.</span></span><br><span class="line">        <span class="comment">// å¦‚æœ mState å°äº mObserverMap ä¸­é˜Ÿå¤´å…ƒç´ çš„çŠ¶æ€å€¼ï¼Œè°ƒç”¨ backwardPass()</span></span><br><span class="line">        <span class="keyword">if</span> (mState.compareTo(mObserverMap.eldest().getValue().mState) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            backwardPass(lifecycleOwner);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å–å‡ºé˜Ÿå°¾å…ƒç´ </span></span><br><span class="line">        Entry&lt;LifecycleObserver, ObserverWithState&gt; newest = mObserverMap.newest();</span><br><span class="line">        <span class="comment">// å¦‚æœmStateçš„çŠ¶æ€å€¼å¤§äºnewestçš„çŠ¶æ€å€¼ï¼Œåˆ™è°ƒç”¨forwardPass()</span></span><br><span class="line">        <span class="keyword">if</span> (!mNewEventOccurred &amp;&amp; newest != <span class="literal">null</span></span><br><span class="line">                &amp;&amp; mState.compareTo(newest.getValue().mState) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            forwardPass(lifecycleOwner);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    mNewEventOccurred = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºè¿™æ˜¯<code>mState</code>å·²ç»æ›´æ–°ï¼Œä½†æ˜¯Observersçš„çŠ¶æ€è¿˜æ²¡æ›´æ–°è¿‡ï¼Œæ‰€ä»¥è‚¯å®šæ˜¯è¿›å…¥ç¬¬23è¡Œçš„ifï¼Œä¹Ÿå°±æ‰§è¡Œ<code>forwardPass()</code>æ–¹æ³•</p><h3 id="2-2-5-LifecycleRegistry-forwardPass"><a href="#2-2-5-LifecycleRegistry-forwardPass" class="headerlink" title="2.2.5 LifecycleRegistry # forwardPass()"></a>2.2.5 LifecycleRegistry # forwardPass()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">forwardPass</span><span class="params">(LifecycleOwner lifecycleOwner)</span> &#123;</span><br><span class="line">    <span class="comment">// é€šè¿‡iteratorWithAdditionså»å®‰å…¨çš„å¹¶åœ¨éå†æ—¶èƒ½éå†åˆ°æ‰€æœ‰æ–°å¢çš„å…ƒç´ çš„éå†æ–¹å¼å»éå†mObserversé›†åˆ</span></span><br><span class="line">    Iterator&lt;Entry&lt;LifecycleObserver, ObserverWithState&gt;&gt; ascendingIterator =</span><br><span class="line">            mObserverMap.iteratorWithAdditions();</span><br><span class="line">    <span class="keyword">while</span> (ascendingIterator.hasNext() &amp;&amp; !mNewEventOccurred) &#123;</span><br><span class="line">        Entry&lt;LifecycleObserver, ObserverWithState&gt; entry = ascendingIterator.next();</span><br><span class="line">        <span class="type">ObserverWithState</span> <span class="variable">observer</span> <span class="operator">=</span> entry.getValue();</span><br><span class="line">        <span class="comment">// å‘ä¸Šä¼ é€’äº‹ä»¶ï¼Œç›´åˆ° observer çš„çŠ¶æ€å€¼ç­‰äºå½“å‰çŠ¶æ€å€¼</span></span><br><span class="line">        <span class="keyword">while</span> ((observer.mState.compareTo(mState) &lt; <span class="number">0</span> &amp;&amp; !mNewEventOccurred</span><br><span class="line">                &amp;&amp; mObserverMap.contains(entry.getKey()))) &#123;</span><br><span class="line">            <span class="comment">// å’ŒaddObserverä¸­ä¸€æ ·çš„æ“ä½œ</span></span><br><span class="line">            <span class="comment">// å…ˆä¸´æ—¶ä¿å­˜</span></span><br><span class="line">            pushParentState(observer.mState);</span><br><span class="line">            <span class="comment">// åˆ†å‘äº‹ä»¶</span></span><br><span class="line">            observer.dispatchEvent(lifecycleOwner, upEvent(observer.mState));</span><br><span class="line">            <span class="comment">// ç§»é™¤</span></span><br><span class="line">            popParentState();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * upEvent()</span></span><br><span class="line"><span class="comment"> * stateå‡çº§æ‰€éœ€è¦ç»å†çš„äº‹ä»¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Event <span class="title function_">upEvent</span><span class="params">(State state)</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (state) &#123;</span><br><span class="line">        <span class="keyword">case</span> INITIALIZED:</span><br><span class="line">        <span class="keyword">case</span> DESTROYED:</span><br><span class="line">            <span class="keyword">return</span> ON_CREATE;</span><br><span class="line">        <span class="keyword">case</span> CREATED:</span><br><span class="line">            <span class="keyword">return</span> ON_START;</span><br><span class="line">        <span class="keyword">case</span> STARTED:</span><br><span class="line">            <span class="keyword">return</span> ON_RESUME;</span><br><span class="line">        <span class="keyword">case</span> RESUMED:</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Unexpected state value &quot;</span> + state);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°è¿™å—æˆ‘ä»¬å°±å·®ä¸å¤šèƒ½ç†è§£ä»–çš„ä¸€ä¸ªæµç¨‹äº†ï¼Œå‡è®¾æˆ‘ä»¬ä¸Šé¢çš„æµç¨‹æ˜¯ä»<code>ON_CREATE</code>åˆ°<code>ON_RESUME</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªæµç¨‹å°±æ˜¯ï¼š</p><ol><li>ReportFragmenté€šè¿‡ç›‘å¬ç”Ÿå‘½å‘¨æœŸå˜åŒ–ï¼Œè°ƒç”¨äº†<code>dispatch(Lifecycle.Event.ON_RESUME)</code>ï¼›</li><li>åœ¨<code>dispatch()</code>ä¸­åˆ™æ‰§è¡Œäº†LifecycleRegistryçš„<code>handleLifecycleEvent()</code>æ–¹æ³•ï¼Œå‚æ•°æ˜¯<code>ON_RESUME</code>ï¼›</li><li>é€šè¿‡<code>getStateAfter()</code>è¿”å›<code>RESUMED</code>ï¼Œåœ¨è°ƒç”¨<code>moveToState()</code>è·³è½¬åˆ°<code>RESUMED</code>ï¼›</li><li>è¿™æ—¶å°†<code>mSate</code>æ›´æ–°ä¸º<code>RESUMED</code>ï¼Œç„¶åè°ƒç”¨<code>sync()</code>æ–¹æ³•</li><li>åœ¨<code>sync()</code>æ–¹æ³•ä¸­ï¼Œç”±äº<code>mSate</code>æ˜¯<code>RESUMED</code>çŠ¶æ€ï¼Œè€Œ<code>mObserverMap</code>ä¸­çš„çŠ¶æ€éƒ½æ˜¯<code>STARTED</code>ï¼Œé‚£ä¹ˆ<code>mState</code>å¤§äº<code>mObserverMap</code>ï¼Œå°±æ‰§è¡Œ<code>forwardPass()</code>æ–¹æ³•</li><li>æœ€åå°±ä¼šè°ƒç”¨<code>observer.dispatchEvent()</code>å»åˆ†å‘äº‹ä»¶</li></ol><h3 id="2-2-6-LifecycleRegistry-backwardPass"><a href="#2-2-6-LifecycleRegistry-backwardPass" class="headerlink" title="2.2.6 LifecycleRegistry # backwardPass()"></a>2.2.6 LifecycleRegistry # backwardPass()</h3><p>åˆšåˆšçœ‹å®Œäº†ä¸Šé¢çš„ä»£ç å’Œæµç¨‹ï¼Œé‚£ä¹ˆæ—¢ç„¶æœ‰<code>forwardPass()</code>ï¼Œå¯¹åº”çš„<code>backwardPass()</code>æœ‰å•¥ä½œç”¨å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬è¿˜æ˜¯å‡è®¾ä¸€ä¸‹æµç¨‹ï¼Œæˆ‘ä»¬åˆšåˆšè¯´åˆ°äº†<code>ON_RESUME</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å‡è®¾ä»<code>ON_RESUME</code>åˆ°<code>ON_PAUSE</code>ï¼Œå†æ¥çœ‹ä¸€ä¸‹åˆšåˆšçš„æµç¨‹ï¼Œå’Œåˆšåˆšçš„æµç¨‹ä¸€æ ·çš„ï¼š</p><ol><li>ReportFragmenté€šè¿‡ç›‘å¬ç”Ÿå‘½å‘¨æœŸå˜åŒ–ï¼Œè°ƒç”¨äº†<code>dispatch(Lifecycle.Event.ON_PAUSE)</code>ï¼›</li><li>åœ¨<code>dispatch()</code>ä¸­åˆ™æ‰§è¡Œäº†LifecycleRegistryçš„<code>handleLifecycleEvent()</code>æ–¹æ³•ï¼Œå‚æ•°æ˜¯<code>ON_PAUSE</code>ï¼›</li><li>é€šè¿‡<code>getStateAfter()</code>è¿”å›<code>STARTED</code>ï¼Œåœ¨è°ƒç”¨<code>moveToState()</code>è·³è½¬åˆ°<code>STARTED</code>ï¼›</li><li>è¿™æ—¶å°†<code>mSate</code>æ›´æ–°ä¸º<code>STARTED</code>ï¼Œç„¶åè°ƒç”¨<code>sync()</code>æ–¹æ³•</li><li>åœ¨<code>sync()</code>æ–¹æ³•ä¸­ï¼Œç”±äº<code>mSate</code>æ˜¯<code>STARTED</code>çŠ¶æ€ï¼Œè€Œ<code>mObserverMap</code>ä¸­çš„çŠ¶æ€éƒ½æ˜¯<code>RESUMED</code>ï¼Œé‚£ä¹ˆ<code>mState</code>å°äº<code>mObserverMap</code>ï¼Œå°±æ‰§è¡Œ<code>backwardPass()</code>æ–¹æ³•</li><li>æœ€åå°±ä¼šè°ƒç”¨<code>observer.dispatchEvent()</code>å»åˆ†å‘äº‹ä»¶</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å’Œ forwardPass() å·®ä¸å¤š</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">backwardPass</span><span class="params">(LifecycleOwner lifecycleOwner)</span> &#123;</span><br><span class="line">    Iterator&lt;Entry&lt;LifecycleObserver, ObserverWithState&gt;&gt; descendingIterator =</span><br><span class="line">            mObserverMap.descendingIterator();</span><br><span class="line">    <span class="keyword">while</span> (descendingIterator.hasNext() &amp;&amp; !mNewEventOccurred) &#123;</span><br><span class="line">        Entry&lt;LifecycleObserver, ObserverWithState&gt; entry = descendingIterator.next();</span><br><span class="line">        <span class="type">ObserverWithState</span> <span class="variable">observer</span> <span class="operator">=</span> entry.getValue();</span><br><span class="line">        <span class="keyword">while</span> ((observer.mState.compareTo(mState) &gt; <span class="number">0</span> &amp;&amp; !mNewEventOccurred</span><br><span class="line">                &amp;&amp; mObserverMap.contains(entry.getKey()))) &#123;</span><br><span class="line">            <span class="comment">// </span></span><br><span class="line">            <span class="type">Event</span> <span class="variable">event</span> <span class="operator">=</span> downEvent(observer.mState);</span><br><span class="line">            pushParentState(getStateAfter(event));</span><br><span class="line">            observer.dispatchEvent(lifecycleOwner, event);</span><br><span class="line">            popParentState();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * downEvent()</span></span><br><span class="line"><span class="comment"> * stateé™çº§æ‰€éœ€ç»å†çš„äº‹ä»¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Event <span class="title function_">downEvent</span><span class="params">(State state)</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (state) &#123;</span><br><span class="line">        <span class="keyword">case</span> INITIALIZED:</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>();</span><br><span class="line">        <span class="keyword">case</span> CREATED:</span><br><span class="line">            <span class="keyword">return</span> ON_DESTROY;</span><br><span class="line">        <span class="keyword">case</span> STARTED:</span><br><span class="line">            <span class="keyword">return</span> ON_STOP;</span><br><span class="line">        <span class="keyword">case</span> RESUMED:</span><br><span class="line">            <span class="keyword">return</span> ON_PAUSE;</span><br><span class="line">        <span class="keyword">case</span> DESTROYED:</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Unexpected state value &quot;</span> + state);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å°±æ˜¯äº‹ä»¶åˆ†å‘çš„è¿‡ç¨‹ã€‚</p><p>é‚£ä¹ˆå‰©ä¸‹æœ€åä¸€ä¸ªé—®é¢˜ï¼Œæ€ä¹ˆæ‰§è¡Œå›è°ƒæ–¹æ³•ï¼Ÿ</p><h1 id="3-æ‰§è¡Œå›è°ƒ"><a href="#3-æ‰§è¡Œå›è°ƒ" class="headerlink" title="3. æ‰§è¡Œå›è°ƒ"></a>3. æ‰§è¡Œå›è°ƒ</h1><p>å…¶å®è¿™å—æˆ‘ä»¬åˆšåˆšå·²ç»æåˆ°è¿‡äº†ï¼Œé‚£å°±æ˜¯åœ¨<code>sync()</code>æ–¹æ³•ä¸­ä¼šè°ƒç”¨<code>forwardPass()</code>å’Œ<code>backwardPass()</code>æ–¹æ³•ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•ä¸­éƒ½ä¼šè°ƒç”¨<code>observer.dispatchEvent(lifecycleOwner, event)</code>æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä»è¿™ä¸ªå…¥æ‰‹ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬å›é¡¾ä¸‹ï¼Œæˆ‘ä»¬æ·»åŠ è¿›å»çš„<code>observer</code>åˆ°åº•æ˜¯è°ï¼Ÿ<br>å›åˆ°<code>addObserver()</code>æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•å†…éƒ¨çš„ç¬¬äºŒè¡Œå’Œç¬¬ä¸‰è¡Œï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ObserverWithState</span> <span class="variable">statefulObserver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObserverWithState</span>(observer, initialState);</span><br><span class="line"><span class="type">ObserverWithState</span> <span class="variable">previous</span> <span class="operator">=</span> mObserverMap.putIfAbsent(observer, statefulObserver);</span><br></pre></td></tr></table></figure><br>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å–å‡ºæ¥çš„<code>observer</code>å…¶å®å°±æ˜¯è¿™å—çš„è¿™ä¸ª<code>statefulObserver</code>ï¼Œä»–æ˜¯è°ƒç”¨äº†ObserverWithStateçš„æ„é€ æ–¹æ³•æ„é€ å‡ºæ¥çš„ï¼Œå¹¶ä¸”æˆ‘ä»¬åé¢ä¹Ÿæ˜¯è°ƒç”¨çš„ä»–çš„<code>dispatchEvent()</code>æ–¹æ³•ï¼Œé‚£æˆ‘ä»¬å°±ç›´æ¥æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªç±»ï¼š</p><h2 id="3-1-ObserverWithState"><a href="#3-1-ObserverWithState" class="headerlink" title="3.1 ObserverWithState"></a>3.1 ObserverWithState</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ObserverWithState</span> &#123;</span><br><span class="line">    State mState;</span><br><span class="line">    LifecycleEventObserver mLifecycleObserver;</span><br><span class="line"></span><br><span class="line">    ObserverWithState(LifecycleObserver observer, State initialState) &#123;</span><br><span class="line">        mLifecycleObserver = Lifecycling.lifecycleEventObserver(observer);</span><br><span class="line">        mState = initialState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">dispatchEvent</span><span class="params">(LifecycleOwner owner, Event event)</span> &#123;</span><br><span class="line">        <span class="type">State</span> <span class="variable">newState</span> <span class="operator">=</span> getStateAfter(event);</span><br><span class="line">        mState = min(mState, newState);</span><br><span class="line">        mLifecycleObserver.onStateChanged(owner, event);</span><br><span class="line">        mState = newState;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™ä¸ªæºç å¯ä»¥çœ‹åˆ°ï¼Œå®ƒé‡Œé¢æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯<code>mSate</code>ï¼Œè¿™ä¸ªå°±æ˜¯è¿™ä¸ªObserverå½“å‰çš„çŠ¶æ€ï¼Œå¦ä¸€ä¸ªå°±æ˜¯<code>mLifecycleObserver</code>ï¼Œè¿™ä¸ªä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„Observerï¼Œä½†æ˜¯ä»–å¹¶ä¸æ˜¯ç›´æ¥æ‹¿ç€æˆ‘ä»¬ä¼ å…¥çš„<code>observer</code>ä½¿ç”¨ï¼Œè€Œæ˜¯è°ƒç”¨<code>Lifecycling.lifecycleEventObserver()</code>è¿”å›äº†ä¸€ä¸ªå€¼ï¼Œé‚£æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•åˆ°åº•æ˜¯å•¥ï¼š</p><h3 id="3-1-1-Lifecycling"><a href="#3-1-1-Lifecycling" class="headerlink" title="3.1.1 Lifecycling"></a>3.1.1 Lifecycling</h3><h4 id="3-1-1-1-Lifecycling-lifecycleEventObserver"><a href="#3-1-1-1-Lifecycling-lifecycleEventObserver" class="headerlink" title="3.1.1.1 Lifecycling # lifecycleEventObserver()"></a>3.1.1.1 Lifecycling # lifecycleEventObserver()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="keyword">static</span> LifecycleEventObserver <span class="title function_">lifecycleEventObserver</span><span class="params">(Object object)</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯ä¸æ˜¯è¿™ä¸¤ç§ç±»å‹çš„å¯¹è±¡</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isLifecycleEventObserver</span> <span class="operator">=</span> object <span class="keyword">instanceof</span> LifecycleEventObserver;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isFullLifecycleObserver</span> <span class="operator">=</span> object <span class="keyword">instanceof</span> FullLifecycleObserver;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å“ªç§ï¼Œè¿”å›å¯¹åº”çš„</span></span><br><span class="line">    <span class="comment">// ä½†æ˜¯æˆ‘ä»¬æ˜¯æ„é€ çš„LifecycleObserverçš„å­ç±»ï¼Œæ‰€ä»¥ä¸æ»¡è¶³ä¸‹é¢è¿™ä¸‰ç§if</span></span><br><span class="line">    <span class="keyword">if</span> (isLifecycleEventObserver &amp;&amp; isFullLifecycleObserver) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FullLifecycleObserverAdapter</span>((FullLifecycleObserver) object,</span><br><span class="line">                (LifecycleEventObserver) object);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isFullLifecycleObserver) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FullLifecycleObserverAdapter</span>((FullLifecycleObserver) object, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isLifecycleEventObserver) &#123;</span><br><span class="line">        <span class="keyword">return</span> (LifecycleEventObserver) object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å¾—åˆ°ä»–çš„classå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">final</span> Class&lt;?&gt; klass = object.getClass();</span><br><span class="line">    <span class="comment">// -&gt;&gt;&gt; å¤‡æ³¨1</span></span><br><span class="line">    <span class="comment">// è·å– type</span></span><br><span class="line">    <span class="comment">//   GENERATED_CALLBACK è¡¨ç¤ºæ³¨è§£ç”Ÿæˆçš„ä»£ç </span></span><br><span class="line">    <span class="comment">//   REFLECTIVE_CALLBACK è¡¨ç¤ºä½¿ç”¨åå°„</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">type</span> <span class="operator">=</span> getObserverConstructorType(klass);</span><br><span class="line">    <span class="keyword">if</span> (type == GENERATED_CALLBACK) &#123;</span><br><span class="line">        List&lt;Constructor&lt;? <span class="keyword">extends</span> <span class="title class_">GeneratedAdapter</span>&gt;&gt; constructors =</span><br><span class="line">                sClassToAdapters.get(klass);</span><br><span class="line">        <span class="keyword">if</span> (constructors.size() == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="type">GeneratedAdapter</span> <span class="variable">generatedAdapter</span> <span class="operator">=</span> createGeneratedAdapter(</span><br><span class="line">                    constructors.get(<span class="number">0</span>), object);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SingleGeneratedAdapterObserver</span>(generatedAdapter);</span><br><span class="line">        &#125;</span><br><span class="line">        GeneratedAdapter[] adapters = <span class="keyword">new</span> <span class="title class_">GeneratedAdapter</span>[constructors.size()];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; constructors.size(); i++) &#123;</span><br><span class="line">            adapters[i] = createGeneratedAdapter(constructors.get(i), object);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CompositeGeneratedAdaptersObserver</span>(adapters);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ReflectiveGenericLifecycleObserver</span>(object);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤‡æ³¨1</span></span><br><span class="line"><span class="comment"> * è¿”å›æ„é€ æ–¹æ³•çš„ç±»å‹</span></span><br><span class="line"><span class="comment"> *   å…ˆä»ç¼“å­˜(sCallbackCache)ä¸­æ‰¾ï¼Œæœ‰åˆ™ç›´æ¥è¿”å›</span></span><br><span class="line"><span class="comment"> *   æ²¡æœ‰åˆ™è°ƒç”¨resolveObserverCallbackTypeæ–¹æ³•è·å–å¹¶å°†ç»“æœç¼“å­˜</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getObserverConstructorType</span><span class="params">(Class&lt;?&gt; klass)</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­ç¼“å­˜é‡Œé¢æœ‰æ²¡æœ‰ï¼Œå¦‚æœæœ‰åˆ™ç›´æ¥è¿”å›</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">callbackCache</span> <span class="operator">=</span> sCallbackCache.get(klass);</span><br><span class="line">    <span class="keyword">if</span> (callbackCache != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> callbackCache;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// -&gt;&gt;&gt; å¤‡æ³¨2</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">type</span> <span class="operator">=</span> resolveObserverCallbackType(klass);</span><br><span class="line">    sCallbackCache.put(klass, type);</span><br><span class="line">    <span class="keyword">return</span> type;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤‡æ³¨2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">resolveObserverCallbackType</span><span class="params">(Class&lt;?&gt; klass)</span> &#123;</span><br><span class="line">    <span class="comment">// anonymous class bug:35073837</span></span><br><span class="line">    <span class="comment">// è·å¾—åŒ…åï¼Œå¦‚æœä¸ºnullï¼Œåˆ™æ˜¯åŒ¿åå†…éƒ¨ç±»</span></span><br><span class="line">    <span class="keyword">if</span> (klass.getCanonicalName() == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// å¯¹åº”è¿”å›ï¼Œè¡¨ç¤ºä½¿ç”¨åå°„</span></span><br><span class="line">        <span class="keyword">return</span> REFLECTIVE_CALLBACK;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯»æ‰¾æ³¨è§£ç”Ÿæˆçš„ GeneratedAdapter ç±»</span></span><br><span class="line">    Constructor&lt;? <span class="keyword">extends</span> <span class="title class_">GeneratedAdapter</span>&gt; constructor = generatedConstructor(klass);</span><br><span class="line">    <span class="keyword">if</span> (constructor != <span class="literal">null</span>) &#123;</span><br><span class="line">        sClassToAdapters.put(klass, Collections</span><br><span class="line">                .&lt;Constructor&lt;? <span class="keyword">extends</span> <span class="title class_">GeneratedAdapter</span>&gt;&gt;singletonList(constructor));</span><br><span class="line">        <span class="keyword">return</span> GENERATED_CALLBACK;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯»æ‰¾è¢«OnLifecycleEventæ³¨è§£çš„æ–¹æ³•</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">hasLifecycleMethods</span> <span class="operator">=</span> ClassesInfoCache.sInstance.hasLifecycleMethods(klass);</span><br><span class="line">    <span class="keyword">if</span> (hasLifecycleMethods) &#123;</span><br><span class="line">        <span class="keyword">return</span> REFLECTIVE_CALLBACK;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ²¡æœ‰æ‰¾åˆ°æ³¨è§£ç”Ÿæˆçš„ GeneratedAdapter ç±»ï¼Œä¹Ÿæ²¡æœ‰æ‰¾åˆ° OnLifecycleEvent æ³¨è§£ï¼Œ</span></span><br><span class="line">    <span class="comment">// åˆ™å‘ä¸Šå¯»æ‰¾çˆ¶ç±»</span></span><br><span class="line">    Class&lt;?&gt; superclass = klass.getSuperclass();</span><br><span class="line">    List&lt;Constructor&lt;? <span class="keyword">extends</span> <span class="title class_">GeneratedAdapter</span>&gt;&gt; adapterConstructors = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (isLifecycleParent(superclass)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (getObserverConstructorType(superclass) == REFLECTIVE_CALLBACK) &#123;</span><br><span class="line">            <span class="keyword">return</span> REFLECTIVE_CALLBACK;</span><br><span class="line">        &#125;</span><br><span class="line">        adapterConstructors = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(sClassToAdapters.get(superclass));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯»æ‰¾æ˜¯å¦æœ‰æ¥å£å®ç°</span></span><br><span class="line">    <span class="keyword">for</span> (Class&lt;?&gt; intrface : klass.getInterfaces()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!isLifecycleParent(intrface)) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (getObserverConstructorType(intrface) == REFLECTIVE_CALLBACK) &#123;</span><br><span class="line">            <span class="keyword">return</span> REFLECTIVE_CALLBACK;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (adapterConstructors == <span class="literal">null</span>) &#123;</span><br><span class="line">            adapterConstructors = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        adapterConstructors.addAll(sClassToAdapters.get(intrface));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (adapterConstructors != <span class="literal">null</span>) &#123;</span><br><span class="line">        sClassToAdapters.put(klass, adapterConstructors);</span><br><span class="line">        <span class="keyword">return</span> GENERATED_CALLBACK;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> REFLECTIVE_CALLBACK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­æˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯<code>hasLifecycleMethods</code>ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="title function_">hasLifecycleMethods</span><span class="params">(Class klass)</span> &#123;</span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">hasLifecycleMethods</span> <span class="operator">=</span> mHasLifecycleMethods.get(klass);</span><br><span class="line">    <span class="keyword">if</span> (hasLifecycleMethods != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> hasLifecycleMethods;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Method[] methods = getDeclaredMethods(klass);</span><br><span class="line">    <span class="keyword">for</span> (Method method : methods) &#123;</span><br><span class="line">        <span class="type">OnLifecycleEvent</span> <span class="variable">annotation</span> <span class="operator">=</span> method.getAnnotation(OnLifecycleEvent.class);</span><br><span class="line">        <span class="keyword">if</span> (annotation != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// Optimization for reflection, we know that this method is called</span></span><br><span class="line">            <span class="comment">// when there is no generated adapter. But there are methods with @OnLifecycleEvent</span></span><br><span class="line">            <span class="comment">// so we know that will use ReflectiveGenericLifecycleObserver,</span></span><br><span class="line">            <span class="comment">// so we createInfo in advance.</span></span><br><span class="line">            <span class="comment">// CreateInfo always initialize mHasLifecycleMethods for a class, so we don&#x27;t do it</span></span><br><span class="line">            <span class="comment">// here.</span></span><br><span class="line">            createInfo(klass, methods);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    mHasLifecycleMethods.put(klass, <span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¿™ä¸ªä»£ç å°±æ²¡å•¥å¥½è¯´çš„ï¼Œå•çº¯é€šè¿‡åå°„å»æ‰¾OnLifecycleEventæ³¨è§£ï¼Œæ‰€ä»¥ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬é€šè¿‡OnLifecycleEventæ³¨è§£å®ç°çš„Observeråˆ™è¿”å›çš„æ˜¯<code>REFLECTIVE_CALLBACK</code>ç±»å‹ï¼Œå¯¹åº”çš„<code>lifecycleEventObserver()</code>æ–¹æ³•è¿”å›çš„ä¹Ÿæ˜¯<code>new ReflectiveGenericLifecycleObserver(observer)</code>ã€‚</p><h3 id="3-1-2-ReflectiveGenericLifecycleObserver"><a href="#3-1-2-ReflectiveGenericLifecycleObserver" class="headerlink" title="3.1.2 ReflectiveGenericLifecycleObserver"></a>3.1.2 ReflectiveGenericLifecycleObserver</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ReflectiveGenericLifecycleObserver</span> <span class="keyword">implements</span> <span class="title class_">LifecycleEventObserver</span> &#123;</span><br><span class="line">    <span class="comment">// æˆ‘ä»¬ä¼ å…¥çš„observerå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object mWrapped;</span><br><span class="line">    <span class="comment">// é€šè¿‡åå°„ä»è¿™ä¸ªobserverå¯¹è±¡ä¸­è·å–çš„ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CallbackInfo mInfo;</span><br><span class="line"></span><br><span class="line">    ReflectiveGenericLifecycleObserver(Object wrapped) &#123;</span><br><span class="line">        mWrapped = wrapped;</span><br><span class="line">        <span class="comment">// é€šè¿‡åå°„æ¥è·å–ä¿¡æ¯ï¼Œä½†æ˜¯ä»£ç å¤ªé•¿ï¼Œä¹Ÿå¾ˆç®€å•ï¼Œå°±ä¸è¯¦ç»†å»è¯´äº†</span></span><br><span class="line">        mInfo = ClassesInfoCache.sInstance.getInfo(mWrapped.getClass());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onStateChanged</span><span class="params">(LifecycleOwner source, Event event)</span> &#123;</span><br><span class="line">        mInfo.invokeCallbacks(source, event, mWrapped);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œæˆ‘ä»¬ä¹‹å‰çš„<code>observer.dispatchEvent()</code>æ–¹æ³•ä¸­å®é™…ä¸Šè°ƒç”¨çš„æ˜¯<code>mLifecycleObserver.onStateChanged(owner, event)</code>ï¼Œæ‰€ä»¥æœ€åä¼šäº¤ç»™ReflectiveGenericLifecycleObserverçš„<code>onStateChanged()</code>æ–¹æ³•æ¥æ‰§è¡Œï¼Œè€Œè¿™ä¸ªæ–¹æ³•ä¸­åˆè°ƒç”¨äº†<code>mInfo.invokeCallbacks()</code>ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">invokeCallbacks</span><span class="params">(LifecycleOwner source, Lifecycle.Event event, Object target)</span> &#123;</span><br><span class="line">    invokeMethodsForEvent(mEventToHandlers.get(event), source, event, target);</span><br><span class="line">    invokeMethodsForEvent(mEventToHandlers.get(Lifecycle.Event.ON_ANY), source, event,</span><br><span class="line">            target);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">invokeMethodsForEvent</span><span class="params">(List&lt;MethodReference&gt; handlers,</span></span><br><span class="line"><span class="params">        LifecycleOwner source, Lifecycle.Event event, Object mWrapped)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (handlers != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> handlers.size() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            handlers.get(i).invokeCallback(source, event, mWrapped);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">invokeCallback</span><span class="params">(LifecycleOwner source, Lifecycle.Event event, Object target)</span> &#123;</span><br><span class="line">    <span class="comment">//noinspection TryWithIdenticalCatches</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (mCallType) &#123;</span><br><span class="line">            <span class="keyword">case</span> CALL_TYPE_NO_ARG:</span><br><span class="line">                mMethod.invoke(target);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> CALL_TYPE_PROVIDER:</span><br><span class="line">                mMethod.invoke(target, source);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> CALL_TYPE_PROVIDER_WITH_EVENT:</span><br><span class="line">                mMethod.invoke(target, source, event);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Failed to call observer method&quot;</span>, e.getCause());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¿™ä¸ªä»£ç å°±å¾ˆç®€å•äº†ï¼Œå°±æ˜¯åˆ©ç”¨åå°„å»æ‰§è¡Œã€‚</p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Android/">Android</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Jetpack/">Jetpack</category>
      
      <category domain="https://www.littlecorgi.top/tags/Lifecycle/">Lifecycle</category>
      
      
      <comments>https://www.littlecorgi.top/posts/53c3ccc1.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Androidæºç ä¹‹SharedPreferences</title>
      <link>https://www.littlecorgi.top/posts/24e17cf4.html</link>
      <guid>https://www.littlecorgi.top/posts/24e17cf4.html</guid>
      <pubDate>Sun, 05 Jul 2020 14:09:27 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;SharedPreferencesæºç åˆ†æ&quot;&gt;&lt;a href=&quot;#SharedPreferencesæºç åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;SharedPreferencesæºç åˆ†æ&quot;&gt;&lt;/a&gt;SharedPreferencesæºç åˆ†æ&lt;/h1&gt;&lt;h1 id=&quot;0-å‰è¨€&quot;&gt;&lt;a href=&quot;#0-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0. å‰è¨€&quot;&gt;&lt;/a&gt;0. å‰è¨€&lt;/h1&gt;&lt;p&gt;SharedPreferenceså¯ä»¥è¯´æ˜¯Androidä¸­æœ€å¸¸ç”¨çš„ä¸€ç§å­˜æ•°æ®åˆ°æ–‡ä»¶çš„æ–¹å¼ã€‚ä»–çš„æ•°æ®æ˜¯ä»¥é”®å€¼å¯¹çš„æ–¹å¼å­˜å‚¨åœ¨ &lt;code&gt;~/data/data/åŒ…å/shared_prefs&lt;/code&gt; è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­çš„ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªå­˜å‚¨æ¡†æ¶æ˜¯éå¸¸è½»é‡çº§çš„ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å­˜ä¸€äº›å°æ•°æ®æˆ–è€…æ˜¯ä¸€ä¸ªå°å‹çš„å¯åºåˆ—åŒ–çš„Beanå®ä½“ç±»çš„ï¼Œä½¿ç”¨SharedPreferencesæ˜¯æœ€æ˜æ™ºçš„é€‰æ‹©ã€‚&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="SharedPreferencesæºç åˆ†æ"><a href="#SharedPreferencesæºç åˆ†æ" class="headerlink" title="SharedPreferencesæºç åˆ†æ"></a>SharedPreferencesæºç åˆ†æ</h1><h1 id="0-å‰è¨€"><a href="#0-å‰è¨€" class="headerlink" title="0. å‰è¨€"></a>0. å‰è¨€</h1><p>SharedPreferenceså¯ä»¥è¯´æ˜¯Androidä¸­æœ€å¸¸ç”¨çš„ä¸€ç§å­˜æ•°æ®åˆ°æ–‡ä»¶çš„æ–¹å¼ã€‚ä»–çš„æ•°æ®æ˜¯ä»¥é”®å€¼å¯¹çš„æ–¹å¼å­˜å‚¨åœ¨ <code>~/data/data/åŒ…å/shared_prefs</code> è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­çš„ã€‚</p><p>è¿™ä¸ªå­˜å‚¨æ¡†æ¶æ˜¯éå¸¸è½»é‡çº§çš„ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å­˜ä¸€äº›å°æ•°æ®æˆ–è€…æ˜¯ä¸€ä¸ªå°å‹çš„å¯åºåˆ—åŒ–çš„Beanå®ä½“ç±»çš„ï¼Œä½¿ç”¨SharedPreferencesæ˜¯æœ€æ˜æ™ºçš„é€‰æ‹©ã€‚</p><span id="more"></span><h1 id="1-ä½¿ç”¨æ–¹æ³•"><a href="#1-ä½¿ç”¨æ–¹æ³•" class="headerlink" title="1. ä½¿ç”¨æ–¹æ³•"></a>1. ä½¿ç”¨æ–¹æ³•</h1><h2 id="1-1-è·å–SharedPreferences"><a href="#1-1-è·å–SharedPreferences" class="headerlink" title="1.1 è·å–SharedPreferences"></a>1.1 è·å–SharedPreferences</h2><p>åœ¨ä½¿ç”¨SharedPreferenceså‰ï¼Œæˆ‘ä»¬å¾—å…ˆè·å–åˆ°å®ƒã€‚</p><p>ç”±äºSharedPreferencesæ˜¯Androidå†…ç½®çš„ä¸€ä¸ªæ¡†æ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬æƒ³è¦è·å–åˆ°å®ƒéå¸¸çš„ç®€å•ï¼Œä¸éœ€è¦å¯¼å…¥ä»»ä½•ä¾èµ–ï¼Œç›´æ¥å†™ä»£ç å°±è¡Œã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥ä»‹ç»ä¸‹è·å–å¯¹è±¡çš„ä¸‰ä¸ªæ–¹å¼ï¼š</p><h3 id="1-1-1-Context-getSharedPreferences"><a href="#1-1-1-Context-getSharedPreferences" class="headerlink" title="1.1.1 Context # getSharedPreferences()"></a>1.1.1 Context # getSharedPreferences()</h3><p>é¦–å…ˆå°±æ˜¯å¯ä»¥è¯´æ˜¯æœ€å¸¸ç”¨çš„æ–¹æ³•ï¼Œé€šè¿‡Contextçš„<code>getSharedPreferences()</code> æ–¹æ³•å»è·å–åˆ°SharedPreferenceså¯¹è±¡ã€‚ç”±äºæ˜¯é€šè¿‡Contextè·å–çš„ï¼Œæ‰€ä»¥åŸºæœ¬ä¸ŠAndroidçš„æ‰€æœ‰åœºæ™¯æˆ‘ä»¬éƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•è·å–åˆ°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> SharedPreferences <span class="title function_">getSharedPreferences</span> <span class="params">(String name, </span></span><br><span class="line"><span class="params">                <span class="type">int</span> mode)</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯<code>name</code>å’Œ<code>mode</code>ï¼š</p><ul><li><code>name</code>ï¼šnameå°±æ˜¯æˆ‘ä»¬è¦å­˜å‚¨çš„SharedPreferencesæœ¬åœ°æ–‡ä»¶çš„åå­—ï¼Œè¿™ä¸ªå¯ä»¥è‡ªå®šä¹‰ã€‚ä½†æ˜¯å¦‚æœä½¿ç”¨åŒæ ·çš„nameçš„è¯ï¼Œæ°¸è¿œåªèƒ½è·å–åˆ°åŒä¸€ä¸ªSharedPreferencesçš„å¯¹è±¡ã€‚</li><li><code>mode</code>ï¼šmodeå°±æ˜¯æˆ‘ä»¬è¦è·å–çš„è¿™ä¸ªSharedPreferencesçš„è®¿é—®æ¨¡å¼ï¼ŒAndroidç»™æˆ‘ä»¬æä¾›äº†æŒºå¤šçš„æ¨¡å¼çš„ï¼Œä½†æ˜¯ç”±äºå…¶ä½™çš„æ¨¡å¼æˆ–å¤šæˆ–å°‘å­˜åœ¨ç€å®‰å…¨éšæ‚£(å› ä¸ºå…¶ä»–åº”ç”¨ä¹Ÿå¯ä»¥ç›´æ¥è·å–åˆ°)ï¼Œæ‰€ä»¥å°±å…¨éƒ¨éƒ½å¼ƒç”¨äº†ï¼Œç°åœ¨å°±åªæœ‰ä¸€ä¸ª<code>MODE_PRIVATE</code>æ¨¡å¼ã€‚</li></ul><p>æ­¤å¤–ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><p><code>Mode</code>çš„å¯é€‰å‚æ•°ï¼š</p><ul><li><code>MODE_PRIVATE</code>ï¼šç§æœ‰æ¨¡å¼ï¼Œè¯¥SharedPreferencesåªä¼šè¢«è°ƒç”¨ä»–çš„APPå»ä½¿ç”¨ï¼Œå…¶ä»–çš„APPæ— æ³•è·å–åˆ°è¿™ä¸ªSharedPreferencesã€‚</li><li><del><code>MODE_WORLD_READABLE</code></del>ï¼šAPI17è¢«å¼ƒç”¨ã€‚ä½¿ç”¨è¿™ä¸ªæ¨¡å¼ï¼Œæ‰€æœ‰çš„APPéƒ½å¯ä»¥å¯¹è¿™ä¸ªSharedPreferencesè¿›è¡Œè¯»æ“ä½œã€‚æ‰€ä»¥è¿™ä¸ªæ¨¡å¼è¢«Androidå®˜æ–¹ä¸¥å‰è­¦å‘Šç¦æ­¢ä½¿ç”¨ï¼ˆIt is strongly discouragedï¼‰ï¼Œå¹¶æ¨èä½¿ç”¨<code>ContentProvider</code>ã€<code>BroadcastReceiver</code>å’Œ<code>Service</code>ã€‚</li><li><del><code>MODE_WORLD_WRITEABLE</code></del>ï¼šAPI17è¢«å¼ƒç”¨ã€‚å’Œä¸Šé¢ç±»ä¼¼ï¼Œè¿™ä¸ªæ˜¯å¯ä»¥è¢«æ‰€æœ‰APPè¿›è¡Œå†™æ“ä½œã€‚åŒæ ·ä¹Ÿæ˜¯è¢«ä¸¥å‰è­¦å‘Šç¦æ­¢ä½¿ç”¨ã€‚</li><li><del><code>MODE_MULTI_PROCESS</code></del>ï¼šAPI23è¢«å¼ƒç”¨ã€‚ä½¿ç”¨äº†è¿™ä¸ªæ¨¡å¼ï¼Œå…è®¸å¤šä¸ªè¿›ç¨‹å¯¹åŒä¸€ä¸ªSharedPreferencesè¿›è¡Œæ“ä½œï¼Œä½†æ˜¯åæ¥ä¹Ÿè¢«å¯ç”¨äº†ï¼ŒåŸå› æ˜¯å› ä¸ºåœ¨æŸäº›Androidç‰ˆæœ¬ä¸‹ï¼Œè¿™ä¸ªæ¨¡å¼ä¸èƒ½å¯é çš„è¿è¡Œï¼Œå®˜æ–¹å»ºè®®å¦‚æœå¤šè¿›ç¨‹å»ºè®®ä½¿ç”¨<code>ContentProvider</code>å»æ“ä½œã€‚åœ¨åé¢æˆ‘ä»¬ä¼šè¯´ä¸ºå•¥å¤šè¿›ç¨‹ä¸‹ä¸å¯é ã€‚</li></ul><h3 id="1-1-2-Activity-getPreferences"><a href="#1-1-2-Activity-getPreferences" class="headerlink" title="1.1.2 Activity # getPreferences()"></a>1.1.2 Activity # getPreferences()</h3><p>è¿™ä¸ªæ–¹æ³•åªèƒ½åœ¨Activityä¸­æˆ–è€…é€šè¿‡Activityå¯¹è±¡å»ä½¿ç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> SharedPreferences <span class="title function_">getPreferences</span> <span class="params">(<span class="type">int</span> mode)</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ª<code>mode</code>å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°å’Œä¸Šé¢çš„<code>context#getSharedPreferences()</code>çš„<code>mode</code>å‚æ•°æ˜¯ä¸€æ ·çš„ã€‚å…¶å®è¿™ä¸ªæ–¹æ³•å’Œä¸Šé¢Contextçš„é‚£ä¸ªæ–¹æ³•æ˜¯ä¸€æ ·çš„ï¼Œä»–ä¸¤éƒ½æ˜¯è°ƒç”¨çš„<code>SharedPreferences getSharedPreferences(String name, int mode)</code>ã€‚åªä¸è¿‡Contextçš„éœ€è¦ä½ å»æŒ‡å®šæ–‡ä»¶åï¼Œè€Œè¿™ä¸ªæ–¹æ³•ä½ ä¸éœ€è¦æ‰‹åŠ¨å»æŒ‡å®šï¼Œè€Œæ˜¯ä¼šè‡ªåŠ¨å°†å½“å‰Activityçš„ç±»åä½œä¸ºäº†æ–‡ä»¶åã€‚</p><h3 id="1-1-3-PreferencesManager-getDefaultSharedPreferences"><a href="#1-1-3-PreferencesManager-getDefaultSharedPreferences" class="headerlink" title="1.1.3 PreferencesManager # getDefaultSharedPreferences()"></a>1.1.3 PreferencesManager # getDefaultSharedPreferences()</h3><p>è¿™ä¸ªä¸€èˆ¬ç”¨åœ¨Androidçš„è®¾ç½®é¡µé¢ä¸Šï¼Œæˆ–è€…è¯´ï¼Œæˆ‘ä»¬ä¹Ÿåªæœ‰åœ¨æ„å»ºè®¾ç½®é¡µé¢çš„æ—¶å€™æ‰ä¼šå»ä½¿ç”¨è¿™ä¸ªã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> SharedPreferences <span class="title function_">getDefaultSharedPreferences</span> <span class="params">(Context context)</span></span><br></pre></td></tr></table></figure><p>ä»–æ‰¿æ¥ä¸€ä¸ªcontextå‚æ•°ï¼Œå¹¶è‡ªåŠ¨å°†å½“å‰åº”ç”¨çš„æŠ¥åä½œä¸ºå‰ç¼€æ¥å‘½åæ–‡ä»¶ã€‚</p><h2 id="1-2-å­˜æ•°æ®"><a href="#1-2-å­˜æ•°æ®" class="headerlink" title="1.2 å­˜æ•°æ®"></a>1.2 å­˜æ•°æ®</h2><p>å¦‚æœéœ€è¦å¾€SharedPreferencesä¸­å­˜å‚¨æ•°æ®çš„è¯ï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½ç›´æ¥å¯¹SharedPreferenceså¯¹è±¡è¿›è¡Œæ“ä½œï¼Œå› ä¸ºSharedPreferencesæ²¡æœ‰æä¾›å­˜å‚¨æˆ–è€…ä¿®æ”¹æ•°æ®çš„æ¥å£ã€‚</p><p>å¦‚æœæƒ³è¦å¯¹SharedPreferenceså­˜å‚¨çš„æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œéœ€è¦é€šè¿‡<code>SharedPreferences.edit()</code>æ–¹æ³•å»è·å–åˆ°SharedPreferences.Editorå¯¹è±¡æ¥è¿›è¡Œæ“ä½œã€‚</p><p>è·å–åˆ°Editorå¯¹è±¡åï¼Œæˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨ä»–çš„<code>putXXX()</code>æ–¹æ³•è¿›è¡Œå­˜å‚¨äº†ï¼Œå­˜å‚¨ä¹‹åä¸€å®šè®°å¾—é€šè¿‡<code>apply()</code>å’Œ<code>commit()</code>æ–¹æ³•å»å°†æ•°æ®æäº¤ã€‚</p><p>è‡³äº<code>commit</code>å’Œ<code>apply</code>çš„åŒºåˆ«æˆ‘ä»¬åé¢ä¼šè¯´ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//æ­¥éª¤1ï¼šåˆ›å»ºä¸€ä¸ªSharedPreferenceså¯¹è±¡</span></span><br><span class="line"> SharedPreferences sharedPreferences= getSharedPreferences(<span class="string">&quot;data&quot;</span>,Context.MODE_PRIVATE);</span><br><span class="line"> <span class="comment">//æ­¥éª¤2ï¼š å®ä¾‹åŒ–SharedPreferences.Editorå¯¹è±¡</span></span><br><span class="line"> SharedPreferences.<span class="type">Editor</span> <span class="variable">editor</span> <span class="operator">=</span> sharedPreferences.edit();</span><br><span class="line"> <span class="comment">//æ­¥éª¤3ï¼šå°†è·å–è¿‡æ¥çš„å€¼æ”¾å…¥æ–‡ä»¶</span></span><br><span class="line"> editor.putString(<span class="string">&quot;name&quot;</span>, â€œTomâ€);</span><br><span class="line"> editor.putInt(<span class="string">&quot;age&quot;</span>, <span class="number">28</span>);</span><br><span class="line"> editor.putBoolean(<span class="string">&quot;marrid&quot;</span>,<span class="literal">false</span>);</span><br><span class="line"> <span class="comment">//æ­¥éª¤4ï¼šæäº¤               </span></span><br><span class="line"> editor.commit();</span><br><span class="line"> </span><br><span class="line"><span class="comment">// åˆ é™¤æŒ‡å®šæ•°æ®</span></span><br><span class="line"> editor.remove(<span class="string">&quot;name&quot;</span>);</span><br><span class="line"> editor.commit();</span><br><span class="line"> </span><br><span class="line"><span class="comment">// æ¸…ç©ºæ•°æ®</span></span><br><span class="line"> editor.clear();</span><br><span class="line"> editor.commit();</span><br></pre></td></tr></table></figure><h2 id="1-3-å–æ•°æ®"><a href="#1-3-å–æ•°æ®" class="headerlink" title="1.3 å–æ•°æ®"></a>1.3 å–æ•°æ®</h2><p>å–å€¼å°±å¾ˆç®€å•äº†ï¼Œæ„å»ºå‡ºSharedPreferencesçš„å¯¹è±¡åï¼Œå°±ç›´æ¥è°ƒç”¨SharedPreferencesçš„<code>getXXX()</code>æ–¹æ³•å°±è¡Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SharedPreferences</span> <span class="variable">sharedPreferences</span> <span class="operator">=</span> getSharedPreferences(<span class="string">&quot;data&quot;</span>, Context .MODE_PRIVATE);</span><br><span class="line"><span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> sharedPreferences.getString(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br></pre></td></tr></table></figure><h1 id="2-æºç åˆ†æ"><a href="#2-æºç åˆ†æ" class="headerlink" title="2. æºç åˆ†æ"></a>2. æºç åˆ†æ</h1><h2 id="2-1-è·å–SharedPreferenceså®ä¾‹"><a href="#2-1-è·å–SharedPreferenceså®ä¾‹" class="headerlink" title="2.1 è·å–SharedPreferenceså®ä¾‹"></a>2.1 è·å–SharedPreferenceså®ä¾‹</h2><p>æˆ‘ä»¬ä¸Šé¢è¯´åˆ°ï¼Œè·å–SharedPreferenceså®ä¾‹æœ€å¸¸ç”¨çš„æ–¹æ³•å°±æ˜¯<code>Context#getSharedPreferences()</code>ã€‚é‚£æˆ‘ä»¬å°±ä»è¿™ä¸ªæ–¹æ³•å…¥æ‰‹ï¼Œçœ‹åˆ°åº•æ˜¯æ€ä¹ˆè·å–åˆ°SharedPreferenceså®ä¾‹çš„ã€‚</p><p>æˆ‘ä»¬å…ˆçœ‹ä¸‹è¿™ä¸ªæ–¹æ³•çš„å®ç°ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContextWrapper</span> <span class="keyword">extends</span> <span class="title class_">Context</span> &#123;</span><br><span class="line">    <span class="meta">@UnsupportedAppUsage</span></span><br><span class="line">    Context mBase;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> SharedPreferences <span class="title function_">getSharedPreferences</span><span class="params">(String name, <span class="type">int</span> mode)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mBase.getSharedPreferences(name, mode);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å¯ä»¥çœ‹åˆ°ä»–åˆè°ƒç”¨äº†Contextçš„<code>getSharedPreferences()</code>æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> SharedPreferences <span class="title function_">getSharedPreferences</span><span class="params">(String name, <span class="meta">@PreferencesMode</span> <span class="type">int</span> mode)</span>;</span><br></pre></td></tr></table></figure></p><p>ç„¶åæˆ‘ä»¬å°±ä¼šæƒŠå–œçš„å‘ç°ï¼Œè¿™æ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ã€‚æˆ‘å¼€å§‹è¿˜æƒ³å»æ‰¾ä¸€ä¸ª<code>ContextWrapper</code>çš„æ„é€ çš„åœ°æ–¹ï¼Œçœ‹çœ‹<code>mBase</code>ä¼ å…¥çš„æ˜¯å•¥ï¼Œåæ¥æ‰¾äº†ä¸€åœˆæ²¡æ‰¾åˆ°ï¼Œç›´æ¥ä¸Šç½‘æœç´¢ï¼Œç«‹é©¬å¾—åˆ°ç­”æ¡ˆï¼š<code>ContextImpl</code>ï¼Œè¿™ä¸ªå¯ä»¥è¯´æ˜¯<code>Context</code>åœ¨Androidä¸­çš„å”¯ä¸€å®ç°ç±»ï¼Œæ‰€æœ‰çš„æ“ä½œåˆå¾—ç»è¿‡è¿™ä¸ªç±»ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±æ¥çœ‹ä¸‹è¿™ä¸ªç±»ä¸­çš„<code>getSharedPreferences()</code>æ–¹æ³•çš„å®ç°ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> SharedPreferences <span class="title function_">getSharedPreferences</span><span class="params">(String name, <span class="type">int</span> mode)</span> &#123;</span><br><span class="line">    <span class="comment">// At least one application in the world actually passes in a null</span></span><br><span class="line">    <span class="comment">// name.  This happened to work because when we generated the file name</span></span><br><span class="line">    <span class="comment">// we would stringify it to &quot;null.xml&quot;.  Nice. </span></span><br><span class="line">            <span class="comment">// ps:è¿™ä¸ªniceå¾ˆç²¾é«“ğŸ˜‚</span></span><br><span class="line">    <span class="keyword">if</span> (mPackageInfo.getApplicationInfo().targetSdkVersion &lt;</span><br><span class="line">            Build.VERSION_CODES.KITKAT) &#123;</span><br><span class="line">        <span class="keyword">if</span> (name == <span class="literal">null</span>) &#123;</span><br><span class="line">            name = <span class="string">&quot;null&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    File file;</span><br><span class="line">    <span class="comment">// åŠ äº†ä¸€ä¸ªç±»é”ï¼Œä¿è¯åŒæ­¥</span></span><br><span class="line">    <span class="keyword">synchronized</span> (ContextImpl.class) &#123;</span><br><span class="line">        <span class="comment">// mSharedPrefsPathsæ˜¯ä¸€ä¸ªä¿å­˜äº†nameå’Œfileå¯¹åº”å…³ç³»çš„ArrayMap</span></span><br><span class="line">        <span class="keyword">if</span> (mSharedPrefsPaths == <span class="literal">null</span>) &#123;</span><br><span class="line">            mSharedPrefsPaths = <span class="keyword">new</span> <span class="title class_">ArrayMap</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ ¹æ®nameä»é‡Œé¢æ‰¾æœ‰æ²¡æœ‰ç¼“å­˜çš„file</span></span><br><span class="line">        file = mSharedPrefsPaths.get(name);</span><br><span class="line">        <span class="comment">// å¦‚æœæ²¡æœ‰ï¼Œé‚£å°±è°ƒç”¨getSharedPreferencesPathå»æ‰¾</span></span><br><span class="line">        <span class="keyword">if</span> (file == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// -&gt;&gt;&gt; é‡ç‚¹1. getSharedPreferencesPath(name)</span></span><br><span class="line">            file = getSharedPreferencesPath(name);</span><br><span class="line">            <span class="comment">// å¹¶ä¿å­˜åˆ°mSharedPrefsPaths</span></span><br><span class="line">            mSharedPrefsPaths.put(name, file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è·å–åˆ°fileåï¼Œå†è°ƒç”¨getSharedPreferences</span></span><br><span class="line">    <span class="keyword">return</span> getSharedPreferences(file, mode);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é‡ç‚¹1. ContextImpl # getSharedPreferencesPath(String name)</span></span><br><span class="line"><span class="comment"> *   æ ¹æ®PreferencesDirå’Œname.xmlå»åˆ›å»ºäº†è¿™ä¸ªæ–‡ä»¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> File <span class="title function_">getSharedPreferencesPath</span><span class="params">(String name)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> makeFilename(getPreferencesDir(), name + <span class="string">&quot;.xml&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é‚£æˆ‘ä»¬åœ¨çœ‹ä¸‹<code>getSharedPreferences(File file, int mode)</code>çš„å®ç°ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> SharedPreferences <span class="title function_">getSharedPreferences</span><span class="params">(File file, <span class="type">int</span> mode)</span> &#123;</span><br><span class="line">    <span class="comment">// SharedPreferenceså”¯ä¸€å®ç°ç±»SharedPreferencesImplçš„å®ä¾‹</span></span><br><span class="line">    SharedPreferencesImpl sp;</span><br><span class="line">    <span class="comment">// åŒæ ·çš„åŠ ç±»é”</span></span><br><span class="line">    <span class="keyword">synchronized</span> (ContextImpl.class) &#123;</span><br><span class="line">        <span class="comment">// æ„é€ äº†ä¸€ä¸ªFile-SharedPreferencesImplå¯¹åº”å…³ç³»çš„ArrayMap</span></span><br><span class="line">        <span class="comment">// è°ƒç”¨getSharedPreferencesCacheLockedæ–¹æ³•åŒºè·å–cahce</span></span><br><span class="line">        <span class="comment">// -&gt;&gt;&gt; é‡ç‚¹1</span></span><br><span class="line">        <span class="keyword">final</span> ArrayMap&lt;File, SharedPreferencesImpl&gt; cache = getSharedPreferencesCacheLocked();</span><br><span class="line">        <span class="comment">// ä»file-SharedPreferencesImplé”®å€¼å¯¹ä¸­æ ¹æ®å½“å‰fileå»è¿‡å»SharedPreferencesImplå®ä¾‹</span></span><br><span class="line">        sp = cache.get(file);</span><br><span class="line">        <span class="comment">// å¦‚æœæ²¡æœ‰ï¼Œé‚£å°±éœ€è¦æ–°å»ºä¸€ä¸ª</span></span><br><span class="line">        <span class="keyword">if</span> (sp == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// æ£€æŸ¥modeï¼Œå¦‚æœæ˜¯MODE_WORLD_WRITEABLEæˆ–è€…MODE_MULTI_PROCESSåˆ™ç›´æ¥æŠ›å¼‚å¸¸</span></span><br><span class="line">            checkMode(mode);</span><br><span class="line">            <span class="keyword">if</span> (getApplicationInfo().targetSdkVersion &gt;= android.os.Build.VERSION_CODES.O) &#123;</span><br><span class="line">                <span class="keyword">if</span> (isCredentialProtectedStorage()</span><br><span class="line">                        &amp;&amp; !getSystemService(UserManager.class)</span><br><span class="line">                                .isUserUnlockingOrUnlocked(UserHandle.myUserId())) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;SharedPreferences in credential encrypted &quot;</span></span><br><span class="line">                            + <span class="string">&quot;storage are not available until after user is unlocked&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// è°ƒç”¨æ„é€ æ–¹æ³•å»æ„é€ SharedPreferencesImplå¯¹è±¡</span></span><br><span class="line">            sp = <span class="keyword">new</span> <span class="title class_">SharedPreferencesImpl</span>(file, mode);</span><br><span class="line">            <span class="comment">// å°†å¯¹è±¡å’Œfileçš„é”®å€¼å¯¹å­˜å…¥cacheä¸­</span></span><br><span class="line">            cache.put(file, sp);</span><br><span class="line">            <span class="keyword">return</span> sp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ((mode &amp; Context.MODE_MULTI_PROCESS) != <span class="number">0</span> ||</span><br><span class="line">        getApplicationInfo().targetSdkVersion &lt; android.os.Build.VERSION_CODES.HONEYCOMB) &#123;</span><br><span class="line">        <span class="comment">// If somebody else (some other process) changed the prefs</span></span><br><span class="line">        <span class="comment">// file behind our back, we reload it.  This has been the</span></span><br><span class="line">        <span class="comment">// historical (if undocumented) behavior.</span></span><br><span class="line">        sp.startReloadIfChangedUnexpectedly();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é‡ç‚¹1. ContextImap # getSharedPreferencesCacheLocked()</span></span><br><span class="line"><span class="comment"> *   æ ¹æ®å½“å‰çš„åŒ…åï¼Œå»è·å–åˆ°ç”±æ­¤åº”ç”¨åˆ›å»ºçš„File-SharedPreferencesImplçš„Mapå¯¹è±¡ï¼Œ</span></span><br><span class="line"><span class="comment"> *       è€Œè¿™ä¸ªå¯¹è±¡é‡Œé¢å°±å­˜æ”¾äº†è¿™ä¸ªåº”ç”¨åˆ›å»ºçš„æ‰€æœ‰çš„SharedPreferencesImplå’ŒFileçš„å¯¹åº”å…³ç³»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GuardedBy(&quot;ContextImpl.class&quot;)</span></span><br><span class="line"><span class="keyword">private</span> ArrayMap&lt;File, SharedPreferencesImpl&gt; <span class="title function_">getSharedPreferencesCacheLocked</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœsSharedPrefsCacheä¸ºç©ºå°±æ„é€ ä¸€ä¸ªArrayMap</span></span><br><span class="line">    <span class="comment">// sSharedPrefsCacheå°±æ˜¯ä¸€ä¸ªå­˜æ”¾String-String, ArrayMap&lt;File, SharedPreferencesImpl&gt;çš„Map</span></span><br><span class="line">    <span class="comment">// æ¢å¥è¯è¯´ï¼Œä¹Ÿå°±æ˜¯å­˜æ”¾åŒ…å-packagePrefså¯¹åº”å…³ç³»çš„Map</span></span><br><span class="line">    <span class="keyword">if</span> (sSharedPrefsCache == <span class="literal">null</span>) &#123;</span><br><span class="line">        sSharedPrefsCache = <span class="keyword">new</span> <span class="title class_">ArrayMap</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–åŒ…å</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">String</span> <span class="variable">packageName</span> <span class="operator">=</span> getPackageName();</span><br><span class="line">    <span class="comment">// åˆ°sSharedPrefsCacheä¸­æ‰¾</span></span><br><span class="line">    ArrayMap&lt;File, SharedPreferencesImpl&gt; packagePrefs = sSharedPrefsCache.get(packageName);</span><br><span class="line">    <span class="comment">// å¦‚æœæ‰¾ä¸åˆ°ï¼Œå°±æ„å»ºä¸€ä¸ªç„¶åå­˜è¿›å»</span></span><br><span class="line">    <span class="keyword">if</span> (packagePrefs == <span class="literal">null</span>) &#123;</span><br><span class="line">        packagePrefs = <span class="keyword">new</span> <span class="title class_">ArrayMap</span>&lt;&gt;();</span><br><span class="line">        sSharedPrefsCache.put(packageName, packagePrefs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰¾å¾—åˆ°å°±è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> packagePrefs;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="2-2-æ„å»ºSharedPreferencesImpl"><a href="#2-2-æ„å»ºSharedPreferencesImpl" class="headerlink" title="2.2 æ„å»ºSharedPreferencesImpl"></a>2.2 æ„å»ºSharedPreferencesImpl</h2><h3 id="2-2-1-SharedPreferencesImplæ„é€ æ–¹æ³•"><a href="#2-2-1-SharedPreferencesImplæ„é€ æ–¹æ³•" class="headerlink" title="2.2.1 SharedPreferencesImplæ„é€ æ–¹æ³•"></a>2.2.1 SharedPreferencesImplæ„é€ æ–¹æ³•</h3><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹è¿™ä¸ªç±»çš„æ„é€ æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@UnsupportedAppUsage</span></span><br><span class="line">SharedPreferencesImpl(File file, <span class="type">int</span> mode) &#123;</span><br><span class="line">    mFile = file;</span><br><span class="line">    <span class="comment">// fileçš„å¤‡ä»½æ–‡ä»¶</span></span><br><span class="line">    mBackupFile = makeBackupFile(file);</span><br><span class="line">    mMode = mode;</span><br><span class="line">    <span class="comment">// ä»ç£ç›˜åŠ è½½çš„æ ‡å¿—ï¼Œå½“éœ€è¦ä»ç£ç›˜åŠ è½½æ—¶å°†å…¶è®¾ä¸ºtrueï¼Œè¿™æ ·å¦‚æœæœ‰å…¶ä»–çº¿ç¨‹ä¹Ÿè°ƒç”¨äº†SharedPreferencesçš„åŠ è½½æ–¹æ³•æ—¶ï¼Œå°±ä¼šå› ä¸ºå…¶ä¸ºtrueè€Œç›´æ¥è¿”å›ä¹Ÿå°±ä¸æ‰§è¡ŒåŠ è½½æ–¹æ³•</span></span><br><span class="line">    <span class="comment">// ä¿è¯äº†å…¨å±€åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨åŠ è½½</span></span><br><span class="line">    mLoaded = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// SharedPreferencesä¸­çš„æ•°æ®</span></span><br><span class="line">    mMap = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// ä¿å­˜çš„é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">    mThrowable = <span class="literal">null</span>;</span><br><span class="line">    startLoadFromDisk();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åˆå§‹åŒ–å‚æ•°åç«‹é©¬è°ƒç”¨äº†<code>startLoadFromDisk()</code>æ–¹æ³•ï¼š</p><h3 id="2-2-2-startLoadFromDisk"><a href="#2-2-2-startLoadFromDisk" class="headerlink" title="2.2.2 startLoadFromDisk()"></a>2.2.2 startLoadFromDisk()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@UnsupportedAppUsage</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">startLoadFromDisk</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (mLock) &#123;</span><br><span class="line">        mLoaded = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¼€å¯ä¸€ä¸ªæ–°çº¿ç¨‹æ¥åŠ è½½æ•°æ®</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;SharedPreferencesImpl-load&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            loadFromDisk();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-3-loadFromDIsk"><a href="#2-2-3-loadFromDIsk" class="headerlink" title="2.2.3 loadFromDIsk()"></a>2.2.3 loadFromDIsk()</h3><p><code>loadFromDisk()</code>:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">loadFromDisk</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (mLock) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå·²ç»å®¶åœ¨è¿‡äº†ï¼Œå°±ç›´æ¥é€€å‡º</span></span><br><span class="line">        <span class="keyword">if</span> (mLoaded) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœå¤‡ä»½æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œé‚£å°±åˆ é™¤æºæ–‡ä»¶ï¼Œå¹¶å°†å¤‡ä»½æ–‡ä»¶æ›¿æ¢ä¸ºæºæ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">if</span> (mBackupFile.exists()) &#123;</span><br><span class="line">            mFile.delete();</span><br><span class="line">            mBackupFile.renameTo(mFile);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Debugging</span></span><br><span class="line">    <span class="keyword">if</span> (mFile.exists() &amp;&amp; !mFile.canRead()) &#123;</span><br><span class="line">        Log.w(TAG, <span class="string">&quot;Attempt to read preferences file &quot;</span> + mFile + <span class="string">&quot; without permission&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å­˜å‚¨èšçš„map</span></span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// æ–‡ä»¶ä¿¡æ¯ï¼Œå¯¹åº”çš„æ˜¯Cè¯­è¨€stat.hä¸­çš„struct stat</span></span><br><span class="line">    <span class="type">StructStat</span> <span class="variable">stat</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">Throwable</span> <span class="variable">thrown</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// é€šè¿‡æ–‡ä»¶è·¯å¾„å»æ„å»ºStructStatå¯¹è±¡</span></span><br><span class="line">        stat = Os.stat(mFile.getPath());</span><br><span class="line">        <span class="keyword">if</span> (mFile.canRead()) &#123;</span><br><span class="line">            <span class="comment">// ä»XMLä¸­æŠŠæ•°æ®è¯»å‡ºæ¥ï¼Œå¹¶æŠŠæ•°æ®è½¬åŒ–æˆMapç±»å‹</span></span><br><span class="line">            <span class="type">BufferedInputStream</span> <span class="variable">str</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                str = <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(mFile), <span class="number">16</span> * <span class="number">1024</span>);</span><br><span class="line">                map = (Map&lt;String, Object&gt;) XmlUtils.readMapXml(str);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                Log.w(TAG, <span class="string">&quot;Cannot read &quot;</span> + mFile.getAbsolutePath(), e);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                IoUtils.closeQuietly(str);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ErrnoException e) &#123;</span><br><span class="line">        <span class="comment">// An errno exception means the stat failed. Treat as empty/non-existing by</span></span><br><span class="line">        <span class="comment">// ignoring.</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">        thrown = t;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">synchronized</span> (mLock) &#123;</span><br><span class="line">        mLoaded = <span class="literal">true</span>;</span><br><span class="line">        mThrowable = thrown;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// It&#x27;s important that we always signal waiters, even if we&#x27;ll make</span></span><br><span class="line">        <span class="comment">// them fail with an exception. The try-finally is pretty wide, but</span></span><br><span class="line">        <span class="comment">// better safe than sorry.</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (thrown == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// æ–‡ä»¶é‡Œæ‹¿åˆ°çš„æ•°æ®ä¸ºç©ºå°±é‡å»ºï¼Œå­˜åœ¨å°±èµ‹å€¼</span></span><br><span class="line">                <span class="keyword">if</span> (map != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// å°†æ•°æ®å­˜å‚¨æ”¾ç½®åˆ°å…·ä½“ç±»çš„ä¸€ä¸ªå…¨å±€å˜é‡ä¸­</span></span><br><span class="line">                    <span class="comment">// ç¨å¾®è®°ä¸€ä¸‹è¿™ä¸ªå…³é”®ç‚¹</span></span><br><span class="line">                    mMap = map;</span><br><span class="line">                    mStatTimestamp = stat.st_mtim;</span><br><span class="line">                    mStatSize = stat.st_size;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    mMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// In case of a thrown exception, we retain the old map. That allows</span></span><br><span class="line">            <span class="comment">// any open editors to commit and store updates.</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">            mThrowable = t;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            mLock.notifyAll();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>åˆ°ç›®å‰æ¥è¯´ï¼Œå°±å®Œæˆçš„SharedPreferencesImplçš„æ„å»ºè¿‡ç¨‹ã€‚</p><h2 id="2-3-è¯»æ•°æ®-SharedPreferences-getXXX"><a href="#2-3-è¯»æ•°æ®-SharedPreferences-getXXX" class="headerlink" title="2.3 è¯»æ•°æ® SharedPreferences # getXXX()"></a>2.3 è¯»æ•°æ® SharedPreferences # getXXX()</h2><p>ç›¸å¯¹æ¥è¯´ï¼Œè¯»æ•°æ®æ¶‰åŠåˆ°çš„æ–¹æ³•æ¯”å†™æ•°æ®ç®€å•å¾—å¤šï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹è¯»æ•°æ®ï¼š<br>æˆ‘ä»¬ä»¥<code>getString()</code>ä¸ºä¾‹</p><h3 id="2-3-1-getString"><a href="#2-3-1-getString" class="headerlink" title="2.3.1 getString"></a>2.3.1 getString</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getString</span><span class="params">(String key, <span class="meta">@Nullable</span> String defValue)</span> &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (mLock) &#123;</span><br><span class="line">        <span class="comment">// è§2.3.2</span></span><br><span class="line">        awaitLoadedLocked();</span><br><span class="line">        <span class="comment">// ä»mapä¸­è·å–æ•°æ®</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">v</span> <span class="operator">=</span> (String)mMap.get(key);</span><br><span class="line">        <span class="comment">// å¦‚æœè·å–åˆ°æ•°æ®ï¼Œå°±è¿”å›æ•°æ®ï¼Œå¦åˆ™è¿”å›æ–¹æ³•å‚æ•°ä¸­ç»™å®šçš„é»˜è®¤å€¼</span></span><br><span class="line">        <span class="keyword">return</span> v != <span class="literal">null</span> ? v : defValue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-2-awaitLoadedLocked"><a href="#2-3-2-awaitLoadedLocked" class="headerlink" title="2.3.2 awaitLoadedLocked"></a>2.3.2 awaitLoadedLocked</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GuardedBy(&quot;mLock&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">awaitLoadedLocked</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰åŠ è½½è¿‡ï¼Œåˆ™è¿›è¡ŒåŠ è½½</span></span><br><span class="line">    <span class="keyword">if</span> (!mLoaded) &#123;</span><br><span class="line">        <span class="comment">// Raise an explicit StrictMode onReadFromDisk for this</span></span><br><span class="line">        <span class="comment">// thread, since the real read will be in a different</span></span><br><span class="line">        <span class="comment">// thread and otherwise ignored by StrictMode.</span></span><br><span class="line">        BlockGuard.getThreadPolicy().onReadFromDisk();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰åŠ è½½è¿‡ï¼Œåˆ™ç­‰å¾…</span></span><br><span class="line">    <span class="keyword">while</span> (!mLoaded) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            mLock.wait();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException unused) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mThrowable != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(mThrowable);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•ç®€å•ç‚¹æ¥è¯´å°±æ˜¯å¦‚æœ<code>mLoad</code>ä¸ä¸ºtrueä¹Ÿå°±æ˜¯æ²¡æœ‰åŠ è½½å®Œæˆçš„è¯ï¼Œå°±ç­‰å¾…åŠ è½½å®Œæˆã€‚</p><h2 id="2-4-å†™æ•°æ®"><a href="#2-4-å†™æ•°æ®" class="headerlink" title="2.4 å†™æ•°æ®"></a>2.4 å†™æ•°æ®</h2><h3 id="2-4-1-SharedPreferences-Editor"><a href="#2-4-1-SharedPreferences-Editor" class="headerlink" title="2.4.1 SharedPreferences.Editor"></a>2.4.1 SharedPreferences.Editor</h3><p>ä½†æ˜¯å…‰æ„å»ºäº†å¯¹è±¡è¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬è¿˜å¾—èƒ½å¯¹å¥¹è¿›è¡Œæ“ä½œã€‚æˆ‘ä»¬å‰é¢è¯´åˆ°è¿‡ï¼ŒSharedPreferenceså¹¶ä¸æä¾›ä¿®æ”¹çš„åŠŸèƒ½ï¼Œå¦‚æœä½ æƒ³å¯¹å¥¹è¿›è¡Œä¿®æ”¹ï¼Œå¿…é¡»é€šè¿‡<code>SharedPreferences.Editor</code>æ¥å®ç°ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸‹<code>SharedPreferences.edit()</code>:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Editor <span class="title function_">edit</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> remove the need to call awaitLoadedLocked() when</span></span><br><span class="line">    <span class="comment">// requesting an editor.  will require some work on the</span></span><br><span class="line">    <span class="comment">// Editor, but then we should be able to do:</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">//      context.getSharedPreferences(..).edit().putString(..).apply()</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// ... all without blocking.</span></span><br><span class="line">    <span class="keyword">synchronized</span> (mLock) &#123;</span><br><span class="line">        <span class="comment">// -&gt;&gt;&gt; é‡ç‚¹1</span></span><br><span class="line">        awaitLoadedLocked();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºäº†ä¸€ä¸ªEditorImplçš„å¯¹è±¡ï¼Œ</span></span><br><span class="line">    <span class="comment">// ä½†æ˜¯è¿™å—éœ€è¦æ³¨æ„ä¸‹ï¼Œæˆ‘ä»¬æƒ³å¯¹SharedPreferencesè¿›è¡Œä¿®æ”¹ï¼Œå°±å¿…é¡»è°ƒç”¨edit()æ–¹æ³•ï¼Œå°±ä¼šå»æ„å»ºä¸€ä¸ªæ–°çš„EditorImplå¯¹è±¡</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥ä¸ºäº†é¿å…ä¸å¿…è¦çš„å¼€é”€ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨æ—¶æœ€å¥½ä¸€æ¬¡æ€§å®Œæˆå¯¹æ•°æ®çš„æ“ä½œ</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EditorImpl</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é‡ç‚¹1ï¼šSharedPreferencesImpl # awaitLoadedLocked()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GuardedBy(&quot;mLock&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">awaitLoadedLocked</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!mLoaded) &#123;</span><br><span class="line">        <span class="comment">// Raise an explicit StrictMode onReadFromDisk for this</span></span><br><span class="line">        <span class="comment">// thread, since the real read will be in a different</span></span><br><span class="line">        <span class="comment">// thread and otherwise ignored by StrictMode.</span></span><br><span class="line">        BlockGuard.getThreadPolicy().onReadFromDisk();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (!mLoaded) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœè¿˜æ²¡æœ‰åŠ è½½å®Œæˆï¼Œå°±è¿›å…¥ç­‰å¾…çŠ¶æ€</span></span><br><span class="line">            mLock.wait();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException unused) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mThrowable != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(mThrowable);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="2-4-2-EditorImpl"><a href="#2-4-2-EditorImpl" class="headerlink" title="2.4.2 EditorImpl"></a>2.4.2 EditorImpl</h3><h4 id="2-4-2-1-putXXX"><a href="#2-4-2-1-putXXX" class="headerlink" title="2.4.2.1 putXXX()"></a>2.4.2.1 putXXX()</h4><p>é‚£æˆ‘ä»¬å†æ¥çœ‹ä¸‹<code>putXXX()</code>æ–¹æ³•ï¼Œæˆ‘ä»¬ä»¥<code>putString()</code>æ¥ä¸¾ä¾‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">EditorImpl</span> <span class="keyword">implements</span> <span class="title class_">Editor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">mEditorLock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å­˜æ•°æ®çš„HashMap</span></span><br><span class="line">    <span class="meta">@GuardedBy(&quot;mEditorLock&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; mModified = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GuardedBy(&quot;mEditorLock&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">mClear</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Editor <span class="title function_">putString</span><span class="params">(String key, <span class="meta">@Nullable</span> String value)</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (mEditorLock) &#123;</span><br><span class="line">            mModified.put(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p><code>putString()</code>æ–¹æ³•å¾ˆç®€å•ï¼Œç›´æ¥å°†æ•°æ®putåˆ°å­˜æ•°æ®çš„HashMapä¸­å»å°±è¡Œäº†ã€‚æˆ–è€…è¯´ï¼Œæ‰€æœ‰çš„<code>putXXX()</code>éƒ½æ˜¯è¿™ä¹ˆç®€å•ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å°†ä¿®æ”¹æäº¤åˆ°SharedPreferencesé‡Œé¢å»çš„è¯ï¼Œè¿˜éœ€è¦è°ƒç”¨<code>apply()</code>æˆ–è€…<code>commit()</code>æ–¹æ³•ï¼Œé‚£æˆ‘ä»¬ç°åœ¨æ¥çœ‹ä¸‹è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚</p><h4 id="2-4-2-2-apply"><a href="#2-4-2-2-apply" class="headerlink" title="2.4.2.2 apply()"></a>2.4.2.2 apply()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">apply</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–å½“å‰æ—¶é—´</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§2.2.3.4</span></span><br><span class="line">    <span class="comment">// æ„å»ºäº†ä¸€ä¸ªMemoryCommitResultçš„å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">MemoryCommitResult</span> <span class="variable">mcr</span> <span class="operator">=</span> commitToMemory();</span><br><span class="line">    <span class="comment">// æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå› ä¸ºæ•°æ®æ“ä½œæ˜¯å¾ˆè€—æ—¶çš„</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">Runnable</span> <span class="variable">awaitCommit</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// è¿›å…¥ç­‰å¾…çŠ¶æ€</span></span><br><span class="line">                    mcr.writtenToDiskLatch.await();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException ignored) &#123;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (DEBUG &amp;&amp; mcr.wasWritten) &#123;</span><br><span class="line">                    Log.d(TAG, mFile.getName() + <span class="string">&quot;:&quot;</span> + mcr.memoryStateGeneration</span><br><span class="line">                            + <span class="string">&quot; applied after &quot;</span> + (System.currentTimeMillis() - startTime)</span><br><span class="line">                            + <span class="string">&quot; ms&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†awaitCommitæ·»åŠ åˆ°Queueçš„Wordä¸­å»</span></span><br><span class="line">    QueuedWork.addFinisher(awaitCommit);</span><br><span class="line"></span><br><span class="line">    <span class="type">Runnable</span> <span class="variable">postWriteRunnable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="comment">// æ‰§è¡Œæ“ä½œï¼Œå¹¶ä»QueuedWordä¸­åˆ é™¤</span></span><br><span class="line">                awaitCommit.run();</span><br><span class="line">                QueuedWork.removeFinisher(awaitCommit);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">    SharedPreferencesImpl.<span class="built_in">this</span>.enqueueDiskWrite(mcr, postWriteRunnable);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Okay to notify the listeners before it&#x27;s hit disk</span></span><br><span class="line">    <span class="comment">// because the listeners should always get the same</span></span><br><span class="line">    <span class="comment">// SharedPreferences instance back, which has the</span></span><br><span class="line">    <span class="comment">// changes reflected in memory.</span></span><br><span class="line">    notifyListeners(mcr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-4-2-3-commit"><a href="#2-4-2-3-commit" class="headerlink" title="2.4.2.3 commit()"></a>2.4.2.3 commit()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">commit</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (DEBUG) &#123;</span><br><span class="line">        startTime = System.currentTimeMillis();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§2.2.3.4</span></span><br><span class="line">    <span class="comment">// æ„å»ºäº†ä¸€ä¸ªMemoryCommitResultå¯¹è±¡</span></span><br><span class="line">    <span class="type">MemoryCommitResult</span> <span class="variable">mcr</span> <span class="operator">=</span> commitToMemory();</span><br><span class="line">    <span class="comment">// å°†å†…å­˜æ•°æ®åŒæ­¥åˆ°æ–‡ä»¶</span></span><br><span class="line">    <span class="comment">// è§</span></span><br><span class="line">    SharedPreferencesImpl.<span class="built_in">this</span>.enqueueDiskWrite(</span><br><span class="line">        mcr, <span class="literal">null</span> <span class="comment">/* sync write on this thread okay */</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// è¿›å…¥ç­‰å¾…çŠ¶æ€, ç›´åˆ°å†™å…¥æ–‡ä»¶çš„æ“ä½œå®Œæˆ</span></span><br><span class="line">        mcr.writtenToDiskLatch.await();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (DEBUG) &#123;</span><br><span class="line">            Log.d(TAG, mFile.getName() + <span class="string">&quot;:&quot;</span> + mcr.memoryStateGeneration</span><br><span class="line">                    + <span class="string">&quot; committed after &quot;</span> + (System.currentTimeMillis() - startTime)</span><br><span class="line">                    + <span class="string">&quot; ms&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é€šçŸ¥ç›‘å¬åˆ™, å¹¶åœ¨ä¸»çº¿ç¨‹å›è°ƒonSharedPreferenceChanged()æ–¹æ³•</span></span><br><span class="line">    notifyListeners(mcr);</span><br><span class="line">    <span class="comment">// è¿”å›æ–‡ä»¶æ“ä½œçš„ç»“æœæ•°æ®</span></span><br><span class="line">    <span class="keyword">return</span> mcr.writeToDiskResult;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-4-2-4-commitToMemory"><a href="#2-4-2-4-commitToMemory" class="headerlink" title="2.4.2.4 commitToMemory()"></a>2.4.2.4 commitToMemory()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Returns true if any changes were made</span></span><br><span class="line"><span class="keyword">private</span> MemoryCommitResult <span class="title function_">commitToMemory</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// å½“å‰Memoryçš„çŠ¶æ€ï¼Œå…¶å®ä¹Ÿå°±æ˜¯å½“éœ€è¦æäº¤æ•°æ®åˆ°å†…å­˜çš„æ—¶å€™ï¼Œä»–çš„å€¼å°±åŠ ä¸€</span></span><br><span class="line">    <span class="type">long</span> memoryStateGeneration;</span><br><span class="line">    List&lt;String&gt; keysModified = <span class="literal">null</span>;</span><br><span class="line">    Set&lt;OnSharedPreferenceChangeListener&gt; listeners = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// å­˜æ•°æ®çš„Map</span></span><br><span class="line">    Map&lt;String, Object&gt; mapToWriteToDisk;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">synchronized</span> (SharedPreferencesImpl.<span class="built_in">this</span>.mLock) &#123;</span><br><span class="line">        <span class="comment">// We optimistically don&#x27;t make a deep copy until</span></span><br><span class="line">        <span class="comment">// a memory commit comes in when we&#x27;re already</span></span><br><span class="line">        <span class="comment">// writing to disk.</span></span><br><span class="line">        <span class="comment">// å¦‚æœæœ‰æ•°æ®å¾…è¢«æäº¤åˆ°ç¡¬ç›˜</span></span><br><span class="line">        <span class="keyword">if</span> (mDiskWritesInFlight &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// We can&#x27;t modify our mMap as a currently</span></span><br><span class="line">            <span class="comment">// in-flight write owns it.  Clone it before</span></span><br><span class="line">            <span class="comment">// modifying it.</span></span><br><span class="line">            <span class="comment">// noinspection unchecked</span></span><br><span class="line">            mMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;(mMap);</span><br><span class="line">        &#125;</span><br><span class="line">        mapToWriteToDisk = mMap;</span><br><span class="line">        <span class="comment">// 2.2.3.5çš„å…³é”®ç‚¹</span></span><br><span class="line">        mDiskWritesInFlight++;</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">hasListeners</span> <span class="operator">=</span> mListeners.size() &gt; <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (hasListeners) &#123;</span><br><span class="line">            keysModified = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line">            listeners = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;OnSharedPreferenceChangeListener&gt;(mListeners.keySet());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">synchronized</span> (mEditorLock) &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">changesMade</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å¦‚æœmClearä¸ºtrueï¼Œå°±æ¸…ç©ºmapToWriteToDisk</span></span><br><span class="line">            <span class="keyword">if</span> (mClear) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!mapToWriteToDisk.isEmpty()) &#123;</span><br><span class="line">                    changesMade = <span class="literal">true</span>;</span><br><span class="line">                    mapToWriteToDisk.clear();</span><br><span class="line">                &#125;</span><br><span class="line">                mClear = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;String, Object&gt; e : mModified.entrySet()) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">k</span> <span class="operator">=</span> e.getKey();</span><br><span class="line">                <span class="type">Object</span> <span class="variable">v</span> <span class="operator">=</span> e.getValue();</span><br><span class="line">                <span class="comment">// &quot;this&quot; is the magic value for a removal mutation. In addition,</span></span><br><span class="line">                <span class="comment">// setting a value to &quot;null&quot; for a given key is specified to be</span></span><br><span class="line">                <span class="comment">// equivalent to calling remove on that key.</span></span><br><span class="line">                <span class="keyword">if</span> (v == <span class="built_in">this</span> || v == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!mapToWriteToDisk.containsKey(k)) &#123;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    mapToWriteToDisk.remove(k);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (mapToWriteToDisk.containsKey(k)) &#123;</span><br><span class="line">                        <span class="type">Object</span> <span class="variable">existingValue</span> <span class="operator">=</span> mapToWriteToDisk.get(k);</span><br><span class="line">                        <span class="keyword">if</span> (existingValue != <span class="literal">null</span> &amp;&amp; existingValue.equals(v)) &#123;</span><br><span class="line">                            <span class="keyword">continue</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    mapToWriteToDisk.put(k, v);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                changesMade = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">if</span> (hasListeners) &#123;</span><br><span class="line">                    keysModified.add(k);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            mModified.clear();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (changesMade) &#123;</span><br><span class="line">                mCurrentMemoryStateGeneration++;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            memoryStateGeneration = mCurrentMemoryStateGeneration;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MemoryCommitResult</span>(memoryStateGeneration, keysModified, listeners,</span><br><span class="line">            mapToWriteToDisk);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç åˆšå¼€å§‹çœ‹çš„æ—¶å€™æœ‰ç‚¹æ™•ï¼Œä½†æ˜¯çœ‹å®Œåå°±ç¬é—´æ‡‚äº†ï¼Œè¿™æ®µä»£ç ä¸»è¦æ‰§è¡Œäº†ä¸€ä¸‹çš„åŠŸèƒ½ï¼š</p><ul><li>å°†<code>mMap</code>èµ‹å€¼ç»™<code>mapToWriteToDisk</code></li><li>å½“<code>mClear</code>ä¸ºtrueçš„æ—¶å€™ï¼Œæ¸…ç©º<code>mapToWriteToDisk</code></li><li>éå†<code>mModified</code>ï¼Œ<code>mModified</code>ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢è¯´åˆ°çš„ä¿å­˜æœ¬æ¬¡editçš„æ•°æ®çš„HashMap<ul><li>å½“å½“å‰çš„<code>value</code>ä¸ºnullæˆ–è€…<code>this</code>çš„æ—¶å€™ï¼Œç§»é™¤å¯¹åº”çš„k</li></ul></li><li>æ„å»ºäº†ä¸€ä¸ª<code>MemoryCommitResult</code>å¯¹è±¡</li></ul><h4 id="2-4-2-5-SharedPreferencesImpl-enqueueDiskWrite"><a href="#2-4-2-5-SharedPreferencesImpl-enqueueDiskWrite" class="headerlink" title="2.4.2.5 SharedPreferencesImpl # enqueueDiskWrite()"></a>2.4.2.5 SharedPreferencesImpl # enqueueDiskWrite()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">enqueueDiskWrite</span><span class="params">(<span class="keyword">final</span> MemoryCommitResult mcr,</span></span><br><span class="line"><span class="params">                              <span class="keyword">final</span> Runnable postWriteRunnable)</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">isFromSyncCommit</span> <span class="operator">=</span> (postWriteRunnable == <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="type">Runnable</span> <span class="variable">writeToDiskRunnable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (mWritingToDiskLock) &#123;</span><br><span class="line">                    <span class="comment">// è¿™ä¸ªæ–¹æ³•è¿™å—å°±ä¸è®²äº†ï¼Œå¤ªé•¿äº†ï¼Œå¤§å®¶æ„Ÿå…´è¶£å¯ä»¥çœ‹ä¸‹</span></span><br><span class="line">                    <span class="comment">// ä¸»è¦åŠŸèƒ½å°±æ˜¯</span></span><br><span class="line">                    <span class="comment">//  1. å½“æ²¡æœ‰keyæ²¡æœ‰æ”¹å˜ï¼Œåˆ™ç›´æ¥è¿”å›äº†ï¼›å¦åˆ™æ‰§è¡Œä¸‹ä¸€æ­¥</span></span><br><span class="line">                    <span class="comment">//  2. å°†mMapå…¨éƒ¨ä¿¡æ¯å†™å…¥æ–‡ä»¶ï¼Œå¦‚æœå†™å…¥æˆåŠŸåˆ™åˆ é™¤å¤‡ä»½æ–‡ä»¶ï¼Œå¦‚æœå†™å…¥å¤±è´¥åˆ™åˆ é™¤mFile</span></span><br><span class="line">                    writeToFile(mcr, isFromSyncCommit);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">synchronized</span> (mLock) &#123;</span><br><span class="line">                    <span class="comment">// å½“å†™å…¥æˆåŠŸåï¼Œå°†æ ‡å¿—ä½å‡1</span></span><br><span class="line">                    mDiskWritesInFlight--;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// æ­¤æ—¶postWriteRunnableä¸ºnullä¸æ‰§è¡Œè¯¥æ–¹æ³•</span></span><br><span class="line">                <span class="keyword">if</span> (postWriteRunnable != <span class="literal">null</span>) &#123;</span><br><span class="line">                    postWriteRunnable.run();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Typical #commit() path with fewer allocations, doing a write on</span></span><br><span class="line">    <span class="comment">// the current thread.</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯commitåˆ™è¿›å…¥</span></span><br><span class="line">    <span class="keyword">if</span> (isFromSyncCommit) &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">wasEmpty</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">synchronized</span> (mLock) &#123;</span><br><span class="line">            <span class="comment">// ç”±äºcommitToMemoryä¼šè®©mDiskWritesInFlight+1ï¼Œåˆ™wasEmptyä¸ºtrue</span></span><br><span class="line">            wasEmpty = mDiskWritesInFlight == <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (wasEmpty) &#123;</span><br><span class="line">            <span class="comment">// åœ¨æ‰§è¡Œä¸€éä¸Šé¢çš„æ“ä½œï¼Œä¿è¯å°†commitçš„å†…å®¹ä¹Ÿä¿å­˜</span></span><br><span class="line">            writeToDiskRunnable.run();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯apply()æ–¹æ³•ï¼Œåˆ™ä¼šå°†ä»»åŠ¡æ”¾å…¥å•çº¿ç¨‹çš„çº¿ç¨‹æ± ä¸­å»æ‰§è¡Œ</span></span><br><span class="line">    QueuedWork.queue(writeToDiskRunnable, !isFromSyncCommit);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ä»è¿™ä¸ªæ–¹æ³•æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š</p><ul><li><code>commit()</code>æ˜¯ç›´æ¥åŒæ­¥æ‰§è¡Œçš„ï¼Œæœ‰æ•°æ®å°±å­˜å…¥ç£ç›˜</li><li><code>apply()</code>æ˜¯å…ˆå°†<code>awaitCommit</code>æ”¾å…¥<code>QueuedWork</code>ï¼Œç„¶ååœ¨å•çº¿ç¨‹çš„çº¿ç¨‹æ± ä¸­å»æ‰§è¡Œï¼Œæ‰§è¡Œå®Œæ¯•åå†å°†<code>awaitCommit</code>ä»<code>QeueudWork</code>ä¸­ç§»é™¤ã€‚</li></ul><h1 id="3-çŸ¥è¯†ç‚¹"><a href="#3-çŸ¥è¯†ç‚¹" class="headerlink" title="3. çŸ¥è¯†ç‚¹"></a>3. çŸ¥è¯†ç‚¹</h1><h2 id="3-1-applyå’Œcommitçš„åŒºåˆ«"><a href="#3-1-applyå’Œcommitçš„åŒºåˆ«" class="headerlink" title="3.1 applyå’Œcommitçš„åŒºåˆ«"></a>3.1 applyå’Œcommitçš„åŒºåˆ«</h2><ul><li>applyæ²¡æœ‰è¿”å›å€¼, commitæœ‰è¿”å›å€¼èƒ½çŸ¥é“ä¿®æ”¹æ˜¯å¦æäº¤æˆåŠŸ</li><li>applyæ˜¯å°†ä¿®æ”¹æäº¤åˆ°å†…å­˜ï¼Œå†å¼‚æ­¥æäº¤åˆ°ç£ç›˜æ–‡ä»¶; commitæ˜¯åŒæ­¥çš„æäº¤åˆ°ç£ç›˜æ–‡ä»¶;</li><li>å¤šå¹¶å‘çš„æäº¤commitæ—¶ï¼Œéœ€ç­‰å¾…æ­£åœ¨å¤„ç†çš„commitæ•°æ®æ›´æ–°åˆ°ç£ç›˜æ–‡ä»¶åæ‰ä¼šç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œä»è€Œé™ä½æ•ˆç‡; è€Œapplyåªæ˜¯åŸå­æ›´æ–°åˆ°å†…å­˜ï¼Œåè°ƒç”¨applyå‡½æ•°ä¼šç›´æ¥è¦†ç›–å‰é¢å†…å­˜æ•°æ®ï¼Œä»ä¸€å®šç¨‹åº¦ä¸Šæé«˜å¾ˆå¤šæ•ˆç‡ã€‚</li></ul><h2 id="3-2-å¤šè¿›ç¨‹çš„é—®é¢˜"><a href="#3-2-å¤šè¿›ç¨‹çš„é—®é¢˜" class="headerlink" title="3.2 å¤šè¿›ç¨‹çš„é—®é¢˜"></a>3.2 å¤šè¿›ç¨‹çš„é—®é¢˜</h2><p>æˆ‘ä»¬å‰é¢è¯´åˆ°äº†ï¼ŒSPæä¾›äº†å¤šè¿›ç¨‹è®¿é—®ï¼Œè™½è¯´æ²¡æœ‰åƒWorldæ¨¡å¼é‚£æ ·ä¼šç›´æ¥æŠ›å¼‚å¸¸ï¼Œä½†æ˜¯å®˜æ–¹ä¸å»ºè®®å¤šè¿›ç¨‹ä¸‹ä½¿ç”¨SPã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬ä¸ç¦ä¼šå¥½å¥‡ï¼Œå¤šè¿›ç¨‹ä¸‹è®¿é—®SPä¼šæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</p><p>æ¢ç©¶è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¾—å…ˆå›åˆ°<code>ContextImpl#getSharedPreferences(File file, int mode)</code>æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> SharedPreferences <span class="title function_">getSharedPreferences</span><span class="params">(File file, <span class="type">int</span> mode)</span> &#123;</span><br><span class="line">    <span class="comment">// ...å‰é¢çš„ä»£ç çœç•¥çš„ï¼Œå¦‚æœå¤§å®¶æƒ³å›å¿†ä¸‹ï¼Œå¯ä»¥è·³è½¬åˆ°2.1èŠ‚</span></span><br><span class="line">    <span class="keyword">if</span> ((mode &amp; Context.MODE_MULTI_PROCESS) != <span class="number">0</span> ||</span><br><span class="line">        getApplicationInfo().targetSdkVersion &lt; android.os.Build.VERSION_CODES.HONEYCOMB) &#123;</span><br><span class="line">        <span class="comment">// If somebody else (some other process) changed the prefs</span></span><br><span class="line">        <span class="comment">// file behind our back, we reload it.  This has been the</span></span><br><span class="line">        <span class="comment">// historical (if undocumented) behavior.</span></span><br><span class="line">        <span class="comment">// -&gt;&gt;&gt; é‡ç‚¹1</span></span><br><span class="line">        sp.startReloadIfChangedUnexpectedly();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é‡ç‚¹1 SharedPreferencesImpl # startReloadIfChangedUnexpectedly()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">startReloadIfChangedUnexpectedly</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (mLock) &#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> wait for any pending writes to disk?</span></span><br><span class="line">        <span class="comment">// -&gt;&gt;&gt; é‡ç‚¹2</span></span><br><span class="line">        <span class="keyword">if</span> (!hasFileChangedUnexpectedly()) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// -&gt;&gt;&gt; é‡ç‚¹3</span></span><br><span class="line">        startLoadFromDisk();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é‡ç‚¹2 SharedPreferencesImpl # hasFileChangedUnexpectedly()</span></span><br><span class="line"><span class="comment"> *  å¦‚æœæ–‡ä»¶å‘ç”Ÿäº†é¢„æœŸä¹‹å¤–çš„ä¿®æ”¹ï¼Œä¹Ÿå°±æ˜¯è¯´æœ‰å…¶ä»–è¿›ç¨‹åœ¨ä¿®æ”¹ï¼Œå°±è¿”å›trueï¼Œå¦åˆ™false</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">hasFileChangedUnexpectedly</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (mLock) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœmDiskWritesInFlightå¤§äº0ï¼Œå°±è¯æ˜æ˜¯åœ¨å½“å‰è¿›ç¨‹ä¸­ä¿®æ”¹çš„ï¼Œé‚£å°±ä¸ç”¨é‡æ–°è¯»å–</span></span><br><span class="line">        <span class="keyword">if</span> (mDiskWritesInFlight &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// If we know we caused it, it&#x27;s not unexpected.</span></span><br><span class="line">            <span class="keyword">if</span> (DEBUG) Log.d(TAG, <span class="string">&quot;disk write in flight, not unexpected.&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> StructStat stat;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Metadata operations don&#x27;t usually count as a block guard</span></span><br><span class="line"><span class="comment">         * violation, but we explicitly want this one.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        BlockGuard.getThreadPolicy().onReadFromDisk();</span><br><span class="line">        stat = Os.stat(mFile.getPath());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ErrnoException e) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">synchronized</span> (mLock) &#123;</span><br><span class="line">        <span class="keyword">return</span> !stat.st_mtim.equals(mStatTimestamp) || mStatSize != stat.st_size;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é‡ç‚¹3 SharedPreferencesImpl # startLoadFromDisk()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">startLoadFromDisk</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (mLock) &#123;</span><br><span class="line">        mLoaded = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;SharedPreferencesImpl-load&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="comment">// -&gt;&gt;&gt; é‡ç‚¹4ï¼Œè¿™å—ä»£ç å¯ä»¥å›åˆ°2.2.3çœ‹ä¸€ä¸‹</span></span><br><span class="line">            loadFromDisk();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼šæ¯æ¬¡è·å–SharedPreferenceså®ä¾‹çš„æ—¶å€™å°è¯•ä»ç£ç›˜ä¸­åŠ è½½æ•°æ®ï¼Œå¹¶ä¸”æ˜¯åœ¨å¼‚æ­¥çº¿ç¨‹ä¸­ï¼Œå› æ­¤ä¸€ä¸ªçº¿ç¨‹çš„ä¿®æ”¹æœ€ç»ˆä¼šåæ˜ åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œä½†ä¸èƒ½ç«‹å³åæ˜ åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ï¼Œæ‰€ä»¥é€šè¿‡SharedPreferencesæ— æ³•å®ç°å¤šè¿›ç¨‹åŒæ­¥ã€‚</p><p><code>loadFromDisk()</code>æ–¹æ³•ä¸­æˆ‘ä»¬æœ€éœ€è¦å…³æ³¨çš„æ˜¯è¿™ä¸€æ®µï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœå¤‡ä»½æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œé‚£å°±åˆ é™¤æºæ–‡ä»¶ï¼Œå¹¶å°†å¤‡ä»½æ–‡ä»¶æ›¿æ¢ä¸ºæºæ–‡ä»¶</span></span><br><span class="line"><span class="keyword">if</span> (mBackupFile.exists()) &#123;</span><br><span class="line">    mFile.delete();</span><br><span class="line">    mBackupFile.renameTo(mFile);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™å—åˆ¤æ–­äº†<code>mBackupFile</code>æ˜¯å¦å­˜åœ¨ï¼Œé‚£<code>mBackupFile</code>æˆ‘ä»¬æ˜¯åœ¨å“ªåˆ›å»ºçš„å‘¢ï¼Ÿ<br>æ•´ä¸ªSharedPreferencesImplä¸­æœ‰ä¸¤å¤„ï¼š</p><ul><li>æ„é€ æ–¹æ³•ï¼šä¼šè°ƒç”¨<code>makeBackupFile()</code>ç»™ä¼ å…¥çš„<code>file</code>æ„é€ ä¸€ä¸ª<code>mBackupFile</code></li><li>writeToFile()ï¼šåœ¨å†™å…¥åˆ°ç£ç›˜çš„æ–‡ä»¶æ—¶ï¼Œå¦‚æœæ²¡æœ‰<code>mBackupFile</code>ï¼Œå°±ä¼šæ ¹æ®å½“å‰çš„<code>mFile</code>é‡å‘½åä¸º<code>mBackupFile</code></li></ul><p>è€Œ<code>writeToFile()</code>åœ¨<code>enqueueDiskWrite()</code>ä¸­è¢«è°ƒç”¨ï¼Œè¿™ä¸ªæ–¹æ³•å¤ªé•¿äº†ï¼Œæˆ‘æˆªå–ä¸‹å…³é”®ä¿¡æ¯ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GuardedBy(&quot;mWritingToDiskLock&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">writeToFile</span><span class="params">(MemoryCommitResult mcr, <span class="type">boolean</span> isFromSyncCommit)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">fileExists</span> <span class="operator">=</span> mFile.exists();</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Rename the current file so it may be used as a backup during the next read</span></span><br><span class="line">    <span class="keyword">if</span> (fileExists) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">backupFileExists</span> <span class="operator">=</span> mBackupFile.exists();</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">if</span> (!backupFileExists) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!mFile.renameTo(mBackupFile)) &#123;</span><br><span class="line">                Log.e(TAG, <span class="string">&quot;Couldn&#x27;t rename file &quot;</span> + mFile</span><br><span class="line">                      + <span class="string">&quot; to backup file &quot;</span> + mBackupFile);</span><br><span class="line">                mcr.setDiskWriteResult(<span class="literal">false</span>, <span class="literal">false</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            mFile.delete();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Attempt to write the file, delete the backup and return true as atomically as</span></span><br><span class="line">    <span class="comment">// possible.  If any exception occurs, delete the new file; next time we will restore</span></span><br><span class="line">    <span class="comment">// from the backup.</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">str</span> <span class="operator">=</span> createFileOutputStream(mFile);</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        XmlUtils.writeMapXml(mcr.mapToWriteToDisk, str);</span><br><span class="line"></span><br><span class="line">        writeTime = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        FileUtils.sync(str);</span><br><span class="line"></span><br><span class="line">        fsyncTime = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        str.close();</span><br><span class="line">        ContextImpl.setFilePermissionsFromMode(mFile.getPath(), mMode, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">StructStat</span> <span class="variable">stat</span> <span class="operator">=</span> Os.stat(mFile.getPath());</span><br><span class="line">            <span class="keyword">synchronized</span> (mLock) &#123;</span><br><span class="line">                mStatTimestamp = stat.st_mtim;</span><br><span class="line">                mStatSize = stat.st_size;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ErrnoException e) &#123;</span><br><span class="line">            <span class="comment">// Do nothing</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (DEBUG) &#123;</span><br><span class="line">            fstatTime = System.currentTimeMillis();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Writing was successful, delete the backup file if there is one.</span></span><br><span class="line">        mBackupFile.delete();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ...</span></span><br></pre></td></tr></table></figure><br>æ‰€ä»¥æˆ‘ä»¬å¤§è‡´æ€»ç»“ä¸‹è¿™ä¸ªæ–¹æ³•çš„åŠŸèƒ½ï¼š</p><ul><li>å¦‚æœæºæ–‡ä»¶<code>mFIle</code>å­˜åœ¨å¹¶ä¸”å¤‡ä»½æ–‡ä»¶<code>mBackupFile</code>ä¸å­˜åœ¨ï¼Œå°±å°†æºæ–‡ä»¶é‡å‘½åä¸ºå¤‡ä»½æ–‡ä»¶ï¼Œå¦‚æœæºæ–‡ä»¶å­˜åœ¨å¹¶ä¸”å¤‡ä»½æ–‡ä»¶å­˜åœ¨ï¼Œå°±åˆ é™¤æºæ–‡ä»¶</li><li>é‡æ–°åˆ›å»ºæºæ–‡ä»¶<code>mFile</code>ï¼Œå¹¶å°†å†…å®¹å†™è¿›å»</li><li>åˆ é™¤<code>mBackupFile</code></li></ul><p>ç»“åˆä¸€ä¸‹<code>loadFromDisk()</code>å’Œ<code>writeToFile()</code>ä¸¤ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æ¨æµ‹å‡ºï¼šå½“å­˜åœ¨ä¸¤ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªè¯»è¿›ç¨‹ï¼Œä¸€ä¸ªå†™è¿›ç¨‹ï¼Œç”±äºåªæœ‰åœ¨åˆ›å»º<code>SharedPreferencesImpl</code>çš„æ—¶å€™åˆ›å»ºäº†ä¸€ä¸ªå¤‡ä»½è¿›ç¨‹ï¼Œæ­¤æ—¶è¯»è¿›ç¨‹ä¼šå°†æºæ–‡ä»¶åˆ é™¤ï¼Œå¹¶å°†å¤‡ä»½æ–‡ä»¶é‡å‘½åä¸ºæºæ–‡ä»¶ï¼Œè¿™æ ·çš„ç»“æœå°±æ˜¯ï¼Œè¯»è¿›ç¨‹æ°¸è¿œåªä¼šçœ‹åˆ°å†™ä¹‹å‰çš„å†…å®¹ã€‚å¹¶ä¸”ç”±äºå†™æ–‡ä»¶éœ€è¦è°ƒç”¨<code>createFileOutputStream(mFile)</code>ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™ç”±äºæºæ–‡ä»¶è¢«è¯»è¿›ç¨‹åˆ é™¤äº†ï¼Œæ‰€ä»¥å¯¼è‡´å†™è¿›ç¨‹çš„<code>mFIle</code>æ²¡æœ‰äº†å¼•ç”¨ï¼Œä¹Ÿå°±ä¼šåˆ›å»ºå¤±è´¥ï¼Œå¯¼è‡´ä¿®æ”¹çš„æ•°æ®æ— æ³•æ›´æ–°åˆ°æ–‡ä»¶ä¸Šï¼Œè¿›è€Œå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚</p><h2 id="3-3-å»ºè®®ä¼˜åŒ–"><a href="#3-3-å»ºè®®ä¼˜åŒ–" class="headerlink" title="3.3 å»ºè®®ä¼˜åŒ–"></a>3.3 å»ºè®®ä¼˜åŒ–</h2><ul><li>ä¸è¦åœ¨SPä¸­å­˜å‚¨è¾ƒå¤§çš„keyæˆ–è€…value</li><li>åªæ˜¯ç”¨MODE_PRIVATEæ¨¡å¼ï¼Œå…¶å®ƒæ¨¡å¼éƒ½ä¸è¦ä½¿ç”¨(ä¹Ÿè¢«å¼ƒç”¨äº†)</li><li>å¯ä»¥çš„è¯ï¼Œå°½é‡è·å–ä¸€æ¬¡Editorç„¶åæäº¤æ‰€æœ‰çš„æ•°æ®</li><li>ä¸è¦é«˜é¢‘ä½¿ç”¨applyï¼Œå› ä¸ºä»–æ¯æ¬¡éƒ½ä¼šæ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼›ä½¿ç”¨commitçš„æ—¶éœ€è°¨æ…ï¼Œå› ä¸ºä»–åœ¨ä¸»çº¿ç¨‹ä¸­æ“ä½œ(å¯¹ï¼Œå°±æ˜¯ä¸»çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹å¹¶ä¸æ˜¯åªèƒ½æ›´æ–°UIï¼Œä½†æ˜¯è¿˜æ˜¯å°±æŠŠä¸»çº¿ç¨‹å½“åšæ›´æ–°UIçš„ä¸ºå¥½ï¼Œæˆ‘ä»¬çš„è€—æ—¶æ“ä½œæœ€å¥½ä¸è¦åœ¨ä¸»çº¿ç¨‹ä¸­)</li><li>å¦‚æœéœ€è¦åœ¨å¤šè¿›ç¨‹ä¸­å­˜å‚¨æ•°æ®ï¼Œå»ºè®®ä½¿ç”¨ContentProvider</li></ul>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Android/">Android</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E6%BA%90%E7%A0%81/">æºç </category>
      
      <category domain="https://www.littlecorgi.top/tags/SharedPreferences/">SharedPreferences</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E5%AD%98%E5%82%A8/">å­˜å‚¨</category>
      
      
      <comments>https://www.littlecorgi.top/posts/24e17cf4.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Jetpackå…¥é—¨ ä¹‹ LiveDataçš„map()å’ŒswitchMap</title>
      <link>https://www.littlecorgi.top/posts/b1488352.html</link>
      <guid>https://www.littlecorgi.top/posts/b1488352.html</guid>
      <pubDate>Wed, 24 Jun 2020 15:06:16 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;LiveDataçš„map-å’ŒswitchMap&quot;&gt;&lt;a href=&quot;#LiveDataçš„map-å’ŒswitchMap&quot; class=&quot;headerlink&quot; title=&quot;LiveDataçš„map()å’ŒswitchMap&quot;&gt;&lt;/a&gt;LiveDataçš„map()å’ŒswitchMap&lt;/h1&gt;&lt;h1 id=&quot;å®˜æ–¹æ–‡æ¡£ä¸­çš„ä»‹ç»&quot;&gt;&lt;a href=&quot;#å®˜æ–¹æ–‡æ¡£ä¸­çš„ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;å®˜æ–¹æ–‡æ¡£ä¸­çš„ä»‹ç»&quot;&gt;&lt;/a&gt;å®˜æ–¹æ–‡æ¡£ä¸­çš„ä»‹ç»&lt;/h1&gt;&lt;p&gt;åœ¨Android Developerå®˜ç½‘ä¸Šï¼Œå¯¹äºmapå’ŒswitchMapçš„è§£é‡Šæ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;mapï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;Applies a function on the value stored in the LiveData object, and propagates the result downstream.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¯¹å­˜å‚¨åœ¨ LiveData å¯¹è±¡ä¸­çš„å€¼åº”ç”¨å‡½æ•°ï¼Œå¹¶å°†ç»“æœä¼ æ’­åˆ°ä¸‹æ¸¸ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;switchMapï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;applies a function to the value stored in the LiveData object and unwraps and dispatches the result downstream. &lt;strong&gt;The function passed to switchMap() must return a LiveData object, as illustrated by the following example:&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¯¹å­˜å‚¨åœ¨ LiveData å¯¹è±¡ä¸­çš„å€¼åº”ç”¨å‡½æ•°ï¼Œå¹¶å°†ç»“æœè§£å°å’Œåˆ†æ´¾åˆ°ä¸‹æ¸¸ã€‚&lt;strong&gt;ä¼ é€’ç»™ switchMap() çš„å‡½æ•°å¿…é¡»è¿”å› LiveData å¯¹è±¡ã€‚&lt;/strong&gt;&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="LiveDataçš„map-å’ŒswitchMap"><a href="#LiveDataçš„map-å’ŒswitchMap" class="headerlink" title="LiveDataçš„map()å’ŒswitchMap"></a>LiveDataçš„map()å’ŒswitchMap</h1><h1 id="å®˜æ–¹æ–‡æ¡£ä¸­çš„ä»‹ç»"><a href="#å®˜æ–¹æ–‡æ¡£ä¸­çš„ä»‹ç»" class="headerlink" title="å®˜æ–¹æ–‡æ¡£ä¸­çš„ä»‹ç»"></a>å®˜æ–¹æ–‡æ¡£ä¸­çš„ä»‹ç»</h1><p>åœ¨Android Developerå®˜ç½‘ä¸Šï¼Œå¯¹äºmapå’ŒswitchMapçš„è§£é‡Šæ˜¯è¿™æ ·çš„ï¼š</p><ul><li>mapï¼š</li></ul><blockquote><p>Applies a function on the value stored in the LiveData object, and propagates the result downstream.</p></blockquote><p>å¯¹å­˜å‚¨åœ¨ LiveData å¯¹è±¡ä¸­çš„å€¼åº”ç”¨å‡½æ•°ï¼Œå¹¶å°†ç»“æœä¼ æ’­åˆ°ä¸‹æ¸¸ã€‚</p><ul><li>switchMapï¼š</li></ul><blockquote><p>applies a function to the value stored in the LiveData object and unwraps and dispatches the result downstream. <strong>The function passed to switchMap() must return a LiveData object, as illustrated by the following example:</strong></p></blockquote><p>å¯¹å­˜å‚¨åœ¨ LiveData å¯¹è±¡ä¸­çš„å€¼åº”ç”¨å‡½æ•°ï¼Œå¹¶å°†ç»“æœè§£å°å’Œåˆ†æ´¾åˆ°ä¸‹æ¸¸ã€‚<strong>ä¼ é€’ç»™ switchMap() çš„å‡½æ•°å¿…é¡»è¿”å› LiveData å¯¹è±¡ã€‚</strong></p><span id="more"></span><p>å…¶å®å•çº¯çš„çœ‹ä¸Šé¢ä¸¤ä¸ªå®˜æ–¹æ–‡æ¡£åè€Œè¿˜ä¼šè§‰å¾—æ›´åŠ çš„è«åå…¶å¦™ã€‚å…¶å®è¿™ä¸¤å¥è¯å·®å¼‚çš„æ ¸å¿ƒåœ¨äº <strong>â€œè§£å°â€</strong> å’Œ <strong>â€œè¿”å›LiveDataå¯¹è±¡â€</strong> ã€‚</p><h1 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h1><p>æˆ‘ä»¬å…ˆæ¥ä¸¾ä¸ªæ —å­æ¥è¯´æ˜ä¸‹è¿™ä¸¤ä¸ªæ–¹æ³•çš„åŒºåˆ«(ä¾‹å­æ¥æºäº<a href="https://medium.com/@elye.project/understanding-live-data-made-simple-a820fcd7b4d0">æ­¤æ–‡ç« </a>)ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TransformationMapFragment</span> : <span class="type">Fragment</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> changeObserver = Observer&lt;String&gt; &#123; value -&gt;</span><br><span class="line">        value?.let &#123; txt_fragment.text = it &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onAttach</span><span class="params">(context: <span class="type">Context</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onAttach(context)</span><br><span class="line">        <span class="keyword">val</span> transformedLiveData = Transformations.map(</span><br><span class="line">                getLiveDataA()) &#123; <span class="string">&quot;A:<span class="variable">$it</span>&quot;</span> &#125;</span><br><span class="line">        transformedLiveData.observe(<span class="keyword">this</span>, changeObserver)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿è¡Œç»“æœæ˜¯è¿™æ ·çš„ï¼š</p><p><img src="https://cdn.littlecorgi.top/mweb/2020-06-24/1_6cTWqtHlJgnzF701QFtZQg.gif" alt="1_6cTWqtHlJgnzF701QFtZQg"></p><p>ç»“åˆä»£ç è¿è¡Œç»“æœä»¥åŠä¸Šé¢æ–‡æ¡£ä¸­å¯¹mapå‡½æ•°çš„å®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºä¸‹é¢è¿™ä¸ªç»“è®ºï¼šmapå‡½æ•°ä¸»è¦çš„åŠŸèƒ½å°±æ˜¯æ ¹æ®åŸLiveDataï¼Œå¯¹å…¶åŸLiveDataçš„å€¼è¿›è¡Œæ”¹å˜ç„¶åç”Ÿæˆä¸€ä¸ªæ–°çš„LiveDataã€‚<strong>åŸºäºåŸLiveData</strong>ã€‚</p><p>è€ŒswitchMapï¼ŒåŒæ ·çš„ï¼Œæˆ‘ä»¬ä¹Ÿæ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TransformationSwitchMapFragment</span> : <span class="type">Fragment</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> changeObserver = Observer&lt;String&gt; &#123; value -&gt;</span><br><span class="line">        value?.let &#123; txt_fragment.text = it &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onAttach</span><span class="params">(context: <span class="type">Context</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onAttach(context)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> transformSwitchedLiveData =</span><br><span class="line">            Transformations.switchMap(getLiveDataSwitch()) &#123; </span><br><span class="line">                switchToB -&gt;</span><br><span class="line">                <span class="keyword">if</span> (switchToB) &#123;</span><br><span class="line">                     getLiveDataB()</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                     getLiveDataA()</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        transformSwitchedLiveData.observe(<span class="keyword">this</span>, changeObserver)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// .. some other Fragment specific code ..</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿è¡Œç»“æœæ˜¯è¿™æ ·çš„ï¼š</p><p><img src="https://cdn.littlecorgi.top/mweb/2020-06-24/1_9RDrsXCBQhZmmc8XMQWw6Q.gif" alt="1_9RDrsXCBQhZmmc8XMQWw6Q"></p><p>åŒæ ·çš„ç»“åˆè¿™ä¸ªä¾‹å­å’Œä¸Šé¢çš„æ–‡æ¡£æè¿°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®ºï¼šswitchMapæ˜¯æ ¹æ®ä¼ å…¥çš„LiveDataçš„å€¼ï¼Œç„¶ååˆ¤æ–­è¿™ä¸ªå€¼ï¼Œç„¶åå†å»åˆ‡æ¢æˆ–è€…æ„å»ºæ–°çš„LiveDataã€‚<strong>æ‰‹åŠ¨ç”Ÿæˆæ–°çš„LiveData</strong>ã€‚</p><h1 id="å·®å¼‚"><a href="#å·®å¼‚" class="headerlink" title="å·®å¼‚"></a>å·®å¼‚</h1><p>æ‰€ä»¥å¯¹äºè¿™ä¸¤ä¸ªå‡½æ•°çš„åŒºåˆ«æ¥è¯´ï¼Œmapï¼Œæ›´å…³æ³¨äºæ•°å€¼çš„è½¬æ¢ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»–åªä¼šé€šè¿‡ä½ ä¹‹å‰çš„å€¼å»ç”Ÿæˆä¸€ä¸ªæ–°çš„å€¼ï¼Œå¼ºè°ƒçš„æ˜¯è¿™ä¸ª<strong>è½¬æ¢</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´æ–°çš„LiveDataå¯¹è±¡çš„å€¼ï¼Œä»ç„¶æ˜¯åŸºäºå½“å‰è¿™ä¸ªLiveDataçš„å€¼è€Œç”Ÿæˆçš„ã€‚</p><p>è€ŒswitchMapï¼Œæ›´å…³æ³¨äºæ•°å€¼çš„<strong>è§¦å‘</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»–ä¼šç›‘å¬ä½ è¿™ä¸ªå€¼çš„å˜åŒ–ï¼Œè€Œä¸å…³æ³¨ä½ è¿™ä¸ªå€¼æœ¬èº«ï¼Œä½ å¯ä»¥ç†è§£æˆè§¦å‘å™¨æˆ–è€…æ‰³æœºï¼Œå½“è§¦å‘ä¹‹åï¼Œä½ å°±éœ€è¦è‡ªå·±å»ä¸»åŠ¨çš„è¿”å›ä»»æ„ä¸€ä¸ªä½ æŒ‡å®šçš„liveDataå¯¹è±¡ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å†å›è¿‡å¤´æ¥çœ‹ä¸€ä¸‹ä¸Šé¢è¯´çš„ <strong>â€œè§£å°â€</strong> å’Œ <strong>â€œè¿”å›LiveDataå¯¹è±¡â€ ï¼š</strong></p><p>å¯¹äºè¿™ä¸ªï¼Œæˆ‘è§‰å¾—åº”è¯¥ç›¸å¯¹çš„æ¥çœ‹ï¼Œå¯¹äºmapæ¥è¯´ï¼Œä»–æŠŠå€¼ä»LiveDataä¸­è¯»å–äº†å‡ºæ¥ï¼Œä½†æ˜¯ä»–åªæ˜¯åœ¨åŸå€¼çš„åŸºç¡€ä¸Šè¿›è¡Œæ“ä½œç”Ÿæˆæ–°çš„LiveDataå¯¹è±¡ï¼Œæ–°çš„LiveDataå¯¹è±¡çš„å€¼æ˜¯åŸºäºæ—§çš„LiveDataå¯¹è±¡çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰å®Œå…¨çš„å°†å€¼ç‹¬ç«‹å‡ºæ¥ï¼›è€Œå¯¹äºswitchMapï¼Œå®ƒä¸ä»…ä»…å°†å€¼ä»LiveDataä¸­å–å‡ºæ¥äº†ï¼Œå¹¶ä¸”å–å‡ºæ¥ä¹‹åï¼Œå¯¹äºæ–°çš„LiveDataæ¥è¯´ï¼Œä»–å¹¶æ²¡æœ‰è¦æ±‚æ–°çš„LiveDataçš„å€¼å¿…é¡»å¾—åŸºäºæ—§çš„LiveDataå’‹æ ·ï¼Œè€Œæ˜¯åªæ˜¯å•çº¯çš„ä½œä¸ºä¸€ä¸ªè§¦å‘å™¨ï¼Œä½ è¿”å›çš„æ–°çš„LiveDataå¯¹è±¡ä¸­å­˜å‚¨çš„å€¼ï¼Œä¸æ—§çš„LiveDataå¯¹è±¡çš„å€¼æœ‰æ²¡æœ‰å…³ç³»ï¼Œä»–å¹¶ä¸åœ¨æ„ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ‰€ä»¥ï¼Œæ€»ç»“ä¸€ä¸‹ã€‚</p><p>mapå¼ºè°ƒçš„æ˜¯ï¼Œ<strong>æ–°çš„LiveDataçš„å€¼å¿…é¡»åŸºäºæ—§çš„LiveDataä¸­çš„å€¼</strong>(æ¯”æ–¹è¯´åƒä¸Šé¢çš„ä¾‹å­ï¼Œå–å‡ºæ—§çš„LiveDataçš„æ¯ä¸ªå€¼ç„¶ååŠ ä¸Šç›¸åŒçš„Stringä»è€Œç”Ÿæˆæ–°çš„LiveData)ã€‚</p><p>è€ŒswitchMapï¼Œä»–å¹¶ä¸åœ¨æ„è¿™äº›ï¼Œä»–åœ¨æ„çš„æ˜¯ä»–ä¼š<strong>å°†æ—§çš„LiveDataçš„å€¼ä½œä¸ºä¸€ä¸ªè§¦å‘ï¼Œä½œä¸ºä¸€ä¸ªswitch</strong>ï¼Œä»–ä¸ç®¡ä½ ä½ åˆ°åº•æ˜¯åˆ©ç”¨è¿™ä¸ªswitchåšåˆ¤æ–­è¿”å›ä¸ç”¨çš„å€¼(åƒä¸Šé¢çš„ä¾‹å­)ï¼Œè¿˜æ˜¯ä½ åˆ©ç”¨è¿™ä¸ªå€¼å»ç½‘ç»œè¯·æ±‚ç”Ÿæˆæ–°çš„å€¼(æ¯”æ–¹è¯´æ—§çš„LiveDataå­˜äº†ç”¨æˆ·åï¼Œè€Œä½ æ ¹æ®è¿™ä¸ªç”¨æˆ·åå»è¯·æ±‚ç”¨æˆ·çš„å…·ä½“ä¿¡æ¯ä½œä¸ºæ–°çš„LiveDataè¿”å›)ä¹Ÿå¥½ï¼Œåªè¦ä½ <strong>æ‰‹åŠ¨è¿”å›äº†ä¸€ä¸ªæ–°çš„LiveData</strong>å°±è¡Œã€‚</p><h1 id="ç›¸å…³æ–‡æ¡£"><a href="#ç›¸å…³æ–‡æ¡£" class="headerlink" title="ç›¸å…³æ–‡æ¡£"></a>ç›¸å…³æ–‡æ¡£</h1><ul><li><a href="https://medium.com/@elye.project/understanding-live-data-made-simple-a820fcd7b4d0">Understanding LiveData made simple - Elye - Medium</a></li><li><a href="https://stackoverflow.com/a/47690327/13753159">What is the difference between map() and switchMap() methods? - stack overflow</a></li><li><a href="https://developer.android.google.cn/topic/libraries/architecture/livedata#transform_livedata">LiveData æ¦‚è§ˆ # è½¬æ¢ LiveData - Android Developer</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Android/">Android</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Jetpack/">Jetpack</category>
      
      <category domain="https://www.littlecorgi.top/tags/MVVM/">MVVM</category>
      
      <category domain="https://www.littlecorgi.top/tags/LiveData/">LiveData</category>
      
      
      <comments>https://www.littlecorgi.top/posts/b1488352.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Kotlinå…¥é—¨(å››)â€”â€”ç±»å’Œå¯¹è±¡çš„è¿›é˜¶</title>
      <link>https://www.littlecorgi.top/posts/6f3ca960.html</link>
      <guid>https://www.littlecorgi.top/posts/6f3ca960.html</guid>
      <pubDate>Tue, 23 Jun 2020 12:10:18 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;Kotlinå…¥é—¨-å››-â€”â€”ç±»å’Œå¯¹è±¡çš„è¿›é˜¶&quot;&gt;&lt;a href=&quot;#Kotlinå…¥é—¨-å››-â€”â€”ç±»å’Œå¯¹è±¡çš„è¿›é˜¶&quot; class=&quot;headerlink&quot; title=&quot;Kotlinå…¥é—¨(å››)â€”â€”ç±»å’Œå¯¹è±¡çš„è¿›é˜¶&quot;&gt;&lt;/a&gt;Kotlinå…¥é—¨(å››)â€”â€”ç±»å’Œå¯¹è±¡çš„è¿›é˜¶&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;æœ¬ç« å†…å®¹åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯ç©ºæ€§&lt;/li&gt;
&lt;li&gt;æ•°æ®ç±»&lt;/li&gt;
&lt;li&gt;å¯†å°ç±»&lt;/li&gt;
&lt;li&gt;æšä¸¾ç±»&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;0-å‰è¨€&quot;&gt;&lt;a href=&quot;#0-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0. å‰è¨€&quot;&gt;&lt;/a&gt;0. å‰è¨€&lt;/h1&gt;&lt;p&gt;åœ¨ä¸Šä¸€ç¯‡&lt;a href=&quot;https://blog.csdn.net/a1203991686/article/details/106648619&quot;&gt;ã€ŠKotlinå…¥é—¨(ä¸‰)â€”â€”ç±»ã€å¯¹è±¡ã€æ¥å£ã€‹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åªèŠåˆ°äº†Kotlinä¸­åŸºæœ¬ç±»çš„å†™æ³•ä»¥åŠç»§æ‰¿ï¼Œä½†æ˜¯æˆ‘ä»¬è¯´è¿‡ï¼ŒKotlinçš„æœ¬è´¨å°±æ˜¯è§£å†³Javaçš„ç¹çï¼Œå¦‚æœKotlinåªæœ‰è¿™ä¹ˆç®€å•çš„è¯æ€ä¹ˆè¿˜èƒ½è¢«ç§°ä¸ºKotlinã€‚&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="Kotlinå…¥é—¨-å››-â€”â€”ç±»å’Œå¯¹è±¡çš„è¿›é˜¶"><a href="#Kotlinå…¥é—¨-å››-â€”â€”ç±»å’Œå¯¹è±¡çš„è¿›é˜¶" class="headerlink" title="Kotlinå…¥é—¨(å››)â€”â€”ç±»å’Œå¯¹è±¡çš„è¿›é˜¶"></a>Kotlinå…¥é—¨(å››)â€”â€”ç±»å’Œå¯¹è±¡çš„è¿›é˜¶</h1><blockquote><p>æœ¬ç« å†…å®¹åŒ…æ‹¬ï¼š</p><ul><li>å¯ç©ºæ€§</li><li>æ•°æ®ç±»</li><li>å¯†å°ç±»</li><li>æšä¸¾ç±»</li></ul></blockquote><h1 id="0-å‰è¨€"><a href="#0-å‰è¨€" class="headerlink" title="0. å‰è¨€"></a>0. å‰è¨€</h1><p>åœ¨ä¸Šä¸€ç¯‡<a href="https://blog.csdn.net/a1203991686/article/details/106648619">ã€ŠKotlinå…¥é—¨(ä¸‰)â€”â€”ç±»ã€å¯¹è±¡ã€æ¥å£ã€‹</a></p><p>æˆ‘ä»¬åªèŠåˆ°äº†Kotlinä¸­åŸºæœ¬ç±»çš„å†™æ³•ä»¥åŠç»§æ‰¿ï¼Œä½†æ˜¯æˆ‘ä»¬è¯´è¿‡ï¼ŒKotlinçš„æœ¬è´¨å°±æ˜¯è§£å†³Javaçš„ç¹çï¼Œå¦‚æœKotlinåªæœ‰è¿™ä¹ˆç®€å•çš„è¯æ€ä¹ˆè¿˜èƒ½è¢«ç§°ä¸ºKotlinã€‚</p><span id="more"></span><p>é¦–å…ˆæˆ‘ä»¬æ€è€ƒåœ¨Javaä¸­çš„å‡ ä¸ªåœºæ™¯ï¼š</p><ul><li>åœ¨æ–¹æ³•ä¸­æ¯æ¬¡éƒ½å¾—å¯¹ä¼ è¿›æ¥çš„å¯¹è±¡è¿›è¡Œåˆ¤ç©ºï¼Œå¹¶ä¸”å¾ˆå¤šæ—¶å€™éƒ½ä¼šå¿˜è®°åˆ¤ç©ºæˆ–è€…ä¸çŸ¥é“åˆ«äººåœ¨è°ƒç”¨ä½ è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™åˆ°åº•ä¼šä¸ä¼šç»™ç©ºï¼Œç„¶åå°±å¯¼è‡´ç¨‹åºç©ºæŒ‡é’ˆå¼‚å¸¸äº†</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">nullTest</span><span class="params">(Obj obj)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (obj == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ¯æ¬¡åœ¨Javaä¸­å†™JavaBeançš„æ—¶å€™ï¼Œä¸€æ—¦æ•°æ®å˜å¤šï¼Œå°±å¾—å†™ä¸€å¤§å †çš„getterã€setterã€toStringã€equalsç­‰ç­‰æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String firstName;</span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> String telephone;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String firstName, String lastName, String telephone, String address)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.firstName = firstName;</span><br><span class="line">        <span class="built_in">this</span>.lastName = lastName;</span><br><span class="line">        <span class="built_in">this</span>.telephone = telephone;</span><br><span class="line">        <span class="built_in">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getFirstName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> firstName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFirstName</span><span class="params">(String firstName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.firstName = firstName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getLastName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> lastName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLastName</span><span class="params">(String lastName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.lastName = lastName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getTelephone</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> telephone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTelephone</span><span class="params">(String telephone)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.telephone = telephone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAddress</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAddress</span><span class="params">(String address)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœåœ¨Kotlinä¸­ï¼Œä¸Šé¢ä¸¤ä¸ªé—®é¢˜è¿˜åˆšå¥½å¯ä»¥é€šè¿‡å¯ç©ºæ€§å’Œæ•°æ®ç±»å»è§£å†³ã€‚</p><p>é‚£å¯èƒ½æœ‰çš„åŒå­¦ä¼šé—®ï¼Œä½ ä¸Šé¢ä¸è¿˜æœ‰ä¸€ä¸ªå¯†å°ç±»å—ï¼Œé‚£ä»–æœ‰å•¥æ–¹ä¾¿ä¹‹å¤„å‘¢ï¼Ÿè¿™ä¸ªæˆ‘ä»¬å…ˆå–ä¸ªå…³å­ï¼Œæˆ‘ä»¬æ”¾åˆ°åé¢æ¥è°ˆè¿™ä¸ªã€‚</p><h1 id="1-å¯ç©ºæ€§"><a href="#1-å¯ç©ºæ€§" class="headerlink" title="1. å¯ç©ºæ€§"></a>1. å¯ç©ºæ€§</h1><p>åœ¨Kotlinä¸­ï¼Œå¯ç©ºæ€§æ˜¯Kotlinå’ŒJavaæœ€æ˜¾è‘—çš„åŒºåˆ«ä¹‹ä¸€ï¼Œä»–èƒ½éå¸¸é«˜æ•ˆçš„å¸®åŠ©æˆ‘ä»¬å¼€å‘è€…å»é¿å…<code>NullPointerException</code>ã€‚</p><p>Kotlinå¯¹äºå¯ç©ºæ€§çš„å¤„ç†å°±æ˜¯æŠŠè¿™ä¸ªè¿è¡Œæ—¶çš„é”™è¯¯è½¬æˆäº†ç¼–è¯‘æœŸçš„é”™è¯¯ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨ç¼–è¯‘æ—¶å°±èƒ½å‘ç°å¾ˆå¤šå­˜åœ¨çš„é”™è¯¯ï¼Œä»è€Œå‡å°‘è¿è¡Œæ—¶æŠ›å‡ºå¼‚å¸¸çš„å¯èƒ½æ€§ã€‚</p><h2 id="1-1-å¯ç©ºç±»å‹"><a href="#1-1-å¯ç©ºç±»å‹" class="headerlink" title="1.1 å¯ç©ºç±»å‹"></a>1.1 å¯ç©ºç±»å‹</h2><p>é¦–å…ˆï¼ŒKotlinæ”¯æŒå¯¹å¯ç©ºç±»å‹çš„æ˜¾å¼ã€‚è¿™å¥è¯å¯èƒ½è¯»èµ·æ¥è§‰å¾—è«åå…¶å¦™ï¼Œå…¶å®ç®€å•ç‚¹è¯´å°±æ˜¯ï¼šè¿™æ˜¯ä¸€ç§å¯ä»¥ç›´æ¥æŒ‡å‡ºä½ çš„ç¨‹åºä¸­å“ªäº›å˜é‡å’Œå±æ€§å…è®¸ä¸º<code>null</code>çš„æ–¹å¼ã€‚</p><p>æˆ‘ä»¬è¿˜æ˜¯ä»åŒæ ·çš„åŠŸèƒ½çš„ä»£ç çš„Javaç‰ˆå…¥æ‰‹ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹æœ€å¸¸è§çš„ä¸€ç§Javaçš„ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">strLen</span><span class="params">(String s)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> s.length();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ææ€•è¿™ä¸ªä»£ç ä¸€å†™å‡ºæ¥ï¼Œå¾ˆå¤šå“ªæ€•æ˜¯æ–°æ‰‹çš„Javaç¨‹åºå‘˜éƒ½èƒ½æŒ‡å‡ºä»–çš„é—®é¢˜ï¼šå¦‚æœä¼ å…¥çš„<code>s</code>æ˜¯<code>null</code>ï¼Œè¿™ä¸ªç¨‹åºå°±å´©æºƒäº†ã€‚</p><p>é‚£æˆ‘ä»¬ç°åœ¨æ¥è¯•ç€ç”¨Kotlinå»é‡å†™è¿™ä¸ªå‡½æ•°ï¼Œä½†æ˜¯åœ¨é‡å†™ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆå¾—è€ƒè™‘æˆ‘ä»¬è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œä¼ å…¥çš„å®å‚ï¼Œæ˜¯å¦å¯ä»¥ä¸ºnullã€‚</p><p>å¦‚æœæˆ‘ä»¬ä¸å¸Œæœ›ä¼ å…¥çš„sä¸ºnullï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä½¿ç”¨æœ€åŸºæœ¬çš„Kotlinå‡½æ•°çš„å†™æ³•ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">strLen</span><span class="params">(s: <span class="type">String</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> s.length</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªæ—¶å€™å¦‚æœæˆ‘ä»¬åœ¨è°ƒç”¨strLençš„åœ°æ–¹ç»™ä»–ä¼ å…¥ä¸€ä¸ªnullè¿›å»ï¼Œæˆ‘ä»¬ç”šè‡³éƒ½ä¸ç”¨ç¼–è¯‘è¿™æ®µä»£ç ï¼ŒIDEAå°±ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬æŠŠè¿™å—ä»£ç ç»™æ ‡æ³¨å‡ºæ¥(æŠ¥é”™)ï¼Œä¸èƒ½ä¼ å…¥ä¸€ä¸ªnullè¿›å»:<br><img src="https://cdn.littlecorgi.top/mweb/2020-06-23/Kotlin%E5%85%A5%E9%97%A8-%E5%9B%9B-1.png" alt="Kotlinå…¥é—¨-å››-1"></p><p>åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œç”±äºå‡½æ•°çš„å½¢å‚è¢«å£°æ˜ä¸ºäº†String(è¯·æ³¨æ„ï¼šè¿™ä¸ªStringåªæ˜¯String)ï¼Œæ‰€ä»¥Kotlinå°±ä¼šè®¤ä¸ºä½ ä¼ å…¥çš„è¿™ä¸ªStringç±»å‹çš„å‚æ•°å¿…é¡»ä¸ºStringçš„å¯¹è±¡ï¼Œè€Œä¸å¯ä»¥ä¸ºnullã€‚</p><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³è®©å®ƒå¯ä»¥ä¼ å…¥nullå‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦æ˜¾å¼çš„åœ¨ç±»å‹åç§°åé¢åŠ ä¸Šé—®å·äº†ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">strLen</span><span class="params">(s: <span class="type">String</span>?)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> s.length</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥åƒä¸Šå›¾ä¸­çš„é‚£ç§æ–¹å¼å»è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚</p><p>é—®å·å¯ä»¥åŠ åœ¨ä»»ä½•ç±»å‹çš„åé¢ï¼Œè¡¨ç¤ºè¿™ä¸ªç±»å‹çš„å˜é‡å¯ä»¥ä¸ºnullã€‚</p><p>ä½†æ˜¯å…¶å®ä½ åƒæˆ‘ä¸Šé¢è¯´çš„é‚£æ ·æ”¹äº†ä¹‹åï¼Œå…¶å®IDEAä¹Ÿè¿˜æ˜¯ä¼šæŠ¥é”™ï¼š<br><img src="https://cdn.littlecorgi.top/mweb/2020-06-23/Kotlin%E5%85%A5%E9%97%A8-%E5%9B%9B-2.png" alt="Kotlinå…¥é—¨-å››-2"></p><p>è¿™æ˜¯å› ä¸ºå¦‚æœä½ è®©ä¸€ä¸ªå˜é‡å¯ç©ºäº†ä¹‹åï¼Œä½ å°±æ²¡åŠæ³•ç›´æ¥å¯¹ä»–è¿›è¡Œæ“ä½œï¼Œä¹Ÿä¸èƒ½æŠŠå®ƒèµ‹å€¼ç»™éç©ºç±»å‹çš„å˜é‡ï¼Œä¹Ÿä¸èƒ½æŠŠå¯ç©ºç±»å‹çš„å€¼ä¼ ç»™æ‹¥æœ‰éç©ºç±»å‹å‚æ•°çš„å‡½æ•°ã€‚</p><p>ä½†æ˜¯Kotlinå’ŒJavaä¸€æ ·ï¼Œä½ åªè¦åœ¨å¤–é¢å¯¹såˆ¤æ–­ä¸ç­‰äºnulläº†ä¹‹åï¼Œå°±å¯ä»¥åœ¨ifçš„å‡½æ•°ä½“ä¸­å¯¹ä»–ç›´æ¥è¿›è¡Œæ“ä½œäº†ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">strLen</span><span class="params">(s: <span class="type">String</span>?)</span></span> = <span class="keyword">if</span> (s != <span class="literal">null</span>) s.length <span class="keyword">else</span> <span class="number">0</span></span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯è¿™ä¸ªæ—¶å€™ï¼Œä½ ä¸€å®šä¼šæ»¡å¤´é—®å·ï¼Œå› ä¸ºä½ ä¸€å®šä¼šåæ§½ï¼Œè¿™ä¸ªä»£ç å’ŒJavaæœ‰å•¥åŒºåˆ«ï¼ŒJavaç”šè‡³éƒ½ä¸éœ€è¦åŠ é—®å·(<code>?</code>)ã€‚</p><p>å…¶å®æˆ‘è®²äº†è¿™ä¹ˆå¤šï¼Œåªæ˜¯ä¸ºäº†å¼•å‡ºKotlinå¯¹äºç©ºçš„ä¸€å¤§å †å¥½ç”¨çš„æ“ä½œï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å…ˆæ¥è¯´ä¸€ä¸‹å®‰å…¨è°ƒç”¨è¿ç®—ç¬¦ã€‚</p><h2 id="1-2-å®‰å…¨è°ƒç”¨è¿ç®—ç¬¦ï¼š"><a href="#1-2-å®‰å…¨è°ƒç”¨è¿ç®—ç¬¦ï¼š" class="headerlink" title="1.2 å®‰å…¨è°ƒç”¨è¿ç®—ç¬¦ï¼š?."></a>1.2 å®‰å…¨è°ƒç”¨è¿ç®—ç¬¦ï¼š<code>?.</code></h2><p>å›å½’åˆ°åˆšæ‰é‚£ä¸ªé—®é¢˜ï¼ŒKotlinæ˜¯å¦‚ä½•è§£å†³<code>if (s != null)</code>çš„ã€‚</p><p>å…¶å®è¦è§£å†³é‚£ä¸ª<code>if(s != null)</code>å¾ˆç®€å•ï¼Œå°±ç”¨<code>?.</code>å°±è¡Œäº†ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">strLen</span><span class="params">(s: <span class="type">String</span>?)</span></span> = s?.length</span><br></pre></td></tr></table></figure></p><p>å…¶å®<code>?.</code>ä»–å°±æ˜¯æŠŠnullæ£€æŸ¥å’Œæ‰§è¡Œä»£ç åˆæˆäº†ä¸€ä¸ªæ“ä½œï¼š<br><img src="https://cdn.littlecorgi.top/mweb/2020-06-23/Kotlin%E5%85%A5%E9%97%A8-%E5%9B%9B-3.jpg" alt="Kotlinå…¥é—¨-å››-3"></p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå›¾é‡Œé¢åé¢çš„ä¸¤ä¸ªè¡¨è¾¾å¼å…¶å®æ˜¯è¿”å›å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´å½“<code>s</code>ä¸º<code>null</code>çš„æ—¶å€™ï¼Œ<code>s?.length</code>è¿”å›å€¼å…¶å®æ˜¯<code>null</code>ã€‚</p><p>å®‰å…¨è°ƒç”¨ä¸æ­¢å¯ä»¥è°ƒç”¨æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥è®¿é—®å±æ€§ã€‚</p><p>ä½†æ˜¯è¿™ä¸ªæ—¶å€™ä½ å¯èƒ½ä¼šè¯´ï¼Œè¿™ä¸å¯¹å•Šï¼ŒJavaçš„ä»£ç çš„ä½œç”¨æ˜¯å½“<code>s</code>ä¸º<code>null</code>çš„æ—¶å€™è¿”å›<code>0</code>å•Šï¼Œä½†æ˜¯ä½ ä¸Šé¢çš„é‚£ä¸ªKotlinä»£ç å½“<code>s</code>ä¸º<code>null</code>çš„æ—¶å€™ï¼Œå´è¿”å›äº†<code>null</code>ã€‚</p><p>æˆ‘åªèƒ½è¯´ä½ å›¾æ ·å›¾æ£®ç ´ï¼Œå…¶å®è¿™ä¸ªå¥—è·¯å’Œåˆšæ‰è¿‡åº¦åˆ°<code>?.</code>çš„æ—¶å€™ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­ç”¨Kotlinç»™å®šçš„ç‰¹æ®Šè¯­å¥(ä¹Ÿå°±æ˜¯Elvisè¿ç®—ç¬¦<code>?:</code>)å»è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h2 id="1-3-Elvisè¿ç®—ç¬¦ï¼š"><a href="#1-3-Elvisè¿ç®—ç¬¦ï¼š" class="headerlink" title="1.3 Elvisè¿ç®—ç¬¦ï¼š?:"></a>1.3 Elvisè¿ç®—ç¬¦ï¼š<code>?:</code></h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">strLen</span><span class="params">(s: <span class="type">String</span>?)</span></span> = s?.length ?: <span class="number">0</span></span><br></pre></td></tr></table></figure><p>åŒæ ·ï¼Œä¹Ÿä¼šæœ‰ä¸€ä¸ªæµç¨‹å›¾å»è®©ä½ æ›´å®¹æ˜“ç†è§£è¿™ä¸ªä»£ç çš„æµç¨‹ï¼Œåªä¸è¿‡è¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦å°†<code>s?.length</code>çœ‹åšæ˜¯ä¸€ä¸ªæ•´ä½“ï¼š<br><img src="https://cdn.littlecorgi.top/mweb/2020-06-23/Kotlin%E5%85%A5%E9%97%A8-%E5%9B%9B-4.jpg" alt="Kotlinå…¥é—¨-å››-4"></p><p>æˆ‘ä»¬å¯ä»¥ç®€åŒ–<code>?:</code>çš„ç”¨æ³•ï¼Œå…¶å®å°±æ˜¯<code>a ?: b</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“<code>a</code>çš„å€¼ä¸ä¸º<code>null</code>çš„æ—¶å€™ï¼Œå°±è¿”å›<code>a</code>ï¼Œä½†æ˜¯å½“<code>a</code>çš„å€¼ä¸º<code>null</code>çš„æ—¶å€™ï¼Œå°±è¿”å›<code>b</code>ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“<code>s?.length</code>çš„å€¼ä¸ä¸º<code>null</code>çš„æ—¶å€™ï¼Œå°±è¿”å›<code>s.length</code>(å› ä¸ºæ­¤å¤„<code>s?.length</code>çš„å€¼ä¸ä¸º<code>null</code>ï¼Œæ‰€ä»¥å°±ç›¸å½“äº<code>s.length</code>)ï¼Œä½†æ˜¯å¦‚æœå½“<code>s?.length</code>çš„å€¼ä¸º<code>null</code>çš„æ—¶å€™ï¼Œå°±è¿”å›<code>0</code>ã€‚</p><p>å¹¶ä¸”å¯¹äº<code>?:</code>ï¼Œæˆ‘ä»¬å…¶å®è¿˜æœ‰ä¸€ä¸ªéå¸¸æ–¹ä¾¿çš„æ“ä½œï¼Œå°±æ˜¯å½“æˆ‘ä»¬éœ€è¦è¿”å›nullæˆ–è€…éœ€è¦æŠ›å¼‚å¸¸çš„æ—¶å€™ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">foo</span><span class="params">(node: <span class="type">Node</span>)</span></span>: String? &#123;</span><br><span class="line">    <span class="keyword">val</span> parent = node.getParent() ?: <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    <span class="keyword">val</span> name = node.getName() ?: <span class="keyword">throw</span> IllegalArgumentException(<span class="string">&quot;name expected&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="1-4-å®‰å…¨è½¬æ¢ï¼šas"><a href="#1-4-å®‰å…¨è½¬æ¢ï¼šas" class="headerlink" title="1.4 å®‰å…¨è½¬æ¢ï¼šas?"></a>1.4 å®‰å…¨è½¬æ¢ï¼š<code>as?</code></h2><p>æˆ‘ä»¬åœ¨ä¹‹å‰è¯´åˆ°è¿‡ï¼ŒKotlinä¸»è¦é€šè¿‡<code>as</code>è¿ç®—ç¬¦æ¥è¿›è¡Œç±»å‹è½¬æ¢ã€‚</p><p>ä½†æ˜¯å’ŒJavaçš„ç±»å‹è½¬æ¢ä¸€æ ·ï¼Œå¦‚æœè¢«è½¬æ¢çš„å€¼ä¸æ˜¯ä½ è¯•å›¾è½¬æ¢çš„ç±»å‹æ—¶ï¼Œå°±ä¼šæŠ›å‡º<code>ClassCastException</code>å¼‚å¸¸ã€‚è™½è¯´å¯ä»¥ç»“åˆ<code>is</code>æ£€æŸ¥æ¥ç¡®å®šè¿™ä¸ªå€¼æ‹¥æœ‰åˆé€‚çš„ç±»å‹ï¼Œä½†æ˜¯Kotlinä¸€å®šä¼šæœ‰æ›´åŠ ä¼˜é›…çš„æ–¹å¼ã€‚</p><p><code>as?</code>å°±å¯ä»¥å°†å€¼è½¬æ¢æˆæŒ‡å®šçš„ç±»å‹ï¼Œå¦‚æœä¸æ˜¯åˆé€‚çš„ç±»å‹å°±è¿”å›<code>null</code>ï¼š<br><img src="https://cdn.littlecorgi.top/mweb/2020-06-23/Kotlin%E5%85%A5%E9%97%A8-%E5%9B%9B-5.jpg" alt="Kotlinå…¥é—¨-å››-5"></p><p>ä¸€ç§å¸¸è§çš„æ¨¡å¼å°±æ˜¯å¯ä»¥ç”¨äºé‡å†™<code>equals()</code>æ–¹æ³•ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>(<span class="keyword">val</span> name: String) &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">equals</span><span class="params">(other: <span class="type">Any</span>?)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">        <span class="keyword">val</span> otherPerson = other <span class="keyword">as</span>? Person ?: <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        <span class="keyword">return</span> otherPerson.name == <span class="keyword">this</span>.name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="1-5-éç©ºæ–­è¨€ï¼š"><a href="#1-5-éç©ºæ–­è¨€ï¼š" class="headerlink" title="1.5 éç©ºæ–­è¨€ï¼š!!"></a>1.5 éç©ºæ–­è¨€ï¼š<code>!!</code></h2><p>éç©ºæ–­è¨€æ˜¯Kotlinæä¾›çš„æœ€ç®€å•ç²—æš´çš„ä¸€ä¸ªå¤„ç†å¯ç©ºç±»å‹çš„å·¥å…·ã€‚ä»–çš„ä½œç”¨å°±åƒä»–çš„æ ·å­ä¸€æ ·ï¼Œè¡¨ç¤ºæˆ‘å°±è®©è¿™ä¸ªç±»å‹è½¬æ¢æˆéç©ºç±»å‹ã€‚<br><img src="https://cdn.littlecorgi.top/mweb/2020-06-23/Kotlin%E5%85%A5%E9%97%A8-%E5%9B%9B-6.jpg" alt="Kotlinå…¥é—¨-å››-6"></p><p>è¿™ç§å’ŒJavaä¸€æ ·ï¼Œæ‰€ä»¥ä¹Ÿå°±æ²¡å•¥å¥½è¯´çš„ã€‚</p><h2 id="1-6-letå‡½æ•°"><a href="#1-6-letå‡½æ•°" class="headerlink" title="1.6 letå‡½æ•°"></a>1.6 <code>let</code>å‡½æ•°</h2><p>å…¶å®è¿™ä¸ª<code>let</code>å‡½æ•°å±äºåé¢æ ‡å‡†å‡½æ•°çš„å†…å®¹ï¼Œä½†æ˜¯ç”±äºæ ‡å‡†å‡½æ•°ä¸­çš„æ¯ä¸€ä¸ªå‡½æ•°éƒ½æ˜¯æœåŠ¡äºå…·ä½“æŸä¸ªåŠŸèƒ½çš„ï¼Œæ‰€ä»¥å°±æ”¾åœ¨åŠŸèƒ½è¿™å—æ¥è¯´è¿™ä¸ªå‡½æ•°ã€‚</p><p><code>let</code>å‡½æ•°å¤©ç”Ÿå°±æ˜¯ä¸º<code>?.</code>æœåŠ¡çš„ã€‚</p><p>æˆ‘ä»¬å›åˆ°ä¸Šé¢é‚£ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åœ¨è¿”å›<code>s</code>çš„<code>length</code>ä¹‹å‰å…ˆè®©ä»–åˆ é™¤è°ƒæœ€å‰é¢æˆ–è€…æœ€åé¢çš„ç©ºæ ¼ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">strLen</span><span class="params">(s: <span class="type">String</span>?)</span></span> = s?.let &#123; str -&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        str.trim()</span><br><span class="line">        str.length</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¸€èˆ¬æƒ…å†µï¼ŒKotlinçš„lambdaè¡¨è¾¾å¼éƒ½ä¼šå°†è¯­å¥çš„æœ€åä¸€å¥ä½œä¸ºreturnã€‚</p><p>ä½†æ˜¯åœ¨Kotlinçš„lambdaè¡¨è¾¾å¼ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è‡ªåŠ¨ç”Ÿæˆçš„åå­—<code>it</code>ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">strLen</span><span class="params">(s: <span class="type">String</span>?)</span></span> = s?.let &#123;</span><br><span class="line">    it.trim()</span><br><span class="line">    it.length</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è‡³äºä¸ºå•¥æ˜¯<code>it</code>ï¼Œè¿™ä¸ªæ˜¯Kotlinçš„lambdaè¡¨è¾¾å¼çš„ç‰¹æ®Šå­—ç¬¦ï¼Œå°±ç±»ä¼¼äºsetterå’Œgetterä¸­çš„<code>field</code>å­—æ®µä¸€æ ·çš„ã€‚</p><h2 id="1-7-å¯ç©ºç±»å‹çš„é›†åˆ"><a href="#1-7-å¯ç©ºç±»å‹çš„é›†åˆ" class="headerlink" title="1.7 å¯ç©ºç±»å‹çš„é›†åˆ"></a>1.7 å¯ç©ºç±»å‹çš„é›†åˆ</h2><p>Kotlinä¹Ÿå¯ä»¥åˆ›å»ºå€¼ä¸ºnullçš„é›†åˆï¼Œæ¯”å¦‚ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> nullsArray = arrayOfNulls&lt;<span class="built_in">Int</span>&gt;(<span class="number">1</span>) <span class="comment">// å…ƒç´ ç±»å‹ä¸ºIntï¼Œå®¹é‡ä¸º1çš„åˆå§‹å€¼å…¨ä¸ºnullçš„æ•°ç»„</span></span><br><span class="line"><span class="keyword">val</span> nullsArrayList = ArrayList&lt;<span class="built_in">Int</span>?&gt;() <span class="comment">// æ³›å‹ä¸ºInt?çš„ArrayList</span></span><br></pre></td></tr></table></figure></p><p>å¦‚æœä½ æœ‰ä¸€ä¸ªå¯ç©ºç±»å‹å…ƒç´ çš„é›†åˆï¼Œå¹¶ä¸”æƒ³è¦è¿‡æ»¤éç©ºå…ƒç´ ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>filterNotNull</code>æ¥å®ç°ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> nullableList: List&lt;<span class="built_in">Int</span>?&gt; = listOf(<span class="number">1</span>, <span class="number">2</span>, <span class="literal">null</span>, <span class="number">4</span>)</span><br><span class="line"><span class="keyword">val</span> intList: List&lt;<span class="built_in">Int</span>&gt; = nullableList.filterNotNull()</span><br></pre></td></tr></table></figure></p><h1 id="2-æ•°æ®ç±»"><a href="#2-æ•°æ®ç±»" class="headerlink" title="2. æ•°æ®ç±»"></a>2. æ•°æ®ç±»</h1><p>æˆ‘ä»¬åœ¨å‰è¨€ä¸¾çš„ä¾‹å­è¯´åˆ°è¿‡ï¼ŒKotlinå¯¹äºä¹‹å‰çš„é¥±å—è¯Ÿç—…çš„JavaBeanåšäº†ä¸€ä¸ªéå¸¸å¥½çš„å¤„ç†ã€‚</p><p>å¯¹äºè¿™ç±»åªéœ€è¦ä¿å­˜æ•°æ®çš„å®¹å™¨ï¼Œå¾€å¾€ä½ éƒ½éœ€è¦å»é‡å†™ä»–ä»¬çš„ä¸€äº›æ–¹æ³•ï¼Œæ¯”å¦‚<code>toString()</code>ã€<code>equals()</code>ã€<code>hashCode()</code>ç­‰æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•çš„å†™æ³•åˆç‰¹åˆ«çš„æœºæ¢°ï¼ŒåƒIdeaå’Œeclipseéƒ½æä¾›äº†è‡ªåŠ¨ç”Ÿæˆçš„æ–¹æ³•ã€‚</p><p>ä½†æ˜¯åœ¨Kotliné‡Œé¢ï¼Œä½ å°±ä¸å¿…å†å»æ‰‹åŠ¨å»æ“ä½œè¿™äº›æ–¹æ³•äº†ã€‚åœ¨Kotlinä¸­ï¼Œè¿™äº›ç±»å«åšæ•°æ®ç±»ï¼Œå¹¶ä¸”åªéœ€è¦åœ¨<code>class</code>çš„å‰é¢æ·»åŠ <code>data</code>ä¿®é¥°ç¬¦ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">Person</span>(<span class="keyword">val</span> name: String, <span class="keyword">val</span> age: <span class="built_in">Int</span>)</span><br></pre></td></tr></table></figure></p><p>åœ¨å£°æ˜ä¸ºæ•°æ®ç±»åï¼ŒKotlinå°±èƒ½è‡ªåŠ¨çš„å¸®ä½ é‡å†™ä»¥ä¸‹æ–¹æ³•ï¼š</p><ul><li><code>hashCode()</code>ï¼šè¿™ä¸ªæ–¹æ³•ä¸ç”¨å¤šä»‹ç»äº†ï¼Œå’ŒJavaä¸­ä¸€æ ·</li><li><code>equals()</code>ï¼šè¿™ä¸ªæ–¹æ³•ä¹Ÿä¸ç”¨å¤šä»‹ç»äº†ï¼Œå’ŒJavaä¸­ä¸€æ ·</li><li><code>toString()</code>ï¼šè¿™ä¸ªæ–¹æ³•ä»ç„¶ä¸ç”¨å¤šä»‹ç»äº†ï¼Œå’ŒJavaä¸­ä¸€æ ·</li><li><code>componentN()</code>ï¼šè¿™ä¸ªå‡½æ•°æ˜¯ç”¨æ¥<a href="https://www.kotlincn.net/docs/reference/multi-declarations.html">è§£æ„å£°æ˜</a>çš„ï¼Œè§ä¸‹æ–‡</li><li><code>copy()</code>ï¼šè§ä¸‹æ–‡</li></ul><p>æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹ä¸Šé¢é‚£ä¸ªç±»çš„å­—èŠ‚ç (<a href="https://blog.csdn.net/a1203991686/article/details/106379486#t1">çœ‹å­—èŠ‚ç çš„æ–¹æ³•åœ¨æ­¤</a>)ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">   <span class="meta">@NotNull</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@NotNull</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">final</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.age;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(<span class="meta">@NotNull</span> String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">      Intrinsics.checkParameterIsNotNull(name, <span class="string">&quot;name&quot;</span>);</span><br><span class="line">      <span class="built_in">super</span>();</span><br><span class="line">      <span class="built_in">this</span>.name = name;</span><br><span class="line">      <span class="built_in">this</span>.age = age;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@NotNull</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">final</span> String <span class="title function_">component1</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">component2</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.age;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@NotNull</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">final</span> Person <span class="title function_">copy</span><span class="params">(<span class="meta">@NotNull</span> String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">      Intrinsics.checkParameterIsNotNull(name, <span class="string">&quot;name&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Person</span>(name, age);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// $FF: synthetic method</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> Person copy$<span class="keyword">default</span>(Person var0, String var1, <span class="type">int</span> var2, <span class="type">int</span> var3, Object var4) &#123;</span><br><span class="line">      <span class="keyword">if</span> ((var3 &amp; <span class="number">1</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">         var1 = var0.name;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> ((var3 &amp; <span class="number">2</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">         var2 = var0.age;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> var0.copy(var1, var2);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@NotNull</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;Person(name=&quot;</span> + <span class="built_in">this</span>.name + <span class="string">&quot;, age=&quot;</span> + <span class="built_in">this</span>.age + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="type">String</span> <span class="variable">var10000</span> <span class="operator">=</span> <span class="built_in">this</span>.name;</span><br><span class="line">      <span class="keyword">return</span> (var10000 != <span class="literal">null</span> ? var10000.hashCode() : <span class="number">0</span>) * <span class="number">31</span> + <span class="built_in">this</span>.age;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(<span class="meta">@Nullable</span> Object var1)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span> != var1) &#123;</span><br><span class="line">         <span class="keyword">if</span> (var1 <span class="keyword">instanceof</span> Person) &#123;</span><br><span class="line">            <span class="type">Person</span> <span class="variable">var2</span> <span class="operator">=</span> (Person)var1;</span><br><span class="line">            <span class="keyword">if</span> (Intrinsics.areEqual(<span class="built_in">this</span>.name, var2.name) &amp;&amp; <span class="built_in">this</span>.age == var2.age) &#123;</span><br><span class="line">               <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä¸Šé¢çš„æ–¹æ³•ä¸­ä»»ä½•ä¸€ä¸ªå·²ç»æœ‰äº†æ˜¾å¼çš„å®ç°ï¼Œé‚£ä¹ˆæ•°æ®ç±»åœ¨ç”Ÿæˆçš„æ—¶å€™ï¼Œå°±ä¸ä¼šå†å»é‡æ–°ç”Ÿæˆè¿™ä¸ªå‡½æ•°ï¼Œè€Œæ˜¯ä¼šç›´æ¥ä½¿ç”¨æ˜¾å¼çš„è¿™ä¸ªå‡½æ•°ã€‚</p><h2 id="2-1-æ— å‚æ„é€ "><a href="#2-1-æ— å‚æ„é€ " class="headerlink" title="2.1 æ— å‚æ„é€ "></a>2.1 æ— å‚æ„é€ </h2><p>å¦‚æœæ•°æ®ç±»éœ€è¦ä¸€ä¸ªæ— å‚æ„é€ ï¼Œé‚£ä¹ˆå°±éœ€è¦å¯¹æ¯ä¸ªå±æ€§éƒ½æŒ‡å®šé»˜è®¤å€¼ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">Person</span>(<span class="keyword">val</span> name: String = <span class="string">&quot;&quot;</span>, <span class="keyword">val</span> age: <span class="built_in">Int</span> = <span class="number">0</span>)</span><br></pre></td></tr></table></figure><br>è¿™æ ·å°±ä¼šæœ‰ä¸€ä¸ªæ— å‚æ„é€ ã€‚</p><h2 id="2-2-åœ¨ç±»ä¸­å£°æ˜çš„å±æ€§"><a href="#2-2-åœ¨ç±»ä¸­å£°æ˜çš„å±æ€§" class="headerlink" title="2.2 åœ¨ç±»ä¸­å£°æ˜çš„å±æ€§"></a>2.2 åœ¨ç±»ä¸­å£°æ˜çš„å±æ€§</h2><p>æ•°æ®ç±»ä¹Ÿå¯ä»¥åœ¨ç±»çš„é‡Œé¢å»å£°æ˜å±æ€§ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">Person</span>(<span class="keyword">val</span> name: String, <span class="keyword">val</span> age: <span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> address: String = <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™æ ·çš„è¯ï¼Œæ•°æ®ç±»å¸®ä½ ç”Ÿæˆçš„é‚£äº›æ–¹æ³•(<code>equals()</code>ã€<code>toString()</code>ç­‰)ï¼Œéƒ½ä¸ä¼šå¸¦ä¸Š<code>address</code>è¿™ä¸ªå±æ€§ã€‚é™¤éä½ è‡ªå·±æ˜¾å¼é‡å†™å¯¹åº”çš„æ–¹æ³•ã€‚</p><h2 id="2-3-copy"><a href="#2-3-copy" class="headerlink" title="2.3 copy()"></a>2.3 copy()</h2><p>æˆ‘ä»¬ä¸Šé¢è¯´åˆ°ï¼Œæ•°æ®ç±»ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬ç”Ÿæˆ<code>copy()</code>æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ª<code>copy</code>åˆ°åº•æ˜¯å¹²å˜›çš„å‘¢ï¼Ÿ</p><p>å…¶å®è¯´å¥å®è¯ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªæ–¹æ³•çš„è¯ï¼Œä¹Ÿæœ‰ç‚¹é¸¡è‚‹ï¼Œä¹Ÿå°±æ˜¯é‚£ç§é£Ÿä¹‹æ— å‘³ï¼Œä½†æ˜¯åˆå¼ƒä¹‹å¯æƒœçš„ä¸œè¥¿(è¿™ä¹ˆè¯´å­˜åœ¨ä¸€å®šçš„ç»å¯¹)ï¼Œä½†æ˜¯ä¹Ÿæ— æ‰€è°“ï¼Œèƒ½å¤šç‚¹åŠŸèƒ½ï¼Œèƒ½è®©æˆ‘ä»¬å°‘å†™ç‚¹ä»£ç å½“ç„¶æ˜¯å¥½çš„äº†ã€‚</p><p>å¥½äº†ï¼Œè¯´å›æ¥ï¼Œè¿™ä¸ªæ–¹æ³•åˆ°åº•æ˜¯å¹²å˜›çš„å‘¢ï¼Ÿå…¶å®å•çœ‹åå­—å°±èƒ½çœ‹å‡ºæ¥ï¼Œè‚¯å®šä¸å¤åˆ¶æœ‰å…³ï¼Œä½†æ˜¯ä»–åˆ°åº•æ˜¯å¤åˆ¶å•¥å‘¢ã€‚</p><p>å…¶å®åœ¨æœ‰äº›æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦ç”Ÿæˆè¿™ä¸ªç±»çš„å¦å¤–ä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯å¾ˆå¤šå±æ€§éƒ½å’Œè¿™ä¸ªç±»çš„åŸæœ¬çš„å¯¹è±¡éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹ä»–å…¶ä¸­çš„æŸä¸€ä¸ªå±æ€§ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™<code>copy()</code>å°±å¾ˆæœ‰ç”¨äº†ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> jack = Person(<span class="string">&quot;Jack&quot;</span>, <span class="number">1</span>)</span><br><span class="line"><span class="keyword">val</span> oldJack = jack.copy(age = <span class="number">28</span>)</span><br></pre></td></tr></table></figure><br>æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å»è°ƒç”¨<code>jack</code>çš„<code>copy()</code>æ–¹æ³•ï¼Œåœ¨å‚æ•°ä¸­æŒ‡å®šæˆ‘ä»¬éœ€è¦ä¿®æ”¹çš„å±æ€§ï¼Œè¿™æ ·å°±å¯ä»¥è¿”å›ä¸€ä¸ªé™¤äº†æŒ‡å®šçš„å±æ€§å¤–ï¼Œå…¶å®ƒå±æ€§éƒ½å’ŒåŸå¯¹è±¡ä¸€æ ·çš„ä¸€ä¸ªæ–°å¯¹è±¡ã€‚</p><p>å…¶å®è¿™ä¸ªæ–¹æ³•ä¹Ÿè¿˜æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œä½†æ˜¯æˆ‘ä¸ºä»€ä¹ˆåˆåœ¨ä¸Šé¢è¯´é£Ÿä¹‹æ— å‘³å¼ƒä¹‹å¯æƒœï¼Ÿå› ä¸ºè¯´å®è¯ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªä¸œè¥¿ï¼Œæˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨çš„ç€å®å°‘ï¼Œå¯ä»¥è¯´å°‘ä¹‹åˆå°‘ï¼Œä½†æ˜¯å•çœ‹æ¦‚å¿µåˆæŒºæœ‰ç”¨ï¼Œå¹¶ä¸”å¦‚æœçœŸçš„è®©æˆ‘ä»¬è‡ªå·±å»é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œè™½ç„¶è¯´åœ¨æŠ€æœ¯å±‚é¢ï¼Œå®ç°è¿™ä¸ªæ–¹æ³•ç€å®ç®€å•ï¼Œä½†æ˜¯ä¸€æ—¦æˆ‘ä»¬å±æ€§å¤šäº†èµ·æ¥ä¹‹åï¼Œé‡å†™èµ·æ¥è¿˜çœŸçš„å¾—èŠ±ç‚¹åŠŸå¤«ã€‚</p><h2 id="2-4-è§£æ„å£°æ˜"><a href="#2-4-è§£æ„å£°æ˜" class="headerlink" title="2.4 è§£æ„å£°æ˜"></a>2.4 è§£æ„å£°æ˜</h2><p>å¯¹äºJavaæ¥è¯´ï¼Œè§£æ„å£°æ˜æ˜¯ä¸€ä¸ªæ–°çš„ä¸œè¥¿ï¼Œè€Œè¿™ä¸ªï¼Œè¯´å®è¯ï¼Œåœ¨æˆ‘çœ‹æ¥å’Œä¸Šé¢é‚£ä¸ª<code>copy()</code>å·®ä¸å¤šï¼Œä¹Ÿæ˜¯ä¸€ä¸ªé£Ÿä¹‹æ— å‘³å¼ƒä¹‹å¯æƒœçš„ä¸œè¥¿ã€‚ä½†æ˜¯ï¼Œè¿™æ˜¯ç›¸å¯¹äºæ•°æ®ç±»æ¥è¯´çš„ã€‚æˆ‘ä¸ºå•¥è¿™ä¹ˆè¯´å‘¢ï¼Œç»§ç»­å¾€ä¸‹çœ‹å°±çŸ¥é“äº†ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬ç›´æ¥ä¸Šä»£ç ï¼Œçœ‹ä¸‹è§£æ„å£°æ˜åˆ°åº•æ˜¯ä»€ä¹ˆï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> jack = Person(<span class="string">&quot;Jack&quot;</span>, <span class="number">1</span>)</span><br><span class="line"><span class="keyword">val</span> (name, age) = jack</span><br><span class="line">println(<span class="string">&quot;<span class="variable">$name</span>&#x27;s age is <span class="variable">$age</span>&quot;</span>)</span><br></pre></td></tr></table></figure><br>å…¶ä¸­ç¬¬äºŒè¡Œé‚£å°±æ˜¯è§£æ„å£°æ˜ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å°†æŸä¸ªå¯¹è±¡çš„æ‰€æœ‰å±æ€§ç»™å•ç‹¬æ‹å‡ºæ¥ã€‚</p><p>çœ‹åˆ°è¿™ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿä¼šå’Œæˆ‘ä¸€æ ·äº§ç”Ÿä¸€ä¸ªæ„Ÿè§‰ï¼Œè¿™ä¸ªä¸œè¥¿ç€å®æ„ä¹‰ä¸å¤§ï¼Œæˆ‘ä»¬æƒ³å»è·å–æŸä¸ªå±æ€§çš„è¯ï¼Œç›´æ¥è°ƒç”¨è¿™ä¸ªç±»çš„å±æ€§çš„<code>getter</code>ä¸å°±è¡Œäº†å—ã€‚</p><p>ä½†æ˜¯æˆ‘åˆšåˆšè¯´äº†ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªä¸œè¥¿å¾ˆé¸¡è‚‹ï¼Œæ˜¯é’ˆå¯¹äºæ•°æ®ç±»æ¥è¯´çš„ï¼Œä¸‹é¢æˆ‘ç»™ä½ çœ‹ä¸ªä»£ç ä½ å°±ä¼šè§‰å¾—è¿™ä¸ªä¸œè¥¿éå¸¸æœ‰ç”¨äº†ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> map = HashMap&lt;String, Person&gt;()</span><br><span class="line"><span class="keyword">for</span> ((name, person) <span class="keyword">in</span> map) &#123;</span><br><span class="line">    println(<span class="string">&quot;<span class="variable">$name</span> to (<span class="subst">$&#123;person.name&#125;</span>, <span class="subst">$&#123;person.age&#125;</span>)&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="3-å¯†å°ç±»"><a href="#3-å¯†å°ç±»" class="headerlink" title="3. å¯†å°ç±»"></a>3. å¯†å°ç±»</h1><p>å…¶å®å¯†å°ç±»å¾ˆç®€å•ï¼Œæ²¡å•¥ç‰¹åˆ«çš„ä¸œè¥¿ï¼Œ</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Expr</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Num</span>(<span class="keyword">val</span> value: <span class="built_in">Int</span>) : Expr</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Sum</span>(<span class="keyword">val</span> left: Expr, <span class="keyword">val</span> right: Expr) : Expr</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">eval</span><span class="params">(e: <span class="type">Expr</span>)</span></span>: <span class="built_in">Int</span> =</span><br><span class="line">    <span class="keyword">when</span> (e) &#123;</span><br><span class="line">        <span class="keyword">is</span> Num -&gt; e.value</span><br><span class="line">        <span class="keyword">is</span> Sum -&gt; eval(e.left) + eval(e.right)</span><br><span class="line">        <span class="keyword">else</span> -&gt;</span><br><span class="line">            <span class="keyword">throw</span> IllegalArgumentException(<span class="string">&quot;Unknown expression&quot;</span>)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><br>æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªçˆ¶ç±»(æ¥å£)<code>Expr</code>ï¼Œä»¥åŠä»–çš„ä¸¤ä¸ªå­ç±»ï¼šä»£è¡¨æ•°å­—çš„<code>Num</code>å’Œä»£è¡¨å’Œçš„<code>Sum</code>ï¼Œç„¶åæˆ‘ä»¬åœ¨<code>when</code>ä¸­å»å¤„ç†æ‰€æœ‰çš„æ“ä½œã€‚</p><p>ç›®å‰æ¥è¯´è¿™æ ·å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯å…¶å®æœ‰ä¸€ç‚¹å¾ˆå¤šä½™ï¼Œå°±æ˜¯æˆ‘ä»¬å®Œå…¨æ²¡æœ‰å¿…è¦å»å†™<code>when</code>ä¸­çš„<code>else</code>åˆ†æ”¯ï¼Œå› ä¸ºä»–å®Œå…¨ä¸å¯èƒ½æ˜¯å…¶ä»–ç±»å‹ã€‚å¹¶ä¸”å¦‚æœæˆ‘ä»¬æ–°å¢äº†ä¸€ä¸ª<code>Expr</code>çš„å­ç±»ï¼Œä¸‡ä¸€å¿˜è®°äº†åœ¨<code>when</code>æ·»åŠ å¯¹åº”çš„åˆ†æ”¯ï¼Œé‚£ä¹ˆç¨‹åºå°±å­˜åœ¨bugã€‚</p><p>è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬çš„å¯†å°ç±»å°±æ´¾ä¸Šç”¨åœºäº†ã€‚åœ¨Kotlinå®˜æ–¹æ–‡æ¡£ï¼Œå¯¹å¯†å°ç±»çš„å®šä¹‰å¾ˆç®€å•ï¼šâ€œå¯†å°ç±»ç”¨æ¥è¡¨ç¤ºå—é™çš„ç±»ç»§æ‰¿ç»“æ„ï¼šå½“ä¸€ä¸ªå€¼ä¸ºæœ‰é™å‡ ç§çš„ç±»å‹ã€è€Œä¸èƒ½æœ‰ä»»ä½•å…¶ä»–ç±»å‹æ—¶ã€‚â€ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸Šé¢è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬éå¸¸æ˜ç¡®Exprä¸å¯èƒ½ä¼šå†æœ‰å…¶å®ƒçš„å­ç±»çš„ï¼Œæ‰€ä»¥å°±æ²¡æœ‰å¿…è¦å†å»å†™elseåˆ†æ”¯ã€‚</p><p>è€Œå®ç°å¯†å°ç±»ä¹Ÿå¾ˆç®€å•ï¼Œåœ¨classå‰é¢åŠ ä¸Šsealedã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨å¯†å°ç±»æ”¹å†™ä¸€ä¸‹ä¸Šé¢é‚£ä¸ªä¾‹å­ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title class_">Expr</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Num</span>(<span class="keyword">val</span> value: <span class="built_in">Int</span>) : Expr()</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Sum</span>(<span class="keyword">val</span> left: Expr, <span class="keyword">val</span> right: Expr) : Expr()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">eval</span><span class="params">(e: <span class="type">Expr</span>)</span></span>: <span class="built_in">Int</span> =</span><br><span class="line">    <span class="keyword">when</span> (e) &#123;</span><br><span class="line">        <span class="keyword">is</span> Num -&gt; e.value</span><br><span class="line">        <span class="keyword">is</span> Sum -&gt; eval(e.left) + eval(e.right)</span><br><span class="line">        <span class="comment">// ä¸å†éœ€è¦elseï¼Œ</span></span><br><span class="line">        <span class="comment">// å¹¶ä¸”å¦‚æœä½ å†™äº†elseï¼Œç¼–è¯‘å™¨ä¼šæç¤ºä½ &#x27;when&#x27; is exhaustive so &#x27;else&#x27; is redundant here</span></span><br><span class="line">        <span class="comment">// else -&gt;</span></span><br><span class="line">        <span class="comment">//     throw IllegalArgumentException(&quot;Unknown expression&quot;)</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><h1 id="4-æšä¸¾ç±»"><a href="#4-æšä¸¾ç±»" class="headerlink" title="4. æšä¸¾ç±»"></a>4. æšä¸¾ç±»</h1><p>å¯¹äºæšä¸¾ç±»ï¼ŒKotlinå’ŒJavaçš„ç”¨æ³•æ²¡å•¥åŒºåˆ«ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="keyword">class</span> <span class="title class_">Direction</span> &#123;</span><br><span class="line">    NORTH, SOUTH, WEST, EAST</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-1-åˆå§‹åŒ–"><a href="#4-1-åˆå§‹åŒ–" class="headerlink" title="4.1 åˆå§‹åŒ–"></a>4.1 åˆå§‹åŒ–</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="keyword">class</span> <span class="title class_">Color</span>(<span class="keyword">val</span> rgb: <span class="built_in">Int</span>) &#123;</span><br><span class="line">        RED(<span class="number">0xFF0000</span>),</span><br><span class="line">        GREEN(<span class="number">0x00FF00</span>),</span><br><span class="line">        BLUE(<span class="number">0x0000FF</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="5-åµŒå¥—ç±»"><a href="#5-åµŒå¥—ç±»" class="headerlink" title="5. åµŒå¥—ç±»"></a>5. åµŒå¥—ç±»</h1><h2 id="5-1-åµŒå¥—ç±»"><a href="#5-1-åµŒå¥—ç±»" class="headerlink" title="5.1 åµŒå¥—ç±»"></a>5.1 åµŒå¥—ç±»</h2><p>åœ¨Javaä¸­ï¼Œæˆ‘ä»¬å¾ˆå¤šæ—¶å€™éƒ½ä¼šåœ¨ä¸€ä¸ªç±»é‡Œé¢å†å»å£°æ˜ä¸€ä¸ªç±»ï¼Œè¿™ç§ç±»å°±å«åšå†…éƒ¨ç±»ã€‚</p><p>è€ŒKotlinæŠŠè¿™ç§ç±»å«åšåµŒå¥—ç±»ã€‚ç®€å•æ¥è¯´å°±æ˜¯æŠŠè¿™ä¸ªç±»åµŒå¥—åœ¨äº†å¦ä¸€ä¸ªç±»é‡Œé¢ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> age: <span class="built_in">Int</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> name: Name = Name(<span class="string">&quot;William&quot;</span>, <span class="string">&quot;Shakespeare&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Name</span>(<span class="keyword">val</span> firstName: String, <span class="keyword">val</span> lastName: String)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ä½†æ˜¯ï¼Œä½ å¦‚æœæŠŠä¸Šé¢è¿™æ®µä»£ç ç¿»è¯‘æˆå­—èŠ‚ç çš„è¯ï¼Œä½ ä¼šå‘ç°å…¶å®è¿™ä¸ªåµŒå¥—ç±»ï¼Œä»–æ˜¯<code>static</code>çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»–ä¸æŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨ï¼Œå¹¶ä¸”ä½ åœ¨åµŒå¥—ç±»ä¸­ï¼Œæ²¡æ³•ç›´æ¥ä½¿ç”¨å¤–éƒ¨ç±»çš„å±æ€§æˆ–è€…æ–¹æ³•ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨Androidä¸­å†™<code>Handler</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±ç›´æ¥å†™ä¸€ä¸ª<code>Handler</code>çš„åµŒå¥—ç±»å°±è¡Œäº†ã€‚</p><h2 id="5-2-å†…éƒ¨ç±»"><a href="#5-2-å†…éƒ¨ç±»" class="headerlink" title="5.2 å†…éƒ¨ç±»"></a>5.2 å†…éƒ¨ç±»</h2><p>ä½†æ˜¯å¦‚æœä½ å°±æ˜¯æƒ³å†™ä¸€ä¸ªæ™®é€šçš„å†…éƒ¨ç±»ï¼Œå°±æ˜¯ä¸€ä¸ªæ²¡æœ‰<code>static</code>ä¿®é¥°çš„å†…éƒ¨ç±»ï¼Œé‚£ä¹ˆKotlinå°±æä¾›äº†ä¸€ä¸ª<code>inner</code>å…³é”®å­—ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> age: <span class="built_in">Int</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> name: Name = Name(<span class="string">&quot;William&quot;</span>, <span class="string">&quot;Shakespeare&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">inner</span> <span class="keyword">class</span> <span class="title class_">Name</span>(<span class="keyword">val</span> firstName: String, <span class="keyword">val</span> lastName: String) &#123;</span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">print</span><span class="params">()</span></span> &#123;</span><br><span class="line">            println(<span class="string">&quot;<span class="variable">$firstName</span> <span class="variable">$lastName</span>&#x27;s age is <span class="variable">$age</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¿™æ ·ï¼Œ<code>Name</code>è¿™ä¸ªç±»ï¼Œå°±æ˜¯ä¸€ä¸ªé<code>static</code>çš„å†…éƒ¨ç±»äº†ï¼Œå¹¶ä¸”ä»–ä¼šæŒæœ‰å¤–éƒ¨ç±»<code>Person</code>çš„å¼•ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥è®¿é—®å¤–éƒ¨ç±»çš„å±æ€§ï¼Œä¸Šé¢é‚£ä¸ª<code>Name</code>ç±»ä¸­çš„<code>print()</code>æ–¹æ³•æ‰å¯ä»¥å»è®¿é—®<code>Person</code>çš„å±æ€§<code>age</code>ã€‚</p><h2 id="5-3-åŒ¿åå†…éƒ¨ç±»"><a href="#5-3-åŒ¿åå†…éƒ¨ç±»" class="headerlink" title="5.3 åŒ¿åå†…éƒ¨ç±»"></a>5.3 åŒ¿åå†…éƒ¨ç±»</h2><p>åœ¨Javaä¸­æˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨åˆ°åŒ¿åå†…éƒ¨ç±»ï¼Œæ¯”æ–¹è¯´æˆ‘ä»¬å†™Callbackå›è°ƒçš„æ—¶å€™ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">call.enqueue(<span class="keyword">new</span> <span class="title class_">Callback</span>&lt;Translation&gt;() &#123;</span><br><span class="line">    <span class="comment">//è¯·æ±‚æˆåŠŸæ—¶å›è°ƒ</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onResponse</span><span class="params">(Call&lt;Translation&gt; call, Response&lt;Translation&gt; response)</span> &#123;</span><br><span class="line">        <span class="comment">// å¯¹è¿”å›æ•°æ®è¿›è¡Œå¤„ç†</span></span><br><span class="line">        response.body().show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¯·æ±‚å¤±è´¥æ—¶å€™çš„å›è°ƒ</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onFailure</span><span class="params">(Call&lt;Translation&gt; call, Throwable throwable)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è¿æ¥å¤±è´¥&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><br>è¿™ä¸ªæ—¶å€™ï¼Œenqueueä¼ å…¥çš„å°±æ˜¯ä¸€ä¸ªç»§æ‰¿è‡ªCallbackç±»çš„åŒ¿åå†…éƒ¨ç±»ã€‚</p><p>è€Œåœ¨Kotlinä¸­ï¼Œä¹Ÿæ˜¯å·®ä¸å¤šçš„å½¢å¼ï¼Œåªä¸è¿‡æˆ‘ä»¬éœ€è¦å€Ÿç”¨ä¸‹<code>object</code>å…³é”®å­—ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">call.enqueue(<span class="keyword">object</span> : Callback&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onFailure</span><span class="params">(call: <span class="type">Call</span>&lt;<span class="type">T</span>&gt;, t: <span class="type">Throwable</span>)</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;è¿æ¥å¤±è´¥&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onResponse</span><span class="params">(call: <span class="type">Call</span>&lt;<span class="type">T</span>&gt;, response: <span class="type">Response</span>&lt;<span class="type">T</span>&gt;)</span></span> &#123;</span><br><span class="line">        response?.body().show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Kotlin/">Kotlin</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Kotlin/">Kotlin</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/">è¯­è¨€åŸºç¡€</category>
      
      
      <comments>https://www.littlecorgi.top/posts/6f3ca960.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Kotlinå…¥é—¨(ä¸‰)â€”â€”ç±»ã€å¯¹è±¡ã€æ¥å£</title>
      <link>https://www.littlecorgi.top/posts/756a6103.html</link>
      <guid>https://www.littlecorgi.top/posts/756a6103.html</guid>
      <pubDate>Wed, 10 Jun 2020 07:41:23 GMT</pubDate>
      
      <description>&lt;blockquote&gt;
&lt;p&gt;æœ¬ç« å†…å®¹åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç±»çš„åŸºæœ¬è¦ç´ &lt;/li&gt;
&lt;li&gt;ç±»çš„ç»§æ‰¿ç»“æ„&lt;/li&gt;
&lt;li&gt;ä¿®é¥°ç¬¦&lt;/li&gt;
&lt;li&gt;æ¥å£&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;0-å‰è¨€&quot;&gt;&lt;a href=&quot;#0-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0. å‰è¨€&quot;&gt;&lt;/a&gt;0. å‰è¨€&lt;/h1&gt;&lt;p&gt;åœ¨&lt;a href=&quot;https://blog.csdn.net/a1203991686/article/details/106421100&quot;&gt;ä¸Šä¸€ç¯‡&lt;/a&gt;çš„æœ«å°¾ï¼Œæˆ‘ä»¬æåˆ°äº†Kotlinçš„åŒ…å’Œå¯¼å…¥ã€‚&lt;/p&gt;
&lt;p&gt;åŸæœ¬æˆ‘æ˜¯å‡†å¤‡æŠŠè¿™ç¯‡çš„å†…å®¹ä¹Ÿæ”¾åœ¨ä¸Šä¸€ç¯‡çš„ï¼Œä½†æ˜¯åæ¥ä¸€æƒ³ï¼Œè¿™å¼ çš„å†…å®¹ä¼šå¾ˆæœ‰ç‚¹å¤šï¼Œæ”¾è¿›å»çš„è¯å¯èƒ½ä¼šå¯¼è‡´ä¸Šä¸€ç¯‡å¤ªå¤§äº†ï¼Œæ‰€ä»¥å°±å•ç‹¬åˆ†æˆä¸€ç¯‡äº†ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¯´ç±»ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ä¸€ä¸ªç±»çš„Javaç‰ˆå’ŒKotlinç‰ˆçš„å¯¹æ¯”ï¼Œè¿™ä¸ªä¼šä¸€ä¸‹å­å°±è®©ä½ å¯¹Kotlinæ„Ÿå…´è¶£ã€‚&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>æœ¬ç« å†…å®¹åŒ…æ‹¬ï¼š</p><ul><li>ç±»çš„åŸºæœ¬è¦ç´ </li><li>ç±»çš„ç»§æ‰¿ç»“æ„</li><li>ä¿®é¥°ç¬¦</li><li>æ¥å£</li></ul></blockquote><h1 id="0-å‰è¨€"><a href="#0-å‰è¨€" class="headerlink" title="0. å‰è¨€"></a>0. å‰è¨€</h1><p>åœ¨<a href="https://blog.csdn.net/a1203991686/article/details/106421100">ä¸Šä¸€ç¯‡</a>çš„æœ«å°¾ï¼Œæˆ‘ä»¬æåˆ°äº†Kotlinçš„åŒ…å’Œå¯¼å…¥ã€‚</p><p>åŸæœ¬æˆ‘æ˜¯å‡†å¤‡æŠŠè¿™ç¯‡çš„å†…å®¹ä¹Ÿæ”¾åœ¨ä¸Šä¸€ç¯‡çš„ï¼Œä½†æ˜¯åæ¥ä¸€æƒ³ï¼Œè¿™å¼ çš„å†…å®¹ä¼šå¾ˆæœ‰ç‚¹å¤šï¼Œæ”¾è¿›å»çš„è¯å¯èƒ½ä¼šå¯¼è‡´ä¸Šä¸€ç¯‡å¤ªå¤§äº†ï¼Œæ‰€ä»¥å°±å•ç‹¬åˆ†æˆä¸€ç¯‡äº†ã€‚</p><p>åœ¨è¯´ç±»ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ä¸€ä¸ªç±»çš„Javaç‰ˆå’ŒKotlinç‰ˆçš„å¯¹æ¯”ï¼Œè¿™ä¸ªä¼šä¸€ä¸‹å­å°±è®©ä½ å¯¹Kotlinæ„Ÿå…´è¶£ã€‚</p><span id="more"></span><p>æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œéœ€è¦å®šä¹‰ä¸€ä¸ªJavaBeanç±»Personï¼Œè¿™ä¸ªç±»ä¸­åŒ…å«è¿™ä¸ªäººçš„å§“åã€ç”µè¯å·ç ä»¥åŠåœ°å€ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹Javaçš„å®ç°ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String firstName;</span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> String telephone;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String firstName, String lastName, String telephone, String address)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.firstName = firstName;</span><br><span class="line">        <span class="built_in">this</span>.lastName = lastName;</span><br><span class="line">        <span class="built_in">this</span>.telephone = telephone;</span><br><span class="line">        <span class="built_in">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getFirstName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> firstName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFirstName</span><span class="params">(String firstName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.firstName = firstName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getLastName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> lastName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLastName</span><span class="params">(String lastName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.lastName = lastName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getTelephone</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> telephone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTelephone</span><span class="params">(String telephone)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.telephone = telephone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAddress</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAddress</span><span class="params">(String address)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™æ˜¯ä¸€ä¸ªå¾ˆåŸºæœ¬çš„Javaç±»ï¼Œæˆ‘ä»¬å®šä¹‰äº†å››ä¸ªprivateå±æ€§ï¼Œç„¶åç»™å®šäº†ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œç„¶åå¯¹æ¯ä¸ªå±æ€§éƒ½ç»™äº†getå’Œsetæ–¹æ³•ã€‚</p><p>ç›¸ä¿¡å¤§å®¶å­¦Javaä¸€å®šéƒ½å†™è¿‡è¿™ä¸ªç±»ã€‚ä½†æ˜¯æˆ‘ä»¬æƒ³æƒ³ï¼Œå°±å†™ä¸€ä¸ªåŠŸèƒ½è¿™ä¹ˆç®€å•çš„ç±»ï¼ŒJavaå´éœ€è¦æˆ‘ä»¬å†™è¿™ä¹ˆå¤šå†…å®¹ï¼Œæœ‰çš„åŒå­¦ä¼šè¯´ï¼šIdeaå’ŒEclipseéƒ½ä¸æ˜¯æä¾›äº†è‡ªåŠ¨ç”Ÿæˆä»£ç çš„å·¥å…·å—ã€‚ä½†æ˜¯å¦‚æœä½ çœ‹äº†Kotlinçš„å®ç°ï¼Œä¸€å®šä¼šè§‰å¾—è¿è‡ªåŠ¨ç”Ÿæˆå·¥å…·éƒ½éº»çƒ¦ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>(</span><br><span class="line">    <span class="keyword">val</span> firstName: String,</span><br><span class="line">    <span class="keyword">val</span> lastName: String,</span><br><span class="line">    <span class="keyword">val</span> telephone: String,</span><br><span class="line">    <span class="keyword">val</span> address: String</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>å¯¹ï¼Œä½ æ²¡æœ‰çœ‹é”™ï¼ŒKotlinçš„ç±»å°±æ˜¯è¿™ä¹ˆçš„ç®€å•ï¼š</p><ul><li><p>ç”±äºKotlinçš„å±æ€§é»˜è®¤çš„ä¿®é¥°ç¬¦å°±æ˜¯<code>public</code>ã€‚ä½†æ˜¯ç”±äºæˆ‘ä»¬è¿™ä¸ªæ–¹æ³•è®¾ç½®æˆäº†<code>val</code>ï¼Œæ‰€ä»¥é™¤äº†æ„é€ æ–¹æ³•å¤–ï¼Œæ²¡æ³•å¯¹è¿™ä¸ªå±æ€§çš„å€¼è¿›è¡Œæ›´æ”¹ã€‚ä½†æ˜¯ä»Kotlinç¼–è¯‘åä¼šè‡ªåŠ¨å°†<code>val</code>çš„å±æ€§è½¬ä¸º<code>private final String firstName;</code>ï¼Œ<code>var</code>çš„å±æ€§è½¬ä¸º<code>private String firstName;</code></p></li><li><p>ç”±äºKotlinä¼šè‡ªåŠ¨ä¸ºå±æ€§ç”Ÿæˆ<code>get</code>å’Œ<code>set</code>æ–¹æ³•ï¼Œæ‰€ä»¥æ²¡å¿…è¦å»æ˜¾å¼çš„å†™<code>get</code>å’Œ<code>set</code>æ–¹æ³•ï¼Œé™¤éä½ éœ€è¦è‡ªå®šä¹‰çš„<code>get</code>å’Œ<code>set</code>æ–¹æ³•ã€‚ä½†æ˜¯ç”±äºè¿™ä¸ªç±»çš„å±æ€§éƒ½æ˜¯<code>val</code>ï¼Œæ‰€ä»¥åªä¼šç”Ÿæˆ<code>get</code>æ–¹æ³•ã€‚</p></li><li>Kotlinçš„é»˜è®¤æ„é€ æ–¹æ³•æ˜¯ç›´æ¥å†™åœ¨ç±»ååé¢çš„</li></ul><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±æŠŠè¿™ä¸ªä»£ç è¿›è¡Œåˆ†è§£ï¼Œé€æ­¥æ¥è®²è§£Kotlinçš„ç±»ã€‚</p><h1 id="1-ç±»ä¸ç»§æ‰¿"><a href="#1-ç±»ä¸ç»§æ‰¿" class="headerlink" title="1. ç±»ä¸ç»§æ‰¿"></a>1. ç±»ä¸ç»§æ‰¿</h1><h2 id="1-1-ç±»"><a href="#1-1-ç±»" class="headerlink" title="1.1 ç±»"></a>1.1 ç±»</h2><p>ä¸Javaç±»ä¼¼ï¼ŒKotlinä¹Ÿæ˜¯ä½¿ç”¨<code>class</code>å…³é”®å­—æ¥è¡¨ç¤ºç±»ã€‚<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>() &#123;&#125;</span><br></pre></td></tr></table></figure></p><p>ç±»å£°æ˜ç”±ç±»åã€ç±»å¤´ï¼ˆæŒ‡å®šå…¶ç±»å‹å‚æ•°ã€ä¸»æ„é€ å‡½æ•°ç­‰ï¼‰ä»¥åŠç”±èŠ±æ‹¬å·åŒ…å›´çš„ç±»ä½“æ„æˆã€‚ç±»å¤´å’Œç±»ä½“éƒ½æ˜¯å¯é€‰çš„ï¼Œä¸€ä¸ªç±»å¦‚æœæ²¡æœ‰ç±»ä½“ï¼Œå¯ä»¥çœç•¥èŠ±æ‹¬å·ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>()</span><br></pre></td></tr></table></figure></p><h2 id="1-2-æ„é€ å‡½æ•°"><a href="#1-2-æ„é€ å‡½æ•°" class="headerlink" title="1.2 æ„é€ å‡½æ•°"></a>1.2 æ„é€ å‡½æ•°</h2><h3 id="1-2-1-ä¸»æ„é€ å‡½æ•°"><a href="#1-2-1-ä¸»æ„é€ å‡½æ•°" class="headerlink" title="1.2.1 ä¸»æ„é€ å‡½æ•°"></a>1.2.1 ä¸»æ„é€ å‡½æ•°</h3><p>Kotlinçš„ä¸€ä¸ªç±»å¯ä»¥æœ‰ä¸€ä¸ªä¸»æ„é€ å‡½æ•°ä»¥åŠä¸€ä¸ªæˆ–è€…å¤šä¸ªæ¬¡æ„é€ å‡½æ•°ã€‚ä¸»æ„é€ å‡½æ•°æ˜¯ç±»å¤´çš„ä¸€éƒ¨åˆ†ï¼Œè·Ÿåœ¨ç±»åä¹‹åï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> <span class="keyword">constructor</span>(<span class="keyword">val</span> name: String)&#123;&#125;</span><br></pre></td></tr></table></figure><br>å¦‚æœä¸»æ„é€ å‡½æ•°æ²¡æœ‰ä»»ä½•æ³¨è§£æˆ–è€…å¯è§æ€§ä¿®é¥°ç¬¦ï¼Œå¯ä»¥çœç•¥è¿™ä¸ª<code>constructor</code>å…³é”®å­—ã€‚<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>(<span class="keyword">val</span> name: String)&#123;&#125;</span><br></pre></td></tr></table></figure></p><p>ä¸»æ„é€ æ–¹æ³•ä¸»è¦æœ‰ä¸¤ç§ç›®çš„ï¼šè¡¨æ˜æ„é€ æ–¹æ³•çš„å‚æ•°ï¼Œä»¥åŠå®šä¹‰ä½¿ç”¨è¿™äº›å‚æ•°åˆå§‹åŒ–çš„å±æ€§ã€‚</p><p>ä½†æ˜¯ä¸»æ„é€ æ–¹æ³•ä¸å…è®¸ç›´æ¥æœ‰ä»£ç å—ï¼Œæ‰€ä»¥å¦‚æœéœ€è¦åœ¨ä¸»æ„é€ æ–¹æ³•ä¸­æ·»åŠ åˆå§‹åŒ–ä»£ç ï¼Œå¯ä»¥æ”¾åˆ°initå…³é”®å­—çš„ä»£ç å—ä¸­ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>(<span class="keyword">val</span> _name: String) &#123;</span><br><span class="line">    <span class="keyword">val</span> name: String</span><br><span class="line">    <span class="keyword">init</span> &#123;</span><br><span class="line">        name = _name</span><br><span class="line">        println(name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯åŒæ—¶ï¼Œè¿™ä¸ªä¾‹å­ä¸­ï¼Œ_nameèµ‹å€¼ç»™nameï¼Œè¿™ä¸ªè¯­å¥å¯ä»¥æ”¾åœ¨nameçš„å®šä¹‰ä¸­å»ï¼Œæ‰€ä»¥å¯ä»¥æ”¹æˆï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>(<span class="keyword">val</span> _name: String) &#123;</span><br><span class="line">    <span class="keyword">val</span> name: =  _name</span><br><span class="line">    <span class="keyword">init</span> &#123;</span><br><span class="line">        println(name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯ï¼Œå¦‚æœä¸»æ„é€ æ–¹æ³•éœ€è¦æ·»åŠ æ³¨è§£æˆ–è€…ä¿®é¥°ç¬¦çš„è¯ï¼Œè¿™ä¸ª<code>constructor</code>æ˜¯ä¸èƒ½çœç•¥çš„ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> <span class="keyword">private</span> <span class="keyword">constructor</span>(<span class="keyword">val</span> name: String) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="1-2-2-æ¬¡æ„é€ å‡½æ•°"><a href="#1-2-2-æ¬¡æ„é€ å‡½æ•°" class="headerlink" title="1.2.2 æ¬¡æ„é€ å‡½æ•°"></a>1.2.2 æ¬¡æ„é€ å‡½æ•°</h3><p>ç±»ä¹Ÿå¯ä»¥å•çº¯çš„å£°æ˜æ¬¡æ„é€ æ–¹æ³•è€Œä¸å£°æ˜ä¸»æ„é€ æ–¹æ³•ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">val</span> name: String</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>(_name: String) &#123;</span><br><span class="line">        name = _name</span><br><span class="line">        println(name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¦‚æœç±»æœ‰ä¸€ä¸ªä¸»æ„é€ å‡½æ•°ï¼Œæ¯ä¸ªæ¬¡æ„é€ å‡½æ•°éœ€è¦å§”æ‰˜ç»™ä¸»æ„é€ å‡½æ•°ï¼Œ å¯ä»¥ç›´æ¥å§”æ‰˜æˆ–è€…é€šè¿‡åˆ«çš„æ¬¡æ„é€ å‡½æ•°é—´æ¥å§”æ‰˜ã€‚å§”æ‰˜åˆ°åŒä¸€ä¸ªç±»çš„å¦ä¸€ä¸ªæ„é€ å‡½æ•°ç”¨ this å…³é”®å­—å³å¯ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>(<span class="keyword">val</span> name: String) &#123;</span><br><span class="line">    <span class="keyword">var</span> children: MutableList&lt;Person&gt; = mutableListOf&lt;&gt;()</span><br><span class="line">    <span class="keyword">constructor</span>(name: String, parent: Person) : <span class="keyword">this</span>(name) &#123;</span><br><span class="line">        parent.children.add(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å€¼çš„æ³¨æ„ä¸‹çš„æ˜¯ï¼Œåˆå§‹åŒ–è¯­å¥(init)å®é™…ä¸Šä¼šæˆä¸ºä¸»æ„é€ æ–¹æ³•çš„ä¸€éƒ¨åˆ†ã€‚å§”æ‰˜ç»™ä¸»æ„é€ å‡½æ•°ä¼šä½œä¸ºæ¬¡æ„é€ å‡½æ•°çš„ç¬¬ä¸€æ¡è¯­å¥ï¼Œå› æ­¤æ‰€æœ‰åˆå§‹åŒ–å—ä¸å±æ€§åˆå§‹åŒ–å™¨ä¸­çš„ä»£ç éƒ½ä¼šåœ¨æ¬¡æ„é€ å‡½æ•°ä½“ä¹‹å‰æ‰§è¡Œã€‚å³ä½¿è¯¥ç±»æ²¡æœ‰ä¸»æ„é€ å‡½æ•°ï¼Œè¿™ç§å§”æ‰˜ä»ä¼šéšå¼å‘ç”Ÿï¼Œå¹¶ä¸”ä»ä¼šæ‰§è¡Œåˆå§‹åŒ–å—ã€‚<br>ç®€å•ç‚¹æ¥è¯´å°±æ˜¯ï¼Œä¸ç®¡ä½ æœ‰æ²¡æœ‰ä¸»æ„é€ æ–¹æ³•ï¼Œåªè¦ä½ æœ‰æ¬¡æ„é€ æ–¹æ³•ï¼Œå¹¶ä¸”æœ‰initè¯­å¥ï¼Œä»–éƒ½ä¼šåœ¨æ‰§è¡Œæ¬¡æ„é€ æ–¹æ³•çš„å‡½æ•°ä½“å†…çš„ä»£ç ä¹‹å‰ï¼Œå…ˆå»æ‰§è¡Œinitè¯­å¥ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> person = Person(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">val</span> name: String</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>(_name: String) &#123;</span><br><span class="line">        name = _name</span><br><span class="line">        println(name)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span> &#123;</span><br><span class="line">        println(<span class="string">&quot;init: 1&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">è¾“å‡ºç»“æœä¸º</span></span><br><span class="line"><span class="comment">init: 1</span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure></p><h2 id="1-3-ç±»çš„å®ä¾‹"><a href="#1-3-ç±»çš„å®ä¾‹" class="headerlink" title="1.3 ç±»çš„å®ä¾‹"></a>1.3 ç±»çš„å®ä¾‹</h2><p>å›å¿†ä¸€ä¸‹<a href="https://blog.csdn.net/a1203991686/article/details/106421100">ä¸Šä¸€ç¯‡</a>è®²åŸºæœ¬ç±»å‹ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> one = <span class="number">1</span> <span class="comment">// Int</span></span><br><span class="line"><span class="keyword">val</span> threeBillion = <span class="number">3000000000</span> <span class="comment">// Long</span></span><br></pre></td></tr></table></figure></p><ul><li>é¦–å…ˆæˆ‘ä»¬è¯´è¿‡Kotlinå’ŒJavaä¸ä¸€æ ·ï¼Œæ‰€æœ‰çš„ä¸œè¥¿éƒ½æ˜¯å¯¹è±¡ï¼ŒåŒ…æ‹¬åŸºæœ¬ç±»å‹ã€‚æ‰€ä»¥è¯´æˆ‘ä»¬åˆ›å»ºçš„Kotlinçš„<code>Int</code>å‹å‚æ•°ï¼Œå®é™…ä¸Šå°±æ˜¯<code>new</code>äº†ä¸€ä¸ª<code>Int</code>è¿™ä¸ªç±»çš„å¯¹è±¡</li><li>å…¶æ¬¡Kotlinåˆ›å»ºå¯¹è±¡æ˜¯é€šè¿‡<code>val</code>å’Œ<code>var</code>å…³é”®å­—çš„</li><li>æœ€åå°±æ˜¯ä¸€ç‚¹å¤§å®¶åº”è¯¥éƒ½å‘ç°äº†ï¼ŒKotlinæ˜¯æ²¡æœ‰<code>new</code>è¿™ä¸ªå…³é”®å­—çš„</li></ul><p>æ‰€ä»¥ä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥æ¨å‡ºå¦‚æœåœ¨Kotlinä¸­åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼š</p><ul><li>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®å¯¹è±¡éœ€è¦çš„åœºæ™¯ï¼Œé€‰æ‹©åˆ°åº•æ˜¯valçš„å¯¹è±¡è¿˜æ˜¯varçš„å¯¹è±¡ï¼›</li><li>ç„¶åå†™å¯¹è±¡åï¼›</li><li>ç´§è·Ÿç€å¯¹è±¡åçš„å°±æ˜¯å¯¹è±¡çš„ç±»å‹ï¼Œä½†æ˜¯ç”±äºKotlinæœ‰ç±»å‹æ¨æ–­ï¼Œæ‰€ä»¥æ­¤å¤„è¿™ä¸ªæ˜¾å¼å£°æ˜ç±»å‹å¯ä»¥çœç•¥ï¼Œå› ä¸ºä»–å¯ä»¥é€šè¿‡ç­‰å·å³è¾¹ç»™å®šçš„å†…å®¹è‡ªåŠ¨æ¨æ–­å‡ºè¯¥å¯¹è±¡çš„ç±»å‹ï¼ˆæ­¤å¤„æš‚æ—¶å…ˆä¸è€ƒè™‘lateinitæˆ–è€…å…¶ä»–çš„æ“ä½œï¼‰</li><li>ä¹‹åå°±å¯ä»¥å†™ç­‰å·<code>=</code></li><li>ç­‰å·å³è¾¹å°±æ˜¯æˆ‘ä»¬éœ€è¦èµ‹å€¼ç»™è¿™ä¸ªå¯¹è±¡çš„åˆå§‹åŒ–è¯­å¥äº†ï¼Œä½†æ˜¯Kotlinæ²¡æœ‰<code>new</code>å…³é”®å­—ï¼Œæ‰€ä»¥æ˜¯ç›´æ¥å†™ï¼Œä¸éœ€è¦åŠ <code>new</code></li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> person1: Person = Person(<span class="string">&quot;1&quot;</span>) <span class="comment">// Kotlinæ²¡æœ‰ new å…³é”®å­—</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> person2 = Person(<span class="string">&quot;1&quot;</span>) <span class="comment">// ç”±äºç­‰å·å³è¾¹å·²ç»ç»™å‡ºäº†å…·ä½“çš„å†…å®¹ï¼Œæ‰€ä»¥å¯ä»¥çœç•¥æ‰æ˜¾å¼çš„æŒ‡å®šç±»å‹</span></span><br></pre></td></tr></table></figure><p>å½“ç„¶ä¹Ÿæœ‰ç‰¹æ®Šæƒ…å†µï¼š</p><ul><li>ä½¿ç”¨<code>lateinit</code>å…³é”®å­—</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">lateinit</span> <span class="keyword">var</span> person3: Person</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ç§æƒ…å†µä¸‹å¿…é¡»æ˜¾å¼çš„æŒ‡å®šå˜é‡ç±»å‹ï¼Œå› ä¸ºä½¿ç”¨äº†<code>lateinit</code>å…³é”®å­—ï¼Œå¯ä»¥å»¶è¿Ÿåˆå§‹åŒ–ï¼Œä½†æ˜¯ä»ç°åœ¨å¼€å§‹ï¼Œç›´åˆ°åˆå§‹åŒ–ï¼ŒæœŸé—´å¦‚æœä½¿ç”¨äº†è¿™ä¸ªå˜é‡ï¼Œ<strong>è¿è¡Œå</strong>å°±ä¼šæŠ¥é”™<code>lateinit property person3 has not been initialized</code></p><ul><li>åœ¨æ–¹æ³•æˆ–è€…ç±»ä¸­å®šä¹‰å˜é‡</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> person4: Person</span><br><span class="line">    println(person4) <span class="comment">// æ­¤æ—¶IDEå°±ä¼šæŠ¥çº¢ï¼ŒVariable &#x27;person4&#x27; must be initialized</span></span><br><span class="line">    person4 = Person(<span class="string">&quot;4&quot;</span>)</span><br><span class="line">    println(person4)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ–¹æ³•ä¸­æˆ–è€…ç±»ä¸­è¿˜å¯ä»¥è¿™æ ·ï¼Œå…ˆä¸åˆå§‹åŒ–ï¼Œå…ˆå®šä¹‰å˜é‡ï¼Œä½†æ˜¯æ­¤æ—¶å¿…é¡»æ˜¾å¼æŒ‡å‡ºå…¶ç±»å‹ï¼Œå¹¶ä¸”åœ¨åˆå§‹åŒ–ä¹‹å‰éƒ½ä¸å¯ä½¿ç”¨å˜é‡ï¼Œå¦‚æœä½¿ç”¨äº†ï¼Œ<strong>åœ¨ç¼–è¯‘å‰ä¹Ÿå°±æ˜¯è¿˜åœ¨ç¼–è¾‘æ—¶</strong>ï¼ŒIDEå°±ä¼šæŠ¥çº¢ï¼Œ<code>Variable &#39;person4&#39; must be initialized</code>ã€‚ä½†æ˜¯ä¸€æ—¦åˆå§‹åŒ–ä¹‹åå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚</p><h2 id="1-4-ç»§æ‰¿"><a href="#1-4-ç»§æ‰¿" class="headerlink" title="1.4 ç»§æ‰¿"></a>1.4 ç»§æ‰¿</h2><h3 id="1-4-1-Objectå’ŒAnyã€extendså’Œ"><a href="#1-4-1-Objectå’ŒAnyã€extendså’Œ" class="headerlink" title="1.4.1 Objectå’ŒAnyã€extendså’Œ:"></a>1.4.1 <code>Object</code>å’Œ<code>Any</code>ã€<code>extends</code>å’Œ<code>:</code></h3><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒJavaä¸­å­˜åœ¨ç€ä¸€ä¸ªåŸºç±»<code>Object</code>ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½ä¼šç»§æ‰¿è‡ªè¿™ä¸ªç±»ï¼Œå“ªæ€•ä½ è‡ªå·±åˆ›å»ºçš„å¯¹è±¡æ²¡æœ‰æŒ‡æ˜å…·ä½“ç»§æ‰¿è‡ªå“ªä¸ªç±»ï¼Œä½†æ˜¯Javaä¼šè®©ä»–ç»§æ‰¿è‡ªObjectç±»ã€‚è€Œè¿™ä¸ªç±»é‡Œé¢ä¹Ÿæœ‰ä¸€äº›æ¯ä¸ªç±»å¿…æœ‰çš„æ–¹æ³•å¦‚<code>getClass()</code>ã€<code>hashCode()</code>ã€<code>equals()</code>ã€<code>toString()</code>ç­‰ä¸€ç³»åˆ—æ–¹æ³•ã€‚</p><p>åŒæ ·çš„ï¼ŒKotlinä¹Ÿæœ‰è¿™æ ·çš„åŸºç±»ï¼Œåªä¸è¿‡å«åš<code>Any</code>ã€‚ä½†æ˜¯ä¸åŒçš„æ˜¯Kotlinçš„Anyåªæœ‰ä¸‰ä¸ªæ–¹æ³•ï¼š<code>hashCode()</code>ã€<code>equals()</code>å’Œ<code>toString()</code>ã€‚</p><p>è€Œåœ¨Javaä¸­ï¼Œæƒ³è¦ç»§æ‰¿æŸä¸€ä¸ªç±»çš„è¯ï¼Œå°±éœ€è¦åœ¨è¿™ä¸ªç±»çš„åé¢ç”¨<code>extends</code>å…³é”®å­— + è¶…ç±»åçš„æ–¹æ³•å»æŒ‡æ˜è¿™ä¸ªç±»ç»§æ‰¿è‡ªé‚£ä¸ªç±»ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Staff</span> <span class="keyword">extends</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è€Œåœ¨Kotlinä¸­ï¼Œå°±æ²¡æœ‰<code>extends</code>è¿™ä¸ªå…³é”®å­—äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯æˆ‘ä»¬çš„è€æœ‹å‹<code>:</code>ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">Person</span>(<span class="keyword">val</span> name: String)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Staff</span>(name: String) : Person(name) </span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªå°±ä»£è¡¨äº†<code>Staff</code>ç±»ç»§æ‰¿è‡ª<code>Person</code>ç±»ã€‚åŒæ—¶åŸºç±»(<code>Person</code>)å¿…é¡»å¾—è¢«<code>open</code>ä¿®é¥°ç¬¦ä¿®é¥°ï¼Œå› ä¸ºKotliné»˜è®¤æ‰€æœ‰çš„ç±»éƒ½æ˜¯<code>final</code>çš„ï¼Œæ‰€ä»¥ä¸èƒ½è¢«ç»§æ‰¿ï¼Œæ‰€ä»¥å°±éœ€è¦<code>open</code>ä¿®é¥°ç¬¦ä¿®é¥°å®ƒã€‚</p><p>å¹¶ä¸”å¦‚æœæ´¾ç”Ÿç±»æœ‰ä¸€ä¸ªä¸»æ„é€ å‡½æ•°ï¼Œå…¶åŸºç±»å¯ä»¥ï¼ˆå¹¶ä¸”å¿…é¡»ï¼‰ ç”¨æ´¾ç”Ÿç±»ä¸»æ„é€ å‡½æ•°çš„å‚æ•°å°±åœ°åˆå§‹åŒ–ã€‚</p><p>å¦‚æœæ´¾ç”Ÿç±»æ²¡æœ‰ä¸»æ„é€ å‡½æ•°ï¼Œé‚£ä¹ˆæ¯ä¸ªæ¬¡æ„é€ å‡½æ•°å¿…é¡»ä½¿ç”¨<code>super</code>å…³é”®å­—åˆå§‹åŒ–å…¶åŸºç±»å‹ï¼Œæˆ–å§”æ‰˜ç»™å¦ä¸€ä¸ªæ„é€ å‡½æ•°åšåˆ°è¿™ä¸€ç‚¹ã€‚ æ³¨æ„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸åŒçš„æ¬¡æ„é€ å‡½æ•°å¯ä»¥è°ƒç”¨åŸºç±»å‹çš„ä¸åŒçš„æ„é€ å‡½æ•°ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»£ç éå¸¸ä¸è§„èŒƒï¼Œä»…ä½œä¸ºä¾‹å­å‚è€ƒ</span></span><br><span class="line"><span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">val</span> name: String</span><br><span class="line">    <span class="keyword">var</span> address: String = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">constructor</span>(_name: String) &#123;</span><br><span class="line">        name = _name</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">constructor</span>(_name: String, _address: String) &#123;</span><br><span class="line">        name = _name</span><br><span class="line">        address = _address</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Staff</span> : <span class="type">Person</span> &#123;</span><br><span class="line">    <span class="keyword">constructor</span>(name: String) : <span class="keyword">super</span>(name)</span><br><span class="line">    <span class="keyword">constructor</span>(name: String, address: String) : <span class="keyword">super</span>(name, address)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-4-2-override"><a href="#1-4-2-override" class="headerlink" title="1.4.2 override"></a>1.4.2 <code>override</code></h3><h4 id="è¦†ç›–æ–¹æ³•"><a href="#è¦†ç›–æ–¹æ³•" class="headerlink" title="è¦†ç›–æ–¹æ³•"></a>è¦†ç›–æ–¹æ³•</h4><p>å’ŒJavaä¸€æ ·ï¼ŒKotlinä¹Ÿæ˜¯é€šè¿‡<code>override</code>å…³é”®å­—æ¥æ ‡æ˜è¦†ç›–ï¼Œåªä¸è¿‡ä¸åŒçš„æ˜¯Javaæ˜¯<code>@overrideæ³¨è§£</code>è€ŒKotlinæ˜¯<code>override</code>ä¿®é¥°ç¬¦ã€‚<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">Person</span>(<span class="keyword">val</span> name: String) &#123;</span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">getName</span><span class="params">()</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;è¿™æ˜¯<span class="variable">$this</span>, name: <span class="variable">$name</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Staff</span>(name: String) : Person(name) &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getName</span><span class="params">()</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;è¿™æ˜¯<span class="variable">$this</span>, name: <span class="variable">$name</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>Staff</code>ç»§æ‰¿è‡ª<code>Person</code>å¹¶é‡å†™äº†<code>getName()</code>æ–¹æ³•ã€‚<br>æ­¤æ—¶å¿…é¡»åœ¨<code>Staff</code>é‡å†™çš„<code>getName()</code>æ–¹æ³•å‰åŠ ä¸Š<code>override</code>ä¿®é¥°ç¬¦ï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚</p><p>åŒæ—¶ï¼Œä¸ç»§æ‰¿ç±»æ—¶ä¸€æ ·ï¼ŒKotliné»˜è®¤æ–¹æ³•ä¹Ÿæ˜¯<code>final</code>çš„ï¼Œå¦‚æœæƒ³è®©è¿™ä¸ªæ–¹æ³•è¢«é‡å†™ï¼Œå°±éœ€è¦åŠ ä¸Š<code>open</code>å…³é”®å­—ã€‚ä½†æ˜¯é‡å†™åçš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æœ‰<code>override</code>ä¿®é¥°çš„æ–¹æ³•ï¼Œé»˜è®¤æ˜¯å¼€æ”¾çš„ï¼Œä½†æ˜¯å¦‚æœä½ æƒ³è®©ä»–ä¸å†è¢«é‡å†™ï¼Œå°±éœ€è¦æ‰‹åŠ¨æ·»åŠ <code>final</code>ä¿®é¥°ç¬¦ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Staff</span>(name: String) : Person(name) &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getName</span><span class="params">()</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;è¿™æ˜¯<span class="variable">$this</span>, name: <span class="variable">$name</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="è¦†ç›–å±æ€§"><a href="#è¦†ç›–å±æ€§" class="headerlink" title="è¦†ç›–å±æ€§"></a>è¦†ç›–å±æ€§</h4><p>è¿™ä¸ªå°±æ˜¯Kotlinæœ‰ä½†æ˜¯Javaæ²¡æœ‰çš„äº†ã€‚å’Œè¦†ç›–æ–¹æ³•ä¸€æ ·ï¼Œä¹Ÿå°±æ˜¯åœ¨éœ€è¦è¦†ç›–çš„å±æ€§å‰é¢åŠ ä¸Š<code>override</code>ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">val</span> name = <span class="string">&quot;123&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Staff</span> : <span class="type">Person</span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">val</span> name = <span class="string">&quot;2&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åŒæ—¶ä½ å¯ä»¥ä½¿ç”¨<code>var</code>å±æ€§å»è¦†ç›–ä¸€ä¸ª<code>val</code>çš„å±æ€§ï¼Œä½†æ˜¯åè¿‡æ¥å°±ä¸è¡Œäº†ã€‚å› ä¸º<code>var</code>é»˜è®¤ä¼šæœ‰<code>get()</code>å’Œ<code>set()</code>æ–¹æ³•ï¼Œè€Œ<code>val</code>åªæœ‰<code>get()</code>æ–¹æ³•ï¼Œå¦‚æœç”¨<code>val</code>å»è¦†ç›–<code>var</code>ï¼Œé‚£ä¹ˆ<code>var</code>çš„<code>get()</code>æ–¹æ³•ä¼šæ— æ³•å¤„ç†ã€‚</p><h3 id="1-4-3-åˆå§‹åŒ–é¡ºåº"><a href="#1-4-3-åˆå§‹åŒ–é¡ºåº" class="headerlink" title="1.4.3 åˆå§‹åŒ–é¡ºåº"></a>1.4.3 åˆå§‹åŒ–é¡ºåº</h3><p>åœ¨æ„é€ æ´¾ç”Ÿç±»çš„æ–°å®ä¾‹çš„è¿‡ç¨‹ä¸­ï¼Œç¬¬ä¸€æ­¥å®Œæˆå…¶åŸºç±»çš„åˆå§‹åŒ–ï¼ˆåœ¨ä¹‹å‰åªæœ‰å¯¹åŸºç±»æ„é€ å‡½æ•°å‚æ•°çš„æ±‚å€¼ï¼‰ï¼Œå› æ­¤å‘ç”Ÿåœ¨æ´¾ç”Ÿç±»çš„åˆå§‹åŒ–é€»è¾‘è¿è¡Œä¹‹å‰ã€‚<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">Base</span>(<span class="keyword">val</span> name: String) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span> &#123; println(<span class="string">&quot;Initializing Base&quot;</span>) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">val</span> size: <span class="built_in">Int</span> = </span><br><span class="line">        name.length.also &#123; println(<span class="string">&quot;Initializing size in Base: <span class="variable">$it</span>&quot;</span>) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived</span>(</span><br><span class="line">    name: String,</span><br><span class="line">    <span class="keyword">val</span> lastName: String</span><br><span class="line">) : Base(name.capitalize().also &#123; println(<span class="string">&quot;Argument for Base: <span class="variable">$it</span>&quot;</span>) &#125;) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span> &#123; println(<span class="string">&quot;Initializing Derived&quot;</span>) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">val</span> size: <span class="built_in">Int</span> =</span><br><span class="line">        (<span class="keyword">super</span>.size + lastName.length).also &#123; println(<span class="string">&quot;Initializing size in Derived: <span class="variable">$it</span>&quot;</span>) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    println(<span class="string">&quot;Constructing Derived(\&quot;hello\&quot;, \&quot;world\&quot;)&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> d = Derived(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¿è¡Œç»“æœæ˜¯ï¼š<br><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Constructing Derived(&quot;hello&quot;, &quot;world&quot;)</span><br><span class="line">Argument for Base: Hello</span><br><span class="line">Initializing Base</span><br><span class="line">Initializing size in Base: 5</span><br><span class="line">Initializing Derived</span><br><span class="line">Initializing size in Derived: 10</span><br></pre></td></tr></table></figure></p><h3 id="1-4-5-è°ƒç”¨è¶…ç±»å®ç°"><a href="#1-4-5-è°ƒç”¨è¶…ç±»å®ç°" class="headerlink" title="1.4.5 è°ƒç”¨è¶…ç±»å®ç°"></a>1.4.5 è°ƒç”¨è¶…ç±»å®ç°</h3><p>å­ç±»å¯ä»¥é€šè¿‡<code>super</code>å…³é”®å­—è®¿é—®è¶…ç±»ä¸­çš„å†…å®¹ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">draw</span><span class="params">()</span></span> &#123; println(<span class="string">&quot;Drawing a rectangle&quot;</span>) &#125;</span><br><span class="line">    <span class="keyword">val</span> borderColor: String <span class="keyword">get</span>() = <span class="string">&quot;black&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FilledRectangle</span> : <span class="type">Rectangle</span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">draw</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.draw()</span><br><span class="line">        println(<span class="string">&quot;Filling the rectangle&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> fillColor: String <span class="keyword">get</span>() = <span class="keyword">super</span>.borderColor</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯å¦‚æœåœ¨ä¸€ä¸ªå†…éƒ¨ç±»ä¸­è®¿é—®å¤–éƒ¨ç±»çš„è¶…ç±»çš„å†…å®¹ï¼Œå¯ä»¥é€šè¿‡å¤–éƒ¨ç±»åé™å®šçš„superå…³é”®å­—<code>super@Outer</code>æ¥å®ç°ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FilledRectangle</span>: <span class="type">Rectangle</span>() &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">draw</span><span class="params">()</span></span> &#123; <span class="comment">/* â€¦â€¦ */</span> &#125;</span><br><span class="line">    <span class="keyword">val</span> borderColor: String <span class="keyword">get</span>() = <span class="string">&quot;black&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">inner</span> <span class="keyword">class</span> <span class="title class_">Filler</span> &#123;</span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">fill</span><span class="params">()</span></span> &#123; <span class="comment">/* â€¦â€¦ */</span> &#125;</span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">drawAndFill</span><span class="params">()</span></span> &#123;</span><br><span class="line">            <span class="symbol">super@</span>FilledRectangle.draw() <span class="comment">// è°ƒç”¨ Rectangle çš„ draw() å®ç°</span></span><br><span class="line">            fill()</span><br><span class="line">            println(<span class="string">&quot;Drawn a filled rectangle with color <span class="subst">$&#123;super@FilledRectangle.borderColor&#125;</span>&quot;</span>) <span class="comment">// ä½¿ç”¨ Rectangle æ‰€å®ç°çš„ borderColor çš„ get()</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="1-4-6-è¦†ç›–è§„åˆ™"><a href="#1-4-6-è¦†ç›–è§„åˆ™" class="headerlink" title="1.4.6 è¦†ç›–è§„åˆ™"></a>1.4.6 è¦†ç›–è§„åˆ™</h3><p>åœ¨ Kotlin ä¸­ï¼Œå®ç°ç»§æ‰¿ç”±ä¸‹è¿°è§„åˆ™è§„å®šï¼šå¦‚æœä¸€ä¸ªç±»ä»å®ƒçš„ç›´æ¥è¶…ç±»ç»§æ‰¿ç›¸åŒæˆå‘˜çš„å¤šä¸ªå®ç°ï¼Œ å®ƒå¿…é¡»è¦†ç›–è¿™ä¸ªæˆå‘˜å¹¶æä¾›å…¶è‡ªå·±çš„å®ç°ï¼ˆä¹Ÿè®¸ç”¨ç»§æ‰¿æ¥çš„å…¶ä¸­ä¹‹ä¸€ï¼‰ã€‚ ä¸ºäº†è¡¨ç¤ºé‡‡ç”¨ä»å“ªä¸ªè¶…ç±»å‹ç»§æ‰¿çš„å®ç°ï¼Œæˆ‘ä»¬ä½¿ç”¨ç”±å°–æ‹¬å·ä¸­è¶…ç±»å‹åé™å®šçš„<code>super</code>ï¼Œå¦‚<code>super&lt;Base&gt;</code>ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">draw</span><span class="params">()</span></span> &#123; <span class="comment">/* â€¦â€¦ */</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Polygon</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">draw</span><span class="params">()</span></span> &#123; <span class="comment">/* â€¦â€¦ */</span> &#125; <span class="comment">// æ¥å£æˆå‘˜é»˜è®¤å°±æ˜¯â€œopenâ€çš„</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Square</span>() : Rectangle(), Polygon &#123;</span><br><span class="line">    <span class="comment">// ç¼–è¯‘å™¨è¦æ±‚è¦†ç›– draw()ï¼š</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">draw</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>&lt;Rectangle&gt;.draw() <span class="comment">// è°ƒç”¨ Rectangle.draw()</span></span><br><span class="line">        <span class="keyword">super</span>&lt;Polygon&gt;.draw() <span class="comment">// è°ƒç”¨ Polygon.draw()</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="1-5-æŠ½è±¡ç±»"><a href="#1-5-æŠ½è±¡ç±»" class="headerlink" title="1.5 æŠ½è±¡ç±»"></a>1.5 æŠ½è±¡ç±»</h2><p>Kotlinä¸­çš„æŠ½è±¡ç±»ç”¨abstractå…³é”®å­—ã€‚æŠ½è±¡æˆå‘˜å¯ä»¥åœ¨æœ¬ç±»ä¸­ä¸ç”¨å®ç°ã€‚</p><p>åŒæ—¶ä¸ç”¨è¯´çš„å°±æ˜¯ï¼Œåœ¨æŠ½è±¡ç±»ä¸­ä¸éœ€è¦ä½¿ç”¨openæ ‡æ³¨ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">Polygon</span> &#123;</span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">draw</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Rectangle</span> : <span class="type">Polygon</span>() &#123;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">draw</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="2-å±æ€§å’Œå­—æ®µ"><a href="#2-å±æ€§å’Œå­—æ®µ" class="headerlink" title="2. å±æ€§å’Œå­—æ®µ"></a>2. å±æ€§å’Œå­—æ®µ</h1><p>å±æ€§çš„å®šä¹‰æˆ‘ä»¬å·²ç»åœ¨<a href="https://blog.csdn.net/a1203991686/article/details/106379486">å‰é¢</a>è¯´åˆ°è¿‡äº†ï¼Œä¸»è¦æ˜¯<code>val</code>å’Œ<code>var</code>ä¸¤ä¸ªå…³é”®å­—ï¼Œè€Œç°åœ¨é¦–å…ˆè¦è¯´çš„ï¼Œå°±æ˜¯<code>Getter</code>å’Œ<code>Setter</code>ã€‚</p><h2 id="2-1-Getterå’ŒSetter"><a href="#2-1-Getterå’ŒSetter" class="headerlink" title="2.1 Getterå’ŒSetter"></a>2.1 <code>Getter</code>å’Œ<code>Setter</code></h2><p>å£°æ˜ä¸€ä¸ªå±æ€§å®Œæ•´çš„è¯­æ³•æ˜¯ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> &lt;propertyName&gt;[: &lt;PropertyType&gt;] [= &lt;property_initializer&gt;]</span><br><span class="line">    [&lt;getter&gt;]</span><br><span class="line">    [&lt;setter&gt;]</span><br></pre></td></tr></table></figure><br>å…¶ä¸­ï¼Œ<code>property_initializer</code>ã€<code>getter</code>ã€<code>setter</code>éƒ½æ˜¯å¯é€‰çš„ï¼Œå¹¶ä¸”å¦‚æœç±»å‹å¯ä»¥ä»<code>property_initializer</code>æ¨æ–­å‡ºæ¥ï¼Œåˆ™ä¹Ÿæ˜¯å¯é€‰çš„ã€‚</p><p>è€Œå¯¹äºä¸ç®¡æ˜¯<code>val</code>è¿˜æ˜¯<code>var</code>ï¼Œå¦‚æœä½ è®¿é—®è¿™ä¸ªå±æ€§çš„æ—¶å€™å°±ç›´æ¥è¿”å›è¿™ä¸ªå±æ€§çš„å€¼çš„è¯ï¼Œ<code>getter</code>æ˜¯å¯ä»¥çœç•¥çš„ï¼Œè€Œå¦‚æœä½ æƒ³è¿”å›çš„æ—¶å€™ååšäº›æ“ä½œçš„è¯ï¼Œå°±å¯ä»¥è‡ªå®šä¹‰<code>getter</code>ï¼ˆæ¯”æ–¹è¯´æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ª<code>Person</code>ç±»ï¼Œé‡Œé¢æœ‰<code>name</code>ã€<code>age</code>ä»¥åŠ<code>isAdult</code>ä¸‰ä¸ªå±æ€§ï¼Œå…¶ä¸­<code>isAdult</code>æˆ‘ä»¬éœ€è¦å»è®¾ç½®ä»–çš„<code>get</code>æ–¹æ³•ï¼Œå½“<code>age</code>å¤§äºç­‰äº18çš„æ—¶å€™å°±è¿”å›<code>true</code>ï¼Œå¦åˆ™è¿”å›<code>false</code>ï¼‰ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>(_name: String, _age: <span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">val</span> name: String = _name</span><br><span class="line">    <span class="keyword">val</span> age: <span class="built_in">Int</span> = _age</span><br><span class="line">    <span class="keyword">val</span> isAdult: <span class="built_in">Boolean</span></span><br><span class="line">        <span class="keyword">get</span>() = age &gt;= <span class="number">18</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è€ŒåŒæ—¶æˆ‘ä»¬éœ€è¦åœ¨è®¾ç½®è¿™ä¸ªäººçš„ageçš„æ—¶å€™ï¼Œåšä¸€ä¸ªåˆ¤æ–­ï¼Œå¦‚æœè¾“å…¥çš„å€¼å°äº0çš„è¯ï¼Œå°±æŠ›å¼‚å¸¸ï¼Œå¦åˆ™æ‰æ›´æ”¹ageçš„å€¼ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦è‡ªå®šä¹‰setæ–¹æ³•äº†ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>(_name: String, _age: <span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">val</span> name: String = _name</span><br><span class="line">    <span class="keyword">var</span> age: <span class="built_in">Int</span> = _age</span><br><span class="line">        <span class="keyword">set</span>(value) &#123;</span><br><span class="line">            <span class="keyword">if</span> (value &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> Exception(<span class="string">&quot;å¹´é¾„å¿…é¡»å¤§äº0&quot;</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                field = value</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">val</span> isAdult: <span class="built_in">Boolean</span></span><br><span class="line">        <span class="keyword">get</span>() = age &gt;= <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">val</span> person = Person(<span class="string">&quot;314&quot;</span>, <span class="number">18</span>)</span><br><span class="line">        person.age = <span class="number">0</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">        println(e.message)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¿è¡Œç»“æœå°±æ˜¯<code>å¹´é¾„å¿…é¡»å¤§äº0</code>ã€‚ä½†æ˜¯è¿™å—æœ‰ä¸ªå°è¦ç‚¹ï¼Œå°±æ˜¯å±æ€§çš„setæ–¹æ³•åœ¨å¯¹è±¡åˆå§‹åŒ–çš„æ—¶å€™æ˜¯ä¸èµ·ä½œç”¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ç»™ä¸Šé¢è¿™ä¸ªPersonç±»åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ï¼Œç»™ageä¼ å…¥0æˆ–è€…è´Ÿæ•°çš„è¯ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">val</span> person = Person(<span class="string">&quot;314&quot;</span>, <span class="number">0</span>)</span><br><span class="line">        println(person.age)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">        println(e.message)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¿è¡Œç»“æœæ²¡æœ‰ä»»ä½•å¼‚å¸¸ï¼Œè¾“å‡º<code>0</code>ã€‚</p><p>ä¸çŸ¥é“å¤§å®¶æ³¨æ„åˆ°äº†æ²¡æœ‰ï¼Œæˆ‘ä»¬ç»™<code>setter</code>ä¼ å…¥çš„æ˜¯<code>value</code>ï¼Œè€Œç”¨<code>field</code>æ‰¿æ¥äº†ä¼ å…¥çš„<code>value</code>ã€‚</p><p>å…¶å®è¿™ä¸ª<code>value</code>æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ï¼Œä¹Ÿå°±æ˜¯è¯´<code>set()</code>è¿™ä¸ªæ‹¬å·é‡Œé¢çš„åå­—ä½ å¯ä»¥éšä¾¿å†™ï¼Œåªè¦ç¬¦åˆKotlinå‘½åè§„èŒƒã€‚<br>ä½†æ˜¯è¿™ä¸ª<code>field</code>æ˜¯ä¸å¯å˜çš„ï¼Œè¿™ä¸ª<code>field</code>ç›¸å½“äºæ˜¯<code>this.å±æ€§</code>ï¼Œä¹Ÿå°±ç›¸å½“äºæ˜¯setçš„è¿™ä¸ªå€¼æœ¬èº«ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ æƒ³åœ¨<code>setter</code>ä¸­æ”¹å˜è¿™ä¸ªå±æ€§çš„å€¼çš„è¯ï¼Œå°±å¿…é¡»å¾—æŠŠæœ€ç»ˆçš„å€¼ä¼ ç»™<code>field</code>ï¼Œ<code>field</code>å°±ç›¸å½“äºæ˜¯è¿™ä¸ªå±æ€§ï¼Œè€Œ<code>setter</code>ä¸­<code>this.å±æ€§</code>æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œä½ å†™äº†çš„è¯ï¼ŒIDEAåè€Œä¼šæç¤ºä½ è®©ä½ æ”¹æˆ<code>field</code>ã€‚<br><img src="https://cdn.littlecorgi.top/mweb/2020-06-09/1.png" alt="1"></p><h2 id="2-2-ç¼–è¯‘å™¨å¸¸é‡"><a href="#2-2-ç¼–è¯‘å™¨å¸¸é‡" class="headerlink" title="2.2 ç¼–è¯‘å™¨å¸¸é‡"></a>2.2 ç¼–è¯‘å™¨å¸¸é‡</h2><p>å¦‚æœåªè¯»å±æ€§çš„å€¼åœ¨ç¼–è¯‘å™¨æ˜¯å·²çŸ¥çš„ï¼Œå°±å¯ä»¥ä½¿ç”¨<code>const</code>å»ä¿®é¥°å°†å…¶æ ‡è®°ä¸ºç¼–è¯‘å™¨å¸¸é‡ï¼Œè¿™ç§å±æ€§éœ€è¦æ»¡è¶³ä¸‹åˆ—è¦æ±‚ï¼š</p><ul><li>ä½äºé¡¶å±‚æˆ–è€…æ˜¯<code>object</code>å£°æ˜ æˆ–<code>companion object</code>çš„ä¸€ä¸ªæˆå‘˜</li><li>ä»¥<code>String</code>æˆ–åŸç”Ÿç±»å‹å€¼åˆå§‹åŒ–</li><li>æ²¡æœ‰è‡ªå®šä¹‰<code>getter</code></li></ul><h2 id="2-3-å»¶è¿Ÿåˆå§‹åŒ–å±æ€§ä¸å˜é‡"><a href="#2-3-å»¶è¿Ÿåˆå§‹åŒ–å±æ€§ä¸å˜é‡" class="headerlink" title="2.3 å»¶è¿Ÿåˆå§‹åŒ–å±æ€§ä¸å˜é‡"></a>2.3 å»¶è¿Ÿåˆå§‹åŒ–å±æ€§ä¸å˜é‡</h2><p>ä¸€èˆ¬ï¼Œå±æ€§å£°æ˜ä¸ºéç©ºç±»å‹å°±å¿…é¡»å¾—åœ¨æ„é€ å‡½æ•°ä¸­å»åˆå§‹åŒ–ã€‚ä½†æ˜¯è¿™æ ·ä¹Ÿä¼šä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œä¾‹å¦‚åƒAndroidä¸­çš„viewçš„å¯¹è±¡(TextViewã€Buttonç­‰viewçš„å¯¹è±¡ï¼Œéœ€è¦è¢«<code>findViewById</code>)ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ²¡æ³•å»æä¾›ä¸€ä¸ªæ„é€ å™¨å»è®©å…¶åˆå§‹åŒ–ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨<code>lateinit</code>ä¿®é¥°ç¬¦ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">AppCompatActivity</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> mTextView: TextView</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_main)</span><br><span class="line">        mTextView = findViewById(R.id.textView_base_model)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨è¢«<code>lateinit</code>ä¿®é¥°çš„å˜é‡è¢«åˆå§‹åŒ–å‰ï¼Œå¦‚æœè®¿é—®è¿™ä¸ªå˜é‡çš„è¯ï¼Œå°±ä¼šæŠ›ä¸€ä¸ªå¼‚å¸¸ã€‚</p><h1 id="3-æ¥å£"><a href="#3-æ¥å£" class="headerlink" title="3. æ¥å£"></a>3. æ¥å£</h1><p>åœ¨Kotlinä¸­ä½¿ç”¨interfaceæ¥å®šä¹‰æ¥å£ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Food</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">cook</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">// å¯é€‰çš„æ–¹æ³•ä½“</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">eat</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="3-1-å®ç°æ¥å£"><a href="#3-1-å®ç°æ¥å£" class="headerlink" title="3.1 å®ç°æ¥å£"></a>3.1 å®ç°æ¥å£</h2><p>å’ŒJavaä¸€æ ·ï¼Œä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> : <span class="type">Food</span>, <span class="type">Action</span> &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">eat</span><span class="params">()</span></span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">walk</span><span class="params">()</span></span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">play</span><span class="params">()</span></span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="3-2-æ¥å£ä¸­çš„å±æ€§"><a href="#3-2-æ¥å£ä¸­çš„å±æ€§" class="headerlink" title="3.2 æ¥å£ä¸­çš„å±æ€§"></a>3.2 æ¥å£ä¸­çš„å±æ€§</h2><p>å’ŒJavaä¸€æ ·ï¼ŒKotlinçš„æ¥å£ä¸­ä¹Ÿå¯ä»¥å­˜åœ¨å±æ€§ã€‚</p><p>åªä¸è¿‡å¦‚æœæƒ³è¦åœ¨Kotlinä¸­å®šä¹‰å±æ€§ï¼Œå¿…é¡»ä¿è¯è¿™ä¸ªå±æ€§è¦ä¹ˆæ˜¯æŠ½è±¡çš„ï¼Œè¦ä¹ˆæŒ‡å®šäº†è®¿é—®å™¨ã€‚<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Food</span> &#123;</span><br><span class="line">    <span class="keyword">val</span> isCookFinished: <span class="built_in">Boolean</span> <span class="comment">// æŠ½è±¡çš„å±æ€§</span></span><br><span class="line">    <span class="keyword">val</span> isEatFinished: <span class="built_in">Boolean</span> <span class="comment">// æŒ‡å®šäº†è®¿é—®å™¨çš„å±æ€§</span></span><br><span class="line">        <span class="keyword">get</span>() = isCookFinished</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">cook</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">// å¯é€‰çš„æ–¹æ³•ä½“</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">eat</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="3-3-æ¥å£çš„ç»§æ‰¿"><a href="#3-3-æ¥å£çš„ç»§æ‰¿" class="headerlink" title="3.3 æ¥å£çš„ç»§æ‰¿"></a>3.3 æ¥å£çš„ç»§æ‰¿</h2><p>å’Œç±»ä¸€æ ·ï¼Œæ¥å£ä¹Ÿå¯ä»¥ç»§æ‰¿è‡ªå¦å¤–ä¸€ä¸ªæ¥å£ï¼Œå¯ä»¥åœ¨çˆ¶æ¥å£çš„åŸºç¡€ä¸Šå»æ·»åŠ æ–°çš„æ–¹æ³•æˆ–è€…å±æ€§ã€‚</p><h1 id="4-å¯è§æ€§ä¿®é¥°ç¬¦"><a href="#4-å¯è§æ€§ä¿®é¥°ç¬¦" class="headerlink" title="4. å¯è§æ€§ä¿®é¥°ç¬¦"></a>4. å¯è§æ€§ä¿®é¥°ç¬¦</h1><p>åœ¨Kotlinä¸­ï¼Œä¸»è¦æœ‰4ç§ä¿®é¥°ç¬¦ï¼š</p><ul><li>private</li><li>protected</li><li>internal</li><li>public</li></ul><p>å¦‚æœæ²¡æœ‰æŒ‡å®šä¿®é¥°ç¬¦ï¼Œé»˜è®¤æ˜¯<code>public</code>ã€‚</p><h2 id="4-1-ä¿®é¥°ç¬¦åœ¨åŒ…å†…"><a href="#4-1-ä¿®é¥°ç¬¦åœ¨åŒ…å†…" class="headerlink" title="4.1 ä¿®é¥°ç¬¦åœ¨åŒ…å†…"></a>4.1 ä¿®é¥°ç¬¦åœ¨åŒ…å†…</h2><p>æˆ‘ä»¬ä¹‹å‰æåˆ°è¿‡ï¼ŒKotlinå¯ä»¥ç›´æ¥ç›´æ¥åœ¨é¡¶å±‚å£°æ˜ç±»ã€å‡½æ•°å’Œå±æ€§ã€‚<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–‡ä»¶åï¼šexample.kt</span></span><br><span class="line"><span class="keyword">package</span> foo</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">foo</span><span class="params">()</span></span> &#123; â€¦â€¦ &#125; <span class="comment">// åœ¨ example.kt å†…å¯è§</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> bar: <span class="built_in">Int</span> = <span class="number">5</span> <span class="comment">// è¯¥å±æ€§éšå¤„å¯è§</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">set</span>         <span class="comment">// setter åªåœ¨ example.kt å†…å¯è§</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">val</span> baz = <span class="number">6</span>    <span class="comment">// ç›¸åŒæ¨¡å—å†…å¯è§</span></span><br></pre></td></tr></table></figure></p><ul><li>å¦‚æœä¸æŒ‡å®šä»»ä½•ä¿®é¥°ç¬¦ï¼Œé»˜è®¤ä¸ºpublicï¼Œæ„å‘³ç€éšå¤„å¯è§ï¼›</li><li>å¦‚æœå£°æ˜ä¸ºprivateï¼Œå®ƒåªèƒ½åœ¨å£°æ˜ä»–çš„æ–‡ä»¶å†…å¯è§ï¼›</li><li>å¦‚æœå£°æ˜ä¸ºinternalï¼Œå®ƒåªèƒ½åœ¨ç›¸åŒçš„æ¨¡å—(æ¨¡å—æˆ‘ä»¬ä¼šåœ¨æœ¬æ–‡çš„4.4è®²åˆ°)ä¸­å¯è§ï¼›</li><li>é¡¶å±‚ä¸­ä¸å¯ä½¿ç”¨protected(ç†ç”±ä¹Ÿå¾ˆå¥½æƒ³åˆ°â€”â€”éƒ½æ²¡æœ‰ç±»ï¼Œæ€ä¹ˆå­˜åœ¨å­ç±»çš„æ¦‚å¿µ)</li></ul><h2 id="4-2-ä¿®é¥°ç¬¦åœ¨ç±»å’Œæ¥å£å†…"><a href="#4-2-ä¿®é¥°ç¬¦åœ¨ç±»å’Œæ¥å£å†…" class="headerlink" title="4.2 ä¿®é¥°ç¬¦åœ¨ç±»å’Œæ¥å£å†…"></a>4.2 ä¿®é¥°ç¬¦åœ¨ç±»å’Œæ¥å£å†…</h2><p>å¯¹äºåœ¨ç±»æˆ–è€…æ¥å£å†…çš„æ–¹æ³•æˆ–è€…å±æ€§ï¼Œæˆ‘ä»¬å››ç§ä¿®é¥°ç¬¦éƒ½å¯ç”¨ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">Outer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> a = <span class="number">1</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">open</span> <span class="keyword">val</span> b = <span class="number">2</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">val</span> c = <span class="number">3</span></span><br><span class="line">    <span class="keyword">val</span> d = <span class="number">4</span>  <span class="comment">// é»˜è®¤ public</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">class</span> <span class="title class_">Nested</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">val</span> e: <span class="built_in">Int</span> = <span class="number">5</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Subclass</span> : <span class="type">Outer</span>() &#123;</span><br><span class="line">    <span class="comment">// a ä¸å¯è§</span></span><br><span class="line">    <span class="comment">// bã€cã€d å¯è§</span></span><br><span class="line">    <span class="comment">// Nested å’Œ e å¯è§</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">val</span> b = <span class="number">5</span>   <span class="comment">// â€œbâ€ä¸º protected</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Unrelated</span>(o: Outer) &#123;</span><br><span class="line">    <span class="comment">// o.aã€o.b ä¸å¯è§</span></span><br><span class="line">    <span class="comment">// o.c å’Œ o.d å¯è§ï¼ˆç›¸åŒæ¨¡å—ï¼‰</span></span><br><span class="line">    <span class="comment">// Outer.Nested ä¸å¯è§ï¼ŒNested::e ä¹Ÿä¸å¯è§</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li><code>private</code>ï¼šåªåœ¨è¿™ä¸ªç±»çš„å†…éƒ¨å¯è§ï¼›</li><li><code>protected</code>ï¼šåªåœ¨è¿™ä¸ªç±»çš„å†…éƒ¨ä»¥åŠä»–çš„å­ç±»å¯è§ï¼›</li><li><code>internal</code>ï¼šåªåœ¨è¿™ä¸ªæ¨¡å—å†…å¯è§ï¼›</li><li><code>public</code>ï¼šéšå¤„å¯è§ã€‚</li></ul><h2 id="4-3-å±€éƒ¨"><a href="#4-3-å±€éƒ¨" class="headerlink" title="4.3 å±€éƒ¨"></a>4.3 å±€éƒ¨</h2><p>å±€éƒ¨å˜é‡ã€å‡½æ•°å’Œç±»ä¸å¯ä»¥æœ‰å¯è§æ€§ä¿®é¥°ç¬¦ã€‚</p><h2 id="4-4-Kotlinä¸­çš„æ¨¡å—"><a href="#4-4-Kotlinä¸­çš„æ¨¡å—" class="headerlink" title="4.4 Kotlinä¸­çš„æ¨¡å—"></a>4.4 Kotlinä¸­çš„æ¨¡å—</h2><p>å¯è§æ€§ä¿®é¥°ç¬¦<code>internal</code>æ„å‘³ç€è¯¥æˆå‘˜åªåœ¨ç›¸åŒæ¨¡å—å†…å¯è§ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œ ä¸€ä¸ªæ¨¡å—æ˜¯ç¼–è¯‘åœ¨ä¸€èµ·çš„ä¸€å¥— Kotlin æ–‡ä»¶ï¼š</p><ul><li>ä¸€ä¸ª IntelliJ IDEA æ¨¡å—ï¼›</li><li>ä¸€ä¸ª Maven é¡¹ç›®ï¼›</li><li>ä¸€ä¸ª Gradle æºé›†ï¼ˆä¾‹å¤–æ˜¯<code>test</code>æºé›†å¯ä»¥è®¿é—®<code>main</code>çš„<code>internal</code>å£°æ˜ï¼‰ï¼›</li><li>ä¸€æ¬¡<code>&lt;kotlinc&gt;</code>Ant ä»»åŠ¡æ‰§è¡Œæ‰€ç¼–è¯‘çš„ä¸€å¥—æ–‡ä»¶ã€‚</li></ul>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Kotlin/">Kotlin</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Kotlin/">Kotlin</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/">è¯­è¨€åŸºç¡€</category>
      
      
      <comments>https://www.littlecorgi.top/posts/756a6103.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Kotlinå…¥é—¨(äºŒ)â€”â€”åŸºæœ¬ç±»å‹ã€åŒ…</title>
      <link>https://www.littlecorgi.top/posts/eef353d0.html</link>
      <guid>https://www.littlecorgi.top/posts/eef353d0.html</guid>
      <pubDate>Wed, 10 Jun 2020 07:41:08 GMT</pubDate>
      
      <description>&lt;blockquote&gt;
&lt;p&gt;æœ¬ç« å†…å®¹åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;kotlinçš„åŸºæœ¬ç±»å‹&lt;/li&gt;
&lt;li&gt;åŒ…&lt;/li&gt;
&lt;li&gt;ç±»ä¸å¯¹è±¡&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;0-å‰è¨€&quot;&gt;&lt;a href=&quot;#0-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0. å‰è¨€&quot;&gt;&lt;/a&gt;0. å‰è¨€&lt;/h1&gt;&lt;p&gt;åœ¨&lt;a href=&quot;https://blog.csdn.net/a1203991686/article/details/106379486&quot;&gt;ä¸Šç¯‡æ–‡ç« &lt;/a&gt;æˆ‘ä»¬æ¶‰åŠåˆ°äº†kotlinçš„ä¸€äº›æœ€åŸºæœ¬çš„è¯­æ³•å†…å®¹ï¼Œå¹¶å®Œæˆäº†kotlinçš„HelloWorldã€‚ä½†æ˜¯ä¸Šç¯‡æˆ‘ä»¬åœ¨è°ˆåˆ°ç±»çš„æ—¶å€™ï¼Œè¯´äº†åªä»‹ç»ä¸‹æœ€åŸºæœ¬çš„ç±»ï¼Œäºæ˜¯åœ¨è¿™ç¯‡ï¼Œæˆ‘ä»¬å°±ç€é‡çœ‹ä¸‹ç±»å’Œå¯¹è±¡ã€‚(æ›´æ–°ï¼šç”±äºç±»å’Œå¯¹è±¡çš„å†…å®¹è¿‡å¤šï¼Œæˆ‘ä¼šæ”¾åœ¨ä¸‹ä¸€ç¯‡æ¥è¯´è¿™ä¸ª)&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯åœ¨è¯´åˆ°ç±»ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹åŸºæœ¬ç±»å‹ã€‚&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>æœ¬ç« å†…å®¹åŒ…æ‹¬ï¼š</p><ul><li>kotlinçš„åŸºæœ¬ç±»å‹</li><li>åŒ…</li><li>ç±»ä¸å¯¹è±¡</li></ul></blockquote><h1 id="0-å‰è¨€"><a href="#0-å‰è¨€" class="headerlink" title="0. å‰è¨€"></a>0. å‰è¨€</h1><p>åœ¨<a href="https://blog.csdn.net/a1203991686/article/details/106379486">ä¸Šç¯‡æ–‡ç« </a>æˆ‘ä»¬æ¶‰åŠåˆ°äº†kotlinçš„ä¸€äº›æœ€åŸºæœ¬çš„è¯­æ³•å†…å®¹ï¼Œå¹¶å®Œæˆäº†kotlinçš„HelloWorldã€‚ä½†æ˜¯ä¸Šç¯‡æˆ‘ä»¬åœ¨è°ˆåˆ°ç±»çš„æ—¶å€™ï¼Œè¯´äº†åªä»‹ç»ä¸‹æœ€åŸºæœ¬çš„ç±»ï¼Œäºæ˜¯åœ¨è¿™ç¯‡ï¼Œæˆ‘ä»¬å°±ç€é‡çœ‹ä¸‹ç±»å’Œå¯¹è±¡ã€‚(æ›´æ–°ï¼šç”±äºç±»å’Œå¯¹è±¡çš„å†…å®¹è¿‡å¤šï¼Œæˆ‘ä¼šæ”¾åœ¨ä¸‹ä¸€ç¯‡æ¥è¯´è¿™ä¸ª)</p><p>ä½†æ˜¯åœ¨è¯´åˆ°ç±»ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹åŸºæœ¬ç±»å‹ã€‚</p><span id="more"></span><h1 id="1-kotlinçš„åŸºæœ¬ç±»å‹"><a href="#1-kotlinçš„åŸºæœ¬ç±»å‹" class="headerlink" title="1. kotlinçš„åŸºæœ¬ç±»å‹"></a>1. kotlinçš„åŸºæœ¬ç±»å‹</h1><p>åœ¨è¯´åŸºæœ¬ç±»å‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæåŠä¸€ä¸ªKotlinçš„åŸºæœ¬å®šä¹‰ï¼Œä¹Ÿæ˜¯Kotlinå’ŒJavaæœ€æ˜æ˜¾çš„åŒºåˆ«ä¹‹ä¸€ï¼š</p><h4 id="åœ¨kotlinä¸­ï¼Œæ‰€æœ‰çš„ä¸œè¥¿éƒ½æ˜¯å¯¹è±¡"><a href="#åœ¨kotlinä¸­ï¼Œæ‰€æœ‰çš„ä¸œè¥¿éƒ½æ˜¯å¯¹è±¡" class="headerlink" title="åœ¨kotlinä¸­ï¼Œæ‰€æœ‰çš„ä¸œè¥¿éƒ½æ˜¯å¯¹è±¡"></a><em><strong>åœ¨kotlinä¸­ï¼Œæ‰€æœ‰çš„ä¸œè¥¿éƒ½æ˜¯å¯¹è±¡</strong></em></h4><p>é‚£ä¹ˆç†Ÿæ‚‰Javaçš„åŒå­¦å¯èƒ½è¦è¯´äº†ï¼šä¸å¯¹å•Šï¼Œä½ ä¸æ˜¯è¯´Kotlinçš„åŸºç¡€æ˜¯Javaå—ï¼Œé‚£ä¹ˆJavaçš„åŸºæœ¬ç±»å‹ä¸æ˜¯å¯¹è±¡å•Šï¼Œé‚£Kotlinçš„åŸºæœ¬ç±»å‹æ€ä¹ˆå¯èƒ½ä¸æ˜¯å¯¹è±¡äº†ã€‚</p><p>ä½†æ˜¯äº‹å®å°±æ˜¯ï¼Œ<strong>Kotlinçš„åŸºæœ¬ç±»å‹ï¼Œéƒ½æ˜¯å¯¹è±¡</strong>ã€‚</p><p>Kotlinçš„åŸºæœ¬ç±»å‹ä¹Ÿè¢«åˆ†ä¸ºäº†ï¼šæ•°å­—ã€å­—ç¬¦ã€å¸ƒå°”å€¼ã€æ•°ç»„ä¸å­—ç¬¦ä¸²ã€‚æˆ‘ä»¬å°±æ¥é€ä¸€è°ˆä¸‹ã€‚</p><h2 id="1-1-æ•°å­—"><a href="#1-1-æ•°å­—" class="headerlink" title="1.1 æ•°å­—"></a>1.1 æ•°å­—</h2><h3 id="1-1-1-æ•´å‹"><a href="#1-1-1-æ•´å‹" class="headerlink" title="1.1.1 æ•´å‹"></a>1.1.1 æ•´å‹</h3><p>å’ŒJavaä¸€æ ·ï¼ŒKotlinä¹Ÿæœ‰å››ç§ä¸åŒå¤§å°çš„æ•´å‹ç±»å‹ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">ç±»å‹</th><th style="text-align:left">å¤§å°ï¼ˆæ¯”ç‰¹ï¼‰</th><th style="text-align:left">æœ€å°å€¼</th><th style="text-align:left">æœ€å¤§å€¼</th></tr></thead><tbody><tr><td style="text-align:left">Byte</td><td style="text-align:left">8</td><td style="text-align:left">-128</td><td style="text-align:left">127</td></tr><tr><td style="text-align:left">Short</td><td style="text-align:left">16</td><td style="text-align:left">-32768</td><td style="text-align:left">32767</td></tr><tr><td style="text-align:left">Int</td><td style="text-align:left">32</td><td style="text-align:left">-2^31</td><td style="text-align:left">2^31 - 1</td></tr><tr><td style="text-align:left">Long</td><td style="text-align:left">64</td><td style="text-align:left">-2^63</td><td style="text-align:left">2^63 - 1</td></tr></tbody></table></div><p>æˆ‘ä»¬ä¸Šä¸€ç¯‡è¯´åˆ°äº†ç±»æ€§æ¨æ–­ï¼Œæ‰€ä»¥Kotliné»˜è®¤ç»™æ‰€æœ‰æœªè¶…è¿‡<code>Int</code>èŒƒå›´çš„æ•´å‹å€¼åˆå§‹åŒ–æ—¶ä¼šæ¨æ–­ä¸º<code>Int</code>ç±»å‹ã€‚å¦‚æœåˆå§‹å€¼è¶…è¿‡äº†<code>Int</code>ï¼Œå°±ä¼šé»˜è®¤ä¸º<code>Long</code>ã€‚å¦‚æœæƒ³ç›´æ¥å®šä¹‰Longçš„å€¼ï¼Œå°±éœ€è¦åœ¨å€¼åé¢åŠ <code>L</code>ï¼Œlike:<code>123L</code>ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> one = <span class="number">1</span> <span class="comment">// Int</span></span><br><span class="line"><span class="keyword">val</span> threeBillion = <span class="number">3000000000</span> <span class="comment">// Long</span></span><br><span class="line"><span class="keyword">val</span> oneLong = <span class="number">1L</span> <span class="comment">// Long</span></span><br><span class="line"><span class="keyword">val</span> oneByte: <span class="built_in">Byte</span> = <span class="number">1</span></span><br></pre></td></tr></table></figure><h3 id="1-1-2-æµ®ç‚¹å‹"><a href="#1-1-2-æµ®ç‚¹å‹" class="headerlink" title="1.1.2 æµ®ç‚¹å‹"></a>1.1.2 æµ®ç‚¹å‹</h3><p>å¯¹äºæµ®ç‚¹å‹ï¼ŒKotlinä¹Ÿæä¾›äº†ä¸¤ç§ç±»å‹ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">ç±»å‹</th><th style="text-align:left">å¤§å°ï¼ˆæ¯”ç‰¹ï¼‰</th><th style="text-align:left">æœ‰æ•ˆæ•°å­—æ¯”ç‰¹æ•°</th><th style="text-align:left">æŒ‡æ•°æ¯”ç‰¹æ•°</th><th style="text-align:left">åè¿›åˆ¶ä½æ•°</th></tr></thead><tbody><tr><td style="text-align:left">Float</td><td style="text-align:left">32</td><td style="text-align:left">24</td><td style="text-align:left">8</td><td style="text-align:left">6-7</td></tr><tr><td style="text-align:left">Double</td><td style="text-align:left">64</td><td style="text-align:left">53</td><td style="text-align:left">11</td><td style="text-align:left">5-16</td></tr></tbody></table></div><p>å¯¹äºå°æ•°åˆå§‹åŒ–çš„å˜é‡ï¼ŒKotlinä¼šé»˜è®¤æ¨æ–­ä¸º<code>Double</code>ç±»å‹ã€‚è€Œå¦‚æœéœ€è¦å°†ä¸€ä¸ªæ•°å€¼æ˜¾ç¤ºæŒ‡å®šä¸º<code>Float</code>å‹ï¼Œå°±éœ€è¦åœ¨æ•°å€¼åé¢åŠ <code>F</code>ï¼Œlikeï¼š<code>3.0F</code>ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> pi = <span class="number">3.14</span> <span class="comment">// Double</span></span><br><span class="line"><span class="keyword">val</span> e = <span class="number">2.7182818284</span> <span class="comment">// Double</span></span><br><span class="line"><span class="keyword">val</span> eFloat = <span class="number">2.7182818284f</span> <span class="comment">// Floatï¼Œå®é™…å€¼ä¸º 2.7182817</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒKotlinçš„æ•°å­—æ²¡æœ‰éšå¼è½¬æ¢ï¼ˆè‡ªåŠ¨ç±»å‹è½¬æ¢ï¼‰ã€‚</p><p>æ¯”å¦‚Javaä¼šåœ¨éœ€è¦çš„æ—¶å€™ï¼Œèƒ½è‡ªåŠ¨å°†ä½çº§ç±»å‹æ•°æ®è½¬æ¢æˆé«˜çº§ç±»å‹æ•°æ®ï¼š</p><ul><li>æ•°å€¼å‹æ•°æ®çš„è½¬æ¢ï¼šbyteâ†’shortâ†’intâ†’longâ†’floatâ†’doubleã€‚</li><li>å­—ç¬¦å‹è½¬æ¢ä¸ºæ•´å‹ï¼šcharâ†’intã€‚</li></ul><p>ä½†æ˜¯Kotlinä¸ä¼šï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">printDouble</span><span class="params">(d: <span class="type">Double</span>)</span></span> &#123; print(d) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> i = <span class="number">1</span>    </span><br><span class="line">    <span class="keyword">val</span> d = <span class="number">1.1</span></span><br><span class="line">    <span class="keyword">val</span> f = <span class="number">1.1f</span> </span><br><span class="line"></span><br><span class="line">    printDouble(d)</span><br><span class="line"><span class="comment">//    printDouble(i) // é”™è¯¯ï¼šç±»å‹ä¸åŒ¹é…</span></span><br><span class="line"><span class="comment">//    printDouble(f) // é”™è¯¯ï¼šç±»å‹ä¸åŒ¹é…</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¦‚æœéœ€è¦å°†æ•°å€¼è½¬æ¢æˆä¸åŒç±»å‹ï¼Œå°±éœ€è¦ä½¿ç”¨æ˜¾ç¤ºè½¬æ¢(<code>as</code>)ã€‚</p><h3 id="1-1-3-ä¸‹åˆ’çº¿"><a href="#1-1-3-ä¸‹åˆ’çº¿" class="headerlink" title="1.1.3 ä¸‹åˆ’çº¿"></a>1.1.3 ä¸‹åˆ’çº¿</h3><p>Kotlinæ”¯æŒåœ¨æ•°å­—ä¸­ä½¿ç”¨ä¸‹åˆ’çº¿<code>_</code>ï¼Œè¿™æ ·èƒ½ä½¿æ•°å­—å¸¸é‡æ›´æ˜“è¯»ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> oneMillion = <span class="number">1_000_000</span></span><br><span class="line"><span class="keyword">val</span> creditCardNumber = <span class="number">1234_5678_9012_3456L</span></span><br><span class="line"><span class="keyword">val</span> socialSecurityNumber = <span class="number">999_99_9999L</span></span><br><span class="line"><span class="keyword">val</span> hexBytes = <span class="number">0xFF_EC_DE_5E</span></span><br><span class="line"><span class="keyword">val</span> bytes = <span class="number">0b11010010_01101001_10010100_10010010</span></span><br></pre></td></tr></table></figure></p><h3 id="1-1-4-åŸºæœ¬ç±»å‹å’ŒåŒ…è£…ç±»"><a href="#1-1-4-åŸºæœ¬ç±»å‹å’ŒåŒ…è£…ç±»" class="headerlink" title="1.1.4 åŸºæœ¬ç±»å‹å’ŒåŒ…è£…ç±»"></a>1.1.4 åŸºæœ¬ç±»å‹å’ŒåŒ…è£…ç±»</h3><p>æˆ‘ä»¬åœ¨å¼€å¤´è¯´åˆ°è¿‡ï¼ŒKotlinçš„åŸºæœ¬ç±»å‹å…¨æ˜¯å¯¹è±¡ã€‚</p><p>ä½†æ˜¯ç†Ÿæ‚‰Javaçš„åŒå­¦éƒ½çŸ¥é“Javaä¸­æœ‰ä¸€ä¸ªåŸºæœ¬ç±»å‹å’ŒåŒ…è£…ç±»ã€‚åœ¨å®šä¹‰æ™®é€šçš„æ•°å€¼çš„æ—¶å€™ï¼Œå°±æ˜¯ä½¿ç”¨åŸºæœ¬ç±»å‹intç­‰åŸºæœ¬ç±»å‹ï¼›ä½†æ˜¯å¦‚æœéœ€è¦ä½¿ç”¨æ³›å‹â€”â€”æ¯”æ–¹è¯´é›†åˆçš„æ—¶å€™â€”â€”å°±éœ€è¦ä½¿ç”¨Integer(intçš„åŒ…è£…ç±»)ç­‰åŒ…è£…ç±»ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<a href="https://blog.csdn.net/a1203991686/article/details/106379486">ç¬¬ä¸€ç¯‡</a>ä¸­çœ‹Kotlinçš„å­—èŠ‚ç çš„æ–¹æ³•æ¥çœ‹ä¸‹ä¸‹é¢çš„Kotlinä»£ç æœ€ç»ˆè¢«è½¬æˆäº†ä»€ä¹ˆæ ·çš„ä»£ç ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> a: <span class="built_in">Int</span> = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    println(a)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> array = ArrayList&lt;<span class="built_in">Int</span>&gt;()</span><br><span class="line">    array.add(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ä»£ç å¾ˆç®€å•ï¼Œå°±æ˜¯å®šä¹‰äº†ä¸€ä¸ªåŸºæœ¬ç±»å‹Intå‹çš„å˜é‡3ï¼Œç„¶åè¾“å‡ºä»–ï¼Œç„¶åæœ‰å®šä¹‰äº†ä¸€ä¸ªæ³›å‹ä¸ºIntçš„ArrayListçš„é›†åˆã€‚</p><p>é‚£æˆ‘ä»¬ç°åœ¨æ¥çœ‹ä¸‹ä»–çš„å­—èŠ‚ç ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> kotlin.Metadata;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Metadata(</span></span><br><span class="line"><span class="meta">   mv = &#123;1, 1, 16&#125;,</span></span><br><span class="line"><span class="meta">   bv = &#123;1, 0, 3&#125;,</span></span><br><span class="line"><span class="meta">   k = 2,</span></span><br><span class="line"><span class="meta">   d1 = &#123;<span class="string">&quot;\u0000\b\n\u0000\n\u0002\u0010\u0002\n\u0000\u001a\u0006\u0010\u0000\u001a\u00020\u0001Â¨\u0006\u0002&quot;</span>&#125;,</span></span><br><span class="line"><span class="meta">   d2 = &#123;<span class="string">&quot;main&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;KotlinStudy&quot;</span>&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">MainKt</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> static <span class="keyword">final</span> void main() &#123;</span><br><span class="line">      int a = <span class="number">3</span>;</span><br><span class="line">      boolean var1 = <span class="literal">false</span>;</span><br><span class="line">      System.<span class="keyword">out</span>.println(a);</span><br><span class="line">      ArrayList array = new ArrayList();</span><br><span class="line">      array.add(<span class="number">1</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// $FF: synthetic method</span></span><br><span class="line">   <span class="keyword">public</span> static void main(String[] var0) &#123;</span><br><span class="line">      main();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¸»è¦æ˜¯çœ‹<code>public static final void main()</code>è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒKotlinåœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œè‡ªåŠ¨å¸®æˆ‘ä»¬å°†<code>Int</code>å‹çš„<code>a</code>è½¬æ¢æˆäº†<code>int a</code>ã€‚</p><p>ä½†æ˜¯ç”±äºæ³›å‹æ¶ˆé™¤ç‰¹æ€§ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™æˆ‘ä»¬çœ‹ä¸æ‡‚ArrayListçš„æ³›å‹ï¼Œä½†æ˜¯æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒJavaä¹‹æ‰€ä»¥è¦å¼„å‡ºä¸€å¥—åŒ…è£…ç±»ï¼Œå°±æ˜¯å› ä¸ºä»–ä»¬æ˜¯ç±»ï¼Œå¯ä»¥æ”¾åœ¨æ³›å‹ä¸­ï¼Œè¿™ä¸å°±æ˜¯æˆ‘ä»¬Kotlinçš„Intç¬¦åˆçš„æ¡ä»¶å—ã€‚</p><p>æ‰€ä»¥å¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®ºï¼ŒKotlinå¯¹äºåŸºæœ¬ç±»å‹åœ¨ç¼–è¯‘æ—¶ï¼Œä¼šæ ¹æ®æƒ…å¢ƒè‡ªåŠ¨è½¬æ¢ï¼š</p><ul><li>å¯¹äºå˜é‡ã€å±æ€§ã€å‚æ•°å’Œè¿”å›ç±»å‹ï¼ŒKotlinçš„Intç±»å‹ä¼šè¢«ç¼–è¯‘æˆJavaçš„åŸºæœ¬ç±»å‹int</li><li>å¯¹äºæ³›å‹ç±»ï¼ŒKotlinçš„åŸºæœ¬ç±»å‹åˆä¼šè¢«ç¼–è¯‘æˆJavaå¯¹åº”çš„åŒ…è£…ç±»</li></ul><h3 id="1-1-5-æ˜¾ç¤ºè½¬æ¢"><a href="#1-1-5-æ˜¾ç¤ºè½¬æ¢" class="headerlink" title="1.1.5 æ˜¾ç¤ºè½¬æ¢"></a>1.1.5 æ˜¾ç¤ºè½¬æ¢</h3><p>æ¯ä¸ªæ•°å­—ç±»å‹æ”¯æŒå¦‚ä¸‹çš„è½¬æ¢:</p><ul><li><code>toByte(): Byte</code></li><li><code>toShort(): Short</code></li><li><code>toInt(): Int</code></li><li><code>toLong(): Long</code></li><li><code>toFloat(): Float</code></li><li><code>toDouble(): Double</code></li><li><code>toChar(): Char</code></li></ul><h3 id="1-1-6-è¿ç®—"><a href="#1-1-6-è¿ç®—" class="headerlink" title="1.1.6 è¿ç®—"></a>1.1.6 è¿ç®—</h3><h4 id="å››åˆ™è¿ç®—"><a href="#å››åˆ™è¿ç®—" class="headerlink" title="å››åˆ™è¿ç®—"></a>å››åˆ™è¿ç®—</h4><p>è™½è¯´åœ¨Kotlinä¸­å±äºå¯¹è±¡ï¼Œä½†æ˜¯å››åˆ™è¿ç®—ä»ç„¶æ”¯æŒï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨<code>+</code>ã€<code>-</code>ã€<code>*</code>ã€<code>/</code>ã€<code>%</code>ã€‚(æ•´æ•°é—´çš„é™¤æ³•æ°¸è¿œè¿”å›çš„æ˜¯æ•´æ•°ï¼Œå°æ•°éƒ¨åˆ†åˆ™ä¼šè¢«èˆå¼ƒã€‚é™¤éå°†å…¶ä¸­ä¸€ä¸ªæ•´æ•°ä»¥æµ®ç‚¹æ•°çš„æ ¼å¼æ˜¾å¼çš„å±•ç¤ºå‡ºæ¥)</p><p>ç‰¹åˆ«å¯ä»¥æ³¨æ„ä¸‹çš„æ˜¯ï¼ŒKotlinæ”¯æŒè¿ç®—ç¬¦é‡è½½ã€‚</p><h4 id="ä½è¿ç®—"><a href="#ä½è¿ç®—" class="headerlink" title="ä½è¿ç®—"></a>ä½è¿ç®—</h4><p>å¯¹äºä½è¿ç®—ï¼Œæ²¡æœ‰ç‰¹æ®Šå­—ç¬¦æ¥è¡¨ç¤ºï¼Œè€Œåªå¯ç”¨ä¸­ç¼€æ–¹å¼è°ƒç”¨å…·åå‡½æ•°:<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> x = (<span class="number">1</span> shl <span class="number">2</span>) and <span class="number">0x000FF000</span></span><br></pre></td></tr></table></figure></p><p>è¿™æ˜¯å®Œæ•´çš„ä½è¿ç®—åˆ—è¡¨ï¼ˆåªç”¨äº<code>Int</code>ä¸<code>Long</code>ï¼‰ï¼š</p><ul><li><code>shl(bits)</code> â€“ æœ‰ç¬¦å·å·¦ç§»</li><li><code>shr(bits)</code> â€“ æœ‰ç¬¦å·å³ç§»</li><li><code>ushr(bits)</code> â€“ æ— ç¬¦å·å³ç§»</li><li><code>and(bits)</code> â€“ ä½ä¸</li><li><code>or(bits)</code> â€“ ä½æˆ–</li><li><code>xor(bits)</code> â€“ ä½å¼‚æˆ–</li><li><code>inv()</code> â€“ ä½é</li></ul><h4 id="æ¯”è¾ƒ"><a href="#æ¯”è¾ƒ" class="headerlink" title="æ¯”è¾ƒ"></a>æ¯”è¾ƒ</h4><ul><li>ç›¸ç­‰æ€§æ£€æµ‹ï¼š<code>a == b</code> ä¸ <code>a != b</code></li><li>æ¯”è¾ƒæ“ä½œç¬¦ï¼š<code>a &lt; b</code>ã€ <code>a &gt; b</code>ã€ <code>a &lt;= b</code>ã€ <code>a &gt;= b</code></li><li>åŒºé—´å®ä¾‹ä»¥åŠåŒºé—´æ£€æµ‹ï¼š<code>a..b</code>ã€ <code>x in a..b</code>ã€ <code>x !in a..b</code></li></ul><h2 id="1-2-å­—ç¬¦"><a href="#1-2-å­—ç¬¦" class="headerlink" title="1.2 å­—ç¬¦"></a>1.2 å­—ç¬¦</h2><p>å­—ç¬¦æ˜¯ä½¿ç”¨<code>Char</code>æ¥è¡¨ç¤ºï¼Œè·Ÿä¸Šé¢çš„<code>Int</code>ç­‰ä¸€æ ·ï¼Œä»–ä¹Ÿæ˜¯å¯¹è±¡ï¼Œä¹Ÿæ˜¯åœ¨ç¼–è¯‘æ—¶æ ¹æ®å…·ä½“æƒ…å†µç¼–è¯‘æˆ<code>char</code>è¿˜æ˜¯<code>Character</code>ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æ˜¾å¼çš„å°†å­—ç¬¦è½¬ä¸º<code>Int</code>æ•°å­—ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">decimalDigitValue</span><span class="params">(c: <span class="type">Char</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (c !<span class="keyword">in</span> <span class="string">&#x27;0&#x27;</span>..<span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">        <span class="keyword">throw</span> IllegalArgumentException(<span class="string">&quot;Out of range&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> c.toInt() - <span class="string">&#x27;0&#x27;</span>.toInt() <span class="comment">// æ˜¾å¼è½¬æ¢ä¸ºæ•°å­—</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="1-3-å¸ƒå°”"><a href="#1-3-å¸ƒå°”" class="headerlink" title="1.3 å¸ƒå°”"></a>1.3 å¸ƒå°”</h2><p>å¸ƒå°”ç”¨<code>Boolean</code>ç±»å‹è¡¨ç¤ºï¼Œå®ƒæœ‰ä¸¤ä¸ªå€¼ï¼š<code>true</code>ä¸<code>false</code>ã€‚</p><p>è‹¥éœ€è¦å¯ç©ºå¼•ç”¨å¸ƒå°”ä¼šè¢«è£…ç®±ã€‚</p><p>å†…ç½®çš„å¸ƒå°”è¿ç®—æœ‰ï¼š</p><ul><li><code>||</code> â€“ çŸ­è·¯é€»è¾‘æˆ–</li><li><code>&amp;&amp;</code> â€“ çŸ­è·¯é€»è¾‘ä¸</li><li><code>!</code> - é€»è¾‘é</li></ul><h2 id="1-4-æ•°ç»„"><a href="#1-4-æ•°ç»„" class="headerlink" title="1.4 æ•°ç»„"></a>1.4 æ•°ç»„</h2><h3 id="1-4-1-æ•°ç»„åŸºæœ¬"><a href="#1-4-1-æ•°ç»„åŸºæœ¬" class="headerlink" title="1.4.1 æ•°ç»„åŸºæœ¬"></a>1.4.1 æ•°ç»„åŸºæœ¬</h3><p>æˆ‘ä»¬å‰é¢è¯´è¿‡ï¼ŒKotlinä¸­åªæœ‰å¯¹è±¡ï¼Œæ‰€ä»¥Kotlinçš„æ•°ç»„ä¹Ÿä¸ä¼šåƒJavaé‚£æ ·ï¼Œç›´æ¥ä½¿ç”¨<code>int[]</code>è¿™ç§ç±»å‹çš„ï¼Œè€Œæ˜¯å¼•å…¥äº†ä¸€ä¸ªç±»<code>Array</code>ã€‚</p><p>è¿™ä¸ªç±»å®šä¹‰äº†<code>get</code>å’Œ<code>set</code>å‡½æ•°(Kotlinä¼šå°†è¿ç®—ç¬¦é‡è½½è½¬æ¢ä¸º<code>[]</code>)ï¼Œä»¥åŠ<code>size</code>å±æ€§ï¼Œä»¥åŠå…¶ä»–ä¸€äº›æˆå‘˜å‡½æ•°ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>arrayOf()</code>æ¥åˆ›å»ºä¸€ä¸ªæ•°ç»„ï¼Œå¹¶å°†æ•°ç»„éœ€è¦å­˜å‚¨çš„å€¼ä¼ ç»™ä»–ã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ³•åªèƒ½æ˜¾å¼çš„è®¾ç½®æ•°ç»„çš„å…ƒç´ ï¼Œå¹¶ä¸”æ²¡æ³•ç›´æ¥è®¾ç½®æ•°ç»„çš„å¤§å°ï¼Œåªèƒ½é€šè¿‡æ–¹æ³•ä¸­çš„å‚æ•°ä¹Ÿå°±æ˜¯å…·ä½“çš„æ•°ç»„çš„å…ƒç´ çš„ä¸ªæ•°ä»¥åŠç±»å‹æ¨æ–­å‡ºè¿™ä¸ªæ•°ç»„çš„å¤§å°ä»¥åŠç±»å‹ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> array1 = arrayOf(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>)</span><br><span class="line"><span class="keyword">val</span> array2 = arrayOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure></p><p>å¦å¤–ä¹Ÿå¯ä»¥é€šè¿‡<code>Array</code>æ„é€ å‡½æ•°æ¥æ„é€ æ•°ç»„ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™ä¸ªä»£ç æ¶‰åŠåˆ°lambdaï¼Œè¿™ä¸ªä»¥åä¼šå†æ¥è¯´</span></span><br><span class="line"><span class="comment">// ä¸€ä¸ªStringç±»å‹çš„æ•°ç»„ï¼Œå®¹é‡ä¸º5ï¼Œé‡Œé¢å­˜çš„å†…å®¹å…¨æ˜¯&quot;1&quot;</span></span><br><span class="line"><span class="keyword">val</span> array3 = Array(<span class="number">5</span>) &#123;</span><br><span class="line">    <span class="string">&quot;1&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¸€ä¸ªIntç±»å‹çš„æ•°ç»„ï¼Œå®¹é‡ä¸º5ï¼Œé‡Œé¢å­˜çš„å†…å®¹æ˜¯[1, 4, 9, 16, 25]</span></span><br><span class="line"><span class="keyword">val</span> array4 = Array(<span class="number">5</span>) &#123;</span><br><span class="line">    it * it</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="1-4-2-åŸç”Ÿç±»å‹æ•°ç»„"><a href="#1-4-2-åŸç”Ÿç±»å‹æ•°ç»„" class="headerlink" title="1.4.2 åŸç”Ÿç±»å‹æ•°ç»„"></a>1.4.2 åŸç”Ÿç±»å‹æ•°ç»„</h3><p>Kotlinä¹Ÿæœ‰ä¸“é—¨çš„ç±»æ¥è¡¨ç¤ºåŸç”Ÿç±»å‹æ•°ç»„ï¼š<code>IntArray</code>ã€<code>CharArray</code>ã€<code>FloatArray</code>ç­‰ç­‰ã€‚</p><p>ä½†æ˜¯è¿™äº›ç±»ä¸Arrayå¹¶æ²¡æœ‰ç»§æ‰¿å…³ç³»ï¼Œä½†æ˜¯å®ƒä»¬æœ‰åŒæ ·çš„æ–¹æ³•å±æ€§é›†ã€‚å®ƒä»¬ä¹Ÿéƒ½æœ‰ç›¸åº”çš„å·¥å‚æ–¹æ³•:<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> x: IntArray = intArrayOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">x[<span class="number">0</span>] = x[<span class="number">1</span>] + x[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤§å°ä¸º 5ã€å€¼ä¸º [0, 0, 0, 0, 0] çš„æ•´å‹æ•°ç»„</span></span><br><span class="line"><span class="keyword">val</span> arr = IntArray(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¾‹å¦‚ï¼šç”¨å¸¸é‡åˆå§‹åŒ–æ•°ç»„ä¸­çš„å€¼</span></span><br><span class="line"><span class="comment">// å¤§å°ä¸º 5ã€å€¼ä¸º [42, 42, 42, 42, 42] çš„æ•´å‹æ•°ç»„</span></span><br><span class="line"><span class="keyword">val</span> arr = IntArray(<span class="number">5</span>) &#123; <span class="number">42</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¾‹å¦‚ï¼šä½¿ç”¨ lambda è¡¨è¾¾å¼åˆå§‹åŒ–æ•°ç»„ä¸­çš„å€¼</span></span><br><span class="line"><span class="comment">// å¤§å°ä¸º 5ã€å€¼ä¸º [0, 1, 2, 3, 4] çš„æ•´å‹æ•°ç»„ï¼ˆå€¼åˆå§‹åŒ–ä¸ºå…¶ç´¢å¼•å€¼ï¼‰</span></span><br><span class="line"><span class="keyword">var</span> arr = IntArray(<span class="number">5</span>) &#123; it * <span class="number">1</span> &#125;</span><br></pre></td></tr></table></figure></p><h2 id="1-5-å­—ç¬¦ä¸²"><a href="#1-5-å­—ç¬¦ä¸²" class="headerlink" title="1.5 å­—ç¬¦ä¸²"></a>1.5 å­—ç¬¦ä¸²</h2><p>å­—ç¬¦ä¸²åº”è¯¥æ²¡æœ‰å•¥å¥½è¯´çš„äº†ï¼Œå­—ç¬¦ä¸²æ¨¡æ¿æˆ‘åœ¨<a href="https://blog.csdn.net/a1203991686/article/details/106379486">ä¸Šä¸€ç¯‡</a>ä¹Ÿå·²ç»è¯´åˆ°äº†ã€‚</p><p>Kotlinçš„å­—ç¬¦ä¸²ä¹Ÿæ˜¯<code>String</code>ï¼Œä¹Ÿæ”¯æŒè½¬ä¹‰å­—ç¬¦ï¼ŒJavaçš„<code>String</code>çš„é‚£äº›æ–¹æ³•Kotlinéƒ½æœ‰ã€‚</p><p>ä½†æ˜¯Kotlinæ–°å¢äº†ä¸€ä¸ªåŸå§‹å­—ç¬¦ä¸²ï¼š<br>åŸå§‹å­—ç¬¦ä¸²ä½¿ç”¨ä¸‰ä¸ªå¼•å·<code>&quot;&quot;&quot;</code>åˆ†ç•Œç¬¦æ‹¬èµ·æ¥ï¼Œå†…éƒ¨æ²¡æœ‰è½¬ä¹‰å¹¶ä¸”å¯ä»¥åŒ…å«æ¢è¡Œä»¥åŠä»»ä½•å…¶ä»–å­—ç¬¦ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> text = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    for (c in &quot;foo&quot;)</span></span><br><span class="line"><span class="string">        print(c)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure></p><h2 id="1-6-Kotlinä¸­çš„voidï¼šUnit"><a href="#1-6-Kotlinä¸­çš„voidï¼šUnit" class="headerlink" title="1.6 Kotlinä¸­çš„voidï¼šUnit"></a>1.6 Kotlinä¸­çš„voidï¼šUnit</h2><p>Kotlinä¸­çš„Unitç±»å‹å°±æ˜¯Javaä¸­çš„voidã€‚</p><p>ç”¨æ³•å’ŒJavaä¸­çš„voidæ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚</p><h2 id="1-7-Nothingï¼šè¿™ä¸ªå‡½æ•°æ°¸ä¸è¿”å›"><a href="#1-7-Nothingï¼šè¿™ä¸ªå‡½æ•°æ°¸ä¸è¿”å›" class="headerlink" title="1.7 Nothingï¼šè¿™ä¸ªå‡½æ•°æ°¸ä¸è¿”å›"></a>1.7 Nothingï¼šè¿™ä¸ªå‡½æ•°æ°¸ä¸è¿”å›</h2><blockquote><p>Nothing æ˜¯ä¸€ä¸ª ç©ºç±»å‹ï¼ˆuninhabited typeï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç¨‹åºè¿è¡Œæ—¶ä¸ä¼šå‡ºç°ä»»ä½•ä¸€ä¸ª Nothing ç±»å‹å¯¹è±¡ã€‚Nothing è¿˜æ˜¯å…¶ä»–æ‰€æœ‰ç±»å‹çš„å­ç±»å‹ã€‚<br>(æ‘˜è‡ªå…¶å®ƒåœ°æ–¹)</p></blockquote><p>å…³äºè¿™å—ï¼Œæˆ‘è§‰å¾—æˆ‘ä¹Ÿä¸æ˜¯å¾ˆæ‡‚ï¼Œæ‰€ä»¥è¿˜æ˜¯ä¸åœ¨è¿™ç­é—¨å¼„æ–§äº†ï¼Œå¤§å®¶å¯ä»¥çœ‹ä¸‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://medium.com/@kazafchen/kotlin%E4%BD%BF%E7%94%A8%E5%BF%83%E5%BE%97-%E4%BA%8C-any%E8%88%87nothing%E9%96%93%E7%9A%84%E5%A5%87%E5%A6%99%E9%97%9C%E4%BF%82-%E4%BB%A5%E5%8F%8A%E8%88%87java%E4%B8%ADvoid%E7%9A%84%E6%84%9B%E6%81%A8%E6%83%85%E4%BB%87-f60477cab752">ä¼ é€é—¨</a></p><h1 id="2-åŒ…ä¸å¯¼å…¥"><a href="#2-åŒ…ä¸å¯¼å…¥" class="headerlink" title="2. åŒ…ä¸å¯¼å…¥"></a>2. åŒ…ä¸å¯¼å…¥</h1><h2 id="2-1-åŒ…"><a href="#2-1-åŒ…" class="headerlink" title="2.1 åŒ…"></a>2.1 åŒ…</h2><p>å’ŒJavaä¸€æ ·ï¼ŒKotlinçš„åŒ…ä¹Ÿæ˜¯åœ¨æ–‡ä»¶æœ€å‰é¢ç”¨<code>package</code>å¼€å¤´ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> kotlinstudy</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="2-2-å¯¼å…¥"><a href="#2-2-å¯¼å…¥" class="headerlink" title="2.2 å¯¼å…¥"></a>2.2 å¯¼å…¥</h2><p>å’ŒJavaä¸€æ ·ï¼ŒKotlinå¯¼å…¥åŒ…ä¹Ÿæ˜¯ä½¿ç”¨<code>import</code>å…³é”®å­—ã€‚</p><p>å¹¶ä¸”ä¹Ÿæ˜¯å¯ä»¥å•ç‹¬å¯¼å…¥ä¸€ä¸ªç‹¬ç‰¹çš„åå­—ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.example.Message</span><br></pre></td></tr></table></figure><br>ä¹Ÿå¯ä»¥å¯¼å…¥è¿™ä¸ªä¸‹é¢çš„æ‰€æœ‰å†…å®¹ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.example.*</span><br></pre></td></tr></table></figure></p><p>å¦‚æœå‡ºç°çš„åå­—å‘ç”Ÿå†²çªï¼Œæ¯”æ–¹è¯´å¯¼å…¥çš„æœ€ç»ˆçš„åå­—éƒ½æ˜¯<code>Message</code>ï¼Œåªä¸è¿‡å±äºä¸åŒçš„åŒ…ä¸‹é¢çš„ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨<code>as</code>å…³é”®å­—æ¥åœ¨æœ¬åœ°è¿›è¡Œé‡å‘½åï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.example.Message <span class="comment">// Message å¯è®¿é—®</span></span><br><span class="line"><span class="keyword">import</span> org.test.Message <span class="keyword">as</span> testMessage <span class="comment">// testMessage ä»£è¡¨â€œorg.test.Messageâ€</span></span><br></pre></td></tr></table></figure></p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Kotlin/">Kotlin</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Kotlin/">Kotlin</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/">è¯­è¨€åŸºç¡€</category>
      
      
      <comments>https://www.littlecorgi.top/posts/eef353d0.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Kotlinå…¥é—¨(ä¸€)â€”â€”åŸºæœ¬è¦ç´ </title>
      <link>https://www.littlecorgi.top/posts/2ed82411.html</link>
      <guid>https://www.littlecorgi.top/posts/2ed82411.html</guid>
      <pubDate>Wed, 27 May 2020 07:52:53 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;Kotlinå…¥é—¨-ä¸€-â€”â€”åŸºæœ¬è¦ç´ &quot;&gt;&lt;a href=&quot;#Kotlinå…¥é—¨-ä¸€-â€”â€”åŸºæœ¬è¦ç´ &quot; class=&quot;headerlink&quot; title=&quot;Kotlinå…¥é—¨(ä¸€)â€”â€”åŸºæœ¬è¦ç´ &quot;&gt;&lt;/a&gt;Kotlinå…¥é—¨(ä¸€)â€”â€”åŸºæœ¬è¦ç´ &lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;æœ¬ç« å†…å®¹åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;kotlinçš„HelloWorld&lt;/li&gt;
&lt;li&gt;å˜é‡ã€æ§åˆ¶æµã€å‡½æ•°&lt;/li&gt;
&lt;li&gt;åŒ…å’Œç±»ï¼ˆæœ€åŸºç¡€çš„å†…å®¹ï¼Œå…·ä½“çš„åé¢ä¼šä»‹ç»ï¼‰&lt;/li&gt;
&lt;li&gt;æ™ºèƒ½è½¬æ¢&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;0-å‰è¨€&quot;&gt;&lt;a href=&quot;#0-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0. å‰è¨€&quot;&gt;&lt;/a&gt;0. å‰è¨€&lt;/h1&gt;&lt;p&gt;æˆ‘ä¹‹å‰å†™è¿‡ä¸€ç¯‡&lt;a href=&quot;https://www.littlecor/gi.top/%2Fposts%2F343b01ae.html&quot;&gt;ã€ŠKotlinå…¥é—¨ã€‹&lt;/a&gt;åšå®¢ï¼Œä½†æ˜¯ä¸€æ–¹é¢æ˜¯è¿™ç¯‡åšå®¢å†™çš„æ¯”è¾ƒæ—©ï¼Œå†™çš„æ—¶å€™å•çº¯æ˜¯ä¸ºäº†å­¦ä¹ ankoè€Œå†™çš„ï¼Œæ‰€ä»¥æ„Ÿè§‰å†™çš„å¹¶ä¸å¥½ï¼Œå¦ä¸€æ–¹é¢ï¼Œåœ¨å†™çš„æ—¶å€™åªæ˜¯å†™äº†ç‚¹åŸºç¡€çŸ¥è¯†ï¼Œå½“æ—¶ä¹Ÿæ²¡æœ‰ç³»ç»Ÿçš„å­¦ä¹ kotlinã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥åœ¨çœ‹å®Œkotlinå®æˆ˜åï¼Œå°±æƒ³å›è¿‡å¤´æ¥å†™ä¸€ç¯‡æ€»ç»“åšå®¢&lt;/p&gt;
&lt;p&gt;å†™è¿™ä¸ªä¸»è¦æ˜¯ä¸ºäº†å‡ ä¸ªç›®çš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹äºçœ‹æˆ‘åšå®¢çš„äººæ¥è¯´æœ‰ä¸€ä¸ªæ›´åŠ ç³»ç»Ÿæ›´åŠ å…¨é¢æ›´åŠ å®Œå–„çš„kotlinå…¥é—¨æŒ‡å—ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºæˆ‘è‡ªå·±ï¼Œå•çº¯çš„çœ‹ä¹¦è¿˜æ˜¯ä¸å¤Ÿå¥½ï¼Œå°±å†™ä¸€ç¯‡æ€»ç»“åšå®¢æ€»ç»“ä¸‹ä¹¦æœ¬ä¸­çš„çŸ¥è¯†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ³¨ï¼šç”±äºæˆ‘ä¹‹å‰åªä¼šJavaï¼Œå¹¶ä¸”ç›®å‰ä¸»è¦æ˜¯åœ¨åšAndroidå¼€å‘ï¼Œæ‰€ä»¥æˆ‘çš„åšå®¢æ›´å¤šçš„ä¼šå°†kotlinä¸Javaè¿›è¡Œæ¯”è¾ƒï¼Œå¹¶ä¸”å¯èƒ½ä¼šåå‘Androidå¼€å‘ä¸­çš„å®è·µã€‚&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="Kotlinå…¥é—¨-ä¸€-â€”â€”åŸºæœ¬è¦ç´ "><a href="#Kotlinå…¥é—¨-ä¸€-â€”â€”åŸºæœ¬è¦ç´ " class="headerlink" title="Kotlinå…¥é—¨(ä¸€)â€”â€”åŸºæœ¬è¦ç´ "></a>Kotlinå…¥é—¨(ä¸€)â€”â€”åŸºæœ¬è¦ç´ </h1><blockquote><p>æœ¬ç« å†…å®¹åŒ…æ‹¬ï¼š</p><ul><li>kotlinçš„HelloWorld</li><li>å˜é‡ã€æ§åˆ¶æµã€å‡½æ•°</li><li>åŒ…å’Œç±»ï¼ˆæœ€åŸºç¡€çš„å†…å®¹ï¼Œå…·ä½“çš„åé¢ä¼šä»‹ç»ï¼‰</li><li>æ™ºèƒ½è½¬æ¢</li></ul></blockquote><h1 id="0-å‰è¨€"><a href="#0-å‰è¨€" class="headerlink" title="0. å‰è¨€"></a>0. å‰è¨€</h1><p>æˆ‘ä¹‹å‰å†™è¿‡ä¸€ç¯‡<a href="https://www.littlecor/gi.top/%2Fposts%2F343b01ae.html">ã€ŠKotlinå…¥é—¨ã€‹</a>åšå®¢ï¼Œä½†æ˜¯ä¸€æ–¹é¢æ˜¯è¿™ç¯‡åšå®¢å†™çš„æ¯”è¾ƒæ—©ï¼Œå†™çš„æ—¶å€™å•çº¯æ˜¯ä¸ºäº†å­¦ä¹ ankoè€Œå†™çš„ï¼Œæ‰€ä»¥æ„Ÿè§‰å†™çš„å¹¶ä¸å¥½ï¼Œå¦ä¸€æ–¹é¢ï¼Œåœ¨å†™çš„æ—¶å€™åªæ˜¯å†™äº†ç‚¹åŸºç¡€çŸ¥è¯†ï¼Œå½“æ—¶ä¹Ÿæ²¡æœ‰ç³»ç»Ÿçš„å­¦ä¹ kotlinã€‚</p><p>æ‰€ä»¥åœ¨çœ‹å®Œkotlinå®æˆ˜åï¼Œå°±æƒ³å›è¿‡å¤´æ¥å†™ä¸€ç¯‡æ€»ç»“åšå®¢</p><p>å†™è¿™ä¸ªä¸»è¦æ˜¯ä¸ºäº†å‡ ä¸ªç›®çš„ï¼š</p><ul><li>å¯¹äºçœ‹æˆ‘åšå®¢çš„äººæ¥è¯´æœ‰ä¸€ä¸ªæ›´åŠ ç³»ç»Ÿæ›´åŠ å…¨é¢æ›´åŠ å®Œå–„çš„kotlinå…¥é—¨æŒ‡å—ã€‚</li><li>å¯¹äºæˆ‘è‡ªå·±ï¼Œå•çº¯çš„çœ‹ä¹¦è¿˜æ˜¯ä¸å¤Ÿå¥½ï¼Œå°±å†™ä¸€ç¯‡æ€»ç»“åšå®¢æ€»ç»“ä¸‹ä¹¦æœ¬ä¸­çš„çŸ¥è¯†ã€‚</li></ul><p>æ³¨ï¼šç”±äºæˆ‘ä¹‹å‰åªä¼šJavaï¼Œå¹¶ä¸”ç›®å‰ä¸»è¦æ˜¯åœ¨åšAndroidå¼€å‘ï¼Œæ‰€ä»¥æˆ‘çš„åšå®¢æ›´å¤šçš„ä¼šå°†kotlinä¸Javaè¿›è¡Œæ¯”è¾ƒï¼Œå¹¶ä¸”å¯èƒ½ä¼šåå‘Androidå¼€å‘ä¸­çš„å®è·µã€‚</p><span id="more"></span><h1 id="1-Hello-World"><a href="#1-Hello-World" class="headerlink" title="1. Hello World"></a>1. Hello World</h1><p>ä¸‡æ¶ä¹‹æºï¼Œæˆ‘ä»¬ä»ç¨‹åºå‘˜çš„ç¬¬ä¸€ä¸ªç¨‹åºâ€œHello Worldâ€å¼€å§‹ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹kotlinç‰ˆçš„Hello Worldæ˜¯æ€ä¹ˆå†™çš„ï¼Œå¦‚æœä½ ä¹‹å‰å­¦ä¹ è¿‡Javaï¼Œä½ ä¼šç«‹é©¬è¢«kotlinè¯­æ³•çš„ç®€æ´æ‰€éœ‡æƒŠï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> kotlinstudy</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    println(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¦‚æœä½ ä¹‹å‰æ˜¯Javaå·¥ç¨‹å¸ˆï¼Œæˆ–è€…ä½ ä¹‹å‰å­¦è¿‡Javaï¼Œæ˜¯ä¸æ˜¯ä¼šæ„Ÿè§‰åˆ°éå¸¸çš„æƒŠè®¶ï¼š</p><ul><li>ç†Ÿæ‚‰çš„<code>public static void main(String[] args)</code>ä¸è§äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯<code>fun main()</code></li><li>ç†Ÿæ‚‰çš„<code>System.out.println()</code>ä¸è§äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯<code>println()</code></li><li>ç†Ÿæ‚‰çš„mainæ–¹æ³•å¿…é¡»åœ¨ä¸€ä¸ªclassé‡Œé¢ä¸è§äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯æ–¹æ³•å¯ä»¥ç›´æ¥å†™åœ¨æœ€å¤–é¢ã€‚<del><em>è¿™ä¸ªå«é¡¶å±‚å±‚å‡½æ•°ï¼Œæˆ‘ä»¬åé¢ä¼šè®²åˆ°</em></del></li></ul><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œkotlinä¹Ÿæ˜¯è¿è¡Œåœ¨JVMä¹‹ä¸Šçš„ï¼Œä¹Ÿå°±æ˜¯ä»–ä¹Ÿå¿…é¡»éµå®ˆJVMçš„ä¸€äº›çº¦å®šï¼Œé‚£ä¹ˆä»–æ˜¯å¦‚ä½•èƒ½åšåˆ°è¿™æ ·çš„è¯­æ³•çš„å‘¢ï¼Ÿ</p><p>å¦‚æœä½ ä½¿ç”¨IDEAæˆ–è€…Android Studioçš„è¯ï¼Œä½ å¯ä»¥åœ¨ä¸Šé¢çš„Tools-Kotliné‡Œé¢çœ‹åˆ°ä¸€ä¸ª<code>Show Kotlin Bytecode</code>çš„é€‰é¡¹ï¼š<br><img src="https://cdn.littlecorgi.top/mweb/2020-05-27/15895156953362.jpg" alt="-w743"></p><p>æˆ‘ä»¬æ‰“å¼€å®ƒï¼Œå°±èƒ½çœ‹åˆ°æˆ‘ä»¬åˆšåˆšç¼–å†™çš„kotlinä»£ç çš„å­—èŠ‚ç æ–‡ä»¶äº†ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™è¿˜æ˜¯çœ‹ä¸æ‡‚ï¼Œä¸æ€¥ï¼Œæˆ‘ä»¬å¯ä»¥ç‚¹ä¸€ä¸‹è¿™ä¸ª<code>Decompile</code>æŒ‰é’®ï¼Œç„¶åå°±èƒ½è½¬æˆæ›´æ˜“æ‡‚çš„è¯­å¥äº†ã€‚<br><img src="https://cdn.littlecorgi.top/mweb/2020-05-27/15895157853281.jpg" alt="-w1393"><br><img src="https://cdn.littlecorgi.top/mweb/2020-05-27/15895158024195.jpg" alt="-w765"></p><p>çœ‹åˆ°è½¬è¿‡æ¥çš„è¯­æ³•ï¼Œä½ å°±èƒ½æ‡‚äº†ï¼Œä¸ºä»€ä¹ˆkotlinèƒ½è¿è¡Œåœ¨JVMåªä¸Šäº†ã€‚å…¶å®kotlinè¿è¡Œçš„æœ€ç»ˆæœ¬è´¨ä»ç„¶è¿˜æ˜¯JVMçš„classæ–‡ä»¶ï¼Œåªä¸è¿‡ä»–ä½¿ç”¨äº†ä¸€å±‚è¯­æ³•ç³–ï¼Œæ‰€è°“çš„<code>fun main()</code>ã€<code>println()</code>ç­‰ç­‰ï¼Œæœ€ç»ˆéƒ½ä¼šè½¬æˆJavaè¯­æ³•å¯¹åº”çš„ä¸œè¥¿ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®ºï¼škotlinçš„ä¸€åˆ‡æ–¹ä¾¿ï¼Œåªä¸è¿‡éƒ½æ˜¯ä¸€å±‚è¯­æ³•ç³–è€Œå·²ã€‚ï¼ˆå¯èƒ½å­˜åœ¨ä¸€å®šçš„è¿‡ä¸ç»å¯¹ï¼Œä½†æ˜¯é“ç†ä¹Ÿç¡®å®è¿˜æ˜¯è¿™ä¸ªé“ç†ï¼‰</p><h1 id="2-å‡½æ•°"><a href="#2-å‡½æ•°" class="headerlink" title="2. å‡½æ•°"></a>2. å‡½æ•°</h1><h2 id="2-1-å‡½æ•°å£°æ˜"><a href="#2-1-å‡½æ•°å£°æ˜" class="headerlink" title="2.1 å‡½æ•°å£°æ˜"></a>2.1 å‡½æ•°å£°æ˜</h2><p>ä¸Šé¢æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„HelloWorldäº†è§£åˆ°äº†mainå‡½æ•°çš„å®šä¹‰æ–¹æ³•ï¼Œæˆ‘ä»¬å°±ä¸€ä¸ªç®€å•çš„å‡½æ•°æ¥å¤§è‡´äº†è§£ä¸‹kotlinä¸­å‡½æ•°çš„å®šä¹‰ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">max</span><span class="params">(a: <span class="type">Int</span>, b: <span class="type">Int</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">if</span> (a &gt; b) a <span class="keyword">else</span> b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æˆ‘ä»¬å°±æ¥å°†è¿™ä¸ªå‡½æ•°æ‹†è§£ä¸€ä¸‹ï¼Œé€æ­¥è®²ä¸€ä¸‹ä»–çš„å„ä¸ªç»„æˆéƒ¨åˆ†ï¼š</p><ul><li><p><code>fun</code>ï¼šfunå…³é”®å­—æ˜¯kotlinä¸­å‡½æ•°çš„æ ‡è¯†ï¼Œå°±æ˜¯è¯´æƒ³åœ¨kotlinä¸­å†™ä¸€ä¸ªå‡½æ•°çš„è¯ï¼Œå¿…é¡»ä»¥funå¼€å¤´ï¼Œå¦åˆ™kotlinæ˜¯ä¸ä¼šå°†å®ƒè¯†åˆ«æˆä¸€ä¸ªå‡½æ•°çš„ï¼Œåè€Œè¿˜å¯èƒ½ä¼šæŠ¥é”™ã€‚</p></li><li><p><code>max</code>ï¼šç´§è·Ÿç€funçš„ï¼Œå°±æ˜¯å‡½æ•°çš„åç§°äº†ã€‚</p></li><li><code>(a: Int, b: Int)</code>ï¼šå‡½æ•°ååé¢å°±æ˜¯ç”¨æ‹¬å·æ‹¬èµ·æ¥çš„å½¢å‚åˆ—è¡¨äº†ï¼Œæ¯ä¸ªå½¢å‚ä¹‹é—´ç”¨é€—å·(â€˜,â€™)åˆ†éš”å¼€æ¥ã€‚è€Œå‚æ•°çš„å®šä¹‰æ–¹æ³•æˆ–è€…è¯´å˜é‡çš„å®šä¹‰æ–¹æ³•æƒ³å¿…å¤§å®¶å·²ç»çœ‹å‡ºæ¥äº†ï¼Œ<code>a</code>å°±æ˜¯å˜é‡åï¼Œç„¶å<code>Int</code>å°±æ˜¯å˜é‡ç±»å‹ã€‚ç”±äºkotlinæ²¡æœ‰åŸºæœ¬ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è¯´ä»–ä¸åƒJavaæœ‰intã€floatç­‰è¿™äº›åŸºæœ¬ç±»å‹ï¼Œæ‰€ä»¥å˜é‡ç±»å‹å°±æ˜¯<code>Int</code>äº†ã€‚</li><li><code>: Int</code>ï¼šå¤§å®¶åº”è¯¥å·²ç»çœ‹å‡ºæ¥äº†ï¼Œå’Œå®šä¹‰ç±»å‹ç±»ä¼¼ï¼Œè¿™ä¸ªå°±ä»£è¡¨å‡½æ•°çš„è¿”å›å€¼æ˜¯Intç±»å‹çš„ã€‚</li><li>åé¢çš„å°±å’ŒJavaç±»ä¼¼ï¼Œå°±æ˜¯ç”¨ä¸€ç»„å¤§æ‹¬å·æ‹¬èµ·æ¥çš„å‡½æ•°ä½“ã€‚åªä¸è¿‡kotlinæ²¡æœ‰ä¸‰ç›®è¿ç®—ç¬¦ï¼Œæ‰€ä»¥Javaä¸­çš„<code>?:</code>åœ¨kotlinä¸­å°±æˆäº†<code>if else</code>ã€‚</li></ul><h2 id="2-2-è¡¨è¾¾å¼å‡½æ•°ä½“"><a href="#2-2-è¡¨è¾¾å¼å‡½æ•°ä½“" class="headerlink" title="2.2 è¡¨è¾¾å¼å‡½æ•°ä½“"></a>2.2 è¡¨è¾¾å¼å‡½æ•°ä½“</h2><p>åœ¨kotlinä¸­ï¼Œä½ å¯ä»¥è®©ç®€å•çš„äº‹ç‰©å°½å¯èƒ½ç®€å•çš„å±•ç°å‡ºæ¥(åœ¨åé¢ä½ å¯ä»¥çœ‹åˆ°æ›´å¤šè¿™ç±»ä¾‹å­)ã€‚</p><p>æ¯”æ–¹è¯´æˆ‘ä»¬ä¸Šé¢çš„<code>max</code>å‡½æ•°ï¼Œä»–çš„åŠŸèƒ½å°±æ˜¯æ¥å—<code>a</code>å’Œ<code>b</code>ä¸¤ä¸ªå‚æ•°ï¼Œç„¶åè¿”å›ä»–ä»¬ä¸­çš„è¾ƒå¤§å€¼ã€‚æˆ‘ä»¬å†™çš„ä»£ç å·²ç»å¤Ÿç®€æ´äº†ï¼Œä½†æ˜¯ï¼Œè¿™ä¸ªåªæ˜¯å¯¹äºJavaæ¥è¯´å¤Ÿç®€æ´ï¼Œä½†æ˜¯å¯¹äºkotlinæ¥è¯´ï¼Œä»–è¿˜ä¸å¤Ÿã€‚</p><p>ä¸‹é¢è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•ç”¨è¡¨è¾¾å¼å‡½æ•°æ¥é‡å†™è¿™ä¸ª<code>max</code>å‡½æ•°ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">max</span><span class="params">(a: <span class="type">Int</span>, b: <span class="type">Int</span>)</span></span>: <span class="built_in">Int</span> = <span class="keyword">if</span> (a &gt; b) a <span class="keyword">else</span> b</span><br></pre></td></tr></table></figure></p><p>å¯¹äºä¸Šé¢é‚£ä¸ªåˆçº§ç‰ˆæœ¬çš„<code>max</code>å‡½æ•°æ¥è¯´ï¼Œè¿™ä¸ªå·²ç»å¤Ÿç®€æ´äº†ã€‚</p><p>å¯¹åº”çš„ï¼Œå¦‚æœå‡½æ•°ä½“å†™åœ¨å¤§æ‹¬å·ä¸­ï¼Œæˆ‘ä»¬å°±è¯´è¿™ä¸ªå‡½æ•°æœ‰ä»£ç å—ä½“ã€‚å¦‚æœä»–åªæ˜¯ç®€å•çš„ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œä»–å°±æœ‰è¡¨è¾¾å¼ä½“ã€‚</p><p>ä½†æ˜¯ï¼Œæˆ‘ä»¬åˆšåˆšè¯´åˆ°ï¼Œkotlinæƒ³è®©ç®€å•çš„äº‹ç‰©å°½å¯èƒ½ç®€å•çš„å±•ç°å‡ºæ¥ã€‚æ‰€ä»¥ï¼Œå¯¹äºè¿™ä¸ªå·²ç»éå¸¸æ˜æ˜¾çš„è¿”å›å€¼ç±»å‹ï¼Œæˆ‘ä»¬ä½•å¿…è¦æŠŠå®ƒæ˜¾å¼çš„å®šä¹‰å‡ºæ¥å‘¢ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">max</span><span class="params">(a: <span class="type">Int</span>, b: <span class="type">Int</span>)</span></span> = <span class="keyword">if</span> (a &gt; b) a <span class="keyword">else</span> b</span><br></pre></td></tr></table></figure></p><h2 id="2-3-å‚æ•°"><a href="#2-3-å‚æ•°" class="headerlink" title="2.3 å‚æ•°"></a>2.3 å‚æ•°</h2><h3 id="2-3-1-é»˜è®¤å‚æ•°"><a href="#2-3-1-é»˜è®¤å‚æ•°" class="headerlink" title="2.3.1 é»˜è®¤å‚æ•°"></a>2.3.1 é»˜è®¤å‚æ•°</h3><p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³è¦ç¼ºçœå‡½æ•°çš„å‚æ•°æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹å‚æ•°ä½¿ç”¨é»˜è®¤å€¼ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">max</span><span class="params">(a: <span class="type">Int</span>, b: <span class="type">Int</span> = <span class="number">0</span>)</span></span> = <span class="keyword">if</span> (a &gt; b) a <span class="keyword">else</span> b</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬è°ƒç”¨å®ƒçš„æ—¶å€™ï¼Œå°±å¯ä»¥ç¼ºçœæœ‰é»˜è®¤å€¼çš„å‚æ•°ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(max(<span class="number">1</span>))</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯å½“åœ¨è®¾ç½®äº†é»˜è®¤å€¼å‚æ•°çš„åé¢æœ‰æ²¡æœ‰è®¾ç½®é»˜è®¤å€¼çš„å‚æ•°çš„è¯ï¼Œæˆ‘ä»¬è°ƒç”¨çš„æ—¶å€™å¿…é¡»æ˜¾å¼æŒ‡æ˜è¿™ä¸ªå€¼åˆ°åº•æ˜¯å±äºå“ªä¸ªå‚æ•°çš„ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‡½æ•°å®šä¹‰</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">max</span><span class="params">(a: <span class="type">Int</span> = <span class="number">0</span>, b: <span class="type">Int</span>)</span></span>: <span class="built_in">Int</span> = <span class="keyword">return</span> <span class="keyword">if</span> (a &gt; b) a <span class="keyword">else</span> b</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡½æ•°è°ƒç”¨</span></span><br><span class="line">print(max(b = <span class="number">1</span>))</span><br></pre></td></tr></table></figure></p><h1 id="3-å˜é‡-ç±»å’Œå¯¹è±¡"><a href="#3-å˜é‡-ç±»å’Œå¯¹è±¡" class="headerlink" title="3. å˜é‡(ç±»å’Œå¯¹è±¡)"></a>3. å˜é‡(ç±»å’Œå¯¹è±¡)</h1><h2 id="3-1-ä¸å¯å˜å˜é‡å’Œå¯å˜å˜é‡"><a href="#3-1-ä¸å¯å˜å˜é‡å’Œå¯å˜å˜é‡" class="headerlink" title="3.1 ä¸å¯å˜å˜é‡å’Œå¯å˜å˜é‡"></a>3.1 ä¸å¯å˜å˜é‡å’Œå¯å˜å˜é‡</h2><p>å’ŒJavaä¸åŒï¼Œåœ¨kotlinä¸­ï¼Œå˜é‡çš„å®šä¹‰ä¸»è¦é€šè¿‡<code>val</code>å’Œ<code>var</code>ã€‚è¿™ä¸ªè¯­æ³•æœ‰ç‚¹ç±»ä¼¼äºJSã€‚</p><ul><li><code>val</code>ï¼šç”¨äºå€¼ä»ä¸æ›´æ”¹çš„å˜é‡ã€‚æ‚¨ä¸èƒ½ä¸ºä½¿ç”¨ val å£°æ˜çš„å˜é‡é‡æ–°èµ‹å€¼ã€‚å¯¹åº”Javaæ˜¯<code>final</code>ã€‚</li><li><code>var</code>ï¼šç”¨äºå€¼å¯ä»¥æ›´æ”¹çš„å˜é‡ã€‚å¯¹åº”Javaæ˜¯æ™®é€š(éfinal)çš„å˜é‡ã€‚</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> count: <span class="built_in">Int</span> = <span class="number">10</span></span><br><span class="line"><span class="keyword">var</span> num: <span class="built_in">Int</span> = <span class="number">10</span></span><br><span class="line">count = <span class="number">1</span> <span class="comment">// Errorï¼šå› ä¸ºcountæ˜¯valï¼Œå¹¶ä¸”å·²ç»åˆå§‹åŒ–è¿‡äº†</span></span><br><span class="line">num = <span class="number">1</span></span><br></pre></td></tr></table></figure><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œåº”è¯¥å°½å¯èƒ½çš„å»ä½¿ç”¨<code>val</code>æ¥å£°æ˜æ‰€æœ‰çš„kotlinå˜é‡ã€‚</p><p>åŒJavaçš„finalä¸€æ ·ï¼Œè¢«valä¿®é¥°çš„å˜é‡ï¼Œå®ƒæœ¬èº«æ˜¯ä¸èƒ½å˜çš„ï¼Œä½†æ˜¯ä»–æŒ‡å‘çš„å¯¹è±¡æ˜¯å¯ä»¥å˜çš„ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> a = ArrayList&lt;String&gt;()</span><br><span class="line">a.add(<span class="string">&quot;1234&quot;</span>) <span class="comment">// æ”¹å˜äº†æ‰€å¼•ç”¨çš„å¯¹è±¡</span></span><br><span class="line">a.add(<span class="string">&quot;1324&quot;</span>) <span class="comment">// æ”¹å˜äº†æ‰€å¼•ç”¨çš„å¯¹è±¡</span></span><br><span class="line">a = ArrayList&lt;String&gt;() <span class="comment">// Errorï¼šæ”¹å˜äº†ä»–è‡ªèº«</span></span><br></pre></td></tr></table></figure></p><h2 id="3-2-ç±»å‹æ¨æ–­"><a href="#3-2-ç±»å‹æ¨æ–­" class="headerlink" title="3.2 ç±»å‹æ¨æ–­"></a>3.2 ç±»å‹æ¨æ–­</h2><p>åœ¨æŸäº›æ—¶å€™ï¼Œå˜é‡çš„ç±»å‹å¯ä»¥çœç•¥ä¸å†™ï¼Œç„¶åç¼–è¯‘å™¨ä¼šæ ¹æ®æ‰€èµ‹å€¼çš„ç±»å‹æ¥æ¨æ–­ç±»å‹ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> languageName = <span class="string">&quot;Kotlin&quot;</span></span><br><span class="line"><span class="keyword">val</span> upperCaseName = languageName.toUpperCase()</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯ä¸€æ—¦å˜é‡çš„ç±»å‹åœ¨å®šä¹‰æ—¶è¢«ç¡®å®šä¸‹æ¥åï¼Œåé¢æ˜¯ä¸è®¸å†æ›´æ”¹ç±»å‹äº†ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> answer = <span class="number">42</span> <span class="comment">// answerçš„ç±»å‹æ˜¯Int</span></span><br><span class="line">answer = <span class="string">&quot;no answer&quot;</span> <span class="comment">//Errorï¼šç±»å‹ä¸åŒ¹é…</span></span><br></pre></td></tr></table></figure></p><h2 id="3-3-å­—ç¬¦ä¸²æ¨¡æ¿"><a href="#3-3-å­—ç¬¦ä¸²æ¨¡æ¿" class="headerlink" title="3.3 å­—ç¬¦ä¸²æ¨¡æ¿"></a>3.3 å­—ç¬¦ä¸²æ¨¡æ¿</h2><p>æˆ‘ä»¬å‰é¢å†™è¿‡HelloWorldï¼Œä½†æ˜¯æˆ‘ä»¬ç°åœ¨æƒ³æ ¹æ®äººåï¼Œè¾“å‡ºHello Nameï¼Œé‚£ä¹ˆè¿™ä¸ªç”¨kotlinè¯¥æ€ä¹ˆå®ç°ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> name = <span class="string">&quot;Kotlin&quot;</span></span><br><span class="line">    println(<span class="string">&quot;Hello <span class="variable">$name</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å­—ç¬¦ä¸²ä¸­æœ‰ä¸€ä¸ª<code>$å˜é‡å</code>ç±»å‹çš„ç»“æ„ï¼Œå…¶å®è¿™ä¸ªç»“æ„å®Œæ•´æ˜¯è¿™æ ·çš„<code>$&#123;å˜é‡å&#125;</code>ï¼Œåªä¸è¿‡å¯¹äºå•çº¯çš„å˜é‡ï¼Œå¯ä»¥çœç•¥èŠ±æ‹¬å·ã€‚</p><p>è¿™ä¸ªå°±æ˜¯å­—ç¬¦ä¸²æ¨¡æ¿ã€‚</p><p>é™¤äº†å˜é‡å¤–ï¼Œå­—ç¬¦ä¸²æ¨¡æ¿ä¸­è¿˜å¯ä»¥å†™å…¥è¡¨è¾¾å¼ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> name = <span class="string">&quot;Kotlin&quot;</span></span><br><span class="line">    println(<span class="string">&quot;Hello <span class="subst">$&#123;name.toUpperCase()&#125;</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç”šè‡³æ›´å¤æ‚çš„éƒ½å¯ä»¥å†™ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> sc = Scanner(System.`<span class="keyword">in</span>`)</span><br><span class="line">    <span class="keyword">val</span> name = sc.next()</span><br><span class="line">    println(<span class="string">&quot;Hello <span class="subst">$&#123;if (name.isNotEmpty()) name else <span class="string">&quot;Kotlin&quot;</span>&#125;</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="4-æ§åˆ¶æµ"><a href="#4-æ§åˆ¶æµ" class="headerlink" title="4. æ§åˆ¶æµ"></a>4. æ§åˆ¶æµ</h1><p>åœ¨kotlinä¸­ï¼Œæ§åˆ¶æµä¸»è¦æœ‰<code>if</code>ã€<code>when</code>ã€<code>for</code>ã€<code>while</code>ã€‚</p><h2 id="4-1-if"><a href="#4-1-if" class="headerlink" title="4.1 if"></a>4.1 if</h2><p>åœ¨å¤§éƒ¨åˆ†è¯­è¨€ä¸­ï¼Œ<code>if</code>å°±æ˜¯ç®€å•çš„åˆ¤æ–­ï¼Œkotlinä¹Ÿä¸ä¾‹å¤–ã€‚</p><p>ä½†æ˜¯åœ¨kotlinä¸­ï¼Œ<code>if</code>æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå¥¹æ˜¯æœ‰è¿”å›å€¼çš„ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåœ¨kotlinä¸­æ²¡æœ‰<code>?:</code>ï¼Œå› ä¸º<code>if else</code>å°±å¯ä»¥æ›¿ä»£ä»–ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼ ç»Ÿç”¨æ³•</span></span><br><span class="line"><span class="keyword">var</span> max = a </span><br><span class="line"><span class="keyword">if</span> (a &lt; b) max = b</span><br><span class="line"></span><br><span class="line"><span class="comment">// With else </span></span><br><span class="line"><span class="keyword">var</span> max: <span class="built_in">Int</span></span><br><span class="line"><span class="keyword">if</span> (a &gt; b) &#123;</span><br><span class="line">    max = a</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    max = b</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// ä½œä¸ºè¡¨è¾¾å¼</span></span><br><span class="line"><span class="keyword">val</span> max = <span class="keyword">if</span> (a &gt; b) a <span class="keyword">else</span> b</span><br></pre></td></tr></table></figure><h2 id="4-2-when"><a href="#4-2-when" class="headerlink" title="4.2 when"></a>4.2 when</h2><p>æœ‰ä¸€ä¸ªå¾ˆå¸¸è§çš„æ¡ˆä¾‹ï¼Œå½“æˆ‘ä»¬éœ€è¦åˆ¤æ–­ä¸€ä¸ªå˜é‡çš„å€¼çš„æ—¶å€™ï¼Œå½“åœ¨æŸä¸ªåŒºé—´æ‰§è¡ŒæŸä¸ªä»£ç ï¼Œåœ¨å¦ä¸€ä¸ªåŒºé—´æ‰§è¡Œå¦ä¸€ä¸ªä»£ç (æ¯”å¦‚æˆ‘ä»¬é«˜ä¸­æ˜¯å­¦ä¹ è¿‡çš„é‚£ç§åŒºé—´çš„äºŒå…ƒä¸€æ¬¡æ–¹ç¨‹æ±‚è§£)ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœæˆ‘ä»¬ä½¿ç”¨<code>if</code>çš„è¯ï¼Œå°±éœ€è¦ç‰¹åˆ«å¤šçš„<code>if else</code>ã€‚</p><p>è€Œå¦‚æœæˆ‘ä»¬æœ‰ä¸€ç§ä¸œè¥¿ï¼Œä»–å¯ä»¥åªéœ€è¦æŒ‡å®šåˆ¤æ–­çš„å˜é‡ï¼Œç„¶ååé¢å°±å¯ä»¥ä¸‹å¯¹åº”çš„åŒºé—´å¹¶æ‰§è¡Œå¯¹åº”çš„ä»£ç ï¼Œè¿™æ ·æ˜¯ä¸æ˜¯æ¯”å•çº¯çš„å¤§é‡çš„<code>if else</code>ç®€æ´çš„å¤šã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨<code>when</code>ã€‚</p><h3 id="4-2-1-whençš„åŸºç¡€ç”¨æ³•"><a href="#4-2-1-whençš„åŸºç¡€ç”¨æ³•" class="headerlink" title="4.2.1 whençš„åŸºç¡€ç”¨æ³•"></a>4.2.1 whençš„åŸºç¡€ç”¨æ³•</h3><p>åœ¨kotlinä¸­ï¼Œç”¨<code>when</code>å–ä»£äº†Cã€C++ã€Javaä¸­çš„<code>switch</code>ï¼ŒåŠŸèƒ½ä¸€æ¨¡ä¸€æ ·ï¼Œåªä¸è¿‡æœ‰ä¸€å°åŒºåˆ«ï¼Œæˆ‘ä»¬è¾¹çœ‹ä»£ç è¾¹è¯´ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> x = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">when</span> (x) &#123;</span><br><span class="line">    <span class="number">0</span> -&gt; &#123;</span><br><span class="line">        println(<span class="string">&quot;x == 0&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">1</span> -&gt; &#123;</span><br><span class="line">        println(<span class="string">&quot;x == 1&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">2</span> -&gt; &#123;</span><br><span class="line">        println(<span class="string">&quot;x == 2&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> -&gt; &#123;</span><br><span class="line">        println(<span class="string">&quot;æ²¡æœ‰è¢«å®šä¹‰&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å’Œ<code>switch</code>ä¸€æ ·ï¼Œæ‹¬å·é‡Œé¢æ˜¯ç”¨æ¥åŒ¹é…çš„å˜é‡ï¼Œç„¶åä¸‹é¢å°±æ˜¯åŒ¹é…çš„å€¼ï¼Œå½“åŒ¹é…åˆ°æŸä¸ªå€¼çš„æ—¶å€™ï¼Œå°±æ‰§è¡Œè¿™ä¸ªå€¼åé¢çš„ä»£ç å—ã€‚</p><p>ä½†æ˜¯å’ŒJavaåŠC++çš„<code>switch</code>ä¸åŒçš„æ˜¯ï¼Œä»–ä¸éœ€è¦å†™<code>break</code>è¯­å¥ã€‚</p><p>å½“å…¶ä»–åˆ†æ”¯éƒ½ä¸æ»¡è¶³æ¡ä»¶çš„æ—¶å€™ï¼Œå°±ä¼šè‡ªåŠ¨è¿›å…¥<code>else</code>åˆ†æ”¯ï¼Œå»æ‰§è¡Œ<code>else</code>åˆ†æ”¯çš„ä»£ç ã€‚åœ¨kotlinä¸­ï¼Œ<code>else</code>åˆ†æ”¯æ˜¯å¿…é¡»æœ‰çš„ã€‚</p><p>å½“æœ‰å¤šä¸ªåˆ†æ”¯éœ€è¦æ‰§è¡ŒåŒæ ·çš„ä»£ç æ—¶ï¼Œå°±å¯ä»¥æŠŠå¤šä¸ªåˆ†æ”¯çš„æ¡ä»¶æ”¾åœ¨ä¸€èµ·ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> x = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">when</span> (x) &#123;</span><br><span class="line">    <span class="number">0</span>, <span class="number">1</span> -&gt; &#123;</span><br><span class="line">        println(<span class="string">&quot;x == 0&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">2</span> -&gt; &#123;</span><br><span class="line">        println(<span class="string">&quot;x == 2&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> -&gt; &#123;</span><br><span class="line">        println(<span class="string">&quot;æ²¡æœ‰è¢«å®šä¹‰&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨åŒºé—´(è¿™ä¸ªæˆ‘ä»¬åé¢å°†forå¾ªç¯çš„æ—¶å€™ä¼šè®²åˆ°)ä½œä¸ºåˆ†æ”¯çš„åˆ¤æ–­æ¡ä»¶ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> x = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">when</span> (x) &#123;</span><br><span class="line">    <span class="keyword">in</span> <span class="number">0.</span><span class="number">.10</span> -&gt; &#123;</span><br><span class="line">        println(<span class="string">&quot;x == 0&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> -&gt; &#123;</span><br><span class="line">        println(<span class="string">&quot;æ²¡æœ‰è¢«å®šä¹‰&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="4-2-2-åœ¨whenä¸­ä½¿ç”¨ä»»æ„å¯¹è±¡"><a href="#4-2-2-åœ¨whenä¸­ä½¿ç”¨ä»»æ„å¯¹è±¡" class="headerlink" title="4.2.2 åœ¨whenä¸­ä½¿ç”¨ä»»æ„å¯¹è±¡"></a>4.2.2 åœ¨whenä¸­ä½¿ç”¨ä»»æ„å¯¹è±¡</h3><p><code>when</code>æ¯”Javaä¸­çš„<code>switch</code>è¦å¼ºå¤§çš„å¤šï¼Œåœ¨<code>switch</code>ä¸­åªèƒ½ç”¨å¸¸é‡ä½œä¸ºåˆ†æ”¯æ¡ä»¶ï¼Œä½†æ˜¯åœ¨<code>when</code>ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»»ä½•å¯¹è±¡ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> a: <span class="built_in">Int</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">val</span> b: <span class="built_in">Int</span> = <span class="number">0</span></span><br><span class="line"><span class="keyword">when</span> (setOf(a, b)) &#123;</span><br><span class="line">    setOf(<span class="number">0</span>, <span class="number">0</span>) -&gt; &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    setOf(<span class="number">0</span>, <span class="number">1</span>) -&gt; &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    setOf(<span class="number">1</span>, <span class="number">0</span>) -&gt; &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    setOf(<span class="number">1</span>, <span class="number">1</span>) -&gt; &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="4-2-3-ç±»å‹æ£€æµ‹ä¸æ™ºèƒ½è½¬æ¢"><a href="#4-2-3-ç±»å‹æ£€æµ‹ä¸æ™ºèƒ½è½¬æ¢" class="headerlink" title="4.2.3 ç±»å‹æ£€æµ‹ä¸æ™ºèƒ½è½¬æ¢"></a>4.2.3 ç±»å‹æ£€æµ‹ä¸æ™ºèƒ½è½¬æ¢</h3><h4 id="ç±»å‹æ£€æµ‹"><a href="#ç±»å‹æ£€æµ‹" class="headerlink" title="ç±»å‹æ£€æµ‹"></a>ç±»å‹æ£€æµ‹</h4><p>ä½¿ç”¨<code>when</code>çš„æ—¶å€™è¿˜å¯ä»¥å»åˆ¤æ–­å½“å‰è¿™ä¸ªå¯¹è±¡æ˜¯å±äºå“ªä¸ªç±»çš„å¯¹è±¡ã€‚</p><p>kotlinç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå…³é”®å­—<code>is</code>ï¼Œä½¿ç”¨è¿™ä¸ªå…³é”®å­—ï¼Œæˆ‘ä»¬å¯ä»¥å»åˆ¤æ–­å½“å‰è¿™ä¸ªå¯¹è±¡æ˜¯å¦ç¬¦åˆç»™å®šçš„ç±»å‹ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (obj <span class="keyword">is</span> String) &#123;</span><br><span class="line">    print(obj.length)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (obj !<span class="keyword">is</span> String) &#123; <span class="comment">// ä¸ !(obj is String) ç›¸åŒ</span></span><br><span class="line">    print(<span class="string">&quot;Not a String&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    print(obj.length)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="æ™ºèƒ½è½¬æ¢"><a href="#æ™ºèƒ½è½¬æ¢" class="headerlink" title="æ™ºèƒ½è½¬æ¢"></a>æ™ºèƒ½è½¬æ¢</h4><p><code>is</code>çš„å‰å®³ä¹‹å¤„ä¸åœ¨äºä»–èƒ½åˆ¤æ–­å¯¹è±¡æ˜¯å¦ç¬¦åˆæŸä¸ªç»™å®šçš„ç±»å‹ï¼Œè€Œæ˜¯åœ¨äºå½“ä»–æ£€æµ‹è¿‡æŸä¸ªå˜é‡æ˜¯æŸç§ç±»å‹çš„æ—¶å€™ï¼Œåé¢å°±ä¸ç”¨å†è¿›è¡Œè½¬æ¢äº†ï¼Œå¯ä»¥å°±æŠŠä»–å½“åšæ£€æŸ¥è¿‡çš„ç±»å‹ä½¿ç”¨ï¼Œè¿™å°±æ˜¯æ™ºèƒ½è½¬æ¢ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">demo</span><span class="params">(x: <span class="type">Any</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (x <span class="keyword">is</span> String) &#123;</span><br><span class="line">        print(x.length) <span class="comment">// x è‡ªåŠ¨è½¬æ¢ä¸ºå­—ç¬¦ä¸²</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="åœ¨whenä¸­ä½¿ç”¨"><a href="#åœ¨whenä¸­ä½¿ç”¨" class="headerlink" title="åœ¨whenä¸­ä½¿ç”¨"></a>åœ¨whenä¸­ä½¿ç”¨</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">when</span> (x) &#123;</span><br><span class="line">    <span class="keyword">is</span> <span class="built_in">Int</span> -&gt; print(x + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">is</span> String -&gt; print(x.length + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">is</span> IntArray -&gt; print(x.sum())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-3-while"><a href="#4-3-while" class="headerlink" title="4.3 while"></a>4.3 while</h2><p>ç›¸ä¿¡ä¸€å®šæœ‰å¾ˆå¤šäººéƒ½å’Œæˆ‘ä¸€æ ·ï¼Œçœ‹åˆ°è¿™å—ä¼šæœ‰ç‚¹ç–‘é—®ã€‚å› ä¸ºæˆ‘çœ‹è¿‡çš„å¤§éƒ¨åˆ†è¯­è¨€å­¦ä¹ çš„ä¹¦ï¼Œæ¯”æ–¹è¯´Cã€Javaã€C++çš„å¤§éƒ¨åˆ†è¯­è¨€å…¥é—¨ç±»ä¹¦ï¼Œéƒ½ä¼šå°†<code>forå¾ªç¯</code>æ”¾åœ¨<code>whileå¾ªç¯</code>çš„å‰é¢ã€‚è€Œå½“æˆ‘åœ¨çœ‹ã€Škotlinå®æˆ˜ã€‹è¿™æœ¬ä¹¦çš„æ—¶å€™ï¼Œå´å‘ç°å®ƒæŠŠ<code>while</code>æ”¾åœ¨äº†<code>for</code>çš„å‰é¢ã€‚</p><p>ä½†æ˜¯å½“æˆ‘çœ‹äº†ä¼šä¹‹åå°±æ‡‚äº†ï¼Œkotlinçš„<code>while</code>å’ŒJavaä»¥åŠCçš„<code>while</code>æ²¡æœ‰å•¥åŒºåˆ«ï¼Œä½†æ˜¯kotlinçš„<code>for</code>å’ŒJavaçš„<code>for</code>æœ‰ç‚¹åŒºåˆ«ï¼Œå¹¶ä¸”æœ‰å¾ˆå¤šæ“ä½œã€‚æ‰€ä»¥ä¼šæŠŠ<code>while</code>æ”¾åœ¨å‰é¢ï¼Œå¹¶ä¸”ä¼šä¸€ç¬”å¸¦è¿‡ã€‚</p><p>kotlinçš„whileä¹Ÿåˆ†ä¸º<code>while</code>å’Œ<code>do-while</code>ã€‚ç”¨æ³•å’ŒJavaçš„æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (x &gt; <span class="number">0</span>) &#123; <span class="comment">// å½“æ¡ä»¶ç¬¦åˆæ‰è¿›å…¥å¾ªç¯</span></span><br><span class="line">    x--</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span> &#123; <span class="comment">// å…ˆä¼šè¿›å…¥ä»£ç å—ä¸€åªï¼Œç„¶åæ‰§è¡Œå®Œæ¯•åæ‰ä¼šå»åˆ¤æ–­æ¡ä»¶ï¼Œå¦‚æœç¬¦åˆå°±å†å»æ‰§è¡Œå¾ªç¯</span></span><br><span class="line">  <span class="keyword">val</span> y = retrieveData()</span><br><span class="line">&#125; <span class="keyword">while</span> (y != <span class="literal">null</span>) <span class="comment">// y åœ¨æ­¤å¤„å¯è§</span></span><br></pre></td></tr></table></figure></p><h2 id="4-4-for"><a href="#4-4-for" class="headerlink" title="4.4 for"></a>4.4 for</h2><p>æˆ‘ä»¬åˆšåˆšè¯´åˆ°è¿‡ï¼Œkotlinçš„<code>for</code>å’ŒJavaçš„<code>for</code>æœ‰ç€è¾ƒå¤§çš„åŒºåˆ«ã€‚</p><p>æˆ‘ä»¬åœ¨Javaä¸­å¸¸ç”¨çš„foræœ‰ä¸¤ç§ï¼š<code>ç®€å•çš„for</code>å’Œ<code>for-each</code>ï¼š</p><ul><li>ç®€å•çš„forå°±æ˜¯<code>for(å˜é‡å®šä¹‰; æ‰§è¡Œçš„æ¡ä»¶; å˜é‡æ¯æ¬¡å¾ªç¯éœ€è¦æ‰§è¡Œçš„è¯­å¥ï¼Œä¸€èˆ¬éƒ½æ˜¯æ§åˆ¶å˜é‡çš„å€¼çš„å˜åŒ–)</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i += <span class="number">2</span>) &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>for-eachå°±æ˜¯<code>for(ä¸´æ—¶å˜é‡ in é›†åˆ)</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;Integer&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (i in arrayList) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶iå°±ç›¸å½“äºæ˜¯arrayListè¿™ä¸ªé›†åˆé‡Œé¢å­˜ç€çš„æ¯ä¸€ä¸ªå¯¹è±¡ã€‚</p><p>è€Œkotlinçš„<code>for</code>å°±å’ŒJavaçš„<code>for-each</code>ä¸€è‡´ã€‚</p><h3 id="4-4-1-for-each"><a href="#4-4-1-for-each" class="headerlink" title="4.4.1 for-each"></a>4.4.1 for-each</h3><p><code>for</code>å¾ªç¯å¯ä»¥å¯¹ä»»ä½•æä¾›äº†<code>è¿­ä»£å™¨(iterator)</code>çš„å¯¹è±¡è¿›è¡Œéå†ã€‚<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (item <span class="keyword">in</span> collection) print(item)</span><br></pre></td></tr></table></figure></p><p>forå¯ä»¥å¾ªç¯éå†ä»»ä½•æä¾›äº†è¿­ä»£å™¨çš„å¯¹è±¡ã€‚å³ï¼š</p><ul><li>æœ‰ä¸€ä¸ªæˆå‘˜å‡½æ•°æˆ–è€…æ‰©å±•å‡½æ•°<code>iterator()</code>ï¼Œå®ƒçš„è¿”å›ç±»å‹<ul><li>æœ‰ä¸€ä¸ªæˆå‘˜å‡½æ•°æˆ–è€…æ‰©å±•å‡½æ•°<code>next()</code>ï¼Œå¹¶ä¸”</li><li>æœ‰ä¸€ä¸ªæˆå‘˜å‡½æ•°æˆ–è€…æ‰©å±•å‡½æ•°<code>hasNext()</code>è¿”å›<code>Boolean</code></li></ul></li></ul><h3 id="4-4-2-è¿­ä»£æ•°å­—ï¼šåŒºé—´"><a href="#4-4-2-è¿­ä»£æ•°å­—ï¼šåŒºé—´" class="headerlink" title="4.4.2 è¿­ä»£æ•°å­—ï¼šåŒºé—´.."></a>4.4.2 è¿­ä»£æ•°å­—ï¼šåŒºé—´..</h3><p>å¯¹äºæˆ‘æ¥è¯´ï¼Œkotlinçš„ä½¿ç”¨<code>for</code>è¿­ä»£æ•°å­—æ¯”Javaæ›´ä¸ºæ–¹ä¾¿ï¼Œä½†æ˜¯æœ‰äº›æ—¶å€™å´åè€Œå¾ˆä¸æ–¹ä¾¿ã€‚</p><p>åœ¨ä½¿ç”¨<code>for</code>è¿­ä»£æ•°å­—ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹kotlinçš„åŒºé—´è¡¨è¾¾å¼ã€‚</p><p>åŒºé—´æœ¬è´¨ä¸Šå°±æ˜¯ä¸¤ä¸ªå€¼ä¹‹é—´çš„é—´éš”ï¼Œè¿™ä¸¤ä¸ªå€¼é€šå¸¸å°±æ˜¯æ•°å­—ï¼šä¸€ä¸ªä»£è¡¨äº†èµ·å§‹å€¼ï¼Œä¸€ä¸ªä»£è¡¨äº†ç»“æŸå€¼ã€‚<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (i <span class="keyword">in</span> <span class="number">1.</span><span class="number">.4</span>) &#123; <span class="comment">// ç­‰åŒäº1 &lt;= i &lt;= 4</span></span><br><span class="line">    print(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è€Œ<code>in</code>è¿™ä¸ªå‡½æ•°å®é™…ä¸Šæ˜¯<code>rangeTo()</code>ã€‚æ‰€ä»¥è¯´ï¼Œå®é™…ä¸Šæˆ‘ä»¬è°ƒç”¨çš„æ˜¯<code>rangeTo()</code>å‡½æ•°ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹<a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.ranges/range-to.html">kotlinå®˜æ–¹æ–‡æ¡£</a>å¯¹è¿™ä¸ªå‡½æ•°çš„å®šä¹‰ï¼š<br><img src="https://cdn.littlecorgi.top/mweb/2020-05-27/kotlin%E5%85%A5%E9%97%A8-%E4%B8%80-%E2%80%94%E2%80%94%E5%9F%BA%E6%9C%AC%E8%A6%81%E7%B4%A04.png" alt="kotlinå…¥é—¨-ä¸€-â€”â€”åŸºæœ¬è¦ç´ 4"></p><p>ç¿»è¯‘è¿‡æ¥å°±æ˜¯:</p><blockquote><p>åˆ›å»ºä¸€ä¸ªä»è¿™ä¸ªç»§æ‰¿è‡ªComparableæ¥å£çš„valueåˆ°thatçš„range(åŒºé—´)<br>valueå¿…é¡»å°äºthatï¼Œå¦åˆ™è¿™ä¸ªrangeå°†ä¼šæ˜¯ç©ºçš„ã€‚</p></blockquote><p>æ‰€ä»¥å°±æ˜¯è¯´<code>rangeTo()</code>æˆ–è€…è¯´<code>..</code>åªèƒ½ä»å°åˆ°å¤§çš„éå†ï¼Œåè¿‡æ¥åˆ™ä¸è¡Œã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬ä¸Šé¢çš„ä¾‹å­æ˜¯ä»1é€æ­¥åˆ°4ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰“å°å‡ºæ¥çš„æ˜¯1ï¼Œ2ï¼Œ3ï¼Œ4ã€‚<br>ä½†æ˜¯å¦‚æœæˆ‘åªæƒ³è¦è¾“å‡º1åˆ°4ä¹‹é—´çš„å¥‡æ•°å‘¢ï¼Ÿ<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘æƒ³åœ¨1åˆ°4ä¹‹é—´æ¯éš”2ä¸ªè¾“å‡ºä¸€æ¬¡ï¼Œé‚£ä¹ˆè¯¥æ€ä¹ˆæ“ä½œå‘¢ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1.</span><span class="number">.4</span> step <span class="number">2</span>) &#123;</span><br><span class="line">    print(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±èƒ½ä»1å¼€å§‹æ¯éš”2æ‰§è¡Œä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯è¾“å‡º1ï¼Œ3ã€‚</p><p><code>..</code>ç›¸å½“äºæ˜¯é—­åŒºé—´ï¼Œé‚£ä¹ˆå¼€åŒºé—´å‘¢ï¼Ÿ<br>å¦‚æœè¦å®ç°å¼€åŒºé—´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>until</code><br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span> until <span class="number">4</span> step <span class="number">2</span>) &#123;</span><br><span class="line">    print(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æˆ‘ä»¬åˆšåˆšè¯´çš„å…¨éƒ¨éƒ½æ˜¯ä»å°åˆ°å¤§ï¼Œé‚£ä¹ˆä»å¤§åˆ°å°å‘¢ï¼Ÿ<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">8</span> downTo <span class="number">1</span>) print(i)</span><br></pre></td></tr></table></figure></p><p>è¿™æ ·å°±ä¼šå®ç°ä»8å¼€å§‹è¾“å‡ºå­—ç¬¦ç›´åˆ°1ä¸ºæ­¢ã€‚</p><h3 id="4-4-2-ä¸ºä»€ä¹ˆæˆ‘ä¼šè¯´kotlinçš„foråœ¨æœ‰äº›åœ°æ–¹æ²¡æœ‰Javaçš„foræ–¹ä¾¿"><a href="#4-4-2-ä¸ºä»€ä¹ˆæˆ‘ä¼šè¯´kotlinçš„foråœ¨æœ‰äº›åœ°æ–¹æ²¡æœ‰Javaçš„foræ–¹ä¾¿" class="headerlink" title="4.4.2 ä¸ºä»€ä¹ˆæˆ‘ä¼šè¯´kotlinçš„foråœ¨æœ‰äº›åœ°æ–¹æ²¡æœ‰Javaçš„foræ–¹ä¾¿"></a>4.4.2 ä¸ºä»€ä¹ˆæˆ‘ä¼šè¯´kotlinçš„foråœ¨æœ‰äº›åœ°æ–¹æ²¡æœ‰Javaçš„foræ–¹ä¾¿</h3><p>åœ¨ä½¿ç”¨<code>for (i in 0..10</code>çš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æ“ä½œæŒ‡é’ˆæ˜¯æ²¡æ³•æ“ä½œçš„ï¼Œä¸¾ä¸ªä¾‹å­ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1.</span><span class="number">.2</span>) &#123;</span><br><span class="line">    i-- <span class="comment">// Errorï¼švalä¸èƒ½è¢«æ›´æ”¹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç°åœ¨æˆ‘ä»¬å°±æ‡‚äº†ï¼Œå› ä¸ºkotlinè‡ªåŠ¨æŠŠiè¿™ä¸ªå˜é‡å®šä¹‰ä¸ºvalçš„ã€‚</p><p>é‚£ä¹ˆå¦‚æœæˆ‘ä»¬æŠŠå®ƒæ‰‹åŠ¨è®¾å®šä¸ºvarå‘¢ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> <span class="number">1.</span><span class="number">.2</span>) &#123; <span class="comment">// Errorï¼š&#x27;var&#x27;ä¸å…è®¸è¢«æ”¾åœ¨å¾ªç¯çš„å‚æ•°ä¸­</span></span><br><span class="line">    i--</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ä¹Ÿå°±æ˜¯è¯´kotlinæ ¹æœ¬ä¸å…è®¸varå‡ºç°åœ¨è¿™ï¼Œæˆ–è€…è¯´ä»»ä½•ä¸œè¥¿éƒ½ä¸å…è®¸å‡ºç°åœ¨è¿™(valä¹Ÿä¸è¡Œ)ï¼Œå› ä¸ºè¿™æ ·ä¸ç¬¦åˆkotlinçš„è¯­æ³•ã€‚</p><p>æ‰€ä»¥åœ¨kotlinä¸­ï¼Œå¦‚æœä½ æƒ³åœ¨å¾ªç¯ä¸­æ“ä½œæŒ‡é’ˆï¼Œå°±åªèƒ½é€šè¿‡whileäº†ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Kotlin/">Kotlin</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Kotlin/">Kotlin</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/">è¯­è¨€åŸºç¡€</category>
      
      
      <comments>https://www.littlecorgi.top/posts/2ed82411.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Androidç¼–è¯‘å˜ä½“</title>
      <link>https://www.littlecorgi.top/posts/9900843a.html</link>
      <guid>https://www.littlecorgi.top/posts/9900843a.html</guid>
      <pubDate>Mon, 20 Jan 2020 10:16:42 GMT</pubDate>
      
        
        
          
          
      <description></description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="ç¼–è¯‘æµç¨‹"><a href="#ç¼–è¯‘æµç¨‹" class="headerlink" title="ç¼–è¯‘æµç¨‹"></a>ç¼–è¯‘æµç¨‹</h1><p>æˆ‘ä»¬éƒ½çŸ¥é“Androidç¼–è¯‘å°±æ˜¯å°†æˆ‘ä»¬è‡ªå·±å†™çš„Javaæ–‡ä»¶ç¼–è¯‘æˆäº†.apkï¼Œä½†æ˜¯ä»–åˆ°åº•æ˜¯å¦‚ä½•å°†javaç¼–è¯‘æˆ.apkçš„å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¼•å…¥ä¸€å¼ Googleå®˜æ–¹çš„æµç¨‹å›¾ï¼š<br><img src="https://cdn.littlecorgi.top/mweb/2020-08-16/15975726163198.jpg" alt=""></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸€ä¸ªAPPç¼–è¯‘çš„å¤§è‡´æµç¨‹å°±æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>å…ˆå°†é¡¹ç›®çš„æºä»£ç ç¼–è¯‘æˆdexæ–‡ä»¶(Androidè™šæ‹Ÿæœºå¯è¯†åˆ«çš„å­—èŠ‚ç æ–‡ä»¶ï¼Œè‡³äºä¸ºå•¥ä¸æ˜¯.classï¼Œæœ€æ ¹æœ¬çš„åŸå› å°±æ˜¯Androidå¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨Javaçš„è™šæ‹Ÿæœºã€‚å¹¶ä¸”å•ä¸ªdexæ–‡ä»¶å¯è¢«å¼•ç”¨çš„æ–¹æ³•æ€»æ•°è¢«é™åˆ¶ä¸º65536ï¼Œå¦‚æœæˆ‘ä»¬çš„é¡¹ç›®è¿‡äºåºå¤§è¶…å‡ºè¿™ä¸ªé™åˆ¶æ—¶ï¼Œå¯èƒ½ä¼šè¢«æ‰“åŒ…æˆå¤šä¸ªdexæ–‡ä»¶)ï¼Œå…¶ä¸­è¿™ä¸ªæºä»£ç é™¤äº†æˆ‘ä»¬è‡ªå·±å†™çš„ä»£ç ä¹‹å¤–è¿˜åŒ…æ‹¬æˆ‘ä»¬å¯¼å…¥çš„ä¾èµ–åº“çš„ä»£ç ï¼›å¹¶å°†å…¶ä»–é™¤æºæ–‡ä»¶ä¹‹å¤–æ¯”å¦‚èµ„æºæ–‡ä»¶ç­‰ç­‰æ‰€æœ‰æ–‡ä»¶éƒ½è½¬æˆç¼–è¯‘çš„èµ„æºã€‚</li><li>APKæ‰“åŒ…å™¨å°†dexæ–‡ä»¶å’Œç¼–è¯‘çš„èµ„æºç»„åˆæˆå•ä¸ªAPKï¼Œä¸è¿‡å¿…é¡»å…ˆä¸ºAPKç­¾åæ‰èƒ½å°†æ‰“åŒ…çš„åº”ç”¨å®‰è£…åœ¨è®¾å¤‡ä¸Šã€‚</li><li>APKæ‰“åŒ…å™¨é€šè¿‡è°ƒè¯•æˆ–è€…å‘å¸ƒå¯†é’¥åº“ä¸ºAPKç­¾åï¼š<ol><li>å¦‚æœç¼–è¯‘çš„ç‰ˆæœ¬æ˜¯è°ƒè¯•ç‰ˆæœ¬ï¼Œæ‰“åŒ…å™¨ä¼šä½¿ç”¨è°ƒè¯•å¯†é’¥åº“ä¸ºåº”ç”¨ç­¾åã€‚AndroidStudioä¼šè‡ªåŠ¨ä½¿ç”¨è°ƒè¯•å¯†é’¥åº“é…ç½®æ–°é¡¹ç›®ã€‚</li><li>å¦‚æœç¼–è¯‘çš„ç‰ˆæœ¬æ˜¯æœ€ç»ˆæ­£å¼å‘å¸ƒç‰ˆæœ¬ï¼Œåˆ™éœ€è¦ä½ è‡ªå·±æä¾›ç­¾åä¿¡æ¯ï¼Œç„¶åç”Ÿæˆå¯†é’¥ç”¨äºæ‰“åŒ…ã€‚</li></ol></li><li>ç”ŸæˆAPKä¹‹å‰ï¼ŒAndroidé¦–å…ˆä¼šä½¿ç”¨zipalignå·¥å…·å¯¹åº”ç”¨è¿›è¡Œä¼˜åŒ–ã€‚</li></ol><h1 id="è®¤è¯†Androidé¡¹ç›®ç»“æ„"><a href="#è®¤è¯†Androidé¡¹ç›®ç»“æ„" class="headerlink" title="è®¤è¯†Androidé¡¹ç›®ç»“æ„"></a>è®¤è¯†Androidé¡¹ç›®ç»“æ„</h1><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åœ¨æ–°å»ºAndroidé¡¹ç›®æ—¶ï¼ŒAndroidStudioä¼šé»˜è®¤ä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸‹æ–‡ä»¶ï¼š<br><img src="https://cdn.littlecorgi.top/mweb/2020-08-16/15975728777993.jpg" alt=""></p><p>å…¶ä¸­æœ€é¡¶å±‚æ˜¯Projectï¼Œè€ŒProjecté‡Œé¢å¯ä»¥æœ‰å¤šä¸ªmoduleï¼Œmoduleä¸‹é¢æœ‰sourceSetæ¥å­˜æ”¾æˆ‘ä»¬ç¼–å†™çš„ä»£ç ã€‚<br>è€Œæˆ‘ä»¬å¯¹ç¼–è¯‘å˜ä½“çš„æ“ä½œä¸»è¦å°±æ˜¯åœ¨moduleçš„build.gradleä¸­è¿›è¡Œç¼–è¾‘ã€‚</p><h1 id="é…ç½®ç‰ˆæœ¬ç±»å‹"><a href="#é…ç½®ç‰ˆæœ¬ç±»å‹" class="headerlink" title="é…ç½®ç‰ˆæœ¬ç±»å‹"></a>é…ç½®ç‰ˆæœ¬ç±»å‹</h1><p>å¦‚æœæˆ‘ä»¬çœ‹ä¸€ä¸ªAndroidStudioä¸ºæˆ‘ä»¬åˆ›å»ºçš„é»˜è®¤é¡¹ç›®çš„app moduleçš„build.gradleï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°AndroidStudioé»˜è®¤ä¸ºæˆ‘ä»¬åˆ›å»ºå¥½çš„ç‰ˆæœ¬ç±»å‹ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">buildTypes &#123;</span><br><span class="line">    release &#123;</span><br><span class="line">        minifyEnabled true</span><br><span class="line">        proguardFiles getDefaultProguardFile(&#x27;proguard-android-optimize.txt&#x27;), &#x27;proguard-rules.pro&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>åœ¨buildTypesè¿™ä¸ªå—ä¸­ï¼Œåˆä¸€ä¸ªç±»å‹ï¼šreleaseã€‚</p><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬é€šè¿‡build variantsè¿›è¡ŒæŸ¥çœ‹çš„è¯ï¼Œå´ä¼šå‘ç°æˆ‘ä»¬å½“å‰appè¿™ä¸ªmoduleå´åˆé»˜è®¤ä¸ºdebugè¿™ä¸ªç±»å‹ï¼Œè€Œå¦‚æœæˆ‘ä»¬æ‰“å¼€é€‰é¡¹æ¡†å´åˆæœ‰debugå’Œreleaseä¸¤ç§ç±»å‹ã€‚<br><img src="https://cdn.littlecorgi.top/blog/%E7%BC%96%E8%AF%91%E5%8F%98%E4%BD%931.png" alt=""></p><p>æˆ‘ä»¬æ˜æ˜æ²¡æœ‰é…ç½®è¿™ä¸ªdebugç±»å‹ï¼Œé‚£è¿™ä¸ºä»€ä¹ˆä¼šæœ‰debugç±»å‹ä¾›æˆ‘ä»¬é€‰æ‹©å‘¢ï¼Ÿ</p><p>è¿™æ˜¯å› ä¸ºAndroid Studioä¼šé»˜è®¤ä¸ºæˆ‘ä»¬çš„åº”ç”¨åˆ›å»ºä¸€ä¸ªdebugç±»å‹ï¼Œä»¥ä¾›æˆ‘ä»¬å¯ä»¥æ–¹ä¾¿çš„å¯¹æˆ‘ä»¬çš„appè¿›è¡Œå®‰è£…è°ƒè¯•ã€‚</p><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬éœ€è¦å¯¹debugç±»å‹è¿›è¡Œäº›è®¾ç½®çš„è¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨buildTypeä¸­æ·»åŠ debugé¡¹ï¼Œç„¶ååœ¨debugå—ä¸­è¿›è¡Œè®¾ç½®ã€‚æ¯”å¦‚æˆ‘ä»¬æƒ³è®©debugçš„åŒ…çš„åº”ç”¨ç¨‹åºIDåé¢æ·»åŠ ä¸€ä¸ªâ€debugâ€åç¼€ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">buildTypes &#123;</span><br><span class="line">    release &#123;</span><br><span class="line">        minifyEnabled true</span><br><span class="line">        proguardFiles getDefaultProguardFile(&#x27;proguard-android.txt&#x27;), &#x27;proguard-rules.pro&#x27;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    debug &#123;</span><br><span class="line">        applicationIdSuffix &quot;.debug&quot;</span><br><span class="line">        debuggable true</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™æ ·æˆ‘ä»¬å¦‚æœéœ€è¦ç”Ÿæˆdebugçš„åŒ…ï¼Œç”Ÿæˆçš„åŒ…çš„åº”ç”¨ç¨‹åºIDåé¢å°±ä¼šå¤šä¸€ä¸ª.debugçš„åç¼€ã€‚</p><p>é™¤äº†å¯ä»¥è®¾ç½®åº”ç”¨ç¨‹åºIDä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è®¾ç½®æ˜¯å¦ç”Ÿæˆå¯è°ƒå¼çš„apk(debugable)ã€æ˜¯å¦å¯ç”¨Mutli-Dexç­‰ç­‰(multiDexEnabled)ã€‚<br>å…·ä½“buildTypeså—ä¸­çš„å¯é…ç½®é¡¹ï¼Œå¯ä»¥çœ‹æ­¤å¤„-<a href="http://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.BuildType.html">http://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.BuildType.html</a></p><h1 id="é…ç½®äº§å“ç‰¹æ€§"><a href="#é…ç½®äº§å“ç‰¹æ€§" class="headerlink" title="é…ç½®äº§å“ç‰¹æ€§"></a>é…ç½®äº§å“ç‰¹æ€§</h1><p>åˆ›å»ºäº§å“ç‰¹æ€§å’Œé…ç½®ç‰ˆæœ¬ç±»å‹ç±»ä¼¼ï¼Œä¹Ÿæ˜¯åœ¨ç›¸åº”moduleçš„build.gradleä¸­è¿›è¡Œæ“ä½œã€‚</p><p>åŒºåˆ«å°±æ˜¯ï¼š</p><ol><li>ç‰ˆæœ¬ç±»å‹æ•…åæ€è®®å°±æ˜¯æ‰“åŒ…æˆä¸åŒçš„ç‰ˆæœ¬ä»¥ä¾›ä¸åŒç±»å‹è°ƒè¯•çš„éœ€æ±‚ï¼›è€Œäº§å“ç‰¹æ€§å°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥æ ¹æ®æˆ‘ä»¬åº”ç”¨ä¸šåŠ¡ä¸Šçš„éœ€æ±‚å°†åŒä¸€ä¸ªé¡¹ç›®æ‰“åŒ…æˆä¸åŒçš„äº§å“ï¼Œæ¯”æ–¹è¯´å…è´¹ç‰ˆå’Œä»˜è´¹ç‰ˆã€æ™®é€šç‰ˆå’Œliteç‰ˆã€å›½å†…ç‰ˆå’Œæµ·å¤–ç‰ˆç­‰ç­‰ã€‚</li><li>ç‰ˆæœ¬ç±»å‹æ˜¯åœ¨android - buildTypesä¸­è¿›è¡Œé…ç½®ï¼Œä¸»è¦æ˜¯å¯¹ä»£ç ç¼–è¯‘æ—¶çš„å¤„ç†æˆ–è€…ä¼˜åŒ–è¿›è¡Œé…ç½®ï¼›è€Œäº§å“ç‰¹æ€§æ˜¯åœ¨andorid - productFlaborsä¸­è¿›è¡Œé…ç½®ï¼Œä¸»è¦æ˜¯ç”¨äºæŒ‡å‡ºæˆ‘ä»¬çš„æ•´ä¸ªé¡¹ç›®å¯ä»¥åˆ†æˆå“ªå‡ ä¸ªå­é¡¹ç›®ï¼Œå¹¶ä¸”å¯¹åº”çš„å­é¡¹ç›®çš„ç‰¹æœ‰çš„ä»£ç è¯¥å†™åœ¨å“ªä¸ªæºé›†ä¸­ã€‚</li></ol><p>é…ç½®äº§å“ç‰¹æ€§ä¸»è¦åˆ†ä¸¤æ­¥èµ°ï¼šflavorDimensions å’Œ productFlavorsã€‚</p><h2 id="flavorDimensions"><a href="#flavorDimensions" class="headerlink" title="flavorDimensions"></a>flavorDimensions</h2><p>è¿™ä¸ªå±æ€§ä¸»è¦æ˜¯ç”¨æ¥è®¾å®šæœ‰å“ªå‡ ç§ç±»å‹ç»´åº¦ã€‚ä¹Ÿå°±æ˜¯è¯´ä»–æŒ‡å®šçš„ç»´åº¦ç”¨äºç»™ä¸‹é¢çš„å…·ä½“çš„äº§å“ç‰¹æ€§è¿›è¡Œå½’ç±»ã€‚<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flavorDimensions &quot;location&quot;, &quot;pay&quot;</span><br></pre></td></tr></table></figure><br>ä¸Šé¢æˆ‘å°±å®šä¹‰äº†ä¸¤ä¸ªç»´åº¦ï¼Œåˆ†åˆ«æ˜¯</p><ul><li>åŒºåˆ†APPæŠ•æ”¾åœ°åŒºçš„locationï¼ˆå¦‚æœåœ¨ä¸­å›½æŠ•æ”¾åˆ™æ˜¯CNç‰ˆï¼Œå¦‚æœç¾å›½æŠ•æ”¾åˆ™æ˜¯USï¼Œæ—¥æœ¬æŠ•æ”¾åˆ™æ˜¯JPç­‰ç­‰ï¼‰</li><li>åŒºåˆ†ç”¨æˆ·æ˜¯å¦éœ€è¦ä»˜è´¹ä½¿ç”¨çš„payï¼ˆåŸºç¡€ç‰ˆä¹Ÿå°±æ˜¯éä»˜è´¹ç‰ˆstandå’Œå¤šåŠŸèƒ½ç‰ˆä¹Ÿå°±æ˜¯ä»˜è´¹ç‰ˆproï¼‰</li></ul><h2 id="productFlavors"><a href="#productFlavors" class="headerlink" title="productFlavors"></a>productFlavors</h2><p>å®šä¹‰å¥½äº†ç±»å‹ç»´åº¦flavorDimensionsï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°±å¯ä»¥å»å®šä¹‰ä¼°è®¡çš„äº§å“ç±»å‹äº†ã€‚</p><p>åŸºäºæˆ‘ä»¬ä¸Šé¢å®šä¹‰çš„flavorDimensionsã€‚<br>æˆ‘ä»¬é¦–å…ˆéœ€è¦locationå¯¹ç”¨çš„ç±»å‹ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">flavorDimensions &quot;location&quot;, &quot;pay&quot;</span><br><span class="line"></span><br><span class="line">productFlavors &#123;</span><br><span class="line">    CN &#123;</span><br><span class="line">        dimension &quot;location&quot;</span><br><span class="line">        resConfigs &quot;zh&quot;  //è®©è¯¥ç‰ˆæœ¬çš„è¯­è¨€åªæ”¯æŒä¸­æ–‡</span><br><span class="line">    &#125;</span><br><span class="line">    US &#123;</span><br><span class="line">        dimension &quot;location&quot;</span><br><span class="line">        resConfigs &quot;en&quot;  //è®©è¯¥ç‰ˆæœ¬çš„è¯­è¨€åªæ”¯æŒè‹±æ–‡</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><br>è¿™æ ·æˆ‘ä»¬å°±å·²ç»å®šä¹‰äº†ä¸¤ä¸ªå±äºlocationç»´åº¦çš„ç±»å‹ï¼Œå…¶ä¸­CNè®¾å®šä¸ºåªæ”¯æŒä¸­æ–‡ï¼ŒUSè®¾å®šä¸ºåªæ”¯æŒè‹±æ–‡ã€‚è¿™ä¸ªæ—¶å€™åœ¨Syncä¸€ä¸‹ï¼Œå†æ‰“å¼€Build Variantsï¼Œå°±èƒ½çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š<br><img src="https://cdn.littlecorgi.top/blog/%E7%BC%96%E8%AF%91%E5%8F%98%E4%BD%932.png" alt=""></p><p>åˆ†åˆ«å¯¹åº”ç€æˆ‘ä»¬åˆšåˆšå®šä¹‰å¥½çš„äº§å“ç‰¹æ€§å’Œç‰ˆæœ¬ç±»å‹ï¼Œå¯¹æ¯ä¸ªäº§å“ç‰¹æ€§ï¼Œéƒ½æœ‰æ¯ä¸ªç±»å‹çš„ç‰ˆæœ¬ç±»å‹ã€‚</p><p>ç„¶åæˆ‘ä»¬å†å¯¹payè¿›è¡Œé…ç½®ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    compileSdkVersion 29</span><br><span class="line">    buildToolsVersion &quot;29.0.2&quot;</span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        //...çœç•¥</span><br><span class="line">    &#125;</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        //...çœç•¥</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    flavorDimensions &quot;location&quot;, &quot;pay&quot;</span><br><span class="line">    productFlavors &#123;</span><br><span class="line">        CN &#123;</span><br><span class="line">            dimension &quot;location&quot;</span><br><span class="line">            resConfigs &quot;zh&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        US &#123;</span><br><span class="line">            dimension &quot;location&quot;</span><br><span class="line">            resConfigs &quot;en&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        free &#123;</span><br><span class="line">            dimension &quot;pay&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        pro &#123;</span><br><span class="line">            dimension &quot;pay&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åœ¨ä¹‹å‰çš„åŸºç¡€ä¸Šï¼Œåˆæ–°å®šä¹‰äº†ä¸¤ä¸ªäº§å“ç±»å‹freeå’Œproï¼Œä»–ä¸¤å±äºpayè¿™ä¸ªç±»å‹ç»´åº¦ã€‚å…·ä½“çš„åŒºåˆ«æˆ‘ä»¬å¯ä»¥åœ¨ä»£ç ä¸­å»ä½“ç°ã€‚è€è§„çŸ©ï¼ŒSyncä¹‹åçœ‹build variantsï¼š<br><img src="https://cdn.littlecorgi.top/blog/%E7%BC%96%E8%AF%91%E5%8F%98%E4%BD%933.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°ï¼Œç°åœ¨æˆ‘ä»¬çš„é¡¹ç›®æœ‰8ä¸ªbuildç±»å‹ã€‚<br>ä¹Ÿå°±æ˜¯æˆ‘ä»¬è®¾å®šçš„buildTypeså’ŒproductFlavorsæ’åˆ—ç»„åˆç»„æˆçš„ã€‚</p><p>é‚£è¿™æ—¶å¯èƒ½ä¼šæœ‰ä¸ªå°é—®é¢˜ï¼Œä¸ºä»€ä¹ˆæ˜¯CNFreeDebugè€Œä¸æ˜¯FreeCNDebugæˆ–è€…DebugCNFreeå‘¢ï¼Ÿ</p><p>è¿™å—å°±æ¶‰åŠåˆ°ä¸€ä¸ªä¼˜å…ˆçº§çš„é—®é¢˜ã€‚å½“gradleä¸ºæ¯ä¸ªç¼–è¯‘å˜ä½“æˆ–ç›¸åº”çš„APKå‘½åæ—¶ï¼Œå±äºè¾ƒé«˜ä¼˜å…ˆçº§ç±»å‹ç»´åº¦çš„äº§å“ç‰¹æ€§ä¼šä¼˜å…ˆå±•ç¤ºï¼Œç„¶åå†æ˜¯è¾ƒä½çš„äº§å“ç‰¹æ€§ï¼Œæœ€åæ‰æ˜¯ç‰ˆæœ¬ç±»å‹ã€‚æ‰€ä»¥è¯´ï¼Œåœ¨flavorDimensionså®šä¹‰æ—¶ï¼Œlocationå®šä¹‰åœ¨payçš„å‰é¢ï¼Œæ‰€ä»¥CNå’ŒUSè‚¯å®šåœ¨freeå’Œproçš„å‰é¢ã€‚è€Œç‰ˆæœ¬ç±»å‹åœ¨æœ€åé¢ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨buildTypesä¸­å®šä¹‰çš„debugå’Œreleaseåœ¨æœ€åé¢ã€‚</p><p>æ‰€ä»¥ä»¥ä¸Šé¢çš„é…ç½®ä¸ºä¾‹ï¼Œæˆ‘ä»¬æ€»å…±æœ‰8ä¸ªç¼–è¯‘å˜ä½“:<br>ç¼–è¯‘å˜ä½“ï¼š[CN, US][free, pay][debug, release]</p><p>ä¾‹å¦‚ï¼š</p><ul><li>ç¼–è¯‘å˜ä½“ï¼šCN free debug</li><li>Apkï¼šapp-cn-free-debug.apk</li></ul><h2 id="variantFilter"><a href="#variantFilter" class="headerlink" title="variantFilter"></a>variantFilter</h2><p>æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šä¸éœ€è¦æŸäº›ç¼–è¯‘å˜ä½“ï¼Œè¿™ä¸ªæ—¶å€™variantFilterå°±å¾—æ´¾ä¸Šç”¨åœºäº†ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä»–çš„å®šä¹‰æ–¹æ³•ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  variantFilter &#123; variant -&gt;</span><br><span class="line">      def names = variant.flavors*.name</span><br><span class="line">      // To check for a certain build type, use variant.buildType.name == &quot;&lt;buildType&gt;&quot;</span><br><span class="line">      if (names.contains(&quot;US&quot;) &amp;&amp; names.contains(&quot;free&quot;)) &#123;</span><br><span class="line">          // Gradle ignores any variants that satisfy the conditions above.</span><br><span class="line">          setIgnore(true)</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä»¥ä¸Šæ˜¯Googleå®˜æ–¹ç»™çš„ä¾‹å­ï¼Œæˆ‘å°±æŠŠäº§å“ç‰¹æ€§åæ›´æ”¹äº†ä¸‹ï¼Œç®€å•æ¥è¯´å°±æ˜¯å½“USå’Œfreeç»„åˆåœ¨ä¸€èµ·æ—¶ï¼Œå°±å¿½ç•¥æ­¤ç¼–è¯‘å˜ä½“ã€‚</p><h1 id="æºé›†"><a href="#æºé›†" class="headerlink" title="æºé›†"></a>æºé›†</h1><p>Android Studio æŒ‰é€»è¾‘å…³ç³»å°†æ¯ä¸ªæ¨¡å—çš„æºä»£ç å’Œèµ„æºåˆ†ç»„ä¸ºæºé›†ã€‚æ¨¡å—çš„ main/ æºé›†åŒ…å«å…¶æ‰€æœ‰ç¼–è¯‘å˜ä½“å…±ç”¨çš„ä»£ç å’Œèµ„æºã€‚å…¶ä»–æºé›†ç›®å½•æ˜¯å¯é€‰çš„ï¼Œåœ¨æ‚¨é…ç½®æ–°çš„ç¼–è¯‘å˜ä½“æ—¶ï¼ŒAndroid Studio ä¸ä¼šè‡ªåŠ¨ä¸ºæ‚¨åˆ›å»ºè¿™äº›ç›®å½•ã€‚ä¸è¿‡ï¼Œåˆ›å»ºç±»ä¼¼äº main/ çš„æºé›†æœ‰åŠ©äºè®© Gradle åªæœ‰åœ¨ç¼–è¯‘ç‰¹å®šåº”ç”¨ç‰ˆæœ¬æ—¶æ‰åº”ä½¿ç”¨çš„æ–‡ä»¶å’Œèµ„æºäº•ç„¶æœ‰åºï¼š</p><ul><li>/src/mainï¼šæ‰€æœ‰çš„ç¼–è¯‘å˜ä½“éƒ½ä¼šä½¿ç”¨æ­¤æºé›†</li><li>/src/buildTypeï¼šæ­¤æºé›†ç”¨äºç¼–å†™ç‰¹å®šç‰ˆæœ¬çš„ä¸“ç”¨ä»£ç å’Œèµ„æº</li><li>/src/productFlavorï¼šæ­¤æºé›†ç”¨äºç¼–å†™ç‰¹å®šç¼–è¯‘ç±»å‹ä¸“ç”¨çš„ä»£ç å’Œèµ„æº</li><li>/src/productFlavorBuildTypeï¼šæ­¤æºé›†ç”¨äºç¼–å†™ç‰¹å®šç¼–è¯‘å˜ä½“ç‰¹å®šçš„ä»£ç å’Œèµ„æº</li></ul><p>ä¾‹å¦‚ï¼š<br>ç¼–è¯‘å˜ä½“CNProReleaseéœ€è¦åˆå¹¶æ¥è‡ªä¸€ä¸‹æºé›†çš„ä»£ç å’Œèµ„æºï¼š</p><ul><li>/src/cnProRelease</li><li>/src/release</li><li>/src/pro</li><li>/src/cn</li><li>/src/main</li><li>ä¾èµ–åº“<br>å¹¶ä¸”æºé›†é—´çš„ä¼˜å…ˆçº§å°±æŒ‰ä»ä¸Šåˆ°ä¸‹çš„é¡ºåºæ’åºï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒcnProReleaseçš„ä¼˜å…ˆçº§æ˜¯æœ€é«˜çš„ï¼Œå…¶æ¬¡æ˜¯releaseï¼Œå…¶æ¬¡å†æ˜¯äº§å“ç‰¹æ€§ï¼Œæœ€åæ‰æ˜¯mainå’Œä¾èµ–åº“ã€‚æ‰€ä»¥è¯´ï¼Œå¦‚æœè¿™å‡ ä¸ªæºé›†ä¸­æœ‰ç›¸åŒçš„å˜é‡æˆ–è€…èµ„æºï¼Œåˆ™ä»¥ä¼˜å…ˆçº§é«˜çš„æºé›†ä¸­çš„ä¸ºä¸»ã€‚</li></ul><p>ç¼–è¯‘å˜ä½“ &gt; ç¼–è¯‘ç‰ˆæœ¬ç±»å‹ &gt; æ­£å¼ç‰ˆç±»å‹ &gt; ä¸»æºé›† &gt; åº“ä¾èµ–é¡¹</p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Android/">Android</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E7%BC%96%E8%AF%91/">ç¼–è¯‘</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E7%BC%96%E8%AF%91%E5%8F%98%E4%BD%93/">ç¼–è¯‘å˜ä½“</category>
      
      
      <comments>https://www.littlecorgi.top/posts/9900843a.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Javaé”æœºåˆ¶</title>
      <link>https://www.littlecorgi.top/posts/d88880aa.html</link>
      <guid>https://www.littlecorgi.top/posts/d88880aa.html</guid>
      <pubDate>Thu, 28 Nov 2019 14:35:04 GMT</pubDate>
      
        
        
          
          
      <description></description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="æ‚²è§‚é”å’Œä¹è§‚é”"><a href="#æ‚²è§‚é”å’Œä¹è§‚é”" class="headerlink" title="æ‚²è§‚é”å’Œä¹è§‚é”"></a>æ‚²è§‚é”å’Œä¹è§‚é”</h1><p>ä¹è§‚é”å’Œæ‚²è§‚é”éƒ½æ˜¯ä¸€ç§å¹¿ä¹‰ä¸Šçš„æ¦‚å¿µã€‚</p><p>å¯¹äºåŒä¸€ä¸ªæ•°æ®çš„å¹¶å‘æ“ä½œï¼Œæ‚²è§‚é”ç¡®å®å¾ˆæ‚²è§‚ï¼Œå®ƒæ—¶æ—¶åˆ»åˆ»éƒ½éå¸¸æ‹…å¿ƒè‡ªå·±åœ¨è¯»å–æˆ–è€…å†™å…¥æ•°æ®çš„æ—¶å€™æœ‰å…¶ä»–çº¿ç¨‹æ¥ä¿®æ”¹æ•°æ®ï¼Œæ‰€ä»¥ä¸ºäº†å®‰å¿ƒï¼Œä»–ä¸€èˆ¬å°±ç›´æ¥ä»è¯»å–æ•°æ®çš„æ—¶å€™å°±åŠ é”ï¼Œç¡®ä¿è‡ªå·±æ“ä½œçš„æ—¶å€™ä¸ä¼šè¢«å…¶å®ƒçº¿ç¨‹æ‰“æ‰°ã€‚æœ€å…¸å‹çš„æ‚²è§‚é”å°±æ˜¯synchronizedå’ŒLockã€‚</p><p>è€Œä¹è§‚é”ç¡®å®å¾ˆä¹è§‚ï¼Œå®ƒè®¤ä¸ºè‡ªå·±åœ¨æ“ä½œæ•°æ®çš„æ—¶å€™æ˜¯ä¸ä¼šæœ‰å…¶ä»–çº¿ç¨‹æ¥ä¿®æ”¹æ•°æ®çš„ï¼Œæ‰€ä»¥ä¸æ¯«ä¸æ‹…å¿ƒï¼Œå®Œå…¨ä¸ä¼šæ·»åŠ é”ã€‚åªæ˜¯åœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™åˆ¤æ–­æœ‰æ²¡æœ‰å…¶ä»–çº¿ç¨‹æ›´æ”¹äº†æ•°æ®ï¼Œå¦‚æœè¿™ä¸ªæ•°æ®æ²¡æœ‰è¢«æ›´æ–°ï¼Œå½“å‰çº¿ç¨‹å†æŠŠè‡ªå·±çš„æ•°æ®å†™å…¥ï¼›å¦‚æœæ•°æ®å·²ç»æ›´æ–°ï¼Œåˆ™æ ¹æ®ä¸é€šè¿‡çš„å®ç°æ–¹å¼æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚</p><p>çœ‹åˆ°è¿™ï¼Œå¤§å®¶å°±æ‡‚äº†ï¼Œä¹è§‚é”ä¸å°±æ˜¯ç¼“å­˜ä¸€è‡´æ€§ä»¥åŠCASç®—æ³•å˜›ã€‚</p><p>é‚£ä»€ä¹ˆæ˜¯CASç®—æ³•å‘¢ï¼Ÿ</p><p>CASï¼Œæ¯”è¾ƒä¸äº¤æ¢ï¼Œä¸€ä¸­è‘—åçš„æ— æ‰€ç®—æ³•ã€‚CASçš„ä¸»è¦å°±è®¾è®¡åˆ°ä¸‰ä¸ªå€¼ï¼š</p><ul><li>éœ€è¦è¯»å†™çš„å†…å­˜å€¼V</li><li>è¿›è¡Œæ¯”è¾ƒçš„å€¼A</li><li>è¦å†™å…¥çš„æ–°å€¼B</li></ul><p>å½“ä¸”ä»…å½“Vçš„å€¼ç­‰äºAæ—¶ï¼ŒCASé€šè¿‡åŸå­æ“ä½œå»ç”¨æ–°å€¼Bæ¥æ›´æ–°Vçš„å€¼ï¼Œå¦åˆ™ä¸ä¼šæ‰§è¡Œæ“ä½œã€‚</p><p>ä½†æ˜¯CASä¹Ÿæœ‰ç¼ºç‚¹ï¼š</p><ul><li>å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§ï¼šå¦‚æœä¸€ä¸ªçº¿ç¨‹å·²çŸ¥éƒ½å‘ç°è‡ªå·±çš„å€¼éƒ½ä¸æ˜¯Aï¼Œé‚£ä¹ˆä»–ä¼šå·²çŸ¥è‡ªæ—‹</li><li>åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ</li><li>ABAé—®é¢˜<ul><li>å¦‚æœä¸€ä¸ªçº¿ç¨‹å°†æ•°æ®ä»Aæ”¹æˆäº†Båˆæ”¹æˆäº†Aï¼Œè¿™æ ·è™½ç„¶å¦ä¸€ä¸ªçº¿ç¨‹é€šè¿‡CASå»æ›´æ”¹æ•°æ®çš„æ—¶å€™ï¼Œä»–å°±åªèƒ½å‘ç°å˜é‡å€¼è¿˜æ˜¯Aæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå°±æ–­å®šè¿™ä¸ªæ•°æ®æ²¡æœ‰å…¶ä»–çº¿ç¨‹æ›´æ–°è¿‡ã€‚</li></ul></li></ul><h1 id="è‡ªæ—‹é”å’Œé€‚åº”æ€§è‡ªæ—‹é”"><a href="#è‡ªæ—‹é”å’Œé€‚åº”æ€§è‡ªæ—‹é”" class="headerlink" title="è‡ªæ—‹é”å’Œé€‚åº”æ€§è‡ªæ—‹é”"></a>è‡ªæ—‹é”å’Œé€‚åº”æ€§è‡ªæ—‹é”</h1><p>åœ¨è¯´è‡ªæ—‹é”ä¹‹å‰æˆ‘ä»¬é¦–å…ˆæ¥æƒ³ä¸€ä¸ªåœºæ™¯ï¼š<br>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹éœ€è¦è¯·æ±‚åŒä¸€ä¸ªèµ„æºï¼Œå…¶ä¸­ä¸€ä¸ªçº¿ç¨‹å…ˆäºå¦ä¸€ä¸ªçº¿ç¨‹å¾—åˆ°èµ„æºï¼Œé‚£ä¹ˆå¦ä¸€ä¸ªçº¿ç¨‹å°±ä¼šé˜»å¡ï¼Œç­‰åˆ°å ç”¨èµ„æºçº¿ç¨‹æ‰§è¡Œå®Œæ¯•é‡Šæ”¾èµ„æºå¹¶ä¸”CPUæ­£åœ¨è¿è¡Œçš„è¿™ä¸ªçº¿ç¨‹è¿è¡Œå®Œæ¯•åé‡æ–°æŠŠå®ƒè°ƒç”¨ä¸Šæ¥ï¼Œè¿™æ—¶ä»–æ‰ä¼šå»æ‰§è¡Œã€‚</p><p>ä¸€èˆ¬å’±ä»¬éƒ½ä¼šé€šè¿‡è¿™ç§æ–¹å¼å»è¾¾åˆ°é«˜æ•ˆçš„å¤šçº¿ç¨‹ã€‚ä½†æ˜¯å¦‚æœä½ çº¿ç¨‹æ‰§è¡Œçš„ä»£ç å¾ˆçŸ­ï¼Œç”šè‡³éœ€è¦æ‰§è¡Œçš„æ—¶é—´æ¯”ä½ CPUè°ƒåº¦çº¿ç¨‹æ‰€éœ€çš„æ—¶é—´éƒ½è¦çŸ­ï¼Œé‚£ä¹ˆè¿™æ ·ä¸€ç›´é•¿æ—¶é—´åˆ‡æ¢çŸ­æ—¶é—´æ‰§è¡Œæ˜¯ä¸æ˜¯å¾ˆä¸åˆ’ç®—ã€‚</p><p>ä½†æ˜¯ç°åœ¨ç”µè„‘åŸºæœ¬ä¸Šéƒ½æ˜¯å¤šæ ¸CPUï¼ŒåŒä¸€æ—¶é—´å„ä¸ªCPUéƒ½å¯ä»¥å¤„ç†å„è‡ªçš„ä¸€ä¸ªçº¿ç¨‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®©åé¢é‚£ä¸ªçº¿ç¨‹å…ˆä¸æ”¾å¼ƒCPUçš„æ‰§è¡Œæ—¶é—´ï¼Œçœ‹çœ‹æŒæœ‰èµ„æºçš„çº¿ç¨‹æ˜¯å¦èƒ½å¾ˆå¿«å°±é‡Šæ”¾ã€‚</p><p>ä¸ºäº†è®©å½“å‰çº¿ç¨‹ç¨ç­‰ä¸€ä¸‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»™ä»–åŠ ä¸ªè‡ªæ—‹é”ï¼Œè®©ä»–è‡ªæ—‹ï¼Œå¦‚æœè‡ªæ—‹å®Œæˆæ—¶å‰é¢é”å®šäº†èµ„æºçš„çº¿ç¨‹é‡Šæ”¾äº†é”ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹å°±å¯ä»¥ä¸é¿é˜»å¡è€Œæ˜¯ç›´æ¥è·å–èµ„æºï¼Œé¿å…åˆ‡æ¢çº¿ç¨‹çš„å¼€é”€ï¼Œè¿™å°±æ˜¯è‡ªæ—‹é”ã€‚</p><p><img src="https://cdn.littlecorgi.top/mweb/2019-11-28/15748583404329.jpg" alt=""></p><p>ä½†æ˜¯è‡ªæ—‹é”ä¹Ÿæœ‰ç¼ºç‚¹ï¼Œè€Œä¸”ç¼ºç‚¹å¾ˆæ˜æ˜¾ï¼šå¦‚æœå‰é¢é‚£ä¸ªå ç”¨èµ„æºçš„çº¿ç¨‹éœ€è¦æ‰§è¡Œçš„æ—¶é—´å¾ˆé•¿ï¼Œé‚£ä¹ˆè¿™ä¸ªè‡ªæ—‹çš„çº¿ç¨‹å°±ä¼šä¸€ç›´å ç€CPUï¼ŒCPUå°±ä¸èƒ½å»æ‰§è¡Œå…¶ä»–çº¿ç¨‹ï¼Œè¿™æ ·ä¸å°½æ•ˆç‡æ²¡æä¸Šå»ï¼Œåè€Œè¿˜ä¸‹é™äº†ã€‚</p><p>æ‰€ä»¥è‡ªæ—‹é”ä¸€å®šå¾—æœ‰é™åˆ¶ï¼Œå¦‚æœè‡ªæ—‹çš„æ¬¡æ•°è¶…è¿‡äº†ä¸€å®šçš„æ¬¡æ•°ï¼Œå°±ä¼šè®©ä»–å–æ¶ˆè‡ªæ—‹ï¼ŒæŒ‚èµ·çº¿ç¨‹ã€‚</p><p>å½“ç„¶äº†ï¼Œæ—¢ç„¶æœ‰é™æ€çš„è®¾ç½®æ­»çš„é™åˆ¶æ¬¡æ•°ï¼Œè‚¯å®šå°±æœ‰åŠ¨æ€çš„è®¾å®šçµæ´»çš„é™åˆ¶æ¬¡æ•°ã€‚æ—‹ç­‰å¾…åˆšåˆšæˆåŠŸè·å¾—è¿‡é”ï¼Œå¹¶ä¸”æŒæœ‰é”çš„çº¿ç¨‹æ­£åœ¨è¿è¡Œä¸­ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºå°±ä¼šè®¤ä¸ºè¿™æ¬¡è‡ªæ—‹ä¹Ÿæ˜¯å¾ˆæœ‰å¯èƒ½å†æ¬¡æˆåŠŸï¼Œè¿›è€Œå®ƒå°†å…è®¸è‡ªæ—‹ç­‰å¾…æŒç»­ç›¸å¯¹æ›´é•¿çš„æ—¶é—´ã€‚å¦‚æœå¯¹äºæŸä¸ªé”ï¼Œè‡ªæ—‹å¾ˆå°‘æˆåŠŸè·å¾—è¿‡ï¼Œé‚£åœ¨ä»¥åå°è¯•è·å–è¿™ä¸ªé”æ—¶å°†å¯èƒ½çœç•¥æ‰è‡ªæ—‹è¿‡ç¨‹ï¼Œç›´æ¥é˜»å¡çº¿ç¨‹ï¼Œé¿å…æµªè´¹å¤„ç†å™¨èµ„æºã€‚</p><h1 id="æ— é”ã€åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”"><a href="#æ— é”ã€åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”" class="headerlink" title="æ— é”ã€åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”"></a>æ— é”ã€åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”</h1><p>å…¶å®è¿™å‡ ä¸ªé”éƒ½æ˜¯å¯¹äºsynchronizedæ¥è¯´çš„ã€‚å†è¯´è¿™ä¸ªä¹‹å‰ï¼Œæˆ‘ä»¬å‰æ¥äº†è§£å‡ ä¸ªæ¦‚å¿µï¼š</p><ul><li>Javaå¯¹è±¡å¤´ï¼šä»¥HotSpotä¸ºä¾‹ï¼Œå¯¹è±¡å¤´åˆ†ä¸ºä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼šMark Wordå’Œç±»å‹æŒ‡é’ˆ<ul><li>Mark Wordï¼šè¿™å—ä¸»è¦ç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«è¿è¡Œæ—¶çš„æ•°æ®ï¼Œå¦‚å“ˆå¸Œç ã€GCåˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ã€çº¿ç¨‹æŒæœ‰çš„é”ç­‰ä¿¡æ¯ã€‚ç”±äºè¿™äº›ä¿¡æ¯éƒ½æ˜¯ä¸å¯¹è±¡è‡ªèº«å®šä¹‰çš„æ•°æ®æ— å…³ï¼Œæ‰€ä»¥è€ƒè™‘åˆ°è™šæ‹Ÿæœºç©ºé—´æ•ˆç‡ï¼ŒMark Wordè¢«è®¾è®¡æˆä¸€ä¸ªéå›ºå®šçš„æ•°æ®ç»“æ„ä»¥ä¾¿åœ¨ç»©æ•ˆçš„ç©ºé—´å†…å­˜å‚¨å°½é‡å¤šçš„ä¿¡æ¯ï¼Œå®ƒä¼šæ ¹æ®å¯¹è±¡çš„çŠ¶æ€å¤ç”¨è‡ªå·±çš„ç©ºé—´ã€‚</li><li>ç±»å‹æŒ‡é’ˆï¼šå³å¯¹è±¡æŒ‡å‘å®ƒçš„ç±»å…ƒæ•°æ®çš„æŒ‡é’ˆï¼Œè™šæ‹Ÿæœºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ¥ç¡®å®šè¿™æ˜¯å“ªä¸ªç±»çš„å¯¹è±¡ã€‚</li></ul></li><li>Monitorï¼šå¦‚æœçœ‹è¿‡æ“ä½œç³»ç»Ÿä¸€å®šä¸ä¼šé™Œç”Ÿï¼Œè¿™ä¸ªå•è¯ç¿»è¯‘è¿‡æ¥å°±æ˜¯å¤§åé¼é¼çš„ç®¡ç¨‹ã€‚Javaä¸ºäº†ä¿éšœçº¿ç¨‹çš„å®‰å…¨æ€§ï¼Œå°±æä¾›äº†åŒæ­¥æœºåˆ¶ã€äº’æ–¥é”æœºåˆ¶ã€‚è€Œè¿™ä¸ªæœºåˆ¶çš„ä¿éšœå°±æ¥è‡ªäºç›‘è§†é”Monitorï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æ‹¥æœ‰è‡ªå·±çš„ç›‘è§†é”ã€‚ä»–çš„ä¹‰åŠ¡å°±æ˜¯æ§åˆ¶æ‰€æœ‰éœ€è¦è®¿é—®æŸä¸ªæ•°æ®çš„çº¿ç¨‹ï¼Œé€šè¿‡è°ƒåº¦ä»–ä»¬ä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è®¿é—®å—ä¿æŠ¤çš„æ•°æ®å’Œä»£ç ã€‚</li></ul><p>ç°åœ¨å›åˆ°synchronizedï¼Œsynchronizedé€šè¿‡Monitoræ¥å®ç°çº¿ç¨‹åŒæ­¥ï¼Œè€ŒMonitoråˆ™æ˜¯ä¾èµ–äºåº•å±‚çš„æ“ä½œç³»ç»Ÿçš„MutexLockäº’æ–¥é”æ¥å®ç°çš„ã€‚</p><p>æˆ‘ä»¬åœ¨è‡ªæ—‹é”ä¸­æåˆ°ï¼Œé˜»å¡æˆ–å”¤é†’ä¸€ä¸ªçº¿ç¨‹éœ€è¦æ“ä½œç³»ç»Ÿåˆ‡æ¢CPUæ¥å®Œæˆï¼Œè¿™ç§çŠ¶æ€çš„è½¬æ¢éœ€è¦è€—è´¹å¤§é‡çš„æ—¶é—´ï¼Œå¦‚æœæ­¤æ—¶åŠ é”çš„ä»£ç è¿‡ä¸ç®€å•ï¼Œæ‰§è¡Œæ—¶é—´å°±å¯èƒ½æ¯”åˆ‡æ¢æ—¶é—´è¿˜è¦çŸ­ã€‚è¿™ç§å°±æ˜¯JDK1.6ä¹‹å‰çš„synchronizedå®ç°æ–¹å¼ï¼Œè¿™ç§é”æˆ‘ä»¬ç§°ä¸ºé‡é‡çº§é”ã€‚è€Œä¸ºäº†å‡å°‘åŠ é”å’Œé‡Šæ”¾é”æ‰€å¸¦æ¥çš„å¤§é‡èµ„æºçš„æ¶ˆè€—ï¼ŒJDK1.6ä¹‹åå¼•å…¥äº†åå‘é”å’Œè½»é‡çº§é”ã€‚</p><p>è¿™4ä¸­é”çº§åˆ«ç”±ä½åˆ°é«˜ä¾æ¬¡æ˜¯ï¼šæ— é” -&gt; åå‘é” -&gt; è½»é‡çº§é” -&gt; é‡é‡çº§é”<br>å¯ä»¥ç”±ä½çº§å‡ä¸ºé«˜çº§ï¼Œä½†æ˜¯ä¸èƒ½ç”±é«˜çº§é™ä¸ºä½çº§ã€‚</p><div class="table-container"><table><thead><tr><th style="text-align:center">é”çŠ¶æ€</th><th style="text-align:center">å­˜å‚¨çš„å†…å®¹</th><th style="text-align:center">å­˜å‚¨å†…å®¹</th></tr></thead><tbody><tr><td style="text-align:center">æ— é”</td><td style="text-align:center">å¯¹è±¡çš„hashCodeã€å¯¹è±¡åˆ†ä»£å¹´é¾„ã€æ˜¯å¦æ˜¯åå‘é”(0)</td><td style="text-align:center">01</td></tr><tr><td style="text-align:center">åå‘é”</td><td style="text-align:center">åå‘çº¿ç¨‹IDã€åå‘æ—¶é—´æˆ³ã€å¯¹è±¡åˆ†ä»£å¹´é¾„ã€æ˜¯å¦æ˜¯åå‘é”(1)</td><td style="text-align:center">01</td></tr><tr><td style="text-align:center">è½»é‡çº§é”</td><td style="text-align:center">æŒ‡å‘å ä¸­é”çºªå½•çš„æŒ‡é’ˆ</td><td style="text-align:center">00</td></tr><tr><td style="text-align:center">é‡é‡çº§é”</td><td style="text-align:center">æŒ‡å‘äº’æ–¥é‡çš„æŒ‡é’ˆ</td><td style="text-align:center">10</td></tr></tbody></table></div><h2 id="æ— é”"><a href="#æ— é”" class="headerlink" title="æ— é”"></a>æ— é”</h2><p>æ— é”é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ä¸åŠ é”ï¼Œä¸å¯¹èµ„æºè¿›è¡Œé”å®šï¼Œä»»ä½•çº¿ç¨‹éƒ½å¯ä»¥è®¿é—®å¹¶ä¿®æ”¹ï¼Œä½†æ˜¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½ä¿®æ”¹æˆåŠŸã€‚</p><p>å¦‚æœä¸€ä¸ªçº¿ç¨‹æƒ³è¦è®¿é—®è¯¥èµ„æºæ—¶ï¼Œå‘ç°è¯¥èµ„æºæ­£åœ¨è¢«è®¿é—®ï¼Œä»–å°±è¿›è¡Œç­‰å¾…ï¼Œç›´åˆ°èµ„æºæ²¡æœ‰è¢«è®¿é—®ã€‚è¿™å°±æ˜¯ä¸ªå¾ªç¯ï¼Œä¸€ç›´å¾ªç¯ï¼ŒçŸ¥é“èƒ½è®¿é—®èµ„æºã€‚è€Œå…¶ä»–ä¸èƒ½è®¿é—®çš„çº¿ç¨‹ä¹Ÿä¸€ç›´å¾ªç¯ï¼ŒçŸ¥é“èƒ½è®¿é—®ã€‚</p><p>CASå°±æ˜¯æ— é”ã€‚</p><h2 id="åå‘é”"><a href="#åå‘é”" class="headerlink" title="åå‘é”"></a>åå‘é”</h2><p>å¦‚æœä¸€æ®µåŒæ­¥ä»£ç ä¸€ç›´è¢«åŒä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±ä¼šè‡ªåŠ¨åŠ ä¸Šåå‘é”ã€‚</p><p>å› ä¸ºä¸€ç›´éƒ½è¢«åŒä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œæ‰€ä»¥ä»–ä¸éœ€è¦æ‹…å¿ƒæœ‰å…¶ä»–çº¿ç¨‹å’Œä»–ç«äº‰ï¼Œåˆç”±äºè¿™æ®µä»£ç åŠ äº†é”ï¼Œæ‰€ä»¥å°±ç»™ä»–åŠ ä¸Šåå‘é”ï¼Œé¿å…åŠ æ›´é‡é‡çº§çš„é”å¸¦æ¥çš„èµ„æºæ¶ˆè€—ï¼Œæé«˜æ•ˆç‡ã€‚</p><p>å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥ä»£ç å—å¹¶è·å–é”æ—¶ï¼Œä¼šåœ¨Mark Wordé‡Œå­˜å‚¨é”åå‘çš„çº¿ç¨‹IDã€‚åœ¨çº¿ç¨‹è¿›å…¥å’Œé€€å‡ºåŒæ­¥å—æ—¶ä¸å†é€šè¿‡CASæ“ä½œæ¥åŠ é”å’Œè§£é”ï¼Œè€Œæ˜¯æ£€æµ‹Mark Wordé‡Œæ˜¯å¦å­˜å‚¨ç€æŒ‡å‘å½“å‰çº¿ç¨‹çš„åå‘é”ã€‚å¼•å…¥åå‘é”æ˜¯ä¸ºäº†åœ¨æ— å¤šçº¿ç¨‹ç«äº‰çš„æƒ…å†µä¸‹å°½é‡å‡å°‘ä¸å¿…è¦çš„è½»é‡çº§é”æ‰§è¡Œè·¯å¾„ï¼Œå› ä¸ºè½»é‡çº§é”çš„è·å–åŠé‡Šæ”¾ä¾èµ–å¤šæ¬¡CASåŸå­æŒ‡ä»¤ï¼Œè€Œåå‘é”åªéœ€è¦åœ¨ç½®æ¢ThreadIDçš„æ—¶å€™ä¾èµ–ä¸€æ¬¡CASåŸå­æŒ‡ä»¤å³å¯ã€‚</p><p>åå‘é”åªæœ‰é‡åˆ°å…¶ä»–çº¿ç¨‹å°è¯•ç«äº‰åå‘é”æ—¶ï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹æ‰ä¼šé‡Šæ”¾é”ï¼Œçº¿ç¨‹ä¸ä¼šä¸»åŠ¨é‡Šæ”¾åå‘é”ã€‚åå‘é”çš„æ’¤é”€ï¼Œéœ€è¦ç­‰å¾…å…¨å±€å®‰å…¨ç‚¹ï¼ˆåœ¨è¿™ä¸ªæ—¶é—´ç‚¹ä¸Šæ²¡æœ‰å­—èŠ‚ç æ­£åœ¨æ‰§è¡Œï¼‰ï¼Œå®ƒä¼šé¦–å…ˆæš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼Œåˆ¤æ–­é”å¯¹è±¡æ˜¯å¦å¤„äºè¢«é”å®šçŠ¶æ€ã€‚æ’¤é”€åå‘é”åæ¢å¤åˆ°æ— é”ï¼ˆæ ‡å¿—ä½ä¸ºâ€œ01â€ï¼‰æˆ–è½»é‡çº§é”ï¼ˆæ ‡å¿—ä½ä¸ºâ€œ00â€ï¼‰çš„çŠ¶æ€ã€‚</p><h2 id="è½»é‡çº§é”"><a href="#è½»é‡çº§é”" class="headerlink" title="è½»é‡çº§é”"></a>è½»é‡çº§é”</h2><p>å½“é”æ˜¯åå‘é”ä½†æ˜¯è¢«å¦å¤–çº¿ç¨‹è®¿é—®çš„æ—¶å€™ï¼Œå°±ä¼šè‡ªåŠ¨å‡çº§æˆè½»é‡çº§é”ï¼Œè¿™æ—¶å…¶å®ƒçº¿ç¨‹ä¼šé€šè¿‡è‡ªæ—‹çš„æ–¹å¼æ¥å°è¯•è·å–é”ï¼Œä¸ä¼šé˜»å¡ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚</p><p>æŒ‡å½“é”æ˜¯åå‘é”çš„æ—¶å€™ï¼Œè¢«å¦å¤–çš„çº¿ç¨‹æ‰€è®¿é—®ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œå…¶ä»–çº¿ç¨‹ä¼šé€šè¿‡è‡ªæ—‹çš„å½¢å¼å°è¯•è·å–é”ï¼Œä¸ä¼šé˜»å¡ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚</p><p>åœ¨ä»£ç è¿›å…¥åŒæ­¥å—çš„æ—¶å€™ï¼Œå¦‚æœåŒæ­¥å¯¹è±¡é”çŠ¶æ€ä¸ºæ— é”çŠ¶æ€ï¼ˆé”æ ‡å¿—ä½ä¸ºâ€œ01â€çŠ¶æ€ï¼Œæ˜¯å¦ä¸ºåå‘é”ä¸ºâ€œ0â€ï¼‰ï¼Œè™šæ‹Ÿæœºé¦–å…ˆå°†åœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­å»ºç«‹ä¸€ä¸ªåä¸ºé”è®°å½•ï¼ˆLock Recordï¼‰çš„ç©ºé—´ï¼Œç”¨äºå­˜å‚¨é”å¯¹è±¡ç›®å‰çš„Mark Wordçš„æ‹·è´ï¼Œç„¶åæ‹·è´å¯¹è±¡å¤´ä¸­çš„Mark Wordå¤åˆ¶åˆ°é”è®°å½•ä¸­ã€‚</p><p>æ‹·è´æˆåŠŸåï¼Œè™šæ‹Ÿæœºå°†ä½¿ç”¨CASæ“ä½œå°è¯•å°†å¯¹è±¡çš„Mark Wordæ›´æ–°ä¸ºæŒ‡å‘Lock Recordçš„æŒ‡é’ˆï¼Œå¹¶å°†Lock Recordé‡Œçš„owneræŒ‡é’ˆæŒ‡å‘å¯¹è±¡çš„Mark Wordã€‚</p><p>å¦‚æœè¿™ä¸ªæ›´æ–°åŠ¨ä½œæˆåŠŸäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±æ‹¥æœ‰äº†è¯¥å¯¹è±¡çš„é”ï¼Œå¹¶ä¸”å¯¹è±¡Mark Wordçš„é”æ ‡å¿—ä½è®¾ç½®ä¸ºâ€œ00â€ï¼Œè¡¨ç¤ºæ­¤å¯¹è±¡å¤„äºè½»é‡çº§é”å®šçŠ¶æ€ã€‚</p><p>å¦‚æœè½»é‡çº§é”çš„æ›´æ–°æ“ä½œå¤±è´¥äº†ï¼Œè™šæ‹Ÿæœºé¦–å…ˆä¼šæ£€æŸ¥å¯¹è±¡çš„Mark Wordæ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹çš„æ ˆå¸§ï¼Œå¦‚æœæ˜¯å°±è¯´æ˜å½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰äº†è¿™ä¸ªå¯¹è±¡çš„é”ï¼Œé‚£å°±å¯ä»¥ç›´æ¥è¿›å…¥åŒæ­¥å—ç»§ç»­æ‰§è¡Œï¼Œå¦åˆ™è¯´æ˜å¤šä¸ªçº¿ç¨‹ç«äº‰é”ã€‚</p><p>è‹¥å½“å‰åªæœ‰ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ï¼Œåˆ™è¯¥çº¿ç¨‹é€šè¿‡è‡ªæ—‹è¿›è¡Œç­‰å¾…ã€‚ä½†æ˜¯å½“è‡ªæ—‹è¶…è¿‡ä¸€å®šçš„æ¬¡æ•°ï¼Œæˆ–è€…ä¸€ä¸ªçº¿ç¨‹åœ¨æŒæœ‰é”ï¼Œä¸€ä¸ªåœ¨è‡ªæ—‹ï¼Œåˆæœ‰ç¬¬ä¸‰ä¸ªæ¥è®¿æ—¶ï¼Œè½»é‡çº§é”å‡çº§ä¸ºé‡é‡çº§é”ã€‚</p><h2 id="é‡é‡çº§é”"><a href="#é‡é‡çº§é”" class="headerlink" title="é‡é‡çº§é”"></a>é‡é‡çº§é”</h2><p>å‡çº§ä¸ºé‡é‡çº§é”æ—¶ï¼Œé”æ ‡å¿—çš„çŠ¶æ€å€¼å˜ä¸ºâ€œ10â€ï¼Œæ­¤æ—¶Mark Wordä¸­å­˜å‚¨çš„æ˜¯æŒ‡å‘é‡é‡çº§é”çš„æŒ‡é’ˆï¼Œæ­¤æ—¶ç­‰å¾…é”çš„çº¿ç¨‹éƒ½ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ã€‚</p><h1 id="å…¬å¹³é”å’Œéå…¬å¹³é”"><a href="#å…¬å¹³é”å’Œéå…¬å¹³é”" class="headerlink" title="å…¬å¹³é”å’Œéå…¬å¹³é”"></a>å…¬å¹³é”å’Œéå…¬å¹³é”</h1><p>å…¬å¹³é”å°±æ˜¯å¾ˆå…¬å¹³ï¼ŒæŒ‰ç…§å¤šä¸ªçº¿ç¨‹çš„è¯·æ±‚é”çš„é¡ºåºä¾æ¬¡åŠ å…¥åˆ°è¯·æ±‚é˜Ÿåˆ—ä¸­ï¼Œä¾æ¬¡æ’é˜Ÿã€‚</p><p>è€Œéå…¬å¹³é”å°±æ˜¯æä¾›äº†ä¸€ä¸ªæ’é˜Ÿçš„æœºä¼šï¼Œå¦‚æœåœ¨ä¸€ä¸ªçº¿ç¨‹æƒ³è¦å»è¯·æ±‚é”çš„æ—¶å€™ï¼Œåˆšå¥½è¿™æ—¶å€™é”ä¹Ÿæ²¡æœ‰çº¿ç¨‹å ç”¨ï¼Œåˆšå¥½å¯ç”¨ï¼Œé‚£å°±ç›´æ¥ç»™è¿™ä¸ªçº¿ç¨‹å»ä½¿ç”¨ã€‚</p><p>å…¬å¹³é”çš„å¥½å¤„å°±æ˜¯ç­‰å¾…é”çš„çº¿ç¨‹ä¸ä¼šé¥¿æ­»ï¼Œéƒ½ä¼šæŒ‰ç…§é¡ºåºä¸€ä¸ªä¸ªè·å–é”ï¼›ä½†æ˜¯ç¼ºç‚¹å°±æ˜¯ååé‡è¾ƒéå…¬å¹³é”æ¥è¯´è¾ƒä½ï¼Œç­‰å¾…é˜Ÿåˆ—é™¤äº†ç¬¬ä¸€ä¸ªå¯ä»¥æ‹¿åˆ°é”ä¹‹å¤–å…¶ä»–éƒ½å¾—é˜»å¡ï¼Œç›´åˆ°ç¬¬ä¸€ä¸ªé‡Šæ”¾é”ï¼ŒCPUå”¤é†’é˜»å¡çº¿ç¨‹çš„å¼€é”€æ¯”éå…¬å¹³é”å¤§ã€‚</p><p>è€Œéå…¬å¹³é”çš„å¥½å¤„å°±æ˜¯ååé‡æ¯”å…¬å¹³é”å¤§ï¼Œæœ‰æ•ˆå‡å°‘å”¤èµ·çº¿ç¨‹çš„å¼€é”€ï¼ˆå› ä¸ºçº¿ç¨‹å¯ä»¥ç›´æ¥å¾—åˆ°é”ï¼Œä¸éœ€è¦å†åŠ å…¥åˆ°é˜Ÿåˆ—ï¼‰ï¼Œæ•´ä½“ååé‡é«˜ï¼›ä½†æ˜¯ç¼ºç‚¹æ˜¯å‡ºç°åç”³è¯·çš„é”åè€Œå…ˆæ‹¿åˆ°èµ„æºï¼Œè€Œä¸”å¯èƒ½ä¼šå¯¼è‡´ç­‰å¾…é˜Ÿåˆ—é‡Œé¢çš„çº¿ç¨‹ä¸€ç›´æ‹¿ä¸åˆ°é”ï¼Œå¯èƒ½ä¼šé¥¿æ­»ã€‚</p><p>å…¶å®æˆ‘è§‰å¾—ç†è§£å…¬å¹³é”çš„æœ€ç®€å•æ–¹æ³•å°±æ˜¯çœ‹å›¾:</p><p>ä½ å¯ä»¥çœ‹ä¸‹é¢çš„ä¾‹å­ï¼Œæ¥è‡ªäº<a href="https://tech.meituan.com/2018/11/15/java-lock.html">ç¾å›¢æŠ€æœ¯å›¢é˜Ÿçš„åšå®¢</a>ï¼Œæˆ–è€…æ˜¯è¿™ä¸ª:<a href="https://www.jianshu.com/p/f584799f1c77">ä¸€å¼ å›¾è¯»æ‡‚éå…¬å¹³é”ä¸å…¬å¹³é”</a></p><p>å…¬å¹³é”å’Œéå…¬å¹³é”å¯ä»¥å½¢è±¡åŒ–ä¸ºä¸€ç¾¤äººæ‰“æ°´ã€‚</p><p>å¦‚å›¾æ‰€ç¤ºï¼Œå‡è®¾æœ‰ä¸€å£æ°´äº•ï¼Œæœ‰ç®¡ç†å‘˜çœ‹å®ˆï¼Œç®¡ç†å‘˜æœ‰ä¸€æŠŠé”ï¼Œåªæœ‰æ‹¿åˆ°é”çš„äººæ‰èƒ½å¤Ÿæ‰“æ°´ï¼Œæ‰“å®Œæ°´è¦æŠŠé”è¿˜ç»™ç®¡ç†å‘˜ã€‚æ¯ä¸ªè¿‡æ¥æ‰“æ°´çš„äººéƒ½è¦ç®¡ç†å‘˜çš„å…è®¸å¹¶æ‹¿åˆ°é”ä¹‹åæ‰èƒ½å»æ‰“æ°´ï¼Œå¦‚æœå‰é¢æœ‰äººæ­£åœ¨æ‰“æ°´ï¼Œé‚£ä¹ˆè¿™ä¸ªæƒ³è¦æ‰“æ°´çš„äººå°±å¿…é¡»æ’é˜Ÿã€‚ç®¡ç†å‘˜ä¼šæŸ¥çœ‹ä¸‹ä¸€ä¸ªè¦å»æ‰“æ°´çš„äººæ˜¯ä¸æ˜¯é˜Ÿä¼é‡Œæ’æœ€å‰é¢çš„äººï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œæ‰ä¼šç»™ä½ é”è®©ä½ å»æ‰“æ°´ï¼›å¦‚æœä½ ä¸æ˜¯æ’ç¬¬ä¸€çš„äººï¼Œå°±å¿…é¡»å»é˜Ÿå°¾æ’é˜Ÿï¼Œè¿™å°±æ˜¯å…¬å¹³é”ã€‚<br><img src="https://cdn.littlecorgi.top/mweb/2019-11-28/15749265754437.png" alt=""></p><p>ä½†æ˜¯å¯¹äºéå…¬å¹³é”ï¼Œç®¡ç†å‘˜å¯¹æ‰“æ°´çš„äººæ²¡æœ‰è¦æ±‚ã€‚å³ä½¿ç­‰å¾…é˜Ÿä¼é‡Œæœ‰æ’é˜Ÿç­‰å¾…çš„äººï¼Œä½†å¦‚æœåœ¨ä¸Šä¸€ä¸ªäººåˆšæ‰“å®Œæ°´æŠŠé”è¿˜ç»™ç®¡ç†å‘˜è€Œä¸”ç®¡ç†å‘˜è¿˜æ²¡æœ‰å…è®¸ç­‰å¾…é˜Ÿä¼é‡Œä¸‹ä¸€ä¸ªäººå»æ‰“æ°´æ—¶ï¼Œåˆšå¥½æ¥äº†ä¸€ä¸ªæ’é˜Ÿçš„äººï¼Œè¿™ä¸ªæ’é˜Ÿçš„äººæ˜¯å¯ä»¥ç›´æ¥ä»ç®¡ç†å‘˜é‚£é‡Œæ‹¿åˆ°é”å»æ‰“æ°´ï¼Œä¸éœ€è¦æ’é˜Ÿï¼ŒåŸæœ¬æ’é˜Ÿç­‰å¾…çš„äººåªèƒ½ç»§ç»­ç­‰å¾…ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://cdn.littlecorgi.top/mweb/2019-11-28/15749266850342.png" alt=""></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡ReentrantLockæºç æ¥è®²ä¸€ä¸‹å…¬å¹³é”å’Œéå…¬å¹³é”åœ¨ç®—æ³•ä¸Šçš„åŒºåˆ«ï¼š<br><img src="https://cdn.littlecorgi.top/mweb/2019-11-28/15749283538129.jpg" alt=""></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒReentrantLocké‡Œé¢æœ‰ä¸€ä¸ªå†…éƒ¨ç±»Syncï¼ŒSymcç»§æ‰¿è‡ªAbstractQueuedSynchronizerï¼Œæ·»åŠ é”å’Œé‡Šæ”¾é”çš„å¤§éƒ¨åˆ†æ“ä½œå®é™…ä¸Šéƒ½æ˜¯åœ¨Syncä¸­å®ç°çš„ã€‚ä»–æœ‰å…¬å¹³é”FairSyncå’Œéå…¬å¹³é”NonFairSyncã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸‹å…¬å¹³é”FairSyncå’Œéå…¬å¹³é”NonFairSyncçš„æºç ï¼š(å·¦è¾¹æ˜¯éå…¬å¹³é”ï¼Œå³è¾¹æ˜¯å…¬å¹³é”)<br><img src="https://cdn.littlecorgi.top/mweb/2019-11-28/15749285866543.jpg" alt=""></p><p>ä»æºç ä¸­æˆ‘ä»¬å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ï¼Œä¸¤ä¸ªä»£ç å”¯ä¸€åœ°åŒºåˆ«åœ¨äºç¬¬4è¡Œçš„é‚£ä¸ªifï¼Œå…¬å¹³é”è¾ƒéå…¬å¹³é”å¤šäº†ä¸€ä¸ªé™åˆ¶æ¡ä»¶ï¼š<code>!hasQueuedPredecessors()</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">hasQueuedPredecessors</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// The correctness of this depends on head being initialized</span></span><br><span class="line">    <span class="comment">// before tail and on head.next being accurate if the current</span></span><br><span class="line">    <span class="comment">// thread is first in queue.</span></span><br><span class="line">    <span class="type">Node</span> <span class="variable">t</span> <span class="operator">=</span> tail; <span class="comment">// Read fields in reverse initialization order</span></span><br><span class="line">    <span class="type">Node</span> <span class="variable">h</span> <span class="operator">=</span> head;</span><br><span class="line">    Node s;</span><br><span class="line">    <span class="keyword">return</span> h != t &amp;&amp;</span><br><span class="line">        ((s = h.next) == <span class="literal">null</span> || s.thread != Thread.currentThread());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ¤æ–­headå’Œtailä¸ç›¸ç­‰ï¼ˆè¯´æ˜æœ‰ç­‰å¾…çº¿ç¨‹ï¼‰å¹¶ä¸”ï¼ˆhead.nextä¸ºnull=&gt;è¯´æ˜æœ‰çº¿ç¨‹æ­£åœ¨å…¥é˜Ÿåˆ—çš„ä¸­é—´çŠ¶æ€ï¼Œè‚¯å®šä¸æ˜¯å½“å‰çº¿ç¨‹, å› ä¸ºä¸€ä¸ªçº¿ç¨‹ä¸€ä¸ªæ—¶é—´åªèƒ½åšä¸€ä»¶äº‹ æˆ–è€… head.next.threadä¸æ˜¯å½“å‰çº¿ç¨‹)</p><p>è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±æ˜¯åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯ä¸æ˜¯å”¯ä¸€é”é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªã€‚å¦‚æœæ˜¯è¿”trueï¼Œä¸æ˜¯è¿”å›falseã€‚</p><h1 id="å¯é‡å…¥é”å’Œéå¯é‡å…¥é”"><a href="#å¯é‡å…¥é”å’Œéå¯é‡å…¥é”" class="headerlink" title="å¯é‡å…¥é”å’Œéå¯é‡å…¥é”"></a>å¯é‡å…¥é”å’Œéå¯é‡å…¥é”</h1><p>åœ¨è®²è¿™è¿ä¸ªé”çš„æ¦‚å¿µå‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">doSomethings</span><span class="params">()</span> &#123;</span><br><span class="line">        doOthers();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">doOthers</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¸Šé¢ä»£ç ä¸­ï¼Œä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯synchronizedä¿®é¥°çš„ï¼Œ<code>doSomethings()</code>ä¸­è°ƒç”¨äº†<code>doOthers()</code>ã€‚</p><p>å¦‚æœæ˜¯éå¯é‡å…¥é”çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ‰§è¡Œ<code>doSomethings()</code>æ—¶ï¼Œä¼šç»™ä»–åŠ é”ï¼Œç„¶åå»æ‰§è¡Œ<code>doOthers()</code>ï¼Œåˆç”±äºæ‰§è¡Œ<code>doOthers()</code>æ—¶ä¹Ÿéœ€è¦åŠ é”ï¼Œå¹¶ä¸”è¿™ä¸ªé”å’Œ<code>doSomethings()</code>æ—¶åŠ çš„é”è¿˜ä¸ä¸€æ ·ï¼Œæ‰€ä»¥çº¿ç¨‹å¿…é¡»æŠŠåŸæ¥çš„é”ç»™é‡Šæ”¾æ‰ï¼Œä½†æ˜¯<code>doSomethings()</code>è¿˜æ²¡æ‰§è¡Œå®Œï¼Œä»–è¿˜ä¸èƒ½é‡Šæ”¾æ‰é”ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå½¢æˆæ­»é”ã€‚</p><p>ä½†æ˜¯å¦‚æœæ˜¯å¯é‡å…¥é”çš„è¯ï¼Œå°±èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å¯é‡å…¥é”å°±èƒ½ä¿è¯ä»–åœ¨è°ƒç”¨<code>doOthers()</code>çš„æ—¶å€™ç›´æ¥è·å–å½“å‰å¯¹è±¡çš„é”ï¼Œè¿›å…¥<code>doOthers()</code>è¿›è¡Œæ“ä½œã€‚</p><p>è¿™å—è¿˜æ˜¯å¼•ç”¨<a href="https://tech.meituan.com/2018/11/15/java-lock.html">è¿™ç¯‡åšå®¢</a>çš„å›¾ç‰‡ï¼š</p><p>è¿˜æ˜¯æ‰“æ°´çš„ä¾‹å­ï¼Œæœ‰å¤šä¸ªäººåœ¨æ’é˜Ÿæ‰“æ°´ï¼Œæ­¤æ—¶ç®¡ç†å‘˜å…è®¸é”å’ŒåŒä¸€ä¸ªäººçš„å¤šä¸ªæ°´æ¡¶ç»‘å®šã€‚è¿™ä¸ªäººç”¨å¤šä¸ªæ°´æ¡¶æ‰“æ°´æ—¶ï¼Œç¬¬ä¸€ä¸ªæ°´æ¡¶å’Œé”ç»‘å®šå¹¶æ‰“å®Œæ°´ä¹‹åï¼Œç¬¬äºŒä¸ªæ°´æ¡¶ä¹Ÿå¯ä»¥ç›´æ¥å’Œé”ç»‘å®šå¹¶å¼€å§‹æ‰“æ°´ï¼Œæ‰€æœ‰çš„æ°´æ¡¶éƒ½æ‰“å®Œæ°´ä¹‹åæ‰“æ°´äººæ‰ä¼šå°†é”è¿˜ç»™ç®¡ç†å‘˜ã€‚è¿™ä¸ªäººçš„æ‰€æœ‰æ‰“æ°´æµç¨‹éƒ½èƒ½å¤ŸæˆåŠŸæ‰§è¡Œï¼Œåç»­ç­‰å¾…çš„äººä¹Ÿèƒ½å¤Ÿæ‰“åˆ°æ°´ã€‚è¿™å°±æ˜¯å¯é‡å…¥é”ã€‚<br><img src="https://cdn.littlecorgi.top/mweb/2019-11-28/15749464893016.png" alt=""></p><p>ä½†å¦‚æœæ˜¯éå¯é‡å…¥é”çš„è¯ï¼Œæ­¤æ—¶ç®¡ç†å‘˜åªå…è®¸é”å’ŒåŒä¸€ä¸ªäººçš„ä¸€ä¸ªæ°´æ¡¶ç»‘å®šã€‚ç¬¬ä¸€ä¸ªæ°´æ¡¶å’Œé”ç»‘å®šæ‰“å®Œæ°´ä¹‹åå¹¶ä¸ä¼šé‡Šæ”¾é”ï¼Œå¯¼è‡´ç¬¬äºŒä¸ªæ°´æ¡¶ä¸èƒ½å’Œé”ç»‘å®šä¹Ÿæ— æ³•æ‰“æ°´ã€‚å½“å‰çº¿ç¨‹å‡ºç°æ­»é”ï¼Œæ•´ä¸ªç­‰å¾…é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰çº¿ç¨‹éƒ½æ— æ³•è¢«å”¤é†’ã€‚<br><img src="https://cdn.littlecorgi.top/mweb/2019-11-28/15749464984252.png" alt=""></p><p>é‚£ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹æºç ï¼Œçœ‹ReentrantLockçš„è·å–é”å’Œé‡Šæ”¾é”çš„æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * è·å–é”ï¼Œä¹Ÿæ˜¯éå…¬å¹³é”çš„è·å–é”çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">nonfairTryAcquire</span><span class="params">(<span class="type">int</span> acquires)</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">Thread</span> <span class="variable">current</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">    <span class="comment">// è·å–Stateå˜é‡</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> getState();</span><br><span class="line">    <span class="comment">// å¦‚æœstateå˜é‡ä¸º0ï¼Œé‚£ä¹ˆæ²¡æœ‰å…¶ä»–çº¿ç¨‹åœ¨æ‰§è¡ŒåŒæ­¥æ–¹æ³•ï¼Œå°±å°†stateç½®1ï¼Œå½“å‰çº¿ç¨‹å¼€å§‹æ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">if</span> (c == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (compareAndSetState(<span class="number">0</span>, acquires)) &#123;</span><br><span class="line">            setExclusiveOwnerThread(current);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦æ˜¯è·å–åˆ°é”çš„çº¿ç¨‹ï¼Œå¦‚æœæ˜¯å°±è¿›å…¥if</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (current == getExclusiveOwnerThread()) &#123;</span><br><span class="line">        <span class="comment">// è®©cçš„å€¼åŠ ä¸Šacquiresçš„å€¼ï¼Œä»£è¡¨å¯ä»¥å†æ¬¡è·å–é”</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">nextc</span> <span class="operator">=</span> c + acquires;</span><br><span class="line">        <span class="keyword">if</span> (nextc &lt; <span class="number">0</span>) <span class="comment">// overflow</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Maximum lock count exceeded&quot;</span>);</span><br><span class="line">        <span class="comment">// è·Ÿæ–°state</span></span><br><span class="line">        setState(nextc);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * é‡Šæ”¾é”</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">tryRelease</span><span class="params">(<span class="type">int</span> releases)</span> &#123;</span><br><span class="line">    <span class="comment">// state-1</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> getState() - releases;</span><br><span class="line">    <span class="keyword">if</span> (Thread.currentThread() != getExclusiveOwnerThread())</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalMonitorStateException</span>();</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">free</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// å¦‚æœstate-1ä¸º0ï¼Œä»£è¡¨å½“å‰çº¿ç¨‹æ‰€æœ‰é‡å¤è·å–é”çš„æ“ä½œéƒ½å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œå°±çœŸæ­£çš„é‡Šæ”¾é”</span></span><br><span class="line">    <span class="keyword">if</span> (c == <span class="number">0</span>) &#123;</span><br><span class="line">        free = <span class="literal">true</span>;</span><br><span class="line">        setExclusiveOwnerThread(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ›´æ–°state</span></span><br><span class="line">    setState(c);</span><br><span class="line">    <span class="keyword">return</span> free;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="ç‹¬äº«é”å’Œå…±äº«é”"><a href="#ç‹¬äº«é”å’Œå…±äº«é”" class="headerlink" title="ç‹¬äº«é”å’Œå…±äº«é”"></a>ç‹¬äº«é”å’Œå…±äº«é”</h1><p>ç‹¬äº«é”ä¹Ÿæ˜¯æ’ä»–é”ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥é”ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ã€‚å¦‚æœçº¿ç¨‹å¯¹æ•°æ®åŠ ä¸Šæ’ä»–é”ä¹‹åï¼Œå…¶å®ƒçº¿ç¨‹å°±ä¸èƒ½åœ¨å¯¹æ•°æ®åŠ ä»»ä½•çš„é”ã€‚è·å¾—æ’ä»–é”çš„çº¿ç¨‹æ—¢èƒ½è¯»æ•°æ®ä¹Ÿèƒ½å†™æ•°æ®ã€‚</p><p>è€Œå…±äº«é”åˆ™å¯è¢«å¤šä¸ªçº¿ç¨‹æŒæœ‰ã€‚å½“çº¿ç¨‹å¯¹æ•°æ®åŠ ä¸Šå…±äº«é”ä¹‹åï¼Œå…¶å®ƒçº¿ç¨‹ä¹Ÿèƒ½å¯¹è¯¥æ•°æ®åŠ é”ï¼Œä½†æ˜¯åªèƒ½åŠ å…±äº«é”ï¼Œè¿™æ—¶è·å¾—å…±äº«é”çš„çº¿ç¨‹åªèƒ½è¯»æ•°æ®ä¸èƒ½å†™æ•°æ®ã€‚</p><p>åœ¨Javaä¸­ï¼ŒReentrantLockæ˜¯å…±äº«é”ï¼ŒReentrantReadWriteLockæ˜¯æ’ä»–é”ã€‚</p><p>å…ˆæ¥çœ‹ReentrantReadWriteLockï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReentrantReadWriteLock</span></span><br><span class="line">        <span class="keyword">implements</span> <span class="title class_">ReadWriteLock</span>, java.io.Serializable &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">6992448646407690164L</span>;</span><br><span class="line">    <span class="comment">/** Inner class providing readlock */</span></span><br><span class="line">    <span class="comment">// è¯»é”</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReentrantReadWriteLock.ReadLock readerLock;</span><br><span class="line">    <span class="comment">/** Inner class providing writelock */</span></span><br><span class="line">    <span class="comment">// å†™é”</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReentrantReadWriteLock.WriteLock writerLock;</span><br><span class="line">    <span class="comment">/** Performs all synchronization mechanics */</span></span><br><span class="line">    <span class="keyword">final</span> Sync sync;</span><br></pre></td></tr></table></figure><br>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ReentranReadWriteLockä¸­æœ‰ä¸¤ä¸ªé”ï¼šè¯»é”ReaderLockå’Œå†™é”WriterLockã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-------------------è¯»é”-------------------</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ReadLock</span> <span class="keyword">implements</span> <span class="title class_">Lock</span>, java.io.Serializable &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">5992448646407690164L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Sync sync;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="title function_">ReadLock</span><span class="params">(ReentrantReadWriteLock lock)</span> &#123;</span><br><span class="line">        sync = lock.sync;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">-------------------å†™é”-------------------</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">WriteLock</span> <span class="keyword">implements</span> <span class="title class_">Lock</span>, java.io.Serializable &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">4992448646407690164L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Sync sync;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="title function_">WriteLock</span><span class="params">(ReentrantReadWriteLock lock)</span> &#123;</span><br><span class="line">        sync = lock.sync;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä»–ä¸¤éƒ½æ˜¯é€šè¿‡å†…éƒ¨çš„Syncå®ç°çš„é”ã€‚ä½†æ˜¯è¯»é”å’Œå†™é”çš„åŠ é”æ–¹å¼ä¸ä¸€æ ·ï¼Œè¯»é”æ˜¯å…±äº«é”ï¼Œå†™é”æ˜¯ç‹¬äº«æ‰€ã€‚è¯»é”çš„å…±äº«é”å¯ä¿è¯å¹¶å‘è¯»éå¸¸é«˜æ•ˆï¼Œè€Œè¯»å†™ã€å†™è¯»ã€å†™å†™çš„è¿‡ç¨‹äº’æ–¥ï¼Œå› ä¸ºè¯»é”å’Œå†™é”æ˜¯åˆ†ç¦»çš„ã€‚æ‰€ä»¥ReentrantReadWriteLockçš„å¹¶å‘æ€§ç›¸æ¯”ä¸€èˆ¬çš„äº’æ–¥é”æœ‰äº†å¾ˆå¤§æå‡ã€‚</p><p>è€Œä¸”ä»–ä¸¤çš„stateä¹Ÿå¾ˆæœ‰ç‰¹è‰²ï¼Œæˆ‘ä»¬ä¸Šé¢è¯´è¿‡ï¼Œstateç”¨äºæè¿°æœ‰å¤šå°‘ä¸ªçº¿ç¨‹æŒæœ‰è¯¥é”ã€‚åœ¨ç‹¬äº«é”ä¸­ï¼Œè¿™ä¸ªçº¿ç¨‹é€šå¸¸æ˜¯0æˆ–è€…1ï¼Œè€Œå…±äº«é”ä¸­å°±æ˜¯æŒæœ‰é”çš„æ•°é‡ã€‚ä½†æ˜¯ReentrantReadWriteLockä¸­æœ‰ä¸¤æŠŠé”ï¼Œä½†æ˜¯ä»–ä»¬éƒ½é€šè¿‡åŒä¸€ä¸ªstateæ¥æè¿°ï¼Œæ‰€ä»¥è¿™åœ°æ–¹å°±éœ€è¦æœ‰ç‚¹ç‰¹åˆ«çš„ä¸œè¥¿äº†ã€‚</p><p>ReentrantReadWriteLockå°†stateåˆ†éš”æˆäº†ä¸¤éƒ¨åˆ†ï¼Œé«˜16ä½ä»£è¡¨è¯»é”ï¼Œä½16ä½ä»£è¡¨å†™é”ï¼š<br><img src="https://cdn.littlecorgi.top/mweb/2019-11-28/15749488946683.png" alt=""></p><p>æ¥ä¸‹æ¥å†æ¥çœ‹åŠ é”çš„ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">tryAcquire</span><span class="params">(<span class="type">int</span> acquires)</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Walkthrough: ï¼ˆGoogleæœºç¿»ï¼‰</span></span><br><span class="line"><span class="comment">     * 1. å¦‚æœè¯»å–è®¡æ•°éé›¶æˆ–å†™å…¥è®¡æ•°éé›¶å¹¶ä¸”æ‰€æœ‰è€…æ˜¯å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œåˆ™å¤±è´¥ã€‚</span></span><br><span class="line"><span class="comment">     * 2. å¦‚æœè®¡æ•°é¥±å’Œï¼Œåˆ™å¤±è´¥ã€‚ </span></span><br><span class="line"><span class="comment">     *       (åªæœ‰åœ¨countå·²ç»ä¸ä¸ºé›¶æ—¶ï¼Œæ‰å¯èƒ½å‘ç”Ÿè¿™ç§æƒ…å†µã€‚)</span></span><br><span class="line"><span class="comment">     * 3. å¦åˆ™ï¼Œ</span></span><br><span class="line"><span class="comment">     *       å¦‚æœè¯¥çº¿ç¨‹æ˜¯å¯é‡å…¥è·å–æˆ–é˜Ÿåˆ—ç­–ç•¥å…è®¸çš„è¯ï¼Œåˆ™æœ‰èµ„æ ¼è¿›è¡Œé”å®šã€‚ </span></span><br><span class="line"><span class="comment">     *       å¦‚æœæ˜¯è¿™æ ·ï¼Œè¯·æ›´æ–°çŠ¶æ€å¹¶è®¾ç½®æ‰€æœ‰è€…ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">Thread</span> <span class="variable">current</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">    <span class="comment">// è·å–state</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> getState();</span><br><span class="line">    <span class="comment">// å–å†™é”çš„ä¸ªæ•°w</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">w</span> <span class="operator">=</span> exclusiveCount(c);</span><br><span class="line">    <span class="comment">// å¦‚æœå·²ç»æœ‰çº¿ç¨‹æŒæœ‰äº†é”</span></span><br><span class="line">    <span class="keyword">if</span> (c != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// (Note: if c != 0 and w == 0 then shared count != 0)</span></span><br><span class="line">        <span class="comment">// å¦‚æœwä¸º0ï¼Œä¹Ÿå°±æ˜¯å­˜åœ¨è¯»é”ï¼Œæˆ–è€…æŒæœ‰æ‰€çš„çº¿ç¨‹ä¸æ˜¯å½“å‰çº¿ç¨‹ï¼Œè¿”å›false</span></span><br><span class="line">        <span class="keyword">if</span> (w == <span class="number">0</span> || current != getExclusiveOwnerThread())</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">// å¦‚æœå†™å…¥é”çš„æ•°é‡å¤§äºæœ€å¤§æ•°å°±æŠ›å‡ºä¸€ä¸ªError</span></span><br><span class="line">        <span class="keyword">if</span> (w + exclusiveCount(acquires) &gt; MAX_COUNT)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Maximum lock count exceeded&quot;</span>);</span><br><span class="line">        <span class="comment">// Reentrant acquire</span></span><br><span class="line">        setState(c + acquires);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœå½“ä¸”å†™çº¿ç¨‹æ•°ä¸º0ï¼Œå¹¶ä¸”å½“å‰çº¿ç¨‹éœ€è¦é˜»å¡é‚£ä¹ˆå°±è¿”å›å¤±è´¥ï¼›æˆ–è€…å¦‚æœé€šè¿‡CASå¢åŠ å†™çº¿ç¨‹æ•°å¤±è´¥ä¹Ÿè¿”å›å¤±è´¥</span></span><br><span class="line">    <span class="keyword">if</span> (writerShouldBlock() ||</span><br><span class="line">        !compareAndSetState(c, c + acquires))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// å¦‚æœc=0ï¼Œw=0æˆ–è€…c&gt;0ï¼Œw&gt;0ï¼ˆé‡å…¥ï¼‰ï¼Œåˆ™è®¾ç½®å½“å‰çº¿ç¨‹æˆ–é”çš„æ‹¥æœ‰è€…</span></span><br><span class="line">    setExclusiveOwnerThread(current);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><blockquote><ul><li>è¿™æ®µä»£ç é¦–å…ˆå–åˆ°å½“å‰é”çš„ä¸ªæ•°cï¼Œç„¶åå†é€šè¿‡cæ¥è·å–å†™é”çš„ä¸ªæ•°wã€‚å› ä¸ºå†™é”æ˜¯ä½16ä½ï¼Œæ‰€ä»¥å–ä½16ä½çš„æœ€å¤§å€¼ä¸å½“å‰çš„cåšä¸è¿ç®—ï¼ˆ int w = exclusiveCountÂ©; ï¼‰ï¼Œé«˜16ä½å’Œ0ä¸è¿ç®—åæ˜¯0ï¼Œå‰©ä¸‹çš„å°±æ˜¯ä½ä½è¿ç®—çš„å€¼ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æŒæœ‰å†™é”çš„çº¿ç¨‹æ•°ç›®ã€‚</li><li>åœ¨å–åˆ°å†™é”çº¿ç¨‹çš„æ•°ç›®åï¼Œé¦–å…ˆåˆ¤æ–­æ˜¯å¦å·²ç»æœ‰çº¿ç¨‹æŒæœ‰äº†é”ã€‚å¦‚æœå·²ç»æœ‰çº¿ç¨‹æŒæœ‰äº†é”(c!=0)ï¼Œåˆ™æŸ¥çœ‹å½“å‰å†™é”çº¿ç¨‹çš„æ•°ç›®ï¼Œå¦‚æœå†™çº¿ç¨‹æ•°ä¸º0ï¼ˆå³æ­¤æ—¶å­˜åœ¨è¯»é”ï¼‰æˆ–è€…æŒæœ‰é”çš„çº¿ç¨‹ä¸æ˜¯å½“å‰çº¿ç¨‹å°±è¿”å›å¤±è´¥ï¼ˆæ¶‰åŠåˆ°å…¬å¹³é”å’Œéå…¬å¹³é”çš„å®ç°ï¼‰ã€‚</li><li>å¦‚æœå†™å…¥é”çš„æ•°é‡å¤§äºæœ€å¤§æ•°ï¼ˆ65535ï¼Œ2çš„16æ¬¡æ–¹-1ï¼‰å°±æŠ›å‡ºä¸€ä¸ªErrorã€‚</li><li>å¦‚æœå½“ä¸”å†™çº¿ç¨‹æ•°ä¸º0ï¼ˆé‚£ä¹ˆè¯»çº¿ç¨‹ä¹Ÿåº”è¯¥ä¸º0ï¼Œå› ä¸ºä¸Šé¢å·²ç»å¤„ç†c!=0çš„æƒ…å†µï¼‰ï¼Œå¹¶ä¸”å½“å‰çº¿ç¨‹éœ€è¦é˜»å¡é‚£ä¹ˆå°±è¿”å›å¤±è´¥ï¼›å¦‚æœé€šè¿‡CASå¢åŠ å†™çº¿ç¨‹æ•°å¤±è´¥ä¹Ÿè¿”å›å¤±è´¥ã€‚</li><li>å¦‚æœc=0,w=0æˆ–è€…c&gt;0,w&gt;0ï¼ˆé‡å…¥ï¼‰ï¼Œåˆ™è®¾ç½®å½“å‰çº¿ç¨‹æˆ–é”çš„æ‹¥æœ‰è€…ï¼Œè¿”å›æˆåŠŸï¼</li></ul></blockquote><p>tryAcquire()é™¤äº†é‡å…¥æ¡ä»¶ï¼ˆå½“å‰çº¿ç¨‹ä¸ºè·å–äº†å†™é”çš„çº¿ç¨‹ï¼‰ä¹‹å¤–ï¼Œå¢åŠ äº†ä¸€ä¸ªè¯»é”æ˜¯å¦å­˜åœ¨çš„åˆ¤æ–­ã€‚å¦‚æœå­˜åœ¨è¯»é”ï¼Œåˆ™å†™é”ä¸èƒ½è¢«è·å–ï¼ŒåŸå› åœ¨äºï¼šå¿…é¡»ç¡®ä¿å†™é”çš„æ“ä½œå¯¹è¯»é”å¯è§ï¼Œå¦‚æœå…è®¸è¯»é”åœ¨å·²è¢«è·å–çš„æƒ…å†µä¸‹å¯¹å†™é”çš„è·å–ï¼Œé‚£ä¹ˆæ­£åœ¨è¿è¡Œçš„å…¶ä»–è¯»çº¿ç¨‹å°±æ— æ³•æ„ŸçŸ¥åˆ°å½“å‰å†™çº¿ç¨‹çš„æ“ä½œã€‚</p><p>å› æ­¤ï¼Œåªæœ‰ç­‰å¾…å…¶ä»–è¯»çº¿ç¨‹éƒ½é‡Šæ”¾äº†è¯»é”ï¼Œå†™é”æ‰èƒ½è¢«å½“å‰çº¿ç¨‹è·å–ï¼Œè€Œå†™é”ä¸€æ—¦è¢«è·å–ï¼Œåˆ™å…¶ä»–è¯»å†™çº¿ç¨‹çš„åç»­è®¿é—®å‡è¢«é˜»å¡ã€‚å†™é”çš„é‡Šæ”¾ä¸ReentrantLockçš„é‡Šæ”¾è¿‡ç¨‹åŸºæœ¬ç±»ä¼¼ï¼Œæ¯æ¬¡é‡Šæ”¾å‡å‡å°‘å†™çŠ¶æ€ï¼Œå½“å†™çŠ¶æ€ä¸º0æ—¶è¡¨ç¤ºå†™é”å·²è¢«é‡Šæ”¾ï¼Œç„¶åç­‰å¾…çš„è¯»å†™çº¿ç¨‹æ‰èƒ½å¤Ÿç»§ç»­è®¿é—®è¯»å†™é”ï¼ŒåŒæ—¶å‰æ¬¡å†™çº¿ç¨‹çš„ä¿®æ”¹å¯¹åç»­çš„è¯»å†™çº¿ç¨‹å¯è§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">tryAcquireShared</span><span class="params">(<span class="type">int</span> unused)</span> &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">current</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">    <span class="comment">// è·å–state</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> getState();</span><br><span class="line">    <span class="comment">// å¦‚æœå…¶ä»–çº¿ç¨‹å·²ç»è·å–äº†å†™é”ï¼Œåˆ™å½“å‰çº¿ç¨‹è·å–è¯»é”å¤±è´¥ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (exclusiveCount(c) != <span class="number">0</span> &amp;&amp;</span><br><span class="line">        getExclusiveOwnerThread() != current)</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    <span class="comment">// è·å–è¯»é”state</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> sharedCount(c);</span><br><span class="line">    <span class="keyword">if</span> (!readerShouldBlock() &amp;&amp;</span><br><span class="line">        r &lt; MAX_COUNT &amp;&amp;</span><br><span class="line">        compareAndSetState(c, c + SHARED_UNIT)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (r == <span class="number">0</span>) &#123;</span><br><span class="line">            firstReader = current;</span><br><span class="line">            firstReaderHoldCount = <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (firstReader == current) &#123;</span><br><span class="line">            firstReaderHoldCount++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">HoldCounter</span> <span class="variable">rh</span> <span class="operator">=</span> cachedHoldCounter;</span><br><span class="line">            <span class="keyword">if</span> (rh == <span class="literal">null</span> || rh.tid != getThreadId(current))</span><br><span class="line">                cachedHoldCounter = rh = readHolds.get();</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (rh.count == <span class="number">0</span>)</span><br><span class="line">                readHolds.set(rh);</span><br><span class="line">            rh.count++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> fullTryAcquireShared(current);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åœ¨tryAcquireShared(int unused)æ–¹æ³•ä¸­ï¼Œå¦‚æœå…¶ä»–çº¿ç¨‹å·²ç»è·å–äº†å†™é”ï¼Œåˆ™å½“å‰çº¿ç¨‹è·å–è¯»é”å¤±è´¥ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚å¦‚æœå½“å‰çº¿ç¨‹è·å–äº†å†™é”æˆ–è€…å†™é”æœªè¢«è·å–ï¼Œåˆ™å½“å‰çº¿ç¨‹ï¼ˆçº¿ç¨‹å®‰å…¨ï¼Œä¾é CASä¿è¯ï¼‰å¢åŠ è¯»çŠ¶æ€ï¼ŒæˆåŠŸè·å–è¯»é”ã€‚è¯»é”çš„æ¯æ¬¡é‡Šæ”¾ï¼ˆçº¿ç¨‹å®‰å…¨çš„ï¼Œå¯èƒ½æœ‰å¤šä¸ªè¯»çº¿ç¨‹åŒæ—¶é‡Šæ”¾è¯»é”ï¼‰å‡å‡å°‘è¯»çŠ¶æ€ï¼Œå‡å°‘çš„å€¼æ˜¯â€œ1&lt;&lt;16â€ã€‚æ‰€ä»¥è¯»å†™é”æ‰èƒ½å®ç°è¯»è¯»çš„è¿‡ç¨‹å…±äº«ï¼Œè€Œè¯»å†™ã€å†™è¯»ã€å†™å†™çš„è¿‡ç¨‹äº’æ–¥ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Java/">Java</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Java/">Java</category>
      
      <category domain="https://www.littlecorgi.top/tags/synchronized/">synchronized</category>
      
      <category domain="https://www.littlecorgi.top/tags/lock/">lock</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E9%94%81/">é”</category>
      
      
      <comments>https://www.littlecorgi.top/posts/d88880aa.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>æ·±å…¥ç†è§£JVM-ç±»åŠ è½½å™¨</title>
      <link>https://www.littlecorgi.top/posts/594da31f.html</link>
      <guid>https://www.littlecorgi.top/posts/594da31f.html</guid>
      <pubDate>Sun, 24 Nov 2019 13:58:54 GMT</pubDate>
      
        
        
          
          
      <description></description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="1-æ¦‚å¿µ"><a href="#1-æ¦‚å¿µ" class="headerlink" title="1. æ¦‚å¿µ"></a>1. æ¦‚å¿µ</h1><p>è™šæ‹Ÿæœºè®¾è®¡å›¢é˜ŸæŠŠç±»åŠ è½½é˜¶æ®µä¸­çš„â€œ<strong>é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–æè¿°æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ(å³å­—èŠ‚ç )</strong>â€è¿™ä¸ªåŠ¨ä½œæ”¾åˆ°Javaè™šæ‹Ÿæœºå¤–éƒ¨å»å®ç°ï¼Œä»¥ä¾¿è®©åº”ç”¨ç¨‹åºè‡ªå·±å†³å®šå¦‚ä½•å»è·å–æ‰€éœ€è¦çš„ç±»ã€‚å®ç°è¿™ä¸ªåŠ¨ä½œçš„ä»£ç æ¨¡å—ç§°ä¸ºâ€œ<strong>ç±»åŠ è½½å™¨</strong>â€ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼ŒJava è™šæ‹Ÿæœºä½¿ç”¨ Java ç±»çš„æ–¹å¼å¦‚ä¸‹ï¼š</p><ul><li>Java æºç¨‹åºï¼ˆ.java æ–‡ä»¶ï¼‰åœ¨ç»è¿‡ Java ç¼–è¯‘å™¨ç¼–è¯‘ä¹‹åå°±è¢«è½¬æ¢æˆå­—èŠ‚ç ï¼ˆ.class æ–‡ä»¶ï¼‰ã€‚</li><li>ç±»åŠ è½½å™¨è´Ÿè´£è¯»å– Java å­—èŠ‚ä»£ç ï¼Œå¹¶è½¬æ¢æˆ java.lang.Classç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚æ¯ä¸ªè¿™æ ·çš„å®ä¾‹ç”¨æ¥è¡¨ç¤ºä¸€ä¸ª Java ç±»ã€‚é€šè¿‡æ­¤å®ä¾‹çš„ newInstance()æ–¹æ³•å°±å¯ä»¥åˆ›å»ºå‡ºè¯¥ç±»çš„ä¸€ä¸ªå¯¹è±¡ã€‚</li></ul><p>å®é™…çš„æƒ…å†µå¯èƒ½æ›´åŠ å¤æ‚ï¼Œæ¯”å¦‚ Java å­—èŠ‚ä»£ç å¯èƒ½æ˜¯é€šè¿‡å·¥å…·åŠ¨æ€ç”Ÿæˆçš„ï¼Œä¹Ÿå¯èƒ½æ˜¯é€šè¿‡ç½‘ç»œä¸‹è½½çš„ã€‚æ›´è¯¦ç»†çš„å†…å®¹å¯ä»¥å‚è€ƒä¸Šä¸€ç¯‡æ–‡ç« ä¸­è®²ç±»åŠ è½½è¿‡ç¨‹ä¸­çš„åŠ è½½é˜¶æ®µæ—¶ä»‹ç»çš„å‡ ä¸ªä¾‹å­ï¼ˆJARåŒ…ã€Appletã€åŠ¨æ€ä»£ç†ã€JSPç­‰ï¼‰ã€‚</p><h1 id="2-ç±»ä¸ç±»åŠ è½½å™¨"><a href="#2-ç±»ä¸ç±»åŠ è½½å™¨" class="headerlink" title="2. ç±»ä¸ç±»åŠ è½½å™¨"></a>2. ç±»ä¸ç±»åŠ è½½å™¨</h1><p>ç±»åŠ è½½å™¨è™½ç„¶åªç”¨äºå®ç°ç±»çš„åŠ è½½åŠ¨ä½œï¼Œä½†ä»–åœ¨Javaç¨‹åºä¸­èµ·åˆ°çš„ä½œç”¨å´è¿œè¿œä¸é™äºç±»åŠ è½½é˜¶æ®µã€‚å¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½éœ€è¦ç”±åŠ è½½ä»–çš„ç±»åŠ è½½å™¨å’Œè¿™ä¸ªç±»æœ¬èº«å¼‚åŒç¡®ç«‹å…¶åœ¨Javaè™šæ‹Ÿæœºä¸­çš„å”¯ä¸€æ€§ï¼Œæ¯ä¸€ä¸ªç±»åŠ è½½å™¨ï¼Œéƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç±»åç§°ç©ºé—´ã€‚</p><p>é€šä¿—ä¸€ç‚¹å°±æ˜¯ï¼šæ¯”è¾ƒä¸¤ä¸ªç±»æ˜¯å¦â€œç›¸ç­‰â€ï¼Œåªæœ‰åœ¨è¿™ä¸¤ä¸ªç±»æ˜¯ç”±åŒä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½çš„å‰æä¸‹æ‰æœ‰æ„ä¹‰ï¼Œå¦åˆ™ï¼Œå³ä½¿è¿™ä¸¤ä¸ªç±»æ¥æºäºåŒä¸€ä¸ªClassæ–‡ä»¶ï¼Œè¢«åŒä¸€ä¸ªè™šæ‹ŸæœºåŠ è½½ï¼Œåªè¦åŠ è½½ä»–ä»¬çš„ç±»åŠ è½½å™¨ä¸åŒï¼Œé‚£è¿™ä¸¤ä¸ªç±»å°±å¿…å®šä¸ç›¸ç­‰ï¼ˆè¿™é‡ŒæŒ‡çš„ç›¸ç­‰ï¼ŒåŒ…æ‹¬ç±»çš„Classå¯¹è±¡çš„equals()æ–¹æ³•ã€isAssignableFrom()æ–¹æ³•ã€isInstance()æ–¹æ³•çš„è¿”å›ç»“æœï¼Œä¹ŸåŒ…æ‹¬ä½¿ç”¨instanceof()å…³é”®å­—å¯¹åšå¯¹è±¡æ‰€å±å…³ç³»åˆ¤å®šç­‰æƒ…å†µï¼‰ã€‚</p><h1 id="3-åŒäº²å§”æ´¾æ¨¡å‹"><a href="#3-åŒäº²å§”æ´¾æ¨¡å‹" class="headerlink" title="3. åŒäº²å§”æ´¾æ¨¡å‹"></a>3. åŒäº²å§”æ´¾æ¨¡å‹</h1><p>ä»Javaè™šæ‹Ÿæœºè§’åº¦æ¥è®²ï¼Œåªå­˜åœ¨ä¸¤ç§ä¸åŒçš„ç±»åŠ è½½å™¨ï¼š</p><ul><li>å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰ï¼Œè¿™ä¸ªç±»åŠ è½½å™¨ç”¨C++å®ç°ï¼Œæ˜¯è™šæ‹Ÿæœºè‡ªèº«çš„ä¸€éƒ¨åˆ†</li><li>æ‰€æœ‰å…¶ä»–ç±»çš„åŠ è½½å™¨ï¼Œè¿™äº›ç±»åŠ è½½å™¨ç”±Javaå®ç°ï¼Œç‹¬ç«‹äºè™šæ‹Ÿæœºå¤–éƒ¨ï¼Œå¹¶ä¸”å…¨éƒ½ç»§æ‰¿è‡ªæŠ½è±¡ç±»java.lang.ClassLoader</li></ul><p>ä»Javaå¼€å‘äººå‘˜è§’åº¦æ¥çœ‹ï¼Œç±»åŠ è½½å™¨è¿˜å¯ä»¥åˆ’åˆ†çš„æ›´ç»†è‡´ä¸€äº›ï¼š</p><ul><li><p>å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰ æ­¤ç±»åŠ è½½å™¨è´Ÿè´£å°†å­˜æ”¾åœ¨ <JAVA_HOME>\lib ç›®å½•ä¸­çš„ï¼Œæˆ–è€…è¢« -Xbootclasspath å‚æ•°æ‰€æŒ‡å®šçš„è·¯å¾„ä¸­çš„ï¼Œå¹¶ä¸”æ˜¯è™šæ‹Ÿæœºè¯†åˆ«çš„ï¼ˆä»…æŒ‰ç…§æ–‡ä»¶åè¯†åˆ«ï¼Œå¦‚ rt.jarï¼Œåå­—ä¸ç¬¦åˆçš„ç±»åº“å³ä½¿æ”¾åœ¨lib ç›®å½•ä¸­ä¹Ÿä¸ä¼šè¢«åŠ è½½ï¼‰ç±»åº“åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸­ã€‚ å¯åŠ¨ç±»åŠ è½½å™¨æ— æ³•è¢« Java ç¨‹åºç›´æ¥å¼•ç”¨ï¼Œç”¨æˆ·åœ¨ç¼–å†™è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¦‚æœéœ€è¦æŠŠåŠ è½½è¯·æ±‚å§”æ´¾ç»™å¼•å¯¼ç±»åŠ è½½å™¨ï¼Œç›´æ¥ä½¿ç”¨nullä»£æ›¿å³å¯ã€‚</p></li><li><p>æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰ è¿™ä¸ªç±»åŠ è½½å™¨æ˜¯ç”±ExtClassLoaderï¼ˆsun.misc.Launcher$ExtClassLoaderï¼‰å®ç°çš„ã€‚å®ƒè´Ÿè´£å°†<Java_Home>/lib/extæˆ–è€…è¢« java.ext.dirç³»ç»Ÿå˜é‡æ‰€æŒ‡å®šè·¯å¾„ä¸­çš„æ‰€æœ‰ç±»åº“åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨æ‰©å±•ç±»åŠ è½½å™¨ã€‚</p></li><li><p>åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼ˆApplication ClassLoaderï¼‰ è¿™ä¸ªç±»åŠ è½½å™¨æ˜¯ç”± AppClassLoaderï¼ˆsun.misc.Launcher$AppClassLoaderï¼‰å®ç°çš„ã€‚ç”±äºè¿™ä¸ªç±»åŠ è½½å™¨æ˜¯ClassLoaderä¸­çš„getSystemClassLoader()æ–¹æ³•çš„è¿”å›å€¼ï¼Œå› æ­¤ä¸€èˆ¬ç§°ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨ã€‚å®ƒè´Ÿè´£åŠ è½½ç”¨æˆ·ç±»è·¯å¾„ï¼ˆClassPathï¼‰ä¸Šæ‰€æŒ‡å®šçš„ç±»åº“ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªç±»åŠ è½½å™¨ï¼Œå¦‚æœåº”ç”¨ç¨‹åºä¸­æ²¡æœ‰è‡ªå®šä¹‰è¿‡è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¸ªå°±æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ã€‚</p></li></ul><p>ç”±å¼€å‘äººå‘˜å¼€å‘çš„åº”ç”¨ç¨‹åºéƒ½æ˜¯ç”±è¿™ä¸‰ç§ç±»åŠ è½½å™¨ç›¸äº’é…åˆè¿›è¡ŒåŠ è½½çš„ï¼Œå¦‚æœæœ‰å¿…è¦ï¼Œè¿˜å¯ä»¥åŠ å…¥è‡ªå·±å®šä¹‰çš„ç±»åŠ è½½å™¨ã€‚è¿™äº›ç±»åŠ è½½å™¨çš„å…³ç³»ä¸€èˆ¬å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="media/15745827002064/15745869705585.jpg" alt=""></p><p>ä¸Šå›¾å±•ç¤ºçš„ç±»åŠ è½½å™¨ä¹‹é—´çš„å±‚æ¬¡å…³ç³»ï¼Œç§°ä¸ºç±»åŠ è½½å™¨çš„åŒäº²å§”æ´¾æ¨¡å‹ï¼ˆParents Delegation Modelï¼‰ã€‚è¯¥æ¨¡å‹è¦æ±‚é™¤äº†é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨å¤–ï¼Œå…¶ä½™çš„ç±»åŠ è½½å™¨éƒ½åº”æœ‰è‡ªå·±çš„çˆ¶ç±»åŠ è½½å™¨ï¼Œè¿™é‡Œç±»åŠ è½½å™¨ä¹‹é—´çš„çˆ¶å­å…³ç³»ä¸€èˆ¬é€šè¿‡ç»„åˆï¼ˆCompositionï¼‰å…³ç³»æ¥å®ç°ï¼Œè€Œä¸æ˜¯é€šè¿‡ç»§æ‰¿ï¼ˆInheritanceï¼‰çš„å…³ç³»å®ç°ã€‚</p><h2 id="3-1-å·¥ä½œè¿‡ç¨‹"><a href="#3-1-å·¥ä½œè¿‡ç¨‹" class="headerlink" title="3.1 å·¥ä½œè¿‡ç¨‹"></a>3.1 å·¥ä½œè¿‡ç¨‹</h2><p>å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½çš„è¯·æ±‚ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼Œæ¯ä¸€ä¸ªå±‚æ¬¡çš„ç±»åŠ è½½å™¨éƒ½æ˜¯å¦‚æ­¤ï¼Œå› æ­¤æ‰€æœ‰çš„åŠ è½½è¯·æ±‚æœ€ç»ˆéƒ½åº”è¯¥ä¼ é€åˆ°é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ä¸­ï¼Œåªæœ‰å½“çˆ¶åŠ è½½å™¨åé¦ˆè‡ªå·±æ— æ³•å®Œæˆè¿™ä¸ªåŠ è½½è¯·æ±‚æ—¶ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ã€‚</p><p>è¿™æ ·çš„å¥½å¤„æ˜¯Javaç±»éšç€å®ƒçš„ç±»åŠ è½½å™¨ä¸€èµ·å…·å¤‡äº†ä¸€ç§å¸¦æœ‰ä¼˜å…ˆçº§çš„å±‚æ¬¡å…³ç³»ã€‚æ— è®ºå“ªä¸ªç±»åŠ è½½å™¨è¦åŠ è½½è¿™ä¸ªç±»ï¼Œæœ€ç»ˆéƒ½æ˜¯å§”æ´¾ç»™å¤„äºæ¨¡å‹æœ€é¡¶ç«¯çš„å¯åŠ¨ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ï¼Œå› æ­¤Objectç±»åœ¨ç¨‹åºçš„å„ç§ç±»åŠ è½½å™¨ç¯å¢ƒä¸­éƒ½æ˜¯åŒä¸€ä¸ªç±»ã€‚</p><p>ç›¸åï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å¼ï¼Œç”±å„ä¸ªç±»åŠ è½½å™¨è‡ªè¡Œå»åŠ è½½çš„è¯ï¼Œå¦‚æœç”¨æˆ·è‡ªå·±ç¼–å†™äº†ä¸€ä¸ªç§°ä¸ºjava.lang.Objectçš„ç±»ï¼Œå¹¶æ”¾åœ¨ç¨‹åºçš„ClassPathä¸­ï¼Œé‚£ç³»ç»Ÿä¸­å°†ä¼šå‡ºç°å¤šä¸ªä¸åŒçš„Objectç±»ï¼ŒJavaç±»å‹ä½“ç³»ä¸­æœ€åŸºç¡€çš„è¡Œä¸ºä¹Ÿå°±æ— æ³•ä¿è¯ï¼Œåº”ç”¨ç¨‹åºä¹Ÿå°†ä¼šå˜å¾—ä¸€ç‰‡æ··ä¹±ã€‚</p><h2 id="3-2-å®ç°"><a href="#3-2-å®ç°" class="headerlink" title="3.2 å®ç°"></a>3.2 å®ç°</h2><p>åŒäº²å§”æ´¾æ¨¡å‹çš„å®ç°å¾ˆç®€å•ï¼Œä¸»è¦éƒ½é›†ä¸­åœ¨java.lang.ClassLoaderçš„loadClass()æ–¹æ³•ä¸­ï¼šå…ˆæ£€æŸ¥æ˜¯å¦å·²ç»è¢«åŠ è½½è¿‡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±è°ƒç”¨çˆ¶åŠ è½½å™¨çš„loadClass()ï¼Œè‹¥çˆ¶åŠ è½½å™¨ä¸ºç©ºï¼Œåˆ™é»˜è®¤ä½¿ç”¨å¯åŠ¨ç±»åŠ è½½å™¨ä½œä¸ºçˆ¶åŠ è½½å™¨ã€‚å¦‚æœçˆ¶ç±»åŠ è½½å¤±è´¥ï¼ŒæŠ›å‡ºClassNotFoundExceptionå¼‚å¸¸åï¼Œå†è°ƒç”¨è‡ªå·±çš„findClass()æ–¹æ³•è¿›è¡ŒåŠ è½½ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">synchronized</span> Class&lt;?&gt; loadClass(String name,<span class="type">boolean</span> resolve)<span class="keyword">throws</span> ClassNotFoundException&#123;</span><br><span class="line">    <span class="comment">// é¦–å…ˆï¼Œæ£€æŸ¥è¯·æ±‚çš„ç±»æ˜¯å¦å·²ç»åŠ è½½è¿‡äº†</span></span><br><span class="line">    <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> findLoadedClass(name);</span><br><span class="line">    <span class="keyword">if</span>(c == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(parent != <span class="literal">null</span>)&#123;</span><br><span class="line">                c = parent.loadClass(name,<span class="literal">false</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                c = findBootstrapClassOrNull(name);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(ClassNotFoundException e)&#123;</span><br><span class="line">            <span class="comment">// å¦‚æœçˆ¶ç±»åŠ è½½å™¨æŠ›å‡ºClassNotFoundException</span></span><br><span class="line">            <span class="comment">// è¯´æ˜çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®ŒæˆåŠ è½½è¯·æ±‚</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(c == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">// åœ¨çˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½çš„æ—¶å€™</span></span><br><span class="line">            <span class="comment">// å†è°ƒç”¨æœ¬èº«çš„findClassæ–¹æ³•è¿›è¡Œç±»åŠ è½½</span></span><br><span class="line">            c = findClass(name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(resolve)&#123;</span><br><span class="line">        resolveClass(c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="4-ç ´ååŒäº²å§”æ´¾æ¨¡å‹"><a href="#4-ç ´ååŒäº²å§”æ´¾æ¨¡å‹" class="headerlink" title="4. ç ´ååŒäº²å§”æ´¾æ¨¡å‹"></a>4. ç ´ååŒäº²å§”æ´¾æ¨¡å‹</h1><p>ä¸‰ç§ç ´ååŒäº²å§”æ´¾æ¨¡å‹çš„æ–¹å¼ï¼š</p><h2 id="4-1-JDK1-2å¼•å…¥çš„åŒäº²å§”æ´¾æ¨¡å‹å’ŒJDK1-0å°±æœ‰çš„ClassLoader"><a href="#4-1-JDK1-2å¼•å…¥çš„åŒäº²å§”æ´¾æ¨¡å‹å’ŒJDK1-0å°±æœ‰çš„ClassLoader" class="headerlink" title="4.1 JDK1.2å¼•å…¥çš„åŒäº²å§”æ´¾æ¨¡å‹å’ŒJDK1.0å°±æœ‰çš„ClassLoader"></a>4.1 JDK1.2å¼•å…¥çš„åŒäº²å§”æ´¾æ¨¡å‹å’ŒJDK1.0å°±æœ‰çš„ClassLoader</h2><p>åŒäº²å§”æ´¾æ¨¡å‹æ˜¯JDK1.2ä¹‹åæ‰è¢«å¼•ç”¨çš„ï¼Œè€Œåœ¨JDK1.0å°±æœ‰ClassLoaderäº†ã€‚æ‰€ä»¥é¢å¯¹å·²å­˜åœ¨çš„ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„å®ç°ä»£ç ï¼ŒJavaè®¾è®¡è€…å¼•å…¥äº†åŒäº²å§”æ´¾æ¨¡å‹æ—¶ä¸å¾—ä¸åšå‡ºä¸€äº›å¦¥åã€‚</p><p>ä¸ºäº†å‘å‰å…¼å®¹ï¼ŒJDK1.2ä¹‹åçš„java.lang.ClassLoaderæ·»åŠ äº†ä¸€ä¸ªæ–°çš„protectedæ–¹æ³•findClass()ã€‚å¼€å‘è€…åªéœ€è¦å°†è‡ªå·±çš„ç±»åŠ è½½é€»è¾‘ä»£ç å†™åˆ°findClass()æ–¹æ³•ä¸­ï¼Œåœ¨loadClass()æ–¹æ³•çš„é€»è¾‘é‡Œå¦‚æœçˆ¶ç±»åŠ è½½å¤±è´¥ï¼Œå°±ä¼šè°ƒç”¨è‡ªå·±çš„findClass()æ–¹æ³•æ¥å®ŒæˆåŠ è½½ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯æ–°å†™å‡ºæ¥çš„ç±»åŠ è½½å™¨ç¬¦åˆåŒäº²å§”æ´¾è§„åˆ™ã€‚</p><h2 id="4-2-çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨"><a href="#4-2-çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨" class="headerlink" title="4.2 çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨"></a>4.2 çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨</h2><p>è¿™ä¸ªæ˜¯å› ä¸ºåŒäº²å§”æ´¾æ¨¡å¼è‡ªèº«è®¾è®¡ç¼ºé™·å¯¼è‡´çš„ã€‚</p><p>åŒäº²å§”æ´¾å¾ˆå¥½è§£å†³äº†å„ä¸ªç±»åŠ è½½å™¨çš„åŸºç¡€ç±»ç»Ÿä¸€çš„é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœåŸºç¡€ç±»è¦è°ƒç”¨ä¼šç”¨æˆ·çš„ä»£ç å’‹åŠï¼Ÿ</p><p>è¿™ä¸ªä½¿ç”¨åœºæ™¯æˆ‘ä¸å¤ªäº†è§£ï¼Œæˆ‘çœ‹ä¹¦ä¸Šå’Œåˆ«äººåšå®¢ä¸Šçš„ä¾‹å­ä¹Ÿçœ‹ä¸æ‡‚ã€‚æˆ‘åªèƒ½æŠ„ä¸€ä¸‹åˆ«äººçš„ä¾‹å­ã€‚</p><blockquote><p>Java æä¾›äº†å¾ˆå¤šæœåŠ¡æä¾›è€…æ¥å£ï¼ˆService Provider Interfaceï¼ŒSPIï¼‰ï¼Œå…è®¸ç¬¬ä¸‰æ–¹ä¸ºè¿™äº›æ¥å£æä¾›å®ç°ã€‚å¸¸è§çš„ SPI æœ‰ JDBCã€JCEã€JNDIã€JAXP å’Œ JBI ç­‰ã€‚è¿™äº› SPI çš„æ¥å£ç”± Java æ ¸å¿ƒåº“æ¥æä¾›ï¼Œå¦‚ JAXP çš„ SPI æ¥å£å®šä¹‰åŒ…å«åœ¨ javax.xml.parsersåŒ…ä¸­ã€‚è¿™äº› SPI çš„å®ç°ä»£ç å¾ˆå¯èƒ½æ˜¯ä½œä¸º Java åº”ç”¨æ‰€ä¾èµ–çš„ jar åŒ…è¢«åŒ…å«è¿›æ¥ï¼Œå¯ä»¥é€šè¿‡ç±»è·¯å¾„ï¼ˆClassPathï¼‰æ¥æ‰¾åˆ°ï¼Œå¦‚å®ç°äº† JAXP SPI çš„ Apache Xercesæ‰€åŒ…å«çš„ jar åŒ…ã€‚SPI æ¥å£ä¸­çš„ä»£ç ç»å¸¸éœ€è¦åŠ è½½å…·ä½“çš„å®ç°ç±»ã€‚å¦‚ JAXP ä¸­çš„ javax.xml.parsers.DocumentBuilderFactoryç±»ä¸­çš„ newInstance() æ–¹æ³•ç”¨æ¥ç”Ÿæˆä¸€ä¸ªæ–°çš„ DocumentBuilderFactory çš„å®ä¾‹ã€‚è¿™é‡Œçš„å®ä¾‹çš„çœŸæ­£çš„ç±»æ˜¯ç»§æ‰¿è‡ª javax.xml.parsers.DocumentBuilderFactoryï¼Œç”± SPI çš„å®ç°æ‰€æä¾›çš„ã€‚å¦‚åœ¨ Apache Xerces ä¸­ï¼Œå®ç°çš„ç±»æ˜¯ org.apache.xerces.jaxp.DocumentBuilderFactoryImplã€‚è€Œé—®é¢˜åœ¨äºï¼ŒSPI çš„æ¥å£æ˜¯Java æ ¸å¿ƒåº“çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯ç”±å¼•å¯¼ç±»åŠ è½½å™¨åŠ è½½çš„ï¼Œè€ŒSPI å®ç°çš„ Java ç±»ä¸€èˆ¬æ˜¯ç”±ç³»ç»Ÿç±»åŠ è½½å™¨åŠ è½½çš„ã€‚å¼•å¯¼ç±»åŠ è½½å™¨æ˜¯æ— æ³•æ‰¾åˆ° SPI çš„å®ç°ç±»çš„ï¼Œå› ä¸ºå®ƒåªåŠ è½½ Java çš„æ ¸å¿ƒåº“ã€‚å®ƒä¹Ÿä¸èƒ½å§”æ´¾ç»™ç³»ç»Ÿç±»åŠ è½½å™¨ï¼Œå› ä¸ºå®ƒæ˜¯ç³»ç»Ÿç±»åŠ è½½å™¨çš„ç¥–å…ˆç±»åŠ è½½å™¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç±»åŠ è½½å™¨çš„åŒäº²å§”æ´¾æ¨¡å‹æ— æ³•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒJavaè®¾è®¡å›¢é˜Ÿåªå¥½å¼•å…¥äº†ä¸€ä¸ªä¸å¤ªä¼˜é›…çš„è®¾è®¡ï¼šçº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼ˆThread Context ClassLoaderï¼‰ã€‚çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ˜¯ä» JDK 1.2 å¼€å§‹å¼•å…¥çš„ã€‚ç±» java.lang.Threadä¸­çš„æ–¹æ³• getContextClassLoader()å’Œ setContextClassLoader(ClassLoader cl)ç”¨æ¥è·å–å’Œè®¾ç½®çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‚å¦‚æœæ²¡æœ‰é€šè¿‡ setContextClassLoader(ClassLoader cl)æ–¹æ³•è¿›è¡Œè®¾ç½®çš„è¯ï¼Œçº¿ç¨‹å°†ç»§æ‰¿å…¶çˆ¶çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‚Java åº”ç”¨è¿è¡Œçš„åˆå§‹çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ˜¯åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ã€‚åœ¨çº¿ç¨‹ä¸­è¿è¡Œçš„ä»£ç å¯ä»¥é€šè¿‡æ­¤ç±»åŠ è½½å™¨æ¥åŠ è½½ç±»å’Œèµ„æºã€‚</p></blockquote><h2 id="4-3-ç¨‹åºåŠ¨æ€æ€§"><a href="#4-3-ç¨‹åºåŠ¨æ€æ€§" class="headerlink" title="4.3 ç¨‹åºåŠ¨æ€æ€§"></a>4.3 ç¨‹åºåŠ¨æ€æ€§</h2><p>è¿™é‡Œæ‰€è¯´çš„â€œåŠ¨æ€æ€§â€æŒ‡çš„æ˜¯å½“å‰ä¸€äº›éå¸¸çƒ­é—¨çš„åè¯ï¼šä»£ç çƒ­æ›¿æ¢ï¼ˆHotSwapï¼‰ã€æ¨¡å—çƒ­éƒ¨ç½²(Hot Deployment)ç­‰ã€‚å³å¸Œæœ›åº”ç”¨ç¨‹åºèƒ½åƒè®¡ç®—æœºçš„å¤–è®¾ä¸€æ ·ï¼Œæ¥ä¸Šé¼ æ ‡ã€é”®ç›˜ï¼Œä¸ç”¨é‡å¯å°±èƒ½ç«‹å³ä½¿ç”¨ï¼Œé¼ æ ‡å‡ºäº†é—®é¢˜æˆ–éœ€è¦å‡çº§å°±æ¢ä¸ªé¼ æ ‡ï¼Œä¸ç”¨åœæœºæˆ–é‡å¯ã€‚</p><p>å½“å‰ä¸šç•Œâ€œäº‹å®ä¸Šâ€çš„Javaæ¨¡å—åŒ–æ ‡å‡†æ˜¯OSGiï¼Œè€ŒOSGiå®ç°ä»£ç çƒ­éƒ¨ç½²çš„å…³é”®åˆ™æ˜¯å®ƒè‡ªå®šä¹‰çš„ç±»æœºè½½å™¨çš„å®ç°ã€‚</p><p>æ¯ä¸€ä¸ªç¨‹åºæ¨¡å—ï¼ˆOSGiä¸­ç§°ä¸ºBundleï¼‰éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œå½“éœ€è¦æ›´æ¢ä¸€ä¸ªBundleæ—¶ï¼Œå°±æŠŠBundleè¿åŒç±»åŠ è½½å™¨ä¸€èµ·æ¢æ‰ä»¥å®ç°ä»£ç çš„çƒ­æ›¿æ¢ã€‚</p><p>åœ¨OSGiç¯å¢ƒä¸‹ï¼Œç±»åŠ è½½å™¨ä¸å†æ˜¯åŒäº²å§”æ´¾æ¨¡å‹ä¸­çš„æ ‘çŠ¶ç»“æ„ï¼Œè€Œæ˜¯è¿›ä¸€æ­¥å‘å±•ä¸ºæ›´åŠ å¤æ‚çš„ç½‘çŠ¶ç»“æ„ï¼Œå½“æ”¶åˆ°ç±»åŠ è½½è¯·æ±‚æ—¶ï¼ŒOSGiå°†æŒ‰ç…§ä¸‹é¢çš„é¡ºåºè¿›è¡Œç±»æœç´¢ï¼š</p><ol><li>å°†ä»¥java.*å¼€å¤´çš„ç±»å§”æ´¾ç»™åˆ†ç±»åŠ è½½å™¨åŠ è½½</li><li>å¦åˆ™ï¼Œå°†å§”æ´¾åˆ—è¡¨åå•å†…çš„ç±»å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨åŠ è½½</li><li>å¦åˆ™ï¼Œå°†importåˆ—è¡¨ä¸­çš„ç±»å§”æ´¾ç»™Exportè¿™ä¸ªç±»çš„Bundleçš„ç±»åŠ è½½å™¨åŠ è½½</li><li>å¦åˆ™ï¼ŒæŸ¥æ‰¾å½“å‰Bundleçš„ClassPathï¼Œä½¿ç”¨è‡ªå·±çš„ç±»åŠ è½½å™¨åŠ è½½</li><li>å¦åˆ™ï¼ŒæŸ¥æ‰¾ç±»æ˜¯å¦åœ¨è‡ªå·±çš„Fragment Bundleä¸­ï¼Œå¦‚æœåœ¨ï¼Œåˆ™å§”æ´¾ç»™Fragment Bundleçš„ç±»åŠ è½½å™¨åŠ è½½</li><li>å¦åˆ™ï¼ŒæŸ¥æ‰¾Dynamic Importåˆ—è¡¨çš„Bundleï¼Œå§”æ´¾ç»™å¯¹åº”Bundleçš„ç±»åŠ è½½å™¨åŠ è½½</li><li>å¦åˆ™ï¼Œç±»æŸ¥æ‰¾å¤±è´¥</li></ol>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Java/">Java</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Java/">Java</category>
      
      <category domain="https://www.littlecorgi.top/tags/JVM/">JVM</category>
      
      
      <comments>https://www.littlecorgi.top/posts/594da31f.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>æ·±å…¥ç†è§£JVM-è™šæ‹Ÿæœºç±»åŠ è½½æœºåˆ¶</title>
      <link>https://www.littlecorgi.top/posts/65c09aaf.html</link>
      <guid>https://www.littlecorgi.top/posts/65c09aaf.html</guid>
      <pubDate>Sun, 24 Nov 2019 07:45:00 GMT</pubDate>
      
        
        
          
          
      <description></description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h1><p>è™šæ‹ŸæœºæŠŠæè¿°ç±»çš„æ•°æ®ä»Classæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œæ ¡éªŒã€è½¬æ¢è§£æå’Œåˆå§‹åŒ–ï¼Œæœ€ç»ˆå½¢æˆå¯ä»¥è¢«è™šæ‹Ÿæœºç›´æ¥ä½¿ç”¨çš„Javaç±»å‹ï¼Œè¿™å°±æ˜¯è™šæ‹Ÿæœºçš„ç±»åŠ è½½æœºåˆ¶ã€‚</p><p>Javaç±»å‹çš„åŠ è½½ã€è¿æ¥å’Œåˆå§‹åŒ–è¿‡ç¨‹éƒ½æ˜¯åœ¨ç¨‹åºè¿è¡ŒæœŸé—´å®Œæˆçš„ï¼Œä¸ºJavaåº”ç”¨ç¨‹åºæä¾›é«˜åº¦çš„çµæ´»æ€§</p><h1 id="2-ç±»åŠ è½½çš„æ—¶æœº"><a href="#2-ç±»åŠ è½½çš„æ—¶æœº" class="headerlink" title="2. ç±»åŠ è½½çš„æ—¶æœº"></a>2. ç±»åŠ è½½çš„æ—¶æœº</h1><p>ç±»ä»è¢«åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸­å¼€å§‹ï¼Œåˆ°å¸è½½å¤„å†…å­˜ä¸ºæ­¢<br>å®ƒçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬ï¼š</p><ul><li>åŠ è½½ï¼ˆLoadingï¼‰</li><li>éªŒè¯ ï¼ˆVerificationï¼‰</li><li>å‡†å¤‡ï¼ˆPreparationï¼‰</li><li>è§£æï¼ˆResolutionï¼‰</li><li>åˆå§‹åŒ–ï¼ˆInitializationï¼‰</li><li>ä½¿ç”¨ï¼ˆUsingï¼‰</li><li>å¸è½½ï¼ˆUnloadingï¼‰</li></ul><p>éªŒè¯ã€è§£æã€å‡†å¤‡ç»Ÿç§°ä¸ºè¿æ¥ï¼ˆLinkingï¼‰</p><p>å…¶ä¸­ï¼ŒåŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€åˆå§‹åŒ–å’Œå¸è½½è¿™5ä¸ªé˜¶æ®µçš„é¡ºåºæ˜¯ç¡®å®šçš„ã€‚ä½†æ˜¯è§£æä¸ä¸€å®šï¼ŒæŸäº›æƒ…å†µä¸‹å¯ä»¥åœ¨åˆå§‹åŒ–ä¹‹åå†å¼€å§‹ï¼Œè¿™æ˜¯ä¸ºäº†æ”¯æŒJavaçš„è¿è¡Œæ—¶ç»‘å®šã€‚</p><h2 id="2-1-åŠ è½½çš„æ—¶æœº"><a href="#2-1-åŠ è½½çš„æ—¶æœº" class="headerlink" title="2.1 åŠ è½½çš„æ—¶æœº"></a>2.1 åŠ è½½çš„æ—¶æœº</h2><p>è¿™ä¸ªJavaè™šæ‹Ÿæœºè§„èŒƒä¸­å¹¶æ²¡æœ‰è¿›è¡Œå¼ºåˆ¶çº¦æŸï¼Œè¿™ä¸ªå¯ä»¥äº¤ç»™è™šæ‹Ÿæœºè‡ªè®¢ã€‚</p><h2 id="2-2-åˆå§‹åŒ–çš„æ—¶æœº"><a href="#2-2-åˆå§‹åŒ–çš„æ—¶æœº" class="headerlink" title="2.2 åˆå§‹åŒ–çš„æ—¶æœº"></a>2.2 åˆå§‹åŒ–çš„æ—¶æœº</h2><p>å¯¹äºåˆå§‹åŒ–çš„æ—¶æœºï¼Œè™šæ‹Ÿæœºè§„èŒƒå¼ºåˆ¶è§„å®šåªæœ‰5ä¸­æƒ…å†µå¿…é¡»ç«‹å³å¯¹ç±»è¿›è¡Œâ€œåˆå§‹åŒ–â€</p><ul><li>é‡åˆ°<code>new</code>ã€<code>getstatic</code>ã€<code>putstatic</code>æˆ–<code>invokestatic</code>è¿™4æ¡å­—èŠ‚ç æŒ‡ä»¤æ—¶ï¼Œå¦‚æœç±»æ²¡æœ‰åˆå§‹åŒ–è¿‡ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚å¯¹åº”ç€ä½¿ç”¨<code>new</code>å…³é”®å­—å®ä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™ã€è¯»å–æˆ–è®¾ç½®ä¸€ä¸ªç±»çš„é™æ€å­—æ®µï¼ˆè¢«<code>final</code>ä¿®é¥°ã€å·²åœ¨ç¼–è¯‘æœŸæŠŠç»“æœæ”¾å…¥å¸¸é‡æ± çš„é™æ€å­—æ®µå¤–ï¼‰çš„æ—¶å€™ï¼Œä»¥åŠè°ƒç”¨ä¸€ä¸ªç±»çš„é™æ€æ–¹æ³•çš„æ—¶å€™</li><li>ä½¿ç”¨<code>java.lang.reflect</code>åŒ…çš„æ–¹æ³•å¯¹ç±»è¿›è¡Œåå°„è°ƒç”¨çš„æ—¶å€™ï¼Œå¦‚æœç±»æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–</li><li>å½“åˆå§‹åŒ–ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°å…¶çˆ¶ç±»è¿˜æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶çˆ¶ç±»çš„åˆå§‹åŒ–</li><li>å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦åˆ¶å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼ˆåŒ…å«main()æ–¹æ³•çš„é‚£ä¸ªç±»ï¼‰ï¼Œè™šæ‹Ÿæœºä¼šå…ˆåˆå§‹åŒ–è¿™ä¸ªä¸»ç±»</li><li>å½“ä½¿ç”¨JDK1.7çš„åŠ¨æ€è¯­è¨€æ”¯æŒæ—¶ï¼Œå¦‚æœä¸€ä¸ª<code>java.lang.invoke.MethodHandle</code>å®ä¾‹æœ€åçš„è§£æç»“æœ<code>REF_getStatic</code>ã€<code>REF_putStatic</code>ã€<code>REF_invokeStatic</code>çš„æ–¹æ³•å¥æŸ„ï¼Œå¹¶ä¸”è¿™ä¸ªæ–¹æ³•å¥æŸ„æ‰€å¯¹åº”çš„ç±»æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–</li></ul><p>è€Œå¯¹äºæ¥å£ï¼Œå½“ä¸€ä¸ªæ¥å£åœ¨åˆå§‹åŒ–æ—¶ï¼Œå¹¶ä¸è¦æ±‚å…¶çˆ¶æ¥å£å…¨éƒ¨éƒ½å®Œæˆäº†åˆå§‹åŒ–ï¼Œåªæœ‰åœ¨çœŸæ­£ä½¿ç”¨åˆ°çˆ¶æ¥å£æ—¶ï¼ˆå¦‚å¼•ç”¨çˆ¶æ¥å£ä¸­å®šä¹‰çš„å¸¸é‡ï¼‰æ‰ä¼šåˆå§‹åŒ–ã€‚</p><p>è¿™äº”ç§åœºæ™¯ä¸­çš„è¡Œä¸ºç§°ä¸ºå¯¹ä¸€ä¸ªç±»è¿›è¡Œä¸»åŠ¨å¼•ç”¨<br>æ‰€æœ‰å¼•ç”¨ç±»çš„æ–¹å¼éƒ½ä¸ä¼šè§¦å‘åˆå§‹åŒ–ï¼Œè¢«ç§°ä¸ºè¢«åŠ¨å¼•ç”¨ã€‚</p><ul><li><p>é€šè¿‡å­ç±»å¼•ç”¨çˆ¶ç±»çš„é™æ€å­—æ®µï¼Œä¸ä¼šå¯¼è‡´å­ç±»åˆå§‹åŒ–ã€‚<br>  å¯¹äºé™æ€å­—æ®µï¼Œåªæœ‰ç›´æ¥å®šä¹‰è¿™ä¸ªå­—æ®µçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ–ï¼Œå› æ­¤é€šè¿‡å…¶å­ç±»æ¥å¼•ç”¨çˆ¶ç±»ä¸­çš„é™æ€å­—æ®µï¼Œåªä¼šè§¦å‘çˆ¶ç±»çš„åˆå§‹åŒ–ï¼Œè€Œä¸ä¼šè§¦å‘å­ç±»çš„åˆå§‹åŒ–</p></li><li><p>é€šè¿‡æ•°ç»„å®šä¹‰æ¥å¼•ç”¨ç±»ï¼Œä¸ä¼šè§¦å‘æ­¤ç±»çš„åˆå§‹åŒ–</p></li><li>å¸¸é‡åœ¨ç¼–è¯‘é˜¶æ®µä¼šå­˜å‚¨è°ƒç”¨ç±»çš„å¸¸é‡æ± ä¸­ï¼Œæœ¬è´¨ä¸Šå¹¶æ²¡æœ‰ç›´æ¥å¼•ç”¨åˆ°å®šä¹‰å¸¸é‡çš„ç±»ï¼Œå› æ­¤ä¸ä¼šè§¦å‘å®šä¹‰å¸¸é‡çš„ç±»çš„åˆå§‹åŒ–</li></ul><h1 id="3-ç±»åŠ è½½çš„è¿‡ç¨‹"><a href="#3-ç±»åŠ è½½çš„è¿‡ç¨‹" class="headerlink" title="3. ç±»åŠ è½½çš„è¿‡ç¨‹"></a>3. ç±»åŠ è½½çš„è¿‡ç¨‹</h1><p>åˆ†ä¸ºåŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æå’Œåˆå§‹åŒ–5ä¸ªé˜¶æ®µ</p><h2 id="3-1-åŠ è½½"><a href="#3-1-åŠ è½½" class="headerlink" title="3.1 åŠ è½½"></a>3.1 åŠ è½½</h2><p>åŠ è½½æ˜¯ç±»åŠ è½½ä¸­çš„ä¸€ä¸ªé˜¶æ®µã€‚</p><p>åœ¨åŠ è½½é˜¶æ®µï¼Œè™šæ‹Ÿæœºéœ€è¦å®Œæˆä»¥ä¸‹3ä»¶äº‹</p><ul><li>é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ</li><li>å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„</li><li>åœ¨å†…å­˜æ±‡æ€»ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„<code>java.lang.Class</code>å¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥å£</li></ul><p>è™šæ‹Ÿæœºå¯¹è¿™å‡ ç‚¹çš„è¦æ±‚å…¶å®å¹¶ä¸å…·ä½“ï¼Œå› æ­¤è™šæ‹Ÿæœºå®ç°ä¸å…·ä½“åº”ç”¨çš„çµæ´»åº¦éƒ½æ˜¯ç›¸å½“å¤§çš„ã€‚</p><p>ä¾‹å¦‚ç¬¬ä¸€æ¡ï¼Œä»–åªè¯´äº†è·å–äºŒè¿›åˆ¶å­—èŠ‚æµï¼Œä½†æ˜¯æ²¡è¯´å…·ä½“ä»å“ªè·å–ã€‚æ‰€ä»¥è¿™ä¸€ç‚¹ä¸ºå¾ˆå¤šJavaæŠ€æœ¯éƒ½å»ºç«‹äº†åŸºç¡€ï¼š</p><ul><li>ä»ZIPåŒ…è¯»å–ï¼Œè¿™å¾ˆå¸¸è§ï¼Œæœ€ç»ˆæˆä¸ºæ—¥åJARã€EARã€WARæ ¼å¼çš„åŸºç¡€ã€‚</li><li>ä»ç½‘ç»œä¸­è·å–ï¼Œè¿™ç§åœºæ™¯æœ€å…¸å‹çš„åº”ç”¨æ˜¯Appletã€‚</li><li>è¿è¡Œæ—¶è®¡ç®—ç”Ÿæˆï¼Œè¿™ç§åœºæ™¯ä½¿ç”¨å¾—æœ€å¤šå¾—å°±æ˜¯åŠ¨æ€ä»£ç†æŠ€æœ¯ï¼Œåœ¨<code>java.lang.reflect.Proxy</code>ä¸­ï¼Œå°±æ˜¯ç”¨äº†<code>ProxyGenerator.generateProxyClass</code>çš„ä»£ç†ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµã€‚</li><li>ç”±å…¶ä»–æ–‡ä»¶ç”Ÿæˆï¼Œå…¸å‹åœºæ™¯æ˜¯JSPåº”ç”¨ï¼Œå³ç”±JSPæ–‡ä»¶ç”Ÿæˆå¯¹åº”çš„Classç±»ã€‚</li><li>ä»æ•°æ®åº“è¯»å–ï¼Œè¿™ç§åœºæ™¯ç›¸å¯¹å°‘è§ï¼Œä¾‹å¦‚æœ‰äº›ä¸­é—´ä»¶æœåŠ¡å™¨ï¼ˆå¦‚SAP Netweaverï¼‰å¯ä»¥é€‰æ‹©æŠŠç¨‹åºå®‰è£…åˆ°æ•°æ®åº“ä¸­æ¥å®Œæˆç¨‹åºä»£ç åœ¨é›†ç¾¤é—´çš„åˆ†å‘ã€‚</li></ul><h3 id="3-1-1-éæ•°ç»„ç±»çš„åŠ è½½"><a href="#3-1-1-éæ•°ç»„ç±»çš„åŠ è½½" class="headerlink" title="3.1.1 éæ•°ç»„ç±»çš„åŠ è½½"></a>3.1.1 éæ•°ç»„ç±»çš„åŠ è½½</h3><p>ç›¸å¯¹äºç±»åŠ è½½è¿‡ç¨‹çš„å…¶å®ƒé˜¶æ®µï¼Œä¸€ä¸ªéæ•°ç»„ç±»çš„åŠ è½½é˜¶æ®µæ˜¯å¼€å‘äººå‘˜å¯æ§æ€§æœ€å¼ºçš„ã€‚å› ä¸ºåŠ è½½é˜¶æ®µæ—¢å¯ä»¥ä½¿ç”¨ç³»ç»Ÿæä¾›çš„å¼•å¯¼ç±»åŠ è½½ç±»å»å®Œæˆï¼Œä¹Ÿå¯ä»¥ç”±ç”¨æˆ·è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨å»å®Œæˆï¼Œé€šè¿‡å®šä¹‰è‡ªå·±çš„ç±»åŠ è½½å™¨å»æ§åˆ¶å­—èŠ‚æµçš„è·å–ï¼Œå³é‡å†™ä¸€ä¸ªç±»åŠ è½½å™¨çš„<code>loadClass()</code>æ–¹æ³•ã€‚</p><h3 id="3-1-2-æ•°ç»„ç±»çš„åŠ è½½"><a href="#3-1-2-æ•°ç»„ç±»çš„åŠ è½½" class="headerlink" title="3.1.2 æ•°ç»„ç±»çš„åŠ è½½"></a>3.1.2 æ•°ç»„ç±»çš„åŠ è½½</h3><p>æ•°æ®ç±»æœ¬èº«ä¸é€šè¿‡ç±»åŠ è½½å™¨åˆ›å»ºï¼Œå¥¹æ˜¯ç”±Javaè™šæ‹Ÿæœºç›´æ¥åˆ›å»ºçš„ã€‚</p><p>ä½†æ˜¯æ•°æ®ç±»çš„å…ƒç´ ç±»å‹ï¼ˆæ•°ç»„å»æ‰æ‰€æœ‰ç»´åº¦çš„ç±»å‹ï¼‰æœ€ç»ˆæ˜¯è¦é åŠ è½½å™¨å»åˆ›å»ºã€‚</p><p>ä¸€ä¸ªæ•°ç»„ç±»åˆ›å»ºè¿‡ç¨‹å¿…é¡»éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š</p><ul><li>å¦‚æœæ•°ç»„çš„ç»„ä»¶ç±»å‹ï¼ˆæ•°ç»„å»æ‰ä¸€ä¸ªç»´åº¦çš„ç±»å‹ï¼‰æ˜¯å¼•ç”¨ç±»å‹ï¼Œé‚£å°±é€’å½’é‡‡ç”¨æœ¬ä¹¦å®šä¹‰çš„åŠ è½½è¿‡ç¨‹å»åŠ è½½è¿™ä¸ªç»„ä»¶ç±»å‹ï¼Œæ•°ç»„ç±»å°†åœ¨åŠ è½½è¯¥ç»„ä»¶ç±»å‹çš„ç±»åŠ è½½å™¨çš„ç±»åç§°ç©ºé—´ä¸Šè¢«æ ‡è¯†</li><li>å¦‚æœæ•°ç»„çš„ç»„ä»¶ç±»å‹ä¸æ˜¯å¼•ç”¨ç±»å‹ï¼ŒJavaè™šæ‹Ÿæœºå°†ä¼šæ•°ç»„ç±»æ ‡è®°ä¸ºä¸å¼•å¯¼ç±»åŠ è½½å™¨å…³è”</li><li>æ•°ç»„ç±»çš„å¯è§æ€§ä¸ä»–çš„ç»„ä»¶ç±»å‹çš„å¯è§æ€§ä¸€è‡´ï¼Œå¦‚æœç»„ä»¶ç±»å‹ä¸æ˜¯å¼•ç”¨ç±»å‹ï¼Œé‚£æ•°ç»„ç±»çš„å¯è§æ€§å°†é»˜è®¤ä¸ºpublic</li></ul><p>åŠ è½½é˜¶æ®µå®Œæˆåï¼Œè™šæ‹Ÿæœºå¤–éƒ¨çš„äºŒè¿›åˆ¶å­—èŠ‚æµå°±æŒ‰ç…§è™šæ‹Ÿæœºæ‰€éœ€çš„æ ¼å¼å­˜å‚¨åœ¨æ–¹æ³•åŒºä¹‹ä¸­ï¼Œæ–¹æ³•åŒºä¸­çš„æ•°æ®å­˜å‚¨æ ¼å¼ç”±è™šæ‹Ÿæœºå®ç°è‡ªè¡Œå®šä¹‰ï¼Œè™šæ‹Ÿæœºè§„èŒƒæœªè§„å®šæ­¤åŒºåŸŸçš„å…·ä½“æ•°æ®ç»“æ„ã€‚ç„¶ååœ¨å†…å­˜ä¸­å®ä¾‹åŒ–ä¸€ä¸ªjava.lang.Classç±»çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å°†ä½œä¸ºç¨‹åºè®¿é—®æ–¹æ³•åŒºä¸­çš„è¿™äº›ç±»å‹æ•°æ®çš„å¤–éƒ¨æ¥å£ã€‚</p><h2 id="3-2-éªŒè¯"><a href="#3-2-éªŒè¯" class="headerlink" title="3.2 éªŒè¯"></a>3.2 éªŒè¯</h2><p>éªŒè¯æ˜¯è¿æ¥é˜¶æ®µçš„ç¬¬ä¸€æ­¥ï¼Œä¸ºäº†ç¡®ä¿è¾“å…¥çš„Classæ–‡ä»¶çš„å­—èŠ‚æµèƒ½æ­£ç¡®åœ°è§£æå¹¶å­˜å‚¨äºæ–¹æ³•åŒºä¹‹å†…ï¼Œæ ¼å¼ä¸Šç¬¦åˆæè¿°ä¸€ä¸ªJavaç±»å‹ä¿¡æ¯çš„è¦æ±‚ï¼Œå¹¶ä¸”ä¸ä¼šå±å®³è™šæ‹Ÿæœºè‡ªèº«çš„å®‰å…¨ã€‚</p><p>å¦‚æœä¸æ£€æŸ¥è¾“å…¥çš„å­—èŠ‚æµï¼Œå¯¹é½å®Œå…¨ä¿¡ä»»çš„è¯ï¼Œå¾ˆå¯èƒ½ä¼šå› ä¸ºè½½å…¥äº†æœ‰å®³çš„å­—èŠ‚æµè€Œå¯¼è‡´ç³»ç»Ÿå´©æºƒï¼Œæ‰€ä»¥éªŒè¯æ˜¯è™šæ‹Ÿæœºå¯¹è‡ªèº«ä¿æŠ¤çš„ä¸€é¡¹é‡è¦å·¥ä½œã€‚</p><p>éªŒè¯é˜¶æ®µæ˜¯éå¸¸é‡è¦çš„ï¼Œè¿™ä¸ªé˜¶æ®µæ˜¯å¦ä¸¥ç‘¾ï¼Œç›´æ¥å†³å®šäº†Javaè™šæ‹Ÿæœºæ˜¯å¦èƒ½æ‰¿å—æ¶æ„ä»£ç çš„æ”»å‡»ï¼Œä»æ€§èƒ½çš„è§’åº¦ä¸Šè®²ï¼ŒéªŒè¯é˜¶æ®µçš„å·¥ä½œé‡åœ¨è™šæ‹Ÿæœºçš„ç±»åŠ è½½å­ç³»ç»Ÿåˆå äº†ç›¸å½“å¤§çš„ä¸€éƒ¨åˆ†ã€‚</p><p>ä»æ•´ä½“ä¸Šçœ‹ï¼ŒéªŒè¯é˜¶æ®µå¤§è‡´ä¼šå®Œæˆä¸‹é¢4ä¸ªé˜¶æ®µçš„æ£€éªŒåŠ¨ä½œï¼šæ–‡ä»¶æ ¼å¼éªŒè¯ã€å…ƒæ•°æ®éªŒè¯ã€å­—èŠ‚ç éªŒè¯ã€ç¬¦å·å¼•ç”¨éªŒè¯ã€‚</p><h3 id="3-2-1-æ–‡ä»¶æ ¼å¼éªŒè¯"><a href="#3-2-1-æ–‡ä»¶æ ¼å¼éªŒè¯" class="headerlink" title="3.2.1 æ–‡ä»¶æ ¼å¼éªŒè¯"></a>3.2.1 æ–‡ä»¶æ ¼å¼éªŒè¯</h3><p>ç¬¬ä¸€é˜¶æ®µè¦éªŒè¯å­—èŠ‚æµæ˜¯å¦ç¬¦åˆClassæ–‡ä»¶æ ¼å¼çš„è§„èŒƒï¼Œå¹¶ä¸”èƒ½è¢«å½“å‰ç‰ˆæœ¬çš„è™šæ‹Ÿæœºå¤„ç†ã€‚</p><p>å¯èƒ½åŒ…æ‹¬ä»¥ä¸‹éªŒè¯ç‚¹ï¼š</p><ul><li>æ˜¯å¦ä»¥é­”æ•°0xCAFEBABEå¼€å¤´</li><li>ä¸»ã€æ¬¡ç‰ˆæœ¬å·æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºå¤„ç†èŒƒå›´ä¹‹å†…</li><li>å¸¸é‡æ± çš„å¸¸é‡ä¸­æ˜¯å¦æœ‰ä¸è¢«æ”¯æŒçš„å¸¸é‡ç±»å‹</li><li>æŒ‡å‘å¸¸é‡çš„å„ç§ç´¢å¼•å€¼æ˜¯å¦æœ‰æŒ‡å‘ä¸å­˜åœ¨çš„å¸¸é‡æˆ–ä¸ç¬¦åˆç±»å‹çš„å¸¸é‡</li><li>CONSTANT_Utf8_infoå‹çš„å¸¸é‡æ˜¯å¦æœ‰ä¸ç¬¦åˆUTF8ç¼–ç çš„æ•°æ®</li><li>Classæ–‡ä»¶ä¸­å„ä¸ªéƒ¨åˆ†åŠæ–‡ä»¶æœ¬èº«æ˜¯å¦æœ‰è¢«åˆ é™¤çš„æˆ–é™„åŠ çš„å…¶å®ƒä¿¡æ¯</li><li>â€¦â€¦</li></ul><p>è¯¥éªŒè¯é˜¶æ®µçš„ä¸»è¦ç›®çš„æ˜¯ä¿è¯è¾“å…¥çš„å­—èŠ‚æµèƒ½æ­£ç¡®åœ°è§£æå¹¶å­˜å‚¨äºæ–¹æ³•åŒºä¹‹å†…ï¼Œæ ¼å¼ä¸Šç¬¦åˆæè¿°ä¸€ä¸ªJavaç±»å‹ä¿¡æ¯çš„è¦æ±‚ã€‚</p><p>è¿™é˜¶æ®µçš„éªŒè¯æ˜¯åŸºäºäºŒè¿›åˆ¶å­—èŠ‚æµè¿›è¡Œçš„ï¼Œåªæœ‰é€šè¿‡äº†è¿™ä¸ªé˜¶æ®µçš„éªŒè¯åï¼Œå­—èŠ‚æµæ‰ä¼šè¿›å…¥å†…å­˜çš„æ–¹æ³•åŒºä¸­è¿›è¡Œå­˜å‚¨ï¼Œæ‰€ä»¥åé¢çš„3ä¸ªéªŒè¯éƒ½æ˜¯åŸºäºæ–¹æ³•åŒºçš„å­˜å‚¨ç»“æ„è¿›è¡Œçš„ï¼Œä¸ä¼šå†ç›´æ¥æ“ä½œå­—èŠ‚æµã€‚</p><h3 id="3-2-2-å…ƒæ•°æ®éªŒè¯"><a href="#3-2-2-å…ƒæ•°æ®éªŒè¯" class="headerlink" title="3.2.2 å…ƒæ•°æ®éªŒè¯"></a>3.2.2 å…ƒæ•°æ®éªŒè¯</h3><p>ç¬¬äºŒé˜¶æ®µæ˜¯å¯¹å­—èŠ‚ç æè¿°çš„ä¿¡æ¯è¿›è¡Œè¯­æ³•åˆ†æï¼Œä»¥ä¿è¯å…¶æè¿°çš„ä¿¡æ¯ç¬¦åˆJavaè¯­è¨€è§„èŒƒçš„è¦æ±‚ã€‚</p><p>å¯èƒ½åŒ…æ‹¬ä»¥ä¸‹éªŒè¯ç‚¹ï¼š</p><ul><li>è¿™ä¸ªç±»æ˜¯å¦æœ‰çˆ¶ç±»ï¼ˆé™¤äº†Objectä¹‹å¤–ï¼Œå…¶ä»–ç±»éƒ½æœ‰çˆ¶ç±»ï¼‰</li><li>è¿™ä¸ªç±»çš„çˆ¶ç±»æ˜¯å¦ç»§æ‰¿äº†ä¸å…è®¸è¢«ç»§æ‰¿çš„ç±»ï¼ˆè¢«finalä¿®é¥°çš„ç±»ï¼‰</li><li>å¦‚æœè¿™ä¸ªç±»ä¸æ˜¯æŠ½è±¡ç±»ï¼Œæ˜¯å¦å®ç°äº†å…¶çˆ¶ç±»æˆ–æ¥å£ä¸­è¦æ±‚å®ç°çš„æ–¹æ³•</li><li>ç±»ä¸­çš„å­—æ®µã€æ–¹æ³•æ˜¯å¦ä¸çˆ¶ç±»äº§ç”ŸçŸ›ç›¾</li><li>â€¦â€¦</li></ul><p>ä¸»è¦ç›®çš„æ˜¯å¯¹ç±»çš„å…ƒæ•°æ®ä¿¡æ¯å°±è¡Œè¯­ä¹‰æ£€éªŒï¼Œä¿è¯ä¸å­˜åœ¨ä¸ç¬¦åˆJavaè¯­è¨€è§„èŒƒçš„å…ƒæ•°æ®ä¿¡æ¯ã€‚</p><h3 id="3-2-3-å­—èŠ‚ç éªŒè¯"><a href="#3-2-3-å­—èŠ‚ç éªŒè¯" class="headerlink" title="3.2.3 å­—èŠ‚ç éªŒè¯"></a>3.2.3 å­—èŠ‚ç éªŒè¯</h3><p>ç¬¬ä¸‰é˜¶æ®µæ˜¯æ•´ä¸ªéªŒè¯è¿‡ç¨‹ä¸­æœ€å¤æ‚çš„ä¸€ä¸ªé˜¶æ®µï¼Œä¸»è¦ç›®çš„æ˜¯é€šè¿‡æ•°æ®æµå’Œæ§åˆ¶æµåˆ†æï¼Œç¡®å®ç¨‹åºè¯­ä¹‰æ˜¯åˆæ³•çš„ã€ç¬¦åˆé€»è¾‘çš„ã€‚</p><p>åœ¨ç¬¬äºŒé˜¶æ®µå¯¹å…ƒæ•°æ®ä¿¡æ¯ä¸­çš„æ•°æ®ç±»å‹åšå®Œæ ¡éªŒåï¼Œè¿™ä¸ªé˜¶æ®µå°†å¯¹ç±»çš„æ–¹æ³•ä½“è¿›è¡Œæ ¡éªŒåˆ†æï¼Œä¿è¯è¢«æ ¡éªŒç±»çš„æ–¹æ³•åœ¨è¿è¡Œæ—¶ä¸ä¼šåšå‡ºå±å®³è™šæ‹Ÿæœºå®‰å…¨çš„äº‹ä»¶ã€‚</p><p>ç”±äºæ•°æ®æµæ ¡éªŒçš„é«˜å¤æ‚æ€§ï¼Œè€—æ—¶è¾ƒå¤§ï¼Œæ‰€ä»¥JDK1.6ä¹‹åï¼Œåœ¨Javacä¸­å¼•å…¥ä¸€é¡¹ä¼˜åŒ–æ–¹æ³•ï¼ˆå¯ä»¥é€šè¿‡å‚æ•°å…³é—­ï¼‰ï¼šåœ¨æ–¹æ³•ä½“çš„Codeå±æ€§çš„å±æ€§è¡¨ä¸­å¢åŠ ä¸€é¡¹â€œStackMapTableâ€å±æ€§ï¼Œè¯¥å±æ€§æè¿°äº†æ–¹æ³•ä½“ä¸­æ‰€æœ‰åŸºæœ¬å—å¼€å§‹æ—¶æœ¬åœ°å˜é‡è¡¨å’Œæ“ä½œæ ˆåº”æœ‰çš„çŠ¶æ€ï¼Œä»è€Œå°†å­—èŠ‚ç éªŒè¯çš„ç±»å‹æ¨å¯¼è½¬å˜ä¸ºç±»å‹æ£€æŸ¥ä»è€ŒèŠ‚çœä¸€äº›æ—¶é—´ã€‚</p><p>å¦‚æœä¸€ä¸ªç±»æ–¹æ³•ä½“çš„å­—èŠ‚ç æ²¡æœ‰é€šè¿‡å­—èŠ‚ç éªŒè¯ï¼Œé‚£ä¸€å®šæ˜¯æœ‰é—®é¢˜çš„ï¼›ä½†æ˜¯å¦‚æœé€šè¿‡äº†ï¼Œé‚£ä¸ä¸€å®šæ˜¯å®Œå…¨æ²¡é—®é¢˜çš„ã€‚</p><h3 id="3-2-4-ç¬¦å·å¼•ç”¨éªŒè¯"><a href="#3-2-4-ç¬¦å·å¼•ç”¨éªŒè¯" class="headerlink" title="3.2.4 ç¬¦å·å¼•ç”¨éªŒè¯"></a>3.2.4 ç¬¦å·å¼•ç”¨éªŒè¯</h3><p>æœ€åä¸€ä¸ªé˜¶æ®µçš„æ ¡éªŒå‘ç”Ÿåœ¨è™šæ‹Ÿæœºå°†ç¬¦å·å¼•ç”¨è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨çš„æ—¶å€™ï¼Œè¿™ä¸ªè½¬åŒ–åŠ¨ä½œå°†åœ¨è¿æ¥çš„ç¬¬ä¸‰é˜¶æ®µâ€”â€”è§£æé˜¶æ®µä¸­å‘ç”Ÿã€‚</p><p>ç¬¦å·å¼•ç”¨çš„éªŒè¯å¯ä»¥çœ‹åšæ˜¯å¯¹ç±»è‡ªèº«ä»¥å¤–ï¼ˆå¸¸é‡æ± ä¸­çš„å„ç§ç¬¦å·å¼•ç”¨ï¼‰çš„ä¿¡æ¯è¿›è¡ŒåŒ¹é…æ€§æ ¡éªŒï¼Œé€šå¸¸éœ€è¦æ ¡éªŒä¸‹åˆ—å†…å®¹ï¼š</p><ul><li>ç¬¦å·å¼•ç”¨ä¸­é€šè¿‡å­—ç¬¦ä¸²æè¿°çš„å…¨é™å®šåæ˜¯å¦èƒ½æ‰¾åˆ°å¯¹åº”çš„ç±»ã€‚</li><li>æŒ‡å®šçš„ç±»ä¸­æ˜¯å¦å­˜åœ¨ç¬¦åˆæè¿°ç¬¦ä¸ç®€å•åç§°æè¿°çš„æ–¹æ³•ä¸å­—æ®µã€‚</li><li>ç¬¦å·å¼•ç”¨ä¸­çš„ç±»ã€å­—æ®µã€æ–¹æ³•çš„è®¿é—®æ€§ï¼ˆprivateã€protectedã€publicã€defaultï¼‰æ˜¯å¦å¯è¢«å½“å‰ç±»è®¿é—®ã€‚</li><li>â€¦â€¦</li></ul><p>ç¬¦å·å¼•ç”¨éªŒè¯çš„ç›®çš„æ˜¯ç¡®ä¿è§£æåŠ¨ä½œèƒ½æ­£å¸¸æ‰§è¡Œï¼Œå¦‚æœæ— æ³•é€šè¿‡ç¬¦å·å¼•ç”¨éªŒè¯ï¼Œé‚£ä¹ˆå°†ä¼šæŠ›å‡ºä¸€ä¸ª<code>java.lang.IncompatibleClassChangeError</code>å¼‚å¸¸çš„å­ç±»ã€‚</p><h3 id="3-2-5-éªŒè¯æ€»ç»“"><a href="#3-2-5-éªŒè¯æ€»ç»“" class="headerlink" title="3.2.5 éªŒè¯æ€»ç»“"></a>3.2.5 éªŒè¯æ€»ç»“</h3><p>å¯¹äºjvmçš„ç±»åŠ è½½æœºåˆ¶æ¥è¯´ï¼ŒéªŒè¯é˜¶æ®µæ˜¯ä¸€ä¸ªéå¸¸é‡è¦ä½†ä¸æ˜¯ä¸€å®šå¿…è¦ï¼ˆå› ä¸ºå¯¹è¿è¡ŒæœŸæ²¡æœ‰å½±å“ï¼‰çš„é˜¶æ®µã€‚å¦‚æœæ‰€è¿è¡Œçš„å…¨éƒ¨ä»£ç éƒ½å·²ç»è¢«åå¤éªŒè¯è¿‡ï¼Œé‚£ä¹ˆåœ¨å®æ–½é˜¶æ®µå°±å¯ä»¥è€ƒè™‘ä½¿ç”¨<code>-Xverify:none</code>å‚æ•°æ¥å…³é—­å¤§éƒ¨åˆ†çš„ç±»éªŒè¯æªæ–½ï¼Œä»¥ç¼©çŸ­è™šæ‹Ÿæœºç±»åŠ è½½çš„æ—¶é—´ã€‚</p><h2 id="3-3-å‡†å¤‡"><a href="#3-3-å‡†å¤‡" class="headerlink" title="3.3 å‡†å¤‡"></a>3.3 å‡†å¤‡</h2><p>ä»»åŠ¡:</p><ul><li>ä¸ºç±»å˜é‡åˆ†é…å†…å­˜</li><li>è®¾ç½®ç±»å˜é‡åˆå§‹å€¼</li></ul><p>è¿™äº›å˜é‡æ‰€ä½¿ç”¨çš„å†…å­˜éƒ½å°†åœ¨æ–¹æ³•åŒºä¸­è¿›è¡Œåˆ†é…ã€‚</p><p>é¦–å…ˆï¼Œåœ¨å‡†å¤‡é˜¶æ®µè¿›è¡Œå†…å­˜åˆ†é…çš„ä»…åŒ…æ‹¬ç±»å˜é‡ï¼ˆè¢«staticä¿®é¥°çš„å˜é‡ï¼‰ï¼Œè€Œä¸åŒ…æ‹¬å®ä¾‹å˜é‡ï¼Œå®ä¾‹å˜é‡å°†ä¼šåœ¨å¯¹è±¡å®ä¾‹åŒ–æ—¶éšç€å¯¹è±¡ä¸€èµ·åˆ†é…åœ¨Javaå †ä¸­ã€‚</p><p>å…¶æ¬¡ï¼Œè¿™é‡Œæ‰€è¯´çš„åˆå§‹å€¼â€œé€šå¸¸æƒ…å†µâ€ä¸‹æ˜¯æ•°æ®ç±»å‹çš„é›¶å€¼ï¼Œå‡è®¾ä¸€ä¸ªç±»å˜é‡çš„å®šä¹‰ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> <span class="number">123</span>;</span><br></pre></td></tr></table></figure><p>é‚£å˜é‡valueåœ¨å‡†å¤‡é˜¶æ®µè¿‡åçš„åˆå§‹å€¼ä¸º0è€Œä¸æ˜¯123ï¼Œå› ä¸ºè¿™æ—¶å€™å°šæœªå¼€å§‹æ‰§è¡Œä»»ä½•Javaæ–¹æ³•ï¼Œè€ŒæŠŠvalueèµ‹å€¼ä¸º123çš„putstaticæŒ‡ä»¤æ˜¯ç¨‹åºè¢«ç¼–è¯‘åï¼Œå­˜æ”¾äºç±»æ„é€ å™¨<clinit>()æ–¹æ³•ä¹‹ä¸­ï¼Œæ‰€ä»¥æŠŠvalueèµ‹å€¼ä¸º123çš„åŠ¨ä½œåœ¨åˆå§‹åŒ–é˜¶æ®µæ‰ä¼šæ‰§è¡Œã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœç±»å­—æ®µçš„å­—æ®µå±æ€§ä¸­å­˜åœ¨ConstantValueå±æ€§ï¼Œé‚£åœ¨å‡†å¤‡é˜¶æ®µå˜é‡valueå°±ä¼šè¢«åˆå§‹åŒ–ä¸ºConstantValueå±æ€§æ‰€æŒ‡å®šçš„å€¼ï¼Œå‡è®¾ä¸Šé¢ç±»å˜é‡valueçš„å®šä¹‰å˜ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> <span class="number">123</span>;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘æ—¶Javacå°†ä¼šä¸ºvalueç”ŸæˆConstantValueå±æ€§ï¼Œåœ¨å‡†å¤‡é˜¶æ®µè™šæ‹Ÿæœºå°±ä¼šæ ¹æ®ConstantValueçš„è®¾ç½®å°†valueèµ‹å€¼ä¸º123ã€‚</p><h2 id="3-4-è§£æ"><a href="#3-4-è§£æ" class="headerlink" title="3.4 è§£æ"></a>3.4 è§£æ</h2><p>è§£æé˜¶æ®µæ˜¯è™šæ‹Ÿæœºå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚</p><h3 id="3-4-1-ä»€ä¹ˆæ˜¯ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨"><a href="#3-4-1-ä»€ä¹ˆæ˜¯ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨" class="headerlink" title="3.4.1 ä»€ä¹ˆæ˜¯ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨"></a>3.4.1 ä»€ä¹ˆæ˜¯ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨</h3><p>é‚£æˆ‘ä»¬å¸çº³æ¥è¯´ä¸€ä¸‹ç¬¦å·å¼•ç”¨å’Œç›´æ¥å¼•ç”¨çš„æ¦‚å¿µï¼š</p><ul><li><strong>ç¬¦å·å¼•ç”¨</strong>ï¼šç¬¦å·å¼•ç”¨ä»¥ä¸€ç»„ç¬¦å·æ¥æè¿°æ‰€å¼•ç”¨çš„ç›®æ ‡ï¼Œç¬¦å·å¯ä»¥æ˜¯ä»»ä½•å½¢å¼çš„å­—é¢é‡ï¼Œåªè¦ä½¿ç”¨æ—¶èƒ½æ— æ­§ä¹‰åœ°å®šä½åˆ°ç›®æ ‡å³å¯ã€‚ç¬¦å·å¼•ç”¨<strong>ä¸è™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€æ— å…³ï¼Œå¼•ç”¨çš„ç›®æ ‡å¹¶ä¸ä¸€å®šå·²ç»åŠ è½½åˆ°å†…å­˜ä¸­</strong>ã€‚å„ç§è™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€å¯ä»¥å„ä¸ç›¸åŒï¼Œä½†æ˜¯å®ƒä»¬èƒ½æ¥å—çš„ç¬¦å·å¼•ç”¨<strong>å¿…é¡»ä¸€è‡´</strong>ï¼Œå› ä¸ºç¬¦å·å¼•ç”¨çš„å­—é¢é‡å½¢å¼æ˜ç¡®å®šä¹‰åœ¨Javaè™šæ‹Ÿæœºè§„èŒƒçš„Classæ–‡ä»¶æ ¼å¼ä¸­ã€‚</li><li><strong>ç›´æ¥é¥®ç”¨</strong>ï¼šç›´æ¥å¼•ç”¨å¯ä»¥æ˜¯ç›´æ¥ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–æ˜¯ä¸€ä¸ªèƒ½é—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚ç›´æ¥å¼•ç”¨æ˜¯å’Œè™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€<strong>æœ‰å…³</strong>çš„ï¼Œ<strong>åŒä¸€ä¸ªç¬¦å·å¼•ç”¨åœ¨ä¸åŒè™šæ‹Ÿæœºå®ä¾‹ä¸Šç¿»è¯‘å‡ºæ¥çš„ç›´æ¥å¼•ç”¨ä¸€èˆ¬ä¸ä¼šç›¸åŒ</strong>ã€‚å¦‚æœæœ‰äº†ç›´æ¥å¼•ç”¨ï¼Œé‚£ä¹ˆå¼•ç”¨çš„ç›®æ ‡<strong>å¿…å®šå·²ç»åœ¨å†…å­˜ä¸­å­˜åœ¨</strong>ã€‚</li></ul><p>è™šæ‹Ÿæœºè§„èŒƒæ²¡æœ‰è§„å®šè§£æé˜¶æ®µå‘ç”Ÿçš„å…·ä½“æ—¶é—´ï¼Œè™šæ‹Ÿæœºå®ç°å¯ä»¥æ ¹æ®éœ€è¦æ¥åˆ¤æ–­åˆ°åº•æ˜¯åœ¨ç±»è¢«åŠ è½½æ—¶è§£æè¿˜æ˜¯ç­‰åˆ°ä¸€ä¸ªç¬¦å·å¼•ç”¨å°†è¦è¢«ä½¿ç”¨å‰æ‰å»è§£æã€‚</p><h3 id="3-4-2-å¯¹è§£æç»“æœè¿›è¡Œç¼“å­˜"><a href="#3-4-2-å¯¹è§£æç»“æœè¿›è¡Œç¼“å­˜" class="headerlink" title="3.4.2 å¯¹è§£æç»“æœè¿›è¡Œç¼“å­˜"></a>3.4.2 å¯¹è§£æç»“æœè¿›è¡Œç¼“å­˜</h3><p>åŒä¸€ç¬¦å·å¼•ç”¨è¿›è¡Œå¤šæ¬¡è§£æè¯·æ±‚æ˜¯å¾ˆå¸¸è§çš„ï¼Œé™¤<code>invokedynamic</code>æŒ‡ä»¤ä»¥å¤–ï¼Œè™šæ‹Ÿæœºå®ç°å¯ä»¥å¯¹ç¬¬ä¸€æ¬¡è§£æç»“æœè¿›è¡Œç¼“å­˜ï¼Œæ¥é¿å…è§£æåŠ¨ä½œé‡å¤è¿›è¡Œã€‚æ— è®ºæ˜¯å¦çœŸæ­£æ‰§è¡Œäº†å¤šæ¬¡è§£æåŠ¨ä½œï¼Œè™šæ‹Ÿæœºéœ€è¦ä¿è¯çš„æ˜¯åœ¨åŒä¸€ä¸ªå®ä½“ä¸­ï¼Œå¦‚æœä¸€ä¸ªå¼•ç”¨ç¬¦å·ä¹‹å‰å·²ç»è¢«æˆåŠŸè§£æè¿‡ï¼Œé‚£ä¹ˆåç»­çš„å¼•ç”¨è§£æè¯·æ±‚å°±åº”å½“ä¸€ç›´æˆåŠŸï¼›åŒæ ·çš„ï¼Œå¦‚æœ ç¬¬ä¸€æ¬¡è§£æå¤±è´¥ï¼Œé‚£ä¹ˆå…¶ä»–æŒ‡ä»¤å¯¹è¿™ä¸ªç¬¦å·çš„è§£æè¯·æ±‚ä¹Ÿåº”è¯¥æ”¶åˆ°ç›¸åŒçš„å¼‚å¸¸ã€‚</p><p>ä½†æ˜¯ä»¥ä¸Šè§„åˆ™å¯¹<code>invokedynamic</code>ä¸æˆç«‹ã€‚å½“ç¢°åˆ°æŸä¸ªå‰é¢å·²ç»ç”±<code>invokedynamic</code>æŒ‡ä»¤è§¦å‘è¿‡è§£æçš„ç¬¦å·å¼•ç”¨æ—¶ï¼Œå¹¶ä¸æ„å‘³ç€è¿™ä¸ªè§£æç»“æœå¯¹å…¶å®ƒ<code>invokedynamic</code>æŒ‡ä»¤ä¹ŸåŒæ ·ç”Ÿæ•ˆã€‚</p><p>åŸå› æ˜¯å› ä¸ºè¿™ä¸ªæŒ‡ä»¤ç”¨äºåŠ¨æ€è¯­è¨€æ”¯æŒï¼Œä¹Ÿå°±æ˜¯ç­‰ç¨‹åºæ‰§è¡Œåˆ°è¿™æ¡æŒ‡ä»¤æ—¶ï¼Œæ‰å»è§£æã€‚ç›¸å¯¹çš„ï¼Œå…¶å®ƒçš„éƒ½æ˜¯é™æ€çš„ï¼Œä¹Ÿå°±æ˜¯åˆšå®ŒæˆåŠ è½½é˜¶æ®µï¼Œè¿˜æ²¡å¼€å§‹æ‰§è¡Œä»£ç å°±è§£æäº†ã€‚</p><h3 id="3-4-3-è§£æçš„å¯¹è±¡"><a href="#3-4-3-è§£æçš„å¯¹è±¡" class="headerlink" title="3.4.3 è§£æçš„å¯¹è±¡"></a>3.4.3 è§£æçš„å¯¹è±¡</h3><p>è§£æåŠ¨ä½œä¸»è¦é’ˆå¯¹ç±»æˆ–æ¥å£ã€å­—æ®µã€ç±»æ–¹æ³•ã€æ¥å£æ–¹æ³•ã€æ–¹æ³•ç±»å‹ã€æ–¹æ³•å¥æŸ„å’Œè°ƒç”¨ç‚¹é™å®šç¬¦7ç±»ç¬¦å·å¼•ç”¨è¿›è¡Œã€‚</p><p>å¯¹äºåé¢3ä¸­ï¼Œä¸JDK1.7æ–°å¢çš„åŠ¨æ€è¯­è¨€æ”¯æŒæœ‰å…³ã€‚</p><h2 id="3-5-åˆå§‹åŒ–"><a href="#3-5-åˆå§‹åŒ–" class="headerlink" title="3.5 åˆå§‹åŒ–"></a>3.5 åˆå§‹åŒ–</h2><p>ç±»åˆå§‹åŒ–é˜¶æ®µæ˜¯ç±»åŠ è½½è¿‡ç¨‹çš„æœ€åä¸€æ­¥ã€‚</p><p>å‰é¢çš„è¿‡ç¨‹ä¸­ï¼Œé™¤äº†åœ¨åŠ è½½é˜¶æ®µç”¨æˆ·åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡è‡ªå®šä¹‰ç±»åŠ è½½å™¨å‚ä¸ä¹‹å¤–ï¼Œå…¶ä½™åŠ¨ä½œå®Œå…¨ç”±è™šæ‹Ÿæœºä¸»å¯¼å’Œæ§åˆ¶ã€‚è€Œåœ¨ä»åˆå§‹åŒ–é˜¶æ®µå¼€å§‹ï¼Œæ‰æ˜¯çœŸæ­£çš„æ‰§è¡Œå®šä¹‰çš„Javaç¨‹åºä»£ç ã€‚</p><p>åœ¨å‡†å¤‡é˜¶æ®µæ—¶ï¼Œæˆ‘ä»¬è¯´è¿‡è¿™æ—¶ç¨‹åºå·²ç»ä¸ºstaticä¿®é¥°çš„ç±»å˜é‡è¿›è¡Œäº†åˆå§‹åŒ–æ“ä½œã€‚è€Œå½“æ—¶æˆ‘ä»¬ä¹Ÿè¯´è¿‡ï¼Œåœ¨å‡†å¤‡é˜¶æ®µåˆå§‹åŒ–çš„å€¼åªæ˜¯Javaå¯¹è¯¥å˜é‡å®šä¹‰çš„é»˜è®¤å€¼ï¼Œå°±å¥½æ¯”intæ˜¯<code>0</code>ï¼Œfloatæ˜¯<code>0.0f</code>ï¼ŒBooleanæ˜¯<code>false</code>ã€‚ä»–æ‰ä¸ç®¡ä½ åœ¨ä»£ç é‡Œé¢æœ‰æ²¡æœ‰ç»™è¿™äº›å˜é‡å®šä¹‰å€¼ã€‚</p><p>è€Œåœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œæ‰æ˜¯æ ¹æ®ç¨‹åºå‘˜é€šè¿‡ç¨‹åºåˆ¶å®šçš„ä¸»è§‚è®¡åˆ’å»åˆå§‹åŒ–ç±»å˜é‡å’Œå…¶ä»–èµ„æºã€‚ç®€å•ç‚¹è¯´ï¼Œåˆå§‹åŒ–é˜¶æ®µæ˜¯æ‰§è¡Œç±»æ„é€ å™¨<code>&lt;client&gt;()</code>æ–¹æ³•çš„è¿‡ç¨‹ã€‚</p><p>ä¸‹é¢æ¥è¯¦ç»†è®²è®²<code>&lt;client&gt;()</code>æ–¹æ³•æ˜¯æ€ä¹ˆç”Ÿæˆçš„ï¼š</p><ul><li><code>&lt;client&gt;()</code>æ–¹æ³•æ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ”¶é›†ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼åŠ¨ä½œå’Œé™æ€è¯­å¥å—ï¼ˆstatic{} å—ï¼‰ä¸­çš„è¯­å¥åˆå¹¶äº§ç”Ÿçš„ï¼Œç¼–è¯‘å™¨æ”¶é›†çš„é¡ºåºç”±è¯­å¥åœ¨æºæ–‡ä»¶ä¸­å‡ºç°çš„é¡ºåºå†³å®šï¼Œç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œé™æ€è¯­å¥å—åªèƒ½è®¿é—®åˆ°å®šä¹‰åœ¨å®ƒä¹‹å‰çš„ç±»å˜é‡ï¼Œå®šä¹‰åœ¨å®ƒä¹‹åçš„ç±»å˜é‡åªèƒ½èµ‹å€¼ï¼Œä¸èƒ½è®¿é—®ã€‚ä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        i = <span class="number">0</span>;  <span class="comment">// ç»™å˜é‡å¤åˆ¶å¯ä»¥æ­£å¸¸ç¼–è¯‘é€šè¿‡</span></span><br><span class="line">        System.out.print(i);  <span class="comment">// è¿™å¥ç¼–è¯‘å™¨ä¼šæç¤ºâ€œéæ³•å‘å‰å¼•ç”¨â€ </span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>&lt;clinit&gt;()</code>æ–¹æ³•ä¸ç±»çš„æ„é€ å‡½æ•°ï¼ˆæˆ–è€…è¯´å®ä¾‹æ„é€ å™¨<code>&lt;init&gt;()</code>æ–¹æ³•ï¼‰ä¸åŒï¼Œä¸éœ€è¦æ˜¾å¼çš„è°ƒç”¨çˆ¶ç±»çš„()æ–¹æ³•ã€‚è™šæ‹Ÿæœºä¼šè‡ªåŠ¨ä¿è¯åœ¨å­ç±»çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•è¿è¡Œä¹‹å‰ï¼Œçˆ¶ç±»çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•å·²ç»æ‰§è¡Œç»“æŸã€‚å› æ­¤è™šæ‹Ÿæœºä¸­ç¬¬ä¸€ä¸ªæ‰§è¡Œ<code>&lt;clinit&gt;()</code>æ–¹æ³•çš„ç±»è‚¯å®šä¸º<code>java.lang.Object</code>ã€‚</li><li>ç”±äºçˆ¶ç±»çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•å…ˆæ‰§è¡Œï¼Œä¹Ÿå°±æ„å‘³ç€çˆ¶ç±»ä¸­å®šä¹‰çš„é™æ€è¯­å¥å—è¦ä¼˜äºå­ç±»çš„å˜é‡èµ‹å€¼æ“ä½œã€‚ä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Parent</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">A</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">static</span> &#123;</span><br><span class="line">            A = <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Sub</span> <span class="keyword">extends</span> <span class="title class_">Parent</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">B</span> <span class="operator">=</span> A;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(Sub.B);<span class="comment">//è¾“å‡ºç»“æœæ˜¯çˆ¶ç±»ä¸­çš„é™æ€å˜é‡å€¼Aï¼Œä¹Ÿå°±æ˜¯2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p><code>&lt;clinit&gt;()</code>æ–¹æ³•å¯¹äºç±»æˆ–æ¥å£ä¸æ˜¯å¿…é¡»çš„ï¼Œå¦‚æœä¸€ä¸ªç±»ä¸­ä¸åŒ…å«é™æ€è¯­å¥å—ï¼Œä¹Ÿæ²¡æœ‰å¯¹ç±»å˜é‡çš„èµ‹å€¼æ“ä½œï¼Œç¼–è¯‘å™¨å¯ä»¥ä¸ä¸ºè¯¥ç±»ç”Ÿæˆ<code>&lt;clinit&gt;()</code>æ–¹æ³•ã€‚</p></li><li><p>æ¥å£ä¸­ä¸å¯ä»¥ä½¿ç”¨é™æ€è¯­å¥å—ï¼Œä½†ä»ç„¶æœ‰ç±»å˜é‡åˆå§‹åŒ–çš„èµ‹å€¼æ“ä½œï¼Œå› æ­¤æ¥å£ä¸ç±»ä¸€æ ·éƒ½ä¼šç”Ÿæˆ<code>&lt;clinit&gt;()</code>æ–¹æ³•ã€‚ä½†æ¥å£ä¸ç±»ä¸åŒçš„æ˜¯ï¼Œæ‰§è¡Œæ¥å£çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•ä¸éœ€è¦å…ˆæ‰§è¡Œçˆ¶æ¥å£çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•ã€‚åªæœ‰å½“çˆ¶æ¥å£ä¸­å®šä¹‰çš„å˜é‡ä½¿ç”¨æ—¶ï¼Œçˆ¶æ¥å£æ‰ä¼šåˆå§‹åŒ–ã€‚å¦å¤–ï¼Œæ¥å£çš„å®ç°ç±»åœ¨åˆå§‹åŒ–æ—¶ä¹Ÿä¸€æ ·ä¸ä¼šæ‰§è¡Œæ¥å£çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•ã€‚</p></li><li><p>è™šæ‹Ÿæœºä¼šä¿è¯ä¸€ä¸ªç±»çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è¢«æ­£ç¡®çš„åŠ é”å’ŒåŒæ­¥ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶åˆå§‹åŒ–ä¸€ä¸ªç±»ï¼Œåªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè¿™ä¸ªç±»çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•ï¼Œå…¶å®ƒçº¿ç¨‹éƒ½ä¼šé˜»å¡ç­‰å¾…ï¼Œç›´åˆ°æ´»åŠ¨çº¿ç¨‹æ‰§è¡Œ<code>&lt;clinit&gt;()</code>æ–¹æ³•å®Œæ¯•ã€‚å¦‚æœåœ¨ä¸€ä¸ªç±»çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•ä¸­æœ‰è€—æ—¶çš„æ“ä½œï¼Œå°±å¯èƒ½é€ æˆå¤šä¸ªè¿›ç¨‹é˜»å¡ï¼Œåœ¨å®é™…è¿‡ç¨‹ä¸­æ­¤ç§é˜»å¡å¾ˆéšè”½ã€‚</p></li></ul>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Java/">Java</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Java/">Java</category>
      
      <category domain="https://www.littlecorgi.top/tags/JVM/">JVM</category>
      
      
      <comments>https://www.littlecorgi.top/posts/65c09aaf.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Javaé›†åˆæºç ä¹‹HashMap</title>
      <link>https://www.littlecorgi.top/posts/2982320f.html</link>
      <guid>https://www.littlecorgi.top/posts/2982320f.html</guid>
      <pubDate>Fri, 22 Nov 2019 12:11:15 GMT</pubDate>
      
        
        
          
          
      <description></description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>HashMapæ˜¯ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œçº¿ç¨‹ä¸å®‰å…¨ï¼Œ<code>key</code>å”¯ä¸€ï¼Œ<code>value</code>å¯é‡å¤ï¼Œå…è®¸<code>key</code>å’Œ<code>value</code>ä¸ºnullã€‚éå†æ—¶æ˜¯æ— åºçš„ã€‚</p><p>åº•å±‚ç»“æ„æ˜¯åŸºäºé“¾è¡¨æ•£åˆ—ï¼Œä¹Ÿå°±æ˜¯æ•°ç»„+é“¾è¡¨ã€‚æ•°ç»„ä¹Ÿè¢«ç§°ä¸ºå“ˆå¸Œæ¡¶ï¼Œæ¡¶é‡Œé¢å°±è£…ç€é“¾è¡¨ï¼Œé“¾è¡¨ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œå°±æ˜¯å“ˆå¸Œè¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ ã€‚</p><p>åœ¨JDK8ä¸­ï¼Œå½“é“¾è¡¨é•¿åº¦è¾¾åˆ°8çš„æ—¶å€™ï¼Œå°±ä¼šè½¬ä¸ºçº¢é»‘æ ‘ã€‚</p><p>å®ƒå®ç°äº†<code>Map&lt;K, V&gt;, Cloneable, Serializable</code>æ¥å£ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥çœ‹ä¸‹æºç ï¼š</p><h1 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åºåˆ—åŒ–IDï¼Œç”¨äºåºåˆ—åŒ–å’Œååºåˆ—åŒ–</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">362498820763181265L</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é»˜è®¤åˆå§‹å®¹é‡ä¹Ÿå°±æ˜¯16-å¿…é¡»ä¸º2çš„å¹‚ã€‚</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_INITIAL_CAPACITY</span> <span class="operator">=</span> <span class="number">1</span> &lt;&lt; <span class="number">4</span>; <span class="comment">// aka 16</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ€å¤§å®¹é‡ã€‚</span></span><br><span class="line"><span class="comment">// å¦‚æœä¸¤ä¸ªæ„é€ å‡½æ•°éƒ½ä½¿ç”¨å‚æ•°éšå¼æŒ‡å®šäº†æ›´é«˜çš„å€¼ï¼Œåˆ™ä½¿ç”¨è¯¥å®¹é‡ã€‚ </span></span><br><span class="line"><span class="comment">// å¿…é¡»æ˜¯2çš„30æ¬¡æ–¹ã€‚</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAXIMUM_CAPACITY</span> <span class="operator">=</span> <span class="number">1</span> &lt;&lt; <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é»˜è®¤çš„è´Ÿè½½å› å­</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">float</span> <span class="variable">DEFAULT_LOAD_FACTOR</span> <span class="operator">=</span> <span class="number">0.75f</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Entryæ•°ç»„ï¼Œä¹Ÿå°±æ˜¯å“ˆå¸Œæ¡¶ï¼Œé•¿åº¦ä¸º2çš„næ¬¡å¹‚</span></span><br><span class="line"><span class="keyword">transient</span> Node&lt;K,V&gt;[] table;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¿å­˜ç¼“å­˜çš„entrySet()ã€‚ æ³¨æ„ï¼ŒAbstractMapå­—æ®µç”¨äºkeySetï¼ˆï¼‰å’Œvaluesï¼ˆï¼‰ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">transient</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŒ…å«çš„é”®-å€¼å¯¹çš„æ•°ï¼Œä¹Ÿå°±æ˜¯å…ƒç´ çš„ä¸ªæ•°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">transient</span> <span class="type">int</span> size;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™ä¸ªä¸fast-failæœ‰å…³ï¼Œå¯ä»¥å‚è€ƒæˆ‘ä¸Šä¸€ç¯‡å°†ArrayListéƒ¨åˆ†åšå®¢çš„modCountå˜é‡ã€‚</span></span><br><span class="line"><span class="keyword">transient</span> <span class="type">int</span> modCount;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‰ HashMap æ‰€èƒ½å®¹çº³é”®å€¼å¯¹æ•°é‡çš„æœ€å¤§å€¼ï¼Œè¶…è¿‡è¿™ä¸ªå€¼ï¼Œåˆ™éœ€æ‰©å®¹</span></span><br><span class="line"><span class="type">int</span> threshold;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è´Ÿè½½å› å­</span></span><br><span class="line"><span class="keyword">final</span> <span class="type">float</span> loadFactor;</span><br></pre></td></tr></table></figure><p>è¿™äº›å¯èƒ½ç°åœ¨çœ‹èµ·æ¥è¿˜å¾ˆè¿·ï¼Œå¯èƒ½éƒ½ä¸çŸ¥é“æœ‰äº›å˜é‡åˆ°åº•æ˜¯æ‹¿æ¥å¹²å˜›çš„ã€‚ä¸æ€¥ï¼Œæˆ‘ä»¬ç»§ç»­å¾€åé¢çœ‹ã€‚</p><h1 id="æ„é€ æ–¹æ³•"><a href="#æ„é€ æ–¹æ³•" class="headerlink" title="æ„é€ æ–¹æ³•"></a>æ„é€ æ–¹æ³•</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ„é€ ä¸€ä¸ªæŒ‡å®šåˆå§‹å®¹é‡å’Œæ„é€ å› å­çš„HashMap</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HashMap</span><span class="params">(<span class="type">int</span> initialCapacity, <span class="type">float</span> loadFactor)</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæŒ‡å®šçš„åˆå§‹å®¹é‡å°äº0ï¼ŒæŠ›å¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">if</span> (initialCapacity &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Illegal initial capacity: &quot;</span> +</span><br><span class="line">                                           initialCapacity);</span><br><span class="line">    <span class="comment">// å¦‚æœæŒ‡å®šçš„åˆå§‹å®¹é‡å¤§äºè®¾å®šå¥½çš„æœ€å¤§å®¹é‡</span></span><br><span class="line">    <span class="keyword">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)</span><br><span class="line">        <span class="comment">// å°±ç›´æ¥æŠŠåˆå§‹å®¹é‡è®¾ç½®ä¸ºæœ€å¤§å®¹é‡</span></span><br><span class="line">        initialCapacity = MAXIMUM_CAPACITY;    <span class="comment">// å¦‚æœè´Ÿè½½å› å­å°äº0æˆ–è€…ä¸ºç©ºï¼ŒæŠ›å¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">if</span> (loadFactor &lt;= <span class="number">0</span> || Float.isNaN(loadFactor))</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Illegal load factor: &quot;</span> +</span><br><span class="line">                                           loadFactor);</span><br><span class="line">    <span class="comment">// èµ‹å€¼</span></span><br><span class="line">    <span class="built_in">this</span>.loadFactor = loadFactor;</span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ3.1</span></span><br><span class="line">    <span class="built_in">this</span>.threshold = tableSizeFor(initialCapacity);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ„é€ ä¸€ä¸ªå…·æœ‰æŒ‡å®šå®¹é‡å’Œé»˜è®¤è´Ÿè½½å› å­çš„HashMapã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HashMap</span><span class="params">(<span class="type">int</span> initialCapacity)</span> &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨äº†ä¸Šé¢é‚£ä¸ªæ„é€ æ–¹æ³•</span></span><br><span class="line">    <span class="built_in">this</span>(initialCapacity, DEFAULT_LOAD_FACTOR);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ— å‚æ„é€ æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HashMap</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// ç›´æ¥åŠ è½½é»˜è®¤è´Ÿè½½å› å­</span></span><br><span class="line">    <span class="built_in">this</span>.loadFactor = DEFAULT_LOAD_FACTOR; <span class="comment">// all other fields defaulted</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†Mapé‡Œé¢çš„å€¼ä¼ å…¥HashMap</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HashMap</span><span class="params">(Map&lt;? extends K, ? extends V&gt; m)</span> &#123;</span><br><span class="line">    <span class="comment">//  ä½¿ç”¨é»˜è®¤çš„åŠ è½½å› å­</span></span><br><span class="line">    <span class="built_in">this</span>.loadFactor = DEFAULT_LOAD_FACTOR;</span><br><span class="line">    <span class="comment">// åˆ†æ3.2</span></span><br><span class="line">    putMapEntries(m, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ†æ3-1-HashMap-tableSizeFor-int-cap"><a href="#åˆ†æ3-1-HashMap-tableSizeFor-int-cap" class="headerlink" title="åˆ†æ3.1 HashMap # tableSizeFor(int cap)"></a>åˆ†æ3.1 HashMap # tableSizeFor(int cap)</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æ 3.1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">tableSizeFor</span><span class="params">(<span class="type">int</span> cap)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> cap - <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// &gt;&gt;&gt; æ— ç¬¦å·å³ç§»</span></span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">2</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">4</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">8</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">16</span>;</span><br><span class="line">    <span class="keyword">return</span> (n &lt; <span class="number">0</span>) ? <span class="number">1</span> : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•æœ‰ç‚¹çº ç»“ï¼Œä½ å…‰çœ‹ä»£ç ç¡®å®çœ‹ä¸å‡ºæ¥ä¸ªå•¥ï¼Œä½†æ˜¯å¦‚æœä½ åœ¨çº¸ä¸Šé¡ºä¾¿æ‰¾å‡ ä¸ªä¾‹å­å†™å†™å°±æ‡‚äº†ã€‚</p><p>ä»–çš„ç”¨é€”ï¼Œæ€»ç»“èµ·æ¥å°±æ˜¯ï¼š<strong>æ‰¾åˆ°å¤§äºæˆ–ç­‰äºcapçš„æœ€å°2çš„å¹‚</strong>ã€‚</p><p>è¿™é‡Œå€Ÿç”¨ä¸€ä¸‹<a href="http://www.tianxiaobo.com/2018/01/18/HashMap-%E6%BA%90%E7%A0%81%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90-JDK1-8/">ä¸€ä½å¤§ä½¬çš„å›¾</a>ï¼š<br><img src="https://image-static.segmentfault.com/327/110/3271107614-5a65971be833a" alt=""></p><p>è¿™ä¸ªå›¾å°±æ˜¯ç¬¬ä¸€ä¸ªä¾‹å­ã€‚cap=536870913ï¼Œç»è¿‡è¿ç®—ä¹‹åï¼Œn+1=1073741824ã€‚</p><h2 id="åˆ†æ3-2-HashMap-putMapEntries-Map-lt-extends-K-extends-V-gt-m-boolean-evict"><a href="#åˆ†æ3-2-HashMap-putMapEntries-Map-lt-extends-K-extends-V-gt-m-boolean-evict" class="headerlink" title="åˆ†æ3.2 HashMap # putMapEntries(Map&lt;? extends K, ? extends V&gt; m, boolean evict)"></a>åˆ†æ3.2 HashMap # putMapEntries(Map&lt;? extends K, ? extends V&gt; m, boolean evict)</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">putMapEntries</span><span class="params">(Map&lt;? extends K, ? extends V&gt; m, <span class="type">boolean</span> evict)</span> &#123;</span><br><span class="line">    <span class="comment">// å…ˆæ‹¿åˆ°mapçš„å¤§å°</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">s</span> <span class="operator">=</span> m.size();</span><br><span class="line">    <span class="comment">// å¦‚æœmapå¤§äº0æ‰å»è¿›è¡Œæ“ä½œï¼Œå¦‚æœç­‰äº0é‚£å°±è¯æ˜Mapæ˜¯ç©ºçš„ï¼Œå°±ä¸è¿›è¡Œæ“ä½œ</span></span><br><span class="line">    <span class="keyword">if</span> (s &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰å“ˆå¸Œè¡¨è¿˜æ˜¯ç©ºçš„</span></span><br><span class="line">        <span class="keyword">if</span> (table == <span class="literal">null</span>) &#123; <span class="comment">// pre-size</span></span><br><span class="line">            <span class="comment">// æ ¹æ®mçš„å…ƒç´ æ•°é‡å’Œå½“å‰è¡¨çš„åŠ è½½å› å­ï¼Œè®¡ç®—å‡ºé˜ˆå€¼</span></span><br><span class="line">            <span class="type">float</span> <span class="variable">ft</span> <span class="operator">=</span> ((<span class="type">float</span>)s / loadFactor) + <span class="number">1.0F</span>;</span><br><span class="line">            <span class="comment">// ä¿®æ­£é˜ˆå€¼çš„è¾¹ç•Œ ä¸èƒ½è¶…è¿‡MAXIMUM_CAPACITY</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> ((ft &lt; (<span class="type">float</span>)MAXIMUM_CAPACITY) ?</span><br><span class="line">                     (<span class="type">int</span>)ft : MAXIMUM_CAPACITY);</span><br><span class="line">            <span class="comment">// å¦‚æœæ–°çš„é˜ˆå€¼å¤§äºå½“å‰é˜ˆå€¼</span></span><br><span class="line">            <span class="keyword">if</span> (t &gt; threshold)</span><br><span class="line">                <span class="comment">// è¿”å›ä¸€ä¸ªæ–°çš„é˜ˆå€¼çš„ æ»¡è¶³2çš„næ¬¡æ–¹çš„é˜ˆå€¼</span></span><br><span class="line">                <span class="comment">// -&gt;&gt; åˆ†æ3.1</span></span><br><span class="line">                threshold = tableSizeFor(t);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰å“ˆå¸Œè¡¨ä¸æ˜¯ç©ºçš„ï¼Œè€Œä¸”mapä¸­å…ƒç´ ä¸ªæ•°å¤§äºå½“å‰çš„é˜ˆå€¼ï¼Œé‚£å°±é‡æ–°æ‰©å®¹</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (s &gt; threshold)</span><br><span class="line">            <span class="comment">// æ‰©å®¹</span></span><br><span class="line">            <span class="comment">// -&gt;&gt; åˆ†æ3.3</span></span><br><span class="line">            resize();</span><br><span class="line">        <span class="comment">// éå†Mapï¼Œå–å‡ºmapæ¯ä¸€ä¸ªé”®å€¼å¯¹å¹¶å¤åˆ¶ç»™HashMap</span></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;? <span class="keyword">extends</span> <span class="title class_">K</span>, ? <span class="keyword">extends</span> <span class="title class_">V</span>&gt; e : m.entrySet()) &#123;</span><br><span class="line">            <span class="type">K</span> <span class="variable">key</span> <span class="operator">=</span> e.getKey();</span><br><span class="line">            <span class="type">V</span> <span class="variable">value</span> <span class="operator">=</span> e.getValue();</span><br><span class="line">            <span class="comment">// å°†å–å‡ºKeyå’ŒValueæ”¾å…¥HashMap</span></span><br><span class="line">            <span class="comment">// -&gt;&gt; åˆ†æ3.4</span></span><br><span class="line">            putVal(hash(key), key, value, <span class="literal">false</span>, evict);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ†æ3-3-HashMap-resize"><a href="#åˆ†æ3-3-HashMap-resize" class="headerlink" title="åˆ†æ3.3 HashMap # resize()"></a>åˆ†æ3.3 HashMap # resize()</h2><p><strong>é‡ç‚¹ï¼ï¼ï¼</strong></p><p>æ‰©å®¹å‡½æ•°ã€‚</p><p>å…ˆæ¥çœ‹æºç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Node&lt;K,V&gt;[] resize() &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] oldTab = table;</span><br><span class="line">    <span class="comment">// æ—§æ•°ç»„ä¹Ÿå°±æ˜¯æ—§å“ˆå¸Œæ¡¶çš„å®¹é‡ï¼Œå¦‚æœoldTabä¸ºç©ºå°±ä¸º0ï¼Œå¦åˆ™ä¸ºoldTabé•¿åº¦</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">oldCap</span> <span class="operator">=</span> (oldTab == <span class="literal">null</span>) ? <span class="number">0</span> : oldTab.length;</span><br><span class="line">    <span class="comment">// æ—§çš„é˜ˆå€¼</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">oldThr</span> <span class="operator">=</span> threshold;</span><br><span class="line">    <span class="type">int</span> newCap, newThr = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// å¦‚æœæ—§å“ˆå¸Œæ¡¶å®¹é‡å¤§äº0</span></span><br><span class="line">    <span class="keyword">if</span> (oldCap &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ—§å“ˆå¸Œæ¡¶å®¹é‡å¤§äºé™å®šçš„æœ€å¤§å€¼</span></span><br><span class="line">        <span class="keyword">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;</span><br><span class="line">            <span class="comment">// é˜ˆå€¼å°±è®¾ç½®ä¸ºintçš„æœ€å¤§å€¼</span></span><br><span class="line">            threshold = Integer.MAX_VALUE;</span><br><span class="line">            <span class="keyword">return</span> oldTab;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦åˆ™æ–°çš„å®¹é‡æ˜¯æ—§çš„å®¹é‡çš„ä¸¤å€</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((newCap = oldCap &lt;&lt; <span class="number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;</span><br><span class="line">                <span class="comment">// æ—§çš„å®¹é‡ä¸ºé»˜è®¤åˆå§‹åŒ–å®¹é‡ä¹Ÿå°±æ˜¯16</span></span><br><span class="line">                 oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</span><br><span class="line">            <span class="comment">// æ–°çš„é˜ˆå€¼ä¹Ÿç­‰äºæ—§çš„é˜ˆå€¼</span></span><br><span class="line">            newThr = oldThr &lt;&lt; <span class="number">1</span>; <span class="comment">// double threshold</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœå½“å‰è¡¨æ˜¯ç©ºçš„ï¼Œä½†æ˜¯æœ‰é˜ˆå€¼ã€‚ä»£è¡¨æ˜¯åˆå§‹åŒ–æ—¶æŒ‡å®šäº†å®¹é‡ã€é˜ˆå€¼çš„æƒ…å†µ</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (oldThr &gt; <span class="number">0</span>) <span class="comment">// initial capacity was placed in threshold</span></span><br><span class="line">        <span class="comment">// ç›´æ¥æŠŠæ–°çš„å®¹é‡çš„å€¼è®¾ç½®ä¸ºæ—§çš„é˜ˆå€¼</span></span><br><span class="line">        newCap = oldThr;</span><br><span class="line">    <span class="comment">// å¦‚æœå½“å‰è¡¨æ˜¯ç©ºçš„ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰é˜ˆå€¼ã€‚ä»£è¡¨æ˜¯åˆå§‹åŒ–æ—¶æ²¡æœ‰ä»»ä½•å®¹é‡/é˜ˆå€¼å‚æ•°çš„æƒ…å†µ</span></span><br><span class="line">    <span class="keyword">else</span> &#123;               <span class="comment">// zero initial threshold signifies using defaults</span></span><br><span class="line">        <span class="comment">// æ–°å®¹é‡ä¸ºé»˜è®¤çš„åˆå§‹å®¹é‡</span></span><br><span class="line">        newCap = DEFAULT_INITIAL_CAPACITY;</span><br><span class="line">        <span class="comment">// æ–°çš„é˜ˆå€¼é»˜è®¤ä¸ºé»˜è®¤è´Ÿè½½å› å­ * é»˜è®¤åˆå§‹å®¹é‡ = 16 * 0.7 = 12</span></span><br><span class="line">        newThr = (<span class="type">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœæ–°çš„é˜ˆå€¼æ˜¯0ï¼Œå¯¹åº”çš„æ˜¯  å½“å‰è¡¨æ˜¯ç©ºçš„ï¼Œä½†æ˜¯æœ‰é˜ˆå€¼çš„æƒ…å†µ</span></span><br><span class="line">    <span class="keyword">if</span> (newThr == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// æ ¹æ®æ–°è¡¨å®¹é‡ å’Œ åŠ è½½å› å­ æ±‚å‡ºæ–°çš„é˜ˆå€¼</span></span><br><span class="line">        <span class="type">float</span> <span class="variable">ft</span> <span class="operator">=</span> (<span class="type">float</span>)newCap * loadFactor;</span><br><span class="line">        newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class="type">float</span>)MAXIMUM_CAPACITY ?</span><br><span class="line">                  (<span class="type">int</span>)ft : Integer.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ›´æ–°é˜ˆå€¼ </span></span><br><span class="line">    threshold = newThr;</span><br><span class="line">    <span class="meta">@SuppressWarnings(&#123;&quot;rawtypes&quot;,&quot;unchecked&quot;&#125;)</span></span><br><span class="line">    <span class="comment">// åˆ›å»ºæ–°çš„å“ˆå¸Œæ¡¶</span></span><br><span class="line">        Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="keyword">new</span> <span class="title class_">Node</span>[newCap];</span><br><span class="line">    <span class="comment">// æ›´æ–°å¼•ç”¨</span></span><br><span class="line">    table = newTab;</span><br><span class="line">    <span class="comment">// å¦‚æœä»¥å‰çš„å“ˆå¸Œæ¡¶ä¸­è¿˜æœ‰å…ƒç´ ï¼Œé‚£å°±æŠŠåŸæ¥çš„æ•°ç»„å¤åˆ¶è¿‡æ¥</span></span><br><span class="line">    <span class="keyword">if</span> (oldTab != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// éå†ä»¥å‰çš„å“ˆå¸Œæ¡¶</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; oldCap; ++j) &#123;</span><br><span class="line">            Node&lt;K,V&gt; e;</span><br><span class="line">            <span class="comment">// å¦‚æœå½“å‰èŠ‚ç‚¹ä¸ä¸ºç©º</span></span><br><span class="line">            <span class="keyword">if</span> ((e = oldTab[j]) != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// æŠŠæ—§å“ˆå¸Œæ¡¶ä¸­çš„è¯¥ä½ç½®ä¸ºç©ºï¼Œæ–¹ä¾¿GCå›æ”¶</span></span><br><span class="line">                oldTab[j] = <span class="literal">null</span>;</span><br><span class="line">                <span class="comment">// å¦‚æœè¯¥èŠ‚ç‚¹çš„åä¸€ä½ä¸ºç©ºäº†ï¼Œä¹Ÿå°±æ˜¯è¯´å“ˆå¸Œæ¡¶é‡Œé¢çš„é“¾è¡¨åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">                <span class="keyword">if</span> (e.next == <span class="literal">null</span>)</span><br><span class="line">                    <span class="comment">//ç›´æ¥å°†è¿™ä¸ªå…ƒç´ æ”¾ç½®åœ¨æ–°çš„å“ˆå¸Œæ¡¶é‡Œã€‚</span></span><br><span class="line">                    <span class="comment">//æ³¨æ„è¿™é‡Œå–ä¸‹æ ‡ æ˜¯ç”¨ å“ˆå¸Œå€¼ ä¸ æ¡¶çš„é•¿åº¦-1 ã€‚ ç”±äºæ¡¶çš„é•¿åº¦æ˜¯2çš„næ¬¡æ–¹ï¼Œè¿™ä¹ˆåšå…¶å®æ˜¯ç­‰äº ä¸€ä¸ªæ¨¡è¿ç®—ã€‚ä½†æ˜¯æ•ˆç‡æ›´é«˜</span></span><br><span class="line">                    <span class="comment">// å…·ä½“ä¼šåœ¨æ–‡ç« æœ€åé¢è®²</span></span><br><span class="line">                    newTab[e.hash &amp; (newCap - <span class="number">1</span>)] = e;</span><br><span class="line">                <span class="comment">// å¦‚æœå‘ç”Ÿè¿‡å“ˆå¸Œç¢°æ’ ,è€Œä¸”æ˜¯èŠ‚ç‚¹æ•°è¶…è¿‡8ä¸ªï¼Œè½¬åŒ–æˆäº†çº¢é»‘æ ‘ï¼ˆæš‚ä¸”ä¸è°ˆ é¿å…è¿‡äºå¤æ‚ï¼Œ åç»­ä¸“é—¨ç ”ç©¶ä¸€ä¸‹çº¢é»‘æ ‘ï¼‰</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                    ((TreeNode&lt;K,V&gt;)e).split(<span class="built_in">this</span>, newTab, j, oldCap);</span><br><span class="line">                <span class="comment">// å¦‚æœå‘ç”Ÿè¿‡å“ˆå¸Œç¢°æ’ï¼ŒèŠ‚ç‚¹æ•°å°äº8ä¸ªã€‚åˆ™è¦æ ¹æ®é“¾è¡¨ä¸Šæ¯ä¸ªèŠ‚ç‚¹çš„å“ˆå¸Œå€¼ï¼Œä¾æ¬¡æ”¾å…¥æ–°å“ˆå¸Œæ¡¶å¯¹åº”ä¸‹æ ‡ä½ç½®ã€‚</span></span><br><span class="line">                <span class="keyword">else</span> &#123; <span class="comment">// preserve order</span></span><br><span class="line">                    <span class="comment">// ç”±äºç°åœ¨å®¹é‡åŠ å€äº†ï¼ŒæŒ‰ç…§å“ˆå¸Œè¡¨çš„ç®—æ³•ï¼Œä¹‹å‰åœ¨è¿™ä¸ªå“ˆå¸Œæ¡¶é‡Œé¢çš„ç°åœ¨ä¸ä¸€å®šå±äºè¯¥å“ˆå¸Œæ¡¶äº†</span></span><br><span class="line">                    <span class="comment">// æ¯”å¦‚ï¼Œä¹‹å‰å“ˆå¸Œé•¿åº¦æ˜¯4ï¼Œæœ‰ä¸€ä¸ªå…ƒç´ ä¸º5</span></span><br><span class="line">                    <span class="comment">// æœªæ‰©å®¹å‰ï¼Œä»–åº”è¯¥åœ¨5%4=1è¿™ä¸ªæ¡¶é‡Œé¢</span></span><br><span class="line">                    <span class="comment">// ä½†æ˜¯ç°åœ¨æ‰©å®¹äº†ï¼Œå“ˆå¸Œé•¿åº¦å˜æˆäº†8ï¼Œé‚£ä¹ˆä»–ç°åœ¨å°±åº”è¯¥åœ¨5%8=5è¿™ä¸ªæ¡¶é‡Œé¢äº†</span></span><br><span class="line">                    <span class="comment">// è€Œä¸”æ–°æ¡¶çš„ä½ç½®å°±æ˜¯è€ä½ç½®1åŠ ä¸ŠoldCap4ï¼Œä¹Ÿå°±æ˜¯j + oldCap = 1 + 4 = 5</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// ä»£è¡¨æ‰©å®¹åè¿˜åº”è¯¥åœ¨è€æ¡¶é‡Œé¢çš„å…ƒç´ </span></span><br><span class="line">                    Node&lt;K,V&gt; loHead = <span class="literal">null</span>, loTail = <span class="literal">null</span>;</span><br><span class="line">                    <span class="comment">// ä»£è¡¨æ‰©å®¹ååº”è¯¥åœ¨æ–°æ¡¶é‡Œé¢çš„å…ƒç´ </span></span><br><span class="line">                    Node&lt;K,V&gt; hiHead = <span class="literal">null</span>, hiTail = <span class="literal">null</span>;</span><br><span class="line">                    Node&lt;K,V&gt; next;</span><br><span class="line">                    <span class="keyword">do</span> &#123;</span><br><span class="line">                        next = e.next;</span><br><span class="line">                        <span class="comment">// è¿™é‡Œåˆæ˜¯ä¸€ä¸ªåˆ©ç”¨ä½è¿ç®— ä»£æ›¿å¸¸è§„è¿ç®—çš„é«˜æ•ˆç‚¹ï¼š åˆ©ç”¨å“ˆå¸Œå€¼ ä¸ æ—§çš„å®¹é‡ï¼Œå¯ä»¥å¾—åˆ°å“ˆå¸Œå€¼å»æ¨¡åï¼Œæ˜¯å¤§äºç­‰äºoldCapè¿˜æ˜¯å°äºoldCapï¼Œç­‰äº0ä»£è¡¨å°äºoldCapï¼Œåº”è¯¥å­˜æ”¾åœ¨ä½ä½ï¼Œå¦åˆ™å­˜æ”¾åœ¨é«˜ä½                    </span></span><br><span class="line">                        <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="comment">// ä»¥ä¸‹å‡ä¸ºç®€å•çš„å•é“¾è¡¨æ“ä½œ</span></span><br><span class="line">                            <span class="keyword">if</span> (loTail == <span class="literal">null</span>)</span><br><span class="line">                                loHead = e;</span><br><span class="line">                            <span class="keyword">else</span></span><br><span class="line">                                loTail.next = e;</span><br><span class="line">                            loTail = e;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="comment">// ä»¥ä¸‹å‡ä¸ºç®€å•çš„å•é“¾è¡¨æ“ä½œ</span></span><br><span class="line">                            <span class="keyword">if</span> (hiTail == <span class="literal">null</span>)</span><br><span class="line">                                hiHead = e;</span><br><span class="line">                            <span class="keyword">else</span></span><br><span class="line">                                hiTail.next = e;</span><br><span class="line">                            hiTail = e;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">while</span> ((e = next) != <span class="literal">null</span>);</span><br><span class="line">                    <span class="comment">// éå†ä¸¤ä¸ªé“¾è¡¨ï¼ŒæŠŠloæ”¾åˆ°åŸæ¥çš„ä½ç½®ä¸Šï¼Œå¹¶æŠŠhiæ”¾å…¥æ–°ä½ç½®ä¹Ÿå°±æ˜¯j+oldCap</span></span><br><span class="line">                    <span class="keyword">if</span> (loTail != <span class="literal">null</span>) &#123;</span><br><span class="line">                        loTail.next = <span class="literal">null</span>;</span><br><span class="line">                        newTab[j] = loHead;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (hiTail != <span class="literal">null</span>) &#123;</span><br><span class="line">                        hiTail.next = <span class="literal">null</span>;</span><br><span class="line">                        newTab[j + oldCap] = hiHead;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newTab;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ€»ç»“æ¥è¯´å°±æ˜¯:</p><ul><li>æ‰©å®¹<ul><li>å¦‚æœä¹‹å‰çš„å“ˆå¸Œè¡¨æœ‰å€¼ï¼Œè€Œä¸”å…ƒç´ çš„ä¸ªæ•°å¤§äºé™å®šçš„å“ˆå¸Œè¡¨æœ€å¤§å®¹é‡çš„è¯ï¼Œé‚£å°±æŠŠæ–°çš„å“ˆå¸Œè¡¨çš„é˜ˆå€¼è®¾ç½®ä¸ºInteger.MAX_VALUEä¹Ÿå°±æ˜¯intçš„æœ€å¤§å€¼ï¼Œå¹¶ç›´æ¥è¿”å›æ—§å’Œå“ˆå¸Œè¡¨</li><li>å¦‚æœä¹‹å‰çš„å“ˆå¸Œè¡¨æœ‰å€¼ï¼Œè€Œä¸”å…ƒç´ ä¸ªæ•°æ²¡æœ‰å¤§äºå“ˆå¸Œè¡¨æœ€å¤§å®¹é‡ï¼Œè€Œä¸”ä¸ªæ•°çš„ä¸¤å€è¿˜å°äºé™å®šçš„å“ˆå¸Œè¡¨æœ€å¤§å®¹é‡ã€å…ƒç´ ä¸ªæ•°å¤§äºé»˜è®¤çš„åˆå§‹å®¹é‡ä¹Ÿå°±æ˜¯16çš„è¯ï¼Œå°±è®¾ç½®æ–°çš„é˜ˆå€¼ä¸ºæ—§çš„é˜ˆå€¼çš„2å€</li><li>å¦‚æœä¹‹å‰çš„å“ˆå¸Œè¡¨çš„ç©ºçš„ï¼Œä½†æ˜¯é˜ˆå€¼æ˜¯å­˜åœ¨å€¼çš„ï¼Œä¹Ÿå°±ç›¸å½“äºä½ åˆå§‹åŒ–æ—¶æŒ‡å®šäº†å®¹é‡å’Œé˜ˆå€¼ç„¶åæ„é€ çš„å“ˆå¸Œè¡¨ï¼Œæ­¤æ—¶å°±ç›´æ¥è®©æ–°çš„å®¹é‡æŒ‡å®šä¸ºæ—§çš„é˜ˆå€¼</li><li>å¦‚æœä¹‹å‰å“ˆå¸Œè¡¨æ˜¯ç©ºçš„ï¼Œé˜ˆå€¼ä¹Ÿä¸å¤§äº0ï¼Œä¹Ÿå°±ç›¸å½“äºé‡‡ç”¨äº†æ— å‚æ„é€ ï¼Œè¿™æ—¶å°±ç›´æ¥è®©æ–°å®¹é‡ä¸ºé»˜è®¤çš„åˆå§‹å®¹é‡ä¹Ÿå°±æ˜¯16ï¼Œè®©æ–°çš„é˜ˆå€¼ä¸ºé»˜è®¤è´Ÿè½½å› å­<em>é»˜è®¤åˆå§‹å®¹é‡ = 16 </em> 0.7 = 12</li><li>å¦‚æœæ–°çš„é˜ˆå€¼æ˜¯0çš„è¯ï¼Œä¹Ÿå°±æ˜¯åœ¨ä¹‹å‰çš„4ä¸ªåˆ¤æ–­ä¸­æ²¡æœ‰å¯¹æ–°çš„é˜ˆå€¼è¿›è¡Œæ›´æ”¹çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰çš„å“ˆå¸Œè¡¨æ˜¯ç©ºçš„ï¼Œç„¶åæŒ‡å®šäº†é˜ˆå€¼çš„æƒ…å†µï¼Œè¿™æ˜¯å°±æ ¹æ®æ–°è¡¨çš„å®¹é‡å’Œè´Ÿè½½å› å­æ±‚å‡ºæ–°çš„é˜ˆå€¼</li></ul></li><li>å¤åˆ¶åˆ°æ–°è¡¨<ul><li>å¦‚æœä»¥å‰çš„å“ˆå¸Œè¡¨ä¸­æœ‰å…ƒç´ ï¼Œå°±ç›´æ¥éå†åŸè¡¨ï¼Œç„¶ååˆ¤æ–­å½“å‰å“ˆå¸Œæ¡¶é‡Œé¢æœ‰æ²¡æœ‰å…ƒç´ </li><li>å¦‚æœæœ‰è€Œä¸”ä»–çš„ä¸‹ä¸€ä¸ªä¸ºç©ºï¼Œå°±ä»£è¡¨è¿™ä¸ªé“¾è¡¨åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé‚£å°±ç›´æ¥æ±‚å‡ºä»–çš„å“ˆå¸Œå€¼ï¼Œç„¶åç»™å¯¹åº”çš„å“ˆå¸Œæ¡¶</li><li>å¦‚æœä»–ä¸‹ä¸€ä¸ªä¸ä¸ºç©ºè€Œä¸”ä»–æ˜¯çº¢é»‘æ ‘çš„å®ä¾‹ï¼Œé‚£å°±è°ƒç”¨splitæ–¹æ³•</li><li>å¦‚æœä»–ä¸‹ä¸€ä¸ªä¸ä¸ºç©ºï¼Œä¹Ÿä¸æ˜¯çº¢é»‘æ ‘çš„å®ä¾‹ï¼Œé‚£å°±å¼€å§‹éå†é“¾è¡¨ï¼Œåˆ¤æ–­å½“å‰åŠèŠ‚ç‚¹æ–°çš„å“ˆå¸Œå€¼ï¼Œå¦‚æœè¿˜æ˜¯å½“å‰å€¼ï¼Œé‚£å°±æ”¾åˆ°loé“¾è¡¨ä¸Šå»ï¼Œå¦‚æœä¸æ˜¯å½“å‰å€¼ï¼Œé‚£å°±æ”¾åˆ°hié“¾è¡¨</li><li>ç„¶åéå†å®Œæˆåï¼Œç›´æ¥æŠŠloé“¾è¡¨æ”¾åˆ°å½“å‰å“ˆå¸Œæ¡¶ï¼ŒæŠŠhiæ”¾åˆ°å½“å‰å“ˆå¸Œå€¼+æ—§çš„å“ˆå¸Œæ•°ç»„é•¿åº¦ä¹Ÿå°±æ˜¯æ–°çš„å“ˆå¸Œå€¼å¯¹åº”çš„å“ˆå¸Œæ¡¶ä¸Šå»</li></ul></li></ul><h2 id="åˆ†æ3-4-HashMap-putVal-int-hash-K-key-V-value-boolean-onlyIfAbsent-boolean-evict"><a href="#åˆ†æ3-4-HashMap-putVal-int-hash-K-key-V-value-boolean-onlyIfAbsent-boolean-evict" class="headerlink" title="åˆ†æ3.4 HashMap # putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict)"></a>åˆ†æ3.4 HashMap # putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict)</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> V <span class="title function_">putVal</span><span class="params">(<span class="type">int</span> hash, K key, V value, <span class="type">boolean</span> onlyIfAbsent,</span></span><br><span class="line"><span class="params">               <span class="type">boolean</span> evict)</span> &#123;</span><br><span class="line">    </span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="type">int</span> n, i;</span><br><span class="line">    <span class="comment">// å¦‚æœå“ˆå¸Œè¡¨æ˜¯ç©ºçš„çš„è¯ï¼Œä»£è¡¨æ˜¯åˆå§‹åŒ–çš„</span></span><br><span class="line">    <span class="keyword">if</span> ((tab = table) == <span class="literal">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">        <span class="comment">// é‚£å°±ç›´æ¥æ‰©å®¹å“ˆå¸Œè¡¨ï¼Œå¹¶ä¸”å°†æ‰©å®¹åçš„å“ˆå¸Œæ¡¶é•¿åº¦èµ‹å€¼ç»™n</span></span><br><span class="line">        n = (tab = resize()).length;</span><br><span class="line">    <span class="comment">// å¦‚æœå½“å‰indexçš„èŠ‚ç‚¹æ˜¯ç©ºçš„ï¼Œè¡¨ç¤ºæ²¡æœ‰å‘ç”Ÿå“ˆå¸Œç¢°æ’ã€‚ ç›´æ¥æ„å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹Nodeï¼ŒæŒ‚è½½åœ¨indexå¤„å³å¯ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="literal">null</span>)</span><br><span class="line">        tab[i] = newNode(hash, key, value, <span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å‘ç”Ÿå“ˆå¸Œç¢°æ’</span></span><br><span class="line">        Node&lt;K,V&gt; e; K k;</span><br><span class="line">        <span class="comment">// å¦‚æœå“ˆå¸Œå€¼ç›¸ç­‰ã€keyä¹Ÿç›¸ç­‰ï¼Œé‚£å°±ç›´æ¥è¦†ç›–</span></span><br><span class="line">        <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">            ((k = p.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            e = p;</span><br><span class="line">        <span class="comment">// å¦‚æœæ˜¯çº¢é»‘æ ‘çš„å®ä¾‹ï¼Œæš‚æ—¶ä¸è®¨è®º</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="built_in">this</span>, tab, hash, key, value);</span><br><span class="line">        <span class="comment">// å¦‚æœä»¥ä¸Šæƒ…å†µéƒ½ä¸æ»¡è¶³ï¼Œä¹Ÿå°±ä»£è¡¨ä¸æ˜¯çº¢é»‘æ ‘ï¼Œä½†æ˜¯è¯¥é“¾è¡¨ä¸æ­¢ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å¯¹é“¾è¡¨è¿›è¡Œéå†</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">binCount</span> <span class="operator">=</span> <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((e = p.next) == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// æ”¾å…¥é“¾è¡¨æœ€åé¢</span></span><br><span class="line">                    p.next = newNode(hash, key, value, <span class="literal">null</span>);</span><br><span class="line">                    <span class="comment">// å¦‚æœå½“å‰é“¾è¡¨èŠ‚ç‚¹ä¸ªæ•°å¤§äº8</span></span><br><span class="line">                    <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                        <span class="comment">// è½¬ä¸ºçº¢é»‘æ ‘</span></span><br><span class="line">                        treeifyBin(tab, hash);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// å¦‚æœæ‰¾åˆ°äº†è¦è¦†ç›–çš„èŠ‚ç‚¹</span></span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                p = e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœeä¸ä¸ºnullï¼Œä¹Ÿå°±æ˜¯è¯´æ‰¾åˆ°äº†éœ€è¦è¦†ç›–çš„èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">            <span class="type">V</span> <span class="variable">oldValue</span> <span class="operator">=</span> e.value;</span><br><span class="line">            <span class="comment">// å¦‚æœonlyIfAbsentä¸ºfalseï¼Œæˆ–è€…oldValueä¸å­˜åœ¨æ‰è¿›å…¥if</span></span><br><span class="line">            <span class="comment">// onlyIfAvsentè¿™ä¸ªå˜é‡çš„æ„æ€æ˜¯å¦‚æœä¸ºtrueï¼Œåˆ™æ­¤keyå¯¹åº”çš„èŠ‚ç‚¹æœ‰valueçš„æƒ…å†µï¼Œå¦åˆ™æ˜¯æ²¡æœ‰valueçš„æƒ…å†µï¼Œæ­¤å˜é‡ç”¨äºputIfAbsentæ–¹æ³•</span></span><br><span class="line">            <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="literal">null</span>)</span><br><span class="line">                e.value = value;</span><br><span class="line">            <span class="comment">// è¿™æ˜¯ä¸€ä¸ªç©ºå®ç°çš„å‡½æ•°ï¼Œç”¨ä½œLinkedHashMapé‡å†™ä½¿ç”¨</span></span><br><span class="line">            afterNodeAccess(e);</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç”±äºèŠ‚ç‚¹æ’å…¥æˆåŠŸï¼Œæˆ–è€…è¦†ç›–æˆåŠŸï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹modCounté€šçŸ¥HashMapç»“æ„å‘ç”Ÿå˜åŒ–</span></span><br><span class="line">    ++modCount;</span><br><span class="line">    <span class="comment">// æ›´æ–°sizeï¼Œå¦‚æœsizeè¾¾åˆ°äº†é˜ˆå€¼ï¼Œé‚£å°±æ‰©å®¹</span></span><br><span class="line">    <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">        resize();</span><br><span class="line">    <span class="comment">// è¿™æ˜¯ä¸€ä¸ªç©ºå®ç°çš„å‡½æ•°ï¼Œç”¨ä½œLinkedHashMapé‡å†™ä½¿ç”¨</span></span><br><span class="line">    afterNodeInsertion(evict);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å¸¸ç”¨API"><a href="#å¸¸ç”¨API" class="headerlink" title="å¸¸ç”¨API"></a>å¸¸ç”¨API</h1><h2 id="å¢ã€æ”¹"><a href="#å¢ã€æ”¹" class="headerlink" title="å¢ã€æ”¹"></a>å¢ã€æ”¹</h2><h3 id="HashMap-put-K-key-V-value"><a href="#HashMap-put-K-key-V-value" class="headerlink" title="HashMap # put(K key, V value)"></a>HashMap # put(K key, V value)</h3><p>åŠŸèƒ½ï¼š</p><ul><li>å¦‚æœåŸæ¥çš„è¡¨é‡Œé¢æ²¡æœ‰keyå¯¹åº”çš„èŠ‚ç‚¹ï¼Œå°±æŠŠkeyå’Œvalueæ’å…¥</li><li>å¦‚æœæœ‰å¯¹åº”çš„èŠ‚ç‚¹ï¼Œå°±æŠŠå°†keyå¯¹åº”èŠ‚ç‚¹çš„valueæ›´æ”¹ä¸ºä¼ å…¥çš„value</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">put</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">    <span class="comment">// -&gt;&gt; è§åˆ†æ3.4</span></span><br><span class="line">    <span class="keyword">return</span> putVal(hash(key), key, value, <span class="literal">false</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="HashMap-putAll-Map-lt-extends-K-extends-V-gt-m"><a href="#HashMap-putAll-Map-lt-extends-K-extends-V-gt-m" class="headerlink" title="HashMap # putAll(Map&lt;? extends K, ? extends V&gt; m)"></a>HashMap # putAll(Map&lt;? extends K, ? extends V&gt; m)</h3><p>åŠŸèƒ½ï¼š</p><ul><li>ç›´æ¥æŠŠMapé‡Œé¢çš„å†…å®¹ä¼ å…¥HashMap</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">putAll</span><span class="params">(Map&lt;? extends K, ? extends V&gt; m)</span> &#123;</span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ3.2</span></span><br><span class="line">    putMapEntries(m, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="HashMap-putIfAbsent-K-key-V-value"><a href="#HashMap-putIfAbsent-K-key-V-value" class="headerlink" title="HashMap # putIfAbsent(K key, V value)"></a>HashMap # putIfAbsent(K key, V value)</h3><p>åŠŸèƒ½ï¼š</p><ul><li>æ ¹æ®keyæ‰¾åˆ°å¯¹åº”èŠ‚ç‚¹</li><li>å¦‚æœè¯¥èŠ‚ç‚¹å·²ç»æœ‰valueï¼Œå°±è¿”å›æ­¤value</li><li>å¦åˆ™å°±å°†æ­¤valueæ’å…¥ï¼Œå¹¶è¿”å›null</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> V <span class="title function_">putIfAbsent</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ3.4</span></span><br><span class="line">    <span class="keyword">return</span> putVal(hash(key), key, value, <span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="HashMap-replace-K-key-V-oldValue-V-newValue"><a href="#HashMap-replace-K-key-V-oldValue-V-newValue" class="headerlink" title="HashMap # replace(K key, V oldValue, V newValue)"></a>HashMap # replace(K key, V oldValue, V newValue)</h3><p>åŠŸèƒ½ï¼š</p><ul><li>æ ¹æ®keyå’Œvalueæ‰¾åˆ°å¯¹åº”èŠ‚ç‚¹ï¼Œç„¶åæŠŠæ—§å€¼ç”¨newValueæ›¿æ¢</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">replace</span><span class="params">(K key, V oldValue, V newValue)</span> &#123;</span><br><span class="line">    Node&lt;K,V&gt; e; V v;</span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ4.3.1</span></span><br><span class="line">    <span class="comment">// æ ¹æ®keyæ‰¾åˆ°å¯¹åº”çš„èŠ‚ç‚¹ï¼Œå¹¶åˆ¤æ–­èŠ‚ç‚¹ä¸ºä¸ä¸ºç©ºï¼Œä»¥åŠæ­¤æ—¶çš„valueçš„å€¼ç­‰ä¸ç­‰äºä¼ å…¥çš„oldValue</span></span><br><span class="line">    <span class="keyword">if</span> ((e = getNode(hash(key), key)) != <span class="literal">null</span> &amp;&amp;</span><br><span class="line">        ((v = e.value) == oldValue || (v != <span class="literal">null</span> &amp;&amp; v.equals(oldValue)))) &#123;</span><br><span class="line">        <span class="comment">// æ›¿æ¢ä¸ºæ–°å€¼</span></span><br><span class="line">        e.value = newValue;</span><br><span class="line">        <span class="comment">// è¿™æ˜¯ä¸€ä¸ªç©ºå®ç°çš„å‡½æ•°ï¼Œç”¨ä½œLinkedHashMapé‡å†™ä½¿ç”¨</span></span><br><span class="line">        afterNodeAccess(e);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="HashMap-replace-K-key-V-value"><a href="#HashMap-replace-K-key-V-value" class="headerlink" title="HashMap # replace(K key, V value)"></a>HashMap # replace(K key, V value)</h3><p>åŠŸèƒ½ï¼š</p><ul><li>æ ¹æ®keyæ‰¾åˆ°å¯¹åº”çš„èŠ‚ç‚¹ï¼Œç„¶åç›´æ¥æŠŠvalueæ›¿æ¢è¿‡å»</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> V <span class="title function_">replace</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">    Node&lt;K,V&gt; e;</span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ4.3.1</span></span><br><span class="line">    <span class="comment">// æ‰¾åˆ°å¯¹åº”çš„èŠ‚ç‚¹ï¼Œå¹¶åˆ¤æ–­ä¸ºä¸ä¸ºç©º</span></span><br><span class="line">    <span class="keyword">if</span> ((e = getNode(hash(key), key)) != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// å–å‡ºä¹‹å‰çš„å€¼</span></span><br><span class="line">        <span class="type">V</span> <span class="variable">oldValue</span> <span class="operator">=</span> e.value;</span><br><span class="line">        <span class="comment">// æ›¿æ¢ä¸ºæ–°çš„å€¼</span></span><br><span class="line">        e.value = value;</span><br><span class="line">        <span class="comment">// è¿™æ˜¯ä¸€ä¸ªç©ºå®ç°çš„å‡½æ•°ï¼Œç”¨ä½œLinkedHashMapé‡å†™ä½¿ç”¨</span></span><br><span class="line">        afterNodeAccess(e);</span><br><span class="line">        <span class="comment">// æŠŠæ—§å€¼è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ "><a href="#åˆ " class="headerlink" title="åˆ "></a>åˆ </h2><h3 id="remove-Object-key"><a href="#remove-Object-key" class="headerlink" title="remove(Object key)"></a>remove(Object key)</h3><p>åŠŸèƒ½ï¼š</p><ul><li>æ ¹æ®keyæ‰¾åˆ°èŠ‚ç‚¹å¹¶åˆ é™¤</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">remove</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">    Node&lt;K,V&gt; e;</span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ4.2.1</span></span><br><span class="line">    <span class="keyword">return</span> (e = removeNode(hash(key), key, <span class="literal">null</span>, <span class="literal">false</span>, <span class="literal">true</span>)) == <span class="literal">null</span> ?</span><br><span class="line">        <span class="literal">null</span> : e.value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="remove-Object-key-Object-value"><a href="#remove-Object-key-Object-value" class="headerlink" title="remove(Object key, Object value)"></a>remove(Object key, Object value)</h3><p>åŠŸèƒ½ï¼š</p><ul><li>æ ¹æ®keyå’Œvalueæ‰¾åˆ°å¯¹åº”èŠ‚ç‚¹ï¼Œç„¶ååˆ é™¤</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">remove</span><span class="params">(Object key, Object value)</span> &#123;</span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ4.2.1</span></span><br><span class="line">    <span class="keyword">return</span> removeNode(hash(key), key, value, <span class="literal">true</span>, <span class="literal">true</span>) != <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ†æ4-2-1-HashMap-removeNode-int-hash-Object-key-Object-value-boolean-matchValue-boolean-movable"><a href="#åˆ†æ4-2-1-HashMap-removeNode-int-hash-Object-key-Object-value-boolean-matchValue-boolean-movable" class="headerlink" title="åˆ†æ4.2.1 HashMap # removeNode(int hash, Object key, Object value, boolean matchValue, boolean movable)"></a>åˆ†æ4.2.1 HashMap # removeNode(int hash, Object key, Object value, boolean matchValue, boolean movable)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æ4.2.1ï¼šHashMap.removeNode()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title function_">removeNode</span><span class="params">(<span class="type">int</span> hash, Object key, Object value,</span></span><br><span class="line"><span class="params">                           <span class="type">boolean</span> matchValue, <span class="type">boolean</span> movable)</span> &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="type">int</span> n, index;</span><br><span class="line">    <span class="comment">// å¦‚æœå“ˆå¸Œæ¡¶ä¸ä¸ºç©ºå¹¶ä¸”å“ˆå¸Œæ¡¶çš„é•¿åº¦å¤§äº0å¹¶ä¸”keyå¯¹åº”çš„å“ˆå¸Œæ¡¶ä¸ä¸ºç©º</span></span><br><span class="line">    <span class="keyword">if</span> ((tab = table) != <span class="literal">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">        (p = tab[index = (n - <span class="number">1</span>) &amp; hash]) != <span class="literal">null</span>) &#123;</span><br><span class="line">        Node&lt;K,V&gt; node = <span class="literal">null</span>, e; K k; V v;</span><br><span class="line">        <span class="comment">// å¦‚æœé“¾è¡¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯è¦åˆ é™¤çš„èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">            ((k = p.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            <span class="comment">// ç›´æ¥èµ‹å€¼ç»™node</span></span><br><span class="line">            node = p;</span><br><span class="line">        <span class="comment">// å¦åˆ™çš„è¯ï¼Œçœ‹ä¸‹ä¸€ä½æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œé‚£å°±è¯æ˜æ­¤å¤„æœ‰é“¾è¡¨æˆ–è€…çº¢é»‘æ ‘</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((e = p.next) != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// çº¢é»‘æ ‘</span></span><br><span class="line">            <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key);</span><br><span class="line">            <span class="comment">// ä¸æ˜¯çº¢é»‘æ ‘ï¼Œå°±ä»£è¡¨åªæ˜¯é“¾è¡¨ï¼Œè€Œä¸”é“¾è¡¨é•¿åº¦ä¸è¶…è¿‡8</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// éå†æ‰¾åˆ°å¯¹åº”çš„èŠ‚ç‚¹ï¼Œç„¶åèµ‹å€¼ç»™node</span></span><br><span class="line">                <span class="keyword">do</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                        ((k = e.key) == key ||</span><br><span class="line">                         (key != <span class="literal">null</span> &amp;&amp; key.equals(k)))) &#123;</span><br><span class="line">                        node = e;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    p = e;</span><br><span class="line">                &#125; <span class="keyword">while</span> ((e = e.next) != <span class="literal">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ‰¾åˆ°äº†èŠ‚ç‚¹å¹¶ä¸”è¦ä¹ˆmatchValueä¸ºfalseï¼Œè¦ä¹ˆnodeçš„valueå¾—å’Œä¼ å…¥çš„valueç›¸ç­‰</span></span><br><span class="line">        <span class="keyword">if</span> (node != <span class="literal">null</span> &amp;&amp; (!matchValue || (v = node.value) == value ||</span><br><span class="line">                             (value != <span class="literal">null</span> &amp;&amp; value.equals(v)))) &#123;</span><br><span class="line">            <span class="comment">// çº¢é»‘æ ‘ï¼Œä¸ç®¡</span></span><br><span class="line">            <span class="keyword">if</span> (node <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                ((TreeNode&lt;K,V&gt;)node).removeTreeNode(<span class="built_in">this</span>, tab, movable);</span><br><span class="line">            <span class="comment">// å¦‚æœnode==pä¹Ÿå°±æ˜¯è¯¥å“ˆå¸Œæ¡¶é‡Œé¢ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯æˆ‘ä»¬éœ€è¦æ‰¾çš„</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (node == p)</span><br><span class="line">                <span class="comment">// æ“ä½œ</span></span><br><span class="line">                tab[index] = node.next;</span><br><span class="line">            <span class="comment">// ä¸Šé¢ifä¸æˆç«‹ä¹Ÿå°±ä»£è¡¨ç€è¦æ‰¾çš„èŠ‚ç‚¹ä¸æ˜¯å“ˆå¸Œæ¡¶é‡Œé¢çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="comment">// æ“ä½œ</span></span><br><span class="line">                p.next = node.next;</span><br><span class="line">            <span class="comment">// ç”±äºæˆ‘ä»¬æ”¹å˜äº†å“ˆå¸Œè¡¨çš„ç»“æ„ï¼Œæ‰€ä»¥éœ€è¦æ›´æ–°modCount</span></span><br><span class="line">            ++modCount;</span><br><span class="line">            <span class="comment">// æ›´æ–°size</span></span><br><span class="line">            --size;</span><br><span class="line">            <span class="comment">// è¿™æ˜¯ä¸€ä¸ªç©ºå®ç°çš„å‡½æ•°ï¼Œç”¨ä½œLinkedHashMapé‡å†™ä½¿ç”¨</span></span><br><span class="line">            afterNodeRemoval(node);</span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åœ¨å¯¹åº”å“ˆå¸Œæ¡¶é‡Œé¢æ‰¾ä¸åˆ°å¯¹åº”çš„èŠ‚ç‚¹ï¼Œå°±è¿”å›null</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æŸ¥"><a href="#æŸ¥" class="headerlink" title="æŸ¥"></a>æŸ¥</h2><h3 id="HashMap-get-Object-key"><a href="#HashMap-get-Object-key" class="headerlink" title="HashMap # get(Object key)"></a>HashMap # get(Object key)</h3><p>åŠŸèƒ½ï¼š</p><ul><li>æ ¹æ®keyæ‰¾åˆ°å¯¹åº”èŠ‚ç‚¹ï¼Œå¹¶è¿”å›èŠ‚ç‚¹çš„valueã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">get</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">    Node&lt;K,V&gt; e;</span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ4.4.1</span></span><br><span class="line">    <span class="comment">// æ‰¾å¾—åˆ°èŠ‚ç‚¹å°±è¿”å›èŠ‚ç‚¹çš„valueï¼Œæ‰¾ä¸åˆ°åˆ™è¿”å›null</span></span><br><span class="line">    <span class="keyword">return</span> (e = getNode(hash(key), key)) == <span class="literal">null</span> ? <span class="literal">null</span> : e.value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="HashMap-containsValue-Object-value"><a href="#HashMap-containsValue-Object-value" class="headerlink" title="HashMap # containsValue(Object value)"></a>HashMap # containsValue(Object value)</h3><p>åŠŸèƒ½ï¼š</p><ul><li>æ ¹æ®valueæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„èŠ‚ç‚¹ï¼›</li><li>å¦‚æœæ‰¾åˆ°äº†å°±è¿”å›trueï¼›</li><li>æ²¡æœ‰è¿”å›falseã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">containsValue</span><span class="params">(Object value)</span> &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; V v;</span><br><span class="line">    <span class="comment">// å¦‚æœå“ˆå¸Œè¡¨ç”±å†…å®¹çš„è¯è¿›å…¥if</span></span><br><span class="line">    <span class="keyword">if</span> ((tab = table) != <span class="literal">null</span> &amp;&amp; size &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// ç›´æ¥éå†å“ˆå¸Œæ¡¶æ•°ç»„</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; tab.length; ++i) &#123;</span><br><span class="line">            <span class="comment">// å†éå†å½“å‰å“ˆå¸Œæ¡¶é‡Œé¢çš„èŠ‚ç‚¹ï¼Œåˆ¤æ–­æœ‰æ²¡æœ‰éœ€è¦æ‰¾çš„valueï¼Œå¦‚æœæœ‰å°±è¿”å›ï¼Œæ²¡æœ‰å°±éå†ä¸‹ä¸€ä¸ªå“ˆå¸Œæ¡¶</span></span><br><span class="line">            <span class="keyword">for</span> (Node&lt;K,V&gt; e = tab[i]; e != <span class="literal">null</span>; e = e.next) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((v = e.value) == value ||</span><br><span class="line">                    (value != <span class="literal">null</span> &amp;&amp; value.equals(v)))</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="HashMap-containsKey-Object-key"><a href="#HashMap-containsKey-Object-key" class="headerlink" title="HashMap # containsKey(Object key)"></a>HashMap # containsKey(Object key)</h3><p>åŠŸèƒ½ï¼š</p><ul><li>æ ¹æ®keyæ‰¾åˆ°å¯¹åº”èŠ‚ç‚¹ï¼›</li><li>å¦‚æœæœ‰è¿”å›trueï¼›</li><li>å¦åˆ™è¿”å›falseã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">containsKey</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ4.3.1</span></span><br><span class="line">    <span class="keyword">return</span> getNode(hash(key), key) != <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="HashMap-getOrDefault-Object-key-V-defaultValue"><a href="#HashMap-getOrDefault-Object-key-V-defaultValue" class="headerlink" title="HashMap # getOrDefault(Object key, V defaultValue)"></a>HashMap # getOrDefault(Object key, V defaultValue)</h3><p>åŠŸèƒ½ï¼š</p><ul><li>æ ¹æ®keyæ‰¾åˆ°å¯¹åº”èŠ‚ç‚¹ï¼›</li><li>å¦‚æœæœ‰è¿”å›æ‰¾åˆ°èŠ‚ç‚¹çš„valueï¼›</li><li>å¦åˆ™è¿”å›ä¼ å…¥çš„defaultValueã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">getOrDefault</span><span class="params">(Object key, V defaultValue)</span> &#123;</span><br><span class="line">    Node&lt;K,V&gt; e;</span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ4.3.1</span></span><br><span class="line">    <span class="keyword">return</span> (e = getNode(hash(key), key)) == <span class="literal">null</span> ? defaultValue : e.value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ†æ4-3-1-HashMap-getNode-int-hash-Object-key"><a href="#åˆ†æ4-3-1-HashMap-getNode-int-hash-Object-key" class="headerlink" title="åˆ†æ4.3.1 HashMap # getNode(int hash, Object key)"></a>åˆ†æ4.3.1 HashMap # getNode(int hash, Object key)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title function_">getNode</span><span class="params">(<span class="type">int</span> hash, Object key)</span> &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span class="type">int</span> n; K k;</span><br><span class="line">    <span class="comment">// å“ˆå¸Œè¡¨é‡Œé¢æœ‰æ•°æ®</span></span><br><span class="line">    <span class="keyword">if</span> ((tab = table) != <span class="literal">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">        (first = tab[(n - <span class="number">1</span>) &amp; hash]) != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ˜¯è¯¥å“ˆå¸Œæ¡¶é‡Œé¢çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯è¦æ‰¾çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆç›´æ¥å°†è¯¥èŠ‚ç‚¹è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span> (first.hash == hash &amp;&amp; <span class="comment">// always check first node</span></span><br><span class="line">            ((k = first.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            <span class="keyword">return</span> first;</span><br><span class="line">        <span class="comment">// å¦‚æœç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸æ˜¯ï¼Œé‚£å°±éå†åç»­èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> ((e = first.next) != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// çº¢é»‘æ ‘ï¼Œä¸åšè®¨è®º</span></span><br><span class="line">            <span class="keyword">if</span> (first <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                <span class="keyword">return</span> ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);</span><br><span class="line">            <span class="comment">// åœ¨èŠ‚ç‚¹æ•°å°äºç­‰äº8æ—¶ï¼Œæ­¤æ—¶è¿˜æ²¡è½¬ä¸ºçº¢é»‘æ ‘ï¼Œè¿™æ—¶å°±éå†è¯¥é“¾è¡¨ï¼Œæ‰¾åˆ°è¦æ‰¾çš„èŠ‚ç‚¹ï¼Œå¹¶è¿”å›</span></span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="keyword">return</span> e;</span><br><span class="line">            &#125; <span class="keyword">while</span> ((e = e.next) != <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ¤ç©º-isEmpty"><a href="#åˆ¤ç©º-isEmpty" class="headerlink" title="åˆ¤ç©º isEmpty()"></a>åˆ¤ç©º isEmpty()</h2><p>è¿™ä¸ªæ–¹æ³•æ²¡å•¥å¥½è¯´çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="éå†"><a href="#éå†" class="headerlink" title="éå†"></a>éå†</h2><p>å…ˆå°†ä¸€ä¸‹ç”¨æ³•å§ã€‚å› ä¸ºHashMapçš„éå†æœ‰ç‚¹ç‰¹åˆ«ã€‚</p><p>ä»–çš„éå†å¹¶ä¸æ˜¯ç›´æ¥ä½¿ç”¨è¿­ä»£å™¨æˆ–è€…ä»–è‡ªå·±æœ‰ä¸ªå•¥foreachæ–¹æ³•èƒ½éå†(è™½è¯´ä»–æœ‰foreachæ–¹æ³•ï¼Œä½†æ˜¯ä»–é‚£ä¸ªæ–¹æ³•ä¸æ˜¯ç”¨æ¥éå†ï¼Œè€Œæ˜¯éå†è¿›è¡Œæ“ä½œçš„)ã€‚</p><p>ä»–çš„éå†æ–¹å¼å¾ˆå¥‡ç‰¹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(Object key : map.keySet()) &#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æˆ–<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(HashMap.Entry entry : map.entrySet()) &#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä»ä¸Šé¢ä»£ç ç‰‡æ®µä¸­å¯ä»¥çœ‹å‡ºï¼Œå¤§å®¶ä¸€èˆ¬éƒ½æ˜¯å¯¹ HashMap çš„ key é›†åˆæˆ– Entry é›†åˆè¿›è¡Œéå†ã€‚ä¸Šé¢ä»£ç ç‰‡æ®µä¸­ç”¨ foreach éå† keySet æ–¹æ³•äº§ç”Ÿçš„é›†åˆï¼Œåœ¨ç¼–è¯‘æ—¶ä¼šè½¬æ¢æˆç”¨è¿­ä»£å™¨éå†ï¼Œç­‰ä»·äºï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Set</span> <span class="variable">keys</span> <span class="operator">=</span> map.keySet();</span><br><span class="line"><span class="type">Iterator</span> <span class="variable">ite</span> <span class="operator">=</span> keys.iterator();</span><br><span class="line"><span class="keyword">while</span> (ite.hasNext()) &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">key</span> <span class="operator">=</span> ite.next();</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¤§å®¶åœ¨éå† HashMap çš„è¿‡ç¨‹ä¸­ä¼šå‘ç°ï¼Œå¤šæ¬¡å¯¹ HashMap è¿›è¡Œéå†æ—¶ï¼Œéå†ç»“æœé¡ºåºéƒ½æ˜¯ä¸€è‡´çš„ã€‚ä½†è¿™ä¸ªé¡ºåºå’Œæ’å…¥çš„é¡ºåºä¸€èˆ¬éƒ½æ˜¯ä¸ä¸€è‡´çš„ã€‚äº§ç”Ÿä¸Šè¿°è¡Œä¸ºçš„åŸå› æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</p><p>ç°åœ¨å’±ä»¬å°±å…ˆæ¥çœ‹çœ‹ä»£ç å§ã€‚</p><p>é¦–å…ˆçœ‹ä¸‹keySetæ–¹æ³•ï¼š</p><h3 id="HashMap-keySet"><a href="#HashMap-keySet" class="headerlink" title="HashMap # keySet()"></a>HashMap # keySet()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Set&lt;K&gt; <span class="title function_">keySet</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// å¤åˆ¶ï¼Œå°½ç®¡æˆ‘åœ¨HashMapç±»é‡Œé¢æ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªå˜é‡ï¼Œä½†æ˜¯ä¸å¦¨ç¢æˆ‘ä»¬çœ‹æºç </span></span><br><span class="line">    Set&lt;K&gt; ks = keySet;</span><br><span class="line">    <span class="keyword">if</span> (ks == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// æ„é€ æ–¹æ³•</span></span><br><span class="line">        <span class="comment">// -&gt;&gt; 4.5.2</span></span><br><span class="line">        ks = <span class="keyword">new</span> <span class="title class_">KeySet</span>();</span><br><span class="line">        keySet = ks;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ks;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="HashMap-KeySet"><a href="#HashMap-KeySet" class="headerlink" title="HashMap # KeySet"></a>HashMap # KeySet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">KeySet</span> <span class="keyword">extends</span> <span class="title class_">AbstractSet</span>&lt;K&gt; &#123;</span><br><span class="line">    <span class="comment">// è¿”å›HashMapçš„size</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span>                 &#123; <span class="keyword">return</span> size; &#125;</span><br><span class="line">    <span class="comment">// è°ƒç”¨HashMapçš„clearæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span>               &#123; HashMap.<span class="built_in">this</span>.clear(); &#125;</span><br><span class="line">    <span class="comment">// -&gt;&gt; 4.5.3</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> Iterator&lt;K&gt; <span class="title function_">iterator</span><span class="params">()</span>     &#123; <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">KeyIterator</span>(); &#125;</span><br><span class="line">    <span class="comment">// è°ƒç”¨HashMapçš„containsKeyæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">contains</span><span class="params">(Object o)</span> &#123; <span class="keyword">return</span> containsKey(o); &#125;</span><br><span class="line">    <span class="comment">// è°ƒç”¨HashMapçš„removeNodeæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">remove</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> removeNode(hash(key), key, <span class="literal">null</span>, <span class="literal">false</span>, <span class="literal">true</span>) != <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> Spliterator&lt;K&gt; <span class="title function_">spliterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">KeySpliterator</span>&lt;&gt;(HashMap.<span class="built_in">this</span>, <span class="number">0</span>, -<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">forEach</span><span class="params">(Consumer&lt;? <span class="built_in">super</span> K&gt; action)</span> &#123;</span><br><span class="line">        Node&lt;K,V&gt;[] tab;</span><br><span class="line">        <span class="keyword">if</span> (action == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>();</span><br><span class="line">        <span class="keyword">if</span> (size &gt; <span class="number">0</span> &amp;&amp; (tab = table) != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// fast-fail å¯ä»¥çœ‹æˆ‘ä¹‹å‰ArrayListæºç åšå®¢</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">mc</span> <span class="operator">=</span> modCount;</span><br><span class="line">            <span class="comment">// Android-changed: Detect changes to modCount early.</span></span><br><span class="line">            <span class="comment">// éå†æ¯ä¸€ä¸ªå“ˆå¸Œæ¡¶</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; (i &lt; tab.length &amp;&amp; modCount == mc); ++i) &#123;</span><br><span class="line">                <span class="comment">// éå†å“ˆå¸Œæ¡¶é‡Œé¢æ¯ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">                <span class="keyword">for</span> (Node&lt;K,V&gt; e = tab[i]; e != <span class="literal">null</span>; e = e.next)</span><br><span class="line">                    action.accept(e.key);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// åœ¨éå†è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰å…¶ä»–çº¿ç¨‹å¯¹æ­¤HashMapæ“ä½œå¯¼è‡´HashMapçš„ç»“æ„å‘ç”Ÿäº†å˜åŒ–ï¼Œå¯¼è‡´modCountçš„å€¼å‘ç”Ÿäº†å˜åŒ–ï¼Œè¿›è€Œä¸ç­‰äºmcï¼ŒæŠ›å¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">if</span> (modCount != mc)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="HashMap-KeyIterator"><a href="#HashMap-KeyIterator" class="headerlink" title="HashMap # KeyIterator"></a>HashMap # KeyIterator</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">KeyIterator</span> <span class="keyword">extends</span> <span class="title class_">HashIterator</span></span><br><span class="line">    <span class="keyword">implements</span> <span class="title class_">Iterator</span>&lt;K&gt; &#123;</span><br><span class="line">    <span class="comment">// nextNode()æ˜¯HashIteratoré‡Œçš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> K <span class="title function_">next</span><span class="params">()</span> &#123; <span class="keyword">return</span> nextNode().key; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="HashMap-HashIterator"><a href="#HashMap-HashIterator" class="headerlink" title="HashMap # HashIterator"></a>HashMap # HashIterator</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">HashIterator</span> &#123;</span><br><span class="line">    Node&lt;K,V&gt; next;        <span class="comment">// next entry to return</span></span><br><span class="line">    Node&lt;K,V&gt; current;     <span class="comment">// current entry</span></span><br><span class="line">    <span class="type">int</span> expectedModCount;  <span class="comment">// for fast-fail</span></span><br><span class="line">    <span class="type">int</span> index;             <span class="comment">// current slot</span></span><br><span class="line"></span><br><span class="line">    HashIterator() &#123;</span><br><span class="line">        expectedModCount = modCount;</span><br><span class="line">        Node&lt;K,V&gt;[] t = table;</span><br><span class="line">        current = next = <span class="literal">null</span>;</span><br><span class="line">        index = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// æ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ…å«èŠ‚ç‚¹çš„æ¡¶</span></span><br><span class="line">        <span class="keyword">if</span> (t != <span class="literal">null</span> &amp;&amp; size &gt; <span class="number">0</span>) &#123; <span class="comment">// advance to first entry</span></span><br><span class="line">            <span class="keyword">do</span> &#123;&#125; <span class="keyword">while</span> (index &lt; t.length &amp;&amp; (next = t[index++]) == <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> next != <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> Node&lt;K,V&gt; <span class="title function_">nextNode</span><span class="params">()</span> &#123;</span><br><span class="line">        Node&lt;K,V&gt;[] t;</span><br><span class="line">        Node&lt;K,V&gt; e = next;</span><br><span class="line">        <span class="comment">// fast-fail</span></span><br><span class="line">        <span class="keyword">if</span> (modCount != expectedModCount)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line">        <span class="keyword">if</span> (e == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NoSuchElementException</span>();</span><br><span class="line">        <span class="keyword">if</span> ((next = (current = e).next) == <span class="literal">null</span> &amp;&amp; (t = table) != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// å¯»æ‰¾ä¸‹ä¸€ä¸ªåŒ…å«èŠ‚ç‚¹çš„æ¡¶</span></span><br><span class="line">            <span class="keyword">do</span> &#123;&#125; <span class="keyword">while</span> (index &lt; t.length &amp;&amp; (next = t[index++]) == <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> e;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">()</span> &#123;</span><br><span class="line">        Node&lt;K,V&gt; p = current;</span><br><span class="line">        <span class="keyword">if</span> (p == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>();</span><br><span class="line">        <span class="comment">// fast-fail</span></span><br><span class="line">        <span class="keyword">if</span> (modCount != expectedModCount)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line">        current = <span class="literal">null</span>;</span><br><span class="line">        <span class="type">K</span> <span class="variable">key</span> <span class="operator">=</span> p.key;</span><br><span class="line">        <span class="comment">// è°ƒç”¨HashMapçš„removeNodeæ–¹æ³•</span></span><br><span class="line">        removeNode(hash(key), key, <span class="literal">null</span>, <span class="literal">false</span>, <span class="literal">false</span>);</span><br><span class="line">        expectedModCount = modCount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šé¢çš„æºç ï¼Œéå†æ‰€æœ‰çš„é”®æ—¶ï¼Œé¦–å…ˆè¦è·å–é”®é›†åˆKeySetå¯¹è±¡ï¼Œç„¶åå†é€šè¿‡ KeySet çš„è¿­ä»£å™¨KeyIteratorè¿›è¡Œéå†ã€‚KeyIterator ç±»ç»§æ‰¿è‡ªHashIteratorç±»ï¼Œæ ¸å¿ƒé€»è¾‘ä¹Ÿå°è£…åœ¨ HashIterator ç±»ä¸­ã€‚HashIterator çš„é€»è¾‘å¹¶ä¸å¤æ‚ï¼Œåœ¨åˆå§‹åŒ–æ—¶ï¼ŒHashIterator å…ˆä»æ¡¶æ•°ç»„ä¸­æ‰¾åˆ°åŒ…å«é“¾è¡¨èŠ‚ç‚¹å¼•ç”¨çš„æ¡¶ã€‚ç„¶åå¯¹è¿™ä¸ªæ¡¶æŒ‡å‘çš„é“¾è¡¨è¿›è¡Œéå†ã€‚éå†å®Œæˆåï¼Œå†ç»§ç»­å¯»æ‰¾ä¸‹ä¸€ä¸ªåŒ…å«é“¾è¡¨èŠ‚ç‚¹å¼•ç”¨çš„æ¡¶ï¼Œæ‰¾åˆ°ç»§ç»­éå†ã€‚æ‰¾ä¸åˆ°ï¼Œåˆ™ç»“æŸéå†ã€‚</p><h1 id="æ‹“å±•"><a href="#æ‹“å±•" class="headerlink" title="æ‹“å±•"></a>æ‹“å±•</h1><h2 id="ä¸ºä»€ä¹ˆå“ˆå¸Œæ¡¶çš„é•¿åº¦ä¸€å®šæ˜¯2çš„æ¬¡æ–¹å¹‚"><a href="#ä¸ºä»€ä¹ˆå“ˆå¸Œæ¡¶çš„é•¿åº¦ä¸€å®šæ˜¯2çš„æ¬¡æ–¹å¹‚" class="headerlink" title="ä¸ºä»€ä¹ˆå“ˆå¸Œæ¡¶çš„é•¿åº¦ä¸€å®šæ˜¯2çš„æ¬¡æ–¹å¹‚"></a>ä¸ºä»€ä¹ˆå“ˆå¸Œæ¡¶çš„é•¿åº¦ä¸€å®šæ˜¯2çš„æ¬¡æ–¹å¹‚</h2><p>è¿™æ˜¯å› ä¸ºåœ¨å“ˆå¸Œè¡¨ä¸­ï¼Œä¸ºäº†è®¡ç®—æ–¹ä¾¿ï¼Œä»–å…¨éƒ¨éƒ½ç”¨<code>hash&amp;(n-1)</code>ä»£æ›¿äº†<code>hash%n</code>ï¼Œä½†æ˜¯è¿™æ ·æ›¿æ¢çš„å‰æå°±æ˜¯nå¿…é¡»æ˜¯2çš„æ¬¡æ–¹å¹‚ã€‚</p><h2 id="hash-æ–¹æ³•æ ¸å¿ƒ"><a href="#hash-æ–¹æ³•æ ¸å¿ƒ" class="headerlink" title="hash()æ–¹æ³•æ ¸å¿ƒ"></a>hash()æ–¹æ³•æ ¸å¿ƒ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">hash</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">    <span class="type">int</span> h;</span><br><span class="line">    <span class="keyword">return</span> (key == <span class="literal">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);    <span class="comment">//key.hashCode()ä¸ºå“ˆå¸Œç®—æ³•ï¼Œè¿”å›åˆå§‹å“ˆå¸Œå€¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç çš„æµç¨‹å°±æ˜¯æ‰§è¡Œkeyçš„hashCodeæ–¹æ³•å¾—åˆ°ä»–çš„hashCodeï¼Œç„¶åå†è®©ä»–çš„hashCodeä¸hashCodeå³ç§»16ä½ä¹‹åçš„å€¼ç›¸ä¸ã€‚</p><p>é‚£ä¸ºå•¥è¦è¿™æ ·å‘¢ï¼Ÿ</p><p>ç†è®ºä¸Šæ•£åˆ—å€¼æ˜¯ä¸€ä¸ªintå‹ï¼Œå¦‚æœç›´æ¥æ‹¿æ•£åˆ—å€¼ä½œä¸ºä¸‹æ ‡è®¿é—®HashMapä¸»æ•°ç»„çš„è¯ï¼Œè€ƒè™‘åˆ°2è¿›åˆ¶32ä½å¸¦ç¬¦å·çš„intè¡¨å€¼èŒƒå›´ä»-2147483648åˆ°2147483648ã€‚å‰ååŠ èµ·æ¥å¤§æ¦‚40äº¿çš„æ˜ å°„ç©ºé—´ã€‚åªè¦å“ˆå¸Œå‡½æ•°æ˜ å°„å¾—æ¯”è¾ƒå‡åŒ€æ¾æ•£ï¼Œä¸€èˆ¬åº”ç”¨æ˜¯å¾ˆéš¾å‡ºç°ç¢°æ’çš„ã€‚</p><p>ä½†é—®é¢˜æ˜¯ä¸€ä¸ª40äº¿é•¿åº¦çš„æ•°ç»„ï¼Œå†…å­˜æ˜¯æ”¾ä¸ä¸‹çš„ã€‚ä½ æƒ³ï¼ŒHashMapæ‰©å®¹ä¹‹å‰çš„æ•°ç»„åˆå§‹å¤§å°æ‰16ã€‚æ‰€ä»¥è¿™ä¸ªæ•£åˆ—å€¼æ˜¯ä¸èƒ½ç›´æ¥æ‹¿æ¥ç”¨çš„ã€‚ç”¨ä¹‹å‰è¿˜è¦å…ˆåšå¯¹æ•°ç»„çš„é•¿åº¦å–æ¨¡è¿ç®—ï¼Œå¾—åˆ°çš„ä½™æ•°æ‰èƒ½ç”¨æ¥è®¿é—®æ•°ç»„ä¸‹æ ‡ã€‚</p><p>è¿™æ ·çš„è¯ï¼Œå°±ç®—æˆ‘çš„æ•£åˆ—å€¼åˆ†å¸ƒçš„å†æ¾æ•£ï¼Œè¦æ˜¯åªå–æœ€åå‡ ä½çš„è¯ï¼Œç¢°æ’ä¹Ÿä¼šå¾ˆä¸¥é‡ï¼Œè¿™æ—¶ï¼Œå°±å¯ä»¥è®©hashCodeè‡ªå·±çš„é«˜ä½å’Œä½ä½ç›¸ä¸ï¼Œè¿™æ ·åŠ å¤§äº†æ•°æ®çš„éšæœºæ€§ï¼Œå¾ˆå¤§ç¨‹åº¦é™ä½äº†ç¢°æ’çš„å‡ ç‡ã€‚<br><img src="https://cdn.littlecorgi.top/mweb/2019-11-22/15744333648313.jpg" alt=""></p><h2 id="å˜é‡tableä¸ºä»€ä¹ˆè¢«transientä¿®é¥°"><a href="#å˜é‡tableä¸ºä»€ä¹ˆè¢«transientä¿®é¥°" class="headerlink" title="å˜é‡tableä¸ºä»€ä¹ˆè¢«transientä¿®é¥°"></a>å˜é‡tableä¸ºä»€ä¹ˆè¢«transientä¿®é¥°</h2><p>HashMapæ˜æ˜å®ç°äº†serializableæ¥å£ï¼Œè€Œä¸”è¿˜å®šä¹‰é‡ŒserialVersionUIDï¼Œé‚£ä¸ºä»€ä¹ˆtableè¿˜éœ€è¦ç”¨transientä¿®é¥°è€Œä¸å»ç›´æ¥åºåˆ—åŒ–å‘¢ï¼Ÿ</p><p>å…¶å®HashMapå¹¶æ²¡æœ‰ä½¿ç”¨é»˜è®¤çš„åºåˆ—åŒ–æœºåˆ¶ï¼Œè€Œæ˜¯é€šè¿‡å®ç°readObject/writeObjectä¸¤ä¸ªæ–¹æ³•è‡ªå®šä¹‰äº†åºåˆ—åŒ–çš„å†…å®¹ã€‚å¦‚æœç›´æ¥å¯¹tableè¿›è¡Œåºåˆ—åŒ–çš„è¯å­˜åœ¨ç€ä¸¤ä¸ªé—®é¢˜:</p><ul><li>tableå¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯æ— æ³•è¢«å­˜æ»¡çš„ï¼Œåºåˆ—åŒ–æœªä½¿ç”¨çš„éƒ¨åˆ†ï¼Œæµªè´¹ç©ºé—´ï¼›</li><li>åŒä¸€ä¸ªé”®å€¼å¯¹åœ¨ä¸åŒJVMä¸‹ï¼Œæ‰€å¤„çš„æ¡¶ä½ç½®å¯èƒ½æ˜¯ä¸åŒçš„ï¼Œåœ¨ä¸åŒçš„JVMä¸‹ååºåˆ—åŒ–tableå¯èƒ½ä¼šå‘ç”Ÿé”™è¯¯ã€‚</li></ul><p>ç¬¬ä¸€ä¸ªå¥½ç†è§£ï¼Œé‚£æˆ‘ä»¬è¯´ä¸€ä¸‹ç¬¬äºŒä¸ªï¼šå¤§å®¶éƒ½çŸ¥é“HashMapå¾ˆå¤šåœ°æ–¹éƒ½æ˜¯æ ¹æ®hashå€¼æ¥è¿›è¡Œå­˜å…¥æˆ–è€…å–å‡ºæ•°æ®çš„ï¼Œä½†æ˜¯hashè°ƒç”¨çš„æ˜¯Objectçš„hashCodeæ–¹æ³•ã€‚ä½†æ˜¯hashCodeæ–¹æ³•æ˜¯nativeæ–¹æ³•ï¼Œè¿™ä¸ªæ˜¯å–å†³äºJVMçš„ï¼Œä¸åŒçš„JVMå¯èƒ½è®¡ç®—hashCodeçš„æ–¹æ³•ä¸åŒã€‚æ‰€ä»¥å¦‚æœåœ¨ä¸åŒçš„å¹³å°ä¸‹ï¼Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–HashMapä¹‹åã€‚å¯èƒ½åºåˆ—åŒ–æ—¶çš„HashMapæ˜¯å¯¹ç€çš„ï¼Œç›´æ¥ååºåˆ—åŒ–åï¼Œå¯èƒ½åºåˆ—åŒ–ä¸­çš„å…ƒç´ aåº”è¯¥æ”¾åœ¨å“ˆå¸Œæ¡¶1ä¸­ï¼Œè¿™æ ·ï¼Œååºåˆ—åŒ–ä¹Ÿæ”¾åœ¨æ¡¶1ä¸­ï¼Œä½†æ˜¯ç”±äºååºåˆ—åŒ–çš„å¹³å°ä¸åŒï¼Œå¯¼è‡´hashcodeç®—æ³•ä¸åŒï¼Œå¯¼è‡´åœ¨ååºåˆ—æ—¶å…ƒç´ aåº”è¯¥åœ¨æ¡¶2ä¸­ï¼Œè¿™æ ·å°±å¯¼è‡´HashMapç»“æ„å‡ºé—®é¢˜ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Java/">Java</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Java/">Java</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E6%BA%90%E7%A0%81/">æºç </category>
      
      <category domain="https://www.littlecorgi.top/tags/%E9%9B%86%E5%90%88/">é›†åˆ</category>
      
      <category domain="https://www.littlecorgi.top/tags/HashMap/">HashMap</category>
      
      
      <comments>https://www.littlecorgi.top/posts/2982320f.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Javaé›†åˆæºç ä¹‹ArrayList</title>
      <link>https://www.littlecorgi.top/posts/970dc297.html</link>
      <guid>https://www.littlecorgi.top/posts/970dc297.html</guid>
      <pubDate>Mon, 18 Nov 2019 14:14:10 GMT</pubDate>
      
        
        
          
          
      <description></description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>ArrayListå¯ä»¥è¯´æ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„ä¸€ç§é›†åˆäº†ã€‚</p><p>ä»–çš„æœ¬è´¨æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¸€ä¸ª<strong>å¯ä»¥è‡ªåŠ¨æ‰©å®¹çš„åŠ¨æ€æ•°ç»„</strong>ï¼Œ<strong>çº¿ç¨‹ä¸å®‰å…¨</strong>ï¼Œ<strong>å…è®¸å…ƒç´ ä¸ºnull</strong>ã€‚</p><p>ç”±äºæ•°ç»„çš„å†…å­˜è¿ç»­ï¼Œå¯ä»¥æ ¹æ®ä¸‹æ ‡ä»¥O(1)çš„æ—¶é—´è¯»å†™å…ƒç´ ï¼Œå› æ­¤æ—¶é—´æ•ˆç‡å¾ˆé«˜ã€‚</p><h1 id="å†…éƒ¨å±æ€§"><a href="#å†…éƒ¨å±æ€§" class="headerlink" title="å†…éƒ¨å±æ€§"></a>å†…éƒ¨å±æ€§</h1><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ArrayListé‡Œé¢æœ‰å“ªå‡ ä¸ªå±æ€§:</p><ul><li><p><code>private static final long serialVersionUID = 8683452581122892189L;</code><br>åºåˆ—è¯UIDã€‚ç”±äºArrayListå®ç°äº†Serializableæ¥å£ï¼Œä¸ºäº†åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ–¹ä¾¿ï¼Œæˆ‘ä»¬å°±æ‰‹åŠ¨ä¸ºä»–æ·»åŠ ä¸€ä¸ªåºåˆ—åŒ–UIDã€‚</p></li><li><p><code>private static final int DEFAULT_CAPACITY = 10;</code><br>é»˜è®¤çš„å®¹é‡ã€‚</p></li><li><p><code>private static final Object[] EMPTY_ELEMENTDATA = &#123;&#125;;</code><br>ç©ºæ•°ç»„ã€‚</p></li><li><p><code>private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;</code><br>é»˜è®¤çš„ç©ºæ•°ç»„ã€‚</p></li><li><p><code>transient Object[] elementData;</code><br>çœŸæ­£å­˜æ”¾å…ƒç´ çš„æ•°ç»„ã€‚</p></li><li><p><code>private int size;</code><br>å½“å‰å…ƒç´ ä¸ªæ•°ã€‚</p></li></ul><h1 id="æ„é€ æ–¹æ³•"><a href="#æ„é€ æ–¹æ³•" class="headerlink" title="æ„é€ æ–¹æ³•"></a>æ„é€ æ–¹æ³•</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼ å…¥å‚æ•°ä¸ºåˆå§‹åŒ–å®¹é‡æ—¶çš„æ„é€ æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ArrayList</span><span class="params">(<span class="type">int</span> initialCapacity)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (initialCapacity &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœä¼ å…¥å‚æ•°å¤§äºé›¶ï¼Œé‚£å°±åˆ›å»ºä¸€ä¸ªå¯¹åº”å¤§å°çš„æ•°ç»„</span></span><br><span class="line">        <span class="built_in">this</span>.elementData = <span class="keyword">new</span> <span class="title class_">Object</span>[initialCapacity];</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (initialCapacity == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœä¼ å…¥å‚æ•°ç­‰äº0ï¼Œé‚£å°±ç›´æ¥æŠŠå±æ€§ä¸­åˆ›å»ºå¥½çš„ç©ºæ•°ç»„å¤åˆ¶</span></span><br><span class="line">        <span class="built_in">this</span>.elementData = EMPTY_ELEMENTDATA;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœä¼ å…¥å‚æ•°å°äº0ï¼Œé‚£å°±æŠ›å¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Illegal Capacity: &quot;</span>+</span><br><span class="line">                                           initialCapacity);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼ å…¥å‚æ•°ä¸ºç©ºæ—¶çš„æ„é€ æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ArrayList</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// å°†å±æ€§ä¸­åˆ›å»ºå¥½çš„ç©ºæ•°ç»„å¤åˆ¶è¿‡æ¥</span></span><br><span class="line">    <span class="built_in">this</span>.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼ å…¥å‚æ•°ä¸ºæ•°ç»„æ—¶çš„æ„é€ æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ArrayList</span><span class="params">(Collection&lt;? extends E&gt; c)</span> &#123;</span><br><span class="line">    <span class="comment">// å…ˆè½¬æ¢ä¸ºæ•°ç»„</span></span><br><span class="line">    elementData = c.toArray();</span><br><span class="line">    <span class="comment">// å› ä¸ºsizeä»£è¡¨ArrayListä¸­å…ƒç´ ä¸ªæ•°ï¼Œæ‰€ä»¥è¦æŠŠæ•°ç»„çš„é•¿åº¦èµ‹è¿‡æ¥</span></span><br><span class="line">    <span class="comment">// å¦‚æœä¸ªæ•°ä¸ä¸º0è¿›å…¥æ­¤if</span></span><br><span class="line">    <span class="keyword">if</span> ((size = elementData.length) != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">//è¿™é‡Œæ˜¯å½“c.toArrayå‡ºé”™ï¼Œæ²¡æœ‰è¿”å›Object[]æ—¶ï¼Œåˆ©ç”¨Arrays.copyOf æ¥å¤åˆ¶é›†åˆcä¸­çš„å…ƒç´ åˆ°elementDataæ•°ç»„ä¸­</span></span><br><span class="line">        <span class="keyword">if</span> (elementData.getClass() != Object[].class)</span><br><span class="line">            elementData = Arrays.copyOf(elementData, size, Object[].class);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœä¸ªæ•°ä¸º0ï¼Œé‚£å°±æŠŠå±æ€§ä¸­çš„ç©ºæ•°ç»„å¤åˆ¶è¿‡æ¥</span></span><br><span class="line">        <span class="built_in">this</span>.elementData = EMPTY_ELEMENTDATA;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å¸¸ç”¨API"><a href="#å¸¸ç”¨API" class="headerlink" title="å¸¸ç”¨API"></a>å¸¸ç”¨API</h1><h2 id="å¢"><a href="#å¢" class="headerlink" title="å¢"></a>å¢</h2><h3 id="ArrayList-add-E-e"><a href="#ArrayList-add-E-e" class="headerlink" title="ArrayList # add(E e)"></a>ArrayList # add(E e)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">add</span><span class="params">(E e)</span> &#123;</span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ4.1.1</span></span><br><span class="line">    ensureCapacityInternal(size + <span class="number">1</span>);  <span class="comment">// Increments modCount!!</span></span><br><span class="line">    <span class="comment">// å°†éœ€è¦åŠ å…¥çš„å…ƒç´ åŠ åˆ°æœ€åé¢</span></span><br><span class="line">    elementData[size++] = e;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æ4.1.1 ensureCapacityInternal()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">ensureCapacityInternal</span><span class="params">(<span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line">    <span class="comment">// DEFAULTCAPACITY_EMPTY_ELEMENTDATAè¿™ä¸ªå˜é‡åªæœ‰åœ¨é€šè¿‡æ— å‚æ„é€ çš„æ—¶å€™ç”¨åˆ°è¿‡</span></span><br><span class="line">    <span class="comment">// ä¹Ÿå°±æ˜¯è¯´ï¼Œä»–åˆ¤æ–­åˆ›å»ºå‡ºæ¥çš„è¿™ä¸ªæ•°ç»„ï¼Œåˆ°åº•æ˜¯ä¸æ˜¯æ— å‚æ„é€ æ–¹æ³•åˆ›å»ºå‡ºæ¥çš„ï¼Œå¦‚æœæ˜¯å°±æ‰¾å‡ºDEFAULT_CAPACITYå’ŒminCapacityä¸­è¾ƒå¤§çš„é‚£ä¸ª</span></span><br><span class="line">    <span class="keyword">if</span> (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123;</span><br><span class="line">        <span class="comment">// ä½†æ˜¯æŒ‰é“ç†æ¥è¯´ï¼Œaddä¸€ä¸ªå…ƒç´ minCapacityè‚¯å®šä¸º1ï¼Œè‚¯å®šå°äºDEFAULT_CAPACITYï¼Œä¸ºä»€ä¹ˆè¿˜è¦åšä¸€ä¸ªåˆ¤æ–­å‘¢ï¼Ÿ</span></span><br><span class="line">        <span class="comment">// ä½†æ˜¯ä½ å¾—æ³¨æ„ï¼Œè¿˜æœ‰AddAllè¿™ä¸ªæ–¹æ³•</span></span><br><span class="line">        minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ4.1.2</span></span><br><span class="line">    ensureExplicitCapacity(minCapacity);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æ4.1.2 ensureExplicitCapacity()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">ensureExplicitCapacity</span><span class="params">(<span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line">    <span class="comment">// modCountæ˜¯AbstractListä¸­çš„å±æ€§ï¼Œå¦‚æœéœ€è¦æ‰©å®¹ï¼Œåˆ™ä¼šä¿®æ”¹modCount</span></span><br><span class="line">    modCount++;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// overflow-conscious code</span></span><br><span class="line">    <span class="keyword">if</span> (minCapacity - elementData.length &gt; <span class="number">0</span>)</span><br><span class="line">        <span class="comment">// -&gt;&gt; åˆ†æ4.1.3</span></span><br><span class="line">        grow(minCapacity);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æ4.1.3 grow()</span></span><br><span class="line"><span class="comment"> * ä½œç”¨ï¼šæ‰©å®¹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">grow</span><span class="params">(<span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line">    <span class="comment">// overflow-conscious code</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">oldCapacity</span> <span class="operator">=</span> elementData.length;</span><br><span class="line">    <span class="comment">// æ‰©å®¹ä¸ºåŸæ•°ç»„çš„1.5å€</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">newCapacity</span> <span class="operator">=</span> oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// å¦‚æœè¿˜ä¸å¤Ÿï¼Œå°±ç›´æ¥ç”¨èƒ½å®¹çº³çš„æœ€å°å¤§å°</span></span><br><span class="line">    <span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>)</span><br><span class="line">        newCapacity = minCapacity;</span><br><span class="line">    <span class="comment">// MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ–°æ•°ç»„æ¯”MAX_ARRAY_SIZEè¿˜è¦å¤§çš„è¯</span></span><br><span class="line">    <span class="keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="number">0</span>)</span><br><span class="line">        <span class="comment">// -&gt;&gt; åˆ†æ4.1.4</span></span><br><span class="line">        newCapacity = hugeCapacity(minCapacity);</span><br><span class="line">    <span class="comment">// minCapacity is usually clos2019e to size, so this is a win:</span></span><br><span class="line">    <span class="comment">// ç”Ÿæˆæ–°æ•°ç»„</span></span><br><span class="line">    elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æ4.1.4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">hugeCapacity</span><span class="params">(<span class="type">int</span> minCapacity)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (minCapacity &lt; <span class="number">0</span>) <span class="comment">// overflow</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OutOfMemoryError</span>();</span><br><span class="line">    <span class="keyword">return</span> (minCapacity &gt; MAX_ARRAY_SIZE) ?</span><br><span class="line">        Integer.MAX_VALUE :</span><br><span class="line">        MAX_ARRAY_SIZE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ArrayList-add-E-e-1"><a href="#ArrayList-add-E-e-1" class="headerlink" title="ArrayList # add(E e)"></a>ArrayList # add(E e)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŒ‰ç»™å®šçš„ä½ç½®æ·»åŠ æŒ‡å®šå…ƒç´ </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> index, E element)</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœç»™çš„ä½ç½®è¶…è¿‡äº†é›†åˆå·²å­˜æ”¾çš„å…ƒç´ çš„ä¸ªæ•°æˆ–è€…å°äº0ï¼Œå°±æŠ›å¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">if</span> (index &gt; size || index &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IndexOutOfBoundsException</span>(outOfBoundsMsg(index));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ4.1.1</span></span><br><span class="line">    ensureCapacityInternal(size + <span class="number">1</span>);  <span class="comment">// Increments modCount!!</span></span><br><span class="line">    <span class="comment">// å°†elementDataä»indexå¤„åˆ†å¼€ï¼Œç»™indexç©ºå‡ºä½ç½®</span></span><br><span class="line">    System.arraycopy(elementData, index, elementData, index + <span class="number">1</span>,</span><br><span class="line">                     size - index);</span><br><span class="line">    <span class="comment">// æ”¾å…¥æ•°æ®</span></span><br><span class="line">    elementData[index] = element;</span><br><span class="line">    size++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ArrayList-addAll-Collection-lt-extends-E-gt-c"><a href="#ArrayList-addAll-Collection-lt-extends-E-gt-c" class="headerlink" title="ArrayList # addAll(Collection&lt;? extends E&gt; c)"></a>ArrayList # addAll(Collection&lt;? extends E&gt; c)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">addAll</span><span class="params">(Collection&lt;? extends E&gt; c)</span> &#123;</span><br><span class="line">    <span class="comment">// è½¬ä¸ºæ•°ç»„</span></span><br><span class="line">    Object[] a = c.toArray();</span><br><span class="line">    <span class="type">int</span> <span class="variable">numNew</span> <span class="operator">=</span> a.length;</span><br><span class="line">    <span class="comment">// æ‰©å®¹æ•°ç»„ -&gt;&gt; åˆ†æ4.1.1</span></span><br><span class="line">    ensureCapacityInternal(size + numNew);  <span class="comment">// Increments modCount</span></span><br><span class="line">    <span class="comment">// å°†aæ•°ç»„çš„å…¨éƒ¨å†…å®¹æ·»åŠ åˆ°elementDataæ•°ç»„ä»sizeå¼€å§‹ä¹‹å</span></span><br><span class="line">    System.arraycopy(a, <span class="number">0</span>, elementData, size, numNew);</span><br><span class="line">    size += numNew;</span><br><span class="line">    <span class="keyword">return</span> numNew != <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ArrayList-addAll-int-index-Collection-lt-extends-E-gt-c"><a href="#ArrayList-addAll-int-index-Collection-lt-extends-E-gt-c" class="headerlink" title="ArrayList # addAll(int index, Collection&lt;? extends E&gt; c)"></a>ArrayList # addAll(int index, Collection&lt;? extends E&gt; c)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">addAll</span><span class="params">(<span class="type">int</span> index, Collection&lt;? extends E&gt; c)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (index &gt; size || index &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IndexOutOfBoundsException</span>(outOfBoundsMsg(index));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è½¬ä¸ºæ•°ç»„</span></span><br><span class="line">    Object[] a = c.toArray();</span><br><span class="line">    <span class="type">int</span> <span class="variable">numNew</span> <span class="operator">=</span> a.length;</span><br><span class="line">    <span class="comment">// æ‰©å®¹ -&gt;&gt; åˆ†æ4.1.1</span></span><br><span class="line">    ensureCapacityInternal(size + numNew);  <span class="comment">// Increments modCount</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">numMoved</span> <span class="operator">=</span> size - index;</span><br><span class="line">    <span class="comment">// å¦‚æœindexå°äºsizeï¼Œä¹Ÿå°±æ˜¯è¯´éœ€è¦åœ¨åŸæ•°ç»„çš„ä¸­é—´æ’å…¥çš„haulï¼Œå°±éœ€è¦å…ˆæŠŠåŸæ•°ç»„indexä¹‹åçš„æ•°æ®å¾€åç§»åŠ¨</span></span><br><span class="line">    <span class="keyword">if</span> (numMoved &gt; <span class="number">0</span>)</span><br><span class="line">        System.arraycopy(elementData, index, elementData, index + numNew,</span><br><span class="line">                         numMoved);</span><br><span class="line"></span><br><span class="line">    System.arraycopy(a, <span class="number">0</span>, elementData, index, numNew);</span><br><span class="line">    size += numNew;</span><br><span class="line">    <span class="keyword">return</span> numNew != <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li>æ— è®ºæ˜¯addè¿˜æ˜¯addAllï¼Œéƒ½æ˜¯å…ˆåˆ¤æ–­æ˜¯å¦è¶Šç•Œï¼Œå¦‚æœè¶Šç•Œå°±æ‰©å®¹ï¼Œç„¶åå†ç§»åŠ¨æ•°ç»„</li><li>å¦‚æœéœ€è¦æ‰©å®¹ï¼Œé»˜è®¤æ‰©å®¹åŸæ¥çš„ä¸€èˆ¬å¤§å°ï¼›å¦‚æœè¿˜ä¸å¤Ÿï¼Œé‚£å°±ç›´æ¥å°†ç›®æ ‡çš„sizeä½œä¸ºæ‰©å®¹åçš„å¤§å°</li><li>åœ¨æ‰©å®¹æˆåŠŸåï¼Œä¼šä¿®æ”¹modCount</li></ul><h2 id="åˆ "><a href="#åˆ " class="headerlink" title="åˆ "></a>åˆ </h2><h3 id="ArrayList-remove-int-index"><a href="#ArrayList-remove-int-index" class="headerlink" title="ArrayList # remove(int index)"></a>ArrayList # remove(int index)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> E <span class="title function_">remove</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (index &gt;= size)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IndexOutOfBoundsException</span>(outOfBoundsMsg(index));</span><br><span class="line">    <span class="comment">// ä¿®æ”¹modCount</span></span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="comment">// å°†è¦åˆ é™¤çš„å†…å®¹å…ˆä¿å­˜ä¸‹æ¥</span></span><br><span class="line">    <span class="type">E</span> <span class="variable">oldValue</span> <span class="operator">=</span> (E) elementData[index];</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">numMoved</span> <span class="operator">=</span> size - index - <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­è¦åˆ é™¤çš„æ•°æ®æ˜¯ä¸æ˜¯æœ€åä¸€ä½</span></span><br><span class="line">    <span class="comment">// å¦‚æœä¸æ˜¯æœ€åä¸€ä½ï¼Œè¿˜å¾—å…ˆæŠŠåé¢çš„æ•°æ®å¾€å‰ç§»åŠ¨</span></span><br><span class="line">    <span class="keyword">if</span> (numMoved &gt; <span class="number">0</span>)</span><br><span class="line">        System.arraycopy(elementData, index+<span class="number">1</span>, elementData, index,</span><br><span class="line">                         numMoved);</span><br><span class="line">    <span class="comment">// æ¸…é™¤æ•°æ®ï¼Œæ›´æ”¹å¼•ç”¨ï¼Œè®©GCå»æ¸…ç†</span></span><br><span class="line">    elementData[--size] = <span class="literal">null</span>; <span class="comment">// clear to let GC do its work</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> oldValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ArrayList-remove-Object-o"><a href="#ArrayList-remove-Object-o" class="headerlink" title="ArrayList # remove(Object o)"></a>ArrayList # remove(Object o)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">remove</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (o == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>; index &lt; size; index++)</span><br><span class="line">            <span class="keyword">if</span> (elementData[index] == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// -&gt;&gt; åˆ†æ4.2.1</span></span><br><span class="line">                fastRemove(index);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå‚æ•°ä¸ä¸ºç©ºï¼Œé‚£å°±éå†æ•´ä¸ªæ•°ç»„é›†åˆ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>; index &lt; size; index++)</span><br><span class="line">            <span class="comment">// æ‰¾åˆ°å’Œå‚æ•°ç›¸ç­‰çš„é‚£ä¸€ä½ï¼Œç„¶åå°†è¯¥ä½ç§»é™¤</span></span><br><span class="line">            <span class="keyword">if</span> (o.equals(elementData[index])) &#123;</span><br><span class="line">                <span class="comment">// -&gt;&gt; åˆ†æ4.2.1</span></span><br><span class="line">                fastRemove(index);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * åˆ†æ4.2.1ï¼šfastRemove()</span></span><br><span class="line"><span class="comment"> * ä½œç”¨ï¼šåŸºæœ¬ä¸Šå’Œremove(int index)ä¸€æ ·</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">fastRemove</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">    <span class="comment">// ä¿®æ”¹modCount</span></span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="type">int</span> <span class="variable">numMoved</span> <span class="operator">=</span> size - index - <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­è¦åˆ é™¤çš„æ•°æ®æ˜¯ä¸æ˜¯æœ€åä¸€ä½</span></span><br><span class="line">    <span class="comment">// å¦‚æœä¸æ˜¯æœ€åä¸€ä½ï¼Œè¿˜å¾—å…ˆæŠŠåé¢çš„æ•°æ®å¾€å‰ç§»åŠ¨</span></span><br><span class="line">    <span class="keyword">if</span> (numMoved &gt; <span class="number">0</span>)</span><br><span class="line">        System.arraycopy(elementData, index+<span class="number">1</span>, elementData, index,</span><br><span class="line">                         numMoved);</span><br><span class="line">    <span class="comment">// æ¸…é™¤æ•°æ®ï¼Œæ›´æ”¹å¼•ç”¨ï¼Œè®©GCå»æ¸…ç†</span></span><br><span class="line">    elementData[--size] = <span class="literal">null</span>; <span class="comment">// clear to let GC do its work</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ArrayList-removeAll-Collection-lt-gt-c"><a href="#ArrayList-removeAll-Collection-lt-gt-c" class="headerlink" title="ArrayList # removeAll(Collection&lt;?&gt; c)"></a>ArrayList # removeAll(Collection&lt;?&gt; c)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">removeAll</span><span class="params">(Collection&lt;?&gt; c)</span> &#123;</span><br><span class="line">    Objects.requireNonNull(c);</span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ4.2.2</span></span><br><span class="line">    <span class="keyword">return</span> batchRemove(c, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * åˆ†æ4.2.2 batchRemove()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">batchRemove</span><span class="params">(Collection&lt;?&gt; c, <span class="type">boolean</span> complement)</span> &#123;</span><br><span class="line">    <span class="comment">// å…ˆèµ‹å€¼</span></span><br><span class="line">    <span class="keyword">final</span> Object[] elementData = <span class="built_in">this</span>.elementData;</span><br><span class="line">    <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> <span class="number">0</span>, w = <span class="number">0</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">modified</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// å¿«é€Ÿä¿å­˜ä¸¤ä¸ªé›†åˆå…±æœ‰å…ƒç´ </span></span><br><span class="line">        <span class="keyword">for</span> (; r &lt; size; r++)</span><br><span class="line">            <span class="keyword">if</span> (c.contains(elementData[r]) == complement)</span><br><span class="line">                elementData[w++] = elementData[r];</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// Preserve behavioral compatibility with AbstractCollection,</span></span><br><span class="line">        <span class="comment">// even if c.contains() throws.</span></span><br><span class="line">        <span class="keyword">if</span> (r != size) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœå‡ºç°å¼‚å¸¸ä¼šå¯¼è‡´r!=sizeï¼Œå°±æŠŠå¼‚å¸¸ä¹‹åçš„æ•°æ®å…¨éƒ¨è¦†ç›–åˆ°æ•°ç»„é‡Œé¢</span></span><br><span class="line">            System.arraycopy(elementData, r,</span><br><span class="line">                             elementData, w,</span><br><span class="line">                             size - r);</span><br><span class="line">            w += size - r;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (w != size) &#123;</span><br><span class="line">            <span class="comment">// clear to let GC do its work</span></span><br><span class="line">            <span class="comment">// å°†åé¢çš„å…ƒç´ å…¨éƒ¨ç½®ç©ºï¼Œè®©GCæ¥å›æ”¶</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> w; i &lt; size; i++)</span><br><span class="line">                elementData[i] = <span class="literal">null</span>;</span><br><span class="line">            modCount += size - w;</span><br><span class="line">            size = w;</span><br><span class="line">            modified = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> modified;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å—æˆ‘çœ‹çš„æ—¶å€™æœ‰ç‚¹ç»•ï¼Œä½†æ˜¯ä¸€æƒ³é€šå°±å¥½äº†ã€‚</p><p>å…¶å®è¿™ä¸ªåœ°æ–¹æ˜¯è¦æŠŠCé›†åˆä¸­å’ŒåŸé›†åˆä¸­å…±æœ‰çš„å…ƒç´ åˆ é™¤ï¼Œé‚£æˆ‘å°±åªéœ€è¦éå†åŸæ•°ç»„ï¼Œç„¶åç¢°åˆ°å’ŒCé›†åˆç›¸åŒçš„å…ƒç´ å°±ç›´æ¥æ”¾åˆ°å‰é¢å»ï¼Œç„¶åç­‰éå†å®Œæˆåï¼Œä¸€æ¬¡æ€§æŠŠåé¢çš„å…¨éƒ¨ç½®ç©ºã€‚</p><h3 id="ArrayList-retainAll-Collection-lt-gt-c"><a href="#ArrayList-retainAll-Collection-lt-gt-c" class="headerlink" title="ArrayList # retainAll(Collection&lt;?&gt; c)"></a>ArrayList # retainAll(Collection&lt;?&gt; c)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">retainAll</span><span class="params">(Collection&lt;?&gt; c)</span> &#123;</span><br><span class="line">    Objects.requireNonNull(c);</span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ4.2.2</span></span><br><span class="line">    <span class="keyword">return</span> batchRemove(c, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ArrayList-clear"><a href="#ArrayList-clear" class="headerlink" title="ArrayList # clear()"></a>ArrayList # clear()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line">    modCount++;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// clear to let GC do its work</span></span><br><span class="line">    <span class="comment">// ç›´æ¥éå†æ¯ä¸€ä½ï¼Œç„¶åæŠŠæ¯ä¸€ä½éƒ½ç½®ç©ºï¼Œè®©GCå»æ¸…ç†</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">        elementData[i] = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    size = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li>æ‰€æœ‰çš„åˆ é™¤æ“ä½œéƒ½ä¼šä¿®æ”¹modCount</li></ul><h2 id="æ”¹"><a href="#æ”¹" class="headerlink" title="æ”¹"></a>æ”¹</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> E <span class="title function_">set</span><span class="params">(<span class="type">int</span> index, E element)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (index &gt;= size)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IndexOutOfBoundsException</span>(outOfBoundsMsg(index));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å–å‡ºåŸæ¥çš„å…ƒç´ </span></span><br><span class="line">    <span class="type">E</span> <span class="variable">oldValue</span> <span class="operator">=</span> (E) elementData[index];</span><br><span class="line">    <span class="comment">// æŠŠéœ€è¦æ›´æ”¹çš„æ•°æ®æ”¾è¿›å»</span></span><br><span class="line">    elementData[index] = element;</span><br><span class="line">    <span class="keyword">return</span> oldValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ²¡å•¥å¥½åˆ†æçš„</p><p>ä¸éœ€è¦ä¿®æ”¹modCountï¼Œç›¸å¯¹é«˜æ•ˆ</p><h2 id="æŸ¥"><a href="#æŸ¥" class="headerlink" title="æŸ¥"></a>æŸ¥</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> E <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (index &gt;= size)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IndexOutOfBoundsException</span>(outOfBoundsMsg(index));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (E) elementData[index];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ²¡å•¥å¥½åˆ†æçš„</p><p>ä¸éœ€è¦ä¿®æ”¹modCountï¼Œç›¸å¯¹é«˜æ•ˆ</p><h2 id="åŒ…æ‹¬-contains-amp-indexOf"><a href="#åŒ…æ‹¬-contains-amp-indexOf" class="headerlink" title="åŒ…æ‹¬ contains() &amp; indexOf()"></a>åŒ…æ‹¬ contains() &amp; indexOf()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">contains</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ4.5.1</span></span><br><span class="line">    <span class="keyword">return</span> indexOf(o) &gt;= <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æ4.5.1ï¼šindexOf()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">indexOf</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (o == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">            <span class="keyword">if</span> (elementData[i]==<span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">return</span> i;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">            <span class="keyword">if</span> (o.equals(elementData[i]))</span><br><span class="line">                <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ²¡å•¥å¥½åˆ†æçš„</p><h2 id="åˆ¤ç©º-isEmpty"><a href="#åˆ¤ç©º-isEmpty" class="headerlink" title="åˆ¤ç©º isEmpty()"></a>åˆ¤ç©º isEmpty()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ²¡å•¥å¥½åˆ†æçš„</p><h1 id="è¿­ä»£å™¨-Iterator"><a href="#è¿­ä»£å™¨-Iterator" class="headerlink" title="è¿­ä»£å™¨ Iterator"></a>è¿­ä»£å™¨ Iterator</h1><h2 id="åˆ›å»ºè¿­ä»£å™¨"><a href="#åˆ›å»ºè¿­ä»£å™¨" class="headerlink" title="åˆ›å»ºè¿­ä»£å™¨"></a>åˆ›å»ºè¿­ä»£å™¨</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Iterator&lt;E&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// æ„é€ Itrå¯¹è±¡å¹¶è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Itr</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Itrå±æ€§"><a href="#Itrå±æ€§" class="headerlink" title="Itrå±æ€§"></a>Itrå±æ€§</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é™åˆ¶ï¼Œä¹Ÿå°±æ˜¯æ•°ç»„çš„å…ƒç´ ä¸ªæ•°</span></span><br><span class="line"><span class="keyword">protected</span> <span class="type">int</span> <span class="variable">limit</span> <span class="operator">=</span> ArrayList.<span class="built_in">this</span>.size;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸‹ä¸€ä¸ªå…ƒç´ çš„ä¸‹æ ‡</span></span><br><span class="line"><span class="type">int</span> cursor;       <span class="comment">// index of next element to return</span></span><br><span class="line"><span class="comment">// ä¸Šä¸€æ¬¡è¿”å›å…ƒç´ çš„ä¸‹æ ‡</span></span><br><span class="line"><span class="type">int</span> <span class="variable">lastRet</span> <span class="operator">=</span> -<span class="number">1</span>; <span class="comment">// index of last element returned; -1 if no such</span></span><br><span class="line"><span class="comment">// ç”¨äºåˆ¤æ–­é›†åˆæ˜¯å¦ä¿®æ”¹è¿‡ç»“æ„çš„æ ‡å¿—</span></span><br><span class="line"><span class="type">int</span> <span class="variable">expectedModCount</span> <span class="operator">=</span> modCount;</span><br></pre></td></tr></table></figure><h2 id="Itr-hasNext"><a href="#Itr-hasNext" class="headerlink" title="Itr # hasNext()"></a>Itr # hasNext()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> cursor &lt; limit;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ç”¨å¤šè¯´</p><h2 id="Itr-next"><a href="#Itr-next" class="headerlink" title="Itr # next()"></a>Itr # next()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> E <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦ä¿®æ”¹è¿‡Listçš„ç»“æ„ï¼Œå¦‚æœä¿®æ”¹äº†å°±æŠ›å¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">if</span> (modCount != expectedModCount)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> cursor;</span><br><span class="line">    <span class="comment">// å¦‚æœè¶Šç•Œäº†å°±æŠ›å¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">if</span> (i &gt;= limit)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NoSuchElementException</span>();</span><br><span class="line">    Object[] elementData = ArrayList.<span class="built_in">this</span>.elementData;</span><br><span class="line">    <span class="comment">// å†æ¬¡åˆ¤æ–­æ˜¯å¦è¶Šç•Œï¼Œåœ¨ æˆ‘ä»¬è¿™é‡Œçš„æ“ä½œæ—¶ï¼Œæœ‰å¼‚æ­¥çº¿ç¨‹ä¿®æ”¹äº†List</span></span><br><span class="line">    <span class="keyword">if</span> (i &gt;= elementData.length)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line">    <span class="comment">// æ ‡è®°åŠ 1</span></span><br><span class="line">    cursor = i + <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// è¿”å›æ•°æ®ï¼Œå¹¶è®¾ç½®ä¸Šä¸€æ¬¡çš„ä¸‹æ ‡</span></span><br><span class="line">    <span class="keyword">return</span> (E) elementData[lastRet = i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Itr-remove"><a href="#Itr-remove" class="headerlink" title="Itr # remove()"></a>Itr # remove()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (lastRet &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>();</span><br><span class="line">    <span class="keyword">if</span> (modCount != expectedModCount)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨ArrayListçš„removeæ–¹æ³•ç§»é™¤æ•°æ®</span></span><br><span class="line">        ArrayList.<span class="built_in">this</span>.remove(lastRet);</span><br><span class="line">        <span class="comment">// æ›´æ–°ä¸€ç³»åˆ—æ•°æ®</span></span><br><span class="line">        cursor = lastRet;</span><br><span class="line">        lastRet = -<span class="number">1</span>;</span><br><span class="line">        expectedModCount = modCount;</span><br><span class="line">        limit--;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IndexOutOfBoundsException ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><h2 id="modCountåˆ°åº•æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Ÿ"><a href="#modCountåˆ°åº•æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Ÿ" class="headerlink" title="modCountåˆ°åº•æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Ÿ"></a>modCountåˆ°åº•æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Ÿ</h2><p>å¦‚æœä½ çœ‹è¿‡å¾ˆå¤šé›†åˆæºç çš„è¯ï¼Œä½ å°±ä¼šå‘ç°ä½ ä¼šåœ¨å¾ˆå¤šåœ°æ–¹éƒ½ä¼šç¢°åˆ°è¿™ä¸ªmodCountï¼Œä¾‹å¦‚ArrayListã€LinkedListã€HashMapç­‰ç­‰ã€‚modCountå­—é¢æ„æ€å°±æ˜¯ä¿®æ”¹æ¬¡æ•°ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆéœ€è¦çºªå½•è¿™ä¸ªä¿®æ”¹æ¬¡æ•°å‘¢ï¼Ÿ</p><p>ä½ å›æƒ³ä¸‹ï¼Œä¼¼ä¹ç”¨åˆ°modCountçš„åœ°æ–¹ï¼Œå¦‚ArrayListã€LinkedListç­‰ç­‰ï¼Œä»–ä»¬éƒ½ç”¨ä¸€ä¸ªå…±æ€§â€”â€”çº¿ç¨‹ä¸å®‰å…¨ã€‚</p><p>è€Œåœ¨ä½ çœ‹äº†è¿™å‡ ä¸ªç±»çš„è¿­ä»£å™¨åå°±ä¼šå‘ç°ï¼Œä»–ä»¬è¿­ä»£å™¨ä¸­ä¸€å®šæœ‰ä¸€ä¸ªå±æ€§(å¦‚æˆ‘ä»¬ä¸Šé¢çš„expectedModCount)åˆå§‹åŒ–æ—¶çš„å€¼å°±æ˜¯modCountçš„å€¼ã€‚</p><p>ç„¶ååœ¨è¿­ä»£å™¨çš„æ–¹æ³•ä¸­ï¼Œåªè¦æ˜¯éå†è¿™ä¸ªé›†åˆçš„æ—¶å€™ï¼Œéƒ½éœ€è¦å°†ä¸¤ä¸ªå€¼è¿›è¡Œå¯¹æ¯”ï¼Œç„¶åå†ç§»é™¤å…ƒç´ çš„æ—¶å€™ï¼Œéƒ½éœ€è¦æ›´æ–°è¿­ä»£å™¨é‡Œé¢çš„modCountå˜é‡ã€‚</p><p>è¿™æ—¶ï¼Œä½ éœ€è¦äº†è§£ä¸‹<strong>Fail-Fastæœºåˆ¶</strong>ã€‚</p><p>æˆ‘ä»¬éƒ½çŸ¥é“è¿™äº›é›†åˆæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œå¦‚æœåœ¨ä½¿ç”¨è¿­ä»£å™¨çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰å…¶ä»–çº¿ç¨‹å¯¹é›†åˆè¿›è¡Œäº†ä¿®æ”¹ï¼Œé‚£ä¹ˆå°±ä¼šæŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸ï¼Œè¿™å°±æ˜¯Fail-Fastç­–ç•¥ã€‚è€Œè¿™ä¸ªæ—¶å€™æºç ä¸­å°±é€šè¿‡modCountè¿›è¡Œäº†æ“ä½œã€‚è¿­ä»£å™¨åœ¨åˆ›å»ºæ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªå˜é‡ç­‰äºå½“æ—¶çš„modCountï¼Œå¦‚æœåœ¨è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œé›†åˆå‘ç”Ÿäº†å˜åŒ–ï¼ŒmodCountå°±æ˜¯++ã€‚è¿™æ—¶è¿­ä»£å™¨ä¸­çš„å˜é‡çš„å€¼å’ŒmodCountä¸ç›¸ç­‰äº†ï¼Œé‚£å°±æŠ›å¼‚å¸¸ã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>éå†çº¿ç¨‹ä¸å®‰å…¨çš„é›†åˆæ—¶ï¼Œå°½é‡ä½¿ç”¨è¿­ä»£å™¨</strong></p><p>è§£å†³åŠæ³•ï¼š</p><ul><li>åœ¨éå†è¿‡ç¨‹ä¸­æ‰€æœ‰æ¶‰åŠåˆ°æ”¹å˜ modCount å€¼å¾—åœ°æ–¹å…¨éƒ¨åŠ ä¸Š synchronized æˆ–è€…ç›´æ¥ä½¿ç”¨ Collections.synchronizedListï¼Œè¿™æ ·å°±å¯ä»¥è§£å†³ã€‚ä½†æ˜¯ä¸æ¨èï¼Œå› ä¸ºå¢åˆ é€ æˆçš„åŒæ­¥é”å¯èƒ½ä¼šé˜»å¡éå†æ“ä½œã€‚</li><li>ä½¿ç”¨ CopyOnWriteArrayList æ¥æ›¿æ¢ ArrayListã€‚æ¨èä½¿ç”¨è¯¥æ–¹æ¡ˆã€‚å…³äºCopyOnWriteArrayListçš„å†…å®¹æ­¤å¤„ä¸å†è¿‡å¤šçš„å»å°†ï¼Œæƒ³äº†è§£çš„åŒå­¦å¯ä»¥ç™¾åº¦æˆ–è€…è°·æ­Œã€‚</li></ul><h2 id="ArrayListå’ŒVectorçš„åŒºåˆ«"><a href="#ArrayListå’ŒVectorçš„åŒºåˆ«" class="headerlink" title="ArrayListå’ŒVectorçš„åŒºåˆ«"></a>ArrayListå’ŒVectorçš„åŒºåˆ«</h2><ul><li>ArrayListçº¿ç¨‹ä¸å®‰å…¨ï¼ŒVectorçº¿ç¨‹å®‰å…¨</li><li>æ‰©å®¹çš„æ—¶å€™ArrayListé»˜è®¤æ‰©å®¹1.5å€ï¼ŒVectoré»˜è®¤æ‰©å®¹1å€</li></ul>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Java/">Java</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Java/">Java</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E6%BA%90%E7%A0%81/">æºç </category>
      
      <category domain="https://www.littlecorgi.top/tags/%E9%9B%86%E5%90%88/">é›†åˆ</category>
      
      <category domain="https://www.littlecorgi.top/tags/ArrayList/">ArrayList</category>
      
      
      <comments>https://www.littlecorgi.top/posts/970dc297.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Androidæ¶ˆæ¯æœºåˆ¶ä¹‹Handler</title>
      <link>https://www.littlecorgi.top/posts/21eb5c30.html</link>
      <guid>https://www.littlecorgi.top/posts/21eb5c30.html</guid>
      <pubDate>Sun, 17 Nov 2019 06:43:10 GMT</pubDate>
      
        
        
          
          
      <description></description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>ä½œä¸ºä¸€ä¸ªAndroidå¼€å‘è€…ï¼ŒHandlerçš„å¤§åä½ ä¸€å®šå¬è¿‡ã€‚åšAndroidå¼€å‘è‚¯å®šç¦»ä¸å¼€Handlerï¼Œå®ƒé€šå¸¸è¢«æˆ‘ä»¬ç”¨æ¥è¿é€šä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹ã€‚</p><p>å¯ä»¥è¯´åªè¦æœ‰å¼‚æ­¥çš„åœ°æ–¹ä¸€å®šæœ‰Handlerã€‚</p><p>é‚£ä¹ˆï¼Œä½ äº†è§£è¿‡ä¸ºä»€ä¹ˆHandlerèƒ½è¿é€šä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹å—ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ äº†è§£è¿‡HandlerèƒŒåçš„åŸç†å—ï¼Ÿ</p><p>å°±è®©æœ¬æ–‡å¸¦ä½ äº†è§£ã€‚</p><h1 id="Handlerçš„åŸºæœ¬ç”¨æ³•"><a href="#Handlerçš„åŸºæœ¬ç”¨æ³•" class="headerlink" title="Handlerçš„åŸºæœ¬ç”¨æ³•"></a>Handlerçš„åŸºæœ¬ç”¨æ³•</h1><p>æŒ‰ç…§æƒ¯ä¾‹ï¼Œæˆ‘ä»¬é¦–å…ˆçœ‹ä¸‹Handlerçš„ä¸€èˆ¬ç”¨æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Handler</span> <span class="variable">mHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Handler</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleMessage</span><span class="params">(<span class="keyword">final</span> Message msg)</span> &#123;</span><br><span class="line">        <span class="comment">// åœ¨è¿™é‡Œæ¥å—å¹¶å¤„ç†æ¶ˆæ¯</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å‘é€æ¶ˆæ¯</span></span><br><span class="line">mHandler.sendMessage(message);</span><br><span class="line">mHandler.post(runnable);</span><br></pre></td></tr></table></figure></p><p>ä¹Ÿå°±æ˜¯åˆ›å»ºä¸€ä¸ªHandlerå¯¹è±¡ï¼Œå¹¶é‡å†™handlerMessageæ–¹æ³•ï¼Œç„¶ååœ¨éœ€è¦çš„æ—¶å€™è°ƒç”¨sendMessageæ–¹æ³•ä¼ å…¥ä¸€ä¸ªmessageå¯¹è±¡ï¼Œæˆ–è€…è°ƒç”¨postæ–¹æ³•ä¼ å…¥ä¸€ä¸ªrunnableå¯¹è±¡ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬ä»ä»–çš„æ„é€ æ–¹æ³•å¼€å§‹çœ‹èµ·å§ã€‚</p><h1 id="ä»Handleræ„é€ æ–¹æ³•å…¥æ‰‹"><a href="#ä»Handleræ„é€ æ–¹æ³•å…¥æ‰‹" class="headerlink" title="ä»Handleræ„é€ æ–¹æ³•å…¥æ‰‹"></a>ä»Handleræ„é€ æ–¹æ³•å…¥æ‰‹</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">Handler</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ1.1</span></span><br><span class="line">    <span class="built_in">this</span>(<span class="literal">null</span>, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ†æ1-1-Handler-æ„é€ æ–¹æ³•"><a href="#åˆ†æ1-1-Handler-æ„é€ æ–¹æ³•" class="headerlink" title="åˆ†æ1.1 Handler # æ„é€ æ–¹æ³•"></a>åˆ†æ1.1 Handler # æ„é€ æ–¹æ³•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æ1.1ï¼šå®é™…ä¸Šè°ƒç”¨çš„åˆæ˜¯å¦ä¸€ä¸ªæ„é€ æ–¹æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">Handler</span><span class="params">(<span class="meta">@Nullable</span> Callback callback, <span class="type">boolean</span> async)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (FIND_POTENTIAL_LEAKS) &#123;</span><br><span class="line">        <span class="comment">// è¿™ä¸ªå˜é‡å­—é¢æ„æ€æ˜¯æ‰¾åˆ°å†…å­˜æ³„æ¼ï¼Œ</span></span><br><span class="line">        <span class="comment">// ä½†æ˜¯æ•´ä¸ªHandlerä¸­é™¤äº†è¿™å—ä»¥åŠå®šä¹‰è¿™ä¸ªå˜é‡ä¸ºfalseä¹‹å¤–ï¼Œ</span></span><br><span class="line">        <span class="comment">// å°±æ²¡æœ‰å…¶ä»–åœ°æ–¹ä½¿ç”¨åˆ°è¿‡è¿™ä¸ªå˜é‡äº†ï¼Œæ‰€ä»¥è¿™å—æˆ‘ä¹Ÿä¸å¤ªæ‡‚è¿™ä¸ªå˜é‡æ˜¯æ€ä¹ˆå˜ä¸ºtrueçš„</span></span><br><span class="line">        <span class="keyword">final</span> Class&lt;? <span class="keyword">extends</span> <span class="title class_">Handler</span>&gt; klass = getClass();</span><br><span class="line">        <span class="keyword">if</span> ((klass.isAnonymousClass() || klass.isMemberClass() || klass.isLocalClass()) &amp;&amp;</span><br><span class="line">                (klass.getModifiers() &amp; Modifier.STATIC) == <span class="number">0</span>) &#123;</span><br><span class="line">            Log.w(TAG, <span class="string">&quot;The following Handler class should be static or leaks might occur: &quot;</span> +</span><br><span class="line">                klass.getCanonicalName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ1.2</span></span><br><span class="line">    mLooper = Looper.myLooper();</span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ1.3</span></span><br><span class="line">    <span class="keyword">if</span> (mLooper == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(</span><br><span class="line">            <span class="string">&quot;Can&#x27;t create handler inside thread &quot;</span> + Thread.currentThread()</span><br><span class="line">                    + <span class="string">&quot; that has not called Looper.prepare()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è·å–å¯¹è±¡çš„mQueueå±æ€§ï¼ŒmQueueå°±æ˜¯MessageQueue</span></span><br><span class="line">    mQueue = mLooper.mQueue;</span><br><span class="line">    mCallback = callback;</span><br><span class="line">    mAsynchronous = async;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ†æ1-2-Looper-myLooper"><a href="#åˆ†æ1-2-Looper-myLooper" class="headerlink" title="åˆ†æ1.2 Looper # myLooper()"></a>åˆ†æ1.2 Looper # myLooper()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æ1.2ï¼šLooper.myLopper()</span></span><br><span class="line"><span class="comment"> * å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ThreadLocalçš„getæ–¹æ³•ï¼Œç„¶åè¿”å›è¯¥çº¿ç¨‹çš„Looperå¯¹è±¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="meta">@Nullable</span> Looper <span class="title function_">myLooper</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> sThreadLocal.get();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ThreadLocalæ˜¯ä¸€ä¸ªæ•°æ®å­˜å‚¨ç±»ï¼Œä»–çš„ç‰¹åˆ«ä¹‹å¤„åœ¨äºä»–æ˜¯çº¿ç¨‹é—´ç‹¬ç«‹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªçº¿ç¨‹æ”¾å…¥åˆ°ThreadLocalçš„æ•°æ®ï¼Œå…¶å®ƒçº¿ç¨‹æ˜¯è·å–ä¸åˆ°çš„ã€‚sThreadLocalå°±æ˜¯è·å–å½“å‰çº¿ç¨‹çš„Looperå¯¹è±¡ã€‚è¯¦ç»†å¯è§æˆ‘ä¹‹å‰çš„åšå®¢ã€‚</p><h2 id="åˆ†æ1-3-Looper-prepare"><a href="#åˆ†æ1-3-Looper-prepare" class="headerlink" title="åˆ†æ1.3 Looper # prepare()"></a>åˆ†æ1.3 Looper # prepare()</h2><p>ä¸ºä»€ä¹ˆè¯´å¦‚æœmLooperä¸ºç©ºå°±æŠ›å¼‚å¸¸å‘¢ï¼Œè¿™æ˜¯å› ä¸ºä¸€ä¸ªHandlerå¿…é¡»å’Œä¸€ä¸ªLooperç»‘å®šï¼Œå¹¶ä¸”è¦å…ˆåˆå§‹åŒ–Looperæ‰èƒ½å»åˆå§‹åŒ–Handlerã€‚åˆå§‹åŒ–Looperå°±é€šè¿‡Looperçš„prepareæ–¹æ³•ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æ1.3ï¼šLooper.prepare()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">prepare</span><span class="params">()</span> &#123;</span><br><span class="line">    prepare(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">prepare</span><span class="params">(<span class="type">boolean</span> quitAllowed)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (sThreadLocal.get() != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Only one Looper may be created per thread&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ1.4</span></span><br><span class="line">    sThreadLocal.set(<span class="keyword">new</span> <span class="title class_">Looper</span>(quitAllowed));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¿™ä¸ªæ–¹æ³•å’ŒmyLooperæ–¹æ³•ç±»ä¼¼ï¼Œå°±æ˜¯é€šè¿‡ThreadLocalè®¾ç½®Looperã€‚</p><h2 id="åˆ†æ1-4-Looper-æ„é€ æ–¹æ³•"><a href="#åˆ†æ1-4-Looper-æ„é€ æ–¹æ³•" class="headerlink" title="åˆ†æ1.4 Looper # æ„é€ æ–¹æ³•"></a>åˆ†æ1.4 Looper # æ„é€ æ–¹æ³•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æ1.4ï¼šLooperçš„æ„é€ æ–¹æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="title function_">Looper</span><span class="params">(<span class="type">boolean</span> quitAllowed)</span> &#123;</span><br><span class="line">    mQueue = <span class="keyword">new</span> <span class="title class_">MessageQueue</span>(quitAllowed);</span><br><span class="line">    mThread = Thread.currentThread();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Looperçš„æ„é€ æ–¹æ³•æ˜¯ç§æœ‰çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¤–ç•Œå¹¶ä¸èƒ½ç›´æ¥åˆ›å»ºLooperæ–¹æ³•ï¼Œå¿…é¡»é€šè¿‡Looper.prepareæ–¹æ³•æ¥åˆ›å»ºLooperå¯¹è±¡ï¼Œè¿™æ ·ä¹Ÿå°±æ–¹ä¾¿äº†ä¿è¯ä¸€ä¸ªçº¿ç¨‹åªèƒ½æœ‰ä¸€ä¸ªLooperå¯¹è±¡ã€‚</p><p>åœ¨æ„é€ æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªMessageQueueå¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡å°±æ˜¯ç”¨æ¥å­˜æ”¾æ¶ˆæ¯çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚å…³äºMessageQueueæˆ‘ä»¬åé¢å†æ¥è®²ã€‚</p><h1 id="æ¶ˆæ¯æ˜¯å¦‚ä½•å­˜æ”¾çš„"><a href="#æ¶ˆæ¯æ˜¯å¦‚ä½•å­˜æ”¾çš„" class="headerlink" title="æ¶ˆæ¯æ˜¯å¦‚ä½•å­˜æ”¾çš„"></a>æ¶ˆæ¯æ˜¯å¦‚ä½•å­˜æ”¾çš„</h1><p>ä¸Šé¢å°±æ˜¯Handlerå’ŒLooperçš„ä¸€ä¸ªæ„é€ æ–¹å¼ï¼Œæ„é€ å®Œæˆåï¼Œæˆ‘ä»¬å°±è¦å…³æ³¨Handleræ˜¯å¦‚ä½•æŠŠæ¶ˆæ¯æ”¾å…¥MessageQueueä¸­çš„ï¼Œä»¥åŠæ˜¯å¦‚ä½•ä»MessageQueueä¸­å–å‡ºçš„ã€‚</p><p>ä¸Šé¢æˆ‘ä»¬åœ¨è®²Handlerçš„åŸºæœ¬ç”¨æ³•çš„æ—¶å€™ï¼Œè®²åˆ°è¿‡sendMessageæ–¹æ³•å’Œpostæ–¹æ³•ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹è¿™ä¸¤ä¸ªæ–¹æ³•ï¼š</p><h2 id="Handler-sendMessage-amp-post"><a href="#Handler-sendMessage-amp-post" class="headerlink" title="Handler # sendMessage() &amp; post()"></a>Handler # sendMessage() &amp; post()</h2><p>å…¶å®è¿™å—å…ˆä¸ä¸Šå…·ä½“çš„æ–¹æ³•å®ç°ï¼Œå…ˆè¯´ä¸€ä¸‹ä»–ä»¬çš„æ–¹æ³•è°ƒç”¨æµç¨‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sendMessage()</span><br><span class="line">    -&gt; sendMessageDelayed()</span><br><span class="line">        -&gt; sendMessageAtTime()</span><br><span class="line">            -&gt; enqueueMessage()</span><br><span class="line"></span><br><span class="line">post()</span><br><span class="line">    -&gt; sendMessageDelayed()</span><br><span class="line">        -&gt; sendMessageAtTime()</span><br><span class="line">            -&gt; enqueueMessage()</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šè°ƒç”¨ç«‹é©¬è°ƒç”¨sendMessageDelayed():<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">sendMessageDelayed</span><span class="params">(<span class="meta">@NonNull</span> Message msg, <span class="type">long</span> delayMillis)</span> &#123;</span><br><span class="line">    <span class="comment">// é»˜è®¤éƒ½ä¼ å…¥0</span></span><br><span class="line">    <span class="keyword">if</span> (delayMillis &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        delayMillis = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ2.1</span></span><br><span class="line">    <span class="keyword">return</span> sendMessageAtTime(msg, SystemClock.uptimeMillis() + delayMillis);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="åˆ†æ2-1-Handler-sendMessageAtTime"><a href="#åˆ†æ2-1-Handler-sendMessageAtTime" class="headerlink" title="åˆ†æ2.1 Handler # sendMessageAtTime()"></a>åˆ†æ2.1 Handler # sendMessageAtTime()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æ2.1ï¼šsendMessageAtTime()</span></span><br><span class="line"><span class="comment"> * ä¼ å…¥å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment"> *     msgï¼šéœ€è¦ä¼ é€’çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment"> *     uptimeMillisï¼šæ›´æ–°æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯ç³»ç»Ÿä»å¼€æœºåˆ°ç›®å‰ç»è¿‡çš„æ—¶å€™ + delayMillis(ä¹Ÿå°±æ˜¯0)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">sendMessageAtTime</span><span class="params">(<span class="meta">@NonNull</span> Message msg, <span class="type">long</span> uptimeMillis)</span> &#123;</span><br><span class="line">    <span class="type">MessageQueue</span> <span class="variable">queue</span> <span class="operator">=</span> mQueue;</span><br><span class="line">    <span class="keyword">if</span> (queue == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">RuntimeException</span> <span class="variable">e</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(</span><br><span class="line">                <span class="built_in">this</span> + <span class="string">&quot; sendMessageAtTime() called with no mQueue&quot;</span>);</span><br><span class="line">        Log.w(<span class="string">&quot;Looper&quot;</span>, e.getMessage(), e);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ2.2</span></span><br><span class="line">    <span class="keyword">return</span> enqueueMessage(queue, msg, uptimeMillis);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ†æ2-2-Handler-enqueueMessage"><a href="#åˆ†æ2-2-Handler-enqueueMessage" class="headerlink" title="åˆ†æ2.2 Handler # enqueueMessage()"></a>åˆ†æ2.2 Handler # enqueueMessage()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æ2.2ï¼šenqueueMessage()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">enqueueMessage</span><span class="params">(<span class="meta">@NonNull</span> MessageQueue queue, <span class="meta">@NonNull</span> Message msg,</span></span><br><span class="line"><span class="params">        <span class="type">long</span> uptimeMillis)</span> &#123;</span><br><span class="line">    msg.target = <span class="built_in">this</span>;</span><br><span class="line">    msg.workSourceUid = ThreadLocalWorkSource.getUid();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (mAsynchronous) &#123;</span><br><span class="line">        msg.setAsynchronous(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// -&gt;&gt; è¿™å—å°±å°†æ¶ˆæ¯å­˜æ”¾åˆ°MessageQueueé˜Ÿåˆ—ä¸­å»</span></span><br><span class="line">    <span class="keyword">return</span> queue.enqueueMessage(msg, uptimeMillis);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæ¶ˆæ¯å°±æˆåŠŸçš„ä»Handlerä¸­è¢«å­˜å…¥äº†MessageQueueï¼Œé‚£ä¹ˆæ¶ˆæ¯ä»€ä¹ˆæ—¶å€™ä»MessageQueueä¸­è¢«è°ƒå‡ºæ¥å‘¢?</p><h1 id="æ¶ˆæ¯æ˜¯å¦‚ä½•å–å‡ºçš„"><a href="#æ¶ˆæ¯æ˜¯å¦‚ä½•å–å‡ºçš„" class="headerlink" title="æ¶ˆæ¯æ˜¯å¦‚ä½•å–å‡ºçš„"></a>æ¶ˆæ¯æ˜¯å¦‚ä½•å–å‡ºçš„</h1><h2 id="Looper-loop"><a href="#Looper-loop" class="headerlink" title="Looper # loop()"></a>Looper # loop()</h2><p>Looperé‡Œé¢æœ‰ä¸€ä¸ªloopæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸‹è¿™ä¸ªæ–¹æ³•:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–å½“å‰çº¿ç¨‹çš„Looperå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">Looper</span> <span class="variable">me</span> <span class="operator">=</span> myLooper();</span><br><span class="line">    <span class="keyword">if</span> (me == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;No Looper; Looper.prepare() wasn&#x27;t called on this thread.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è·å–å½“å‰çº¿ç¨‹çš„MessageQueue</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">MessageQueue</span> <span class="variable">queue</span> <span class="operator">=</span> me.mQueue;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...çœç•¥ä¸­é—´ä»£ç </span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ­»å¾ªç¯</span></span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="comment">// ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªæ¶ˆæ¯</span></span><br><span class="line">        <span class="comment">// -&gt;&gt; åˆ†æ3.1</span></span><br><span class="line">        <span class="type">Message</span> <span class="variable">msg</span> <span class="operator">=</span> queue.next(); <span class="comment">// might block</span></span><br><span class="line">        <span class="comment">// å¦‚æœå–å‡ºçš„æ¶ˆæ¯ä¸ºç©ºï¼Œå°±é€€å‡ºã€‚</span></span><br><span class="line">        <span class="comment">// ä½†æ˜¯æˆ‘ä¹‹å‰è¯´è¿™ä¸ªå¾ªç¯æ˜¯ä¸ªæ­»å¾ªç¯ï¼Ÿ</span></span><br><span class="line">        <span class="comment">// è¿™æ˜¯å› ä¸ºè™½ç„¶ä¼šæœ‰è¿™ä¸ªifå¯èƒ½ä¼šå¯¼è‡´å¾ªç¯é€€å‡ºï¼Œä½†æ˜¯é€šè¿‡nextæ–¹æ³•å–å‡ºæ¶ˆæ¯çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰æ¶ˆæ¯äº†ï¼Œnextæ–¹æ³•ä¼šé˜»å¡çº¿ç¨‹ï¼Œç›´åˆ°æœ‰æ–°çš„æ¶ˆæ¯è¿›æ¥</span></span><br><span class="line">        <span class="comment">// è¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œä¸€èˆ¬æ­£å¸¸çš„éå†MessageQueueæƒ…å†µä¸‹ï¼Œæ˜¯ä¸ä¼šæœ‰msg==nullçš„ã€‚</span></span><br><span class="line">        <span class="comment">// ä½†æ˜¯å¦‚æœä½ è°ƒç”¨äº†Looperçš„quitæˆ–è€…quitSafelyæ–¹æ³•ï¼Œè¿™ä¸ªæ—¶å€™nextä¼šè¿”å›nullï¼Œå°±ä¼šé€€å‡ºå¾ªç¯ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (msg == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// No message indicates that the message queue is quitting.</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ...çœç•¥ä¸­é—´ä»£ç </span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ä¼ ç»™Handlerå»å¤„ç†æ¶ˆæ¯</span></span><br><span class="line">            <span class="comment">// -&gt;&gt; åˆ†æ3.2</span></span><br><span class="line">            msg.target.dispatchMessage(msg);</span><br><span class="line">            <span class="keyword">if</span> (observer != <span class="literal">null</span>) &#123;</span><br><span class="line">                observer.messageDispatched(token, msg);</span><br><span class="line">            &#125;</span><br><span class="line">            dispatchEnd = needEndTime ? SystemClock.uptimeMillis() : <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">            <span class="comment">// ...çœç•¥ä¸­é—´ä»£ç </span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// ...çœç•¥ä¸­é—´ä»£ç </span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ...çœç•¥ä¸­é—´ä»£ç </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="åˆ†æ3-1-MessageQueue-next"><a href="#åˆ†æ3-1-MessageQueue-next" class="headerlink" title="åˆ†æ3.1 MessageQueue # next()"></a>åˆ†æ3.1 MessageQueue # next()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æ3.1 MessageQueue.next()</span></span><br><span class="line"><span class="comment"> * ä½œç”¨ï¼š</span></span><br><span class="line"><span class="comment"> *     ç”¨äºå–å‡ºæ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªæ¶ˆæ¯</span></span><br><span class="line"><span class="comment"> * PSï¼š</span></span><br><span class="line"><span class="comment"> *     çœ‹åˆ°è¿™ä¸ªnextä½ æˆ–è®¸å°±åº”è¯¥æ‡‚äº†ï¼Œå…¶å®è¿™ä¸ªMessageQueueå¹¶ä¸æ˜¯å’±ä»¬é¡¾åæ€ä¹‰ä»¥ä¸ºçš„é‚£ä¸ªQueueï¼Œå…¶å®ä»–çš„å®ç°æ˜¯ä¸€ä¸ªé“¾è¡¨ </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Message <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Return here if the message loop has already quit and been disposed.</span></span><br><span class="line">    <span class="comment">// This can happen if the application tries to restart a looper after quit</span></span><br><span class="line">    <span class="comment">// which is not supported.</span></span><br><span class="line">    <span class="comment">// å¦‚æœLooperå·²ç»é€€å‡ºï¼ˆè°ƒç”¨äº†disposeæ–¹æ³•åmPtr=0ï¼‰</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">long</span> <span class="variable">ptr</span> <span class="operator">=</span> mPtr;</span><br><span class="line">    <span class="keyword">if</span> (ptr == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®°å½•ç©ºé—²æ—¶éœ€è¦å¤„ç†çš„IdleHandleræ•°é‡</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">pendingIdleHandlerCount</span> <span class="operator">=</span> -<span class="number">1</span>; <span class="comment">// -1 only during first iteration</span></span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ3.2.1</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">nextPollTimeoutMillis</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nextPollTimeoutMillis != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// åˆ·æ–°Binderå‘½ä»¤</span></span><br><span class="line">            Binder.flushPendingCommands();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è°ƒç”¨nativeå±‚ï¼Œå¦‚æœè¿”å›äº†å°±è¯´æ˜å¯ä»¥ä»é˜Ÿåˆ—ä¸­å–å‡ºä¸€æ¡æ¶ˆæ¯</span></span><br><span class="line">        <span class="comment">// å¦‚æœæ¶ˆæ¯é˜Ÿåˆ—ä¸­æ²¡æœ‰æ¶ˆæ¯å°±é˜»å¡ç­‰å¾…ï¼Œé enqueueMessage()ä¸­æœ€åä¸€æ­¥è°ƒç”¨nativeWake()æ¥å”¤é†’è¯¥æ–¹æ³•</span></span><br><span class="line">        nativePollOnce(ptr, nextPollTimeoutMillis);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">            <span class="comment">// Try to retrieve the next message.  Return if found.</span></span><br><span class="line">            <span class="comment">// å¾—åˆ°æ—¶é—´-ä»æ‰‹æœºå¼€æœºåˆ°ç°åœ¨è°ƒç”¨ç»è¿‡çš„æ—¶é—´</span></span><br><span class="line">            <span class="keyword">final</span> <span class="type">long</span> <span class="variable">now</span> <span class="operator">=</span> SystemClock.uptimeMillis();</span><br><span class="line">            <span class="type">Message</span> <span class="variable">prevMsg</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="comment">// å¾—åˆ°é˜Ÿå¤´</span></span><br><span class="line">            <span class="type">Message</span> <span class="variable">msg</span> <span class="operator">=</span> mMessages;</span><br><span class="line">            <span class="comment">// åˆ¤æ–­è¿™ä¸ªmessageæ˜¯ä¸æ˜¯barrier</span></span><br><span class="line">            <span class="keyword">if</span> (msg != <span class="literal">null</span> &amp;&amp; msg.target == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// Stalled by a barrier.  Find the next asynchronous message in the queue.</span></span><br><span class="line">                <span class="comment">// å¾ªç¯éå†å‡ºç¬¬ä¸€ä¸ªå¼‚æ­¥æ¶ˆæ¯ï¼Œå¦‚æœè®¾ç½®äº†barrierï¼Œå°±ä¸èƒ½å†æ‰§è¡ŒåŒæ­¥æ¶ˆæ¯äº†ï¼Œé™¤éå°†barrierç§»é™¤ã€‚</span></span><br><span class="line">                <span class="comment">// ä½†æ˜¯å¼‚æ­¥æ¶ˆæ¯ä¸å—å½±å“ç…§æ ·æ‰§è¡Œï¼Œæ‰€ä»¥åœ¨è¿™é‡Œè¦æ‰¾åˆ°å¼‚æ­¥æ¶ˆæ¯</span></span><br><span class="line">                <span class="keyword">do</span> &#123;</span><br><span class="line">                    prevMsg = msg;</span><br><span class="line">                    msg = msg.next;</span><br><span class="line">                &#125; <span class="keyword">while</span> (msg != <span class="literal">null</span> &amp;&amp; !msg.isAsynchronous());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (msg != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœåˆ†å‘æ—¶é—´è¿˜æ²¡åˆ°</span></span><br><span class="line">                <span class="keyword">if</span> (now &lt; msg.when) &#123;</span><br><span class="line">                    <span class="comment">// Next message is not ready.  Set a timeout to wake up when it is ready.</span></span><br><span class="line">                    <span class="comment">// æ›´æ–°æ‰§è¡Œæ—¶é—´ç‚¹</span></span><br><span class="line">                    nextPollTimeoutMillis = (<span class="type">int</span>) Math.min(msg.when - now, Integer.MAX_VALUE);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// æ—¶é—´åˆ°äº†</span></span><br><span class="line">                    <span class="comment">// Got a message.</span></span><br><span class="line">                    mBlocked = <span class="literal">false</span>;</span><br><span class="line">                    <span class="keyword">if</span> (prevMsg != <span class="literal">null</span>) &#123;</span><br><span class="line">                        prevMsg.next = msg.next;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        mMessages = msg.next;</span><br><span class="line">                    &#125;</span><br><span class="line">                    msg.next = <span class="literal">null</span>;</span><br><span class="line">                    <span class="keyword">if</span> (DEBUG) Log.v(TAG, <span class="string">&quot;Returning message: &quot;</span> + msg);</span><br><span class="line">                    msg.markInUse();</span><br><span class="line">                    <span class="keyword">return</span> msg;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœæ²¡æœ‰å…¶ä»–æ¶ˆæ¯äº†</span></span><br><span class="line">                nextPollTimeoutMillis = -<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Process the quit message now that all pending messages have been handled.</span></span><br><span class="line">            <span class="comment">// æ­£åœ¨é€€å‡ºäº†ï¼Œè¿”å›nullã€‚</span></span><br><span class="line">            <span class="keyword">if</span> (mQuitting) &#123;</span><br><span class="line">                dispose();</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// If first time idle, then get the number of idlers to run.</span></span><br><span class="line">            <span class="comment">// Idle handles only run if the queue is empty or if the first message</span></span><br><span class="line">            <span class="comment">// in the queue (possibly a barrier) is due to be handled in the future.</span></span><br><span class="line">            <span class="comment">// åˆ¤æ–­å¦‚æœè¿™æ˜¯ç¬¬ä¸€æ¬¡å¾ªç¯ï¼ˆåªæœ‰ç¬¬ä¸€æ¬¡å¾ªç¯æ—¶ä¼šå°äº0ï¼‰å¹¶ä¸”é˜Ÿåˆ—ä¸ºç©ºæˆ–è¿˜æ²¡åˆ°å¤„ç†ç¬¬ä¸€ä¸ªçš„æ—¶é—´</span></span><br><span class="line">            <span class="keyword">if</span> (pendingIdleHandlerCount &lt; <span class="number">0</span></span><br><span class="line">                    &amp;&amp; (mMessages == <span class="literal">null</span> || now &lt; mMessages.when)) &#123;</span><br><span class="line">                pendingIdleHandlerCount = mIdleHandlers.size();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (pendingIdleHandlerCount &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// No idle handlers to run.  Loop and wait some more.</span></span><br><span class="line">                <span class="comment">// ç½®ä¸ºé˜»å¡çŠ¶æ€</span></span><br><span class="line">                mBlocked = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åˆå§‹åŒ–æœ€å°‘å››ä¸ªè¦è¢«æ‰§è¡Œçš„IdleHandler</span></span><br><span class="line">            <span class="keyword">if</span> (mPendingIdleHandlers == <span class="literal">null</span>) &#123;</span><br><span class="line">                mPendingIdleHandlers = <span class="keyword">new</span> <span class="title class_">IdleHandler</span>[Math.max(pendingIdleHandlerCount, <span class="number">4</span>)];</span><br><span class="line">            &#125;</span><br><span class="line">            mPendingIdleHandlers = mIdleHandlers.toArray(mPendingIdleHandlers);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Run the idle handlers.</span></span><br><span class="line">        <span class="comment">// We only ever reach this code block during the first iteration.</span></span><br><span class="line">        <span class="comment">// å¼€å§‹å¾ªç¯æ‰§è¡Œæ‰€æœ‰çš„IdleHandlerå¹¶æ ¹æ®è¿”å›å€¼åˆ¤æ–­æ˜¯å¦ä¿ç•™</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; pendingIdleHandlerCount; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">IdleHandler</span> <span class="variable">idler</span> <span class="operator">=</span> mPendingIdleHandlers[i];</span><br><span class="line">            mPendingIdleHandlers[i] = <span class="literal">null</span>; <span class="comment">// release the reference to the handler</span></span><br><span class="line"></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">keep</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                keep = idler.queueIdle();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">                Log.wtf(TAG, <span class="string">&quot;IdleHandler threw exception&quot;</span>, t);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!keep) &#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">                    mIdleHandlers.remove(idler);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// IdleHandleråªä¼šåœ¨æ¶ˆæ¯é˜Ÿåˆ—é˜»å¡ä¹‹å‰æ‰§è¡Œä¸€æ¬¡ï¼Œä¹‹åå†ä¸ä¼šæ‰§è¡Œï¼ŒçŸ¥é“ä¸‹ä¸€æ¬¡è¢«è°ƒç”¨next()ã€‚</span></span><br><span class="line">        pendingIdleHandlerCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// While calling an idle handler, a new message could have been delivered</span></span><br><span class="line">        <span class="comment">// so go back and look again for a pending message without waiting.</span></span><br><span class="line">        <span class="comment">// å½“æ‰§è¡Œäº†IdleHandleråï¼Œä¼šæ¶ˆè€—ä¸€æ®µæ—¶é—´ï¼Œåˆºæ­»å¯èƒ½å·²ç»åˆ°è¾¾æ‰§è¡Œæ¶ˆæ¯çš„æ—¶é—´äº†ï¼Œæ‰€ä»¥é‡ç½®è¯¥å˜é‡å†é‡æ–°æ£€æŸ¥æ—¶é—´ã€‚</span></span><br><span class="line">        nextPollTimeoutMillis = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ†æ3-2-1"><a href="#åˆ†æ3-2-1" class="headerlink" title="åˆ†æ3.2.1"></a>åˆ†æ3.2.1</h3><p>nextPollTimeoutMillisæ˜¯ä¸€ä¸ªå˜é‡ï¼Œç”¨äºè¡¨ç¤ºæ—¶é—´ã€‚</p><ul><li>å¦‚æœnextPollTimeoutMillis = -1ï¼Œåˆ™ä¸€ç›´ä¼šé˜»å¡ä¸ä¼šè¶…æ—¶</li><li>å¦‚æœnextPollTimeoutMillis = 0ï¼Œä¸ä¼šé˜»å¡ï¼Œç«‹å³è¿”å›</li><li>å¦‚æœnextPollTimeoutMillis &gt; 0ï¼Œæœ€é•¿é˜»å¡nextPollTimeoutMillisæ¯«ç§’ï¼Œå¦‚æœæœŸé—´æœ‰ç¨‹åºå”¤é†’ä¼šç«‹å³è¿”å›</li></ul><h2 id="åˆ†æ3-2-Handler-dispatchMessage"><a href="#åˆ†æ3-2-Handler-dispatchMessage" class="headerlink" title="åˆ†æ3.2 Handler # dispatchMessage()"></a>åˆ†æ3.2 Handler # dispatchMessage()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æ3.2 Handler.dispatchMessage()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dispatchMessage</span><span class="params">(<span class="meta">@NonNull</span> Message msg)</span> &#123;</span><br><span class="line">    <span class="comment">// å…ˆæŸ¥çœ‹messageè‡ªå·±callbackæœ‰æ²¡æœ‰è¢«è®¾ç½®ï¼Œå¦‚æœæœ‰é‚£å°±äº¤ç»™è‡ªå·±çš„callbackå»å¤„ç†</span></span><br><span class="line">    <span class="keyword">if</span> (msg.callback != <span class="literal">null</span>) &#123;</span><br><span class="line">        handleCallback(msg);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ²¡æœ‰messageè‡ªå·±çš„callbackï¼Œé‚£å°±çœ‹çœ‹Handleræœ‰æ²¡æœ‰callbackï¼Œ</span></span><br><span class="line">        <span class="comment">// å¦‚æœæœ‰ï¼Œé‚£å°±äº¤ç»™Handlerçš„Callbackå»å¤„ç†ï¼Œ</span></span><br><span class="line">        <span class="keyword">if</span> (mCallback != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mCallback.handleMessage(msg)) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœHandlerè‡ªå·±è¿˜æ²¡æœ‰Callbackï¼Œé‚£å°±Handlerè‡ªå·±å¤„ç†</span></span><br><span class="line">        handleMessage(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢å¯ä»¥å¾—åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼š<br>å¤„ç†æ¶ˆæ¯çš„æ–¹å¼æœ‰3ä¸ªï¼Œåˆ†åˆ«ä¸ºMessageè‡ªå·±çš„Callbackã€Handlerçš„Callbackä»¥åŠHandlerè‡ªå·±ã€‚</p><ol><li>ä¼˜å…ˆçº§æœ€é«˜çš„æ˜¯Messageè‡ªå·±çš„callbackï¼Œè¿™æ˜¯ä¸€ä¸ªRunnableå¯¹è±¡ï¼Œæˆ‘ä»¬ç”¨Handler postä¸€ä¸ªRunnableçš„æ—¶å€™ï¼Œå…¶å®å°±æ˜¯æŠŠè¿™ä¸ªRunnableèµ‹å€¼ä¸ªä¸€ä¸ªMessageå¯¹è±¡çš„callbackï¼Œç„¶åæŠŠMessageå¯¹è±¡å‘é€ç»™MessageQueueã€‚</li><li>ä¼˜å…ˆçº§ç¬¬äºŒçš„æ˜¯Handlerè‡ªå·±çš„mCallbackï¼Œåœ¨æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªHandlerå¯¹è±¡çš„ä½¿ç”¨å¯ä»¥ä¼ ä¸€ä¸ªHandler.Callbackå¯¹è±¡ç»™å®ƒå¹¶å®ç°Callbacké‡Œçš„handleMessage(msg)æ–¹æ³•ï¼Œä½œä¸ºæˆ‘ä»¬çš„æ¶ˆæ¯å¤„ç†æ–¹æ³•ã€‚</li><li>ä¼˜å…ˆçº§æœ€ä½çš„æ˜¯Handlerè‡ªå·±çš„handleMessage(msg)æ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„æ¶ˆæ¯å¤„ç†æ–¹æ³•ã€‚</li></ol><h1 id="æµç¨‹å›¾"><a href="#æµç¨‹å›¾" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h1><p>ï¼ˆå›¾ç‰‡æ¥è‡ªäº<a href="https://juejin.im/post/5c74b64a6fb9a049be5e22fc#heading-7">æ­¤å¤„</a>ï¼‰<br><img src="https://cdn.littlecorgi.top/mweb/2019-11-17/15739707276639.jpg" alt=""><br><img src="https://cdn.littlecorgi.top/mweb/2019-11-17/15739710069538.jpg" alt=""></p><h1 id="å»¶ä¼¸"><a href="#å»¶ä¼¸" class="headerlink" title="å»¶ä¼¸"></a>å»¶ä¼¸</h1><h2 id="1-ä¸ºä»€ä¹ˆè¯´Handlerå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„æ¼"><a href="#1-ä¸ºä»€ä¹ˆè¯´Handlerå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„æ¼" class="headerlink" title="1. ä¸ºä»€ä¹ˆè¯´Handlerå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„æ¼"></a>1. ä¸ºä»€ä¹ˆè¯´Handlerå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„æ¼</h2><p>åªè¦ä½ ç”¨Android Studioï¼Œå¹¶åœ¨Activityé‡Œé¢ç”¨è¿‡Handlerï¼Œéƒ½ä¼šæ³¨æ„åˆ°ä¸€ä¸ªåœ°æ–¹ï¼Œå°±æ˜¯å¦‚æœä½ ç›´æ¥åˆ›å»ºHandlerå¯¹è±¡å¹¶é‡å†™handleMessageæ–¹æ³•çš„è¯ï¼ŒASä¸€æŠŠéƒ½ä¼šæŠ¥ä¸€ä¸ªwarningï¼š<br><img src="https://cdn.littlecorgi.top/mweb/2019-11-17/15739712887055.jpg" alt=""><br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">This Handler class should be static or leaks might occur.</span><br><span class="line"></span><br><span class="line">è¯¥å¤„ç†ç¨‹åºç±»åº”ä¸ºé™æ€ï¼Œå¦åˆ™å¯èƒ½å‘ç”Ÿæ³„æ¼</span><br></pre></td></tr></table></figure></p><p>å°±æ˜¯è¯´å¦‚æœç›´æ¥è¿™æ ·å†™å°±å¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼Œä½†æ˜¯å¦‚æœä½ åœ¨ä¸æ˜¯Activityçš„ç±»é‡Œé¢è¿™æ ·å†™åˆä¸ä¼šæŠ¥warningï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>å› ä¸ºHandlerå…è®¸æˆ‘ä»¬å‘é€å»¶æ—¶æ¶ˆæ¯ï¼Œä½†æ˜¯å¦‚æœåœ¨å»¶æ—¶æœŸé—´ï¼Œç”¨æˆ·å…³é—­äº†Activityã€‚è¿™æ—¶MessageæŒæœ‰Handlerï¼Œè€Œåˆå› ä¸ºJavaçš„ç‰¹æ€§ï¼Œå†…éƒ¨ç±»ä¼šæŒæœ‰å¤–éƒ¨ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´Handlerä¼šæŒæœ‰Activityï¼Œè¿™æ ·å°±å¯¼è‡´Activityæ³„æ¼äº†ã€‚</p><p>è§£å†³åŠæ³•å°±æ˜¯æŠŠHandlerå®šä¹‰ä¸ºé™æ€å†…éƒ¨ç±»ï¼Œå¹¶åœ¨å†…éƒ¨æŒæœ‰Activityçš„å¼±å¼•ç”¨ï¼Œå¹¶åŠæ—¶ç§»é™¤æ‰€æœ‰æ¶ˆæ¯ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SafeHandler</span> <span class="keyword">extends</span> <span class="title class_">Handler</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> WeakReference&lt;MainActivity&gt; ref;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SafeHandler</span><span class="params">(MainActivity activity)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.ref = <span class="keyword">new</span> <span class="title class_">WeakReference</span>&lt;&gt;(activity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleMessage</span><span class="params">(<span class="meta">@NonNull</span> Message msg)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="2-ä¸ºä»€ä¹ˆä¸»çº¿ç¨‹ä¸éœ€è¦åˆ›å»ºLooperï¼Œè€Œä¸”ä¸»çº¿ç¨‹çš„Looperä¸è®¸é€€å‡º"><a href="#2-ä¸ºä»€ä¹ˆä¸»çº¿ç¨‹ä¸éœ€è¦åˆ›å»ºLooperï¼Œè€Œä¸”ä¸»çº¿ç¨‹çš„Looperä¸è®¸é€€å‡º" class="headerlink" title="2. ä¸ºä»€ä¹ˆä¸»çº¿ç¨‹ä¸éœ€è¦åˆ›å»ºLooperï¼Œè€Œä¸”ä¸»çº¿ç¨‹çš„Looperä¸è®¸é€€å‡º"></a>2. ä¸ºä»€ä¹ˆä¸»çº¿ç¨‹ä¸éœ€è¦åˆ›å»ºLooperï¼Œè€Œä¸”ä¸»çº¿ç¨‹çš„Looperä¸è®¸é€€å‡º</h2><p>å› ä¸ºåœ¨ä¸»çº¿ç¨‹åˆ›å»ºæ—¶ä¼šè‡ªåŠ¨è°ƒç”¨Looperçš„prepareæ–¹æ³•ï¼Œå¹¶è°ƒç”¨loopæ–¹æ³•ã€‚æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥åœ¨ä¸»çº¿ç¨‹ä½¿ç”¨Handlerã€‚</p><p>è€Œä¸ºä»€ä¹ˆä¸èƒ½é€€å‡ºï¼Œæ˜¯å› ä¸ºå¦‚æœLooperé€€å‡ºäº†ï¼Œé‚£ä¹ˆä¸»çº¿ç¨‹å°±ä¼šæŒ‚æ‰ã€‚Androidä¹Ÿä¸è®¸ä½ æ‰‹åŠ¨é€€å‡ºä¸»çº¿ç¨‹çš„Looperã€‚</p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Android/">Android</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Handler/">Handler</category>
      
      <category domain="https://www.littlecorgi.top/tags/ThreadLocal/">ThreadLocal</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E6%BA%90%E7%A0%81/">æºç </category>
      
      
      <comments>https://www.littlecorgi.top/posts/21eb5c30.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Androidæ¶ˆæ¯æœºåˆ¶ä¹‹ThreadLocal</title>
      <link>https://www.littlecorgi.top/posts/64f0a9f6.html</link>
      <guid>https://www.littlecorgi.top/posts/64f0a9f6.html</guid>
      <pubDate>Fri, 08 Nov 2019 15:00:55 GMT</pubDate>
      
        
        
          
          
      <description></description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>ThreadLocalæ˜¯ä¸€ä¸ªçº¿ç¨‹å†…éƒ¨çš„æ•°æ®å‚¨å­˜ç±»ï¼Œé€šè¿‡ä»–å¯ä»¥åœ¨æŒ‡å®šçš„çº¿ç¨‹ä¸­å­˜å‚¨æ•°æ®ã€‚æ•°æ®å­˜å‚¨ä»¥åï¼Œåªæœ‰åœ¨æŒ‡å®šçš„çº¿ç¨‹ä¸­å¯ä»¥è·å–åˆ°å­˜å‚¨çš„æ•°æ®ï¼Œå¯¹äºå…¶ä»–çº¿ç¨‹æ¥è¯´åˆ™æ— æ³•è·å–ã€‚</p><p>åœ¨æºç ä¸­æ˜¯è¿™æ ·å†™çš„ï¼š</p><blockquote><p>This class provides thread-local variables.  These variables differ from<br>their normal counterparts in that each thread that accesses one (via its<br>{@code get} or {@code set} method) has its own, independently initialized<br>copy of the variable.  {@code ThreadLocal} instances are typically private<br>static fields in classes that wish to associate state with a thread (e.g.,<br>a user ID or Transaction ID).</p></blockquote><p>ç¿»è¯‘è¿‡æ¥ï¼Œå°±æ˜¯è¯´è¿™ä¸ªç±»æä¾›çº¿ç¨‹å±€éƒ¨å˜é‡ï¼Œä½†æ˜¯ä»–å’Œæ™®é€šå˜é‡ä¸åŒï¼Œä»–æ˜¯æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ä¸€ä¸ªç‹¬ç«‹åˆå§‹åŒ–çš„å˜é‡å‰¯æœ¬ã€‚è€Œé€šè¿‡<code>get()</code>å’Œ<code>set()</code>æ–¹æ³•å°±èƒ½å¾—åˆ°å’Œè®¾ç½®å½“å‰çº¿ç¨‹å¯¹åº”çš„è¯¥å˜é‡çš„å€¼ã€‚</p><h1 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h1><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹ç¤ºä¾‹ä»£ç ï¼Œåœ¨ä¸€ä¸ªActivityçš„onCreateæ–¹æ³•ä¸­å†™å…¥å¦‚ä¸‹ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éœ€è¦æ·»åŠ çš„ä»£ç </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TAG</span> <span class="operator">=</span> <span class="string">&quot;MainActivity&quot;</span>;</span><br><span class="line">    <span class="comment">// éœ€è¦æ·»åŠ çš„ä»£ç </span></span><br><span class="line">    <span class="keyword">private</span> ThreadLocal&lt;Boolean&gt; mBooleanThreadLocal = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// éœ€è¦æ·»åŠ çš„ä»£ç </span></span><br><span class="line">        mBooleanThreadLocal.set(<span class="literal">true</span>);</span><br><span class="line">        Log.d(TAG, <span class="string">&quot;[Thread#main]mBooleanThreadLocal=&quot;</span> + mBooleanThreadLocal.get());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// éœ€è¦æ·»åŠ çš„ä»£ç </span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;Thread#1&quot;</span>) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                mBooleanThreadLocal.set(<span class="literal">false</span>);</span><br><span class="line">                Log.d(TAG, <span class="string">&quot;[Thread#1]mBooleanThreadLocal=&quot;</span> + mBooleanThreadLocal.get());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.start();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// éœ€è¦æ·»åŠ çš„ä»£ç </span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;Thread#2&quot;</span>) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                Log.d(TAG, <span class="string">&quot;[Thread#2]mBooleanThreadLocal=&quot;</span> + mBooleanThreadLocal.get());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ ¹æ®æˆ‘ä»¬ä¸Šé¢è¯´çš„ThreadLocalçš„ç‰¹æ€§ï¼Œå°±å¯ä»¥çŒœå‡ºåº”è¯¥ä¼šè¾“å‡ºï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[Thread#main]mBooleanThreadLocal=<span class="literal">true</span></span><br><span class="line">[Thread#<span class="number">1</span>]mBooleanThreadLocal=<span class="literal">false</span></span><br><span class="line">[Thread#<span class="number">2</span>]mBooleanThreadLocal=<span class="literal">null</span></span><br></pre></td></tr></table></figure></p><p>ç„¶åè¿è¡Œè¾“å‡ºçš„ç»“æœï¼Œä¸å‡ºæ‰€æ–™ï¼Œæœç„¶å’Œä¸Šé¢ä¸€æ ·ã€‚</p><h1 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h1><p>ä¸€èˆ¬æ¥è¯´ï¼Œå½“æŸäº›æ•°æ®æ˜¯ä»¥çº¿ç¨‹ä½œä¸ºä½œç”¨åŸŸå¹¶ä¸”ä¸åŒçº¿ç¨‹å…·æœ‰ä¸åŒçš„æ•°æ®å‰¯æœ¬çš„æ—¶å€™ï¼Œå°±å¯ä»¥è€ƒè™‘ä½¿ç”¨ThreadLocalã€‚æ¯”å¦‚å¯¹äºHandleræ¥è¯´ï¼Œå®ƒéœ€è¦è·å–å½“å‰çº¿ç¨‹çš„Looperï¼Œå¾ˆæ˜¾ç„¶Looperçš„ä½œç”¨åŸŸå°±æ˜¯çº¿ç¨‹å¹¶ä¸”ä¸åŒçº¿ç¨‹å…·æœ‰ä¸åŒçš„Looperï¼Œè¿™ä¸ªæ—¶å€™é€šè¿‡ThreadLocalå°±å¯ä»¥è½»æ¾å®ç°Looperåœ¨çº¿ç¨‹ä¸­çš„å­˜å–ï¼Œå¦‚æœä¸é‡‡ç”¨ThreadLocalï¼Œé‚£ä¹ˆç³»ç»Ÿå°±å¿…é¡»æä¾›ä¸€ä¸ªå…¨å±€çš„å“ˆå¸Œè¡¨ä¾›HandleræŸ¥æ‰¾æŒ‡å®šçº¿ç¨‹çš„Looperï¼Œè¿™æ ·ä¸€æ¥å°±å¿…é¡»æä¾›ä¸€ä¸ªç±»ä¼¼äºLooperManagerçš„ç±»äº†ï¼Œä½†æ˜¯ç³»ç»Ÿå¹¶æ²¡æœ‰è¿™ä¹ˆåšè€Œæ˜¯é€‰æ‹©äº†ThreadLocalï¼Œè¿™å°±æ˜¯ThreadLocalçš„å¥½å¤„ã€‚</p><p>å¦ä¸€ä¸ªä½¿ç”¨åœºæ™¯å°±æ˜¯å¤æ‚é€»è¾‘ä¸‹çš„å¯¹è±¡ä¼ é€’ã€‚æ¯”å¦‚ç›‘å¬å™¨çš„ä¼ é€’ï¼Œæœ‰äº›æ—¶å€™ä¸€ä¸ªçº¿ç¨‹ä¸­çš„ä»»åŠ¡è¿‡äºå¤æ‚ï¼Œè¿™å¯èƒ½è¡¨ç°ä¸ºå‡½æ•°è°ƒç”¨æ ˆæ¯”è¾ƒæ·±ä»¥åŠä»£ç å…¥å£çš„å¤šæ ·æ€§ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åˆéœ€è¦ç›‘å¬å™¨èƒ½å¤Ÿè´¯ç©¿æ•´ä¸ªçº¿ç¨‹çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥æ€ä¹ˆåšå‘¢ï¼Ÿå…¶å®å°±å¯ä»¥é‡‡ç”¨ThreadLocalï¼Œé‡‡ç”¨ThreadLocalå¯ä»¥è®©ç›‘å¬å™¨ä½œä¸ºçº¿ç¨‹å†…çš„å…¨å±€å¯¹è±¡è€Œå­˜åœ¨ï¼Œåœ¨çº¿ç¨‹å†…éƒ¨åªè¦é€šè¿‡getæ–¹æ³•å°±å¯ä»¥è·å–åˆ°ç›‘å¬å™¨ã€‚è€Œå¦‚æœä¸é‡‡ç”¨ThreadLocalï¼Œé‚£ä¹ˆæˆ‘ä»¬èƒ½æƒ³åˆ°çš„å¯èƒ½æ˜¯å¦‚ä¸‹ä¸¤ç§æ–¹æ³•ï¼šç¬¬ä¸€ç§æ–¹æ³•æ˜¯å°†ç›‘å¬å™¨é€šè¿‡å‚æ•°çš„å½¢å¼åœ¨å‡½æ•°è°ƒç”¨æ ˆä¸­è¿›è¡Œä¼ é€’ï¼Œç¬¬äºŒç§æ–¹æ³•å°±æ˜¯å°†ç›‘å¬å™¨ä½œä¸ºé™æ€å˜é‡ä¾›çº¿ç¨‹è®¿é—®ã€‚ä¸Šè¿°è¿™ä¸¤ç§æ–¹æ³•éƒ½æ˜¯æœ‰å±€é™æ€§çš„ã€‚ç¬¬ä¸€ç§æ–¹æ³•çš„é—®é¢˜æ—¶å½“å‡½æ•°è°ƒç”¨æ ˆå¾ˆæ·±çš„æ—¶å€™ï¼Œé€šè¿‡å‡½æ•°å‚æ•°æ¥ä¼ é€’ç›‘å¬å™¨å¯¹è±¡è¿™å‡ ä¹æ˜¯ä¸å¯æ¥å—çš„ï¼Œè¿™ä¼šè®©ç¨‹åºçš„è®¾è®¡çœ‹èµ·æ¥å¾ˆç³Ÿç³•ã€‚ç¬¬äºŒç§æ–¹æ³•æ˜¯å¯ä»¥æ¥å—çš„ï¼Œä½†æ˜¯è¿™ç§çŠ¶æ€æ˜¯ä¸å…·æœ‰å¯æ‰©å……æ€§çš„ï¼Œæ¯”å¦‚å¦‚æœåŒæ—¶æœ‰ä¸¤ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œï¼Œé‚£ä¹ˆå°±éœ€è¦æä¾›ä¸¤ä¸ªé™æ€çš„ç›‘å¬å™¨å¯¹è±¡ï¼Œå¦‚æœæœ‰10ä¸ªçº¿ç¨‹åœ¨å¹¶å‘æ‰§è¡Œå‘¢ï¼Ÿæä¾›10ä¸ªé™æ€çš„ç›‘å¬å™¨å¯¹è±¡ï¼Ÿè¿™æ˜¾ç„¶æ˜¯ä¸å¯æ€è®®çš„ï¼Œè€Œé‡‡ç”¨ThreadLocalæ¯ä¸ªç›‘å¬å™¨å¯¹è±¡éƒ½åœ¨è‡ªå·±çš„çº¿ç¨‹å†…éƒ¨å­˜å‚¨ï¼Œæ ¹æ®å°±ä¸ä¼šæœ‰æ–¹æ³•2çš„è¿™ç§é—®é¢˜ã€‚</p><h1 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h1><p>ä½œä¸ºä¸€ä¸ªå­˜å‚¨æ•°æ®çš„ç±»ï¼Œå…³é”®ç‚¹å°±åœ¨getå’Œsetæ–¹æ³•ã€‚</p><h2 id="ThreadLocal-set"><a href="#ThreadLocal-set" class="headerlink" title="ThreadLocal # set"></a>ThreadLocal # set</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(T value)</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–å½“å‰çº¿ç¨‹</span></span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">    <span class="comment">// å®é™…ä¸Šå­˜å‚¨æ•°æ®çš„ç»“æ„ç±»å‹</span></span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ1</span></span><br><span class="line">    <span class="type">ThreadLocalMap</span> <span class="variable">map</span> <span class="operator">=</span> getMap(t);</span><br><span class="line">    <span class="comment">// å¦‚æœå­˜åœ¨Mapå°±ç›´æ¥setï¼Œæ²¡æœ‰å°±åˆ›å»ºmapå¹¶set</span></span><br><span class="line">    <span class="keyword">if</span> (map != <span class="literal">null</span>)</span><br><span class="line">        map.set(<span class="built_in">this</span>, value);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="comment">// -&gt;&gt; åˆ†æ2</span></span><br><span class="line">        createMap(t, value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æ1ï¼šgetMap()æ–¹æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">ThreadLocalMap <span class="title function_">getMap</span><span class="params">(Thread t)</span> &#123;</span><br><span class="line">    <span class="comment">// è¿”å›ä¼ å…¥çº¿ç¨‹çš„ThreadLocalMap</span></span><br><span class="line">    <span class="keyword">return</span> t.threadLocals;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æ2ï¼šcreateMap()æ–¹æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">createMap</span><span class="params">(Thread t, T firstValue)</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„ThreadLocalMapå¹¶å°†å€¼ä¼ å…¥</span></span><br><span class="line">    t.threadLocals = <span class="keyword">new</span> <span class="title class_">ThreadLocalMap</span>(<span class="built_in">this</span>, firstValue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ä½ è°ƒç”¨setæ–¹æ³•æ—¶ï¼Œå°±ä¼šæ‹¿åˆ°å½“å‰çº¿ç¨‹å¹¶å¾—åˆ°å½“å‰çº¿ç¨‹çš„ThreadLocalMapï¼Œå¦‚æœmapä¸ä¸ºç©ºï¼Œé‚£å°±ç›´æ¥æŠŠå€¼ä¼ å…¥mapï¼›å¦‚æœmapä¸ºç©ºé‚£å°±æ–°å»ºä¸€ä¸ªå†ä¼ å€¼ã€‚</p><p>è¿™å—æˆ‘ä»¬å°±èƒ½æ‡‚ä¸ºå•¥ThreadLocalèƒ½åªæ“ä½œè‡ªå·±çº¿ç¨‹é‡Œé¢çš„ä¸œè¥¿äº†ï¼Œå› ä¸ºæ‰€æœ‰ThreadLocaléƒ½ä¸ä»–çº¿ç¨‹ä¸­çš„ThreadLocalMapæœ‰å…³ã€‚</p><p>é‚£æˆ‘ä»¬å†æ¥çœ‹çœ‹ThreadLocalMapã€‚</p><h2 id="ThreadLocalMap"><a href="#ThreadLocalMap" class="headerlink" title="ThreadLocalMap"></a>ThreadLocalMap</h2><h3 id="å±æ€§å˜é‡"><a href="#å±æ€§å˜é‡" class="headerlink" title="å±æ€§å˜é‡"></a>å±æ€§å˜é‡</h3><p>å…ˆæ¥çœ‹ä¸‹ThreadLocalMapçš„ä¸€äº›å˜é‡ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å­˜å‚¨æ•°æ®çš„ç»“æ„ä¸ºEntryï¼Œè€Œä¸”keyæ˜¯å¼±å¼•ç”¨</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Entry</span> <span class="keyword">extends</span> <span class="title class_">WeakReference</span>&lt;ThreadLocal&lt;?&gt;&gt; &#123;</span><br><span class="line">    Object value;</span><br><span class="line"></span><br><span class="line">    Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;</span><br><span class="line">        <span class="built_in">super</span>(k);</span><br><span class="line">        value = v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// tableçš„åˆå§‹å®¹é‡</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">INITIAL_CAPACITY</span> <span class="operator">=</span> <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// tableç”¨äºå­˜å‚¨æ•°æ®</span></span><br><span class="line"><span class="keyword">private</span> Entry[] table;</span><br><span class="line"></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è´Ÿè½½å› å­ï¼Œç”¨äºæ‰©å®¹</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> threshold; <span class="comment">// Default to 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®è´Ÿè½½å› å­ï¼Œé»˜è®¤ä¸ºå½“å‰å¤§å°çš„2/3</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setThreshold</span><span class="params">(<span class="type">int</span> len)</span> &#123;</span><br><span class="line">    threshold = len * <span class="number">2</span> / <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸‹ä¸€ä¸ªç´¢å¼•</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">nextIndex</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> len)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ((i + <span class="number">1</span> &lt; len) ? i + <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸Šä¸€ä¸ªç´¢å¼•</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">prevIndex</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> len)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ((i - <span class="number">1</span> &gt;= <span class="number">0</span>) ? i - <span class="number">1</span> : len - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ„é€ å‡½æ•°</span></span><br><span class="line">ThreadLocalMap(ThreadLocal&lt;?&gt; firstKey, Object firstValue) &#123;</span><br><span class="line">    table = <span class="keyword">new</span> <span class="title class_">Entry</span>[INITIAL_CAPACITY];</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> firstKey.threadLocalHashCode &amp; (INITIAL_CAPACITY - <span class="number">1</span>);</span><br><span class="line">    table[i] = <span class="keyword">new</span> <span class="title class_">Entry</span>(firstKey, firstValue);</span><br><span class="line">    size = <span class="number">1</span>;</span><br><span class="line">    setThreshold(INITIAL_CAPACITY);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="ThreadLocalMap-set"><a href="#ThreadLocalMap-set" class="headerlink" title="ThreadLocalMap # set()"></a>ThreadLocalMap # set()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(ThreadLocal&lt;?&gt; key, Object value)</span> &#123;</span><br><span class="line"></span><br><span class="line">    Entry[] tab = table;</span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> tab.length;</span><br><span class="line">    <span class="comment">// æ ¹æ®å“ˆå¸Œç®—æ³•æ‰¾åˆ°å¯¹åº”èŠ‚ç‚¹</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> key.threadLocalHashCode &amp; (len-<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ¤æ–­å½“å‰ä½ç½®æ˜¯å¦æœ‰æ•°æ®ï¼Œå¦‚æœkeyå€¼ç›¸åŒï¼Œå°±æ›¿æ¢ï¼Œå¦‚æœä¸åŒåˆ™æ‰¾ç©ºä½æ”¾æ•°æ®ã€‚</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">Entry</span> <span class="variable">e</span> <span class="operator">=</span> tab[i];</span><br><span class="line">         e != <span class="literal">null</span>;</span><br><span class="line">         e = tab[i = nextIndex(i, len)]) &#123;</span><br><span class="line">        ThreadLocal&lt;?&gt; k = e.get();</span><br><span class="line">        <span class="comment">//åˆ¤æ–­keyå€¼ç›¸åŒå¦ï¼Œå¦‚æœæ˜¯ç›´æ¥è¦†ç›– ï¼ˆç¬¬ä¸€ç§æƒ…å†µï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (k == key) &#123;</span><br><span class="line">            e.value = value;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å¦‚æœå½“å‰Entryå¯¹è±¡å¯¹åº”Keyå€¼ä¸ºnull,åˆ™æ¸…ç©ºæ‰€æœ‰Keyä¸ºnullçš„æ•°æ®ï¼ˆç¬¬äºŒç§æƒ…å†µï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (k == <span class="literal">null</span>) &#123;</span><br><span class="line">            replaceStaleEntry(key, value, i);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ä»¥ä¸Šæƒ…å†µéƒ½ä¸æ»¡è¶³ï¼Œç›´æ¥æ·»åŠ ï¼ˆç¬¬ä¸‰ç§æƒ…å†µï¼‰</span></span><br><span class="line">    tab[i] = <span class="keyword">new</span> <span class="title class_">Entry</span>(key, value);</span><br><span class="line">    <span class="type">int</span> <span class="variable">sz</span> <span class="operator">=</span> ++size;</span><br><span class="line">    <span class="keyword">if</span> (!cleanSomeSlots(i, sz) &amp;&amp; sz &gt;= threshold)</span><br><span class="line">        rehash();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆæ ¹æ®keyé€šè¿‡å“ˆå¸Œç®—æ³•å¾—åˆ°å¯¹åº”çš„iï¼Œç„¶åå†å¼€å§‹ä»è¿™ä¸ªiå¼€å§‹éå†ï¼Œè¿›è¡Œåˆ¤æ–­ï¼Œç”±äºä¸‹é¢ä¸‰ä¸ªåˆ¤æ–­æ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ†å¼€æ¥è®²ã€‚</p><h4 id="ç¬¬ä¸€ç§æƒ…å†µ"><a href="#ç¬¬ä¸€ç§æƒ…å†µ" class="headerlink" title="ç¬¬ä¸€ç§æƒ…å†µ"></a>ç¬¬ä¸€ç§æƒ…å†µ</h4><p>è¿™ç§æƒ…å†µä¸‹ï¼Œkeyå€¼ç›¸åŒï¼Œå°±éœ€è¦å°†valueæ›¿æ¢æ‰ã€‚<br><img src="https://cdn.littlecorgi.top/mweb/2019-11-08/%E7%AC%AC%E4%B8%80%E7%A7%8D%E6%83%85%E5%86%B5.jpg" alt="ç¬¬ä¸€ç§æƒ…å†µ"></p><h4 id="ç¬¬äºŒç§æƒ…å†µ"><a href="#ç¬¬äºŒç§æƒ…å†µ" class="headerlink" title="ç¬¬äºŒç§æƒ…å†µ"></a>ç¬¬äºŒç§æƒ…å†µ</h4><p>è¿™ç§æƒ…å†µæ¯”è¾ƒå¤æ‚ï¼Œå…ˆçœ‹ä¸‹ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">replaceStaleEntry</span><span class="params">(ThreadLocal&lt;?&gt; key, Object value,</span></span><br><span class="line"><span class="params">                               <span class="type">int</span> staleSlot)</span> &#123;</span><br><span class="line">    Entry[] tab = table;</span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> tab.length;</span><br><span class="line">    Entry e;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> <span class="variable">slotToExpunge</span> <span class="operator">=</span> staleSlot;</span><br><span class="line">    <span class="comment">// å…ˆå¾€å‰è¿›è¡Œåˆ¤æ–­ï¼Œçœ‹æ˜¯å¦èƒ½æ‰¾åˆ°ç©ºçš„èŠ‚ç‚¹ï¼Œæ‰¾åˆ°äº†å°±æ›´æ–°slotToExpunge</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> prevIndex(staleSlot, len);</span><br><span class="line">         (e = tab[i]) != <span class="literal">null</span>;</span><br><span class="line">         i = prevIndex(i, len))</span><br><span class="line">        <span class="keyword">if</span> (e.get() == <span class="literal">null</span>)</span><br><span class="line">            slotToExpunge = i;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†å¾€åéå†</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> nextIndex(staleSlot, len);</span><br><span class="line">         (e = tab[i]) != <span class="literal">null</span>;</span><br><span class="line">         i = nextIndex(i, len)) &#123;</span><br><span class="line">        ThreadLocal&lt;?&gt; k = e.get();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰ièŠ‚ç‚¹çš„keyå’Œä¼ å…¥çš„keyç›¸åŒï¼Œé‚£å°±è¿›è¡Œæ›¿æ¢</span></span><br><span class="line">        <span class="keyword">if</span> (k == key) &#123;</span><br><span class="line">            e.value = value;</span><br><span class="line"></span><br><span class="line">            tab[i] = tab[staleSlot];</span><br><span class="line">            tab[staleSlot] = e;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             * å¦‚æœåœ¨æ•´ä¸ªæ‰«æè¿‡ç¨‹ä¸­ï¼ˆåŒ…æ‹¬å‡½æ•°ä¸€å¼€å§‹çš„å‘å‰æ‰«æä¸iä¹‹å‰çš„å‘åæ‰«æï¼‰</span></span><br><span class="line"><span class="comment">             * æ‰¾åˆ°äº†ä¹‹å‰çš„æ— æ•ˆslotåˆ™ä»¥é‚£ä¸ªä½ç½®ä½œä¸ºæ¸…ç†çš„èµ·ç‚¹ï¼Œ</span></span><br><span class="line"><span class="comment">             * å¦åˆ™åˆ™ä»¥å½“å‰çš„iä½œä¸ºæ¸…ç†èµ·ç‚¹</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">if</span> (slotToExpunge == staleSlot)</span><br><span class="line">                slotToExpunge = i;</span><br><span class="line">            <span class="comment">// è¿›è¡Œä¸€æ¬¡è¿ç»­æ®µçš„æ¸…ç†ï¼Œå†åšä¸€æ¬¡å¯å‘å¼æ¸…ç†</span></span><br><span class="line">            <span class="comment">// -&gt;&gt; åˆ†æ1</span></span><br><span class="line">            <span class="comment">// -&gt;&gt; åˆ†æ2</span></span><br><span class="line">            cleanSomeSlots(expungeStaleEntry(slotToExpunge), len);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰çš„slotå·²ç»æ— æ•ˆï¼Œå¹¶ä¸”å‘å‰æ‰«æè¿‡ç¨‹ä¸­æ²¡æœ‰æ— æ•ˆslotï¼Œåˆ™æ›´æ–°slotToExpungeä¸ºå½“å‰ä½ç½®</span></span><br><span class="line">        <span class="keyword">if</span> (k == <span class="literal">null</span> &amp;&amp; slotToExpunge == staleSlot)</span><br><span class="line">            slotToExpunge = i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœkeyåœ¨tableä¸­ä¸å­˜åœ¨ï¼Œåˆ™åœ¨åŸåœ°æ”¾ä¸€ä¸ªå³å¯</span></span><br><span class="line">    tab[staleSlot].value = <span class="literal">null</span>;</span><br><span class="line">    tab[staleSlot] = <span class="keyword">new</span> <span class="title class_">Entry</span>(key, value);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨æ¢æµ‹è¿‡ç¨‹ä¸­å¦‚æœå‘ç°ä»»ä½•æ— æ•ˆslotï¼Œåˆ™åšä¸€æ¬¡æ¸…ç†ï¼ˆè¿ç»­æ®µæ¸…ç†+å¯å‘å¼æ¸…ç†ï¼‰</span></span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ1</span></span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ2</span></span><br><span class="line">    <span class="keyword">if</span> (slotToExpunge != staleSlot)</span><br><span class="line">        cleanSomeSlots(expungeStaleEntry(slotToExpunge), len);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æ1ï¼šexpungeStaleEntry()</span></span><br><span class="line"><span class="comment"> * ä½œç”¨ï¼šæŠŠè¿ç»­æ®µå†…æ‰€æœ‰æ— æ•ˆçš„slotéƒ½æ¸…ç†ä¸€é</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="title function_">expungeStaleEntry</span><span class="params">(<span class="type">int</span> staleSlot)</span> &#123;</span><br><span class="line">    Entry[] tab = table;</span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> tab.length;</span><br><span class="line"></span><br><span class="line">    tab[staleSlot].value = <span class="literal">null</span>;</span><br><span class="line">    tab[staleSlot] = <span class="literal">null</span>;</span><br><span class="line">    size--;</span><br><span class="line"></span><br><span class="line">    Entry e;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = nextIndex(staleSlot, len);</span><br><span class="line">         (e = tab[i]) != <span class="literal">null</span>;</span><br><span class="line">         i = nextIndex(i, len)) &#123;</span><br><span class="line">        ThreadLocal&lt;?&gt; k = e.get();</span><br><span class="line">        <span class="keyword">if</span> (k == <span class="literal">null</span>) &#123;</span><br><span class="line">            e.value = <span class="literal">null</span>;</span><br><span class="line">            tab[i] = <span class="literal">null</span>;</span><br><span class="line">            size--;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">h</span> <span class="operator">=</span> k.threadLocalHashCode &amp; (len - <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (h != i) &#123;</span><br><span class="line">                tab[i] = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span> (tab[h] != <span class="literal">null</span>)</span><br><span class="line">                    h = nextIndex(h, len);</span><br><span class="line">                tab[h] = e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æ2ï¼šcleanSomeSlots()</span></span><br><span class="line"><span class="comment"> * ä½œç”¨ï¼šéå†åˆ é™¤æ‰€æœ‰ä½ç½®ä¸‹key==nullçš„æ•°æ®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">cleanSomeSlots</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">removed</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    Entry[] tab = table;</span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> tab.length;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        i = nextIndex(i, len);</span><br><span class="line">        <span class="type">Entry</span> <span class="variable">e</span> <span class="operator">=</span> tab[i];</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="literal">null</span> &amp;&amp; e.get() == <span class="literal">null</span>) &#123;</span><br><span class="line">            n = len;</span><br><span class="line">            removed = <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">// -&gt;&gt; åˆ†æ3</span></span><br><span class="line">            i = expungeStaleEntry(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">while</span> ( (n &gt;&gt;&gt;= <span class="number">1</span>) != <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> removed;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><img src="https://cdn.littlecorgi.top/mweb/2019-11-08/%E7%AC%AC%E4%BA%8C%E7%A7%8D%E6%83%85%E5%86%B5.jpg" alt="ç¬¬äºŒç§æƒ…å†µ"></p><h4 id="ç¬¬ä¸‰ç§æƒ…å†µ"><a href="#ç¬¬ä¸‰ç§æƒ…å†µ" class="headerlink" title="ç¬¬ä¸‰ç§æƒ…å†µ"></a>ç¬¬ä¸‰ç§æƒ…å†µ</h4><p>ç¬¬ä¸‰ç§æƒ…å†µå°±æ˜¯ä¸Šé¢ä¸¤ç§æƒ…å†µéƒ½ä¸æ»¡è¶³çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯éœ€è¦æ’å…¥çš„ä½ç½®ä¸ºnullçš„æ—¶å€™ï¼Œå°±ç›´æ¥æ‰©å¤§ThreadLocalMapï¼Œç„¶åå†æ’å…¥ï¼š<br><img src="https://cdn.littlecorgi.top/mweb/2019-11-08/%E7%AC%AC%E4%B8%89%E7%A7%8D%E6%83%85%E5%86%B5.jpg" alt="ç¬¬ä¸‰ç§æƒ…å†µ"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">tab[i] = <span class="keyword">new</span> <span class="title class_">Entry</span>(key, value);</span><br><span class="line"><span class="type">int</span> <span class="variable">sz</span> <span class="operator">=</span> ++size;</span><br><span class="line"><span class="comment">// -&gt;&gt; cleanSomeSlotsè§ä¸Šé¢ç¬¬äºŒç§æƒ…å†µçš„åˆ†æ2</span></span><br><span class="line"><span class="keyword">if</span> (!cleanSomeSlots(i, sz) &amp;&amp; sz &gt;= threshold)</span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ1</span></span><br><span class="line">    rehash();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æ1ï¼šrehash()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">rehash</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// -&gt;&gt; expungeStaleEntriesè§ä¸Šé¢ç¬¬äºŒç§æƒ…å†µçš„åˆ†æ1</span></span><br><span class="line">    expungeStaleEntries();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (size &gt;= threshold - threshold / <span class="number">4</span>)</span><br><span class="line">        <span class="comment">// -&gt;&gt; åˆ†æ2</span></span><br><span class="line">        resize();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æ2ï¼šresize()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">resize</span><span class="params">()</span> &#123;</span><br><span class="line">    Entry[] oldTab = table;</span><br><span class="line">    <span class="type">int</span> <span class="variable">oldLen</span> <span class="operator">=</span> oldTab.length;</span><br><span class="line">    <span class="type">int</span> <span class="variable">newLen</span> <span class="operator">=</span> oldLen * <span class="number">2</span>;</span><br><span class="line">    Entry[] newTab = <span class="keyword">new</span> <span class="title class_">Entry</span>[newLen];</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; oldLen; ++j) &#123;</span><br><span class="line">        <span class="type">Entry</span> <span class="variable">e</span> <span class="operator">=</span> oldTab[j];</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">            ThreadLocal&lt;?&gt; k = e.get();</span><br><span class="line">            <span class="keyword">if</span> (k == <span class="literal">null</span>) &#123;</span><br><span class="line">                e.value = <span class="literal">null</span>; <span class="comment">// Help the GC</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">h</span> <span class="operator">=</span> k.threadLocalHashCode &amp; (newLen - <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">while</span> (newTab[h] != <span class="literal">null</span>)</span><br><span class="line">                    h = nextIndex(h, newLen);</span><br><span class="line">                newTab[h] = e;</span><br><span class="line">                count++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    setThreshold(newLen);</span><br><span class="line">    size = count;</span><br><span class="line">    table = newTab;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ThreadLocalMap-getEntry"><a href="#ThreadLocalMap-getEntry" class="headerlink" title="ThreadLocalMap # getEntry()"></a>ThreadLocalMap # getEntry()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Entry <span class="title function_">getEntry</span><span class="params">(ThreadLocal&lt;?&gt; key)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> key.threadLocalHashCode &amp; (table.length - <span class="number">1</span>);</span><br><span class="line">    <span class="type">Entry</span> <span class="variable">e</span> <span class="operator">=</span> table[i];</span><br><span class="line">    <span class="keyword">if</span> (e != <span class="literal">null</span> &amp;&amp; e.get() == key)</span><br><span class="line">        <span class="keyword">return</span> e;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="comment">// -&gt;&gt; åˆ†æ1</span></span><br><span class="line">        <span class="keyword">return</span> getEntryAfterMiss(key, i, e);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æ1ï¼šgetEntryAfterMiss()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> Entry <span class="title function_">getEntryAfterMiss</span><span class="params">(ThreadLocal&lt;?&gt; key, <span class="type">int</span> i, Entry e)</span> &#123;</span><br><span class="line">    Entry[] tab = table;</span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> tab.length;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»å½“å‰å¾€åä¸€ä¸ªä¸ªè¿›è¡Œéå†ï¼Œç›´è‡³æ‰¾åˆ°å’Œkeyç›¸ç­‰çš„ç„¶åè¿”å›</span></span><br><span class="line">    <span class="keyword">while</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">        ThreadLocal&lt;?&gt; k = e.get();</span><br><span class="line">        <span class="keyword">if</span> (k == key)</span><br><span class="line">            <span class="keyword">return</span> e;</span><br><span class="line">        <span class="keyword">if</span> (k == <span class="literal">null</span>)</span><br><span class="line">            expungeStaleEntry(i);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            i = nextIndex(i, len);</span><br><span class="line">        e = tab[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ThreadLocalMap-remove"><a href="#ThreadLocalMap-remove" class="headerlink" title="ThreadLocalMap # remove()"></a>ThreadLocalMap # remove()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(ThreadLocal&lt;?&gt; key)</span> &#123;</span><br><span class="line">    Entry[] tab = table;</span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> tab.length;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> key.threadLocalHashCode &amp; (len-<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">Entry</span> <span class="variable">e</span> <span class="operator">=</span> tab[i];</span><br><span class="line">         e != <span class="literal">null</span>;</span><br><span class="line">         e = tab[i = nextIndex(i, len)]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (e.get() == key) &#123;</span><br><span class="line">            <span class="comment">// æ˜¾å¼æ–­å¼€å¼±å¼•ç”¨</span></span><br><span class="line">            e.clear();</span><br><span class="line">            expungeStaleEntry(i);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Android/">Android</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Handler/">Handler</category>
      
      <category domain="https://www.littlecorgi.top/tags/ThreadLocal/">ThreadLocal</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E6%BA%90%E7%A0%81/">æºç </category>
      
      
      <comments>https://www.littlecorgi.top/posts/64f0a9f6.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Viewçš„äº‹ä»¶åˆ†å‘</title>
      <link>https://www.littlecorgi.top/posts/bfb9e8a9.html</link>
      <guid>https://www.littlecorgi.top/posts/bfb9e8a9.html</guid>
      <pubDate>Thu, 31 Oct 2019 14:58:27 GMT</pubDate>
      
        
        
          
          
      <description></description>
          
        
      
      
      
      <content:encoded><![CDATA[<p>ä»æˆ‘åˆšè¿›å®éªŒå®¤çš„æ—¶å€™ï¼Œå­¦é•¿å­¦å§å°±è¯´Viewçš„äº‹ä»¶åˆ†å‘æœºåˆ¶æ˜¯Androidé‡Œé¢ä¸€ä¸ªå¾ˆé‡è¦çš„å†…å®¹ï¼Œè¦æˆ‘ä»¬å¥½å¥½å­¦ã€‚</p><p>ä½†æ˜¯éšç€è‡ªå·±å¯¹Androidäº†è§£çš„æ·±å…¥ï¼Œè¶Šå‘è§‰å¾—è¿™ä¸ªä¸œè¥¿å¾ˆæœ‰å¿…è¦äº†è§£ä¸‹ï¼Œæ­£å¥½Androidè‰ºæœ¯å¼€å‘æ¢ç´¢ä¹Ÿçœ‹åˆ°äº†Viewè¿™å—ï¼Œä¹Ÿçœ‹äº†<a href="https://blog.csdn.net/guolin_blog/article/details/9097463">éƒ­éœ–å¤§ç¥çš„åšå®¢</a>å’Œ<a href="https://www.jianshu.com/p/ea0108d8510e">å¦ä¸€ä½å¤§ç¥çš„åšå®¢</a>ï¼Œæ‰€ä»¥å°±å¥½å¥½å­¦ä¹ äº†ä¸€ç•ªï¼Œå¹¶å†™äº†æ­¤åšå®¢ã€‚</p><h1 id="1-MotionEvent"><a href="#1-MotionEvent" class="headerlink" title="1. MotionEvent"></a>1. MotionEvent</h1><p>åœ¨å¼€å§‹è®²Viewäº‹ä»¶åˆ†å‘ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸‹MotionEventã€‚</p><p>è¿™ä¸ªå°±æ˜¯æ‰‹æŒ‡è§£é™¤åˆ°å±å¹•åæ‰€äº§ç”Ÿçš„ä¸€ç³»åˆ—äº‹ä»¶ï¼Œä¸»è¦ä¸ºä¸€ä¸‹ä¸‰ä¸ªå…¸å‹äº‹ä»¶ï¼š</p><ul><li>ACTION_DOWMâ€”â€”æ‰‹æŒ‡åˆšæ¥è§¦å±å¹•</li><li>ACTION_MOVEâ€”â€”æ‰‹æŒ‡åœ¨å±å¹•ä¸Šç§»åŠ¨</li><li>ACTION_UPâ€”â€”æ‰‹æŒ‡ä»å±å¹•ä¸Šæ¾å¼€</li><li>ACTION_CANCELâ€”â€”ç»“æŸäº‹ä»¶ï¼ˆéäººä¸ºï¼‰</li></ul><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸€æ¬¡æ‰‹æŒ‡è§¦æ‘¸å±å¹•ç„¶åç¦»å¼€å¯èƒ½è§¦å‘ä¸€ä¸‹ä¸¤ç§æƒ…å†µï¼š</p><ul><li>ç‚¹å‡»å±å¹•ç„¶åæ¾å¼€ï¼šACTION_DOWN -&gt; ACTION_UP</li><li>ç‚¹å‡»å±å¹•ç„¶åæ»‘åŠ¨å†æ¾å¼€ï¼šACTION_DOWN -&gt; ACTION_MOVE -&gt; ACTION_UP</li></ul><p>ä¸‹é¢ä¸€ä¸ªå›¾ç‰‡æ¥æ¦‚æ‹¬ä¸‹ï¼š<br><img src="https://cdn.littlecorgi.top/mweb/2019-10-31/MotionEvent.png" alt="MotionEvent"></p><h1 id="2-äº‹ä»¶åˆ†å‘ä¼ é€’è§„åˆ™"><a href="#2-äº‹ä»¶åˆ†å‘ä¼ é€’è§„åˆ™" class="headerlink" title="2. äº‹ä»¶åˆ†å‘ä¼ é€’è§„åˆ™"></a>2. äº‹ä»¶åˆ†å‘ä¼ é€’è§„åˆ™</h1><p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒAndroidUIæ˜¯ç”±Activityã€ViewGroupã€ViewåŠå…¶æ´¾ç”Ÿç±»ç»„æˆçš„ã€‚</p><p>å¤§è‡´ç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><img src="https://cdn.littlecorgi.top/mweb/2019-10-31/AndroidUI.jpg" alt="AndroidUI"></p><p>å…¶ä¸­ï¼š</p><ul><li>Activityï¼šæ§åˆ¶ç”Ÿå‘½å‘¨æœŸæˆ–è€…å¤„ç†äº‹ä»¶</li><li>ViewGroupï¼šä¸€ç»„Viewæˆ–è€…å¤šä¸ªViewçš„é›†åˆã€‚ä¹Ÿæ˜¯å¸ƒå±€Layoutçš„åŸºç±»ã€‚ä½†æ˜¯ç‰¹åˆ«çš„æ˜¯ï¼Œä»–ä¹Ÿé›†æˆè‡ªViewã€‚</li><li>Viewï¼šæ‰€æœ‰UIç»„ä»¶çš„åŸºç±»</li></ul><p>ä»ä¸Šå›¾æˆ‘ä»¬å°±å¯ä»¥çœ‹å‡ºæ¥ï¼Œäº‹ä»¶åˆ†å‘çš„é¡ºåºå°±æ˜¯ï¼šActivity -&gt; ViewGroup -&gt; Viewã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªç‚¹å‡»äº‹ä»¶äº§ç”Ÿï¼Œå…ˆäº¤ç”±Activityï¼Œå†ä¼ åˆ°ViewGroupï¼Œå†ä¼ åˆ°Viewã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­åªè¦æœ‰ä¸€ä¸ªéƒ¨åˆ†è¯´è¦æ‹¦æˆªï¼Œå°±ä¸ä¼šå†ç»§ç»­å¾€ä¸‹ä¼ é€’ã€‚</p><h1 id="3-äº‹ä»¶åˆ†å‘çš„æ ¸å¿ƒæ–¹æ³•"><a href="#3-äº‹ä»¶åˆ†å‘çš„æ ¸å¿ƒæ–¹æ³•" class="headerlink" title="3. äº‹ä»¶åˆ†å‘çš„æ ¸å¿ƒæ–¹æ³•"></a>3. äº‹ä»¶åˆ†å‘çš„æ ¸å¿ƒæ–¹æ³•</h1><p>å…¶å®æ—¶é—´åˆ†å‘çš„æ ¸å¿ƒæ–¹æ³•å¾ˆç®€å•ï¼Œå°±ç”±ä¸‰ä¸ªæ–¹æ³•ç»„æˆï¼š</p><ul><li>public boolean dispatchTouchEvent(MotionEvent ev)<br>ç”¨æ¥è¿›è¡Œäº‹ä»¶çš„åˆ†å‘ã€‚å¦‚æœäº‹ä»¶èƒ½å¤Ÿä¼ é€’ç»™å½“å‰Viewï¼Œé‚£ä¹ˆæ­¤æ–¹æ³•ä¸€å®šä¼šè¢«è°ƒç”¨ï¼Œè¿”å›ç»“æœå—å½“å‰Viewçš„onTouchEventå’Œä¸‹çº§Viewçš„dispatchTouchEventæ–¹æ³•çš„å½±å“ï¼Œè¡¨ç¤ºæ˜¯å¦æ¶ˆè€—å½“å‰äº‹ä»¶ã€‚</li><li><p>public boolean onInterceptTouchEvent(MotionEvent event)<br>åœ¨dispatchTouchEventæ–¹æ³•å†…éƒ¨è°ƒç”¨ï¼Œç”¨æ¥åˆ¤æ–­æ˜¯å¦æ‹¦æˆªæŸä¸ªäº‹ä»¶ï¼Œå¦‚æœå½“å‰Viewæ‹¦æˆªäº†æŸä¸ªäº‹ä»¶ï¼Œé‚£ä¹ˆåœ¨åŒä¸€äº‹ä»¶åºåˆ—å½“ä¸­ï¼Œæ­¤æ–¹æ³•ä¸ä¼šå†æ¬¡è¢«è°ƒç”¨ï¼Œè¿”å›ç»“æœè¡¨ç¤ºæ˜¯å¦æ‹¦æˆªå½“å‰äº‹ä»¶ã€‚ï¼ˆåªæœ‰ViewGroupä¸­æ‰æœ‰æ­¤æ–¹æ³•ï¼ŒViewä¸­æ²¡æœ‰ï¼‰</p></li><li><p>public boolean onTouchEvent(MotionEvent event)<br>åœ¨dispatchTouchEventæ–¹æ³•ä¸­è°ƒç”¨ï¼Œç”¨æ¥å¤„ç†ç‚¹å‡»äº‹ä»¶ï¼Œè¿”å›ç»“æœè¡¨ç¤ºæ˜¯å¦æ¶ˆè€—å½“å‰äº‹ä»¶ï¼Œå¦‚æœä¸æ¶ˆè€—ï¼Œåˆ™åœ¨åŒä¸€ä¸ªäº‹ä»¶åºåˆ—ä¸­ï¼Œå½“å‰Viewæ— æ³•å†æ¬¡æ¥æ”¶åˆ°äº‹ä»¶ã€‚</p></li></ul><p>ä¸‰ä¸ªæ–¹æ³•é—´çš„å…³ç³»å¯ä»¥æŒ‰ä¸‹é¢ä¸€æ®µä¼ªä»£ç è¡¨ç¤ºï¼šï¼ˆ<a href="https://www.jianshu.com/p/ea0108d8510e">å‚è€ƒ</a>çš„ä»£ç ï¼‰<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * ç‚¹å‡»äº‹ä»¶äº§ç”Ÿå </span></span><br><span class="line"><span class="comment">  */</span> </span><br><span class="line">  <span class="comment">// æ­¥éª¤1ï¼šè°ƒç”¨dispatchTouchEventï¼ˆï¼‰</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">consume</span> <span class="operator">=</span> <span class="literal">false</span>; <span class="comment">//ä»£è¡¨ æ˜¯å¦ä¼šæ¶ˆè´¹äº‹ä»¶</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ­¥éª¤2ï¼šåˆ¤æ–­æ˜¯å¦æ‹¦æˆªäº‹ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (onInterceptTouchEvent(ev)) &#123;</span><br><span class="line">      <span class="comment">// a. è‹¥æ‹¦æˆªï¼Œåˆ™å°†è¯¥äº‹ä»¶äº¤ç»™å½“å‰Viewè¿›è¡Œå¤„ç†</span></span><br><span class="line">      <span class="comment">// å³è°ƒç”¨onTouchEvent (ï¼‰æ–¹æ³•å»å¤„ç†ç‚¹å‡»äº‹ä»¶</span></span><br><span class="line">        consume = onTouchEvent (ev) ;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// b. è‹¥ä¸æ‹¦æˆªï¼Œåˆ™å°†è¯¥äº‹ä»¶ä¼ é€’åˆ°ä¸‹å±‚</span></span><br><span class="line">      <span class="comment">// å³ ä¸‹å±‚å…ƒç´ çš„dispatchTouchEventï¼ˆï¼‰å°±ä¼šè¢«è°ƒç”¨ï¼Œé‡å¤ä¸Šè¿°è¿‡ç¨‹</span></span><br><span class="line">      <span class="comment">// ç›´åˆ°ç‚¹å‡»äº‹ä»¶è¢«æœ€ç»ˆå¤„ç†ä¸ºæ­¢</span></span><br><span class="line">      consume = child.dispatchTouchEvent (ev) ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ­¥éª¤3ï¼šæœ€ç»ˆè¿”å›é€šçŸ¥ è¯¥äº‹ä»¶æ˜¯å¦è¢«æ¶ˆè´¹ï¼ˆæ¥æ”¶ &amp; å¤„ç†ï¼‰</span></span><br><span class="line">    <span class="keyword">return</span> consume;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å¯¹äºä¸€ä¸ªæ ¹ViewGroupï¼Œç‚¹å‡»äº‹ä»¶äº§ç”Ÿåï¼Œå°±ä¼šä¼ é€’ç»™ä»–ï¼Œè¿™æ—¶ä»–çš„dispatchTouchEventå°±ä¼šè¢«è°ƒç”¨ï¼Œç„¶åå°±å¼€å§‹åˆ¤æ–­ä»–æ˜¯å¦æ‹¦æˆªã€‚å¦‚æœæ‹¦æˆªï¼Œé‚£ä¹ˆç‚¹å‡»äº‹ä»¶å°±ä¼šç»™ViewGroupå»å¤„ç†ï¼Œå¦‚æœä¸æ‹¦æˆªï¼Œå°±è°ƒç”¨child.dispatchTouchEvent (ev) ä¼ ç»™å­æ§ä»¶çš„dispatchTouchEventæ–¹æ³•ã€‚ç„¶åç»§ç»­å¾ªç¯ï¼Œç›´åˆ°åˆ°æœ€åº•å±‚viewï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰childçš„æ—¶å€™ï¼Œæˆ–è€…ç›´åˆ°äº‹ä»¶è¢«æ‹¦æˆªã€‚</p><h1 id="4-æºç åˆ†æ"><a href="#4-æºç åˆ†æ" class="headerlink" title="4. æºç åˆ†æ"></a>4. æºç åˆ†æ</h1><h2 id="4-1-Activityäº‹ä»¶åˆ†å‘"><a href="#4-1-Activityäº‹ä»¶åˆ†å‘" class="headerlink" title="4.1 Activityäº‹ä»¶åˆ†å‘"></a>4.1 Activityäº‹ä»¶åˆ†å‘</h2><p>é¦–å…ˆå…ˆæ¥çœ‹dispatchTouchEventæ–¹æ³•ï¼š</p><h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (ev.getAction() == MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">        onUserInteraction();</span><br><span class="line">        <span class="comment">// -&gt;&gt; åˆ†æ1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (getWindow().superDispatchTouchEvent(ev)) &#123;</span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ2</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> onTouchEvent(ev);</span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ5</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * åˆ†æ1ï¼šonUserInteraction()</span></span><br><span class="line"><span class="comment">  * è¿™ä¸ªæ–¹æ³•å°±æ˜¯ä¸ªç©ºæ–¹æ³•ï¼Œä½†æ˜¯æˆ‘æ˜¯åœ¨æ²¡ææ‡‚è¿™ä¸ªæ–¹æ³•æ˜¯å¹²å˜›çš„ï¼Œæ‰€ä»¥å°±ç›´æ¥ç²˜è´´äº†carsonè¿™ä½å¤§ç¥çš„è¯´æ˜</span></span><br><span class="line"><span class="comment">  * ä½œç”¨ï¼šå®ç°å±ä¿åŠŸèƒ½</span></span><br><span class="line"><span class="comment">  * æ³¨ï¼š</span></span><br><span class="line"><span class="comment">  *    a. è¯¥æ–¹æ³•ä¸ºç©ºæ–¹æ³•</span></span><br><span class="line"><span class="comment">  *    b. å½“æ­¤activityåœ¨æ ˆé¡¶æ—¶ï¼Œè§¦å±ç‚¹å‡»æŒ‰homeï¼Œbackï¼Œmenué”®ç­‰éƒ½ä¼šè§¦å‘æ­¤æ–¹æ³•</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onUserInteraction</span><span class="params">()</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * åˆ†æ2ï¼šgetWindow().superDispatchTouchEvent(ev)</span></span><br><span class="line"><span class="comment">  * ç‚¹å¼€ä¹‹åè¿›å…¥Windowç±»ï¼Œ</span></span><br><span class="line"><span class="comment">  * ä½†æ˜¯å‘ç°è¿™ä¸ªç±»æ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ä¸ªæŠ½è±¡æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * äº†è§£è¿‡Viewçš„åŒå­¦éƒ½çŸ¥é“ï¼ŒWindowçš„å”¯ä¸€å®ç°ç±»å°±æ˜¯PhoneWindow</span></span><br><span class="line"><span class="comment">  * é‚£æˆ‘ä»¬è¿›å…¥PhoneWindowçœ‹ä¸‹ä»–çš„superDispatchTouchEventæ–¹æ³•</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">boolean</span> <span class="title function_">superDispatchTouchEvent</span><span class="params">(MotionEvent event)</span>;</span><br><span class="line"><span class="comment">// -&gt;&gt; åˆ†æ3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * åˆ†æ3ï¼šPhoneWindow.superDispatchTouchEvent()</span></span><br><span class="line"><span class="comment">  * å®é™…ä¸Šåˆè°ƒç”¨äº†DecorViewçš„superDispatchTouchEventæ–¹æ³•ï¼ŒDecorViewæ˜¯æœ€é¡¶å±‚çš„View</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">superDispatchTouchEvent</span><span class="params">(MotionEvent event)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> mDecor.superDispatchTouchEvent(event);</span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ4</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æ4ï¼šDecorView.superDispatchTouchEvent()</span></span><br><span class="line"><span class="comment"> * æ³¨ï¼š</span></span><br><span class="line"><span class="comment"> *     a. DecorViewç»§æ‰¿è‡ªFrameLayoutï¼Œè€ŒFrameLayoutç»§æ‰¿è‡ªViewGroupï¼Œä¹Ÿå°±æ˜¯è¯´DecorViewå°±æ˜¯ViewGroupã€‚</span></span><br><span class="line"><span class="comment"> *     b. DecorViewè°ƒç”¨äº†çˆ¶ç±»çš„dispatchTouchEventæ–¹æ³•ï¼Œä¹Ÿå°±ç›¸å½“äºViewGroupçš„dispatchTouchEventæ–¹æ³•ï¼Œå°±æŠŠäº‹ä»¶äº¤ç»™äº†ViewGroupå»å¤„ç†ï¼Œè¿™å—åé¢å†è¯´</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">superDispatchTouchEvent</span><span class="params">(MotionEvent event)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.dispatchTouchEvent(event);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æ5ï¼šreturn onTouchEvent(ev)</span></span><br><span class="line"><span class="comment"> * å½“è§¦æ‘¸å±äº‹ä»¶æœªç”±å…¶ä¸‹çš„ä»»ä½•è§†å›¾å¤„ç†æ—¶è°ƒç”¨</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onTouchEvent</span><span class="params">(MotionEvent event)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (mWindow.shouldCloseOnTouch(<span class="built_in">this</span>, event)) &#123;</span><br><span class="line">    <span class="comment">// -&gt;&gt; åˆ†æ6</span></span><br><span class="line">        finish();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// åªæœ‰åœ¨ç‚¹å‡»äº‹ä»¶åœ¨Windowè¾¹ç•Œå¤–æ‰ä¼šè¿”å›trueï¼Œä¸€èˆ¬æƒ…å†µéƒ½è¿”å›falseï¼Œåˆ†æå®Œæ¯•</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * åˆ†æ6ï¼šWindow.shouldCloseOnTouch()</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * è¿”å›ï¼š</span></span><br><span class="line"><span class="comment"> *         è¿”å›trueï¼šè¯´æ˜äº‹ä»¶åœ¨è¾¹ç•Œå¤–ï¼Œå³ æ¶ˆè´¹äº‹ä»¶</span></span><br><span class="line"><span class="comment"> *         è¿”å›falseï¼šæœªæ¶ˆè´¹ï¼ˆé»˜è®¤ï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">shouldCloseOnTouch</span><span class="params">(Context context, MotionEvent event)</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">isOutside</span> <span class="operator">=</span></span><br><span class="line">            event.getAction() == MotionEvent.ACTION_DOWN &amp;&amp; isOutOfBounds(context, event)</span><br><span class="line">            || event.getAction() == MotionEvent.ACTION_OUTSIDE;</span><br><span class="line">    <span class="comment">// ä¸»è¦æ˜¯å¯¹äºå¤„ç†è¾¹ç•Œå¤–ç‚¹å‡»äº‹ä»¶çš„åˆ¤æ–­ï¼šæ˜¯å¦æ˜¯DOWNäº‹ä»¶ï¼Œeventçš„åæ ‡æ˜¯å¦åœ¨è¾¹ç•Œå†…ç­‰</span></span><br><span class="line">    <span class="keyword">if</span> (mCloseOnTouchOutside &amp;&amp; peekDecorView() != <span class="literal">null</span> &amp;&amp; isOutside) &#123;</span><br><span class="line">        <span class="comment">// peekDecorViewæ˜¯è¿”å›PhoneWindowçš„mDecor</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h3><p><img src="https://cdn.littlecorgi.top/mweb/2019-10-31/Activity%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%E6%B5%81%E7%A8%8B.jpg" alt="Activityäº‹ä»¶åˆ†å‘æµç¨‹"></p><h2 id="4-2-ViewGroupäº‹ä»¶åˆ†å‘"><a href="#4-2-ViewGroupäº‹ä»¶åˆ†å‘" class="headerlink" title="4.2 ViewGroupäº‹ä»¶åˆ†å‘"></a>4.2 ViewGroupäº‹ä»¶åˆ†å‘</h2><h3 id="æºç -1"><a href="#æºç -1" class="headerlink" title="æºç "></a>æºç </h3><p>ç”±äºæ­¤éƒ¨åˆ†ä»£ç è¿‡é•¿ï¼Œæˆ‘ä»¬å°†ä»£ç æ‹†åˆ†æˆä¸¤éƒ¨åˆ†ï¼š</p><h4 id="part1"><a href="#part1" class="headerlink" title="part1"></a>part1</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> &#123;</span><br><span class="line">    ...<span class="comment">// ä»…è´´å‡ºå…³é”®ä»£ç </span></span><br><span class="line">    </span><br><span class="line">    <span class="type">boolean</span> <span class="variable">handled</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * onFilterTouchEventForSecurity(ev)</span></span><br><span class="line"><span class="comment">     * ç­›é€‰touchäº‹ä»¶ï¼Œè¿›å»ä¹‹åçš„åˆ¤æ–­æ ¸å¿ƒå°±æ˜¯å½“å‰è§†å›¾æ˜¯å¦è¢«å…¶å®ƒçª—å£é®æŒ¡æˆ–è€…éšè—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">if</span> (onFilterTouchEventForSecurity(ev)) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">action</span> <span class="operator">=</span> ev.getAction();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">actionMasked</span> <span class="operator">=</span> action &amp; MotionEvent.ACTION_MASK;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Handle an initial down.</span></span><br><span class="line">        <span class="comment">// -&gt;&gt; åˆ†æ1</span></span><br><span class="line">        <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">            <span class="comment">// Throw away all previous state when starting a new touch gesture.</span></span><br><span class="line">            <span class="comment">// The framework may have dropped the up or cancel event for the previous gesture</span></span><br><span class="line">            <span class="comment">// due to an app switch, ANR, or some other state change.</span></span><br><span class="line">            cancelAndClearTouchTargets(ev);</span><br><span class="line">            resetTouchState();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Check for interception.</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">boolean</span> intercepted;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * åˆ†æ2</span></span><br><span class="line"><span class="comment">         * å¯ä»¥çœ‹åˆ°ä¼šæœ‰ä¸¤ç§æƒ…å†µä¸‹æ‹¦æˆªäº‹ä»¶ï¼šäº‹ä»¶ç±»å‹ä¸ºDOWNï¼Œæˆ–è€…mFirstTouchTarget != nullã€‚</span></span><br><span class="line"><span class="comment">         * é‚£ä¹ˆè¿™ä¸ªmFirstTouchTargetæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</span></span><br><span class="line"><span class="comment">         * ä»åé¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œå½“ViewGroupä¸æ‹¦æˆªäº‹ä»¶äº¤ç»™å­å…ƒç´ å¤„ç†çš„æ—¶å€™ï¼ŒmFirstTouchTargetä¸ä¸ºnullã€‚</span></span><br><span class="line"><span class="comment">         * æ‰€ä»¥ï¼Œä¹Ÿå°±æ˜¯è¯´å½“MotionEventä¸ºUPæˆ–è€…MOVEçš„æ—¶å€™ï¼Œéƒ½è¿›ä¸å»è¿™ä¸ªæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ä¸è°ƒç”¨ViewGroupçš„onInterceptTouchEventï¼Œä»–ä¸æ‹¦æˆªäº‹ä»¶</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN</span><br><span class="line">                || mFirstTouchTarget != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">disallowIntercept</span> <span class="operator">=</span> (mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT) != <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (!disallowIntercept) &#123;</span><br><span class="line">                intercepted = onInterceptTouchEvent(ev);</span><br><span class="line">                ev.setAction(action); <span class="comment">// restore action in case it was changed</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                intercepted = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// There are no touch targets and this action is not an initial down</span></span><br><span class="line">            <span class="comment">// so this view group continues to intercept touches.</span></span><br><span class="line">            intercepted = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æ1</span></span><br><span class="line"><span class="comment"> * äº‹ä»¶å¼€å§‹æ—¶ä¼šè°ƒç”¨resetTouchState()æ¥æ¸…ç©ºmFirstAndClearTouchTarget</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">    cancelAndClearTouchTargets(ev);</span><br><span class="line">    <span class="comment">// æ ¸å¿ƒç›®çš„å°±æ˜¯æ¸…ç©ºmFirstAndClearTouchTarget</span></span><br><span class="line">    resetTouchState();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="part2"><a href="#part2" class="headerlink" title="part2"></a>part2</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">        ...<span class="comment">//çœç•¥ä¸­é—´ä»£ç </span></span><br><span class="line">        <span class="comment">// è¿›å…¥ifè¯­å¥ï¼Œåˆ¤æ–­æ¡ä»¶ä¸ºæ²¡æœ‰å¯¹äº‹ä»¶è¿›è¡Œæ‹¦æˆªï¼ŒåŒæ—¶äº‹ä»¶æ²¡æœ‰ç»“æŸã€‚å¯¹ViewGroupçš„å­å…ƒç´ è¿›è¡Œéå†</span></span><br><span class="line">        <span class="keyword">if</span> (!canceled &amp;&amp; !intercepted) &#123;</span><br><span class="line">        </span><br><span class="line">            ...<span class="comment">//ç»§ç»­çœç•¥ä¸­é—´ä»£ç </span></span><br><span class="line">            </span><br><span class="line">                    <span class="comment">// å¾—åˆ°æ‰€æœ‰çš„å­View</span></span><br><span class="line">                    <span class="keyword">final</span> View[] children = mChildren;</span><br><span class="line">                    <span class="comment">// å¯¹å­Viewè¿›è¡Œéå†</span></span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> childrenCount - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">                        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">childIndex</span> <span class="operator">=</span> getAndVerifyPreorderedIndex(</span><br><span class="line">                                childrenCount, i, customOrder);</span><br><span class="line">                        <span class="keyword">final</span> <span class="type">View</span> <span class="variable">child</span> <span class="operator">=</span> getAndVerifyPreorderedView(</span><br><span class="line">                                preorderedList, children, childIndex);</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// If there is a view that has accessibility focus we want it</span></span><br><span class="line">                        <span class="comment">// to get the event first and if not handled we will perform a</span></span><br><span class="line">                        <span class="comment">// normal dispatch. We may do a double iteration but this is</span></span><br><span class="line">                        <span class="comment">// safer given the timeframe.</span></span><br><span class="line">                        <span class="comment">// è¯¥viewgroupè®¾ç½®äº‹ä»¶äº†æŒ‡å‘ç„¦ç‚¹Viewå¹¶ä¸”ç„¦ç‚¹Viewåœ¨å‰é¢å·²ç»æ‰¾åˆ°äº†</span></span><br><span class="line">                        <span class="keyword">if</span> (childWithAccessibilityFocus != <span class="literal">null</span>) &#123;</span><br><span class="line">                            <span class="comment">// åˆ¤æ–­éå†çš„æ­¤Viewæ˜¯å¦æ˜¯ç„¦ç‚¹Viewï¼Œå¦‚æœä¸æ˜¯å°±ç›´æ¥ä¸‹ä¸€éå¾ªç¯</span></span><br><span class="line">                            <span class="keyword">if</span> (childWithAccessibilityFocus != child) &#123;</span><br><span class="line">                                <span class="keyword">continue</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="comment">// å¦‚æœæ˜¯çš„è¯å°±å°†æ‰¾åˆ°çš„ç„¦ç‚¹viewç½®ç©º</span></span><br><span class="line">                            <span class="comment">// iå›åˆ°åˆ°æ•°ç¬¬ä¸€ä¸ªä¸‹æ ‡</span></span><br><span class="line">                            <span class="comment">// è¿™æ ·åšçš„ç›®çš„æ˜¯å…ˆè®©è¯¥ç„¦ç‚¹viewå°è¯•è¿›è¡Œä¸‹é¢çš„æ™®é€šåˆ†å‘æ“ä½œ</span></span><br><span class="line">                            <span class="comment">// å¦‚æœæˆåŠŸäº†ï¼Œä¼šåœ¨ä¸‹é¢è·³å‡ºå¾ªç¯ã€‚</span></span><br><span class="line">                            <span class="comment">// å¦‚æœä¸æˆåŠŸï¼Œå°±å°†è®°å½•çš„ç„¦ç‚¹viewç½®ç©ºï¼Œ</span></span><br><span class="line">                            <span class="comment">// ä»æœ€åä¸€ä¸ªå¼€å§‹é‡æ–°éå†ï¼Œä¸å†è¿›å…¥è¿™ä¸ªåˆ¤æ–­ã€‚</span></span><br><span class="line">                            childWithAccessibilityFocus = <span class="literal">null</span>;</span><br><span class="line">                            i = childrenCount - <span class="number">1</span>;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// åˆ¤æ–­å½“å‰å­Viewæ˜¯å¦èƒ½è·å–ç„¦ç‚¹æˆ–è€…æ˜¯å¦æ­£åœ¨åšåŠ¨ç”»</span></span><br><span class="line">                        <span class="keyword">if</span> (!canViewReceivePointerEvents(child)</span><br><span class="line">                                || !isTransformedTouchPointInView(x, y, child, <span class="literal">null</span>)) &#123;</span><br><span class="line">                            ev.setTargetAccessibilityFocus(<span class="literal">false</span>);</span><br><span class="line">                            <span class="keyword">continue</span>;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        newTouchTarget = getTouchTarget(child);</span><br><span class="line">                        <span class="keyword">if</span> (newTouchTarget != <span class="literal">null</span>) &#123;</span><br><span class="line">                            <span class="comment">// Child is already receiving touch within its bounds.</span></span><br><span class="line">                            <span class="comment">// Give it the new pointer in addition to the ones it is handling.</span></span><br><span class="line">                            newTouchTarget.pointerIdBits |= idBitsToAssign;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        resetCancelNextUpFlag(child);</span><br><span class="line">                        <span class="comment">// -&gt;&gt; åˆ†æ1</span></span><br><span class="line">                        <span class="keyword">if</span> (dispatchTransformedTouchEvent(ev, <span class="literal">false</span>, child, idBitsToAssign)) &#123;</span><br><span class="line">                            <span class="comment">// Child wants to receive touch within its bounds.</span></span><br><span class="line">                            mLastTouchDownTime = ev.getDownTime();</span><br><span class="line">                            <span class="keyword">if</span> (preorderedList != <span class="literal">null</span>) &#123;</span><br><span class="line">                                <span class="comment">// childIndex points into presorted list, find original index</span></span><br><span class="line">                                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; childrenCount; j++) &#123;</span><br><span class="line">                                    <span class="keyword">if</span> (chifcldren[childIndex] == mChildren[j]) &#123;</span><br><span class="line">                                        mLastTouchDownIndex = j;</span><br><span class="line">                                        <span class="keyword">break</span>;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                mLastTouchDownIndex = childIndex;</span><br><span class="line">                            &#125;</span><br><span class="line">                            mLastTouchDownX = ev.getX();</span><br><span class="line">                            mLastTouchDownY = ev.getY();</span><br><span class="line">                            <span class="comment">// -&gt;&gt; åˆ†æ2</span></span><br><span class="line">                            newTouchTarget = addTouchTarget(child, idBitsToAssign);</span><br><span class="line">                            alreadyDispatchedToNewTouchTarget = <span class="literal">true</span>;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// The accessibility focus didn&#x27;t handle the event, so clear</span></span><br><span class="line">                        <span class="comment">// the flag and do a normal dispatch to all children.</span></span><br><span class="line">                        ev.setTargetAccessibilityFocus(<span class="literal">false</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                  </span><br><span class="line">                  ... <span class="comment">//çœç•¥</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æ1 dispatchTransformedTouchEvent()</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * æ ¸å¿ƒå°±æ˜¯é‚£ä¸ªif (child == null)ã€‚</span></span><br><span class="line"><span class="comment"> * å¦‚æœchildä¸ä¸ºç©ºï¼Œé‚£ä¹ˆäº‹ä»¶å°±äº¤ç»™å­Viewå¤„ç†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">dispatchTransformedTouchEvent</span><span class="params">(MotionEvent event, <span class="type">boolean</span> cancel,</span></span><br><span class="line"><span class="params">        View child, <span class="type">int</span> desiredPointerIdBits)</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">boolean</span> handled;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Canceling motions is a special case.  We don&#x27;t need to perform any transformations</span></span><br><span class="line">    <span class="comment">// or filtering.  The important part is the action, not the contents.</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">oldAction</span> <span class="operator">=</span> event.getAction();</span><br><span class="line">    <span class="keyword">if</span> (cancel || oldAction == MotionEvent.ACTION_CANCEL) &#123;</span><br><span class="line">        event.setAction(MotionEvent.ACTION_CANCEL);</span><br><span class="line">        <span class="keyword">if</span> (child == <span class="literal">null</span>) &#123;</span><br><span class="line">            handled = <span class="built_in">super</span>.dispatchTouchEvent(event);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            handled = child.dispatchTouchEvent(event);</span><br><span class="line">        &#125;</span><br><span class="line">        event.setAction(oldAction);</span><br><span class="line">        <span class="keyword">return</span> handled;</span><br><span class="line">    &#125;</span><br><span class="line">    ...<span class="comment">//çœç•¥</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æ2</span></span><br><span class="line"><span class="comment"> * å¦‚æœå­Viewèƒ½å¤„ç†ç‚¹å‡»äº‹ä»¶ï¼Œé‚£ä¹ˆå°±è°ƒç”¨addTouchTargetæ–¹æ³•ï¼Œå¯¹mFirstTouchTargetæ–¹æ³•è¿›è¡Œå¤åˆ¶ï¼Œç„¶åå†è¿›å…¥part1ä¸­åˆ†æ2ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> TouchTarget <span class="title function_">addTouchTarget</span><span class="params">(<span class="meta">@NonNull</span> View child, <span class="type">int</span> pointerIdBits)</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">TouchTarget</span> <span class="variable">target</span> <span class="operator">=</span> TouchTarget.obtain(child, pointerIdBits);</span><br><span class="line">    target.next = mFirstTouchTarget;</span><br><span class="line">    mFirstTouchTarget = target;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="part3"><a href="#part3" class="headerlink" title="part3"></a>part3</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">        <span class="comment">// Dispatch to touch targets.</span></span><br><span class="line">        <span class="comment">// å¦‚æœpart2å¼€å¤´çš„é‚£ä¸ªifæ²¡æœ‰è¿›ï¼Œä¹Ÿå°±æ˜¯å¯¹äº‹ä»¶è¿›è¡Œæ‹¦æˆªçš„è¯ï¼Œç›´æ¥åˆ°è¿™æ¥</span></span><br><span class="line">        <span class="comment">// å¹¶ä¸”å¦‚æœæ²¡æœ‰è¿›å…¥part2ï¼Œé‚£ä¹ˆmFirstTouchTargetä»ç„¶ä¸ºç©ºï¼Œé‚£ä¹ˆå°±è¿›å…¥if</span></span><br><span class="line">        <span class="keyword">if</span> (mFirstTouchTarget == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// No touch targets so treat this as an ordinary view.</span></span><br><span class="line">            <span class="comment">// æ­¤å¤„åœ¨ä¸Šé¢åˆ†æè¿‡äº†ï¼Œä½†æ˜¯ä¸åŒçš„æ˜¯ç”±äºchildç›´æ¥ä¼ å…¥äº†nullï¼Œé‚£ä¹ˆå°±æ‰§è¡Œsuper.dispatchTouchEvenã€‚</span></span><br><span class="line">            <span class="comment">// é‚£ä¹ˆsuperæ˜¯è°å‘¢ï¼Ÿæˆ‘ä»¬åœ¨å‰é¢è¯´è¿‡ï¼ŒViewGroupæ˜¯ç»§æ‰¿è‡ªViewçš„ï¼Œé‚£ä¹ˆä»–å°±æ˜¯æ‰§è¡ŒViewçš„dispatchTouchEventã€‚</span></span><br><span class="line">            handled = dispatchTransformedTouchEvent(ev, canceled, <span class="literal">null</span>,</span><br><span class="line">                    TouchTarget.ALL_POINTER_IDS);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ... <span class="comment">//çœç•¥</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Update list of touch targets for pointer up or cancel, if needed.</span></span><br><span class="line">        <span class="keyword">if</span> (canceled</span><br><span class="line">                || actionMasked == MotionEvent.ACTION_UP</span><br><span class="line">                || actionMasked == MotionEvent.ACTION_HOVER_MOVE) &#123;</span><br><span class="line">                <span class="comment">// -&gt;&gt; åˆ†æ1</span></span><br><span class="line">            resetTouchState();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_UP) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">actionIndex</span> <span class="operator">=</span> ev.getActionIndex();</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">idBitsToRemove</span> <span class="operator">=</span> <span class="number">1</span> &lt;&lt; ev.getPointerId(actionIndex);</span><br><span class="line">            removePointersFromTouchTargets(idBitsToRemove);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...<span class="comment">//çœç•¥</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æ1</span></span><br><span class="line"><span class="comment"> * åœ¨åŒä¸€äº‹ä»¶ç³»åˆ—ç»“æŸåè°ƒç”¨resetTouchState();</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">resetTouchState</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// å¯¹mFirstTouchTargetæ¸…ç©ºè¿˜åŸ</span></span><br><span class="line">    clearTouchTargets();</span><br><span class="line">    resetCancelNextUpFlag(<span class="built_in">this</span>);</span><br><span class="line">    mGroupFlags &amp;= ~FLAG_DISALLOW_INTERCEPT;</span><br><span class="line">    mNestedScrollAxes = SCROLL_AXIS_NONE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµç¨‹-1"><a href="#æµç¨‹-1" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h3><p>æ­¤å›¾æ¬è‡ª<a href="https://www.jianshu.com/p/38015afcdb58">Carson_Hoå¤§ä½¬çš„åšå®¢</a><br><img src="https://cdn.littlecorgi.top/mweb/2019-10-31/15725314562031.jpg" alt=""></p><h2 id="4-3-Viewäº‹ä»¶åˆ†å‘"><a href="#4-3-Viewäº‹ä»¶åˆ†å‘" class="headerlink" title="4.3 Viewäº‹ä»¶åˆ†å‘"></a>4.3 Viewäº‹ä»¶åˆ†å‘</h2><h3 id="æºç -2"><a href="#æºç -2" class="headerlink" title="æºç "></a>æºç </h3><h4 id="dispatchTouchEvent"><a href="#dispatchTouchEvent" class="headerlink" title="dispatchTouchEvent"></a>dispatchTouchEvent</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">dispatchTouchEvent</span><span class="params">(MotionEvent event)</span> &#123;</span><br><span class="line">    ...<span class="comment">//çœç•¥</span></span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    ...<span class="comment">//çœç•¥</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å’ŒViewGroupä¸€æ ·çš„åˆ¤æ–­ï¼Œåˆ¤æ–­å½“å‰è§†å›¾æ˜¯å¦è¢«é®æŒ¡æˆ–è€…ä¸å¯è§</span></span><br><span class="line">    <span class="keyword">if</span> (onFilterTouchEventForSecurity(event)) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((mViewFlags &amp; ENABLED_MASK) == ENABLED &amp;&amp; handleScrollBarDragging(event)) &#123;</span><br><span class="line">            result = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//noinspection SimplifiableIfStatement</span></span><br><span class="line">        <span class="type">ListenerInfo</span> <span class="variable">li</span> <span class="operator">=</span> mListenerInfo;</span><br><span class="line">        <span class="comment">// æ£€æµ‹æœ‰æ²¡æœ‰è®¾ç½®OnTOuchListenerï¼Œå¦‚æœæœ‰ï¼Œå¹¶ä¸”onTouchæ–¹æ³•è¿”å›trueé‚£ä¹ˆè¿›å…¥ifï¼Œç»“æœå¯¼è‡´onTouchEventä¸è¢«æ‰§è¡Œ</span></span><br><span class="line">        <span class="keyword">if</span> (li != <span class="literal">null</span> &amp;&amp; li.mOnTouchListener != <span class="literal">null</span></span><br><span class="line">                &amp;&amp; (mViewFlags &amp; ENABLED_MASK) == ENABLED</span><br><span class="line">                &amp;&amp; li.mOnTouchListener.onTouch(<span class="built_in">this</span>, event)) &#123;</span><br><span class="line">                </span><br><span class="line">            result = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœæ²¡è¿›å…¥ä¸Šé¢çš„ifï¼Œä¹Ÿå°±ç›¸å½“äºæ²¡æœ‰è®¾ç½®OnTouchListenerï¼Œé‚£ä¹ˆæ‰§è¡ŒonTOuchEvent</span></span><br><span class="line">        <span class="keyword">if</span> (!result &amp;&amp; onTouchEvent(event)) &#123;</span><br><span class="line">            result = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...<span class="comment">//çœç•¥</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œ<strong>onTouchçš„ä¼˜å…ˆçº§é«˜äºonTouchEvent</strong>ã€‚</p><h4 id="onTouchEvent"><a href="#onTouchEvent" class="headerlink" title="onTouchEvent"></a>onTouchEvent</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onTouchEvent</span><span class="params">(MotionEvent event)</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">float</span> <span class="variable">x</span> <span class="operator">=</span> event.getX();</span><br><span class="line">    <span class="keyword">final</span> <span class="type">float</span> <span class="variable">y</span> <span class="operator">=</span> event.getY();</span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">viewFlags</span> <span class="operator">=</span> mViewFlags;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">action</span> <span class="operator">=</span> event.getAction();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ³¨é‡Š1 </span></span><br><span class="line"><span class="comment">     * åªæœ‰åœ¨Clickã€LongClickã€contextClickéƒ½ä¸å¯ç”¨çš„æ—¶å€™æ‰ä¸ºfalse</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">clickable</span> <span class="operator">=</span> ((viewFlags &amp; CLICKABLE) == CLICKABLE</span><br><span class="line">            || (viewFlags &amp; LONG_CLICKABLE) == LONG_CLICKABLE)</span><br><span class="line">            || (viewFlags &amp; CONTEXT_CLICKABLE) == CONTEXT_CLICKABLE;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é¦–å…ˆåˆ¤æ–­æ˜¯ä¸æ˜¯ä¸å¯ç”¨ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿›å…¥if</span></span><br><span class="line">    <span class="keyword">if</span> ((viewFlags &amp; ENABLED_MASK) == DISABLED) &#123;</span><br><span class="line">        <span class="keyword">if</span> (action == MotionEvent.ACTION_UP &amp;&amp; (mPrivateFlags &amp; PFLAG_PRESSED) != <span class="number">0</span>) &#123;</span><br><span class="line">            setPressed(<span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        mPrivateFlags3 &amp;= ~PFLAG3_FINGER_DOWN;</span><br><span class="line">        <span class="comment">// A disabled view that is clickable still consumes the touch</span></span><br><span class="line">        <span class="comment">// events, it just doesn&#x27;t respond to them.</span></span><br><span class="line">        <span class="comment">// -&gt;&gt; æ³¨é‡Š1ï¼ˆè§ä¸Šé¢ğŸ‘†ï¼‰</span></span><br><span class="line">        <span class="keyword">return</span> clickable;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœViewæœ‰ä»£ç†ä¼šæ‰§è¡Œè¿™ä¸ªæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">if</span> (mTouchDelegate != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mTouchDelegate.onTouchEvent(event)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¿™å—æˆ‘ä»¬åªè°ƒå‡ºACTION_UPæ¥çœ‹</span></span><br><span class="line">    <span class="comment">// åªè¦clickableä¸ºtrue(è§ä¸Šé¢æ³¨é‡Š1ğŸ‘†)æˆ–è€…TOOLTIP(å¯èƒ½æ˜¯Android8.0æ–°å‡ºçš„æç¤ºåŠŸèƒ½å§)</span></span><br><span class="line">    <span class="keyword">if</span> (clickable || (viewFlags &amp; TOOLTIP) == TOOLTIP) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (action) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line"></span><br><span class="line">                ...<span class="comment">//çœç•¥</span></span><br><span class="line">                </span><br><span class="line">                    <span class="keyword">if</span> (!mHasPerformedLongPress &amp;&amp; !mIgnoreNextUpEvent) &#123;</span><br><span class="line">                        <span class="comment">// This is a tap, so remove the longpress check</span></span><br><span class="line">                        removeLongPressCallback();</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// Only perform take click actions if we were in the pressed state</span></span><br><span class="line">                        <span class="keyword">if</span> (!focusTaken) &#123;</span><br><span class="line">                            <span class="comment">// Use a Runnable and post this rather than calling</span></span><br><span class="line">                            <span class="comment">// performClick directly. This lets other visual state</span></span><br><span class="line">                            <span class="comment">// of the view update before click actions start.</span></span><br><span class="line">                            <span class="keyword">if</span> (mPerformClick == <span class="literal">null</span>) &#123;</span><br><span class="line">                                mPerformClick = <span class="keyword">new</span> <span class="title class_">PerformClick</span>();</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">if</span> (!post(mPerformClick)) &#123;</span><br><span class="line">                                <span class="comment">// -&gt;&gt; åˆ†æ1</span></span><br><span class="line">                                performClickInternal();</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    ... <span class="comment">//çœç•¥</span></span><br><span class="line">                    </span><br><span class="line">                &#125;</span><br><span class="line">                mIgnoreNextUpEvent = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            </span><br><span class="line">            ... <span class="comment">//çœç•¥å…¶å®ƒå‡ ç§MotionEvent</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç”±ä»£ç å¯çŸ¥åªè¦ä¸Šé¢çš„ifè¯­å¥æˆç«‹ï¼Œä¸ç®¡è¿›å…¥switchä¸­çš„ä»»ä½•ACTIONæˆ–æ˜¯éƒ½ä¸è¿›å…¥ï¼Œè¿”å›å€¼éƒ½æ˜¯trueï¼Œå³äº‹ä»¶æ¶ˆè´¹äº†ã€‚</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * åˆ†æ1ï¼šperformClickï¼ˆï¼‰</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">performClick</span><span class="params">()</span> &#123;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (mOnClickListener != <span class="literal">null</span>) &#123;  </span><br><span class="line">        playSoundEffect(SoundEffectConstants.CLICK);  </span><br><span class="line">        mOnClickListener.onClick(<span class="built_in">this</span>);  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;  </span><br><span class="line">        <span class="comment">// åªè¦æˆ‘ä»¬é€šè¿‡setOnClickListenerï¼ˆï¼‰ä¸ºæ§ä»¶cvViewæ³¨å†Œ1ä¸ªç‚¹å‡»äº‹ä»¶</span></span><br><span class="line">        <span class="comment">// é‚£ä¹ˆå°±ä¼šç»™mOnClickListenerå˜é‡èµ‹å€¼ï¼ˆå³ä¸ä¸ºç©ºï¼‰</span></span><br><span class="line">        <span class="comment">// åˆ™ä¼šå¾€ä¸‹å›è°ƒonClickï¼ˆï¼‰ &amp; performClickï¼ˆï¼‰è¿”å›true</span></span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;  </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h3 id="æµç¨‹-2"><a href="#æµç¨‹-2" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h3><p><img src="https://cdn.littlecorgi.top/mweb/2019-10-31/15725337657670.jpg" alt=""></p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Android/">Android</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/View/">View</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E6%BA%90%E7%A0%81/">æºç </category>
      
      <category domain="https://www.littlecorgi.top/tags/%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91/">äº‹ä»¶åˆ†å‘</category>
      
      
      <comments>https://www.littlecorgi.top/posts/bfb9e8a9.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>OpenGL ES 2.0ç¬”è®°2â€”â€”é¡¶ç‚¹ã€åæ ‡ã€å›¾å…ƒ</title>
      <link>https://www.littlecorgi.top/posts/268eb1c2.html</link>
      <guid>https://www.littlecorgi.top/posts/268eb1c2.html</guid>
      <pubDate>Fri, 18 Oct 2019 13:06:38 GMT</pubDate>
      
      <description>&lt;blockquote&gt;
&lt;p&gt;ä¸ŠèŠ‚æˆ‘ä»¬å¯¹OpenGLåšäº†ä¸€ä¸ªå¤§è‡´çš„ä»‹ç»ï¼Œå¹¶å†™äº†ä¸€ä¸ªåŸºæœ¬æ¡†æ¶ï¼Œåœ¨è¿™èŠ‚ä¸­æˆ‘ä»¬å°†ä¼šä»‹ç»é¡¶ç‚¹ã€åæ ‡ç³»å’Œå›¾å…ƒ&lt;/p&gt;
&lt;/blockquote&gt;</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>ä¸ŠèŠ‚æˆ‘ä»¬å¯¹OpenGLåšäº†ä¸€ä¸ªå¤§è‡´çš„ä»‹ç»ï¼Œå¹¶å†™äº†ä¸€ä¸ªåŸºæœ¬æ¡†æ¶ï¼Œåœ¨è¿™èŠ‚ä¸­æˆ‘ä»¬å°†ä¼šä»‹ç»é¡¶ç‚¹ã€åæ ‡ç³»å’Œå›¾å…ƒ</p></blockquote><span id="more"></span><h1 id="é¡¶ç‚¹"><a href="#é¡¶ç‚¹" class="headerlink" title="é¡¶ç‚¹"></a>é¡¶ç‚¹</h1><p>åœ¨OpenGLä¸­ï¼Œæ‰€æœ‰çš„ä¸œè¥¿çš„ç»“æ„éƒ½æ˜¯ä»ä¸€ä¸ªé¡¶ç‚¹å¼€å§‹çš„ã€‚</p><p>æ‰€è°“é¡¶ç‚¹ï¼Œå°±æ˜¯ä¸€ä¸ªå‡ ä½•å›¾å½¢çš„æ‹ç‚¹ã€‚åœ¨ä»‹ç»é¡¶ç‚¹ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆä»‹ç»ä¸‹OpenGLåæ ‡ã€‚</p><h2 id="OpenGLåæ ‡ç³»"><a href="#OpenGLåæ ‡ç³»" class="headerlink" title="OpenGLåæ ‡ç³»"></a>OpenGLåæ ‡ç³»</h2><p>å¦‚æœæœ‰ä¼šAndroidå¼€å‘çš„æœ‹å‹ï¼Œä¸€å®šä¼šé»˜è®¤ä¸ºä»å±å¹•çš„å·¦ä¸Šè§’å¼€å§‹ï¼Œæ°´å¹³å¾€å³æ˜¯xè½´ï¼Œç«–ç›´å‘ä¸‹æ˜¯yè½´ã€‚</p><p>ä½†æ˜¯åœ¨OpenGLä¸­æ˜¯ä¸åŒçš„ï¼ŒOpenGLæ˜¯ä»æ˜¾ç¤ºè§†çª—çš„æ­£ä¸­å¿ƒæ˜¯ä¸­å¿ƒï¼Œä¹Ÿå°±æ˜¯$(0, 0)$ï¼Œè€Œå±å¹•æœ€å·¦è¾¹çš„xè½´åæ ‡æ˜¯-1ï¼Œå±å¹•æœ€å³è¾¹çš„xè½´åæ ‡æ˜¯1ï¼Œå±å¹•æœ€ä¸Šé¢çš„yè½´åæ ‡æ˜¯1ï¼Œå±å¹•æœ€ä¸‹é¢çš„yè½´åæ ‡æ˜¯-1ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢è¿™å¹…å›¾ï¼š</p><p><img src="https://cdn.littlecorgi.top/mweb/2019-10-18/opengl_coordinate.png" alt="opengl_coordinate"></p><h2 id="åœ¨ä»£ç ä¸­å®šä¹‰é¡¶ç‚¹"><a href="#åœ¨ä»£ç ä¸­å®šä¹‰é¡¶ç‚¹" class="headerlink" title="åœ¨ä»£ç ä¸­å®šä¹‰é¡¶ç‚¹"></a>åœ¨ä»£ç ä¸­å®šä¹‰é¡¶ç‚¹</h2><p>åœ¨OpenGLä¸­å®šä¹‰é¡¶ç‚¹æœ‰ç‚¹ç‰¹æ®Šï¼Œæˆ‘ä»¬ç¬¬ä¸€ååº”éƒ½æ˜¯ç›´æ¥æ‹¿æ•°ç»„å°†é¡¶ç«¯å­˜èµ·æ¥å°±è¡Œäº†ï¼Œä½†æ˜¯åœ¨OpenGLä¸­ï¼Œä½ é™¤äº†è¦å°†é¡¶ç‚¹çš„åæ ‡ç”¨æ•°ç»„å­˜èµ·æ¥ä»¥å¤–ï¼Œè¿˜å¾—å®šä¹‰ä¸€ä¸ªå¸¸é‡ï¼Œç”¨æ¥æ ‡è®°ä¸€ä¸ªé¡¶ç‚¹æœ‰ä¸¤ä¸ªåˆ†é‡ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">POSITION_COMPONENT_COUNT</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"><span class="type">float</span>[] tableVerticesWithTriangles = &#123;</span><br><span class="line">    <span class="comment">// Triangle 1</span></span><br><span class="line">    -<span class="number">0.5f</span>, -<span class="number">0.5f</span>, </span><br><span class="line">    <span class="number">0.5f</span>,  <span class="number">0.5f</span>,</span><br><span class="line">    -<span class="number">0.5f</span>,  <span class="number">0.5f</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Triangle 2</span></span><br><span class="line">    -<span class="number">0.5f</span>, -<span class="number">0.5f</span>, </span><br><span class="line">    <span class="number">0.5f</span>, -<span class="number">0.5f</span>, </span><br><span class="line">    <span class="number">0.5f</span>,  <span class="number">0.5f</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Line 1</span></span><br><span class="line">    -<span class="number">0.5f</span>, <span class="number">0f</span>, </span><br><span class="line">    <span class="number">0.5f</span>, <span class="number">0f</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Mallets</span></span><br><span class="line">    <span class="number">0f</span>, -<span class="number">0.25f</span>, </span><br><span class="line">    <span class="number">0f</span>,  <span class="number">0.25f</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>æˆ‘ä»¬é‡‡ç”¨æµ®ç‚¹æ•°çš„é¡ºåºåˆ—è¡¨å®šä¹‰é¡¶ç‚¹æ•°æ®ï¼Œè¿™ä¸ªæ•°ç»„é€šå¸¸è¢«æˆä¸ºé¡¶ç‚¹å±æ€§ã€‚</p><h1 id="å›¾å…ƒ"><a href="#å›¾å…ƒ" class="headerlink" title="å›¾å…ƒ"></a>å›¾å…ƒ</h1><p>åœ¨OpenGLä¸­ï¼Œåªèƒ½ç»˜åˆ¶ç‚¹ã€ç›´çº¿å’Œä¸‰è§’å½¢ï¼Œè¿™ä¸‰ä¸ªä¹Ÿè¢«ç§°ä¸ºå›¾å…ƒã€‚</p><p>ä¹Ÿå°±æ„å‘³ç€ï¼Œå…¶å®ƒæ‰€æœ‰çš„å›¾å½¢éƒ½å¾—é€šè¿‡è¿™ä¸‰ä¸ªåŸºæœ¬å›¾å…ƒæ¥å®ç°ã€‚</p><p>å¦‚æœæˆ‘ä»¬éœ€è¦ç»˜åˆ¶ä¸€ä¸ªç‚¹ï¼Œé‚£ä¹ˆä¸€ä¸ªåæ ‡å°±å¯ä»¥äº†ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬éœ€è¦ç»˜åˆ¶ä¸€æ¡ç›´çº¿ï¼Œå°±éœ€è¦ä¸¤ä¸ªåæ ‡ï¼Œå¦‚æœç»˜åˆ¶ä¸€ä¸ªä¸‰è§’å½¢ï¼Œå°±éœ€è¦ä¸‰ä¸ªåæ ‡ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬å°±ä»¥ç»˜åˆ¶ä¸€ä¸ªæ­£æ–¹å½¢ä¸¾ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span>[] squareVerticesWithTriangles = &#123;</span><br><span class="line">    -<span class="number">0.5f</span>, -<span class="number">0.5f</span>, </span><br><span class="line">    <span class="number">0.5f</span>,  <span class="number">0.5f</span>,</span><br><span class="line">    -<span class="number">0.5f</span>,  <span class="number">0.5f</span>,</span><br><span class="line">    <span class="number">0.5f</span>, -<span class="number">0.5f</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.littlecorgi.top/mweb/2019-10-18/%E5%9D%90%E6%A0%87.png" alt="åæ ‡"></p><p>å¦‚æœæˆ‘è¦åœ¨è¿™ä¸ªæ­£æ–¹å½¢ä¸­é—´åŠ ä¸€ä¸ªæ¨ªçº¿çš„è¯ï¼Œé‚£ä¹ˆå°±ç›´æ¥åœ¨ä¸Šé¢çš„æ•°ç»„é‡Œé¢å»åŠ ï¼Œåˆ°æ—¶å€™è¦å°†é¡¶ç‚¹ç€è‰²å™¨åŠ è½½åˆ°å›¾å½¢ä¸­çš„æ—¶å€™å†å»å¤„ç†ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span>[] squareVerticesWithTriangles = &#123;</span><br><span class="line">    <span class="comment">// Square</span></span><br><span class="line">    -<span class="number">0.5f</span>, -<span class="number">0.5f</span>, </span><br><span class="line">    <span class="number">0.5f</span>,  <span class="number">0.5f</span>,</span><br><span class="line">    -<span class="number">0.5f</span>,  <span class="number">0.5f</span>,</span><br><span class="line">    <span class="number">0.5f</span>, -<span class="number">0.5f</span>,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Line</span></span><br><span class="line">    -<span class="number">0.5f</span>, <span class="number">0</span>,</span><br><span class="line">    <span class="number">0.5f</span>, <span class="number">0</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p><img src="https://cdn.littlecorgi.top/mweb/2019-10-18/%E7%BA%BF%E6%AD%A3%E6%96%B9%E5%BD%A2%E5%9D%90%E6%A0%87.png" alt="çº¿æ­£æ–¹å½¢åæ ‡"></p><h1 id="è®©æ•°æ®å¯ä»¥è¢«OpenGLè¯»å–"><a href="#è®©æ•°æ®å¯ä»¥è¢«OpenGLè¯»å–" class="headerlink" title="è®©æ•°æ®å¯ä»¥è¢«OpenGLè¯»å–"></a>è®©æ•°æ®å¯ä»¥è¢«OpenGLè¯»å–</h1><p>åœ¨ä¸Šé¢ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†é¡¶ç‚¹çš„å®šä¹‰ï¼Œä½†æ˜¯ç°åœ¨OpenGLå°šè¿˜ä¸èƒ½è¯»å–ä»–ä»¬ã€‚å…¶åŸå› æ˜¯è¿™äº›ä»£ç çš„è¿è¡Œç¯å¢ƒä¸OpenGLè¿è¡Œç¯å¢ƒä½¿ç”¨äº†ä¸ä¸€æ ·çš„è¯­è¨€ã€‚</p><p>å½“æˆ‘ä»¬è¿è¡ŒJavaè¯­è¨€çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯ç›´æ¥è¿è¡Œåœ¨ç¡¬ä»¶ä¸Šçš„ï¼Œè€Œæ˜¯è¿è¡Œåœ¨JVM(çº¯Java)æˆ–è€…Dalvik(Android)è™šæ‹Ÿæœºä¸Šçš„ï¼Œå¹¶ä¸”è¿è¡Œåœ¨è¿™äº›è™šæ‹Ÿæœºä¸Šçš„æ—¶å€™ï¼Œå¹¶ä¸èƒ½ç›´æ¥è®¿é—®æœ¬åœ°ç¯å¢ƒï¼›å…¶æ¬¡ï¼Œè™šæ‹Ÿæœºè¿˜é‡‡ç”¨çš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå½“æ£€æµ‹åˆ°å˜é‡ã€å¯¹è±¡ä¸å†è¢«ä½¿ç”¨æ—¶ï¼Œå°±è‡ªåŠ¨é‡Šæ”¾æ‰è¿™äº›å†…å­˜ã€‚</p><p>ä½†æ˜¯æœ¬åœ°ç¯å¢ƒä¸èƒ½è¿™æ ·ï¼Œå› ä¸ºä»–æ˜¯ç›´æ¥è¿è¡Œåœ¨ç¡¬ä»¶ä¸Šçš„ï¼Œä»–ä¸å¸Œæœ›å†…å­˜ä¼šè¢«ç§»æ¥ç§»å»æˆ–è€…è‡ªåŠ¨é‡Šæ”¾ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªæ–¹æ¡ˆï¼Œè®©Androidç¨‹åºä¸OpenGLè¿›è¡Œé€šä¿¡ã€‚<br>å…¶å®Androidä»£ç ä¸ç¡¬ä»¶é€šä¿¡æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><ol><li>é€šè¿‡JNIæŠ€æœ¯ï¼›</li><li>é€šè¿‡è°ƒç”¨android.opengl.GLES20åŒ…é‡Œé¢çš„æ–¹æ³•ã€‚</li></ol><p>æˆ‘ä»¬è¿™å—ä¸»è¦æ˜¯é€šè¿‡ç¬¬äºŒç§æ–¹æ³•ã€‚</p><p>Javaä¸­æœ‰ä¸€ç§ç‰¹æ®Šçš„é›†åˆï¼Œå¯ä»¥åˆ†é…æœ¬åœ°çš„å†…å­˜å—ï¼Œå¹¶å°†Javaçš„æ•°æ®å¤åˆ¶åˆ°æœ¬åœ°å†…å­˜ã€‚ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å› ä¸ºJavaä¸­å›½ä¸€ä¸ªFloatå‹æ•°æ®å 4ä¸ªå­—èŠ‚</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BYTES_PER_FLOAT</span> <span class="operator">=</span> <span class="number">4</span>;</span><br><span class="line"><span class="comment">// å£°æ˜ä¸€ä¸ªå­—èŠ‚ç¼“å†²åŒº</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> FloatBuffer vertexData;</span><br><span class="line"> </span><br><span class="line">vertexData = ByteBuffer</span><br><span class="line">    <span class="comment">// åˆ†é…ä¸€å—æœ¬åœ°å†…å­˜ï¼Œæ‰€ä»¥æ˜¯æ•°ç»„é•¿åº¦ * ç±»å‹æ‰€å å­—èŠ‚</span></span><br><span class="line">    .allocateDirect(tableVerticesWithTriangles.length * BYTES_PER_FLOAT)</span><br><span class="line">    <span class="comment">// æŒ‰ç…§æœ¬åœ°å­—èŠ‚åºç»„ç»‡å†…å®¹</span></span><br><span class="line">    .order(ByteOrder.nativeOrder())</span><br><span class="line">    .asFloatBuffer();</span><br><span class="line">    <span class="comment">// å°†æ•°æ®å­˜å…¥</span></span><br><span class="line">    .put(tableVerticesWithTriangles);</span><br></pre></td></tr></table></figure></p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/OpenGL/">OpenGL</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/OpenGL/">OpenGL</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/">å›¾åƒå¤„ç†</category>
      
      
      <comments>https://www.littlecorgi.top/posts/268eb1c2.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>OpenGL ES 2.0ç¬”è®°1â€”â€”ç®€ä»‹</title>
      <link>https://www.littlecorgi.top/posts/a92b4a54.html</link>
      <guid>https://www.littlecorgi.top/posts/a92b4a54.html</guid>
      <pubDate>Thu, 17 Oct 2019 02:43:11 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;OpenGLæ˜¯ä»€ä¹ˆï¼ŸOpenGL-ESåˆæ˜¯ä»€ä¹ˆï¼Ÿ&quot;&gt;&lt;a href=&quot;#OpenGLæ˜¯ä»€ä¹ˆï¼ŸOpenGL-ESåˆæ˜¯ä»€ä¹ˆï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;OpenGLæ˜¯ä»€ä¹ˆï¼ŸOpenGL ESåˆæ˜¯ä»€ä¹ˆï¼Ÿ&quot;&gt;&lt;/a&gt;OpenGLæ˜¯ä»€ä¹ˆï¼ŸOpenGL ESåˆæ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h1&gt;&lt;h2 id=&quot;ç®€ä»‹&quot;&gt;&lt;a href=&quot;#ç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;ç®€ä»‹&quot;&gt;&lt;/a&gt;ç®€ä»‹&lt;/h2&gt;&lt;p&gt;OpenGLæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„è½¯ä»¶æ¥å£è¯­è¨€ï¼Œç”¨äºè°ƒç”¨ç¡¬ä»¶çš„2Dã€3Då›¾å½¢å¤„ç†å™¨ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œå—é™äºç°åœ¨çš„ç§»åŠ¨è®¾å¤‡æ€§èƒ½ï¼Œå¦‚æœå°†OpenGLç›´æ¥ç”¨åœ¨ä»–ä»¬ä¸Šé¢å°†ä¼šç‰¹åˆ«å¡ï¼Œäºæ˜¯å°±å‡ºç°äº†OpenGL ESã€‚ OpenGL ESæ˜¯OpenGLçš„åˆ†æ”¯ï¼Œä»–ä¸“é—¨ä½œç”¨äºåµŒå…¥å¼è®¾å¤‡ï¼Œå»æ‰äº†OpenGLå¾ˆå¤šä¸å¿…è¦çš„åŠŸèƒ½ã€‚&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="OpenGLæ˜¯ä»€ä¹ˆï¼ŸOpenGL-ESåˆæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#OpenGLæ˜¯ä»€ä¹ˆï¼ŸOpenGL-ESåˆæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="OpenGLæ˜¯ä»€ä¹ˆï¼ŸOpenGL ESåˆæ˜¯ä»€ä¹ˆï¼Ÿ"></a>OpenGLæ˜¯ä»€ä¹ˆï¼ŸOpenGL ESåˆæ˜¯ä»€ä¹ˆï¼Ÿ</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>OpenGLæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„è½¯ä»¶æ¥å£è¯­è¨€ï¼Œç”¨äºè°ƒç”¨ç¡¬ä»¶çš„2Dã€3Då›¾å½¢å¤„ç†å™¨ã€‚</p><p>ç„¶è€Œå—é™äºç°åœ¨çš„ç§»åŠ¨è®¾å¤‡æ€§èƒ½ï¼Œå¦‚æœå°†OpenGLç›´æ¥ç”¨åœ¨ä»–ä»¬ä¸Šé¢å°†ä¼šç‰¹åˆ«å¡ï¼Œäºæ˜¯å°±å‡ºç°äº†OpenGL ESã€‚ OpenGL ESæ˜¯OpenGLçš„åˆ†æ”¯ï¼Œä»–ä¸“é—¨ä½œç”¨äºåµŒå…¥å¼è®¾å¤‡ï¼Œå»æ‰äº†OpenGLå¾ˆå¤šä¸å¿…è¦çš„åŠŸèƒ½ã€‚</p><span id="more"></span><h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><ul><li>æ¸¸æˆ</li><li>è§†é¢‘æ’­æ”¾å™¨</li><li>è§†é¢‘ç¼–è¾‘åº”ç”¨</li><li>å›¾ç‰‡ç¼–è¾‘åº”ç”¨</li></ul><p>ç­‰å¯¹å›¾åƒå¤„ç†çš„åŠæ—¶æ€§è¦æ±‚è¾ƒé«˜çš„åº”ç”¨åœºæ™¯ã€‚</p><h2 id="Androidå¯¹OpenGL-ES-çš„æ”¯æŒ"><a href="#Androidå¯¹OpenGL-ES-çš„æ”¯æŒ" class="headerlink" title="Androidå¯¹OpenGL ES çš„æ”¯æŒ"></a>Androidå¯¹OpenGL ES çš„æ”¯æŒ</h2><div class="table-container"><table><thead><tr><th style="text-align:center">OpenGL ES ç‰ˆæœ¬</th><th style="text-align:center">åŸºäºOpenGLçš„ç‰ˆæœ¬</th><th style="text-align:center">Androidå¼•å…¥çš„ç‰ˆæœ¬</th><th style="text-align:center">å…¼å®¹æ€§</th><th style="text-align:center">åŠŸèƒ½ã€ç‰¹è‰²</th></tr></thead><tbody><tr><td style="text-align:center">1.0&amp;1.1</td><td style="text-align:center">1.3&amp;1.5</td><td style="text-align:center">Android 1.0</td><td style="text-align:center">-</td><td style="text-align:center">å›ºå®šçš„å›¾åƒç®¡é“ï¼Œå¼€å‘éš¾åº¦ç›¸æ¯”2.0ä½</td></tr><tr><td style="text-align:center">2.0</td><td style="text-align:center">2.0</td><td style="text-align:center">Android 2.2</td><td style="text-align:center">ä¸å…¼å®¹1.x</td><td style="text-align:center">å¯ç¼–ç¨‹çš„æ¸²æŸ“ç®¡é“ï¼Œæ€§èƒ½æ•ˆç‡æ›´é«˜ï¼Œå¼€å‘éš¾åº¦æ›´é«˜</td></tr><tr><td style="text-align:center">3.0</td><td style="text-align:center">3.x</td><td style="text-align:center">Android 4.3</td><td style="text-align:center">å…¼å®¹2.0</td><td style="text-align:center">æ€§èƒ½æ›´é«˜ï¼Œæ”¯æŒETC2æ ¼å¼çš„é€æ˜çº¹ç†å‹ç¼©</td></tr><tr><td style="text-align:center">3.1</td><td style="text-align:center">4.x</td><td style="text-align:center">Android 5.0</td><td style="text-align:center">å…¼å®¹2.0/3.0</td><td style="text-align:center">æ–°å¢è®¡ç®—ç€è‰²å™¨ã€å•ç‹¬çš„ç€è‰²å™¨å¯¹è±¡ç­‰æ–°ç‰¹æ€§</td></tr></tbody></table></div><h2 id="ç‰ˆæœ¬çš„é€‰æ‹©"><a href="#ç‰ˆæœ¬çš„é€‰æ‹©" class="headerlink" title="ç‰ˆæœ¬çš„é€‰æ‹©"></a>ç‰ˆæœ¬çš„é€‰æ‹©</h2><p>ç”±äºæ­¤ç¯‡åšå®¢æ˜¯å­¦ä¹ é˜¶æ®µå†™çš„ï¼Œè€Œæˆ‘åœ¨ç½‘ä¸Šæ‰¾åˆ°çš„å¤§éƒ¨åˆ†åšå®¢éƒ½æ˜¯2.0ï¼Œæ‰€ä»¥å°±ä»¥2.0ä¸ºä¸»ã€‚</p><p>å…¶å®æˆ‘è§‰å¾—åº”è¯¥æ˜¯3.0ï¼Œ2.0ç¡®å®å¤ªè€äº†ï¼Œç°åœ¨Android4.3çš„æ‰‹æœºéƒ½è¾ƒå°‘è§äº†ï¼Œè€Œ3.1åˆå¤ªæ–°äº†ã€‚</p><h2 id="å¯¼å…¥"><a href="#å¯¼å…¥" class="headerlink" title="å¯¼å…¥"></a>å¯¼å…¥</h2><p>é¦–å…ˆä½ å¾—åœ¨AndroidManifest.xmlä¸­åŠ å…¥<br><code>&lt;uses-feature android:glEsVersion=&quot;0x00020000&quot; android:required=&quot;true&quot; /&gt;</code></p><p>å…¶ä¸­ä¸åŒç‰ˆæœ¬å¯¹åº”å€¼ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:center">OpenGL ES ç‰ˆæœ¬</th><th style="text-align:center">glEsVersion ç‰ˆæœ¬</th></tr></thead><tbody><tr><td style="text-align:center">2.0</td><td style="text-align:center">0x00020000</td></tr><tr><td style="text-align:center">3.0</td><td style="text-align:center">0x00030000</td></tr><tr><td style="text-align:center">3.1</td><td style="text-align:center">0x00030001</td></tr></tbody></table></div><h1 id="åŸºæœ¬æ¡†æ¶"><a href="#åŸºæœ¬æ¡†æ¶" class="headerlink" title="åŸºæœ¬æ¡†æ¶"></a>åŸºæœ¬æ¡†æ¶</h1><p>Androidæ¡†æ¶é‡Œé¢æä¾›äº†ä¸¤ä¸ªç±»æ¥ç»™ä½ ä½¿ç”¨OpenGL ES APIåˆ›å»ºå’Œæ“ä½œå›¾å½¢ï¼š<code>GLSrufaceView</code>å’Œ<code>GLSurfaceView.Renderer</code>ã€‚</p><h2 id="GLSrufaceView"><a href="#GLSrufaceView" class="headerlink" title="GLSrufaceView"></a>GLSrufaceView</h2><p>è¿™æ˜¯ä¸€ä¸ªè§†å›¾ç±»ï¼Œä½ å¯ä»¥é€šè¿‡OpenGL ES APIæ¥ç»˜åˆ¶å’Œæ“ä½œå›¾å½¢å¯¹è±¡ï¼Œä»–åœ¨åŠŸèƒ½ä¸Šå¾ˆç±»ä¼¼ä¸<code>SurfaceView</code>ã€‚ä½ å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ª<code>SurfaceView</code>çš„å®ä¾‹å¹¶æ·»åŠ ä½ çš„æ¸²æŸ“å™¨æ¥ä½¿ç”¨è¿™ä¸ªç±»ã€‚</p><p>ä»–çš„å¸¸ç”¨æ–¹æ³•æœ‰ï¼š</p><ul><li><code>setEGLContextClientVersion</code>ï¼šè®¾ç½®OpenGL ESç‰ˆæœ¬ï¼Œ2.0åˆ™è®¾ç½®2</li><li><code>onPause</code>ï¼šæš‚åœæ¸²æŸ“ï¼Œæœ€å¥½æ˜¯åœ¨<code>Activity</code>ã€<code>Fragment</code>çš„<code>onPause()</code>æ–¹æ³•å†…è°ƒç”¨ï¼Œå‡å°‘ä¸å¿…è¦çš„æ€§èƒ½å¼€é”€ï¼Œé¿å…ä¸å¿…è¦çš„å´©æºƒ</li><li><code>onResume</code>ï¼šæ¢å¤æ¸²æŸ“ï¼Œç”¨æ³•ç±»æ¯”<code>onPause()</code></li><li><code>setRenderer</code>ï¼šè®¾ç½®æ¸²æŸ“å™¨</li><li><code>setRenderMode</code>ï¼šè®¾ç½®æ¸²æŸ“æ¨¡å¼</li><li><code>requestRender</code>: è¯·æ±‚æ¸²æŸ“ï¼Œç”±äºæ˜¯è¯·æ±‚å¼‚æ­¥çº¿ç¨‹è¿›è¡Œæ¸²æŸ“ï¼Œæ‰€ä»¥ä¸æ˜¯åŒæ­¥æ–¹æ³•ï¼Œè°ƒç”¨åä¸ä¼šç«‹åˆ»å°±è¿›è¡Œæ¸²æŸ“ã€‚æ¸²æŸ“ä¼šå›è°ƒåˆ°<code>Renderer</code>æ¥å£çš„<code>onDrawFrame()</code>æ–¹æ³•ã€‚</li><li><code>queueEvent</code>ï¼šæ’å…¥ä¸€ä¸ª<code>Runnable</code>ä»»åŠ¡åˆ°åå°æ¸²æŸ“çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚ç›¸åº”çš„ï¼Œæ¸²æŸ“çº¿ç¨‹ä¸­å¯ä»¥é€šè¿‡<code>Activity</code>çš„<code>runOnUIThread</code>çš„æ–¹æ³•æ¥ä¼ é€’äº‹ä»¶ç»™ä¸»çº¿ç¨‹å»æ‰§è¡Œ</li></ul><p>å…¶ä¸­ï¼ŒGLSurfaceViewçš„æ¸²æŸ“æ¨¡å¼æœ‰ï¼š</p><ul><li><code>RENDERMODE_CONTINUOUSLY</code>ï¼šä¸åœåœ°æ¸²æŸ“</li><li><code>RENDERMODE_WHEN_DIRTY</code>ï¼šåªæœ‰è°ƒç”¨äº†<code>requestRender()</code>ä¹‹åæ‰ä¼šè§¦å‘æ¸²æŸ“å›è°ƒonDrawFrameæ–¹æ³•</li></ul><h2 id="GLSurfaceView-Renderer"><a href="#GLSurfaceView-Renderer" class="headerlink" title="GLSurfaceView.Renderer"></a>GLSurfaceView.Renderer</h2><p>æ­¤æ¥å£å®šä¹‰äº†åœ¨GLSurfaceViewä¸­ç»˜åˆ¶å›¾å½¢æ‰€éœ€çš„æ–¹æ³•ã€‚å¿…é¡»å°†æ­¤æ¥å£çš„å®ç°ä½œä¸ºå•ç‹¬çš„ç±»æä¾›ï¼Œå¹¶ä½¿ç”¨GLSurfaceView.setRenderer()å°†å…¶æ·»åŠ åˆ°GLSurfaceViewçš„å®ç°ç±»ä¸­ã€‚</p><p>ä»–çš„ä¸»è¦æ–¹æ³•æœ‰ä¸‰ä¸ªï¼š</p><ul><li><code>onSurfaceCreated(GL10 gl, EGLConfig config)</code>ï¼šGLSurfaceViewå†…çš„Surfaceè¢«åˆ›å»ºæ—¶ä¼šè¢«è°ƒç”¨åˆ°</li><li><code>onSurfaceChanged(GL10 gl, int width, int height)</code>ï¼šSurfaceå°ºå¯¸æ”¹å˜æ—¶è°ƒç”¨åˆ°</li><li><code>onDrawFrame(GL10 gl)</code>ï¼šæ¸²æŸ“ç»˜åˆ¶æ¯ä¸€å¸§æ—¶è°ƒç”¨åˆ°</li></ul><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé¦–æ¬¡åˆ›å»ºGLSurfaceViewæ—¶ï¼Œä¼šé¡ºåºè°ƒç”¨<code>onSurfaceCreated()</code> -&gt; <code>onSurfaceChanged()</code> -&gt; <code>onDrawFrame()</code>ã€‚ç„¶åæ¯ç»˜åˆ¶ä¸€å¸§ï¼Œéƒ½ä¼šä¸åœåœ°å›è°ƒ<code>onDrawFrame()</code>æ–¹æ³•ã€‚</p><h1 id="ç¼–å†™æµç¨‹"><a href="#ç¼–å†™æµç¨‹" class="headerlink" title="ç¼–å†™æµç¨‹"></a>ç¼–å†™æµç¨‹</h1><p>é¦–å…ˆæˆ‘ä»¬æ¥å†™ä¸€ä¸ªåŸºæœ¬æ¡†æ¶ã€‚</p><p>åˆ›å»ºä¸€ä¸ªAndroidé¡¹ç›®ï¼Œç„¶åActivityé€‰æ‹©EmptyActivityã€‚</p><p><strong>æ³¨æ„ï¼šæœ¬é¡¹ç›®æŸäº›ç±»æˆ–è€…æ–¹æ³•é€šè¿‡AndroidStudioå¯¼å…¥çš„æ—¶å€™ä¼šè®©ä½ é€‰æ‹©æ˜¯ä»å“ªä¸ªåŒ…é‡Œé¢å¯¼å…¥ï¼Œä¸€è‡´é€‰æ‹©<code>android.opengl.GLES20</code></strong></p><h2 id="ç¼–å†™Activity"><a href="#ç¼–å†™Activity" class="headerlink" title="ç¼–å†™Activity"></a>ç¼–å†™Activity</h2><p>æ‰“å¼€æˆ‘ä»¬é¡¹ç›®çš„MainActivityï¼Œä½ å°±èƒ½çœ‹åˆ°ç†Ÿæ‚‰çš„onCreateæ–¹æ³•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¦å¯¹è¿™ä¸ªActivityè¿›è¡Œä¸€äº›æ›´æ”¹ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªGLSurfaceViewçš„å¯¹è±¡,å¹¶æ·»åŠ ä¸€ä¸ªæ–°çš„æˆå‘˜å˜é‡ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> GLSurfaceView glSurfaceView;</span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">rendererSet</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br></pre></td></tr></table></figure></p><p>æ¥ä¸‹æ¥å°†<code>setContentView()</code>ç§»é™¤ï¼Œå¹¶å¯¹glSurfaceViewè¿›è¡Œåˆå§‹åŒ–ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    glSurfaceView = <span class="keyword">new</span> <span class="title class_">GLSurfaceView</span>(<span class="built_in">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç”±äºæˆ‘ä»¬æ˜¯åœ¨å†™OpenGL ES2.0çš„ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ£€æµ‹å½“å‰è¿è¡ŒAPPçš„ç³»ç»Ÿæ”¯ä¸æ”¯æŒOpenGL ES2.0ã€‚æˆ‘ä»¬å°†ä¸‹é¢å‡ è¡Œä»£ç æ·»åŠ åˆ°onCreate()é‡Œé¢å»:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">ActivityManager</span> <span class="variable">activityManager</span> <span class="operator">=</span> (ActivityManager) getSystemService(Context.ACTIVITY_SERVICE);</span><br><span class="line"><span class="keyword">final</span> <span class="type">ConfigurationInfo</span> <span class="variable">configurationInfo</span> <span class="operator">=</span> activityManager.deviceConfigurationInfo();</span><br><span class="line"><span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">supportsEs2</span> <span class="operator">=</span> configurationInfo.reqGlEsVersion &gt;= <span class="number">0x20000</span>;</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯è¿™æ®µä»£ç åœ¨æ¨¡æ‹Ÿå™¨ä¸Šä¸èƒ½å·¥ä½œï¼Œå› ä¸ºGPUæ¨¡æ‹Ÿéƒ¨åˆ†æœ‰ç¼ºé™·ã€‚ä¸ºäº†ä½¿ä»£ç åœ¨æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œï¼Œæˆ‘ä»¬è¦æŒ‰å¦‚ä¸‹ä»£ç ä¿®æ”¹æ£€æŸ¥æ¡ä»¶ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">supportsEs2</span> <span class="operator">=</span> configurationInfo.reqGlEsVersion &gt;= <span class="number">0x20000</span></span><br><span class="line">    || (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.ICE_CREAM_SANDWICH_MR1</span><br><span class="line">    &amp;&amp; (Build.FINGERPRINT.startsWith(<span class="string">&quot;generic&quot;</span>)</span><br><span class="line">    || Build.FINGERPRINT.startsWith(<span class="string">&quot;unknown&quot;</span>)</span><br><span class="line">    || Build.MODEL.contains(<span class="string">&quot;google_sdk&quot;</span>)</span><br><span class="line">    || Build.MODEL.contains(<span class="string">&quot;Emulator&quot;</span>)</span><br><span class="line">    || Build.MODEL.contains(<span class="string">&quot;Android SDK build for x86&quot;</span>)))</span><br></pre></td></tr></table></figure></p><p>æ¥ä¸‹æ¥å°±æ˜¯é…ç½®æ¸²æŸ“è¡¨é¢ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (supportsEs2) &#123;</span><br><span class="line">    <span class="comment">// é…ç½®è¿™ä¸ªsurfaceè§†å›¾</span></span><br><span class="line">    glSurfaceView.setEGLContextClientVersion(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é…ç½®Renderer</span></span><br><span class="line">    glSurfaceView.setRenderer(FirstOpenGLProjectRenderer());</span><br><span class="line">    rendererSet = <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;This device does not support OpenGL ES 2.0&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setContentView(glSurfaceView);</span><br></pre></td></tr></table></figure></p><p>æœ€åæˆ‘ä»¬è¿˜å¾—å¤„ç†ä¸‹Activityçš„ç”Ÿå‘½å‘¨æœŸï¼Œä¹Ÿå°±æ˜¯å°†GLSurfaceViewçš„ç”Ÿå‘½å‘¨æœŸè·ŸActivityçš„ç”Ÿå‘½å‘¨æœŸç»‘å®šèµ·æ¥ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">onPause</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onPause();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (rendererSet)</span><br><span class="line">        glSurfaceView.onPause();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">onResume</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onResume();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (rendererSet)</span><br><span class="line">        glSurfaceView.onResume();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="ç¼–å†™Renderer"><a href="#ç¼–å†™Renderer" class="headerlink" title="ç¼–å†™Renderer"></a>ç¼–å†™Renderer</h2><p>åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œå‘½åä¸ºFirstOpenGLProjectRendererï¼Œè®©è®©è¿™ä¸ªç±»ç»§æ‰¿è‡ªGLSurfaceView.Rendererã€‚</p><p>æ¥ç€å°±å®ç°ä¸‰ä¸ªå¿…å¤‡æ–¹æ³•:</p><ul><li><code>onSurfaceCreate()</code>ï¼šåˆ›å»ºæ—¶è¢«è°ƒç”¨</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onSurfaceCreated</span><span class="params">(GL10 glUnsed, EGLConfig config)</span> &#123;</span><br><span class="line">    glClearColor(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>); <span class="comment">//è®¾ç½®ä¸€ä¸ªæ¸…ç©ºå±å¹•ç”¨çš„é¢œè‰²</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>onSurfaceChanged()</code>ï¼šåˆ›å»ºåæ¯å½“Surfaceå°ºå¯¸æ”¹å˜æ—¶ï¼Œéƒ½è°ƒç”¨æ­¤æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onSurfaceChanged</span><span class="params">(GL10 glUnsed, <span class="type">int</span> width, <span class="type">int</span> height)</span> &#123;</span><br><span class="line">    glViewport(<span class="number">0</span>, <span class="number">0</span>, width, height); <span class="comment">//è®¾ç½®è§†çª—å°ºå¯¸</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>onDrawFrame()</code>ï¼šç»˜åˆ¶æ¯ä¸€å¸§æ—¶è°ƒç”¨</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDrawFrame</span><span class="params">(GL10 glUnsed)</span> &#123;</span><br><span class="line">    glClear(GL_COLOR_BUFFER_BIT); <span class="comment">//æ¸…ç©ºå±å¹•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥è¿è¡Œç¨‹åºäº†ï¼Œä½ å°±å¯ä»¥çœ‹åˆ°æ•´ä¸ªå±å¹•éƒ½æˆäº†çº¢è‰²ï¼Œè¿™æ˜¯ä¸ºå•¥å‘¢ï¼Ÿ<br>å› ä¸ºæˆ‘ä»¬åœ¨onSurfaceCreatedæ–¹æ³•é‡Œé¢è®¾ç½®äº†glClearColor(1.0f,0.0f,0.0f,0.0f)ã€‚è¿™ä¸ªæ–¹æ³•çš„å‚æ•°å¯¹åº”çš„æ˜¯RGBAï¼Œç„¶åæˆ‘ä»¬åˆåœ¨onDrawFrameæ–¹æ³•ä¸­è®¾ç½®äº†æ¸…å±ï¼Œæ‰€ä»¥è¿™æ ·ä½ å°±ä¼šçœ‹åˆ°çš„æ˜¯çº¢è‰²äº†ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/OpenGL/">OpenGL</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/OpenGL/">OpenGL</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/">å›¾åƒå¤„ç†</category>
      
      
      <comments>https://www.littlecorgi.top/posts/a92b4a54.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Flutterå…¥é—¨å¹¶å¼€å‘å¤©æ°”é¢„æŠ¥APP(8)â€”â€”å¤©æ°”é¢„æŠ¥ç¬¬äºŒæ­¥-é€‰æ‹©çœã€å¸‚ã€åŒºç•Œé¢åŠç½‘ç»œè¯·æ±‚</title>
      <link>https://www.littlecorgi.top/posts/f0e3723.html</link>
      <guid>https://www.littlecorgi.top/posts/f0e3723.html</guid>
      <pubDate>Mon, 14 Oct 2019 08:55:26 GMT</pubDate>
      
      <description>&lt;blockquote&gt;
&lt;p&gt;é¡¹ç›®Githubåœ°å€ï¼š&lt;a href=&quot;https://github.com/a1203991686/CoolWeather_Flutter&quot;&gt;a1203991686/CoolWeather_Flutter&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨ç¬¬å…­ç« ä¸­æˆ‘ä»¬å†™äº†å¤©æ°”é¢„æŠ¥çš„é¡µé¢ï¼Œ ä½†æ˜¯ä½ ä½œä¸ºå¤©æ°”é¢„æŠ¥è‚¯å®šèƒ½é€‰æ‹©åŸå¸‚å§ã€‚æ‰€ä»¥æˆ‘ä»¬ç°åœ¨æ¥å†™é€‰æ‹©çœã€å¸‚ã€åŒºçš„ç•Œé¢ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯éƒ­éœ–å¤§ç¥åœ¨ç¬¬ä¸€è¡Œä»£ç æœ€åé¢é…·æ¬§å¤©æ°”çš„APIã€‚&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>é¡¹ç›®Githubåœ°å€ï¼š<a href="https://github.com/a1203991686/CoolWeather_Flutter">a1203991686/CoolWeather_Flutter</a></p></blockquote><p>åœ¨ç¬¬å…­ç« ä¸­æˆ‘ä»¬å†™äº†å¤©æ°”é¢„æŠ¥çš„é¡µé¢ï¼Œ ä½†æ˜¯ä½ ä½œä¸ºå¤©æ°”é¢„æŠ¥è‚¯å®šèƒ½é€‰æ‹©åŸå¸‚å§ã€‚æ‰€ä»¥æˆ‘ä»¬ç°åœ¨æ¥å†™é€‰æ‹©çœã€å¸‚ã€åŒºçš„ç•Œé¢ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯éƒ­éœ–å¤§ç¥åœ¨ç¬¬ä¸€è¡Œä»£ç æœ€åé¢é…·æ¬§å¤©æ°”çš„APIã€‚</p><span id="more"></span><h1 id="1-å®ç°ç•Œé¢"><a href="#1-å®ç°ç•Œé¢" class="headerlink" title="1. å®ç°ç•Œé¢"></a>1. å®ç°ç•Œé¢</h1><p>æ—¢ç„¶æ˜¯ä¸€ä¸ªé€‰æ‹©çœå¸‚åŒºçš„ç•Œé¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç”¨<code>ListView</code>ã€‚</p><p>é¦–å…ˆçœ‹ä¸€ä¸‹å¤§è‡´ç•Œé¢ï¼š<br><img src="https://cdn.littlecorgi.top/mweb/2019-10-14/Screenshot_1570967184.png" alt="Screenshot_1570967184"></p><p>å°±ç›´æ¥ä½¿ç”¨<code>ListView</code>çš„<code>builder()</code>æ–¹æ³•ï¼Œå¿˜äº†çš„åŒå­¦å¯ä»¥çœ‹å‰é¢ç¬¬5ç« ã€‚</p><h2 id="çœ"><a href="#çœ" class="headerlink" title="çœ"></a>çœ</h2><p>åœ¨<code>view</code>æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªç±»<code>provinces_page.dart</code>ï¼Œæ¥ä¸‹æ¥å°±åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œé¢å†™ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ProvincesPageWidget</span> <span class="keyword">extends</span> <span class="title class_">StatefulWidget</span> &#123;</span><br><span class="line">    ProvincesPageWidget(&#123;Key key&#125;) : <span class="built_in">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    ProvincesPageStateWidget <span class="title function_">createState</span><span class="params">()</span> =&gt; <span class="keyword">new</span> <span class="title class_">ProvincesPageStateWidget</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProvincesPageStateWidget</span> <span class="keyword">extends</span> <span class="title class_">State</span>&lt;ProvincesPageWidget&gt; &#123;</span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    Widget <span class="title function_">build</span><span class="params">(BuildContext context)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Scaffold(</span><br><span class="line">            appBar: <span class="keyword">new</span> <span class="title class_">AppBar</span>(</span><br><span class="line">                title: Text(</span><br><span class="line">                    <span class="string">&quot;çœä»½&quot;</span>,</span><br><span class="line">                    style: TextStyle(fontSize: <span class="number">25.0</span>),</span><br><span class="line">                ),</span><br><span class="line">            ),</span><br><span class="line">            body: ListView.builder(</span><br><span class="line">                itemCount: <span class="number">30</span>,</span><br><span class="line">                itemBuilder: (context, index) &#123;</span><br><span class="line">                    <span class="keyword">return</span> ListTile(</span><br><span class="line">                            title: Text(<span class="string">&quot;$index&quot;</span>),</span><br><span class="line">                    );</span><br><span class="line">                &#125;,</span><br><span class="line">            ),</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="å¸‚"><a href="#å¸‚" class="headerlink" title="å¸‚"></a>å¸‚</h2><p>å’Œçœä¸€æ ·ã€‚åœ¨<code>view</code>æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªç±»<code>city_page.dart</code>ï¼Œæ¥ä¸‹æ¥å°±åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œé¢å†™ä»£ç ã€‚ç…§ç€çœçš„ä¾è‘«èŠ¦ç”»ç“¢ï¼Œå†™ä¸€ä¸ª<code>ListView</code>ã€‚</p><h2 id="åŒº"><a href="#åŒº" class="headerlink" title="åŒº"></a>åŒº</h2><p>å’Œçœä¸€æ ·ã€‚åœ¨<code>view</code>æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªç±»<code>counties_page.dart</code>ï¼Œæ¥ä¸‹æ¥å°±åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œé¢å†™ä»£ç ã€‚ç…§ç€çœçš„ä¾è‘«èŠ¦ç”»ç“¢ï¼Œå†™ä¸€ä¸ª<code>ListView</code>ã€‚</p><h1 id="2-ç½‘ç»œè¯·æ±‚"><a href="#2-ç½‘ç»œè¯·æ±‚" class="headerlink" title="2. ç½‘ç»œè¯·æ±‚"></a>2. ç½‘ç»œè¯·æ±‚</h1><p>ç½‘ç»œè¯·æ±‚å¯ä»¥çœ‹ä¸‹ä¹‹å‰ç¬¬7ç« çš„å†…å®¹ã€‚ä¸»è¦æ˜¯é€šè¿‡<code>Dio</code>è¿›è¡Œç½‘ç»œè¯·æ±‚ã€‚å¤§å®¶å¯ä»¥çœ‹ä¸‹ç¬¬7ç« ç½‘ç»œè¯·æ±‚çš„å†…å®¹ã€‚</p><p>æˆ‘ä»¬ç½‘ç»œè¯·æ±‚ä¸»è¦éœ€è¦ä»¥ä¸‹å‡ ä¸ªAPIï¼š</p><ul><li>è¯·æ±‚çœä»½åˆ—è¡¨ï¼š<code>http://guolin.tech/api/china</code></li><li>è¯·æ±‚å¯¹åº”å¸‚åˆ—è¡¨ï¼š<code>http://guolin.tech/api/china/provinceID</code></li><li>è¯·æ±‚å¯¹åº”åŒºå¿åˆ—è¡¨ï¼š<code>http://guolin.tech/api/china/provinceID/cityID</code></li></ul><p>ç”±äºæˆ‘ä»¬åœ¨ä¹‹å‰æ–‡ç« ä¸­ä½¿ç”¨çš„çœä½œä¸ºä¾‹å­ï¼Œè¿™å—æˆ‘ä»¬å°±ç”¨åŒºå¿ä½œä¸ºä¾‹å­ï¼š</p><h2 id="è½¬ä¸ºDartç±»"><a href="#è½¬ä¸ºDartç±»" class="headerlink" title="è½¬ä¸ºDartç±»"></a>è½¬ä¸ºDartç±»</h2><p>é¦–å…ˆä½¿ç”¨ç½‘ç«™<a href="https://caijinglong.github.io/json2dart/">https://caijinglong.github.io/json2dart/</a>æ¥è®²Jsonæ•°æ®è½¬ä¸ºDartå®ä½“ç±»ï¼š<br><img src="https://cdn.littlecorgi.top/mweb/2019-10-14/Json.png" alt="Json"></p><p>ç„¶ååœ¨é¡¹ç›®<code>lib</code>ç›®å½•æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚åä¸º<code>bean</code>ã€‚è¿™ä¸ªæ–‡ä»¶å¤¹ä¸»è¦å­˜æ”¾å®ä½“ç±»çš„ä»£ç ã€‚ç„¶ååœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢æ–°å»ºä¸€ä¸ªdartæ–‡ä»¶ï¼Œå‘½åä¸º<code>Counties</code>ã€‚ç„¶åæŠŠç”Ÿæˆçš„Dartä»£ç å¤åˆ¶ç²˜è´´è¿›å»ã€‚ä½†æ˜¯ä½ ä¼šå‘ç°å¤åˆ¶è¿›å»åä¼šæŠ¥é”™ï¼Œè¿™ä¸ªä¸ç”¨æ€¥ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥å¤„ç†é”™è¯¯ã€‚</p><h2 id="ç”Ÿæˆ-g-dartæ–‡ä»¶"><a href="#ç”Ÿæˆ-g-dartæ–‡ä»¶" class="headerlink" title="ç”Ÿæˆ.g.dartæ–‡ä»¶"></a>ç”Ÿæˆ.g.dartæ–‡ä»¶</h2><p>æ¥ä¸‹æ¥åœ¨é¡¹ç›®æ ¹ç›®å½•çš„<code>pubspec.yaml</code>æ–‡ä»¶çš„<code>dependencies</code>é¡¹ä¸‹é¢æ·»åŠ ä¾èµ–<code>json_annotation</code>ã€<code>dev_dependencies</code>é¡¹ä¸‹é¢æ·»åŠ <code>build_runner</code>å’Œ<code>json_serializable</code>ã€‚</p><p>æ¥ç€æ‰“å¼€ç»ˆç«¯ï¼Œå®šä½åˆ°é¡¹ç›®æ ¹ç›®å½•ï¼Œè¾“å…¥<br><code>flutter packages pub run build_runner build</code>ï¼Œè¿è¡Œå³å¯ã€‚è¿è¡Œå®Œæ¯•ä½ å°±ä¼šå‘ç°ä½ é¡¹ç›®çš„å­˜å®ä½“ç±»çš„<code>lib/bean</code>ç›®å½•å¤šäº†ä¸€ä¸ªæ–‡ä»¶ï¼Œåä¸º<code>Counties.g.dart</code>ã€‚åŒæ—¶ä½ <code>Counties.dart</code>é‡Œé¢çš„é”™è¯¯ä¹Ÿæ²¡æœ‰äº†ã€‚</p><h2 id="ç½‘ç»œè¯·æ±‚"><a href="#ç½‘ç»œè¯·æ±‚" class="headerlink" title="ç½‘ç»œè¯·æ±‚"></a>ç½‘ç»œè¯·æ±‚</h2><p>æœ€åä½ å°±å¯ä»¥é€šè¿‡Dioæ¥è¿›è¡Œç½‘ç»œè¯·æ±‚äº†ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Dio().get(http:<span class="comment">//guolin.tech/api/china/$_provinceID/$_cityID);</span></span><br></pre></td></tr></table></figure></p><p>é‚£ä¹ˆåˆ°è¿™æœ‰çš„åŒå­¦å¯èƒ½å°±ä¼šé—®äº†ï¼Œä½ ç½‘å€é‡Œé¢æœ‰<code>provinceID</code>å’Œ<code>cityID</code>ï¼Œé‚£è¿™ä¸¤ä¸ªæ€ä¹ˆè·å–ï¼Œè¿™ä¸ªæ—¶å€™å°±å¾—ç”¨ä¸Šå¸¦å€¼è·¯ç”±è·³è½¬äº†ã€‚</p><p>æˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯è¿™æ ·çš„ä¸€ä¸ªé€»è¾‘:å…ˆé€‰æ‹©çœä»½ã€å†é€‰æ‹©åŸå¸‚ã€æœ€åé€‰æ‹©åŒºå’Œå¿ã€‚æ‰€ä»¥æˆ‘ä»¬è¿™ä¸ª<code>CountyPageWidget</code>è‚¯å®šæ˜¯ç”±<code>CityPageWidget</code>è°ƒç”¨çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨<code>CityPageWidget</code>çš„<code>ListView</code>é‡Œé¢å°†<code>Text</code>é€šè¿‡<code>GestureDetector</code>åŒ…èµ·æ¥ï¼Œç„¶åå°†<code>GestureDetector</code>çš„<code>onTap</code>æ–¹æ³•è®¾ç½®ä¸ºè·³è½¬åˆ°<code>CountyPageWidget</code>ã€‚<code>CityPageWidget</code>çš„<code>ListView</code>ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ListView.builder(</span><br><span class="line">    itemCount: _cityList.cities.length,</span><br><span class="line">    itemBuilder: (context, index) &#123;</span><br><span class="line">        <span class="keyword">return</span> GestureDetector(</span><br><span class="line">            child: ListTile(</span><br><span class="line">                title: Text(<span class="string">&quot;$&#123;_cityList.cities[index].name&#125;&quot;</span>),</span><br><span class="line">            ),</span><br><span class="line">            onTap: () &#123;</span><br><span class="line">                Navigator.push(context,</span><br><span class="line">                    MaterialPageRoute(builder: (context) &#123;</span><br><span class="line">                        <span class="keyword">return</span> CountiesPageWidget(</span><br><span class="line">                            provinceID: _provinceID, <span class="comment">//ç”±CityWidgetçš„ä¸Šä¸€çº§ProvinceWidgetä¼ è¿‡æ¥ï¼Œ</span></span><br><span class="line">                            cityID: _cityList.cities[index].id, <span class="comment">// ç”±ç½‘ç»œè¯·æ±‚å›æ¥çš„æ•°æ®ä¼ å…¥</span></span><br><span class="line">                        );</span><br><span class="line">                    &#125;));</span><br><span class="line">            &#125;,</span><br><span class="line">        );</span><br><span class="line">    &#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p><p>è¿™æ ·<code>CountyPageWidget</code>æ‰€éœ€çš„<code>provinceID</code>å’Œ<code>cityID</code>éƒ½æ˜¯ç”±<code>CityPageWidget</code>ä¼ å…¥çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆå¯¹ä»–ä¼ å…¥çš„å€¼è¿›è¡Œå¤„ç†å‘¢ï¼Œæ€ä¹ˆæŠŠå®ƒæ·»åŠ åˆ°ç½‘å€é‡Œå»ï¼Ÿæ¥ä¸‹æ¥å¤§å®¶çœ‹ä»£ç å°±è¡Œäº†ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CountyPageWidget</span> <span class="keyword">extends</span> <span class="title class_">StatefulWidget</span> &#123;</span><br><span class="line">  <span class="comment">//åœ¨Widgetä¸­å®šä¹‰ä¸¤ä¸ªï¼Œæ–¹ä¾¿ç”±å…¶ä»–Widgetä¼ å…¥</span></span><br><span class="line">  <span class="keyword">final</span> <span class="type">int</span> provinceID;</span><br><span class="line">  <span class="keyword">final</span> <span class="type">int</span> cityID;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®¾ç½®æ„é€ æ–¹æ³•ï¼Œåœ¨æ„é€ æ–¹æ³•ä¸­ä¼ å…¥ä¸¤ä¸ªå˜é‡</span></span><br><span class="line">  CountyPageWidget(&#123;Key key, <span class="built_in">this</span>.provinceID, <span class="built_in">this</span>.cityID&#125;) : <span class="built_in">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  CountyPageWidgetState <span class="title function_">createState</span><span class="params">()</span> =&gt; CountyPageWidgetState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CountyPageWidgetState</span> <span class="keyword">extends</span> <span class="title class_">State</span>&lt;CountyPageWidget&gt; &#123;</span><br><span class="line">  <span class="comment">// åœ¨Stateä¸­å®šä¹‰ä¸¤ä¸ªå˜é‡</span></span><br><span class="line">  <span class="type">int</span> _provinceID;</span><br><span class="line">  <span class="type">int</span> _cityID;</span><br><span class="line">  List&lt;County&gt; _county;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">initState</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// åœ¨æ­¤å°†Widgetä¸­çš„ä¸¤ä¸ªå˜é‡èµ‹å€¼ç»™Stateä¸­çš„å˜é‡</span></span><br><span class="line">    _provinceID = widget.provinceID;</span><br><span class="line">    _cityID = widget.cityID;</span><br><span class="line">    <span class="built_in">super</span>.initState();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget <span class="title function_">build</span><span class="params">(BuildContext context)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: <span class="keyword">new</span> <span class="title class_">AppBar</span>(</span><br><span class="line">        title: Text(</span><br><span class="line">          <span class="string">&quot;åŒºå¿&quot;</span>,</span><br><span class="line">          style: TextStyle(fontSize: <span class="number">25.0</span>),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">      body: FutureBuilder( <span class="comment">// UIå¼‚æ­¥æ›´æ–°ç»„ä»¶</span></span><br><span class="line">        <span class="comment">// è¿™å—å°±å¯ä»¥è°ƒç”¨äº†</span></span><br><span class="line">        future: Dio().get(<span class="string">&quot;http://guolin.tech/api/china/$_provinceID/$_cityID&quot;</span>),</span><br><span class="line">        builder: (BuildContext context, AsyncSnapshot snapshot) &#123;</span><br><span class="line">        ...çœç•¥åé¢æ‰€æœ‰ä»£ç </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="3-UIå¼‚æ­¥æ›´æ–°"><a href="#3-UIå¼‚æ­¥æ›´æ–°" class="headerlink" title="3. UIå¼‚æ­¥æ›´æ–°"></a>3. UIå¼‚æ­¥æ›´æ–°</h1><p>ä¸å¼‚æ­¥æ›´æ–°ç›¸å…³çš„çŸ¥è¯†å¤§å®¶ä¹Ÿå¯ä»¥çœ‹æˆ‘ä»¬ä¹‹å‰çš„ç¬¬7ç« åšå®¢ï¼Œè¿™å—åªè®²åº”ç”¨ã€‚</p><h2 id="çœ-1"><a href="#çœ-1" class="headerlink" title="çœ"></a>çœ</h2><p>å°†Scaffoldçš„bodyå‚æ•°è®¾ç½®ä¸ºFutureBuilderï¼Œå¹¶åœ¨FutureBuilderé‡Œé¢è°ƒç”¨ListView:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">FutureBuilder(</span><br><span class="line">    future: Dio().get(<span class="string">&quot;http://guolin.tech/api/china&quot;</span>),</span><br><span class="line">    builder: (BuildContext context, AsyncSnapshot snapshot) &#123;</span><br><span class="line">        <span class="keyword">if</span> (snapshot.connectionState == ConnectionState.done) &#123;</span><br><span class="line">            <span class="type">Response</span> <span class="variable">response</span> <span class="operator">=</span> snapshot.data;</span><br><span class="line">            <span class="comment">//å‘ç”Ÿé”™è¯¯</span></span><br><span class="line">            <span class="keyword">if</span> (snapshot.hasError) &#123;</span><br><span class="line">                <span class="keyword">return</span> Text(snapshot.error.toString());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            provinceList = getProvinceList(response.data);</span><br><span class="line">            <span class="comment">//è¯·æ±‚æˆåŠŸï¼Œé€šè¿‡é¡¹ç›®ä¿¡æ¯æ„å»ºç”¨äºæ˜¾ç¤ºé¡¹ç›®åç§°çš„ListView</span></span><br><span class="line">            <span class="keyword">return</span> ListView.builder(</span><br><span class="line">                itemCount: provinceList.length,</span><br><span class="line">                itemBuilder: (context, index) &#123;</span><br><span class="line">                    <span class="keyword">return</span> GestureDetector(</span><br><span class="line">                        child: ListTile(</span><br><span class="line">                            title: Text(<span class="string">&quot;$&#123;provinceList[index].name&#125;&quot;</span>),</span><br><span class="line">                        ),</span><br><span class="line">                        onTap: () &#123;</span><br><span class="line">                            Navigator.push(context, MaterialPageRoute(builder: (context) &#123;</span><br><span class="line">                                <span class="keyword">return</span> CityPageWidget(</span><br><span class="line">                                    provinceID: provinceList[index].id,</span><br><span class="line">                                );</span><br><span class="line">                            &#125;));</span><br><span class="line">                        &#125;,</span><br><span class="line">                    );</span><br><span class="line">                &#125;,</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è¯·æ±‚æœªå®Œæˆæ—¶å¼¹å‡ºloading</span></span><br><span class="line">        <span class="keyword">return</span> CircularProgressIndicator();</span><br><span class="line">    &#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p><h2 id="å¸‚-1"><a href="#å¸‚-1" class="headerlink" title="å¸‚"></a>å¸‚</h2><p>ä¸çœåŒç†:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">FutureBuilder(</span><br><span class="line">    future: Dio().get(<span class="string">&quot;http://guolin.tech/api/china/$_provinceID&quot;</span>),</span><br><span class="line">    builder: (BuildContext context, AsyncSnapshot snapshot) &#123;</span><br><span class="line">        <span class="keyword">if</span> (snapshot.connectionState == ConnectionState.done) &#123;</span><br><span class="line">            <span class="type">Response</span> <span class="variable">response</span> <span class="operator">=</span> snapshot.data;</span><br><span class="line">            <span class="comment">//å‘ç”Ÿé”™è¯¯</span></span><br><span class="line">            <span class="keyword">if</span> (snapshot.hasError) &#123;</span><br><span class="line">                <span class="keyword">return</span> Text(snapshot.error.toString());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            _cityList = getCityList(response.data);</span><br><span class="line">            <span class="comment">//è¯·æ±‚æˆåŠŸï¼Œé€šè¿‡é¡¹ç›®ä¿¡æ¯æ„å»ºç”¨äºæ˜¾ç¤ºé¡¹ç›®åç§°çš„ListView</span></span><br><span class="line">            <span class="keyword">return</span> ListView.builder(</span><br><span class="line">                itemCount: _cityList.length,</span><br><span class="line">                itemBuilder: (context, index) &#123;</span><br><span class="line">                    <span class="keyword">return</span> GestureDetector(</span><br><span class="line">                        child: ListTile(</span><br><span class="line">                            title: Text(<span class="string">&quot;$&#123;_cityList[index].name&#125;&quot;</span>),</span><br><span class="line">                        ),</span><br><span class="line">                        onTap: () &#123;</span><br><span class="line">                            Navigator.push(context, MaterialPageRoute(builder: (context) &#123;</span><br><span class="line">                                <span class="keyword">return</span> CountiesPageWidget(</span><br><span class="line">                                    provinceID: _provinceID,</span><br><span class="line">                                    cityID: _cityList[index].id,</span><br><span class="line">                                );</span><br><span class="line">                            &#125;));</span><br><span class="line">                        &#125;,</span><br><span class="line">                    );</span><br><span class="line">                &#125;,</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è¯·æ±‚æœªå®Œæˆæ—¶å¼¹å‡ºloading</span></span><br><span class="line">        <span class="keyword">return</span> CircularProgressIndicator();</span><br><span class="line">    &#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p><h2 id="åŒºå¿"><a href="#åŒºå¿" class="headerlink" title="åŒºå¿"></a>åŒºå¿</h2><p>ä¸çœåŒç†:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">FutureBuilder(</span><br><span class="line">    future: Dio().get(<span class="string">&quot;http://guolin.tech/api/china/$_provinceID/$_cityID&quot;</span>),</span><br><span class="line">    builder: (BuildContext context, AsyncSnapshot snapshot) &#123;</span><br><span class="line">        <span class="keyword">if</span> (snapshot.connectionState == ConnectionState.done) &#123;</span><br><span class="line">            <span class="type">Response</span> <span class="variable">response</span> <span class="operator">=</span> snapshot.data;</span><br><span class="line">            <span class="comment">//å‘ç”Ÿé”™è¯¯</span></span><br><span class="line">            <span class="keyword">if</span> (snapshot.hasError) &#123;</span><br><span class="line">                <span class="keyword">return</span> Text(snapshot.error.toString());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            _county = getCountyList(response.data);</span><br><span class="line">            <span class="comment">//è¯·æ±‚æˆåŠŸï¼Œé€šè¿‡é¡¹ç›®ä¿¡æ¯æ„å»ºç”¨äºæ˜¾ç¤ºé¡¹ç›®åç§°çš„ListView</span></span><br><span class="line">            <span class="keyword">return</span> ListView.builder(</span><br><span class="line">                itemCount: _county.length,</span><br><span class="line">                itemBuilder: (context, index) &#123;</span><br><span class="line">                    <span class="keyword">return</span> GestureDetector(</span><br><span class="line">                        child: ListTile(</span><br><span class="line">                            title: Text(<span class="string">&quot;$&#123;_county[index].name&#125;&quot;</span>),</span><br><span class="line">                        ),</span><br><span class="line">                        onTap: () &#123;</span><br><span class="line">                            _saveCityID(_county[index].weatherId);</span><br><span class="line">                            Navigator.push(context, MaterialPageRoute(builder: (context) &#123;</span><br><span class="line">                                <span class="keyword">return</span> MainPage(</span><br><span class="line">                                    cityID: _county[index].weatherId,</span><br><span class="line">                                );</span><br><span class="line">                            &#125;));</span><br><span class="line">                        &#125;,</span><br><span class="line">                    );</span><br><span class="line">                &#125;,</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è¯·æ±‚æœªå®Œæˆæ—¶å¼¹å‡ºloading</span></span><br><span class="line">        <span class="keyword">return</span> CircularProgressIndicator();</span><br><span class="line">    &#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Flutter/">Flutter</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Flutter/">Flutter</category>
      
      
      <comments>https://www.littlecorgi.top/posts/f0e3723.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Flutterå…¥é—¨å¹¶å¼€å‘å¤©æ°”é¢„æŠ¥APP(7)â€”â€”Httpç½‘ç»œè¯·æ±‚ã€Jsonè½¬Dartå®ä½“ç±»åŠå¼‚æ­¥æ›´æ–°UI</title>
      <link>https://www.littlecorgi.top/posts/163d319c.html</link>
      <guid>https://www.littlecorgi.top/posts/163d319c.html</guid>
      <pubDate>Sat, 12 Oct 2019 14:13:21 GMT</pubDate>
      
      <description>&lt;blockquote&gt;
&lt;p&gt;ç›¸å…³Demoæºç å¯è§Github &lt;a href=&quot;https://github.com/a1203991686/CoolWeather_Flutter&quot;&gt;a1203991686/CoolWeather_Flutter&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>ç›¸å…³Demoæºç å¯è§Github <a href="https://github.com/a1203991686/CoolWeather_Flutter">a1203991686/CoolWeather_Flutter</a></p></blockquote><span id="more"></span><h1 id="Flutter-Http-ç½‘ç»œè¯·æ±‚"><a href="#Flutter-Http-ç½‘ç»œè¯·æ±‚" class="headerlink" title="Flutter Http ç½‘ç»œè¯·æ±‚"></a>Flutter Http ç½‘ç»œè¯·æ±‚</h1><p>Flutterç½‘ç»œè¯·æ±‚å¯åˆ†ä¸ºä¸¤ç§æ–¹å¼ï¼Œä¸€ç§ä¸º<code>Dart:IO</code>åº“ä¸­ä¸ºæˆ‘ä»¬æä¾›çš„<code>HttpClient</code>ï¼Œå¦ä¸€ç§ä¸ºDartç¬¬ä¸‰æ–¹åº“<code>Dio</code>ã€‚</p><h2 id="HttpClient"><a href="#HttpClient" class="headerlink" title="HttpClient"></a>HttpClient</h2><p><code>HttpClient</code>æ˜¯<code>Dart:IO</code>åº“è‡ªå¸¦çš„ä¸€ä¸ªç±»ï¼Œé€šè¿‡ä»–æ¥å®ç°ç½‘ç»œè¯·æ±‚æœ€åº•å±‚ã€ä¹Ÿå¯ä»¥å®Œå®Œå…¨å…¨çš„è‡ªå®šä¹‰è®¾ç½®ï¼Œä½†æ˜¯ç›¸å¯¹äºå…¶ä»–äººå°è£…å¥½çš„ç¬¬ä¸‰æ–¹åº“æ¥è¯´æ˜¾å¾—å¤æ‚ã€‚</p><h3 id="å¼•å…¥"><a href="#å¼•å…¥" class="headerlink" title="å¼•å…¥"></a>å¼•å…¥</h3><p>å¯¼å…¥<code>Dart:IO</code>åº“ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:io&#x27;</span>;</span><br></pre></td></tr></table></figure></p><h3 id="åˆ›å»ºä¸€ä¸ªHttpClient"><a href="#åˆ›å»ºä¸€ä¸ªHttpClient" class="headerlink" title="åˆ›å»ºä¸€ä¸ªHttpClient:"></a>åˆ›å»ºä¸€ä¸ªHttpClient:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">HttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpClient</span>();</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºä¸€ä¸ªUri"><a href="#åˆ›å»ºä¸€ä¸ªUri" class="headerlink" title="åˆ›å»ºä¸€ä¸ªUri"></a>åˆ›å»ºä¸€ä¸ªUri</h3><p>å¦‚æœä½ æ˜¯<code>Http</code>è¯·æ±‚ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">var</span> <span class="variable">uri</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Uri</span>.http(</span><br><span class="line">    host,</span><br><span class="line">    queryParameters: &#123;</span><br><span class="line">        <span class="string">&quot;xx&quot;</span>:<span class="string">&quot;xx&quot;</span>,</span><br><span class="line">        <span class="string">&quot;yy&quot;</span>:<span class="string">&quot;dd&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><br>å¦‚æœä½ æ˜¯<code>Https</code>è¯·æ±‚ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">var</span> <span class="variable">uri</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Uri</span>.https(</span><br><span class="line">    host,</span><br><span class="line">    queryParameters: &#123;</span><br><span class="line">        <span class="string">&quot;xx&quot;</span>:<span class="string">&quot;xx&quot;</span>,</span><br><span class="line">        <span class="string">&quot;yy&quot;</span>:<span class="string">&quot;dd&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p><h3 id="æ ¹æ®uriè·å–è¿”å›æ•°æ®"><a href="#æ ¹æ®uriè·å–è¿”å›æ•°æ®" class="headerlink" title="æ ¹æ®uriè·å–è¿”å›æ•°æ®"></a>æ ¹æ®uriè·å–è¿”å›æ•°æ®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">HttpClientRequest</span> <span class="variable">request</span> <span class="operator">=</span> await httpClient.getUrl(uri);</span><br><span class="line"><span class="type">HttpClientResponse</span> <span class="variable">response</span> <span class="operator">=</span> await request.close();</span><br></pre></td></tr></table></figure><h3 id="è¯»å–å†…å®¹"><a href="#è¯»å–å†…å®¹" class="headerlink" title="è¯»å–å†…å®¹"></a>è¯»å–å†…å®¹</h3><p>è¿›è¡Œè¿™ä¸€æ­¥å¾—å¯¼å…¥<code>dart:convert</code>åº“ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:convert&#x27;</span>;</span><br><span class="line"></span><br><span class="line">... <span class="comment">//çœç•¥ä¸­é—´ä»£ç  </span></span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">responseBody</span> <span class="operator">=</span> await response.transform(Utf8Decoder()).join();</span><br><span class="line"></span><br><span class="line">print(respinseBody)</span><br></pre></td></tr></table></figure></p><h3 id="æœ€åå…³é—­Client"><a href="#æœ€åå…³é—­Client" class="headerlink" title="æœ€åå…³é—­Client"></a>æœ€åå…³é—­Client</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">httpClient.close();</span><br></pre></td></tr></table></figure><h2 id="Dio"><a href="#Dio" class="headerlink" title="Dio"></a>Dio</h2><p><code>Dio</code>æ˜¯Dartç¤¾åŒºä¸Šåˆ«äººä¸Šä¼ çš„ç¬¬ä¸‰æ–¹åº“ï¼Œä»–å°è£…äº†<code>HttpClient</code>ï¼Œç›¸è¾ƒæ¥è¯´æ›´ä¸ºç®€å•ã€æ–¹ä¾¿ã€‚</p><h3 id="å¼•å…¥-1"><a href="#å¼•å…¥-1" class="headerlink" title="å¼•å…¥"></a>å¼•å…¥</h3><p>åœ¨é¡¹ç›®çš„<code>pubspec.yaml</code>æ–‡ä»¶çš„<code>dependencies</code>ä¸­å¯¼å…¥<code>Dio</code>ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies:</span><br><span class="line">  dio: </span><br><span class="line">  <span class="comment">// å¦‚æœå†’å·åé¢ä¸å¸¦å…·ä½“ç‰ˆæœ¬ä¿¡æ¯åˆ™è¡¨ç¤ºè‡ªåŠ¨ä¸‹è½½æœ€æ–°ç‰ˆ</span></span><br></pre></td></tr></table></figure></p><p>æ¥ç€åœ¨éœ€è¦ä½¿ç”¨çš„ä»£ç æ–‡ä»¶é‡Œé¢ï¼Œ<code>import</code>å¯¼å…¥ä»–ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:dio/dio.dart&#x27;</span>;</span><br></pre></td></tr></table></figure><br>æ¥ç€æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨<code>Dio</code>äº†ã€‚</p><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>é¦–å…ˆå¾—åˆ›å»ºä¸€ä¸ª<code>Dio</code>å¯¹è±¡ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Dio</span> <span class="variable">dio</span> <span class="operator">=</span>  Dio();</span><br></pre></td></tr></table></figure></p><p>å‘èµ·<code>GET</code>è¯·æ±‚ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Response response;</span><br><span class="line">response=await dio.get(uri)</span><br><span class="line">print(response.data.toString());</span><br></pre></td></tr></table></figure></p><p>å‘èµ·<code>POST</code>è¯·æ±‚ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response=await dio.post(uri);</span><br></pre></td></tr></table></figure></p><h1 id="Jsonè½¬Dart"><a href="#Jsonè½¬Dart" class="headerlink" title="Jsonè½¬Dart"></a>Jsonè½¬Dart</h1><h2 id="æ‰‹åŠ¨ç”ŸæˆDartå®ä½“ç±»"><a href="#æ‰‹åŠ¨ç”ŸæˆDartå®ä½“ç±»" class="headerlink" title="æ‰‹åŠ¨ç”ŸæˆDartå®ä½“ç±»"></a>æ‰‹åŠ¨ç”ŸæˆDartå®ä½“ç±»</h2><p>é¦–å…ˆå¾—å¤§å®¶å®‰åˆ©ä¸€ä¸ªç½‘ç«™ï¼Œå› ä¸ºDartå®ä½“ç±»æ¯”Javaå®ä½“ç±»å¤šäº†å‡ ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥ç›¸å¯¹æ¥è¯´éº»çƒ¦ï¼Œé€šè¿‡è¿™ä¸ªç½‘ç«™å°±å¯ä»¥è‡ªåŠ¨ç”Ÿæˆjsonæ•°æ®å¯¹åº”çš„å®ä½“ç±»:<br><a href="https://caijinglong.github.io/json2dart/">https://caijinglong.github.io/json2dart/</a></p><p><img src="https://cdn.littlecorgi.top/mweb/2019-10-12/json2dart.png" alt="json2dart"></p><p>æ¯”æ–¹è¯´æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªé“¾æ¥(<a href="http://guolin.tech/api/china)ï¼Œå¹¶è®©ä»–è‡ªåŠ¨è½¬dartï¼š">http://guolin.tech/api/china)ï¼Œå¹¶è®©ä»–è‡ªåŠ¨è½¬dartï¼š</a><br><img src="https://cdn.littlecorgi.top/mweb/2019-10-12/Province.png" alt="Province"></p><p>æ¥ä¸‹æ¥åªéœ€è¦åˆ›å»ºdartæ–‡ä»¶ï¼Œç„¶åå†æŠŠä»£ç å¤åˆ¶è¿›å»å°±è¡Œäº†ã€‚</p><p>ä¸å‡ºæ„å¤–ï¼Œä»£ç è‚¯å®šä¼šæŠ¥é”™ã€‚<br><img src="https://cdn.littlecorgi.top/mweb/2019-10-12/dart%E5%AE%9E%E4%BD%93%E7%B1%BB.png" alt="dartå®ä½“ç±»"></p><p>æŠ¥é”™ä¿¡æ¯ä¸º:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">error: Target of URI hasn<span class="string">&#x27;t been generated: &#x27;</span>province.g.dart<span class="string">&#x27;. (uri_has_not_been_generated at [cool_weather] lib/bean/province.dart:3)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">error: The method &#x27;</span>_$ProvinceFromJson<span class="string">&#x27; isn&#x27;</span>t defined <span class="keyword">for</span> the class <span class="string">&#x27;Province&#x27;</span>. (undefined_method at [cool_weather] lib/bean/province.dart:<span class="number">31</span>)</span><br><span class="line"></span><br><span class="line">error: The method <span class="string">&#x27;_$ProvinceToJson&#x27;</span> isn<span class="string">&#x27;t defined for the class &#x27;</span>Province<span class="string">&#x27;. (undefined_method at [cool_weather] lib/bean/province.dart:33)</span></span><br></pre></td></tr></table></figure></p><p>è¿™æ˜¯å› ä¸ºæˆ‘ä»¬é¡¹ç›®ä¸‹è¿˜æ²¡æœ‰<code>province.g.dart</code>è¿™ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯æ ¹æ®dartå®ä½“ç±»è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯¥æ€ä¹ˆç”Ÿæˆä»–å‘¢ï¼Ÿ</p><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦åœ¨<code>pubspec.yaml</code>æ–‡ä»¶ä¸­å¯¼å…¥ä¸‰ä¸ªä¾èµ–åŒ…ï¼š<br><img src="https://cdn.littlecorgi.top/mweb/2019-10-12/%E8%BD%ACdart.png" alt="è½¬dart"><br>æˆ‘ä»¬é‡ç‚¹åªéœ€è¦ç®¡ä¸‰ä¸ªå†™ç€éœ€è¦å¯¼å…¥çš„ã€‚è¾“å…¥ä¹‹åç‚¹å‡»<code>pubspec.yaml</code>æ–‡ä»¶å³ä¸Šè§’çš„<code>packages get</code>ï¼Œå°±ä¼šè‡ªåŠ¨ä¸‹è½½åŒ…äº†ã€‚</p><p>ç„¶ååœ¨ç»ˆç«¯ä¸­ï¼Œè½¬åˆ°é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œè¾“å…¥<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter packages pub run build_runner build</span><br></pre></td></tr></table></figure><br>æ¥ç€ä½ å°±ä¼šæƒŠå–œçš„å‘ç°ï¼Œåœ¨ä½ çš„dartå®ä½“ç±»ä¸‹é¢å¤šäº†ä¸€ä¸ªæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ä½ æ‰€ç¼ºå¤±çš„~.g.dartæ–‡ä»¶ï¼Œå¹¶ä¸”å®ä½“ç±»ä¸­é‚£äº›æŠ¥é”™ä¹Ÿéƒ½æ²¡äº†ã€‚<br><img src="https://cdn.littlecorgi.top/mweb/2019-10-12/dart.g.dart.png" alt="dart.g.dart"></p><h2 id="å°†è¯·æ±‚å›æ¥çš„Responseè½¬ä¸ºDartå®ä½“ç±»"><a href="#å°†è¯·æ±‚å›æ¥çš„Responseè½¬ä¸ºDartå®ä½“ç±»" class="headerlink" title="å°†è¯·æ±‚å›æ¥çš„Responseè½¬ä¸ºDartå®ä½“ç±»"></a>å°†è¯·æ±‚å›æ¥çš„Responseè½¬ä¸ºDartå®ä½“ç±»</h2><p>æ¥ç€HttpClientè¿”å›æ¥çš„responseBodyæˆ–è€…Dioè¿”å›çš„response</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Province&gt; provinceList;</span><br><span class="line">provinceList = ProvinceList.getProvinceList(jsonResponse);</span><br></pre></td></tr></table></figure><p>provinceListå°±æ˜¯è¿”å›æ¥çš„æ•°æ®è½¬æˆçš„å®ä½“ç±»çš„å¯¹è±¡äº†ã€‚</p><h1 id="å¼‚æ­¥æ›´æ–°UI"><a href="#å¼‚æ­¥æ›´æ–°UI" class="headerlink" title="å¼‚æ­¥æ›´æ–°UI"></a>å¼‚æ­¥æ›´æ–°UI</h1><p>åœ¨æ­¤å¤„ä»‹ç»ä¸¤ç§æ–¹æ³•ï¼Œç¬¬ä¸€ç§æ˜¯æˆ‘è‡ªå·±æƒ³å‡ºæ¥çš„æ²™é›•æ–¹æ³•ï¼Œç¬¬äºŒç§æ˜¯é€šè¿‡Flutteræä¾›çš„ä¸“é—¨ç”¨äºå¼‚æ­¥æ›´æ–°UIçš„ç»„ä»¶FutureBuilderã€‚</p><h2 id="æ²™é›•æ–¹æ³•"><a href="#æ²™é›•æ–¹æ³•" class="headerlink" title="æ²™é›•æ–¹æ³•"></a>æ²™é›•æ–¹æ³•</h2><p>åœ¨æ­¤è¯´ä¸€ä¸‹æˆ‘è¿™ä¸ªæ–¹æ³•çš„æƒ³æ³•ã€‚</p><p>å¤§å®¶å¯ä»¥å›é¡¾ä¸‹æˆ‘ä¹‹å‰è®²Widgetçš„æ—¶å€™è¯´è¿‡ï¼ŒWidgetæœ‰ä¸€ä¸ªæ–¹æ³•initStateå¯ä»¥ç”¨æ¥åŠ è½½UIï¼Œä»¥åŠä¸€ä¸ªsetStateæ–¹æ³•å¯ç”¨æ¥æé†’Flutteré‡æ–°åŠ è½½UIã€‚</p><p>è¯´åˆ°è¿™å¾ˆå¤šåŒå­¦ä¸€å®šæƒ³åˆ°äº†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è·å–åˆ°æ•°æ®ä¹‹åé€šè¿‡setStateæ–¹æ³•æ¥æ›´æ–°UIã€‚</p><h3 id="è·å–åˆ°æ•°æ®"><a href="#è·å–åˆ°æ•°æ®" class="headerlink" title="è·å–åˆ°æ•°æ®"></a>è·å–åˆ°æ•°æ®</h3><p>è¿™ä¸ªä¸åŒå¤šè¯´ï¼Œä¸Šé¢è®²çš„å…¨éƒ½æ˜¯è·å–æ•°æ®ã€‚</p><h3 id="è®¾ç½®ä¸€ä¸ªç©ºçš„å®ä½“ç±»"><a href="#è®¾ç½®ä¸€ä¸ªç©ºçš„å®ä½“ç±»" class="headerlink" title="è®¾ç½®ä¸€ä¸ªç©ºçš„å®ä½“ç±»"></a>è®¾ç½®ä¸€ä¸ªç©ºçš„å®ä½“ç±»</h3><p>æ­¤å¤„æˆ‘è¿˜æ˜¯æ‹¿ä¸Šé¢çš„Province.dartæ¥åšä¾‹å­ã€‚æˆ‘ä»¬æ­£å¸¸æƒ…å†µä¸‹è·å–åˆ°çš„æ•°æ®è½¬æˆçš„å®ä½“ç±»çš„å¯¹è±¡æ˜¯<code>List&lt;Province&gt; provinceList</code>ã€‚æ‰€ä»¥æˆ‘ä»¬æ­¤å¤„å…ˆè®¾ç½®ä¸€ä¸ªç©ºçš„å¯¹è±¡:<code>List&lt;Province&gt; _provinceList</code>ã€‚</p><p>æ¥ç€åœ¨initStateé‡Œé¢è°ƒç”¨ç½‘ç»œè¯·æ±‚çš„æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@override</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">initState</span><span class="params">()</span> &#123;</span><br><span class="line">    getProvince();</span><br><span class="line">    <span class="built_in">super</span>.initState();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç„¶ååœ¨getProvinceæ–¹æ³•é‡Œé¢è·å–æ•°æ®ï¼Œå¹¶å°†æ•°æ®provinceListä¼ ç»™_provinceListï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">getProvince</span><span class="params">()</span> async &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">response</span> <span class="operator">=</span> await <span class="title function_">Dio</span><span class="params">()</span>.get(<span class="string">&quot;http://guolin.tech/api/china&quot;</span>);</span><br><span class="line">    provinceList = ProvinceList.getProvinceList(response);</span><br><span class="line">    setState(() &#123;</span><br><span class="line">        _provinces = provinceList;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥å½“è·å–åˆ°æ•°æ®çš„æ—¶å€™å°±é€šçŸ¥Flutteræ›´æ–°çŠ¶æ€äº†ã€‚è¿™ä¸ªæ—¶å€™æœ‰çš„åŒå­¦å¯èƒ½ä¼šé—®æˆ‘ï¼Œä½ è¿™ä¸ªä¹Ÿåªæ˜¯è·å–åˆ°æ•°æ®çš„æ—¶å€™æ‰æ›´æ–°å•Šï¼Œé‚£å½“è¿˜æ²¡è·å–åˆ°æ•°æ®çš„æ—¶å€™å‘¢ï¼Ÿ</p><p>è¿™å—å°±ä½“ç°åˆ°äº†ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦è®¾ç½®ä¸€ä¸ª_provincesäº†ã€‚</p><p>æˆ‘ä»¬å®Œå…¨å¯ä»¥åœ¨buildæ–¹æ³•è®¾ç½®ä¸‹ï¼Œåˆ¤æ–­ä¸‹_provincesä¸ºä¸ä¸ºç©º:å¦‚æœä¸ºç©ºï¼Œå°±è¯æ˜æ²¡æ•°æ®ï¼Œå°±åŠ è½½å…¶å®ƒé¡µé¢ï¼›å¦‚æœä¸ä¸ºç©ºï¼Œå°±è¯æ˜æœ‰æ•°æ®äº†ï¼Œé‚£å°±åŠ è½½æ•°æ®ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">body: _provinces == <span class="literal">null</span></span><br><span class="line">          ? <span class="keyword">new</span> <span class="title class_">Text</span>(<span class="string">&quot;æ­£åœ¨è¯·æ±‚&quot;</span>)</span><br><span class="line">          : <span class="keyword">new</span> <span class="title class_">ListView</span>.builder(</span><br><span class="line">          ... <span class="comment">//çœå»ä»£ç ï¼Œæ€»çš„æ¥è¯´å°±æ˜¯å°†_provincesçš„æ•°æ®åŠ è½½ListViewé‡Œé¢ï¼Œä¸€ä¸ªListViewçš„åŸºæœ¬æ„é€ æ–¹æ³•</span></span><br><span class="line">          )</span><br></pre></td></tr></table></figure></p><h2 id="FutureBuilder"><a href="#FutureBuilder" class="headerlink" title="FutureBuilder"></a>FutureBuilder</h2><p>å›å½’æ­£é¢˜ï¼Œæˆ‘ä¸Šé¢é‚£ä¸ªæ–¹æ³•çœŸçš„æ˜¯æœ‰å¤Ÿæ²™é›•çš„ã€‚</p><p>é‚£æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªåæ­£è¨€é¡ºçš„Flutteräº²ç”Ÿå„¿å­FutureBuilderã€‚</p><p>é¦–å…ˆæˆ‘ä»¬çœ‹ä¸‹å®šä¹‰ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FutureBuilder(&#123;</span><br><span class="line">  <span class="built_in">this</span>.future,</span><br><span class="line">  <span class="built_in">this</span>.initialData,</span><br><span class="line">  <span class="meta">@required</span> <span class="built_in">this</span>.builder,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><ul><li>futureï¼šå¼‚æ­¥ä»»åŠ¡ï¼›</li><li>initialDataï¼šåˆå§‹åŒ–æ•°æ®ï¼›</li><li>builderï¼šbuilderæ–¹æ³•ã€‚</li></ul><h3 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">body: FutureBuilder(</span><br><span class="line">    future: Dio().get(<span class="string">&quot;http://guolin.tech/api/china&quot;</span>),</span><br><span class="line">    builder: (BuildContext context, AsyncSnapshot snapshot) &#123;</span><br><span class="line">        <span class="keyword">if</span> (snapshot.connectionState == ConnectionState.done) &#123;</span><br><span class="line">            <span class="type">Response</span> <span class="variable">response</span> <span class="operator">=</span> snapshot.data;</span><br><span class="line">            print(response.toString());</span><br><span class="line">            <span class="comment">//å‘ç”Ÿé”™è¯¯</span></span><br><span class="line">            <span class="keyword">if</span> (snapshot.hasError) &#123;</span><br><span class="line">                <span class="keyword">return</span> Text(snapshot.error.toString());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            provinceList = ProvinceList.fromJson(response.data);</span><br><span class="line">            <span class="comment">//è¯·æ±‚æˆåŠŸï¼Œé€šè¿‡é¡¹ç›®ä¿¡æ¯æ„å»ºç”¨äºæ˜¾ç¤ºé¡¹ç›®åç§°çš„ListView</span></span><br><span class="line">            <span class="keyword">return</span> ListView.builder(</span><br><span class="line">                itemCount: provinceList.provinces.length,</span><br><span class="line">                itemBuilder: (context, index) &#123;</span><br><span class="line">                    <span class="keyword">return</span> GestureDetector(</span><br><span class="line">                        child: ListTile(</span><br><span class="line">                            title: Text(<span class="string">&quot;$&#123;provinceList.provinces[index].name&#125;&quot;</span>),</span><br><span class="line">                        ),</span><br><span class="line">                        onTap: () &#123;</span><br><span class="line">                            Navigator.push(context,</span><br><span class="line">                                MaterialPageRoute(builder: (context) &#123;</span><br><span class="line">                                    <span class="keyword">return</span> CityPageWidget(</span><br><span class="line">                                        cityID: provinceList.provinces[index].id);</span><br><span class="line">                                &#125;));</span><br><span class="line">                        &#125;,</span><br><span class="line">                    );</span><br><span class="line">                &#125;,</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è¯·æ±‚æœªå®Œæˆæ—¶å¼¹å‡ºloading</span></span><br><span class="line">        <span class="keyword">return</span> CircularProgressIndicator();</span><br><span class="line">    &#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Flutter/">Flutter</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Flutter/">Flutter</category>
      
      
      <comments>https://www.littlecorgi.top/posts/163d319c.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Flutterå…¥é—¨å¹¶å¼€å‘å¤©æ°”é¢„æŠ¥APP(6)â€”â€”å¤©æ°”é¢„æŠ¥ç¬¬ä¸€æ­¥-ç•Œé¢</title>
      <link>https://www.littlecorgi.top/posts/15395a84.html</link>
      <guid>https://www.littlecorgi.top/posts/15395a84.html</guid>
      <pubDate>Fri, 11 Oct 2019 13:21:40 GMT</pubDate>
      
      <description>&lt;p&gt;ç»è¿‡å‰é¢çš„å¯¹äºFlutterçš„ä»‹ç»ï¼Œæˆ‘ä»¬ç°åœ¨å·²ç»å¯ä»¥å¼€å§‹å†™æˆ‘ä»¬çš„å¤©æ°”é¢„æŠ¥APPçš„ç•Œé¢äº†ã€‚&lt;/p&gt;
&lt;p&gt;é¡¹ç›®Githubåœ°å€ï¼š&lt;a href=&quot;https://github.com/a1203991686/CoolWeather_Flutter&quot;&gt;a1203991686/CoolWeather_Flutter&lt;/a&gt;&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>ç»è¿‡å‰é¢çš„å¯¹äºFlutterçš„ä»‹ç»ï¼Œæˆ‘ä»¬ç°åœ¨å·²ç»å¯ä»¥å¼€å§‹å†™æˆ‘ä»¬çš„å¤©æ°”é¢„æŠ¥APPçš„ç•Œé¢äº†ã€‚</p><p>é¡¹ç›®Githubåœ°å€ï¼š<a href="https://github.com/a1203991686/CoolWeather_Flutter">a1203991686/CoolWeather_Flutter</a></p><span id="more"></span><h1 id="1-å¤§è‡´ç•Œé¢"><a href="#1-å¤§è‡´ç•Œé¢" class="headerlink" title="1. å¤§è‡´ç•Œé¢"></a>1. å¤§è‡´ç•Œé¢</h1><p>æœ€ç»ˆå†™æˆçš„å¤§è‡´ç•Œé¢å¦‚å›¾ï¼š</p><p><img src="https://cdn.littlecorgi.top/mweb/2019-10-11/Screenshot_1570712111.png" width = 50% /></p><p>æˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªç•Œé¢æ‹†åˆ†æˆå¦‚ä¸‹éƒ¨åˆ†ï¼š</p><p><img src="https://cdn.littlecorgi.top/mweb/2019-10-11/Screenshot_1570711214.png" width = 50% /></p><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬APPä¸»è¦æœ‰æœ€ä¸Šé¢ç”¨æ¥æ˜¾ç¤ºåœ°ç‚¹å’Œåˆ·æ–°æ—¶é—´çš„<code>Title</code>ã€æ˜¾ç¤ºæ¸©åº¦å’Œå¤©æ°”çš„ä¸¤ä¸ª<code>Text</code>ã€æ˜¾ç¤º3å¤©é¢„æŠ¥çš„<code>ListView</code>ã€æ˜¾ç¤ºç©ºæ°”è´¨é‡çš„<code>GridView</code>ã€ä»¥åŠæœ€åæ˜¾ç¤ºç”Ÿæ´»å»ºè®®çš„<code>ListView</code>ã€‚</p><p>æ­¤å¤„ä¼šç”¨åˆ°æˆ‘ä»¬å‰é¢å­¦è¿‡çš„æ‰€æœ‰çŸ¥è¯†ï¼Œå¦‚æœæœ‰åŒå­¦æ²¡æœ‰çœ‹è¿‡å‰é¢å†…å®¹çš„ï¼Œå¯ä»¥çœ‹ä¸‹æœ¬ç³»åˆ—å‰é¢çš„æ–‡ç« ã€‚</p><h1 id="2-åˆ›å»ºé¡¹ç›®"><a href="#2-åˆ›å»ºé¡¹ç›®" class="headerlink" title="2. åˆ›å»ºé¡¹ç›®"></a>2. åˆ›å»ºé¡¹ç›®</h1><p>é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„Flutteré¡¹ç›®ï¼š</p><ol><li>åœ¨AndroidStudioç‚¹å‡»<code>File</code>-&gt;<code>New Flutter Project</code>ï¼›</li><li>æ¥ç€é€‰æ‹©<code>Flutter Application</code>-&gt;<code>NEXT</code>ã€‚æ¥ç€å¡«å†™ä½ çš„é¡¹ç›®åç§°ç­‰ä¸€ç³»åˆ—ä¿¡æ¯åç‚¹å‡»<code>next</code>ï¼›<img src="https://cdn.littlecorgi.top/mweb/2019-10-11/New%20Flutter%20Project.png" alt="New Flutter Project"></li><li>æ¥ç€è¾“å…¥ä½ çš„ç»„ç»‡/å…¬å¸åç§°ä½œä¸ºåŒ…åï¼Œæœ€åç‚¹å‡»<code>Finish</code>å³å¯ï¼Œè¿™æ ·å°±æ–°å»ºäº†ä¸€ä¸ªFlutteré¡¹ç›®ï¼Œå¹¶ä¸”Flutterä¼šè‡ªåŠ¨ä¸ºä½ ç”Ÿæˆä¸€ä¸ªè®¡æ•°å™¨Demoï¼›<br> <img src="https://cdn.littlecorgi.top/mweb/2019-10-11/package%20new.png" alt="package ne"></li><li>è®©æˆ‘ä»¬æŠŠ<code>mian.dart</code>é‡Œé¢çš„æ‰€æœ‰æ³¨é‡Šä»¥åŠ<code>_MyHomePageState</code>é‡Œé¢çš„<code>build</code>æ–¹æ³•é‡Œé¢çš„ä»£ç éƒ½åˆ æ‰ï¼›</li><li>æ¥ç€åœ¨<code>lib</code>æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåå«<code>view</code>ï¼Œåˆ°æ—¶å€™æˆ‘ä»¬æŠŠæ‰€æœ‰ä¸ç•Œé¢æœ‰å…³çš„ä»£ç æ–‡ä»¶éƒ½æ”¾åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢ï¼›</li><li>ç„¶åæˆ‘ä»¬åœ¨<code>view</code>æ–‡ä»¶å¤¹ä¸‹é¢æ–°å»ºä¸€ä¸ªdartæ–‡ä»¶ï¼Œå‘½åä¸º<code>main_page</code>ã€‚è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬çš„å¤©æ°”è¯¦æƒ…é¡µã€‚</li></ol><h1 id="3-è®¾è®¡å¥½å¤©æ°”è¯¦æƒ…é¡µæ¡†æ¶"><a href="#3-è®¾è®¡å¥½å¤©æ°”è¯¦æƒ…é¡µæ¡†æ¶" class="headerlink" title="3. è®¾è®¡å¥½å¤©æ°”è¯¦æƒ…é¡µæ¡†æ¶"></a>3. è®¾è®¡å¥½å¤©æ°”è¯¦æƒ…é¡µæ¡†æ¶</h1><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦å¯¼å…¥<code>material</code>åŒ…ï¼Œæˆ‘ä»¬é¡¹ç›®ä¸»è¦ç”¨materialé£æ ¼UIæ¥å†™ã€‚</p><p>åœ¨å¼€å¤´è¾“å…¥<code>import &#39;package:flutter/material.dart&#39;;</code>ï¼Œè¿™æ ·å°±å¯¼å…¥äº†<code>material</code>åŒ…ã€‚æ¥ç€åˆ›å»ºæˆ‘ä»¬çš„ç•Œé¢ç±»<code>MainPage</code>ã€‚</p><p>ç”±äºæˆ‘ä»¬åœ¨åˆ°æ—¶å€™å†™å¥½ç½‘ç»œè¯·æ±‚åï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½å¾—ä»ç½‘ç»œè·å–ï¼Œå¹¶ä¸”ä½¿ç”¨äº†å¼‚æ­¥çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å…ˆæŠŠé¡µé¢åŠ è½½äº†ç„¶åç­‰è·å–çš„æ•°æ®å›æ¥äº†åœ¨é€šçŸ¥Flutteræ›´æ–°çŠ¶æ€ï¼Œæ‰€ä»¥è¿™å—æˆ‘ä»¬å¾—ä½¿ç”¨<code>StatefulWidget</code>ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainPage</span> <span class="keyword">extends</span> <span class="title class_">StatefulWidget</span> &#123;</span><br><span class="line">  MainPage(&#123;Key key&#125;) : <span class="built_in">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  MainPageState <span class="title function_">createState</span><span class="params">()</span> =&gt; <span class="keyword">new</span> <span class="title class_">MainPageState</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainPageState</span> <span class="keyword">extends</span> <span class="title class_">State</span>&lt;MainPage&gt; &#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget <span class="title function_">build</span><span class="params">(BuildContext context)</span> &#123;</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ¥ç€æˆ‘ä»¬å°±å¾—å¼€å§‹å†™<code>build()</code>é‡Œé¢çš„å†…å®¹äº†ã€‚ç”±äºæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå…¨å±çš„èƒŒæ™¯å›¾ç‰‡ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä½¿ç”¨<code>Container</code>ä½œä¸ºæˆ‘ä»¬æœ€å¤–å±‚çš„Widgetï¼Œå¹¶ä½¿ç”¨<code>BoxDecoration</code>è£…é¥°å®¹å™¨é…åˆ<code>DecorationImage</code>æ¥æ”¾ç½®å›¾ç‰‡ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@override</span></span><br><span class="line">Widget <span class="title function_">build</span><span class="params">(BuildContext context)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> Container(</span><br><span class="line">    decoration: BoxDecoration(</span><br><span class="line">      image: DecorationImage(</span><br><span class="line">        image: NetworkImage(<span class="string">&quot;http://blog.mrabit.com/bing/today&quot;</span>), <span class="comment">//å¿…åº”æ¯æ—¥ä¸€å›¾èƒŒæ™¯</span></span><br><span class="line">        fit: BoxFit.cover, <span class="comment">// è®¾ç½®ä¸ºå…¨å±</span></span><br><span class="line">      ),</span><br><span class="line">    ),</span><br><span class="line">    child: _weatherBody(),</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬çš„è¿è¡Œç»“æœå¦‚å›¾(â‘ ä½ èƒŒæ™¯å›¾ç‰‡å¤šåŠå’Œæˆ‘ä¸ä¸€æ ·ï¼Œå› ä¸ºä¸Šé¢é‚£ä¸ªUriè·å–çš„æ˜¯å¿…åº”çš„æ¯æ—¥ä¸€å›¾ï¼Œæ¯å¤©å›¾ç‰‡éƒ½ä¸ä¸€æ ·ï¼›â‘¡è¿è¡Œçš„æ—¶å€™è®°å¾—æŠŠ<code>child: _weatherBody(),</code>ç»™æ³¨é‡Šæ‰ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰å®šä¹‰<code>_weatherBody()</code>è¿™ä¸ªæ–¹æ³•):</p><p><img src="https://cdn.littlecorgi.top/mweb/2019-10-11/Screenshot_1570797585.png" width = 50% /></p><h1 id="4-è®¾è®¡title"><a href="#4-è®¾è®¡title" class="headerlink" title="4. è®¾è®¡title"></a>4. è®¾è®¡title</h1><p>ä¸ºäº†æ–¹ä¾¿æˆ‘å°±ç›´æ¥æŠŠå‰©ä¸‹çš„å¸ƒå±€å•é¢†å‡ºæ¥æ”¾åˆ°<code>_weatherBody()</code>è¿™ä¸ªæ–¹æ³•:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Widget <span class="title function_">_weatherBody</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ç”±äºæˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªæœ‰Titleçš„é¡µé¢ï¼Œæ‰€ä»¥æœ€å¤–å±‚æˆ‘é€‰ç”¨äº†Scaffoldï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Widget <span class="title function_">_weatherBody</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> Scaffold(</span><br><span class="line">    backgroundColor: Colors.transparent, <span class="comment">//èƒŒæ™¯é€æ˜</span></span><br><span class="line">    appBar: AppBar(</span><br><span class="line">      centerTitle: <span class="literal">true</span>,</span><br><span class="line">      title: Text(</span><br><span class="line">        <span class="string">&quot;åŒ—äº¬&quot;</span>,</span><br><span class="line">        style: TextStyle(fontSize: <span class="number">25.0</span>),</span><br><span class="line">      ),</span><br><span class="line">      backgroundColor: Colors.transparent, <span class="comment">//èƒŒæ™¯é€æ˜</span></span><br><span class="line">      actions: &lt;Widget&gt;[ <span class="comment">//å³ä¾§Widgetï¼Œç›¸å½“äºAndroid Toolbarä¸­çš„menu</span></span><br><span class="line">        Container(</span><br><span class="line">          alignment: Alignment.center, <span class="comment">//å‘ä¸­é—´å¯¹é½</span></span><br><span class="line">          child: Text(</span><br><span class="line">            <span class="string">&quot;12:10&quot;</span>,</span><br><span class="line">            textAlign: TextAlign.center, <span class="comment">//æ–‡å­—å‘ä¸­é—´å¯¹é½</span></span><br><span class="line">          ),</span><br><span class="line">        )</span><br><span class="line">      ],</span><br><span class="line">    ),</span><br><span class="line">    body: SingleChildScrollView( <span class="comment">// ç”±äºåˆ°æ—¶å€™æ•´ä¸ªé¡µé¢ä¸€ä¸ªå±å¹•å¯èƒ½æ”¾ä¸ä¸‹ï¼Œå°±æ”¾ç½®äº†ä¸€ä¸ªæ»šåŠ¨å¸ƒå±€</span></span><br><span class="line">    </span><br><span class="line">    ),</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªæ—¶å€™çš„è¿è¡Œç»“æœæ˜¯ï¼š</p><p><img src="https://cdn.littlecorgi.top/mweb/2019-10-11/Screenshot_1570797746.png" width = 50% /></p><h1 id="5-è®¾è®¡ä¸‹é¢å¤©æ°”é¢„æŠ¥é¡µé¢"><a href="#5-è®¾è®¡ä¸‹é¢å¤©æ°”é¢„æŠ¥é¡µé¢" class="headerlink" title="5. è®¾è®¡ä¸‹é¢å¤©æ°”é¢„æŠ¥é¡µé¢"></a>5. è®¾è®¡ä¸‹é¢å¤©æ°”é¢„æŠ¥é¡µé¢</h1><p>æ¥ä¸‹æ¥å¯ä»¥å¼€å§‹ä¸‹ä¸‹é¢çš„å¤©æ°”æ˜¾ç¤ºé¡µé¢äº†ã€‚</p><h2 id="å½“å‰æ¸©åº¦å’Œå¤©æ°”æƒ…å†µ"><a href="#å½“å‰æ¸©åº¦å’Œå¤©æ°”æƒ…å†µ" class="headerlink" title="å½“å‰æ¸©åº¦å’Œå¤©æ°”æƒ…å†µ"></a>å½“å‰æ¸©åº¦å’Œå¤©æ°”æƒ…å†µ</h2><p>é¦–å…ˆå†™ä¸€ä¸ªçºµå‘çº¿æ€§å¸ƒå±€<code>Column</code>:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">body: SingleChildScrollView(</span><br><span class="line">  child: Column(</span><br><span class="line">    children: &lt;Widget&gt;[</span><br><span class="line">      </span><br><span class="line">    ]</span><br><span class="line">  )</span><br><span class="line">),</span><br></pre></td></tr></table></figure><br>ç”±äºæˆ‘ä»¬è¦æ˜¾ç¤ºåœ¨å±å¹•æœ€å³è¾¹ï¼Œæ‰€ä»¥ä½¿ç”¨Align:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">body: SingleChildScrollView(</span><br><span class="line">  child: Column(</span><br><span class="line">    children: &lt;Widget&gt;[</span><br><span class="line">      Align(</span><br><span class="line">        alignment: Alignment.centerRight,</span><br><span class="line">        child:Text(</span><br><span class="line">          <span class="string">&quot;26Â°C&quot;</span>,</span><br><span class="line">          style: TextStyle(</span><br><span class="line">            fontSize: <span class="number">50.0</span>,</span><br><span class="line">            color: Colors.white,</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">      Align(</span><br><span class="line">        alignment: Alignment.centerRight,</span><br><span class="line">        child:Text(</span><br><span class="line">          <span class="string">&quot;é˜´&quot;</span>,</span><br><span class="line">          style: TextStyle(</span><br><span class="line">            fontSize: <span class="number">20.0</span>,</span><br><span class="line">            color: Colors.white,</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    ]</span><br><span class="line">  )</span><br><span class="line">),</span><br></pre></td></tr></table></figure></p><p>è¿è¡Œç»“æœæ˜¯ï¼š</p><p><img src="https://cdn.littlecorgi.top/mweb/2019-10-11/Screenshot_1570797847.png" width = 50% /></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦æ˜¾ç¤º3å¤©å¤©æ°”é¢„æŠ¥ã€å¤©æ°”è´¨é‡ä»¥åŠç”Ÿæ´»å»ºè®®çš„ä¸‰ä¸ªå­æ§ä»¶ï¼ŒåŒæ ·ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬ä¹ŸæŠŠä»–ä»¬ç»™å•é¢†å‡ºæ¥ï¼Œäºæ˜¯ä¸Šé¢çš„Columnæ¥ä¸‹æ¥å¯ä»¥è¿™æ ·å†™ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">body: SingleChildScrollView(</span><br><span class="line">  child: Column(</span><br><span class="line">    children: &lt;Widget&gt;[</span><br><span class="line">      ... <span class="comment">//ä¸Šé¢çš„ä¸¤ä¸ªText</span></span><br><span class="line">      Padding(</span><br><span class="line">        padding: EdgeInsets.only(</span><br><span class="line">          left: <span class="number">15.0</span>,</span><br><span class="line">          right: <span class="number">15.0</span>,</span><br><span class="line">          bottom: <span class="number">15.0</span>,</span><br><span class="line">        ),</span><br><span class="line">        child: Container(</span><br><span class="line">          color: Colors.black54,</span><br><span class="line">          child: _weatherList(), <span class="comment">//3å¤©å¤©æ°”é¢„æŠ¥</span></span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">      Padding(</span><br><span class="line">        padding: EdgeInsets.only(</span><br><span class="line">          left: <span class="number">15.0</span>,</span><br><span class="line">          right: <span class="number">15.0</span>,</span><br><span class="line">        ),</span><br><span class="line">        child: Container(</span><br><span class="line">          color: Colors.black54,</span><br><span class="line">          child: _atmosphereList(), <span class="comment">//ç©ºæ°”è´¨é‡</span></span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">      Padding(</span><br><span class="line">        padding: EdgeInsets.only(</span><br><span class="line">          top: <span class="number">15.0</span>,</span><br><span class="line">          left: <span class="number">15.0</span>,</span><br><span class="line">          right: <span class="number">15.0</span>,</span><br><span class="line">          bottom: <span class="number">15.0</span>,</span><br><span class="line">        ),</span><br><span class="line">        child: Container(</span><br><span class="line">          color: Colors.black54,</span><br><span class="line">          child: _lifestyleList(), <span class="comment">//ç”Ÿæ´»å»ºè®®</span></span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    ]</span><br><span class="line">  )</span><br><span class="line">),</span><br></pre></td></tr></table></figure></p><h2 id="3å¤©å¤©æ°”é¢„æŠ¥"><a href="#3å¤©å¤©æ°”é¢„æŠ¥" class="headerlink" title="3å¤©å¤©æ°”é¢„æŠ¥"></a>3å¤©å¤©æ°”é¢„æŠ¥</h2><p>å¯¹äº3å¤©å¤©æ°”é¢„æŠ¥æˆ‘ä»¬ä¸»è¦é€šè¿‡ListViewæ¥å®ç°ï¼Œç”±äºåˆ°æ—¶å€™æ•°æ®æ¯”è¾ƒçµæ´»ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ç›´æ¥ä½¿ç”¨ListView.Builderæ¥å®ç°ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; dates = [<span class="string">&quot;2019/10/01&quot;</span>, <span class="string">&quot;2019/10/02&quot;</span>, <span class="string">&quot;2019/10/03&quot;</span>];</span><br><span class="line">List&lt;String&gt; temperatures = [<span class="string">&quot;29/14&quot;</span>, <span class="string">&quot;30/18&quot;</span>, <span class="string">&quot;29/18&quot;</span>];</span><br><span class="line">List&lt;String&gt; texts = [<span class="string">&quot;é˜´&quot;</span>, <span class="string">&quot;æ™´&quot;</span>, <span class="string">&quot;é›¨&quot;</span>];</span><br><span class="line"></span><br><span class="line">Widget <span class="title function_">_weatherList</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Column(</span><br><span class="line">        children: &lt;Widget&gt;[</span><br><span class="line">            Align(</span><br><span class="line">                alignment: Alignment.centerLeft,</span><br><span class="line">                child: Text(</span><br><span class="line">                    <span class="string">&quot;é¢„æŠ¥&quot;</span>,</span><br><span class="line">                    style: TextStyle(</span><br><span class="line">                        color: Colors.white,</span><br><span class="line">                        fontSize: <span class="number">20.0</span>,</span><br><span class="line">                    ),</span><br><span class="line">                ),</span><br><span class="line">            ),</span><br><span class="line">            ListView.builder(</span><br><span class="line">                shrinkWrap: <span class="literal">true</span>, <span class="comment">//è¿™ä¸ªæ˜¯æŒ‡æ ¹æ®ListViewæ‰€æœ‰å­Widgetçš„é•¿åº¦æ¥è®¾å®šListViewçš„é•¿åº¦</span></span><br><span class="line">                physics: NeverScrollableScrollPhysics(), <span class="comment">//ç¦æ­¢ListViewè‡ªå·±çš„æ»‘åŠ¨ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨å¤–é¢ç”¨äº†ä¸ªSingleChildScrollViewï¼Œæˆ‘ä»¬é€šè¿‡ä»–çš„æ»‘åŠ¨å°±å¯ä»¥äº†</span></span><br><span class="line">                itemCount: dates.length, <span class="comment">//ListViewå­é¡¹ä¸ªæ•°</span></span><br><span class="line">                itemBuilder: (BuildContext context, <span class="type">int</span> index) &#123;</span><br><span class="line">                    <span class="keyword">return</span> ListTile(</span><br><span class="line">                        title: Row(</span><br><span class="line">                            mainAxisAlignment: MainAxisAlignment.spaceBetween, <span class="comment">//è¿™ä¸ªæ˜¯Rowçš„ä¸»è½´çš„å­é¡¹çš„åˆ†å¸ƒæ ¼å¼ï¼ŒspaceBetweenæ˜¯æŒ‡å¹³å‡åˆ†å¸ƒ</span></span><br><span class="line">                            mainAxisSize: MainAxisSize.max,</span><br><span class="line">                            children: &lt;Widget&gt;[</span><br><span class="line">                                Text(</span><br><span class="line">                                    <span class="string">&quot;$&#123;dates[index]&#125;&quot;</span>,</span><br><span class="line">                                    style: TextStyle(color: Colors.white),</span><br><span class="line">                                ),</span><br><span class="line">                                Text(</span><br><span class="line">                                    <span class="string">&quot;$&#123;temperatures[index]&#125;&quot;</span>,</span><br><span class="line">                                    style: TextStyle(color: Colors.white),</span><br><span class="line">                                ),</span><br><span class="line">                                Text(</span><br><span class="line">                                    <span class="string">&quot;$&#123;texts[index]&#125;&quot;</span>,</span><br><span class="line">                                    style: TextStyle(color: Colors.white),</span><br><span class="line">                                ),</span><br><span class="line">                            ],</span><br><span class="line">                        ),</span><br><span class="line">                    );</span><br><span class="line">                &#125;),</span><br><span class="line">        ],</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªæ—¶å€™è¿è¡Œç»“æœæ˜¯ï¼š</p><p><img src="https://cdn.littlecorgi.top/mweb/2019-10-11/Screenshot_1570798505.png" width = 50% /></p><h2 id="ç©ºæ°”è´¨é‡"><a href="#ç©ºæ°”è´¨é‡" class="headerlink" title="ç©ºæ°”è´¨é‡"></a>ç©ºæ°”è´¨é‡</h2><p>è¿™å—æˆ‘ä»¬éœ€è¦ç”¨åˆ°GridViewï¼Œç”±äºåªæœ‰ä¸¤ä¸ªæ˜¾ç¤ºå†…å®¹ï¼Œè€Œä¸”æˆ‘ä»¬åæœŸä¹Ÿæ²¡æœ‰éœ€è¦åŠ¨æ€æ·»åŠ çš„éœ€æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ç›´æ¥ä½¿ç”¨GridViewæ„é€ æ–¹æ³•ï¼Œè€Œä¸å»ä½¿ç”¨GridViewçš„builderæ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; atmospheres = [<span class="string">&quot;16&quot;</span>, <span class="string">&quot;56&quot;</span>];</span><br><span class="line"></span><br><span class="line">Widget <span class="title function_">_atmosphereList</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Column(</span><br><span class="line">        children: &lt;Widget&gt;[</span><br><span class="line">            Align(</span><br><span class="line">                alignment: Alignment.centerLeft,</span><br><span class="line">                child: Text(</span><br><span class="line">                    <span class="string">&quot;ç©ºæ°”è´¨é‡&quot;</span>,</span><br><span class="line">                    style: TextStyle(</span><br><span class="line">                        color: Colors.white,</span><br><span class="line">                            fontSize: <span class="number">20.0</span>,</span><br><span class="line">                    ),</span><br><span class="line">                ),</span><br><span class="line">            ),</span><br><span class="line">            GridView(</span><br><span class="line">                shrinkWrap: <span class="literal">true</span>, <span class="comment">//è§ä¸Šé¢3å¤©å¤©æ°”é¢„æŠ¥çš„ListViewå¤„</span></span><br><span class="line">                physics: NeverScrollableScrollPhysics(), <span class="comment">//è§ä¸Šé¢3å¤©å¤©æ°”é¢„æŠ¥çš„ListViewå¤„</span></span><br><span class="line">                gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(</span><br><span class="line">                    crossAxisCount: <span class="number">2</span>, <span class="comment">//æ¨ªè½´ä¸‰ä¸ªå­widget</span></span><br><span class="line">                    childAspectRatio: <span class="number">2</span> <span class="comment">//æ˜¾ç¤ºåŒºåŸŸå®½é«˜ç›¸ç­‰</span></span><br><span class="line">                ),</span><br><span class="line">                children: &lt;Widget&gt;[</span><br><span class="line">                    Column(</span><br><span class="line">                        children: &lt;Widget&gt;[</span><br><span class="line">                            Text(</span><br><span class="line">                                <span class="string">&quot;$&#123;atmospheres[0]&#125;&quot;</span>,</span><br><span class="line">                                style: TextStyle(</span><br><span class="line">                                    color: Colors.white,</span><br><span class="line">                                    fontSize: <span class="number">40.0</span>,</span><br><span class="line">                                ),</span><br><span class="line">                            ),</span><br><span class="line">                            Text(</span><br><span class="line">                                <span class="string">&quot;èƒ½è§åº¦&quot;</span>,</span><br><span class="line">                                style: TextStyle(</span><br><span class="line">                                    color: Colors.white,</span><br><span class="line">                                    fontSize: <span class="number">20.0</span>,</span><br><span class="line">                                ),</span><br><span class="line">                            ),</span><br><span class="line">                        ],</span><br><span class="line">                    ),</span><br><span class="line">                    Column(</span><br><span class="line">                        children: &lt;Widget&gt;[</span><br><span class="line">                            Text(</span><br><span class="line">                                <span class="string">&quot;$&#123;atmospheres[1]&#125;&quot;</span>,</span><br><span class="line">                                style: TextStyle(</span><br><span class="line">                                    color: Colors.white,</span><br><span class="line">                                    fontSize: <span class="number">40.0</span>,</span><br><span class="line">                                ),</span><br><span class="line">                            ),</span><br><span class="line">                            Text(</span><br><span class="line">                                <span class="string">&quot;æ¹¿åº¦&quot;</span>,</span><br><span class="line">                                style: TextStyle(</span><br><span class="line">                                    color: Colors.white,</span><br><span class="line">                                    fontSize: <span class="number">20.0</span>,</span><br><span class="line">                                ),</span><br><span class="line">                            ),</span><br><span class="line">                        ],</span><br><span class="line">                    ),</span><br><span class="line">                ],</span><br><span class="line">            ),</span><br><span class="line">        ],</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿è¡Œåçš„æ•ˆæœæ˜¯ï¼š</p><p><img src="https://cdn.littlecorgi.top/mweb/2019-10-11/Screenshot_1570799107.png" width = 50% /></p><h2 id="ç”Ÿæ´»å»ºè®®"><a href="#ç”Ÿæ´»å»ºè®®" class="headerlink" title="ç”Ÿæ´»å»ºè®®"></a>ç”Ÿæ´»å»ºè®®</h2><p>è¿™å—å’Œ3å¤©å¤©æ°”é¢„æŠ¥ä¸€æ ·ï¼Œè€Œä¸”æ•°æ®æ¯”3å¤©å¤©æ°”é¢„æŠ¥æ›´å¤šï¼Œæ‰€ä»¥ä»–æ›´é€‚åˆç”¨ListView.builderï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; _lifestyleWeatherBrf = [</span><br><span class="line">    <span class="string">&quot;è¾ƒèˆ’é€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è¾ƒèˆ’é€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;é€‚å®œ&quot;</span>,</span><br><span class="line">    <span class="string">&quot;é€‚å®œ&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å¼±&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è¾ƒé€‚å®œ&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ä¸­&quot;</span></span><br><span class="line">];</span><br><span class="line">List&lt;String&gt; _lifestyleWeatherTxt = [</span><br><span class="line">    <span class="string">&quot;ç™½å¤©å¤©æ°”æ™´å¥½ï¼Œæ—©æ™šä¼šæ„Ÿè§‰åå‡‰ï¼Œåˆåèˆ’é€‚ã€å®œäººã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å»ºè®®ç€è–„å¤–å¥—ã€å¼€è¡«ç‰›ä»”è¡«è£¤ç­‰æœè£…ã€‚å¹´è€ä½“å¼±è€…åº”é€‚å½“æ·»åŠ è¡£ç‰©ï¼Œå®œç€å¤¹å…‹è¡«ã€è–„æ¯›è¡£ç­‰ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å„é¡¹æ°”è±¡æ¡ä»¶é€‚å®œï¼Œæ— æ˜æ˜¾é™æ¸©è¿‡ç¨‹ï¼Œå‘ç”Ÿæ„Ÿå†’æœºç‡è¾ƒä½ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å¤©æ°”è¾ƒå¥½ï¼Œèµ¶å¿«æŠ•èº«å¤§è‡ªç„¶å‚ä¸æˆ·å¤–è¿åŠ¨ï¼Œå°½æƒ…æ„Ÿå—è¿åŠ¨çš„å¿«ä¹å§ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å¤©æ°”è¾ƒå¥½ï¼Œä½†ä¸æ¯«ä¸ä¼šå½±å“æ‚¨å‡ºè¡Œçš„å¿ƒæƒ…ã€‚æ¸©åº¦é€‚å®œåˆæœ‰å¾®é£ç›¸ä¼´ï¼Œé€‚å®œæ—…æ¸¸ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ç´«å¤–çº¿å¼ºåº¦è¾ƒå¼±ï¼Œå»ºè®®å‡ºé—¨å‰æ¶‚æ“¦SPFåœ¨12-15ä¹‹é—´ã€PA+çš„é˜²æ™’æŠ¤è‚¤å“ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è¾ƒé€‚å®œæ´—è½¦ï¼Œæœªæ¥ä¸€å¤©æ— é›¨ï¼Œé£åŠ›è¾ƒå°ï¼Œæ“¦æ´—ä¸€æ–°çš„æ±½è½¦è‡³å°‘èƒ½ä¿æŒä¸€å¤©ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;,æ°”è±¡æ¡ä»¶å¯¹ç©ºæ°”æ±¡æŸ“ç‰©ç¨€é‡Šã€æ‰©æ•£å’Œæ¸…é™¤æ— æ˜æ˜¾å½±å“ï¼Œæ˜“æ„Ÿäººç¾¤åº”é€‚å½“å‡å°‘å®¤å¤–æ´»åŠ¨æ—¶é—´ã€‚&quot;</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">Widget <span class="title function_">_lifestyleList</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Column(</span><br><span class="line">        children: &lt;Widget&gt;[</span><br><span class="line">            Align(</span><br><span class="line">                alignment: Alignment.centerLeft,</span><br><span class="line">                child: Text(</span><br><span class="line">                    <span class="string">&quot;ç”Ÿæ´»å»ºè®®&quot;</span>,</span><br><span class="line">                    style: TextStyle(</span><br><span class="line">                        color: Colors.white,</span><br><span class="line">                        fontSize: <span class="number">20.0</span>,</span><br><span class="line">                    ),</span><br><span class="line">                ),</span><br><span class="line">            ),</span><br><span class="line">            ListView.builder(</span><br><span class="line">                shrinkWrap: <span class="literal">true</span>,</span><br><span class="line">                physics: NeverScrollableScrollPhysics(),</span><br><span class="line">                itemCount: _lifestyleWeatherBrf.length,</span><br><span class="line">                itemBuilder: (BuildContext context, <span class="type">int</span> index) &#123;</span><br><span class="line">                    <span class="keyword">return</span> ListTile(</span><br><span class="line">                        title: Column(</span><br><span class="line">                            mainAxisAlignment: MainAxisAlignment.start,</span><br><span class="line">                            crossAxisAlignment: CrossAxisAlignment.start,</span><br><span class="line">                            children: &lt;Widget&gt;[</span><br><span class="line">                                Text(</span><br><span class="line">                                    <span class="string">&quot;$&#123;_lifestyleWeatherBrf[index]&#125;&quot;</span>,</span><br><span class="line">                                    style: TextStyle(</span><br><span class="line">                                        color: Colors.white,</span><br><span class="line">                                    ),</span><br><span class="line">                                ),</span><br><span class="line">                                Text(</span><br><span class="line">                                    <span class="string">&quot;$&#123;_lifestyleWeatherTxt[index]&#125;&quot;</span>,</span><br><span class="line">                                    style: TextStyle(</span><br><span class="line">                                        color: Colors.white,</span><br><span class="line">                                    ),</span><br><span class="line">                                ),</span><br><span class="line">                            ],</span><br><span class="line">                        ),</span><br><span class="line">                    );</span><br><span class="line">                &#125;,</span><br><span class="line">            ),</span><br><span class="line">        ],</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿è¡Œç»“æœæ˜¯:</p><p><img src="https://cdn.littlecorgi.top/mweb/2019-10-11/Screenshot_1570799686.png" width = 50% /></p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Flutter/">Flutter</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Flutter/">Flutter</category>
      
      
      <comments>https://www.littlecorgi.top/posts/15395a84.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Flutterå…¥é—¨å¹¶å¼€å‘å¤©æ°”é¢„æŠ¥APP(5)â€”â€”SingleChildScrollViewã€ListViewå’ŒGridView</title>
      <link>https://www.littlecorgi.top/posts/30ff421d.html</link>
      <guid>https://www.littlecorgi.top/posts/30ff421d.html</guid>
      <pubDate>Thu, 10 Oct 2019 14:08:38 GMT</pubDate>
      
      <description>&lt;p&gt;ä¸‹é¢æˆ‘ä»¬æ¥ä»‹ç»ä¸‹Flutterä¸­çš„æ»‘åŠ¨æ§ä»¶&lt;code&gt;SingleChildScrollView&lt;/code&gt;ã€åˆ—è¡¨&lt;code&gt;ListView&lt;/code&gt;å’Œè¡¨æ ¼&lt;code&gt;GridView&lt;/code&gt;ã€‚&lt;br&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>ä¸‹é¢æˆ‘ä»¬æ¥ä»‹ç»ä¸‹Flutterä¸­çš„æ»‘åŠ¨æ§ä»¶<code>SingleChildScrollView</code>ã€åˆ—è¡¨<code>ListView</code>å’Œè¡¨æ ¼<code>GridView</code>ã€‚<br><span id="more"></span></p><h1 id="SingleChildScrollView"><a href="#SingleChildScrollView" class="headerlink" title="SingleChildScrollView"></a>SingleChildScrollView</h1><p><code>SingleChildScrollView</code>ç±»ä¼¼äºAndroidä¸­çš„<code>ScrollView</code>ï¼Œæˆ‘ä½¿ç”¨çš„è¾ƒæµ…ï¼Œåœ¨æˆ‘ç›®å‰çœ‹æ¥ï¼Œä»–å’Œ<code>ScrollView</code>çš„å”¯ä¸€åŒºåˆ«å°±æ˜¯å®ƒè¿˜å¯ä»¥æ¨ªå‘æ»šåŠ¨ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ä»–çš„å®šä¹‰ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SingleChildScrollView(&#123;</span><br><span class="line">  <span class="built_in">this</span>.scrollDirection = Axis.vertical, <span class="comment">//æ»šåŠ¨æ–¹å‘ï¼Œé»˜è®¤æ˜¯å‚ç›´æ–¹å‘</span></span><br><span class="line">  <span class="built_in">this</span>.reverse = <span class="literal">false</span>, </span><br><span class="line">  <span class="built_in">this</span>.padding, </span><br><span class="line">  bool primary, </span><br><span class="line">  <span class="built_in">this</span>.physics, </span><br><span class="line">  <span class="built_in">this</span>.controller,</span><br><span class="line">  <span class="built_in">this</span>.child,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><ul><li><code>scrollDirection</code>ï¼šè®¾å®šæ»šåŠ¨çš„æ–¹å‘ï¼Œå¯ä»¥è®¾å®š<code>Axis.vertical</code>æˆ–è€…<code>Axis.horizon</code>ï¼›</li><li><code>reverse</code>ï¼šæ˜¯å¦æŒ‰ç…§é˜…è¯»æ–¹å‘çš„åæ–¹å‘æ»‘åŠ¨ï¼Œemmmè¿™ä¸ªå¯èƒ½æœ‰ç‚¹è§‰å¾—è«åå…¶å¦™ï¼Œä½†æ˜¯å¦‚é˜¿æ‹‰ä¼¯è¯­è¨€åœ°åŒºï¼Œä»–ä»¬é˜…è¯»å’Œæˆ‘å›½å¤æ—¶å€™ä¸€æ ·æ˜¯ä»å³å‘å·¦çš„ï¼Œæ‰€ä»¥å¦‚æœ<code>reverse</code>ä¸º<code>true</code>ï¼Œä¸”æ»šåŠ¨æ–¹å‘æ˜¯æ°´å¹³æ»šåŠ¨çš„è¯ï¼Œå¦‚æœç³»ç»Ÿæ—¶é˜¿æ‹‰ä¼¯è¯­ç­‰ä»å³å‘å·¦é˜…è¯»çš„è¯­è¨€æ—¶ï¼Œæ–¹å‘æ˜¯ä»å³å‘å·¦çš„ï¼›</li><li><code>padding</code>ï¼šç•™ç™½çš„å¤§å°ï¼Œå’Œ<code>Padding</code>çš„ç”¨æ³•ä¸€æ ·ï¼Œé€šè¿‡<code>EdgeInsets</code>æ¥è®¾å®šï¼Œå…·ä½“å¯ä»¥çœ‹å‰å‡ ç« å°†FlutteråŸºç¡€Widgetï¼›</li><li><code>primary</code>ï¼šæŒ‡æ˜¯å¦ä½¿ç”¨widgetæ ‘ä¸­é»˜è®¤çš„<code>PrimaryScrollController</code>ï¼›å½“æ»‘åŠ¨æ–¹å‘ä¸ºå‚ç›´æ–¹å‘ï¼ˆ<code>scrollDirection</code>å€¼ä¸º<code>Axis.vertical</code>ï¼‰å¹¶ä¸”æ²¡æœ‰æŒ‡å®š<code>controller</code>æ—¶ï¼Œ<code>primary</code>é»˜è®¤ä¸º<code>true</code>ï¼›</li><li><code>physics</code>ï¼šç”¨äºæ§åˆ¶æ»šåŠ¨æ–¹å¼ï¼Œè¿™ä¸ªç­‰ä¼šé‡ç‚¹è®²è§£ï¼›</li><li><code>controller</code>ï¼šç”¨äºæ»šåŠ¨ç›‘å¬åŠæ§åˆ¶ï¼›</li><li><code>child</code>ï¼šå­Widgetã€‚</li></ul><h2 id="physics"><a href="#physics" class="headerlink" title="physics"></a>physics</h2><p>è¿™ä¸ªå‚æ•°æ˜¯ç”¨äºæ§åˆ¶æ»šåŠ¨æ–¹å¼ï¼Œæœ‰å‡ ç§å‚æ•°ï¼š</p><ul><li><code>NeverScrollablePhysics</code>ï¼šå‘ˆç°ä¸å¯æ»šåŠ¨çŠ¶æ€ï¼›</li><li><p><code>BouncingScrollPhysics</code>ï¼šå½“åˆ—è¡¨æ»‘åŠ¨ç»“æŸæ—¶ï¼Œä¼šå›å¼¹åˆ—è¡¨ï¼Œç±»ä¼¼äºiOSçš„åˆ—è¡¨æ»‘åŠ¨æ•ˆæœï¼›<br><img src="https://cdn.littlecorgi.top/mweb/2019-10-10/BouncingScrollPhysics.gif" alt="BouncingScrollPhysics"></p></li><li><p><code>ClampingScrollPhysics</code>ï¼šæ»‘åŠ¨ç»“æŸæ—¶ä¼šæ˜¾ç¤ºæ°´æ³¢çº¹é˜´å½±ï¼Œç±»ä¼¼äºAndroidçš„åˆ—è¡¨æ»‘åŠ¨æ•ˆæœï¼›<br><img src="https://cdn.littlecorgi.top/mweb/2019-10-10/ClampingScrollPhysics.gif" alt="ClampingScrollPhysics"></p></li><li><p><code>FixedExtentScrollPhysics</code>ï¼šå¯ä»¥è‡ªå·±åˆ¶ä½œæ»‘åŠ¨æ•ˆæœï¼Œä½†æ˜¯æˆ‘ä¹Ÿä¸ä¼šï¼Œæ‰€ä»¥åœ¨æ­¤ä¸åšè§£é‡ŠğŸ˜ã€‚</p></li></ul><h1 id="ListView"><a href="#ListView" class="headerlink" title="ListView"></a>ListView</h1><p><code>ListView</code>å¯ä»¥æ²¿ä¸€ä¸ªæ–¹å‘ä¸Šçº¿æ€§æ’å¸ƒæ‰€æœ‰å­ç»„ä»¶ï¼ˆä¸ä»…å±€é™äºç«–ç›´æ–¹å‘ï¼‰ã€‚</p><p>è®©æˆ‘ä»¬æ¥çœ‹ä¸‹ä»–çš„å®šä¹‰ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ListView(&#123;</span><br><span class="line">  ...  </span><br><span class="line">  <span class="comment">//å¯æ»šåŠ¨widgetå…¬å…±å‚æ•°</span></span><br><span class="line">  <span class="type">Axis</span> <span class="variable">scrollDirection</span> <span class="operator">=</span> Axis.vertical,</span><br><span class="line">  <span class="type">bool</span> <span class="variable">reverse</span> <span class="operator">=</span> <span class="literal">false</span>,</span><br><span class="line">  ScrollController controller,</span><br><span class="line">  bool primary,</span><br><span class="line">  ScrollPhysics physics,</span><br><span class="line">  EdgeInsetsGeometry padding,</span><br><span class="line"></span><br><span class="line">  <span class="comment">//ListViewå„ä¸ªæ„é€ å‡½æ•°çš„å…±åŒå‚æ•°  </span></span><br><span class="line">  <span class="type">double</span> itemExtent,</span><br><span class="line">  <span class="type">bool</span> <span class="variable">shrinkWrap</span> <span class="operator">=</span> <span class="literal">false</span>,</span><br><span class="line">  <span class="type">bool</span> <span class="variable">addAutomaticKeepAlives</span> <span class="operator">=</span> <span class="literal">true</span>,</span><br><span class="line">  <span class="type">bool</span> <span class="variable">addRepaintBoundaries</span> <span class="operator">=</span> <span class="literal">true</span>,</span><br><span class="line">  <span class="type">double</span> cacheExtent,</span><br><span class="line"></span><br><span class="line">  <span class="comment">//å­widgetåˆ—è¡¨</span></span><br><span class="line">  List&lt;Widget&gt; children = const &lt;Widget&gt;[],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><br>å…¬å…±å±æ€§æˆ‘ä»¬å°±ä¸è®²äº†ï¼Œä¸Šé¢<code>SingleChildScrollView</code>å·²ç»è®²è¿‡äº†ï¼Œæˆ‘ä»¬ç°åœ¨åªè®²ä»–ç‰¹æœ‰çš„ï¼š</p><ul><li><code>itemExtent</code>ï¼šç”¨äºæ§åˆ¶<code>ListView</code>çš„é•¿åº¦ï¼Œå¦‚æœä¸ä¸º<code>null</code>ï¼Œåˆ™å¼ºåˆ¶æ‰€æœ‰å­Widgetåˆèµ·æ¥çš„é•¿åº¦å°äºè®¾å®šçš„å€¼ï¼šå¦‚æœ<code>ListView</code>æ˜¯æ¨ªå‘çš„ï¼Œåˆ™æ‰€æœ‰å­Widgetæ¨ªå‘é•¿åº¦çš„å’Œå°äºå®ƒï¼›å¦‚æœ<code>ListView</code>æ˜¯çºµå‘çš„ï¼Œåˆ™æ‰€æœ‰å­Widgetçºµå‘é•¿åº¦çš„å’Œå°äºå®ƒï¼›</li><li><code>shrinkWrap</code>ï¼šè¯¥å±æ€§è¡¨ç¤ºæ˜¯å¦æ ¹æ®å­ç»„ä»¶çš„æ€»é•¿åº¦æ¥è®¾ç½®<code>ListView</code>çš„é•¿åº¦ï¼Œé»˜è®¤å€¼ä¸º<code>false</code> ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>ListView</code>çš„ä¼šåœ¨æ»šåŠ¨æ–¹å‘å°½å¯èƒ½å¤šçš„å ç”¨ç©ºé—´ã€‚å½“<code>ListView</code>åœ¨ä¸€ä¸ªæ— è¾¹ç•Œ(æ»šåŠ¨æ–¹å‘ä¸Š)çš„å®¹å™¨ä¸­æ—¶ï¼Œ<code>shrinkWrap</code>å¿…é¡»ä¸º<code>true</code>ï¼›</li><li><code>addAutomaticKeepAlives</code>ï¼šè¯¥å±æ€§è¡¨ç¤ºæ˜¯å¦å°†åˆ—è¡¨é¡¹ï¼ˆå­ç»„ä»¶ï¼‰åŒ…è£¹åœ¨<code>AutomaticKeepAlive</code>ç»„ä»¶ä¸­ï¼›å…¸å‹åœ°ï¼Œåœ¨ä¸€ä¸ªæ‡’åŠ è½½åˆ—è¡¨ä¸­ï¼Œå¦‚æœå°†åˆ—è¡¨é¡¹åŒ…è£¹åœ¨<code>AutomaticKeepAlive</code>ä¸­ï¼Œåœ¨è¯¥åˆ—è¡¨é¡¹æ»‘å‡ºè§†å£æ—¶å®ƒä¹Ÿä¸ä¼šè¢«<code>GCï¼ˆåƒåœ¾å›æ”¶ï¼‰</code>ï¼Œå®ƒä¼šä½¿ç”¨<code>KeepAliveNotification</code>æ¥ä¿å­˜å…¶çŠ¶æ€ã€‚å¦‚æœåˆ—è¡¨é¡¹è‡ªå·±ç»´æŠ¤å…¶<code>KeepAlive</code>çŠ¶æ€ï¼Œé‚£ä¹ˆæ­¤å‚æ•°å¿…é¡»ç½®ä¸º<code>false</code>ï¼›</li><li><code>addRepaintBoundaries</code>ï¼šè¯¥å±æ€§è¡¨ç¤ºæ˜¯å¦å°†åˆ—è¡¨é¡¹ï¼ˆå­ç»„ä»¶ï¼‰åŒ…è£¹åœ¨<code>RepaintBoundary</code>ç»„ä»¶ä¸­ã€‚å½“å¯æ»šåŠ¨ç»„ä»¶æ»šåŠ¨æ—¶ï¼Œå°†åˆ—è¡¨é¡¹åŒ…è£¹åœ¨<code>RepaintBoundary</code>ä¸­å¯ä»¥é¿å…åˆ—è¡¨é¡¹é‡ç»˜ï¼Œä½†æ˜¯å½“åˆ—è¡¨é¡¹é‡ç»˜çš„å¼€é”€éå¸¸å°ï¼ˆå¦‚ä¸€ä¸ªé¢œè‰²å—ï¼Œæˆ–è€…ä¸€ä¸ªè¾ƒçŸ­çš„æ–‡æœ¬ï¼‰æ—¶ï¼Œä¸æ·»åŠ <code>RepaintBoundary</code>åè€Œä¼šæ›´é«˜æ•ˆã€‚å’Œ<code>addAutomaticKeepAlive</code>ä¸€æ ·ï¼Œå¦‚æœåˆ—è¡¨é¡¹è‡ªå·±ç»´æŠ¤å…¶<code>KeepAlive</code>çŠ¶æ€ï¼Œé‚£ä¹ˆæ­¤å‚æ•°å¿…é¡»ç½®ä¸º<code>false</code>ï¼›</li><li><code>cacheExtent</code>ï¼šè®¾å®šç¼“å­˜å¤§å°ã€‚</li></ul><p>é»˜è®¤æƒ…å†µä¸‹ä¸€ä¸ªä¸€ä¸ªè®¾å®š<code>children</code>å¾ˆéº»çƒ¦ï¼Œæ‰€ä»¥ä¸ºäº†æ–¹ä¾¿ï¼ŒFlutterè¿˜æä¾›äº†ä¸€ä¸ª<code>builder</code>æ„é€ æ–¹æ³•ï¼š</p><h2 id="ListView-builder"><a href="#ListView-builder" class="headerlink" title="ListView.builder"></a>ListView.builder</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ListView.builder(&#123;</span><br><span class="line">  <span class="comment">// ListViewå…¬å…±å‚æ•°å·²çœç•¥  </span></span><br><span class="line">  ...</span><br><span class="line">  <span class="meta">@required</span> IndexedWidgetBuilder itemBuilder,</span><br><span class="line">  <span class="type">int</span> itemCount,</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li><code>itemCount</code>ï¼šæ˜¯éœ€è¦åŠ è½½å­Widgetçš„é•¿åº¦ï¼›</li><li><code>itemBuilder</code>ï¼šåˆ—è¡¨é¡¹çš„æ„é€ å™¨ï¼Œå½“åˆ—è¡¨æ»šåŠ¨åˆ°å…·ä½“çš„<code>index</code>ä½ç½®æ—¶ï¼Œä¼šè°ƒç”¨è¯¥æ„å»ºå™¨æ„å»ºåˆ—è¡¨é¡¹ã€‚</li></ul><p>çœ‹ä¾‹å­ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ListView.builder(</span><br><span class="line">  itemCount: _provinces.length,</span><br><span class="line">  itemBuilder: (context, index) &#123;</span><br><span class="line">    <span class="keyword">return</span> GestureDetector(</span><br><span class="line">      child: ListTile(</span><br><span class="line">        title: Text(<span class="string">&quot;$index&quot;</span>),</span><br><span class="line">      ),</span><br><span class="line">      onTap: () &#123;&#125;));</span><br><span class="line">      &#125;,</span><br><span class="line">    );</span><br><span class="line">  &#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure><br><img src="https://cdn.littlecorgi.top/mweb/2019-10-10/ListViewBUilder.png" alt="ListViewBUilde"></p><h2 id="ListView-separated"><a href="#ListView-separated" class="headerlink" title="ListView.separated"></a>ListView.separated</h2><p>ç”¨äºæ·»åŠ åˆ†å‰²çº¿ã€‚ç›¸è¾ƒäº<code>ListView.builder</code>å¤šäº†ä¸€ä¸ª<code>separatorBuilder</code>å‚æ•°ï¼Œè¯¥å‚æ•°æ˜¯ä¸€ä¸ªåˆ†å‰²ç»„ä»¶ç”Ÿæˆå™¨ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ï¼šå¥‡æ•°è¡Œæ·»åŠ ä¸€æ¡è“è‰²ä¸‹åˆ’çº¿ï¼Œå¶æ•°è¡Œæ·»åŠ ä¸€æ¡ç»¿è‰²ä¸‹åˆ’çº¿ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ListView3</span> <span class="keyword">extends</span> <span class="title class_">StatelessWidget</span> &#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget <span class="title function_">build</span><span class="params">(BuildContext context)</span> &#123;</span><br><span class="line">    <span class="comment">//ä¸‹åˆ’çº¿widgeté¢„å®šä¹‰ä»¥ä¾›å¤ç”¨ã€‚  </span></span><br><span class="line">    Widget divider1=Divider(color: Colors.blue,);</span><br><span class="line">    Widget divider2=Divider(color: Colors.green);</span><br><span class="line">    <span class="keyword">return</span> ListView.separated(</span><br><span class="line">        itemCount: <span class="number">100</span>,</span><br><span class="line">        <span class="comment">//åˆ—è¡¨é¡¹æ„é€ å™¨</span></span><br><span class="line">        itemBuilder: (BuildContext context, <span class="type">int</span> index) &#123;</span><br><span class="line">          <span class="keyword">return</span> ListTile(title: Text(<span class="string">&quot;$index&quot;</span>));</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">//åˆ†å‰²å™¨æ„é€ å™¨</span></span><br><span class="line">        separatorBuilder: (BuildContext context, <span class="type">int</span> index) &#123;</span><br><span class="line">          <span class="keyword">return</span> index%<span class="number">2</span>==<span class="number">0</span>?divider1:divider2;</span><br><span class="line">        &#125;,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><img src="https://cdn.jsdelivr.net/gh/flutterchina/flutter-in-action/docs/imgs/6-3.png" alt="-w160"></p><h1 id="GridView"><a href="#GridView" class="headerlink" title="GridView"></a>GridView</h1><p><code>GridView</code>å¯ä»¥æ„é€ ä¸€ä¸ªç½‘æ ¼åˆ—è¡¨ï¼Œå®šä¹‰å¦‚ä¸‹:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GridView(&#123;</span><br><span class="line">  <span class="type">Axis</span> <span class="variable">scrollDirection</span> <span class="operator">=</span> Axis.vertical,</span><br><span class="line">  <span class="type">bool</span> <span class="variable">reverse</span> <span class="operator">=</span> <span class="literal">false</span>,</span><br><span class="line">  ScrollController controller,</span><br><span class="line">  bool primary,</span><br><span class="line">  ScrollPhysics physics,</span><br><span class="line">  <span class="type">bool</span> <span class="variable">shrinkWrap</span> <span class="operator">=</span> <span class="literal">false</span>,</span><br><span class="line">  EdgeInsetsGeometry padding,</span><br><span class="line">  <span class="meta">@required</span> SliverGridDelegate gridDelegate, <span class="comment">//æ§åˆ¶å­widget layoutçš„å§”æ‰˜</span></span><br><span class="line">  <span class="type">bool</span> <span class="variable">addAutomaticKeepAlives</span> <span class="operator">=</span> <span class="literal">true</span>,</span><br><span class="line">  <span class="type">bool</span> <span class="variable">addRepaintBoundaries</span> <span class="operator">=</span> <span class="literal">true</span>,</span><br><span class="line">  <span class="type">double</span> cacheExtent,</span><br><span class="line">  List&lt;Widget&gt; children = const &lt;Widget&gt;[],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><br>å¤§éƒ¨åˆ†å‚æ•°å’Œ<code>ListView</code>éƒ½ç›¸åŒï¼Œæˆ‘ä»¬åªå…³æ³¨<code>gridDelegate</code>è¿™ä¸ªå‚æ•°ï¼š<br><code>gridDelegate</code>ä½œç”¨æ˜¯æ§åˆ¶<code>GridView</code>å­ç»„ä»¶å¦‚ä½•æ’åˆ—ï¼ŒFlutterä¸­æä¾›äº†ä¸¤ä¸ªç±»<code>SliverGridDelegateWithFixedCrossAxisCount</code>å’Œ<code>SliverGridDelegateWithMaxCrossAxisExtent</code>ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¸‹é¢æˆ‘ä»¬åˆ†åˆ«æ¥ä»‹ç»ä¸€ä¸‹å®ƒä»¬ã€‚</p><h2 id="SliverGridDelegateWithFixedCrossAxisCount"><a href="#SliverGridDelegateWithFixedCrossAxisCount" class="headerlink" title="SliverGridDelegateWithFixedCrossAxisCount"></a>SliverGridDelegateWithFixedCrossAxisCount</h2><p>è¯¥å­ç±»å®ç°äº†ä¸€ä¸ªæ¨ªè½´ä¸ºå›ºå®šæ•°é‡å­å…ƒç´ çš„layoutç®—æ³•ï¼Œå…¶æ„é€ å‡½æ•°ä¸ºï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SliverGridDelegateWithFixedCrossAxisCount(&#123;</span><br><span class="line">  <span class="meta">@required</span> <span class="type">double</span> crossAxisCount, </span><br><span class="line">  <span class="type">double</span> <span class="variable">mainAxisSpacing</span> <span class="operator">=</span> <span class="number">0.0</span>,</span><br><span class="line">  <span class="type">double</span> <span class="variable">crossAxisSpacing</span> <span class="operator">=</span> <span class="number">0.0</span>,</span><br><span class="line">  <span class="type">double</span> <span class="variable">childAspectRatio</span> <span class="operator">=</span> <span class="number">1.0</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><ul><li><code>crossAxisCount</code>ï¼šæ¨ªè½´å­å…ƒç´ çš„æ•°é‡ã€‚æ­¤å±æ€§å€¼ç¡®å®šåå­å…ƒç´ åœ¨æ¨ªè½´çš„é•¿åº¦å°±ç¡®å®šäº†ï¼Œå³<code>ViewPort</code>æ¨ªè½´é•¿åº¦é™¤ä»¥<code>crossAxisCount</code>çš„å•†ã€‚</li><li><code>mainAxisSpacing</code>ï¼šä¸»è½´æ–¹å‘çš„é—´è·ã€‚</li><li><code>crossAxisSpacing</code>ï¼šæ¨ªè½´æ–¹å‘å­å…ƒç´ çš„é—´è·ã€‚</li><li><code>childAspectRatio</code>ï¼šå­å…ƒç´ åœ¨æ¨ªè½´é•¿åº¦å’Œä¸»è½´é•¿åº¦çš„æ¯”ä¾‹ã€‚ç”±äº<code>crossAxisCount</code>æŒ‡å®šåï¼Œå­å…ƒç´ æ¨ªè½´é•¿åº¦å°±ç¡®å®šäº†ï¼Œç„¶åé€šè¿‡æ­¤å‚æ•°å€¼å°±å¯ä»¥ç¡®å®šå­å…ƒç´ åœ¨ä¸»è½´çš„é•¿åº¦ã€‚</li></ul><h2 id="SliverGridDelegateWithMaxCrossAxisExtent"><a href="#SliverGridDelegateWithMaxCrossAxisExtent" class="headerlink" title="SliverGridDelegateWithMaxCrossAxisExtent"></a>SliverGridDelegateWithMaxCrossAxisExtent</h2><p>è¯¥å­ç±»å®ç°äº†ä¸€ä¸ªæ¨ªè½´å­å…ƒç´ ä¸ºå›ºå®šæœ€å¤§é•¿åº¦çš„layoutç®—æ³•ï¼Œå…¶æ„é€ å‡½æ•°ä¸ºï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SliverGridDelegateWithMaxCrossAxisExtent(&#123;</span><br><span class="line">  <span class="type">double</span> maxCrossAxisExtent,</span><br><span class="line">  <span class="type">double</span> <span class="variable">mainAxisSpacing</span> <span class="operator">=</span> <span class="number">0.0</span>,</span><br><span class="line">  <span class="type">double</span> <span class="variable">crossAxisSpacing</span> <span class="operator">=</span> <span class="number">0.0</span>,</span><br><span class="line">  <span class="type">double</span> <span class="variable">childAspectRatio</span> <span class="operator">=</span> <span class="number">1.0</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><br><code>maxCrossAxisExtent</code>ä¸ºå­å…ƒç´ åœ¨æ¨ªè½´ä¸Šçš„æœ€å¤§é•¿åº¦ï¼Œä¹‹æ‰€ä»¥æ˜¯â€œæœ€å¤§â€é•¿åº¦ï¼Œæ˜¯å› ä¸ºæ¨ªè½´æ–¹å‘æ¯ä¸ªå­å…ƒç´ çš„é•¿åº¦ä»ç„¶æ˜¯ç­‰åˆ†çš„ã€‚å…¶å®ƒå‚æ•°å’Œ<code>SliverGridDelegateWithFixedCrossAxisCount</code>ç›¸åŒã€‚</p><h2 id="GridView-builder"><a href="#GridView-builder" class="headerlink" title="GridView.builder"></a>GridView.builder</h2><p>å’Œ<code>ListView</code>ä¸€æ ·ï¼Œå½“å­Widgetæ•°é‡è¾ƒå¤šæ—¶ï¼Œä¹Ÿæä¾›äº†<code>builder</code>æ–¹æ³•:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GridView.builder(</span><br><span class="line"> ...</span><br><span class="line"> <span class="meta">@required</span> SliverGridDelegate gridDelegate, </span><br><span class="line"> <span class="meta">@required</span> IndexedWidgetBuilder itemBuilder,</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªå°±ä¸åœ¨è¿™ä¸¾ä¾‹äº†ï¼Œ<code>gridDelegate</code>å’Œå‰é¢ä¸€æ ·çš„ï¼Œ<code>itemBuilder</code>å’Œ<code>ListView</code>çš„ä¸€æ ·çš„ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Flutter/">Flutter</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Flutter/">Flutter</category>
      
      
      <comments>https://www.littlecorgi.top/posts/30ff421d.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Flutterå…¥é—¨å¹¶å¼€å‘å¤©æ°”é¢„æŠ¥APP(4)â€”â€”åŸºç¡€Widget</title>
      <link>https://www.littlecorgi.top/posts/a3b37eac.html</link>
      <guid>https://www.littlecorgi.top/posts/a3b37eac.html</guid>
      <pubDate>Thu, 10 Oct 2019 12:15:26 GMT</pubDate>
      
      <description>&lt;p&gt;åˆ°è¿™ç« æˆ‘ä»¬å°±å·®ä¸å¤šå¯ä»¥å¼€å§‹å†™å¤©æ°”é¢„æŠ¥äº†ã€‚é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸€äº›åŸºç¡€ç®€å•çš„Widgetã€‚&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>åˆ°è¿™ç« æˆ‘ä»¬å°±å·®ä¸å¤šå¯ä»¥å¼€å§‹å†™å¤©æ°”é¢„æŠ¥äº†ã€‚é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸€äº›åŸºç¡€ç®€å•çš„Widgetã€‚</p><span id="more"></span><h1 id="åŸºç¡€ç»„ä»¶"><a href="#åŸºç¡€ç»„ä»¶" class="headerlink" title="åŸºç¡€ç»„ä»¶"></a>åŸºç¡€ç»„ä»¶</h1><h2 id="æ–‡æœ¬"><a href="#æ–‡æœ¬" class="headerlink" title="æ–‡æœ¬"></a>æ–‡æœ¬</h2><p><code>Text</code>ç”¨äºæ˜¾ç¤ºç®€å•çš„æ–‡æœ¬ï¼ŒåŒ…å«ä¸€äº›æ§åˆ¶æ–‡æœ¬æ˜¾ç¤ºçš„å±æ€§ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Text(</span><br><span class="line">    <span class="string">&quot;1234&quot;</span>,</span><br><span class="line">),</span><br><span class="line">Text(</span><br><span class="line">    <span class="string">&quot;1234&quot;</span>,</span><br><span class="line">    style: TextStyle(</span><br><span class="line">        color: Colors.purple,</span><br><span class="line">        fontSize: <span class="number">32.0</span>,</span><br><span class="line">        fontWeight: FontWeight.bold,</span><br><span class="line">    ),</span><br><span class="line">),</span><br></pre></td></tr></table></figure><br><img src="https://cdn.littlecorgi.top/mweb/2019-10-10/Text%E7%A4%BA%E4%BE%8B.png" alt="Textç¤ºä¾‹"></p><ul><li>éœ€è¦æ˜¾ç¤ºçš„æ–‡æœ¬ä¿¡æ¯ç›´æ¥æ”¾åˆ°ä¸€ä¸ªåŒå¼•å·é‡Œé¢å°±å¯ä»¥äº†ï¼›</li><li><code>textAlign</code>ï¼šæ–‡æœ¬å¯¹é½æ–¹å¼ï¼›</li><li><code>maxLines</code>ï¼šæ–‡æœ¬æ˜¾ç¤ºçš„æœ€å¤§è¡Œæ•°ï¼›</li><li><code>overflow</code>ï¼šæŒ‡å®šå¤šä½™æ–‡æœ¬çš„æˆªæ–­æ–¹å¼ï¼›</li><li><code>textScaleFactor</code>ï¼šæŒ‡å®šæ–‡æœ¬ç›¸å¯¹äºå½“å‰å­—ä½“å¤§å°çš„ç¼©æ”¾å› å­ï¼›</li><li><code>TextStyle</code>ï¼šè®¾ç½®æ˜¾ç¤ºæ–‡æœ¬çš„å­—ä½“ã€é¢œè‰²ã€ç²—ç»†ç­‰æ ·å¼ï¼š<ul><li><code>height</code>ï¼šæŒ‡å®šè¡Œé«˜ï¼Œä½†æ˜¯ä¸æ˜¯ç»å¯¹å€¼ï¼Œè€Œæ˜¯ä¸€ä¸ªå› å­ï¼Œç›¸å½“äº<code>fontsize * height</code>ï¼›</li><li><code>fontFamily</code>ï¼šè®¾ç½®å­—ä½“ï¼›</li><li><code>fontSize</code>ï¼šè®¾ç½®å­—ä½“å¤§å°</li></ul></li></ul><h2 id="æŒ‰é’®"><a href="#æŒ‰é’®" class="headerlink" title="æŒ‰é’®"></a>æŒ‰é’®</h2><p>ä¸åŒçš„ç»„ä»¶åº“æœ‰ä¸åŒçš„æŒ‰é’®ï¼Œæˆ‘ä»¬ç°åœ¨åªæ‹¿Materialç»„ä»¶åº“ä¸­çš„æŒ‰é’®ä¸¾ä¾‹ã€‚</p><h3 id="RaisedButton"><a href="#RaisedButton" class="headerlink" title="RaisedButton"></a>RaisedButton</h3><p>æ¼‚æµ®æŒ‰é’®ï¼Œå¸¦æœ‰é˜´å½±å’Œç°è‰²èƒŒæ™¯ã€‚æŒ‰ä¸‹åé˜´å½±ä¼šå˜å¤§ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RaisedButton(</span><br><span class="line">  child: Text(<span class="string">&quot;1234&quot;</span>),</span><br><span class="line">  onPressed: () &#123;&#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p><figure class="half">    <img src="https://cdn.littlecorgi.top/mweb/2019-10-10/RaisedButton%E6%9C%AA%E6%8C%89%E4%B8%8B.png">    <img src="https://cdn.littlecorgi.top/mweb/2019-10-10/RaisedButton%E6%8C%89%E4%B8%8B.png"></figure><h3 id="FlatButton"><a href="#FlatButton" class="headerlink" title="FlatButton"></a>FlatButton</h3><p>æ‰å¹³åŒ–æŒ‰é’®ï¼ŒèƒŒæ™¯é€æ˜ä¸”ä¸å¸¦é˜´å½±ï¼ŒæŒ‰ä¸‹åä¼šæœ‰èƒŒæ™¯è‰²ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FlatButton(</span><br><span class="line">  child: Text(<span class="string">&quot;1234&quot;</span>),</span><br><span class="line">  onPressed: () &#123;&#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p><figure class="half">    <img src="https://cdn.littlecorgi.top/mweb/2019-10-10/FlatButton%E6%9C%AA%E6%8C%89%E4%B8%8B.png">    <img src="https://cdn.littlecorgi.top/mweb/2019-10-10/FlatButton%E6%8C%89%E4%B8%8B.png"></figure><h3 id="IconButton"><a href="#IconButton" class="headerlink" title="IconButton"></a>IconButton</h3><p>å¯ç‚¹å‡»çš„Iconï¼Œé»˜è®¤æ²¡æœ‰èƒŒæ™¯ï¼ŒæŒ‰ä¸‹åå‡ºç°é˜´å½±<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">IconButton(</span><br><span class="line">  icon: Icon(Icons.thumb_up),</span><br><span class="line">  onPressed: () &#123;&#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure><br><img src="https://cdn.littlecorgi.top/mweb/2019-10-10/15706115387455.png" alt="-w88"></p><h2 id="å›¾ç‰‡"><a href="#å›¾ç‰‡" class="headerlink" title="å›¾ç‰‡"></a>å›¾ç‰‡</h2><p>æˆ‘ä»¬é€šè¿‡<code>Image</code>æ¥æ˜¾ç¤ºå›¾ç‰‡ï¼Œæ¥æºå¯ä»¥æ˜¯<code>asset</code>ã€ç½‘ç»œç­‰ä½ç½®ã€‚</p><h3 id="ä»assetåŠ è½½å›¾ç‰‡"><a href="#ä»assetåŠ è½½å›¾ç‰‡" class="headerlink" title="ä»assetåŠ è½½å›¾ç‰‡"></a>ä»assetåŠ è½½å›¾ç‰‡</h3><ol><li>ç°åœ¨é¡¹ç›®æ ¹ç›®å½•(ä¹Ÿå°±æ˜¯å’Œandroidã€iosã€libç­‰ç›®å½•åŒçº§)æ–°å»ºä¸€ä¸ª<code>images</code>ç›®å½•ï¼Œå¹¶æŠŠå›¾ç‰‡<code>main.png</code>æ‹·è¿›å»ï¼›</li><li>åœ¨<code>pubspec.yaml</code>ä¸­çš„flutteréƒ¨åˆ†æ·»åŠ ä¸€ä¸‹å†…å®¹ï¼š<br> <img src="https://cdn.littlecorgi.top/mweb/2019-10-10/assets.png" alt="assets"></li><li>åŠ è½½è¯¥å›¾ç‰‡</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Image(</span><br><span class="line">  image: AssetImage(<span class="string">&quot;images/amoled.png&quot;</span>),</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><code>Image</code>ä¹Ÿæä¾›äº†ä¸€ä¸ªå¿«é€Ÿæ„é€ å‡½æ•°ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Image.asset(</span><br><span class="line">  <span class="string">&quot;images/amoled.png&quot;</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p><h3 id="ä»ç½‘ç»œåŠ è½½å›¾ç‰‡"><a href="#ä»ç½‘ç»œåŠ è½½å›¾ç‰‡" class="headerlink" title="ä»ç½‘ç»œåŠ è½½å›¾ç‰‡"></a>ä»ç½‘ç»œåŠ è½½å›¾ç‰‡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Image(</span><br><span class="line">  image: NetworkImage(</span><br><span class="line">      <span class="string">&quot;https://s2.ax1x.com/2019/05/27/VZrQ3V.png&quot;</span>),</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>æˆ–è€…<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Image.network(</span><br><span class="line">  <span class="string">&quot;https://s2.ax1x.com/2019/05/27/VZrQ3V.png&quot;</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p><h3 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h3><p><code>Image</code>æœ‰ä¸€äº›åŸºæœ¬å‚æ•°<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const <span class="title function_">Image</span><span class="params">(&#123;</span></span><br><span class="line"><span class="params">  ...</span></span><br><span class="line"><span class="params">  <span class="built_in">this</span>.width, //å›¾ç‰‡çš„å®½</span></span><br><span class="line"><span class="params">  <span class="built_in">this</span>.height, //å›¾ç‰‡é«˜åº¦</span></span><br><span class="line"><span class="params">  <span class="built_in">this</span>.fit,//ç¼©æ”¾æ¨¡å¼</span></span><br><span class="line"><span class="params">  <span class="built_in">this</span>.alignment = Alignment.center, //å¯¹é½æ–¹å¼</span></span><br><span class="line"><span class="params">  <span class="built_in">this</span>.repeat = ImageRepeat.noRepeat, //é‡å¤æ–¹å¼</span></span><br><span class="line"><span class="params">  ...</span></span><br><span class="line"><span class="params">&#125;)</span></span><br></pre></td></tr></table></figure></p><ul><li><code>width</code>å’Œ<code>height</code>ï¼šå®½å’Œé«˜ï¼›</li><li><code>fit</code>ï¼šç¼©æ”¾æ¨¡å¼ï¼š<ul><li><code>fill</code>ï¼šæ‹‰ä¼¸å›¾ç‰‡çŸ¥é“å¡«æ»¡ï¼›</li><li><code>cover</code>ï¼šæŒ‰åŸå›¾é•¿å®½æ¯”æ”¾å¤§å›¾ç‰‡æ¥å¡«æ»¡ï¼Œå¤šä½™çš„éƒ¨åˆ†èˆå»ï¼›</li><li><code>contain</code>ï¼šåœ¨ä¿è¯å›¾ç‰‡é•¿å®½æ¯”ä¸å˜çš„æƒ…å†µä¸‹å°½å¯èƒ½å»å¡«æ»¡ï¼›</li><li><code>fitWidth</code>ï¼šå®½åº¦ä¼šç¼©æ”¾åˆ°æ˜¾ç¤ºç©ºé—´çš„å®½åº¦ï¼Œé«˜åº¦ä¼šæŒ‰æ¯”ä¾‹ç¼©æ”¾ï¼Œå¦‚æœæœ‰å¤šä½™çš„éƒ¨åˆ†ä¼šè¢«èˆå»ï¼›</li><li><code>fitHeight</code>ï¼šä¸<code>fitWidth</code>åŒç†ï¼›</li><li><code>none</code>ï¼šæ²¡æœ‰é€‚åº”ç­–ç•¥ï¼Œå›¾ç‰‡å¤šå¤§å°±æ˜¾ç¤ºå¤šå¤§ï¼Œå¦‚æœå›¾ç‰‡åŸå°ºå¯¸å°äºæ˜¾ç¤ºç©ºé—´å°±åªæ˜¾ç¤ºåŸå°ºå¯¸ï¼›å¦‚æœå¤§äºåˆ™èˆå¼ƒå¤šä½™éƒ¨åˆ†åªæ˜¾ç¤ºä¸­é—´éƒ¨åˆ†ï¼›</li></ul></li><li><code>repeat</code>ï¼šå½“å›¾ç‰‡å°äºæ˜¾ç¤ºç©ºé—´æ—¶ï¼Œä¼šå°†å›¾ç‰‡é‡å¤æ˜¾ç¤ºã€‚</li></ul><h1 id="å¸ƒå±€ç»„ä»¶"><a href="#å¸ƒå±€ç»„ä»¶" class="headerlink" title="å¸ƒå±€ç»„ä»¶"></a>å¸ƒå±€ç»„ä»¶</h1><h2 id="çº¿æ€§å¸ƒå±€-Rowã€Column"><a href="#çº¿æ€§å¸ƒå±€-Rowã€Column" class="headerlink" title="çº¿æ€§å¸ƒå±€(Rowã€Column)"></a>çº¿æ€§å¸ƒå±€(Rowã€Column)</h2><p>çº¿æ€§å¸ƒå±€å°±ç›¸å½“äºAndroidé‡Œé¢çš„<code>LinearLayout</code>ï¼Œä½†æ˜¯ä¸åŒçš„æ˜¯Flutterå°†ç«–ç›´å’Œæ°´å¹³å¸ƒå±€å•ç‹¬æ‹¿äº†å‡ºæ¥ã€‚</p><p>çº¿æ€§å¸ƒå±€åˆ†ä¸ºç«–ç›´å¸ƒå±€<code>Column</code>å’Œæ°´å¹³å¸ƒå±€<code>Row</code>ã€‚ä»–ä¸¤å±æ€§éƒ½æ˜¯ä¸€æ ·çš„ã€‚<br>å†è¯´å±æ€§ä¹‹å‰æˆ‘ä»¬å…ˆç†Ÿæ‚‰ä¸¤ä¸ªæ¦‚å¿µï¼šä¸»è½´å’Œäº¤å‰è½´ã€‚å¦‚æœæ˜¯<code>Column</code>ï¼Œä¸»è½´æ˜¯ç«–ç›´è½´ï¼Œäº¤å‰è½´æ˜¯æ°´å¹³è½´ï¼›å¦‚æœæ˜¯<code>Row</code>ï¼Œä¸»è½´æ˜¯æ°´å¹³è½´ï¼Œäº¤å‰è½´æ˜¯ç«–ç›´è½´ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Row(&#123;</span><br><span class="line">  ...  </span><br><span class="line">  <span class="type">MainAxisSize</span> <span class="variable">mainAxisSize</span> <span class="operator">=</span> MainAxisSize.max,    </span><br><span class="line">  <span class="type">MainAxisAlignment</span> <span class="variable">mainAxisAlignment</span> <span class="operator">=</span> MainAxisAlignment.start,</span><br><span class="line">  <span class="type">CrossAxisAlignment</span> <span class="variable">crossAxisAlignment</span> <span class="operator">=</span> CrossAxisAlignment.center,</span><br><span class="line">  List&lt;Widget&gt; children = const &lt;Widget&gt;[],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><ul><li><code>mainAxisSize</code>ï¼šä¸»è½´å ç”¨ç©ºé—´ã€‚é»˜è®¤æ˜¯<code>MainAxisSize.max</code>ï¼Œæ˜¯æŒ‡å ç”¨å…¨éƒ¨ä¸»è½´ç©ºé—´ã€‚å¦‚æœè®¾ç½®ä¸º<code>MainAxisSize.min</code>ï¼Œé‚£å°±åªå ç”¨æ‰€æœ‰å­ç»„ä»¶æ‰€éœ€è¦çš„ç©ºé—´ï¼›</li><li><code>mainAxisAlignment</code>ï¼šå­Widgetåœ¨ä¸»è½´çš„å¯¹å…¶æ–¹å‘ï¼›</li><li><code>crossAxisAlignment</code>ï¼šå­Widgetåœ¨äº¤å‰è½´çš„å¯¹å…¶æ–¹å‘ï¼›</li><li><code>children</code>ï¼šæ‰€æœ‰çš„å­Widgetã€‚</li></ul><h2 id="å¼¹æ€§å¸ƒå±€-Flex"><a href="#å¼¹æ€§å¸ƒå±€-Flex" class="headerlink" title="å¼¹æ€§å¸ƒå±€(Flex)"></a>å¼¹æ€§å¸ƒå±€(Flex)</h2><p>å…¶å®è¿™ä¸ªå¸ƒå±€å’Œçº¿æ€§å¸ƒå±€å¾ˆæœ‰æ¸Šæºï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Œå› ä¸º<code>Row</code>å’Œ<code>Column</code>éƒ½ç»§æ‰¿è‡ªå®ƒã€‚<br>å› æ­¤å…³äºä»–å’Œçº¿æ€§å¸ƒå±€é‡å¤çš„åœ°æ–¹æˆ‘ä»¬ç°åœ¨å°±ä¸å†è®²äº†ï¼Œæˆ‘ä»¬ç›´è¯´ä»–â€œå¼¹æ€§â€çš„éƒ¨åˆ†ã€‚</p><h3 id="Expanded"><a href="#Expanded" class="headerlink" title="Expanded"></a>Expanded</h3><p>å¯ä»¥æŒ‰æ¯”ä¾‹â€œæ‹‰ä¼¸â€<code>Row</code>ã€<code>Column</code>å’Œ<code>Flex</code>å­ç»„ä»¶æ‰€å çš„ç©ºé—´ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const <span class="title function_">Expanded</span><span class="params">(&#123;</span></span><br><span class="line"><span class="params">  <span class="type">int</span> flex = <span class="number">1</span>, </span></span><br><span class="line"><span class="params">  <span class="meta">@required</span> Widget child,</span></span><br><span class="line"><span class="params">&#125;)</span></span><br></pre></td></tr></table></figure><p><code>flex</code>ä¸ºå¼¹æ€§ç³»æ•°ï¼Œå¦‚æœä¸º<code>0</code>æˆ–è€…<code>null</code>ï¼Œåˆ™<code>child</code>ä¸ä¼šé˜”ä¼¸å ç”¨çš„æ§ä»¶ã€‚å¦‚æœå¤§äº<code>0</code>ï¼Œåˆ™ä¼šæŒ‰ç…§<code>flex</code>çš„æ¯”ä¾‹æ¥åˆ†éš”ä¸»è½´å…¨éƒ¨ç©ºé—²ç©ºé—´ã€‚å…¶å®è¯´ç™½äº†ï¼Œå°±å’ŒAndroidé‡Œé¢<code>LinearLayout</code>çš„<code>weight</code>ä¸€æ ·çš„ã€‚ä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯æ¥ä¸¾ä¸ªä¾‹å­å§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: <span class="keyword">new</span> <span class="title class_">AppBar</span>(</span><br><span class="line">        title: Text(<span class="string">&quot;$_title&quot;</span>),</span><br><span class="line">      ),</span><br><span class="line">      body: Center(</span><br><span class="line">        child: Flex(</span><br><span class="line">          children: &lt;Widget&gt;[</span><br><span class="line">            Flex(</span><br><span class="line">              direction: Axis.horizontal,</span><br><span class="line">              children: &lt;Widget&gt;[</span><br><span class="line">                Expanded(</span><br><span class="line">                  flex: <span class="number">1</span>,</span><br><span class="line">                  child: Container(</span><br><span class="line">                    color: Colors.blue,</span><br><span class="line">                    child: Text(<span class="string">&quot;1234&quot;</span>),</span><br><span class="line">                  ),</span><br><span class="line">                ),</span><br><span class="line">                Expanded(</span><br><span class="line">                  flex: <span class="number">2</span>,</span><br><span class="line">                  child: Container(</span><br><span class="line">                    color: Colors.red,</span><br><span class="line">                    child: Text(<span class="string">&quot;1234&quot;</span>),</span><br><span class="line">                  ),</span><br><span class="line">                ),</span><br><span class="line">              ],</span><br><span class="line">            ),</span><br><span class="line">            Flex(</span><br><span class="line">              direction: Axis.horizontal,</span><br><span class="line">              children: &lt;Widget&gt;[</span><br><span class="line">                Expanded(</span><br><span class="line">                  flex: <span class="number">3</span>,</span><br><span class="line">                  child: Container(</span><br><span class="line">                    color: Colors.blue,</span><br><span class="line">                    child: Text(<span class="string">&quot;1234&quot;</span>),</span><br><span class="line">                  ),</span><br><span class="line">                ),</span><br><span class="line">                Expanded(</span><br><span class="line">                  flex: <span class="number">1</span>,</span><br><span class="line">                  child: Container(</span><br><span class="line">                    color: Colors.red,</span><br><span class="line">                    child: Text(<span class="string">&quot;1234&quot;</span>),</span><br><span class="line">                  ),</span><br><span class="line">                ),</span><br><span class="line">              ],</span><br><span class="line">            ),</span><br><span class="line">            Flex(</span><br><span class="line">              direction: Axis.horizontal,</span><br><span class="line">              children: &lt;Widget&gt;[</span><br><span class="line">                Expanded(</span><br><span class="line">                  flex: <span class="number">1</span>,</span><br><span class="line">                  child: Container(</span><br><span class="line">                    color: Colors.blue,</span><br><span class="line">                    child: Text(<span class="string">&quot;1234&quot;</span>),</span><br><span class="line">                  ),</span><br><span class="line">                ),</span><br><span class="line">                Expanded(</span><br><span class="line">                  flex: <span class="number">1</span>,</span><br><span class="line">                  child: Container(</span><br><span class="line">                    color: Colors.red,</span><br><span class="line">                    child: Text(<span class="string">&quot;1234&quot;</span>),</span><br><span class="line">                  ),</span><br><span class="line">                ),</span><br><span class="line">              ],</span><br><span class="line">            ),</span><br><span class="line">          ],</span><br><span class="line">          direction: Axis.vertical,</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><img src="https://cdn.littlecorgi.top/mweb/2019-10-10/Flex%E7%A4%BA%E4%BE%8B.png" alt="Flexç¤ºä¾‹"></p><h2 id="æµå¼å¸ƒå±€-Wrapã€Flow"><a href="#æµå¼å¸ƒå±€-Wrapã€Flow" class="headerlink" title="æµå¼å¸ƒå±€(Wrapã€Flow)"></a>æµå¼å¸ƒå±€(Wrapã€Flow)</h2><p>å¦‚æœä½¿ç”¨çº¿æ€§å¸ƒå±€çš„è¯ï¼Œå½“éœ€è¦æ˜¾ç¤ºçš„å†…å®¹è¶…å‡ºå±å¹•è¾¹ç•Œçš„æ—¶å€™å°±ä¼šæŠ¥é”™ã€‚<br><img src="https://cdn.littlecorgi.top/mweb/2019-10-10/%E8%B6%85%E5%87%BA%E5%B1%8F%E5%B9%95%E8%BE%B9%E7%95%8C.png" alt="è¶…å‡ºå±å¹•è¾¹ç•Œ"></p><p>ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æµå¼å¸ƒå±€ã€‚å½“éœ€è¦æ˜¾ç¤ºçš„å†…å®¹è¶…å‡ºå±å¹•è¾¹ç•Œçš„æ—¶å€™ï¼Œå°±è‡ªåŠ¨æŠ˜è¡Œæ¥ç»§ç»­æ˜¾ç¤ºã€‚</p><p>Flutterä¸­é€šè¿‡<code>Wrap</code>å’Œ<code>Flow</code>æ¥å®ç°æµå¼å¸ƒå±€ã€‚</p><h3 id="Wrap"><a href="#Wrap" class="headerlink" title="Wrap"></a>Wrap</h3><p>æˆ‘ä»¬æ¥çœ‹ä¸‹<code>Wrap</code>ä¸»è¦çš„ä¸€äº›å‚æ•°ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Wrap(&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="built_in">this</span>.direction = Axis.horizontal,</span><br><span class="line">  <span class="built_in">this</span>.alignment = WrapAlignment.start,</span><br><span class="line">  <span class="built_in">this</span>.spacing = <span class="number">0.0</span>,</span><br><span class="line">  <span class="built_in">this</span>.runAlignment = WrapAlignment.start,</span><br><span class="line">  <span class="built_in">this</span>.runSpacing = <span class="number">0.0</span>,</span><br><span class="line">  <span class="built_in">this</span>.crossAxisAlignment = WrapCrossAlignment.start,</span><br><span class="line">  <span class="built_in">this</span>.textDirection,</span><br><span class="line">  <span class="built_in">this</span>.verticalDirection = VerticalDirection.down,</span><br><span class="line">  List&lt;Widget&gt; children = const &lt;Widget&gt;[],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>å…¶ä¸­å¾ˆå¤šå‚æ•°<code>Row</code>å’Œ<code>Column</code>ä¸­éƒ½æœ‰ï¼Œå°±ä¸å†ä»‹ç»äº†ï¼Œä¸»è¦ä»‹ç»ç‚¹ä¸åŒçš„ï¼š</p><ul><li><code>spacing</code>ï¼šä¸»è½´æ–¹å‘å­widgetçš„é—´è·</li><li><code>runSpacing</code>ï¼šçºµè½´æ–¹å‘çš„é—´è·</li><li><code>runAlignment</code>ï¼šçºµè½´æ–¹å‘çš„å¯¹é½æ–¹å¼</li></ul><p>ä¸‹é¢æœ‰ä¸€ä¸ªç¤ºä¾‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Wrap(</span><br><span class="line">  spacing: <span class="number">8.0</span>, <span class="comment">// ä¸»è½´(æ°´å¹³)æ–¹å‘é—´è·</span></span><br><span class="line">  runSpacing: <span class="number">4.0</span>, <span class="comment">// çºµè½´ï¼ˆå‚ç›´ï¼‰æ–¹å‘é—´è·</span></span><br><span class="line">  alignment: WrapAlignment.center, <span class="comment">//æ²¿ä¸»è½´æ–¹å‘å±…ä¸­</span></span><br><span class="line">  children: &lt;Widget&gt;[</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Chip</span>(</span><br><span class="line">      avatar: <span class="keyword">new</span> <span class="title class_">CircleAvatar</span>(backgroundColor: Colors.blue, child: Text(<span class="string">&#x27;A&#x27;</span>)),</span><br><span class="line">      label: <span class="keyword">new</span> <span class="title class_">Text</span>(<span class="string">&#x27;Hamilton&#x27;</span>),</span><br><span class="line">    ),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Chip</span>(</span><br><span class="line">      avatar: <span class="keyword">new</span> <span class="title class_">CircleAvatar</span>(backgroundColor: Colors.blue, child: Text(<span class="string">&#x27;M&#x27;</span>)),</span><br><span class="line">      label: <span class="keyword">new</span> <span class="title class_">Text</span>(<span class="string">&#x27;Lafayette&#x27;</span>),</span><br><span class="line">    ),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Chip</span>(</span><br><span class="line">      avatar: <span class="keyword">new</span> <span class="title class_">CircleAvatar</span>(backgroundColor: Colors.blue, child: Text(<span class="string">&#x27;H&#x27;</span>)),</span><br><span class="line">      label: <span class="keyword">new</span> <span class="title class_">Text</span>(<span class="string">&#x27;Mulligan&#x27;</span>),</span><br><span class="line">    ),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Chip</span>(</span><br><span class="line">      avatar: <span class="keyword">new</span> <span class="title class_">CircleAvatar</span>(backgroundColor: Colors.blue, child: Text(<span class="string">&#x27;J&#x27;</span>)),</span><br><span class="line">      label: <span class="keyword">new</span> <span class="title class_">Text</span>(<span class="string">&#x27;Laurens&#x27;</span>),</span><br><span class="line">    ),</span><br><span class="line">  ],</span><br><span class="line">)</span><br></pre></td></tr></table></figure><br><img src="https://cdn.littlecorgi.top/mweb/2019-10-10/Wrap%E7%A4%BA%E4%BE%8B.png" alt="Wrapç¤ºä¾‹"></p><h3 id="Flow"><a href="#Flow" class="headerlink" title="Flow"></a>Flow</h3><p><code>Flow</code>è¾ƒå¤æ‚ï¼Œéœ€è¦è‡ªå·±å®ç°å­Widgetçš„ä½ç½®è½¬æ¢ï¼Œä¸€èˆ¬ä¸æ¨èä½¿ç”¨<code>Flow</code>ã€‚ä½†æ˜¯å¦‚æœéœ€è¦è‡ªå®šä¹‰å¸ƒå±€ç­–ç•¥ï¼Œæˆ–è€…å¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜ï¼Œè¿™ä¸ªæ—¶å€™å°±å¾—ç”¨<code>Flow</code>äº†ã€‚</p><p>ä½†æ˜¯ç”±äºå¤ªè¿‡äºå¤æ‚ï¼Œæˆ‘ä¹Ÿæ²¡å’‹ç”¨è¿‡ï¼Œæˆ‘å°±ä¸åœ¨è¿™è®²äº†ğŸ˜ï¼Œå¤§å®¶æœ‰éœ€è¦çš„å¯ä»¥ç™¾åº¦ï¼Œæˆ–è€…çœ‹æˆ‘æ¨èçš„è¿™ç¯‡ï¼š<a href="https://book.flutterchina.club/chapter4/wrap_and_flow.html">4.4 æµå¼å¸ƒå±€-ã€ŠFlutterå®æˆ˜ã€‹</a></p><h2 id="å±‚å å¸ƒå±€-Stack"><a href="#å±‚å å¸ƒå±€-Stack" class="headerlink" title="å±‚å å¸ƒå±€(Stack)"></a>å±‚å å¸ƒå±€(Stack)</h2><p>è¿™ä¸ªå¸ƒå±€ç±»ä¼¼äºAndroidä¸­çš„<code>Frame</code>ï¼Œå…è®¸åœ¨çˆ¶å¸ƒå±€çš„ä»»æ„åœ°æ–¹æ”¾ç½®å¸ƒå±€ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Stack(&#123;</span><br><span class="line">  <span class="built_in">this</span>.alignment = AlignmentDirectional.topStart,</span><br><span class="line">  <span class="built_in">this</span>.textDirection,</span><br><span class="line">  <span class="built_in">this</span>.fit = StackFit.loose,</span><br><span class="line">  <span class="built_in">this</span>.overflow = Overflow.clip,</span><br><span class="line">  List&lt;Widget&gt; children = const &lt;Widget&gt;[],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><ul><li><code>alignment</code>ï¼šå†³å®šå¦‚ä½•å»å¯¹é½ï¼›</li><li><code>textDirection</code>ï¼šç¡®å®š<code>alignment</code>çš„å‚è€ƒç³»ï¼›</li><li><code>fit</code>ï¼šæ²¡æœ‰å®šä½çš„å­Widgetå¦‚ä½•å»é€‚åº”<code>Stack</code>çš„å¤§å°ï¼›</li><li><code>overflow</code>ï¼šå†³å®šè¶…å‡º<code>Stack</code>æ˜¾ç¤ºç©ºé—´çš„å­Widgetå¦‚ä½•å»æ˜¾ç¤ºï¼Œå¦‚æœ<code>Overflow.clip</code>ï¼Œåˆ™è¶…å‡ºéƒ¨åˆ†ä¼šéšè—ï¼Œ<code>Overflow.visible</code>åˆ™ä¸ä¼šã€‚</li></ul><h2 id="å¯¹é½ä¸ç›¸å¯¹å®šä½-Align"><a href="#å¯¹é½ä¸ç›¸å¯¹å®šä½-Align" class="headerlink" title="å¯¹é½ä¸ç›¸å¯¹å®šä½(Align)"></a>å¯¹é½ä¸ç›¸å¯¹å®šä½(Align)</h2><p>Alignå¯ä»¥è°ƒæ•´å­Widgetçš„ä½ç½®ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®å­Widgetçš„å®½é«˜æ¥ç¡®å®šè‡ªèº«çš„å®½é«˜ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Align(&#123;</span><br><span class="line">  Key key,</span><br><span class="line">  <span class="built_in">this</span>.alignment = Alignment.center,</span><br><span class="line">  <span class="built_in">this</span>.widthFactor,</span><br><span class="line">  <span class="built_in">this</span>.heightFactor,</span><br><span class="line">  Widget child,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><ul><li>alignmentï¼šä»£è¡¨å­Widgetåœ¨çˆ¶Widgetçš„èµ·å§‹ä½ç½®ï¼›</li><li>widthFactorå’ŒheightFactorç¡®å®šAlignæœ¬èº«çš„å®½é«˜ã€‚</li></ul><p>æ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Container(</span><br><span class="line">  height: <span class="number">120.0</span>,</span><br><span class="line">  width: <span class="number">120.0</span>,</span><br><span class="line">  color: Colors.blue[<span class="number">50</span>],</span><br><span class="line">  child: Align(</span><br><span class="line">    alignment: Alignment.topRight,</span><br><span class="line">    child: FlutterLogo(</span><br><span class="line">      size: <span class="number">60</span>,</span><br><span class="line">    ),</span><br><span class="line">  ),</span><br><span class="line">)</span><br></pre></td></tr></table></figure><br>è¿è¡Œç»“æœï¼š<br><img src="https://cdn.littlecorgi.top/mweb/2019-10-10/15706312811307.png" alt="-w100"></p><h1 id="3-å®¹å™¨ç±»ç»„ä»¶"><a href="#3-å®¹å™¨ç±»ç»„ä»¶" class="headerlink" title="3. å®¹å™¨ç±»ç»„ä»¶"></a>3. å®¹å™¨ç±»ç»„ä»¶</h1><h2 id="å¡«å……-Padding"><a href="#å¡«å……-Padding" class="headerlink" title="å¡«å……(Padding)"></a>å¡«å……(Padding)</h2><p>ç”¨è¿‡Androidçš„åŒå­¦ä¸€å®šç†Ÿæ‚‰ï¼ŒPaddingå°±æ˜¯è´Ÿè´£ç•™ç™½çš„å˜›ã€‚<br>ä½†æ˜¯è·ŸAndroidé‡Œé¢ä¸åŒçš„æ˜¯ï¼Œåœ¨Androidé‡Œé¢æˆ‘ä»¬ä¸€èˆ¬æ˜¯åœ¨ä¸€ä¸ªViewé‡Œé¢æ·»åŠ Paddingï¼Œä½†æ˜¯åœ¨Flutteré‡Œé¢ï¼ŒPaddingç›´æ¥å˜æˆäº†ä¸€ä¸ªWidgetã€ä¸€ä¸ªå¸ƒå±€ã€‚</p><p>ä½¿ç”¨æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Padding (&#123;</span><br><span class="line">  EdgeInsetsGeometry padding,</span><br><span class="line">  Widget child,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><br>å¯¹äºEdgeInsetsGeometryæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨EdgeInsetsç±»ã€‚</p><h3 id="EdgeInsets"><a href="#EdgeInsets" class="headerlink" title="EdgeInsets"></a>EdgeInsets</h3><p>EdgeInsetsç±»æä¾›äº†å‡ ä¸ªä¾¿æ·çš„æ–¹æ³•ï¼š</p><ul><li>fromLTRB(double left, double top, double right, double bottom)ï¼šåˆ†åˆ«æŒ‡å®šå››ä¸ªæ–¹å‘çš„å¡«å……ï¼›</li><li>all(double value) : æ‰€æœ‰æ–¹å‘å‡ä½¿ç”¨ç›¸åŒæ•°å€¼çš„å¡«å……ï¼›</li><li>only({left, top, right ,bottom })ï¼šå¯ä»¥è®¾ç½®å…·ä½“æŸä¸ªæ–¹å‘çš„å¡«å……(å¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ªæ–¹å‘)ï¼›</li><li>symmetric({ vertical, horizontal })ï¼šç”¨äºè®¾ç½®å¯¹ç§°æ–¹å‘çš„å¡«å……ï¼ŒverticalæŒ‡topå’Œbottomï¼ŒhorizontalæŒ‡leftå’Œrightï¼›</li></ul><p>ç¤ºä¾‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">body: Column(</span><br><span class="line">  children: &lt;Widget&gt;[</span><br><span class="line">    Padding(</span><br><span class="line">      padding: EdgeInsets.only(left: <span class="number">12.0</span>, bottom: <span class="number">10.0</span>),</span><br><span class="line">      child: Text(<span class="string">&quot;1234&quot;</span>),</span><br><span class="line">    ),</span><br><span class="line">    Padding(</span><br><span class="line">      padding: EdgeInsets.fromLTRB(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">10.0</span>, <span class="number">10.0</span>),</span><br><span class="line">      child: Text(<span class="string">&quot;1234&quot;</span>),</span><br><span class="line">    ),</span><br><span class="line">    Padding(</span><br><span class="line">      padding: EdgeInsets.symmetric(vertical: <span class="number">10.0</span>),</span><br><span class="line">      child: Text(<span class="string">&quot;1234&quot;</span>),</span><br><span class="line">    ),</span><br><span class="line">  ],</span><br><span class="line">),</span><br></pre></td></tr></table></figure><br>è¿è¡Œç»“æœï¼š<br><img src="https://cdn.littlecorgi.top/mweb/2019-10-10/Padding%E7%A4%BA%E4%BE%8B.png" alt="Paddingç¤ºä¾‹"></p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Flutter/">Flutter</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Flutter/">Flutter</category>
      
      
      <comments>https://www.littlecorgi.top/posts/a3b37eac.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Flutterå…¥é—¨å¹¶å¼€å‘å¤©æ°”é¢„æŠ¥APP(3)â€”â€”Widget</title>
      <link>https://www.littlecorgi.top/posts/fc77cdce.html</link>
      <guid>https://www.littlecorgi.top/posts/fc77cdce.html</guid>
      <pubDate>Wed, 09 Oct 2019 03:46:56 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;ç®€ä»‹&quot;&gt;&lt;a href=&quot;#ç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;ç®€ä»‹&quot;&gt;&lt;/a&gt;ç®€ä»‹&lt;/h1&gt;&lt;p&gt;åœ¨Flutterä¸­ï¼ŒWidgetæ˜¯ä¸ªéå¸¸åŸºæœ¬çš„ä¸œè¥¿ï¼Œæˆ‘åœ¨ä¸Šä¸€ç« å°±è¯´è¿‡ï¼ŒFlutterä¸­åªè¦æ˜¯ç•Œé¢éƒ½æ˜¯Widgetï¼Œä½ å¯ä»¥æŠŠå®ƒå°±ç†è§£æˆæ˜¯æ§ä»¶ï¼Œä½†æ˜¯åˆå’ŒAndroidçš„Viewæ§ä»¶ä¸åŒçš„æ˜¯ï¼Œåœ¨Flutterä¸­ï¼ŒåŒ…æ‹¬&lt;code&gt;Padding&lt;/code&gt;ã€&lt;code&gt;Align&lt;/code&gt;ã€æ‰‹åŠ¿æ£€æµ‹çš„&lt;code&gt;GestureDetector&lt;/code&gt;ç­‰ç­‰ï¼Œéƒ½ç®—æ˜¯&lt;code&gt;Widget&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å…¶å®å¤§å¤šæ•°æ—¶å€™ï¼Œä½ å°±å¯ä»¥æŠŠWidgetç›´æ¥ç†è§£æˆUIæ§ä»¶å°±è¡Œäº†ï¼Œå› ä¸º&lt;code&gt;Padding&lt;/code&gt;ã€&lt;code&gt;Align&lt;/code&gt;ã€&lt;code&gt;GestureDetector&lt;/code&gt;ç­‰ç­‰ä¹Ÿéƒ½æ˜¯ä¸ºUIæœåŠ¡çš„ï¼Œä½ å°±å¯ä»¥ç†è§£æˆFlutterä¸­åªè¦ä¸UIæœ‰å…³çš„å±æ€§éƒ½å¯ä»¥ç®—æ˜¯æ§ä»¶ã€‚&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>åœ¨Flutterä¸­ï¼ŒWidgetæ˜¯ä¸ªéå¸¸åŸºæœ¬çš„ä¸œè¥¿ï¼Œæˆ‘åœ¨ä¸Šä¸€ç« å°±è¯´è¿‡ï¼ŒFlutterä¸­åªè¦æ˜¯ç•Œé¢éƒ½æ˜¯Widgetï¼Œä½ å¯ä»¥æŠŠå®ƒå°±ç†è§£æˆæ˜¯æ§ä»¶ï¼Œä½†æ˜¯åˆå’ŒAndroidçš„Viewæ§ä»¶ä¸åŒçš„æ˜¯ï¼Œåœ¨Flutterä¸­ï¼ŒåŒ…æ‹¬<code>Padding</code>ã€<code>Align</code>ã€æ‰‹åŠ¿æ£€æµ‹çš„<code>GestureDetector</code>ç­‰ç­‰ï¼Œéƒ½ç®—æ˜¯<code>Widget</code>ã€‚</p><p>å…¶å®å¤§å¤šæ•°æ—¶å€™ï¼Œä½ å°±å¯ä»¥æŠŠWidgetç›´æ¥ç†è§£æˆUIæ§ä»¶å°±è¡Œäº†ï¼Œå› ä¸º<code>Padding</code>ã€<code>Align</code>ã€<code>GestureDetector</code>ç­‰ç­‰ä¹Ÿéƒ½æ˜¯ä¸ºUIæœåŠ¡çš„ï¼Œä½ å°±å¯ä»¥ç†è§£æˆFlutterä¸­åªè¦ä¸UIæœ‰å…³çš„å±æ€§éƒ½å¯ä»¥ç®—æ˜¯æ§ä»¶ã€‚</p><span id="more"></span><h1 id="Widgetçš„çŠ¶æ€"><a href="#Widgetçš„çŠ¶æ€" class="headerlink" title="Widgetçš„çŠ¶æ€"></a>Widgetçš„çŠ¶æ€</h1><p>åœ¨Androidä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡æ›´æ–°æ•°æ®æ¥è¾¾åˆ°åˆ·æ–°UIçš„ç›®çš„ã€‚ä½†æ˜¯å¦‚æœä½¿ç”¨Flutterï¼Œå°±åƒæˆ‘ä»¬å‰é¢è¯´çš„è®¡æ•°å™¨çš„Demoï¼Œå¦‚æœç›´æ¥é€šè¿‡<code>StatelessWidget</code>ä¹Ÿå°±æ˜¯æ— çŠ¶æ€Widgetçš„è¯ï¼Œæ˜¯æ²¡æ³•è¿›è¡Œåˆ·æ–°UIçš„ï¼Œåªèƒ½å†™ä¸€ä¸ªæ­»ç•Œé¢ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœåœ¨Flutterä¸­ç•Œé¢å†™å‡ºæ¥çš„å°±æ˜¯ä¸€ä¸ªæ­»ç•Œé¢ï¼Œåªæœ‰é€šè¿‡åˆ·æ–°çŠ¶æ€æ‰èƒ½æ›´æ–°UIã€‚</p><p>Widgetæœ‰ä¸¤ä¸ªç›´æ¥å­ç±»ï¼š<code>StatelessWidget</code>å’Œ<code>StatefulWidget</code>ï¼š</p><ul><li><code>StatelessWidget</code>ï¼šè¿™ä¸ªæ˜¯æ— çŠ¶æ€Widgetï¼Œå®ç°<code>build()</code>æ–¹æ³•åï¼Œå°±ä¸å¯å†å˜åŒ–ï¼Œå“ªæ€•ä»–çš„çŠ¶æ€æ”¹å˜äº†ã€‚è¿™å¥è¯å¯èƒ½æœ‰ç‚¹çŸ›ç›¾ï¼Œä½†æ˜¯æˆ‘æ¥ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”æ–¹è¯´ç°åœ¨æœ‰ä¸€ä¸ª<code>StatelessWidget</code>ï¼Œä»–çš„å†…å®¹å°±æ˜¯ä¸€ä¸ª<code>Text</code>ï¼Œè€Œè¿™ä¸ª<code>Text</code>çš„å†…å®¹åˆ™æ˜¾ç¤ºäº†<code>counter</code>è¿™ä¸ªå˜é‡ã€‚å½“è¿™ä¸ªé¡µé¢å‡ºç°çš„æ—¶å€™ï¼Œå–äº†å½“æ—¶<code>counter</code>çš„å€¼å¹¶æ˜¾ç¤ºäº†å‡ºæ¥ï¼Œä½†æ˜¯æˆ‘ä»¬åç»­ä¸ç®¡<code>counter</code>è¿™ä¸ªå€¼æ€ä¹ˆæ”¹å˜ï¼Œç•Œé¢éƒ½æ˜¯ä¸ä¼šæ˜¾ç¤ºå‡ºæ¥çš„ã€‚</li><li><code>StatefulWidget</code>ï¼šè¿™ä¸ªæ˜¯æœ‰çŠ¶æ€Widgetï¼Œå½“ä½ æœ‰çŠ¶æ€éœ€è¦æ”¹å˜çš„æ—¶å€™å°±å¯ä»¥é€šè¿‡ä»–æ¥æ”¹å˜çŠ¶æ€ã€‚</li></ul><p>Stateçš„å‡ ç§çŠ¶æ€ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:center">åç§°</th><th style="text-align:center">çŠ¶æ€</th></tr></thead><tbody><tr><td style="text-align:center">initState</td><td style="text-align:center">createä¹‹åè¢«insertåˆ°æ¸²æŸ“æ ‘æ—¶è°ƒç”¨çš„ï¼Œåªä¼šè°ƒç”¨ä¸€æ¬¡</td></tr><tr><td style="text-align:center">didChangeDependencies</td><td style="text-align:center">stateä¾èµ–çš„å¯¹è±¡å‘ç”Ÿå˜åŒ–æ—¶è°ƒç”¨</td></tr><tr><td style="text-align:center">didUpdateWidget</td><td style="text-align:center">WidgetçŠ¶æ€æ”¹å˜æ—¶å€™è°ƒç”¨ï¼Œå¯èƒ½ä¼šè°ƒç”¨å¤šæ¬¡</td></tr><tr><td style="text-align:center">build</td><td style="text-align:center">æ„å»ºWidgetæ—¶è°ƒç”¨</td></tr><tr><td style="text-align:center">deactivate</td><td style="text-align:center">å½“ç§»é™¤æ¸²æŸ“æ ‘çš„æ—¶è°ƒç”¨</td></tr><tr><td style="text-align:center">dispose</td><td style="text-align:center">Widgetå³å°†é”€æ¯æ—¶è°ƒç”¨</td></tr></tbody></table></div><h1 id="StatelessWidget"><a href="#StatelessWidget" class="headerlink" title="StatelessWidget"></a>StatelessWidget</h1><p>è¿™ä¸ªç±»ç›¸å¯¹ç®€å•ï¼Œåªéœ€è¦å®ç°<code>build()</code>æ–¹æ³•å°±å¯ä»¥äº†ã€‚</p><p><code>StatelessWidget</code>ç”¨äºä¸éœ€è¦ç»´æŠ¤çŠ¶æ€çš„åœºæ™¯ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä»–éœ€è¦æ˜¾ç¤ºçš„æŸä¸€ä¸ªå‚æ•°çš„å€¼å‘ç”Ÿå˜åŒ–äº†ä»–ä¹Ÿä¸å˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> <span class="keyword">extends</span> <span class="title class_">StatelessWidget</span> &#123;</span><br><span class="line">  Test(&#123;Key key, <span class="built_in">this</span>.title&#125;) : <span class="built_in">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> String title;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget <span class="title function_">build</span><span class="params">(BuildContext context)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: <span class="keyword">new</span> <span class="title class_">AppBar</span>(</span><br><span class="line">        title: Text(<span class="string">&quot;$title&quot;</span>),</span><br><span class="line">      ),</span><br><span class="line">      body: Text(<span class="string">&quot;1234&quot;</span>),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç å°±æ¼”ç¤ºäº†ä¸€ä¸ª<code>StatelessWidget</code>çš„ä¾‹å­ï¼ŒåŠŸèƒ½æ˜¯æ ¹æ®ä¼ å…¥çš„<code>title</code>åœ¨ç•Œé¢çš„<code>title</code>äº†ä¸Šæ˜¾ç¤ºå‡ºæ¥ã€‚åªå®ç°äº†<code>build()</code>æ–¹æ³•å’Œæ„é€ æ–¹æ³•ã€‚å…¶ä¸­æ„é€ æ–¹æ³•å‚æ•°<code>Key</code>æ˜¯å¿…é¡»å¾—æœ‰çš„ï¼Œè€Œä¸”å¦‚æœè¯¥Widgetè¿˜æœ‰å…¶ä»–çŠ¶æ€çš„è¯ï¼Œä¹Ÿéœ€è¦å†™å…¥æ„é€ æ–¹æ³•ã€‚æ¥ç€è°ƒç”¨<code>build()</code>æ–¹æ³•ï¼Œå°†ä¼ å…¥çš„<code>title</code>åœ¨ç•Œé¢çš„<code>title</code>ä¸Šæ˜¾ç¤ºå‡ºæ¥ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬è°ƒç”¨å®ƒï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@override</span></span><br><span class="line">  Widget <span class="title function_">build</span><span class="params">(BuildContext context)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      title: <span class="string">&#x27;Flutter Demo&#x27;</span>,</span><br><span class="line">      theme: ThemeData(</span><br><span class="line">        primarySwatch: Colors.blue,</span><br><span class="line">      ),</span><br><span class="line">      home: Test(title: <span class="string">&#x27;Flutter Demo Home Page&#x27;</span>),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><br>ç»“æœæ˜¯ï¼š<br><img src="https://cdn.littlecorgi.top/mweb/2019-10-09/Screenshot_20191009-112644.jpg" alt="Screenshot_20191009-112644"></p><h1 id="StatefulWidget"><a href="#StatefulWidget" class="headerlink" title="StatefulWidget"></a>StatefulWidget</h1><p>ä¸<code>StatelessWidget</code>ç›¸å¯¹çš„å°±æ˜¯<code>StatefulWidget</code>ã€‚å®ƒçš„é‡ç‚¹åœ¨äºå¯ä»¥æ ¹æ®çŠ¶æ€æ¥æ›´æ–°ã€‚</p><p>ä»–è¾ƒäº<code>StatelessWidget</code>ï¼Œå°‘äº†æˆ‘ä»¬å¸¸ç”¨çš„<code>build()</code>æ–¹æ³•ï¼Œå¤šäº†<code>createState()</code>æ–¹æ³•ã€‚ä¸‹é¢æˆ‘å°±æ¥è®²ä¸€ä¸‹ä»–çš„ç”¨æ³•ï¼Œæˆ‘è¿˜æ˜¯æ‹¿ä¸Šé¢çš„<code>Test</code>åšä¾‹å­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> <span class="keyword">extends</span> <span class="title class_">StatefulWidget</span> &#123;</span><br><span class="line">  Test(&#123;Key key, <span class="built_in">this</span>.title&#125;) : <span class="built_in">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> String title;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _TestState <span class="title function_">createState</span><span class="params">()</span> =&gt; _TestState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">_TestState</span> <span class="keyword">extends</span> <span class="title class_">State</span>&lt;Test&gt; &#123;</span><br><span class="line">  String _title;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">initState</span><span class="params">()</span> &#123;</span><br><span class="line">    setState(() &#123;</span><br><span class="line">      _title = widget.title;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">super</span>.initState();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget <span class="title function_">build</span><span class="params">(BuildContext context)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: <span class="keyword">new</span> <span class="title class_">AppBar</span>(</span><br><span class="line">        title: Text(<span class="string">&quot;$_title&quot;</span>),</span><br><span class="line">      ),</span><br><span class="line">      body: Text(<span class="string">&quot;1234&quot;</span>),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆçœ‹<code>Test</code>ç±»ï¼Œä»–ç»§æ‰¿è‡ª<code>StatefulWidget</code>ï¼Œç”±äºè¿™ä¸ªé¡µé¢éœ€è¦æ ¹æ®ä¼ å…¥çš„å‚æ•°æ¥æ˜¾ç¤º<code>title</code>ï¼Œæ‰€ä»¥æœ‰ä¸€ä¸ªçŠ¶æ€<code>title</code>ï¼Œå¹¶åœ¨æ„é€ æ–¹æ³•ä¸­å†™å…¥äº†ä»–ã€‚æ¥ç€è°ƒç”¨äº†<code>createState()</code>æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯æ‰€æœ‰<code>StatefulWidget</code>å¿…é¡»çš„ï¼Œä¸»è¦æ˜¯ä¸ºè¿™ä¸ªWidgetåˆ›å»ºä»–å¯¹åº”çš„Stateã€‚</p><p>äºæ˜¯æˆ‘ä»¬å°±åœ¨ä¸‹é¢åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»ï¼Œç±»åå«<code>_TestState</code>ï¼Œç»§æ‰¿è‡ª<code>State&lt;Test&gt;</code>ã€‚ç”±äºWidgetæœ‰<code>title</code>è¿™ä¸ªçŠ¶æ€ï¼Œå¹¶ä¸”éœ€è¦åœ¨ç•Œé¢ä¸­æ˜¾ç¤ºå‡ºæ¥ï¼Œæ‰€ä»¥ä¸ºäº†é™ä½ä»–ä»¬çš„è€¦åˆåº¦ï¼Œæˆ‘ä»¬åœ¨Stateç±»ä¸­ä¹Ÿåˆ›å»ºä¸€ä¸ªå«<code>_title</code>çš„çŠ¶æ€ï¼Œå¹¶<code>_title = widget.title;</code>ã€‚<br>æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ª<code>initState()</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯Stateå¿…é¡»çš„ï¼Œåœ¨ä¸Šé¢Widgetçš„çŠ¶æ€ä¸­æˆ‘ä»¬è®²åˆ°è¿‡ï¼Œè¿™ä¸ªæ˜¯åˆå§‹åŒ–Stateçš„ï¼ŒåŒæ—¶åœ¨<code>initSate()</code>é‡Œé¢ï¼Œæˆ‘ä»¬å†™äº†ä¸€ä¸ª<code>setState()</code>ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å‘Šè¯‰Flutterè¯´è¿™ä¸ªæ–¹æ³•é‡Œé¢çš„å‚æ•°æ”¹å˜äº†æ¥ç€Widgetçš„çŠ¶æ€ä¹Ÿå¾—æ”¹å˜ã€‚æœ€åå°±æ˜¯<code>build()</code>æ–¹æ³•ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬è°ƒç”¨å®ƒï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@override</span></span><br><span class="line">  Widget <span class="title function_">build</span><span class="params">(BuildContext context)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      title: <span class="string">&#x27;Flutter Demo&#x27;</span>,</span><br><span class="line">      theme: ThemeData(</span><br><span class="line">        primarySwatch: Colors.blue,</span><br><span class="line">      ),</span><br><span class="line">      home: Test(title: <span class="string">&#x27;1234&#x27;</span>),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><br>ç»“æœæ˜¯ï¼š<br><img src="https://cdn.littlecorgi.top/mweb/2019-10-09/Screenshot_20191009-114316.jpg" alt="Screenshot_20191009-114316"></p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Flutter/">Flutter</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Flutter/">Flutter</category>
      
      
      <comments>https://www.littlecorgi.top/posts/fc77cdce.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Flutterå…¥é—¨å¹¶å¼€å‘å¤©æ°”é¢„æŠ¥APP(2)â€”â€”Flutterè®¡æ•°å™¨Demo</title>
      <link>https://www.littlecorgi.top/posts/956d1e66.html</link>
      <guid>https://www.littlecorgi.top/posts/956d1e66.html</guid>
      <pubDate>Wed, 09 Oct 2019 02:53:57 GMT</pubDate>
      
      <description>&lt;p&gt;æœ¬æ–‡æ ·ä¾‹éƒ½æ˜¯ä½¿ç”¨çš„AndroidStudioï¼Œå¦‚æœä½ ä½¿ç”¨Xcodeæˆ–è€…vscodeï¼Œä»£ç éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯IDEåˆ›å»ºé¡¹ç›®çš„æ–¹å¼ä»¥åŠè¿è¡ŒæŒ‰é”®ä½ç½®ä¸åŒè€Œå·²ã€‚&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>æœ¬æ–‡æ ·ä¾‹éƒ½æ˜¯ä½¿ç”¨çš„AndroidStudioï¼Œå¦‚æœä½ ä½¿ç”¨Xcodeæˆ–è€…vscodeï¼Œä»£ç éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯IDEåˆ›å»ºé¡¹ç›®çš„æ–¹å¼ä»¥åŠè¿è¡ŒæŒ‰é”®ä½ç½®ä¸åŒè€Œå·²ã€‚</p><span id="more"></span><h1 id="åˆ›å»ºFlutteré¡¹ç›®"><a href="#åˆ›å»ºFlutteré¡¹ç›®" class="headerlink" title="åˆ›å»ºFlutteré¡¹ç›®"></a>åˆ›å»ºFlutteré¡¹ç›®</h1><p>AndroidStudioä¸­é€‰æ‹©<code>File</code>-&gt;<code>New</code>-&gt;<code>New Flutter Project</code>-&gt;<code>Flutter Application</code>-&gt;<code>NEXT</code>ã€‚æ¥ç€å¡«å†™ä½ çš„é¡¹ç›®åç§°ç­‰ä¸€ç³»åˆ—ä¿¡æ¯åå°±åˆ›å»ºæˆåŠŸäº†ï¼Œæˆ‘ä»¬å°±ä¼šçœ‹åˆ°AndroidStudioå·²ç»ä¸ºæˆ‘ä»¬åˆ›å»ºå¥½äº†ä¸€ä¸ªDemoï¼Œæ¥ç€è¿ä¸Šä½ çš„æ‰‹æœºæˆ–è€…æ‰“å¼€ä½ çš„è™šæ‹Ÿæœºï¼ŒæŒ‰ä¸‹AndroidStudioçš„è¿è¡Œé”®ï¼Œä¸ä¸€ä¼šå„¿ï¼Œä½ å°±ä¼šæƒŠå–œçš„å‘ç°ä½ çš„æ‰‹æœºä¸Šå°±æœ‰ä¸€ä¸ªFlutterè®¡æ•°å™¨Demoäº†ã€‚<br><img src="https://cdn.littlecorgi.top/mweb/2019-10-09/%E8%AE%A1%E6%95%B0%E5%99%A8%E8%BF%90%E8%A1%8CDemo.png" alt="è®¡æ•°å™¨è¿è¡ŒDemo"></p><h1 id="ä»‹ç»ä¸‹AndroidStudioç•Œé¢"><a href="#ä»‹ç»ä¸‹AndroidStudioç•Œé¢" class="headerlink" title="ä»‹ç»ä¸‹AndroidStudioç•Œé¢"></a>ä»‹ç»ä¸‹AndroidStudioç•Œé¢</h1><p><img src="https://cdn.littlecorgi.top/mweb/2019-10-09/AndroidStudio%E7%95%8C%E9%9D%A2.png" alt="AndroidStudioç•Œé¢"><br>è¿™æ˜¯æˆ‘çš„AndroidStudioç•Œé¢ï¼Œæ¥ä¸‹æ¥æˆ‘åˆ†ä¸‰ä¸ªéƒ¨åˆ†ä»‹ç»ä¸‹AndroidStudioçš„å¤§è‡´ç•Œé¢ã€‚</p><h2 id="æ§åˆ¶åŒº"><a href="#æ§åˆ¶åŒº" class="headerlink" title="æ§åˆ¶åŒº"></a>æ§åˆ¶åŒº</h2><p><img src="https://cdn.littlecorgi.top/mweb/2019-10-09/%E6%8E%A7%E5%88%B6%E5%8C%BA.png" alt="æ§åˆ¶åŒº"></p><p>ä¸€æ¬¡ä»‹ç»æ¯ä¸€ä¸ªæŒ‰é’®çš„åŠŸèƒ½ã€‚</p><ol><li>ç¬¬ä¸€ä¸ªæ˜¯ç”¨æ¥é€‰æ‹©è¿è¡Œè®¾å¤‡çš„ï¼Œæ¯”æ–¹è¯´æˆ‘ç°åœ¨å°±é€‰çš„æ˜¯æˆ‘çš„è™šæ‹Ÿæœºï¼Œç„¶åæˆ‘æŒ‰ä¸‹è¿è¡Œåå°±å¯ä»¥å°†é¡¹ç›®è¿è¡Œåˆ°æˆ‘çš„è™šæ‹Ÿæœºä¸Šè€Œä¸ä¼šè¿è¡Œåˆ°è¿ç€æˆ‘çš„ç”µè„‘çš„æ‰‹æœºä¸Šå»ï¼›</li><li>ç¬¬äºŒä¸ªæ˜¯é€‰æ‹©è¿è¡Œå“ªä¸ªFlutter moduleï¼Œå¦‚æœä½ åŒä¸€ä¸ªé¡¹ç›®é‡Œé¢æœ‰å¤šä¸ªmoduleï¼Œä½ å°±å¯ä»¥åœ¨æ­¤é€‰æ‹©ä½ æƒ³è¦è¿è¡Œçš„moduleï¼›</li><li>ç¬¬ä¸‰ä¸ªç°è‰²çš„é€‰é¡¹æ¡†æˆ‘ä¹Ÿæ²¡å¼„æ‡‚å¥¹æ˜¯å¹²å˜›çš„ï¼Œæˆ‘è‡³ä»Šéƒ½æ²¡èƒ½é€‰æ‹©è¿‡ï¼Œä¸€ç›´éƒ½æ˜¯ç°çš„ï¼›</li><li>ç»¿è‰²çš„ä¸‰è§’å½¢ï¼Œå¤§å®¶ç†ŸçŸ¥ï¼Œè¿è¡Œé”®ï¼›</li><li>çº¢è‰²çš„ç“¢è™«ï¼Œå¤§å®¶ç†ŸçŸ¥ï¼Œdebugé”®ï¼›</li><li>ä¸çŸ¥é“å¹²å˜›çš„ï¼›</li><li>FlutterAPPçš„æ€§èƒ½ç›‘è§†å™¨ï¼›</li><li>é—ªç”µï¼Œè¿™ä¸ªæ˜¯é‡ç‚¹ï¼Œä¹Ÿæ˜¯Flutterçš„ä¸€å¤§ç‰¹æ€§ï¼Œçƒ­é‡è½½é”®ï¼Œä»–èƒ½åšåˆ°ä¸éœ€è¦é‡æ–°ç¼–è¯‘ä»£ç å°±èƒ½å°†ä½ ä¿®æ”¹çš„ä»£ç çš„æ•ˆæœåœ¨ä½ çš„APPä¸Šæ˜¾ç¤ºå‡ºæ¥ï¼›</li><li>ä¸çŸ¥é“å¹²å˜›çš„ï¼›</li><li>çº¢è‰²çš„æ­£æ–¹å½¢ï¼Œåœæ­¢è¿è¡ŒæŒ‰é’®ã€‚</li></ol><h2 id="Runè¿è¡ŒåŒº"><a href="#Runè¿è¡ŒåŒº" class="headerlink" title="Runè¿è¡ŒåŒº"></a>Runè¿è¡ŒåŒº</h2><p><img src="https://cdn.littlecorgi.top/mweb/2019-10-09/Run%E8%BF%90%E8%A1%8C%E5%8C%BA.png" alt="Runè¿è¡ŒåŒº"><br>å°±æ˜¯Flutterçš„ä¿¡æ¯æ˜¾ç¤ºåŒºï¼Œç±»ä¼¼äºAndroidStudioçš„Logcatï¼Œèƒ½æ˜¾ç¤ºFlutterAPPè¿è¡Œä¸­çš„ä¸€äº›ä¿¡æ¯ã€‚</p><h2 id="Flutter-Outline-Flutter-InspectoråŒº"><a href="#Flutter-Outline-Flutter-InspectoråŒº" class="headerlink" title="Flutter Outline/Flutter InspectoråŒº"></a>Flutter Outline/Flutter InspectoråŒº</h2><p><img src="https://cdn.littlecorgi.top/mweb/2019-10-09/Flutter%20Outline.png" alt="Flutter Outline"><br><img src="https://cdn.littlecorgi.top/mweb/2019-10-09/Flutter%20Inspector.png" alt="Flutter Inspecto"><br>ç”¨äºæ˜¾ç¤ºå½“å‰ç•Œé¢çš„ä¸€äº›æ„å»ºä¿¡æ¯ã€‚</p><h1 id="Flutteré¡¹ç›®ç»“æ„"><a href="#Flutteré¡¹ç›®ç»“æ„" class="headerlink" title="Flutteré¡¹ç›®ç»“æ„"></a>Flutteré¡¹ç›®ç»“æ„</h1><p><img src="https://cdn.littlecorgi.top/mweb/2019-10-09/Flutter%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84.png" alt="Flutteré¡¹ç›®ç»“æ„"></p><p>æˆ‘ä»¬æŒ‘ä¸€äº›é‡è¦çš„è¯´ä¸€ä¸‹ï¼š</p><ol><li>.ideaæ–‡ä»¶å¤¹ï¼ŒAndroidStudioè¯†åˆ«é¡¹ç›®çš„å¿…å¤‡æ–‡ä»¶å¤¹ï¼Œä¸ç”¨ç®¡ï¼›</li><li>Androidæ–‡ä»¶å¤¹ï¼Œå­˜æ”¾Flutteræ„å»ºçš„Androidé¡¹ç›®çš„æ–‡ä»¶å¤¹ï¼›</li><li>iosæ–‡ä»¶å¤¹ï¼Œå­˜æ”¾Flutteræ„å»ºçš„iOSé¡¹ç›®çš„æ–‡ä»¶å¤¹ï¼›</li><li>libæ–‡ä»¶å¤¹ï¼Œå­˜æ”¾Flutteré¡¹ç›®å’Œèµ„æºçš„æ–‡ä»¶å¤¹ï¼›</li><li>pubspec.yamlæ–‡ä»¶ï¼Œå­˜æ”¾Flutteré¡¹ç›®ç›¸å…³ä¿¡æ¯ï¼Œå¦‚é¡¹ç›®åç§°ã€ç‰ˆæœ¬ã€ä¾èµ–ç­‰ç­‰ï¼Œç±»ä¼¼äºAndroidé¡¹ç›®çš„build.gradleæ–‡ä»¶ã€‚</li></ol><h1 id="main-dartæ–‡ä»¶"><a href="#main-dartæ–‡ä»¶" class="headerlink" title="main.dartæ–‡ä»¶"></a>main.dartæ–‡ä»¶</h1><p>æˆ‘ä»¬é€šè¿‡è®²è¿™ä¸ªæ–‡ä»¶æ¥ç»™å¤§å®¶å¤§è‡´ä»‹ç»ä¸‹Flutteré¡¹ç›®ä»£ç ç»“æ„ã€‚</p><p>å…¨éƒ¨æºä»£ç åœ¨æ­¤<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() =&gt; runApp(MyApp());</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      title: <span class="string">&#x27;Flutter Demo&#x27;</span>,</span><br><span class="line">      theme: ThemeData(</span><br><span class="line">        primarySwatch: Colors.blue,</span><br><span class="line">      ),</span><br><span class="line">      home: MyHomePage(title: <span class="string">&#x27;Flutter Demo Home Page&#x27;</span>),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyHomePage</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  MyHomePage(&#123;Key key, <span class="keyword">this</span>.title&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> title;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _MyHomePageState createState() =&gt; _MyHomePageState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_MyHomePageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">MyHomePage</span>&gt; </span>&#123;</span><br><span class="line">  <span class="built_in">int</span> _counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> _incrementCounter() &#123;</span><br><span class="line">    setState(() &#123;</span><br><span class="line">      _counter++;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(widget.title),</span><br><span class="line">      ),</span><br><span class="line">      body: Center(</span><br><span class="line">        child: Column(</span><br><span class="line">          mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">          children: &lt;Widget&gt;[</span><br><span class="line">            Text(</span><br><span class="line">              <span class="string">&#x27;You have pushed the button this many times:&#x27;</span>,</span><br><span class="line">            ),</span><br><span class="line">            Text(</span><br><span class="line">              <span class="string">&#x27;<span class="subst">$_counter</span>&#x27;</span>,</span><br><span class="line">              style: Theme.of(context).textTheme.display1,</span><br><span class="line">            ),</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">      floatingActionButton: FloatingActionButton(</span><br><span class="line">        onPressed: _incrementCounter,</span><br><span class="line">        tooltip: <span class="string">&#x27;Increment&#x27;</span>,</span><br><span class="line">        child: Icon(Icons.add),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><h2 id="import"><a href="#import" class="headerlink" title="import"></a>import</h2><p>é¦–å…ˆæˆ‘ä»¬çœ‹æœ€å¼€å§‹çš„<code>import</code>åŒºã€‚</p><p>è¿™å—ç›¸å½“äºC/C++çš„<code>include</code>ï¼Œåè€Œä¸åƒjavaçš„<code>import</code>ã€‚æˆ‘ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Œä½ æƒ³ä¸€ä¸‹ï¼Œä½ å†™javaç¨‹åºçš„æ—¶å€™ï¼Œä½ æ˜¯éœ€è¦å“ªä¸ªç±»å°±ç›´æ¥åœ¨ä»£ç ä¸­è¾“å…¥ç±»åï¼Œç„¶åIDEä¼šè‡ªåŠ¨ç»™ä½ æ˜¾ç¤ºæœ‰è¿™ä¸ªç±»çš„æ‰€æœ‰çš„åŒ…ï¼Œç„¶åè®©ä½ é€‰åŒ…å»å¯¼å…¥ï¼›è€Œå†™dartæ˜¯éœ€è¦ä½ å…ˆå¯¼å…¥åŒ…ï¼Œæ‰èƒ½åœ¨ä»£ç ä¸­å†™è¿™ä¸ªåŒ…ä¸­çš„ç±»ï¼Œå¦‚æœä½ æ²¡æœ‰å…ˆå¯¼å…¥åŒ…è€Œç›´æ¥åˆ°ä¸‹é¢å†™çš„è¯ï¼ŒIDEæ˜¯ä¸ä¼šæç¤ºä½ è¿™ä¸ªç±»å¯èƒ½ä¼šåœ¨å“ªä¸ªåŒ…ä¸­ï¼Œè€Œæ˜¯ç›´æ¥æŠ¥é”™ï¼Œè¿™ç‚¹å’ŒC/C++æ¯”è¾ƒç±»ä¼¼ã€‚</p><p>é‚£æˆ‘ä»¬ä¸ºä»€ä¹ˆå¯¼å…¥çš„æ˜¯<code>flutter/material.dart</code>è¿™ä¸ªåŒ…å‘¢ï¼Ÿæˆ‘åœ¨ç¬¬ä¸€èŠ‚é‡Œé¢è¯´è¿‡ï¼ŒFlutterä»–å†…ç½®äº†Androidçš„Material Designé£æ ¼å’ŒiOSçš„Cupertinoé£æ ¼çš„UIï¼›æ‰€ä»¥è¿™å—å°±æ˜¯å¯¼å…¥Material Designé£æ ¼UIæ–‡ä»¶ï¼Œè€Œå¦‚æœä½ è¦ä½¿ç”¨Cupertinoé£æ ¼UIæ–‡ä»¶çš„è¯ï¼ŒæŠŠå®ƒæ”¹æˆCupertinoå°±è¡Œäº†ã€‚</p><h2 id="main"><a href="#main" class="headerlink" title="main()"></a>main()</h2><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> main() =&gt; runApp(MyApp());</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      title: <span class="string">&#x27;Flutter Demo&#x27;</span>,</span><br><span class="line">      theme: ThemeData(</span><br><span class="line">        primarySwatch: Colors.blue,</span><br><span class="line">      ), </span><br><span class="line">      home: MyHomePage(title: <span class="string">&#x27;Flutter Demo Home Page&#x27;</span>),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>ç¬¬ä¸€è¡Œï¼ŒæŒ‡æ˜é¡¹ç›®çš„å…¥å£å°±æ˜¯<code>MyApp()</code>ã€‚å›ºå®šæ ¼å¼ï¼Œå¯ä»¥ä¸ç”¨ç®¡ã€‚</p></li><li><p>ç¬¬äºŒè¡Œå°±å®šä¹‰äº†ä¸€ä¸ªç±»<code>MyApp</code>ç»§æ‰¿è‡ª<code>StatelessWidget</code>ï¼Œå¹¶é‡å†™äº†çˆ¶ç±»çš„<code>build()</code>æ–¹æ³•ã€‚<code>Widget</code>å¯ä»¥çœ‹æˆFlutterä¸­çš„é¡µé¢ï¼Œåªè¦æ˜¯Flutterä¸­çš„é¡µé¢ï¼Œéƒ½å¿…é¡»ç»§æ‰¿è‡ª<code>Widget</code>ã€‚ä»–æœ‰ç‚¹ç±»ä¼¼äºAndroidä¸­çš„<code>View</code>ï¼Œä½†æ˜¯ä¸åŒäº<code>View</code>çš„æ˜¯ï¼ŒFlutterä¸­çš„<code>padding</code>ã€<code>align</code>ã€<code>layout</code>ç­‰å±…ç„¶ä¹Ÿæ˜¯<code>Widget</code>ã€‚</p></li><li><p>å¦‚æœæ˜¯<code>StatelessWidget</code>ï¼Œåˆ™ä»£è¡¨å¥¹æ˜¯ä¸€ä¸ªâ€œçŠ¶æ€å°‘â€çš„<code>Widget</code>ï¼Œæˆ‘çš„ç†è§£å°±æ˜¯çŠ¶æ€ç›¸å½“äº<code>Widget</code>çš„ä¸€äº›æ•°å€¼ï¼Œæ¯”æ–¹è¯´é¡µé¢è¦æ˜¾ç¤ºè®¡æ•°å™¨çš„è®¡æ•°<code>count</code>ï¼Œé‚£ä¹ˆè¿™ä¸ª<code>count</code>å°±æ˜¯ä¸€ä¸ªçŠ¶æ€ï¼Œåªè¦æœ‰çŠ¶æ€å°±ä½¿ç”¨<code>StatefulWidget</code>ã€‚åƒ<code>MyApp</code>å®ƒæ²¡æœ‰çŠ¶æ€ï¼Œäºæ˜¯å°±ç”¨<code>StatelessWidget</code>ã€‚</p></li><li><p>ç»§æ‰¿è‡ª<code>StatelessWidget</code>çš„ç±»å¿…é¡»å®ç°<code>build()</code>æ–¹æ³•ï¼Œç›¸å½“äºè¿™ä¸ªç±»æ˜¯ä¸€ä¸ªæ­»é¡µé¢ï¼Œåªéœ€è¦å±•ç¤ºå›ºå®šçš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯ä¸éœ€è¦çŠ¶æ€ï¼Œæ‰€ä»¥ç›´æ¥é€šè¿‡<code>build()</code>ç›´æ¥å†™å…¥ç•Œé¢å°±è¡Œã€‚</p></li><li><p><code>build()</code>æ–¹æ³•å¿…é¡»åŒæ ·è¿”å›ä¸€ä¸ª<code>Widget</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä½¿ç”¨<code>MaterialApp</code>ï¼Œå…¶ä¸­æˆ‘ä»¬ç»™ä»–çš„<code>title</code>ã€<code>theme</code>ã€<code>home</code>è¿›è¡Œäº†èµ‹å€¼ï¼ŒåŒå­¦ä»¬åº”è¯¥éƒ½èƒ½å¤§è‡´è¯»æ‡‚å•¥æ„æ€ï¼Œé¦–é¡µ<code>home</code>åˆ™ç»™äº†<code>MyHomePage</code>.</p></li></ul><h2 id="MyHomePage"><a href="#MyHomePage" class="headerlink" title="MyHomePage"></a>MyHomePage</h2><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyHomePage</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  MyHomePage(&#123;Key key, <span class="keyword">this</span>.title&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> title;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _MyHomePageState createState() =&gt; _MyHomePageState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_MyHomePageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">MyHomePage</span>&gt; </span>&#123;</span><br><span class="line">  <span class="built_in">int</span> _counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> _incrementCounter() &#123;</span><br><span class="line">    setState(() &#123;</span><br><span class="line">      _counter++;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(widget.title),</span><br><span class="line">      ),</span><br><span class="line">      body: Center(</span><br><span class="line">        child: Column(</span><br><span class="line">          mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">          children: &lt;Widget&gt;[</span><br><span class="line">            Text(</span><br><span class="line">              <span class="string">&#x27;You have pushed the button this many times:&#x27;</span>,</span><br><span class="line">            ),</span><br><span class="line">            Text(</span><br><span class="line">              <span class="string">&#x27;<span class="subst">$_counter</span>&#x27;</span>,</span><br><span class="line">              style: Theme.of(context).textTheme.display1,</span><br><span class="line">            ),</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">      floatingActionButton: FloatingActionButton(</span><br><span class="line">        onPressed: _incrementCounter,</span><br><span class="line">        tooltip: <span class="string">&#x27;Increment&#x27;</span>,</span><br><span class="line">        child: Icon(Icons.add),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="MyHomePage-1"><a href="#MyHomePage-1" class="headerlink" title="MyHomePage"></a>MyHomePage</h3><p>æˆ‘ä»¬åœ¨å‰é¢è¯´è¿‡ï¼Œå¦‚æœä¸€ä¸ªé¡µé¢æœ‰æ•°æ®ä¹Ÿå°±æ˜¯â€œçŠ¶æ€â€çš„è¯ï¼Œé‚£ä¹ˆä»–å°±å¾—ç»§æ‰¿è‡ª<code>StatefulWidget</code>ã€‚</p><p>å¦‚æœä¸€ä¸ªç±»ç»§æ‰¿è‡ª<code>StatefulWidget</code>ï¼Œé‚£è¿™ä¸ªç±»ä¼šå¾ˆç®€å•ï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œæ„é€ æ–¹æ³•ä¸­å†™å…¥<code>key</code>ä»¥åŠè¯¥<code>Widget</code>éœ€è¦çš„æ•°æ®ã€‚ç„¶åé‡å†™<code>createState()</code>æ–¹æ³•ã€‚</p><h3 id="MyHomePageState"><a href="#MyHomePageState" class="headerlink" title="MyHomePageState"></a>MyHomePageState</h3><p>å¦‚æœä¸€ä¸ªç±»ç»§æ‰¿è‡ª<code>StatefulWIdget</code>ï¼Œé‚£ä¹ˆä¸€å®šä¼šæœ‰ä¸€ä¸ªä»–çš„<code>State</code>ç±»å¹¶ç»§æ‰¿è‡ª<code>State&lt;è¯¥ç±»&gt;</code>ï¼Œå°±åƒ<code>class _MyHomePageState extends State&lt;MyHomePage&gt;</code>ä¸€æ ·ã€‚</p><p>é‚£æˆ‘ä»¬æ¥çœ‹çœ‹Stateç±»é‡Œé¢æœ‰äº›å•¥ä¸œè¥¿:</p><p>é¦–å…ˆå…ˆå®šä¹‰â€œçŠ¶æ€â€ï¼šç”±äºæˆ‘ä»¬è¿™ä¸ªAPPä¸»è¦çš„åŠŸèƒ½æ˜¯ç”¨æ¥è®¡æ•°ï¼Œæ‰€ä»¥å¿…é¡»å®šä¹‰ä¸€ä¸ªintå‹å˜é‡æ¥è®¡æ•°ï¼š<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> _counter = <span class="number">0</span>;</span><br></pre></td></tr></table></figure><br>æ¥ç€å¦‚æœæˆ‘ä»¬è¿™ä¸ª_counterå˜é‡å˜äº†ï¼Œé‚£å°±å¾—é€šçŸ¥flutterè¯´çŠ¶æ€å˜äº†ï¼Œéœ€è¦æ›´æ–°UIï¼š<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> _incrementCounter() &#123;</span><br><span class="line">  setState(() &#123;</span><br><span class="line">     _counter++;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å…¶ä¸­ï¼Œ<code>setState()</code>æ–¹æ³•å°±æ˜¯ç”¨æ¥é€šçŸ¥<code>Flutter</code>è¿™ä¸ªçŠ¶æ€æ”¹å˜äº†ï¼Œè¦å»æ›´æ–°UIçš„ã€‚</p><p>æœ€åé‡å†™<code>build()</code>æ–¹æ³•æ¥å†™å…¥ç•Œé¢ï¼š</p><ul><li><code>Scaffold</code>æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒæä¾›äº†é»˜è®¤çš„å¯¼èˆªæ ã€æ ‡é¢˜å’ŒåŒ…å«ä¸»å±å¹•<code>widget</code>æ ‘ï¼ˆååŒâ€œç»„ä»¶æ ‘â€æˆ–â€œéƒ¨ä»¶æ ‘â€ï¼‰çš„<code>body</code>å±æ€§ã€‚</li><li><code>body</code>åé¢æ˜¯ä¸€ä¸ª<code>Center</code>ç»„ä»¶ï¼Œå®ƒçš„ä½œç”¨æ˜¯å°†å®ƒçš„å­<code>Widget</code>å®šä½åˆ°çˆ¶<code>Widget</code>çš„ä¸­é—´ã€‚</li><li><code>Center</code>åé¢æ˜¯ä¸€ä¸ª<code>Column</code>ç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶ç±»ä¼¼äºAndroidä¸­çš„<code>LinearLayout</code>çš„<code>orientation: Vertical</code>ï¼Œä¹Ÿå°±æ˜¯å‚ç›´å‘çš„çº¿æ€§å¸ƒå±€ã€‚åŒæ—¶Flutterä¹Ÿæä¾›äº†<code>Row</code>è¿™ä¸ªæ°´å¹³å‘çš„çº¿æ€§å¸ƒå±€ã€‚ä»–ä»¬çš„å­<code>Widget</code>æ˜¯<code>children</code>å±æ€§ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å†™å¤šä¸ª<code>Widget</code>ã€‚</li><li><code>Column</code>é‡Œé¢æ˜¯ä¸¤ä¸ª<code>Text</code>ï¼Œè¿™ä¸ªæ²¡å•¥è®²çš„</li><li>æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ª<code>FloatingActionButton</code>ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªæµ®åŠ¨æŒ‰é’®ï¼ŒAndroidé‡Œé¢æœ‰è¿™ä¸ªæ§ä»¶ï¼Œæ ¸å¿ƒæ˜¯ä»–çš„<code>onPressed</code>å±æ€§ï¼Œè¿™ä¸ªå°±ç›¸å½“äº<code>onClick()</code>ï¼Œç”¨äºå¤„ç†ç‚¹å‡»äº‹ä»¶ã€‚</li></ul><h1 id="ä½“éªŒçƒ­é‡å¯"><a href="#ä½“éªŒçƒ­é‡å¯" class="headerlink" title="ä½“éªŒçƒ­é‡å¯"></a>ä½“éªŒçƒ­é‡å¯</h1><p>é¦–å…ˆå…ˆè®©é¡¹ç›®åœ¨è™šæ‹Ÿæœºæˆ–è€…æ‰‹æœºä¸Šè¿è¡Œç€ï¼Œç„¶åæˆ‘ä»¬æŠŠé¡µé¢Textä¸­çš„â€You have pushed the button this many times:â€æ”¹ä¸ºâ€You have clicked the button this many times:â€ï¼Œç„¶åæŒ‰çƒ­é‡å¯é”®ï¼ˆmacOSç‰ˆAndroidStudioé»˜è®¤æ˜¯commond+sé”®ï¼‰ï¼Œæ¥ç€ä½ å°±èƒ½é‡Œé¢åœ¨è™šæ‹Ÿæœºæˆ–è€…æ‰‹æœºä¸Šçœ‹åˆ°ä¿®æ”¹ä¹‹åçš„ç»“æœã€‚<br><img src="https://cdn.littlecorgi.top/mweb/2019-10-09/%E6%9C%AA%E5%91%BD%E5%90%8D%20-2-.gif" alt="flutterçƒ­é‡å¯"></p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Flutter/">Flutter</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Flutter/">Flutter</category>
      
      
      <comments>https://www.littlecorgi.top/posts/956d1e66.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Flutterå…¥é—¨å¹¶å¼€å‘å¤©æ°”é¢„æŠ¥APP(1)â€”â€”Flutterå®‰è£…</title>
      <link>https://www.littlecorgi.top/posts/4bf666bf.html</link>
      <guid>https://www.littlecorgi.top/posts/4bf666bf.html</guid>
      <pubDate>Tue, 08 Oct 2019 11:55:33 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;Flutteræ˜¯ä»€ä¹ˆ&quot;&gt;&lt;a href=&quot;#Flutteræ˜¯ä»€ä¹ˆ&quot; class=&quot;headerlink&quot; title=&quot;Flutteræ˜¯ä»€ä¹ˆ&quot;&gt;&lt;/a&gt;Flutteræ˜¯ä»€ä¹ˆ&lt;/h1&gt;&lt;p&gt;Flutteræ˜¯ç”±è°·æ­Œæ¨å‡ºçš„ä¸€ä¸ªç§»åŠ¨UIæ¡†æ¶ï¼Œå¯ä»¥è®©å¼€å‘è€…å¿«é€Ÿçš„åœ¨Androidå’ŒiOSä¸Šæ„å»ºé«˜è´¨é‡çš„åŸç”Ÿç”¨æˆ·ç•Œé¢ã€‚&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="Flutteræ˜¯ä»€ä¹ˆ"><a href="#Flutteræ˜¯ä»€ä¹ˆ" class="headerlink" title="Flutteræ˜¯ä»€ä¹ˆ"></a>Flutteræ˜¯ä»€ä¹ˆ</h1><p>Flutteræ˜¯ç”±è°·æ­Œæ¨å‡ºçš„ä¸€ä¸ªç§»åŠ¨UIæ¡†æ¶ï¼Œå¯ä»¥è®©å¼€å‘è€…å¿«é€Ÿçš„åœ¨Androidå’ŒiOSä¸Šæ„å»ºé«˜è´¨é‡çš„åŸç”Ÿç”¨æˆ·ç•Œé¢ã€‚</p><span id="more"></span><p>é€šè¿‡å®ƒæ¥ç¼–å†™APPçš„å¥½å¤„åœ¨äºï¼š</p><ul><li>å®ƒå†…ç½®äº†Androidçš„Material Designé£æ ¼å’ŒiOSçš„Cupertinoé£æ ¼çš„UIï¼›</li><li>å®ƒé€šè¿‡Dartè¯­è¨€ç¼–å†™ï¼Œåªéœ€è¦ç¼–å†™ä¸€ä»½ä»£ç å°±èƒ½åœ¨Androidå’ŒiOSè®¾å¤‡ä¸Šå¾—åˆ°åŒæ ·çš„è¿è¡Œæ•ˆæœï¼›</li><li>ä»–æœ‰çƒ­é‡è½½åŠŸèƒ½ï¼Œåªéœ€è¦è¿è¡ŒAPPåï¼Œä»£ç æ›´æ”¹ä¸€ç‚¹ç„¶åç‚¹å‡»çƒ­é‡è½½é”®å°±èƒ½å¿«é€Ÿæ˜¾ç¤ºå‡ºä¿®æ”¹åçš„ç•Œé¢ã€‚</li></ul><h1 id="ä½¿ç”¨é•œåƒå®‰è£…"><a href="#ä½¿ç”¨é•œåƒå®‰è£…" class="headerlink" title="ä½¿ç”¨é•œåƒå®‰è£…"></a>ä½¿ç”¨é•œåƒå®‰è£…</h1><p>ç”±äºä¸€äº›ä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼ŒFlutteråœ¨å›½å†…è®¿é—®æœ‰æ—¶å€™ä¼šå—åˆ°é™åˆ¶ï¼Œå› æ­¤Flutterå®˜æ–¹ä¸ºå›½å†…å¼€å‘è€…æ­å»ºäº†ä¸´æ—¶é•œåƒï¼Œå¤§å®¶å¯ä»¥å°†ä¸‹é¢çš„ç¯å¢ƒå˜é‡æ·»åŠ åˆ°ç³»ç»Ÿä¸­ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PUB_HOSTED_URL=https://pub.flutter-io.cn</span><br><span class="line"><span class="built_in">export</span> FLUTTER_STORAGE_BASE_URL=https://storage.flutter-io.cn</span><br></pre></td></tr></table></figure><br>ç”±äºæˆ‘ç”¨çš„æ˜¯macOSï¼Œå› æ­¤æˆ‘å°±åªæ¼”ç¤ºmacOSçš„ã€‚<br>å¦‚æœæœ‰Linuxçš„ç”¨æˆ·åˆ™å’ŒmacOS çš„å®‰è£…æ–¹å¼ç±»ä¼¼ï¼Œç”šè‡³å¯ä»¥è¯´ä¸€æ ·ï¼›<br>ä½†æ˜¯å¯¹äºWindowsç”¨äºï¼Œéœ€è¦å¤§å®¶æ¡Œé¢å³é”®æ­¤<code>ç”µè„‘-&gt;å±æ€§-&gt;å¼¹å‡ºé¡µé¢å·¦ä¾§æ çš„é«˜çº§ç³»ç»Ÿè®¾ç½®-&gt;ç¯å¢ƒå˜é‡</code>ï¼Œåœ¨ä¸‹é¢çš„ç³»ç»Ÿç¯å¢ƒå˜é‡æ ä¸­ç‚¹å‡»æ–°å»ºï¼Œå˜é‡åè¾“å…¥ä¸Šé¢ç­‰å·å·¦è¾¹çš„å¤§å†™å†…å®¹ï¼Œä¸è¦exportï¼Œå€¼è¾“å…¥ç­‰å·å³è¾¹çš„å†…å®¹ï¼Œè¾“å…¥ä¸€ç»„ä¹‹åå†ç‚¹å‡»æ–°å»ºæ¥ç€è¾“å…¥ä¸‹ä¸€ç»„ã€‚<br><img src="https://img-blog.csdn.net/20180616140532293?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2ExMjAzOTkxNjg2/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="Windowsä¸‹çš„ç¯å¢ƒå˜é‡é…ç½®"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹è¯´macOSã€‚</p><h2 id="é¦–å…ˆä½ å¾—ç¡®å®šä½ ç”¨çš„æ˜¯ä»€ä¹ˆshell"><a href="#é¦–å…ˆä½ å¾—ç¡®å®šä½ ç”¨çš„æ˜¯ä»€ä¹ˆshell" class="headerlink" title="é¦–å…ˆä½ å¾—ç¡®å®šä½ ç”¨çš„æ˜¯ä»€ä¹ˆshell"></a>é¦–å…ˆä½ å¾—ç¡®å®šä½ ç”¨çš„æ˜¯ä»€ä¹ˆshell</h2><p>å¦‚æœä½ æ²¡æ›´æ”¹è¿‡ä½ macOSç»ˆç«¯è®¾ç½®ï¼Œé‚£ä¹ˆä½ é»˜è®¤å°±æ˜¯<code>bash</code>ï¼Œä½†æ˜¯å¦‚æœä½ æ›´æ”¹è¿‡ï¼Œæ¯”æ–¹è¯´æˆ‘å°±æ¢æˆäº†<code>zsh</code>ï¼Œé‚£ä¹ˆæˆ‘è§‰å¾—ä½ åº”è¯¥çŸ¥é“åœ¨å“ªè®¾ç½®ç¯å¢ƒå˜é‡ã€‚</p><h2 id="å¦‚æœä½ æ˜¯bash"><a href="#å¦‚æœä½ æ˜¯bash" class="headerlink" title="å¦‚æœä½ æ˜¯bash"></a>å¦‚æœä½ æ˜¯bash</h2><p>é¦–å…ˆæ‰“å¼€ä½ macOSçš„ç»ˆç«¯ï¼Œåœ¨å¯åŠ¨å°é‡Œé¢å¯ä»¥æ‰¾åˆ°ï¼Œæ¥ç€å¯¹<code>bash</code>çš„ç¯å¢ƒå˜é‡è¿›è¡Œè®¾ç½®ï¼Œè¾“å…¥<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bash_profile</span><br></pre></td></tr></table></figure><br>å›è½¦ï¼Œè¿›å…¥<code>.bash_profile</code>æ–‡ä»¶çš„ç¼–è¾‘é¡µé¢ï¼Œç„¶åæŒ‰ä¸‹é”®ç›˜<code>Ié”®</code>ï¼Œè¿›å…¥vimçš„ç¼–è¾‘æ¨¡å¼ï¼Œç„¶åç›´æ¥æŠŠä¸Šé¢çš„exportç¯å¢ƒå˜é‡èµ‹å€¼ç²˜è´´è¿›å»ã€‚ç„¶åæŒ‰ä¸‹<code>Escé”®</code>é€€å‡ºvimçš„ç¼–è¾‘æ¨¡å¼ï¼Œç„¶åç›´æ¥è¾“å…¥<code>:wq</code>å›è½¦ä¿å­˜å¹¶é€€å‡ºã€‚<br>æ¥ç€è¾“å…¥<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.bash_profile</span><br></pre></td></tr></table></figure><br>è®©åˆšåˆšé…ç½®çš„ç¯å¢ƒå˜é‡ç”Ÿæ•ˆå³å¯ã€‚<br><img src="https://cdn.littlecorgi.top/mweb/2019-10-08/bash%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F.png" alt="bashé…ç½®ç¯å¢ƒå˜é‡"></p><h2 id="å¦‚æœä½ æ˜¯zsh"><a href="#å¦‚æœä½ æ˜¯zsh" class="headerlink" title="å¦‚æœä½ æ˜¯zsh"></a>å¦‚æœä½ æ˜¯zsh</h2><p>é¦–å…ˆæ‰“å¼€ä½ macOSçš„ç»ˆç«¯ï¼Œåœ¨å¯åŠ¨å°é‡Œé¢å¯ä»¥æ‰¾åˆ°ï¼Œæ¥ç€å¯¹<code>zsh</code>çš„ç¯å¢ƒå˜é‡è¿›è¡Œè®¾ç½®ï¼Œè¾“å…¥<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.zshrc</span><br></pre></td></tr></table></figure><br>å›è½¦ï¼Œè¿›å…¥<code>.zshrc</code>æ–‡ä»¶çš„ç¼–è¾‘é¡µé¢ï¼Œæ‰¾åˆ°å¦‚å›¾æ‰€ç¤ºéƒ¨åˆ†ï¼ˆé‡ç‚¹åœ¨äºæœ‰<code># export MANPATH=&quot;/Usrs/......</code>çš„åœ°æ–¹ï¼Œå› ä¸ºæˆ‘è¿˜æœ‰å…¶å®ƒçš„ç¯å¢ƒå˜é‡ï¼Œæ‰€ä»¥ä½ çš„å¯èƒ½å’Œæˆ‘çš„ä¸åŒï¼‰ï¼š<br><img src="https://cdn.littlecorgi.top/mweb/2019-10-08/zshrc.png" alt="zshr"></p><p>åœ¨<code># export</code>ä¸‹é¢ï¼ŒæŒ‰ä¸‹é”®ç›˜<code>Ié”®</code>ï¼Œè¿›å…¥vimçš„ç¼–è¾‘æ¨¡å¼ï¼Œç„¶åç›´æ¥æŠŠä¸Šé¢çš„exportç¯å¢ƒå˜é‡èµ‹å€¼ç²˜è´´è¿›å»ã€‚<br>è§æˆ‘å›¾ä¸­æœ€ä¸‹é¢æ ‡çº¢çš„é‚£åœ°æ–¹ï¼Œè‡³äºæœ€åä¸€è¡Œ<code>export PATH=~/development/flutter/bin:$PATH</code>å…ˆä¸ç®¡ã€‚ç„¶åæŒ‰ä¸‹<code>Escé”®</code>é€€å‡ºvimçš„ç¼–è¾‘æ¨¡å¼ï¼Œç„¶åç›´æ¥è¾“å…¥<code>:wq</code>å›è½¦ä¿å­˜å¹¶é€€å‡ºã€‚<br>æ¥ç€è¾“å…¥<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.zshrc</span><br></pre></td></tr></table></figure><br>è®©åˆšåˆšé…ç½®çš„ç¯å¢ƒå˜é‡ç”Ÿæ•ˆå³å¯ã€‚<br><img src="https://cdn.littlecorgi.top/mweb/2019-10-08/zsh%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F.png" alt="zshé…ç½®ç¯å¢ƒå˜é‡"></p><h1 id="ä¸‹è½½Flutter-SDK"><a href="#ä¸‹è½½Flutter-SDK" class="headerlink" title="ä¸‹è½½Flutter SDK"></a>ä¸‹è½½Flutter SDK</h1><h2 id="å…ˆå»Flutterçš„å®˜ç½‘å»ä¸‹è½½ä½ å¯¹åº”ç³»ç»Ÿçš„Flutter-SDK"><a href="#å…ˆå»Flutterçš„å®˜ç½‘å»ä¸‹è½½ä½ å¯¹åº”ç³»ç»Ÿçš„Flutter-SDK" class="headerlink" title="å…ˆå»Flutterçš„å®˜ç½‘å»ä¸‹è½½ä½ å¯¹åº”ç³»ç»Ÿçš„Flutter SDK"></a>å…ˆå»Flutterçš„å®˜ç½‘å»ä¸‹è½½ä½ å¯¹åº”ç³»ç»Ÿçš„Flutter SDK</h2><ol><li>æ‰“å¼€å®˜ç½‘ä¸‹è½½é¡µï¼š<a href="https://flutter.dev/docs/development/tools/sdk/releases">Flutter SDK release</a></li><li>é€‰æ‹©ä½ çš„ç³»ç»Ÿå¯¹åº”çš„ç›®å½•ï¼Œç„¶åé»˜è®¤é€‰æ‹©Stable channelä¸‹è½½ã€‚(*Master channelè¿™ä¸ªæ˜¯ç›´æ¥ä»githubè·å–çš„githubä¸Šçš„æœ€æ–°ç‰ˆï¼Œä¹Ÿå°±æ˜¯è¯´Flutterçš„å¼€å‘è€…ä»–å†™äº†ç‚¹ä»€ä¹ˆæ”¹äº†ç‚¹ä»€ä¹ˆéƒ½ä¼šé‡Œé¢åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸Šæ˜¾ç¤ºå‡ºæ¥ï¼Œæ‰€ä»¥è¿™ä¸ªç‰ˆæœ¬æ„å‘³ç€éå¸¸ä¸ç¨³å®šï¼Œå¯èƒ½bugå¾ˆå¤šï¼›Dev channelæ˜¯å¼€å‘ç‰ˆï¼ŒMaster channelç»è¿‡ä¸€å®šæµ‹è¯•ä¹‹åçš„ç‰ˆæœ¬ä¼šå‘å¸ƒåˆ°Dev channelä¸Šï¼Œä½†æ˜¯ä¸æ˜¯å¤§é‡çš„æµ‹è¯•ï¼Œæ‰€ä»¥å¯èƒ½è¿˜æ˜¯ä¸å¤ªç¨³å®šï¼›Beta channelæ˜¯æµ‹è¯•ç‰ˆï¼Œæ¯æœˆå‘å¸ƒä¸€æ¬¡ï¼Œä¼šæŠŠä¸Šä¸ªæœˆæ‰€é‡Šæ”¾çš„æ‰€æœ‰Dev channelä¸­æœ€ç¨³å®šçš„ç‰ˆæœ¬é‡Šæ”¾åˆ°Beta channelä¸Šï¼Œä½†æ˜¯ç›¸å¯¹æ¥è¯´è¿˜æ˜¯æœ‰ç‚¹ä¸ç¨³å®šï¼Œé€‚åˆæƒ³å°é²œçš„å¼€å‘è€…ï¼›State channelæ˜¯æ ‡å‡†ç‰ˆï¼Œå½“Flutterç»´æŠ¤äººå‘˜è®¤ä¸ºæŸä¸ªç‰ˆæœ¬è¶³å¤Ÿç¨³å®šä¹‹åï¼Œå°±ä¼šå‘é€åˆ°è¿™ä¸ªç‰ˆæœ¬ä¸Šå»ï¼Œä¸€èˆ¬å¼€å‘è€…æœ€å¥½è¿˜æ˜¯ä½¿ç”¨è¿™ä¸ªç‰ˆæœ¬)</li></ol><h2 id="è§£å‹å®‰è£…åŒ…åˆ°ä½ æƒ³è¦çš„ç›®å½•"><a href="#è§£å‹å®‰è£…åŒ…åˆ°ä½ æƒ³è¦çš„ç›®å½•" class="headerlink" title="è§£å‹å®‰è£…åŒ…åˆ°ä½ æƒ³è¦çš„ç›®å½•"></a>è§£å‹å®‰è£…åŒ…åˆ°ä½ æƒ³è¦çš„ç›®å½•</h2><p>ä¾‹å¦‚<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// Linux/macOS</span><br><span class="line">cd ~/development</span><br><span class="line">unzip ~/Downloads/flutter_macos_v0.5.1-beta.zip</span><br></pre></td></tr></table></figure></p><h2 id="æ·»åŠ Fluuterè·¯å¾„åˆ°ç¯å¢ƒå˜é‡ä¸­"><a href="#æ·»åŠ Fluuterè·¯å¾„åˆ°ç¯å¢ƒå˜é‡ä¸­" class="headerlink" title="æ·»åŠ Fluuterè·¯å¾„åˆ°ç¯å¢ƒå˜é‡ä¸­"></a>æ·»åŠ Fluuterè·¯å¾„åˆ°ç¯å¢ƒå˜é‡ä¸­</h2><p>å›é¡¾ç¬¬2é¡¹ï¼ŒæŠŠå¦‚ä¸‹å†…å®¹æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­å»<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=/ä½ ä¸Šä¸€æ­¥flutterè§£å‹çš„ç›®å½•/flutter/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure></p><h2 id="è¿è¡ŒFlutter-doctor"><a href="#è¿è¡ŒFlutter-doctor" class="headerlink" title="è¿è¡ŒFlutter doctor"></a>è¿è¡ŒFlutter doctor</h2><p>å¦‚æœæ˜¯macOS/Linuxï¼Œç›´æ¥åœ¨ç»ˆç«¯ä¸­è¾“å…¥<code>flutter doctor</code>å³å¯ã€‚<br>å¦‚æœæ˜¯Windowsï¼Œåˆ™å³é”®å¼€å§‹ï¼Œé€‰æ‹©PowerShellï¼Œç„¶åè¾“å…¥<code>flutter doctor</code>å³å¯ã€‚</p><p>è¿™ä¸ªå‘½ä»¤çš„åŠŸèƒ½æ˜¯æ£€æŸ¥ä½ çš„Flutteræ˜¯å¦æ­£å¸¸å®‰è£…ã€‚</p><p>å¦‚æœæ­£å¸¸å®‰è£…çš„è¯ä¼šå‡ºç°å¦‚ä¸‹ä¿¡æ¯ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Doctor summary (to see all details, run flutter doctor -v):</span><br><span class="line">[âœ“] Flutter (Channel stable, v1.9.1+hotfix.4, on Mac OS X 10.13.6 17G65, locale zh-Hans-CN)</span><br><span class="line"> </span><br><span class="line">[âœ“] Android toolchain - develop <span class="keyword">for</span> Android devices (Android SDK version 29.0.1)</span><br><span class="line">[âœ—] Xcode - develop <span class="keyword">for</span> iOS and macOS</span><br><span class="line">    âœ— Xcode installation is incomplete; a full installation is necessary <span class="keyword">for</span> iOS development.</span><br><span class="line">      Download at: https://developer.apple.com/xcode/download/</span><br><span class="line">      Or install Xcode via the App Store.</span><br><span class="line">      Once installed, run:</span><br><span class="line">        sudo xcode-select --switch /Applications/Xcode.app/Contents/Developer</span><br><span class="line">    âœ— CocoaPods not installed.</span><br><span class="line">        CocoaPods is used to retrieve the iOS and macOS platform side<span class="string">&#x27;s plugin code that responds to</span></span><br><span class="line"><span class="string">        your plugin usage on the Dart side.</span></span><br><span class="line"><span class="string">        Without CocoaPods, plugins will not work on iOS or macOS.</span></span><br><span class="line"><span class="string">        For more info, see https://flutter.dev/platform-plugins</span></span><br><span class="line"><span class="string">      To install:</span></span><br><span class="line"><span class="string">        sudo gem install cocoapods</span></span><br><span class="line"><span class="string">        pod setup</span></span><br><span class="line"><span class="string">[âœ“] Android Studio (version 3.5)</span></span><br><span class="line"><span class="string">[!] IntelliJ IDEA Community Edition (version 2019.2.3)</span></span><br><span class="line"><span class="string">    âœ— Flutter plugin not installed; this adds Flutter specific functionality.</span></span><br><span class="line"><span class="string">    âœ— Dart plugin not installed; this adds Dart specific functionality.</span></span><br><span class="line"><span class="string">[âœ“] VS Code (version 1.38.1)</span></span><br><span class="line"><span class="string">[âœ“] Connected device (1 available)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">! Doctor found issues in 2 categories.</span></span><br></pre></td></tr></table></figure></p><p>æˆ‘çš„ç”µè„‘è¿è¡Œä¹‹åä¼šå‡ºç°ä¸¤ä¸ªé”™è¯¯ï¼Œå› ä¸ºFlutter doctorä¼šè‡ªåŠ¨æ£€æŸ¥ç”µè„‘ä¸­æ‰€æœ‰èƒ½è¿è¡ŒFlutterçš„ç¼–è¾‘å™¨æˆ–è€…IDEï¼Œç„¶ååˆ¤æ–­ä»–ä»¬é…æ²¡é…ç½®Flutterã€‚æˆ‘çš„ç”µè„‘æ˜¯å› ä¸ºæ²¡æœ‰å®‰è£…Xcodeä»¥åŠæˆ‘æ²¡æœ‰åœ¨IDEAä¸­é…ç½®Flutterï¼Œæ‰€ä»¥æˆ‘è¿™ä¸¤é¡¹å‡ºé”™ã€‚</p><p>å…¶å®ä½ åªè¦ä¿è¯é™¤äº†IDEä¹‹å¤–çš„é¡¹ç›®éƒ½æ˜¯æ­£å¸¸çš„å°±è¡Œäº†ï¼Œå¦‚æœæœ‰é”™çš„è¯ç›´æ¥æŠŠæŠ¥é”™ä¿¡æ¯æ”¾åˆ°ç™¾åº¦é‡Œé¢è¿›è¡Œæœç´¢å°±å¯ä»¥äº†ã€‚è‡³äºIDEé¡¹ç›®ï¼Œå¦‚æœä½ æ˜¯iOSå¼€å‘è€…ï¼Œåˆ™ä¿è¯Xcodeæˆ–è€…æ˜¯AppCodeå•¥çš„å‰é¢æ˜¯âœ”ï¸å°±è¡Œäº†çš„ï¼Œè‡³äºä½ ç”µè„‘ä¸Šçš„å…¶å®ƒä¾‹å¦‚IDEAæˆ–è€…vscodeå•¥çš„å¯ä»¥ä¸ç”¨ç®¡ï¼›å¦‚æœä½ æ˜¯Androidå¼€å‘è€…ï¼Œåˆ™ä¿è¯ä½ å¸¸ç”¨çš„IDEå¦‚Android Studioå‰é¢æ˜¯âœ”ï¸å°±è¡Œäº†çš„ï¼Œè‡³äºä½ ç”µè„‘ä¸Šçš„å…¶å®ƒä¾‹å¦‚IDEAæˆ–è€…vscodeå•¥çš„å¯ä»¥ä¸ç”¨ç®¡ã€‚</p><p>æ€»è€Œè¨€ä¹‹ï¼Œç¡®ä¿é™¤äº†IDEä¹‹å¤–çš„å…¶å®ƒé¡¹å‰é¢æ˜¯å¯¹å‹¾ï¼Œç„¶åç¡®å®šä¸€ä¸ªä½ å¸¸ç”¨çš„å†™ä»£ç çš„å·¥å…·å‰é¢æœ‰å¯¹å‹¾å°±è¡Œäº†ï¼Œå¦‚æœä½ é™¤äº†IDEä¹‹å¤–çš„å…¶å®ƒé¡¹æœ‰é—®é¢˜ï¼Œå°±æŠŠé”™è¯¯ä¿¡æ¯ç›´æ¥ç™¾åº¦ï¼›å¦‚æœæ˜¯ä½ å¸¸ç”¨çš„IDEå‰é¢æ²¡å¯¹å‹¾ï¼Œé‚£å°±ç™¾åº¦ä½ å¸¸ç”¨çš„IDE+Flutteræ¥å‚è€ƒåˆ«äººçš„é…ç½®æ•™ç¨‹ã€‚</p><hr><p><em>ç”±äºæˆ‘æ²¡æœ‰ç”¨è¿‡xcodeæ‰€ä»¥å°±ä¸è®²xcodeå¦‚ä½•é…ç½®Flutteräº†ï¼Œå°±åˆ†åˆ«è®²å¦‚ä½•åœ¨AndroidStudioå’Œvscodeé…ç½®Flutterã€‚</em></p><hr><h1 id="Android-Studioé…ç½®Flutter"><a href="#Android-Studioé…ç½®Flutter" class="headerlink" title="Android Studioé…ç½®Flutter"></a>Android Studioé…ç½®Flutter</h1><ol><li><p>æ‰“å¼€ä½ Android Studioçš„<code>è®¾ç½®/é¦–é€‰é¡¹/Preferences</code>ï¼Œç„¶åé€‰æ‹©<code>Plugins</code>ï¼Œåœ¨<code>Marketplace</code>é‡Œé¢æœç´¢<code>Flutter</code>ï¼š    <img src="https://cdn.littlecorgi.top/mweb/2019-10-08/Androidstudio%20Flutter.png" alt="Androidstudio Flutte"></p></li><li><p>æ¥ç€ç‚¹å‡»<code>INSTALL</code>å®‰è£…å°±è¡Œäº†ï¼Œå¹¶ä¸”å®‰è£…Flutteræ’ä»¶ä¼šè‡ªåŠ¨é¡ºå¸¦å®‰è£…Dartæ’ä»¶ï¼Œå¦‚æœæ²¡æœ‰å®‰è£…Dartæ’ä»¶ï¼Œä½ å°±ä¸€æ ·çš„æœç´¢<code>Dart</code>ç„¶åå®‰è£…å³å¯ï¼›</p></li><li>å®‰è£…å®Œæˆå¹¶é‡å¯Android Studioä¹‹åï¼Œä»ç„¶æ‰“å¼€<code>è®¾ç½®/é¦–é€‰é¡¹/Preferences</code>ï¼Œé€‰æ‹©<code>Languages &amp; Frameworks</code>-&gt;<code>Flutter</code>ï¼Œåœ¨æœ€ä¸Šé¢çš„SDKä¸­çš„<code>Flutter SDK path</code>é€‰æ‹©ä½ ç¬¬ä¸‰æ­¥Flutter SDKè§£å‹ç¼©çš„è·¯å¾„ï¼Œä¸å‡ºæ„å¤–çš„è¯ä¸‹é¢<code>Version</code>ä¼šè‡ªåŠ¨æ˜¾ç¤ºä½ Flutter SDKçš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”<code>Languages &amp; Frameworks</code>-&gt;<code>Dart</code>é‡Œé¢çš„<code>Dart SDK path</code>ä¹Ÿä¼šè‡ªåŠ¨å‡ºç°ã€‚<br> <img src="https://cdn.littlecorgi.top/mweb/2019-10-08/Android%20Studio%20Flutter%20Setting.png" alt="Android Studio Flutter Setting"></li><li>æ¥ç€å’Œä¹‹å‰ä¸€æ ·è¿è¡Œ<code>flutter doctor</code>,çœ‹çœ‹Android Studioå‰é¢æœ‰æ²¡æœ‰âœ”ï¸ï¼Œæ­£å¸¸æƒ…å†µä¸‹æ˜¯ä¼šæœ‰çš„ã€‚</li></ol><h1 id="vscode-é…ç½®Flutter"><a href="#vscode-é…ç½®Flutter" class="headerlink" title="vscode é…ç½®Flutter"></a>vscode é…ç½®Flutter</h1><ol><li><p>åœ¨vscodeæ‹“å±•é‡Œé¢æœç´¢Flutterå’ŒDartï¼Œå®‰è£…ï¼›<img src="https://cdn.littlecorgi.top/mweb/2019-10-08/vscode%20Flutter.png" alt="vscode Flutte"></p></li><li><p>æ¥ç€å’Œä¹‹å‰ä¸€æ ·è¿è¡Œ<code>flutter doctor</code>,çœ‹çœ‹vscodeå‰é¢æœ‰æ²¡æœ‰âœ”ï¸ï¼Œæ­£å¸¸æƒ…å†µä¸‹æ˜¯ä¼šæœ‰çš„ã€‚</p></li></ol>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Flutter/">Flutter</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Flutter/">Flutter</category>
      
      
      <comments>https://www.littlecorgi.top/posts/4bf666bf.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>æ“ä½œç³»ç»Ÿ6--æ­»é”</title>
      <link>https://www.littlecorgi.top/posts/68dc89d4.html</link>
      <guid>https://www.littlecorgi.top/posts/68dc89d4.html</guid>
      <pubDate>Thu, 19 Sep 2019 14:45:49 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;6-1-æ­»é”çš„å¼•å…¥&quot;&gt;&lt;a href=&quot;#6-1-æ­»é”çš„å¼•å…¥&quot; class=&quot;headerlink&quot; title=&quot;6.1 æ­»é”çš„å¼•å…¥&quot;&gt;&lt;/a&gt;6.1 æ­»é”çš„å¼•å…¥&lt;/h1&gt;&lt;p&gt;åœ¨ä¹‹å‰æˆ‘ä»¬æˆ–å¤šæˆ–å°‘éƒ½æ¶‰åŠåˆ°äº†æ­»é”ï¼Œæœ€ç›´æ¥çš„ä¾‹å­å°±æ˜¯å“²å­¦å®¶å°±é¤ç­·å­ï¼Œå¦‚æœæ¯ä¸€ä¸ªå“²å­¦å®¶éƒ½æ‹¿èµ·äº†ä»–çš„å³æ‰‹çš„ç­·å­ï¼Œç°åœ¨éƒ½åœ¨ç­‰å·¦è¾¹çš„ç­·å­ã€‚è¿™æ ·ä¸€ç›´ç»•ä¸‹å»ï¼Œä»è€Œäº§ç”Ÿäº†æ­»é”ã€‚&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="6-1-æ­»é”çš„å¼•å…¥"><a href="#6-1-æ­»é”çš„å¼•å…¥" class="headerlink" title="6.1 æ­»é”çš„å¼•å…¥"></a>6.1 æ­»é”çš„å¼•å…¥</h1><p>åœ¨ä¹‹å‰æˆ‘ä»¬æˆ–å¤šæˆ–å°‘éƒ½æ¶‰åŠåˆ°äº†æ­»é”ï¼Œæœ€ç›´æ¥çš„ä¾‹å­å°±æ˜¯å“²å­¦å®¶å°±é¤ç­·å­ï¼Œå¦‚æœæ¯ä¸€ä¸ªå“²å­¦å®¶éƒ½æ‹¿èµ·äº†ä»–çš„å³æ‰‹çš„ç­·å­ï¼Œç°åœ¨éƒ½åœ¨ç­‰å·¦è¾¹çš„ç­·å­ã€‚è¿™æ ·ä¸€ç›´ç»•ä¸‹å»ï¼Œä»è€Œäº§ç”Ÿäº†æ­»é”ã€‚</p><span id="more"></span><h2 id="6-1-1-èµ„æºé—®é¢˜"><a href="#6-1-1-èµ„æºé—®é¢˜" class="headerlink" title="6.1.1 èµ„æºé—®é¢˜"></a>6.1.1 èµ„æºé—®é¢˜</h2><p>åœ¨ç³»ç»Ÿä¸­å­˜åœ¨ç€å¾ˆå¤šä¸åŒç±»å‹çš„èµ„æºï¼Œå…¶ä¸­å¯ä»¥å¼•èµ·çš„æ­»é”çš„ä¸»è¦æ˜¯éœ€è¦é‡‡ç”¨äº’æ–¥è®¿é—®æ–¹æ³•çš„ã€ä¸å¯ä»¥è¢«æŠ¢å çš„èµ„æºã€</p><h3 id="6-1-1-1-å¯é‡ç”¨æ€§èµ„æºå’Œæ¶ˆè€—æ€§èµ„æº"><a href="#6-1-1-1-å¯é‡ç”¨æ€§èµ„æºå’Œæ¶ˆè€—æ€§èµ„æº" class="headerlink" title="6.1.1.1 å¯é‡ç”¨æ€§èµ„æºå’Œæ¶ˆè€—æ€§èµ„æº"></a>6.1.1.1 å¯é‡ç”¨æ€§èµ„æºå’Œæ¶ˆè€—æ€§èµ„æº</h3><h4 id="å¯é‡ç”¨æ€§èµ„æº"><a href="#å¯é‡ç”¨æ€§èµ„æº" class="headerlink" title="å¯é‡ç”¨æ€§èµ„æº"></a>å¯é‡ç”¨æ€§èµ„æº</h4><p>å¯é‡ç”¨æ€§èµ„æºæ˜¯ä¸€ç§å¯ä¾›ç”¨æˆ·é‡å¤ä½¿ç”¨å¤šæ¬¡çš„èµ„æºï¼Œå®ƒå…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼š</p><ol><li>æ¯ä¸€ä¸ªå¯é‡ç”¨æ€§èµ„æºä¸­çš„å•ä½åªèƒ½åˆ†é…ç»™ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ï¼Œä¸å…è®¸å¤šä¸ªè¿›ç¨‹å…±äº«</li><li>è¿›ç¨‹åœ¨ä½¿ç”¨å¯é‡ç”¨æ€§èµ„æºæ—¶ï¼Œé¡»æŒ‰ç…§è¿™æ ·çš„é¡ºåºï¼šè¯·æ±‚èµ„æº -&gt; ä½¿ç”¨èµ„æº -&gt; é‡Šæ”¾èµ„æº</li><li>ç³»ç»Ÿä¸­æ¯ä¸€ç±»å¯é‡ç”¨æ€§èµ„æºä¸­çš„å•å…ƒæ•°ç›®æ˜¯ç›¸å¯¹å›ºå®šçš„ï¼Œè¿›ç¨‹åœ¨è¿è¡ŒæœŸé—´æ—¢ä¸èƒ½åˆ›å»ºä¹Ÿä¸èƒ½åˆ é™¤å®ƒ</li></ol><h4 id="å¯æ¶ˆè€—æ€§èµ„æº"><a href="#å¯æ¶ˆè€—æ€§èµ„æº" class="headerlink" title="å¯æ¶ˆè€—æ€§èµ„æº"></a>å¯æ¶ˆè€—æ€§èµ„æº</h4><p>å¯æ¶ˆè€—æ€§èµ„æºåˆç§°ä¸ºä¸´æ—¶æ€§èµ„æºï¼Œå®ƒæ˜¯åœ¨è¿›ç¨‹è¿è¡ŒæœŸé—´ï¼Œç”±è¿›ç¨‹åŠ¨æ€çš„åˆ›å»ºå’Œæ¶ˆè€—çš„ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼š</p><ol><li>æ¯ä¸€ç±»å¯æ¶ˆè€—æ€§èµ„æºçš„å•å…ƒæ•°ç›®åœ¨è¿›ç¨‹è¿è¡ŒæœŸé—´æ˜¯å¯ä»¥ä¸æ–­å˜åŒ–çš„ï¼Œæœ‰æ—¶å®ƒå¯ä»¥æœ‰å¾ˆå¤šï¼Œæœ‰æ—¶å¯èƒ½ä¸º0</li><li>è¿›ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä¸æ–­åœ°åˆ›é€ å¯æ¶ˆè€—æ€§èµ„æºçš„å•å…ƒï¼Œå°†å®ƒä»¬æ”¾å…¥è¯¥èµ„æºç±»çš„ç¼“å†²åŒºä¸­ï¼Œä»¥å¢åŠ è¯¥èµ„æºç±»çš„å•å…ƒæ•°ç›®</li><li>è¿›ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥è¯·æ±‚è‹¥å¹²ä¸ªå¯æ¶ˆè€—æ€§èµ„æºå•å…ƒï¼Œç”¨äºè¿›ç¨‹è‡ªå·±çš„æ¶ˆè€—ï¼Œä¸å†å°†å®ƒä»¬è¿”å›ç»™è¯¥èµ„æºç±»ä¸­</li></ol><h3 id="6-1-1-2-å¯æŠ¢å æ€§èµ„æºå’Œä¸å¯æŠ¢å æ€§èµ„æº"><a href="#6-1-1-2-å¯æŠ¢å æ€§èµ„æºå’Œä¸å¯æŠ¢å æ€§èµ„æº" class="headerlink" title="6.1.1.2 å¯æŠ¢å æ€§èµ„æºå’Œä¸å¯æŠ¢å æ€§èµ„æº"></a>6.1.1.2 å¯æŠ¢å æ€§èµ„æºå’Œä¸å¯æŠ¢å æ€§èµ„æº</h3><h4 id="å¯æŠ¢å æ€§èµ„æº"><a href="#å¯æŠ¢å æ€§èµ„æº" class="headerlink" title="å¯æŠ¢å æ€§èµ„æº"></a>å¯æŠ¢å æ€§èµ„æº</h4><p>å¯æŠŠç³»ç»Ÿä¸­çš„èµ„æºåˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯å¯æŠ¢å æ€§èµ„æºï¼Œæ˜¯æŒ‡æŸè¿›ç¨‹åœ¨è·å¾—è¿™ç±»èµ„æºåï¼Œè¯¥èµ„æºå¯ä»¥å†è¢«å…¶å®ƒè¿›ç¨‹æˆ–ç³»ç»ŸæŠ¢å </p><h4 id="ä¸å¯æŠ¢å æ€§èµ„æº"><a href="#ä¸å¯æŠ¢å æ€§èµ„æº" class="headerlink" title="ä¸å¯æŠ¢å æ€§èµ„æº"></a>ä¸å¯æŠ¢å æ€§èµ„æº</h4><p>å¦ä¸€ç±»èµ„æºæ˜¯ä¸å¯æŠ¢å èµ„æºï¼Œä¸€æ—¦ç³»ç»ŸæŠŠæŸèµ„æºåˆ†é…ç»™è¯¥è¿›ç¨‹ä¹‹åï¼Œå°±ä¸èƒ½å°†å®ƒå¼ºè¡Œå›æ”¶ï¼Œåªèƒ½åœ¨è¿›ç¨‹ç”¨å®Œåè‡ªè¡Œé‡Šæ”¾</p><h2 id="6-1-2-æ­»é”çš„èµ·å› "><a href="#6-1-2-æ­»é”çš„èµ·å› " class="headerlink" title="6.1.2 æ­»é”çš„èµ·å› "></a>6.1.2 æ­»é”çš„èµ·å› </h2><h3 id="6-1-2-1-ç«äº‰ä¸å¯æŠ¢å æ€§èµ„æºå¼•èµ·çš„æ­»é”"><a href="#6-1-2-1-ç«äº‰ä¸å¯æŠ¢å æ€§èµ„æºå¼•èµ·çš„æ­»é”" class="headerlink" title="6.1.2.1 ç«äº‰ä¸å¯æŠ¢å æ€§èµ„æºå¼•èµ·çš„æ­»é”"></a>6.1.2.1 ç«äº‰ä¸å¯æŠ¢å æ€§èµ„æºå¼•èµ·çš„æ­»é”</h3><p>é€šå¸¸ç³»ç»Ÿä¸­æ‰€æ‹¥æœ‰çš„ä¸å¯æŠ¢å æ€§èµ„æºå…¶æ•°é‡ä¸è¶³ä»¥æ»¡è¶³å¤šä¸ªè¿›ç¨‹è¿è¡Œçš„éœ€è¦ï¼Œä½¿å¾—è¿›ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šå› äº‰å¤ºèµ„æºè€Œé™·å…¥åƒµå±€ã€‚</p><p>ä¸€ä¸ªå¾ˆç®€å•çš„ä¾‹å­ï¼Œè¿›ç¨‹$P_1$å’Œ$P_2$åœ¨å¹¶å‘æ‰§è¡Œï¼Œä»–ä»¬éƒ½è¦å†™ä¸¤ä¸ªæ–‡ä»¶$F_1$å’Œ$F_2$ã€‚å…¶ä¸­$P_1$å’Œ$P_2$çš„ä»£ç åˆ†åˆ«ä¸ºï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">   P1</span><br><span class="line">  ....</span><br><span class="line">Open(f1, w);</span><br><span class="line">Open(f2, w);</span><br><span class="line"></span><br><span class="line">   P2</span><br><span class="line">  ....</span><br><span class="line">Open(f2, w);</span><br><span class="line">Open(f1, w);</span><br></pre></td></tr></table></figure></p><p>å¦‚æœè¿™ä¸¤ä¸ªè¿›ç¨‹åœ¨å¹¶å‘æ‰§è¡Œçš„æ—¶å€™ï¼Œå¦‚æœ$P_1$å…ˆæ‰“å¼€$F_1$å’Œ$F_2$ï¼Œç„¶å$P_2$æ‰å»æ‰“å¼€$F_1$(æˆ–$F_2$)ï¼Œç”±äºæ–‡ä»¶$F_1$(æˆ–$F_2$)å·²ç»è¢«æ‰“å¼€ï¼Œå› æ­¤$P_2$ä¼šè¢«é˜»å¡ã€‚å½“$P_1$ä½¿ç”¨å®Œ$F_1$(æˆ–$F_2$)ï¼Œè¿™æ—¶$P_2$æ‰å¯ä»¥å»æ‰“å¼€$F_1$(æˆ–$F_2$)ï¼Œè¿™æ ·ç¨‹åºç»§ç»­è¿è¡Œä¸‹å»ã€‚</p><p>ä½†æ˜¯å¦‚æœåœ¨$P_1$æ‰“å¼€$F_1$çš„åŒæ—¶ï¼Œ$P_2$å»æ‰“å¼€$F_2$ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½å æœ‰ä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶ï¼Œæ­¤æ—¶å°±å¯èƒ½å‡ºç°é—®é¢˜ã€‚å› ä¸ºå½“$P_1$è¯•å›¾å»æ‰“å¼€$F_2$,è€Œ$F_2$è¯•å›¾å»æ‰“å¼€$F_1$æ—¶ï¼Œè¿™ä¸¤ä¸ªè¿›ç¨‹éƒ½ä¼šå› æ–‡ä»¶å·²è¢«æ‰“å¼€è€Œé˜»å¡ï¼Œå› æ­¤è¿™ä¸¤ä¸ªè¿›ç¨‹å°†ä¼šæ— é™æœŸåœ°ç­‰å¾…ä¸‹å»ï¼Œä»è€Œå½¢æˆæ­»é”ã€‚<br><img src="https://cdn.littlecorgi.top/mweb/2019-09-19/%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E6%97%B6%E7%9A%84%E6%AD%BB%E9%94%81%E6%83%85%E5%86%B5.png" alt="å…±äº«æ–‡ä»¶æ—¶çš„æ­»é”æƒ…å†µ"></p><h3 id="6-1-2-2-ç«äº‰å¯æ¶ˆè€—èµ„æºå¼•èµ·çš„æ­»é”"><a href="#6-1-2-2-ç«äº‰å¯æ¶ˆè€—èµ„æºå¼•èµ·çš„æ­»é”" class="headerlink" title="6.1.2.2 ç«äº‰å¯æ¶ˆè€—èµ„æºå¼•èµ·çš„æ­»é”"></a>6.1.2.2 ç«äº‰å¯æ¶ˆè€—èµ„æºå¼•èµ·çš„æ­»é”</h3><p><img src="https://cdn.littlecorgi.top/mweb/2019-09-19/%E8%BF%9B%E7%A8%8B%E4%B9%8B%E9%97%B4%E9%80%9A%E4%BF%A1%E6%97%B6%E7%9A%84%E6%AD%BB%E9%94%81.png" alt="è¿›ç¨‹ä¹‹é—´é€šä¿¡æ—¶çš„æ­»é”"><br>å¦‚å›¾æ‰€ç¤ºï¼Œ$m_1$ã€$m_3$ã€$m_3$æ˜¯å¯æ¶ˆè€—èµ„æºã€‚è¿›ç¨‹$P_1$ä¸€æ–¹é¢äº§ç”Ÿæ¶ˆæ¯$m_1$ï¼Œåˆ©ç”¨<code>send(p2,m1)</code>å°†å®ƒå‘é€ç»™$P_2$ï¼Œå¦ä¸€æ–¹é¢ï¼Œæœ‰è¦æ±‚ä»$P_3$æ¥å—æ¶ˆæ¯$m_2$ï¼›è€Œ$P_2$ã€$P_3$ä¾æ¬¡ç±»æ¨ã€‚</p><p>å¦‚æœä¸‰ä¸ªè¿›ç¨‹æŒ‰ä»¥ä¸‹é¡ºåºè¿›è¡Œï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">P1:   ...send(p2, m1);    receive(p3, m3);...</span><br><span class="line">P2:   ...send(p3, m2);    receive(p1, m1);...</span><br><span class="line">P3:   ...send(p1, m3);    receive(p2, m2);...</span><br></pre></td></tr></table></figure><br>è¿™ä¸‰ä¸ªè¿›ç¨‹éƒ½å¯ä»¥å…ˆå°†æ¶ˆæ¯å‘é€ç»™ä¸‹ä¸€ä¸ªè¿›ç¨‹ï¼Œç›¸åº”åœ°ä»–ä»¬ä¹Ÿéƒ½èƒ½éƒ½æ¥æ”¶åˆ°ä»ä¸Šä¸€ä¸ªè¿›ç¨‹å‘æ¥çš„æ¶ˆæ¯ï¼Œå› æ­¤ä¸‰ä¸ªè¿›ç¨‹éƒ½å¯ä»¥é¡ºåˆ©çš„è¿›è¡Œä¸‹å»ï¼Œä¸ä¼šå‘ç”Ÿæ­»é”ã€‚</p><p>ä½†æ˜¯å¦‚æœä¸‰ä¸ªè¿›ç¨‹éƒ½å…ˆæ‰§è¡Œreceiveï¼Œåœ¨æ‰§è¡Œsendï¼ŒæŒ‰ä¸‹é¢çš„é¡ºåºè¿è¡Œï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">P1:   ...receive(p3, m3);    send(p2, m1);...</span><br><span class="line">P2:   ...receive(p1, m1);    send(p3, m2);...</span><br><span class="line">P3:   ...receive(p2, m2);    send(p1, m3);...</span><br></pre></td></tr></table></figure><br>é‚£ä¹ˆè¿™ä¸‰ä¸ªè¿›ç¨‹å°±ä¼šæ°¸è¿œé˜»å¡åœ¨å®ƒä»¬çš„receiveæ“ä½œä¸Šï¼Œå°±ä¼šäº§ç”Ÿæ­»é”ã€‚</p><h1 id="6-2-æ­»é”çš„å®šä¹‰ã€å¿…è¦æ¡ä»¶å’Œå¤„ç†æ–¹æ³•"><a href="#6-2-æ­»é”çš„å®šä¹‰ã€å¿…è¦æ¡ä»¶å’Œå¤„ç†æ–¹æ³•" class="headerlink" title="6.2 æ­»é”çš„å®šä¹‰ã€å¿…è¦æ¡ä»¶å’Œå¤„ç†æ–¹æ³•"></a>6.2 æ­»é”çš„å®šä¹‰ã€å¿…è¦æ¡ä»¶å’Œå¤„ç†æ–¹æ³•</h1><h2 id="6-2-1-æ­»é”çš„å®šä¹‰"><a href="#6-2-1-æ­»é”çš„å®šä¹‰" class="headerlink" title="6.2.1 æ­»é”çš„å®šä¹‰"></a>6.2.1 æ­»é”çš„å®šä¹‰</h2><p>å¦‚æœä¸€ç»„è¿›ç¨‹ä¸­çš„æ¯ä¸€ä¸ªè¿›ç¨‹éƒ½åœ¨ç­‰å¾…ä»…ç”±è¯¥ç»„è¿›ç¨‹ä¸­çš„å…¶å®ƒè¿›ç¨‹æ‰èƒ½å¼•å‘çš„äº‹ä»¶ï¼Œé‚£ä¹ˆè¯¥ç»„è¿›ç¨‹æ˜¯æ­»é”çš„ã€‚</p><h2 id="6-2-2-äº§ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶"><a href="#6-2-2-äº§ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶" class="headerlink" title="6.2.2 äº§ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶"></a>6.2.2 äº§ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶</h2><p>äº§ç”Ÿæ­»é”å¿…é¡»åŒæ—¶å…·å¤‡ä¸‹é¢å››ä¸ªå¿…è¦æ¡ä»¶ï¼Œåªè¦å…¶ä¸­ä»»ä¸€ä¸ªæ¡ä»¶ä¸æˆç«‹ï¼Œæ­»é”å°±ä¸ä¼šå‘ç”Ÿï¼š</p><ol><li>äº’æ–¥æ¡ä»¶ã€‚è¿›ç¨‹å¯¹æ‰€åˆ†é…çš„èµ„æºè¿›è¡Œæ’ä»–æ€§ä½¿ç”¨ã€‚å³è¯¥èµ„æºåªå…è®¸ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ï¼Œå…¶ä»–è¿›ç¨‹å¦‚æœè¯·æ±‚è¯¥èµ„æºåªèƒ½ç­‰å¾…ã€‚</li><li>è¯·æ±‚å’Œä¿æŒæ¡ä»¶ã€‚è¿›ç¨‹å·²ç»ä¿æŒä¸€è‡³å°‘ä¸€ä¸ªèµ„æºï¼Œä½†åˆæå‡ºäº†æ–°çš„èµ„æºè¯·æ±‚ï¼Œè€Œæ–°èµ„æºå·²è¢«å…¶ä»–è¿›ç¨‹å æœ‰ï¼Œå¯¼è‡´è¿›ç¨‹è¢«é˜»å¡ã€‚</li><li>ä¸å¯æŠ¢å æ¡ä»¶ã€‚ è¿›ç¨‹å·²è·å¾—çš„èµ„æºåœ¨ä¸ºä½¿ç”¨å®Œä¹‹å‰ä¸èƒ½è¢«æŠ¢å ï¼Œåªæœ‰è¿›ç¨‹åœ¨ä½¿ç”¨å®Œä¹‹åæ‰èƒ½é‡Šæ”¾ã€‚</li><li>å¾ªç¯ç­‰å¾…æ¡ä»¶ã€‚å‘ç”Ÿæ­»é”æ—¶ï¼Œå¿…ç„¶å­˜åœ¨ä¸€ä¸ªè¿›ç¨‹èµ„æºå¾ªç¯é“¾ï¼Œå³è¿›ç¨‹é›†åˆ$[P_0, P_1, P_2, Â·Â·Â·, P_n]$ä¸­$P_0$æ­£åœ¨ç­‰å¾…ä¸€ä¸ª$P_1$å ç”¨çš„èµ„æºï¼Œ$P_1$æ­£åœ¨ç­‰å¾…ä¸€ä¸ª$P_2$å ç”¨çš„èµ„æºï¼Œâ€¦â€¦ï¼Œ$P_n$æ­£åœ¨ç­‰å¾…ä¸€ä¸ª$P_0$å ç”¨çš„èµ„æº</li></ol><h2 id="6-2-3-å¤„ç†æ­»é”çš„åŠæ³•"><a href="#6-2-3-å¤„ç†æ­»é”çš„åŠæ³•" class="headerlink" title="6.2.3 å¤„ç†æ­»é”çš„åŠæ³•"></a>6.2.3 å¤„ç†æ­»é”çš„åŠæ³•</h2><p>ç›®å‰å¤„ç†æ­»é”çš„æ–¹æ³•å¯å½’ç»“ä¸ºå››ç§ï¼š</p><ol><li>é¢„é˜²æ­»é”ã€‚é€šè¿‡è®¾ç½®æŸäº›é™åˆ¶ï¼Œå»ç ´åäº§ç”Ÿæ­»é”å››ä¸ªå¿…è¦æ¡ä»¶ä¸­çš„ä¸€ä¸ªæˆ–å‡ ä¸ªæ¥é¢„é˜²æ­»é”ã€‚</li><li>é¿å…æ­»é”ã€‚åœ¨èµ„æºçš„åŠ¨æ€åˆ†é…è¿‡ç¨‹ä¸­ï¼Œç”¨æŸç§æ–¹æ³•é˜»æ­¢ç³»ç»Ÿè¿›å…¥ä¸å®‰å…¨çŠ¶æ€ï¼Œä»è€Œé¿å…å‘ç”Ÿæ­»é”ã€‚</li><li>æ£€æµ‹æ­»é”ã€‚è¯¥æ–¹æ³•å…è®¸è¿›ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿæ­»é”ï¼Œä½†å¯é€šè¿‡æ£€æµ‹æœºæ„åŠæ—¶åœ°æ£€æµ‹å‡ºæ­»é”çš„å‘ç”Ÿï¼Œç„¶åé‡‡å–é€‚å½“æªæ–½ï¼ŒæŠŠè¿›åŸä»æ­»é”ä¸­è§£è„±å‡ºæ¥ã€‚</li><li>è§£é™¤æ­»é”ã€‚å½“æ£€æµ‹åˆ°ç³»ç»Ÿä¸­å·²å‘ç”Ÿæ­»é”æ—¶ï¼Œå°±é‡‡å–ç›¸åº”æªæ–½ï¼Œå°†è¿›ç¨‹ä»æ­»é”çŠ¶æ€ä¸­è§£è„±å‡ºæ¥ã€‚</li></ol><h1 id="6-3-é¢„é˜²æ­»é”"><a href="#6-3-é¢„é˜²æ­»é”" class="headerlink" title="6.3 é¢„é˜²æ­»é”"></a>6.3 é¢„é˜²æ­»é”</h1><p>é¢„é˜²æ­»é”æ—¶é€šè¿‡ç ´åäº§ç”Ÿæ­»é”å››ä¸ªå¿…è¦æ¡ä»¶ä¸­çš„ä¸€ä¸ªæˆ–å‡ ä¸ªï¼Œä»¥é¿å…å‘ç”Ÿæ­»é”ã€‚</p><h2 id="6-3-1-ç ´åâ€œè¯·æ±‚å’Œä¿æŒâ€æ¡ä»¶"><a href="#6-3-1-ç ´åâ€œè¯·æ±‚å’Œä¿æŒâ€æ¡ä»¶" class="headerlink" title="6.3.1 ç ´åâ€œè¯·æ±‚å’Œä¿æŒâ€æ¡ä»¶"></a>6.3.1 ç ´åâ€œè¯·æ±‚å’Œä¿æŒâ€æ¡ä»¶</h2><p>å½“ä¸€ä¸ªè¿›ç¨‹åœ¨è¯·æ±‚èµ„æºæ—¶ï¼Œä»–ä¸èƒ½æŒæœ‰ä¸å¯æŠ¢å èµ„æºã€‚å¯é€šè¿‡ä¸€ä¸‹ä¸¤ç§ä¸åŒçš„åè®®å®ç°ï¼š</p><h3 id="6-3-1-1-ç¬¬ä¸€ç§åè®®"><a href="#6-3-1-1-ç¬¬ä¸€ç§åè®®" class="headerlink" title="6.3.1.1 ç¬¬ä¸€ç§åè®®"></a>6.3.1.1 ç¬¬ä¸€ç§åè®®</h3><p>æ‰€æœ‰è¿›ç¨‹åœ¨å¼€å§‹è¿è¡Œä¹‹å‰ï¼Œå¿…é¡»ä¸€æ¬¡æ€§åœ°ç”³è¯·å…¶åœ¨æ•´ä¸ªè¿è¡Œè¿‡ç¨‹ä¸­æ‰€éœ€çš„å…¨éƒ¨èµ„æºã€‚æ­¤æ—¶è‹¥ç³»ç»Ÿä¸­æœ‰è¶³å¤Ÿçš„èµ„æºåˆ†é…ç»™æŸè¿›ç¨‹ï¼Œä¾¿å¯æŠŠå…¶éœ€è¦çš„æ‰€æœ‰èµ„æºåˆ†é…ç»™å®ƒã€‚è¿™æ ·ï¼Œè¯¥è¿›ç¨‹åœ¨æ•´ä¸ªè¿è¡ŒæœŸé—´ï¼Œä¾¿ä¸ä¼šå†æå‡ºèµ„æºè¦æ±‚ï¼Œä»è€Œç ´åäº†â€œè¯·æ±‚â€æ¡ä»¶ã€‚ç³»ç»Ÿåœ¨åˆ†é…èµ„æºæ—¶ï¼Œåªè¦æœ‰ä¸€ç§èµ„æºä¸èƒ½æ»¡è¶³è¿›ç¨‹çš„è¦æ±‚ï¼Œå³ä½¿å…¶æ‰€éœ€çš„å…¶ä»–èµ„æºéƒ½ç©ºé—²ä¹Ÿä¸åˆ†é…ç»™å®ƒï¼Œè€Œè®©è¯¥è¿›ç¨‹ç­‰å¾…ã€‚ç”±äºè¯¥è¿›ç¨‹åœ¨ç­‰å¾…æœŸé—´æœªå æœ‰ä»»ä½•èµ„æºï¼Œäºæ˜¯ç ´åäº†â€œä¿æŒâ€æ¡ä»¶ï¼Œä»è€Œå¯ä»¥é¢„é˜²æ­»é”çš„å‘ç”Ÿã€‚</p><p>è¿™ç§åè®®çš„ä¼˜ç‚¹æ˜¯ç®€å•ã€æ˜“è¡Œä¸”å®‰å…¨ã€‚ä½†æ˜¯ç¼ºç‚¹ä¹Ÿæå…¶æ˜æ˜¾ï¼š</p><ol><li>èµ„æºè¢«ä¸¥é‡æµªè´¹ï¼Œä¸¥é‡çš„æ¶åŒ–äº†èµ„æºçš„åˆ©ç”¨ç‡ã€‚</li><li>ä½¿è¿›ç¨‹ç»å¸¸çš„å‘ç”Ÿé¥¥é¥¿ç°è±¡ã€‚</li></ol><h3 id="6-3-1-2-ç¬¬äºŒç§åè®®"><a href="#6-3-1-2-ç¬¬äºŒç§åè®®" class="headerlink" title="6.3.1.2 ç¬¬äºŒç§åè®®"></a>6.3.1.2 ç¬¬äºŒç§åè®®</h3><p>è¯¥åè®®æ˜¯å¯¹ç¬¬ä¸€ç§åè®®çš„æ”¹è¿›ï¼Œå®ƒå…è®¸ä¸€ä¸ªè¿›ç¨‹åªè·å¾—è¿è¡ŒåˆæœŸæ‰€éœ€çš„èµ„æºåï¼Œä¾¿å¼€å§‹è¿è¡Œã€‚è¿›ç¨‹è¿è¡Œçš„è¿‡ç¨‹ä¸­å†é€æ­¥é‡Šæ”¾å·²åˆ†é…ç»™è‡ªå·±çš„ã€ä¸”å·²ç”¨æ¯•çš„å…¨éƒ¨èµ„æºï¼Œç„¶åå†è¯·æ±‚æ–°çš„æ‰€éœ€èµ„æºã€‚</p><h2 id="6-3-2-ç ´åâ€œä¸å¯æŠ¢å â€æ¡ä»¶"><a href="#6-3-2-ç ´åâ€œä¸å¯æŠ¢å â€æ¡ä»¶" class="headerlink" title="6.3.2 ç ´åâ€œä¸å¯æŠ¢å â€æ¡ä»¶"></a>6.3.2 ç ´åâ€œä¸å¯æŠ¢å â€æ¡ä»¶</h2><p>ä¸ºäº†èƒ½ç ´åâ€œä¸å¯æŠ¢å â€æ¡ä»¶ï¼Œåè®®ä¸­è§„å®šï¼Œå½“ä¸€ä¸ªå·²ç»ä¿æŒäº†æŸäº›ä¸å¯è¢«æŠ¢å èµ„æºçš„è¿›ç¨‹ï¼Œæå‡ºæ–°çš„èµ„æºè¯·æ±‚è€Œä¸èƒ½å¾—åˆ°æ»¡è¶³æ—¶ï¼Œä»–å¿…é¡»é‡Šæ”¾å·²ç»ä¿æŒçš„æ‰€æœ‰èµ„æºï¼Œå¾…ä»¥åéœ€è¦æ—¶å†é‡æ–°ç”³è¯·ã€‚è¿™æ„å‘³ç€è¿›ç¨‹å·²å æœ‰çš„èµ„æºä¼šè¢«æš‚æ—¶åœ°é‡Šæ”¾ï¼Œæˆ–è€…è¯´æ˜¯è¢«æŠ¢å äº†ï¼Œä»è€Œç ´åäº†â€œä¸å¯æŠ¢å â€æ¡ä»¶ã€‚</p><h2 id="6-3-3-ç ´åâ€œå¾ªç¯ç­‰å¾…â€æ¡ä»¶"><a href="#6-3-3-ç ´åâ€œå¾ªç¯ç­‰å¾…â€æ¡ä»¶" class="headerlink" title="6.3.3 ç ´åâ€œå¾ªç¯ç­‰å¾…â€æ¡ä»¶"></a>6.3.3 ç ´åâ€œå¾ªç¯ç­‰å¾…â€æ¡ä»¶</h2><p>ä¸€ä¸ªèƒ½ä¿è¯â€œå¾ªç¯ç­‰å¾…â€æ¡ä»¶ä¸æˆç«‹çš„æ–¹æ³•æ˜¯ï¼Œå¯¹ç³»ç»Ÿæ‰€æœ‰èµ„æºç±»å‹è¿›è¡Œçº¿æ€§æ’åºï¼Œå¹¶èµ‹äºˆä¸åŒçš„åºå·ã€‚æ’åºåï¼Œä¾¿å¯ä»¥é‡‡ç”¨è¿™æ ·çš„é¢„é˜²åè®®ï¼šè§„å®šæ¯ä¸ªè¿›ç¨‹å¿…é¡»æŒ‰ç…§åºå·çš„åœ°å€é¡ºåºæ¥è¯·æ±‚èµ„æºã€‚ä¸€ä¸ªè¿›ç¨‹åœ¨å¼€å§‹æ—¶ï¼Œå¯ä»¥è¯·æ±‚èµ„æº$R_i$çš„å•å…ƒï¼Œä»¥åï¼Œå½“ä¸”ä»…å½“$F(R_j)&gt;F(R_i)$ï¼Œè¿›ç¨‹æ‰å¯ä»¥è¯·æ±‚èµ„æº$R_j$ã€‚å¦‚æœéœ€è¦å¤šä¸ªåŒç±»èµ„æºå•å…ƒï¼Œåˆ™å¿…é¡»ä¸€èµ·è¯·æ±‚ã€‚</p><ul><li>ä¼˜ç‚¹ï¼šèµ„æºåˆ©ç”¨ç‡å’Œç³»ç»Ÿååé‡éƒ½æœ‰æ¯”è¾ƒæ˜æ˜¾çš„æ”¹å–„ã€‚</li><li>ç¼ºç‚¹ï¼š<ol><li>ç³»ç»Ÿä¸­å„ç±»èµ„æºæ‰€è§„å®šçš„åºå·å¿…é¡»ç¨³å®šï¼Œè¿™å°±é™åˆ¶äº†æ–°ç±»å‹è®¾å¤‡çš„å¢åŠ </li><li>å¯èƒ½ä¼šå‘ç”Ÿä½œä¸šä½¿ç”¨å„ç±»èµ„æºçš„é¡ºåºä¸ç³»ç»Ÿè§„å®šçš„ä¸åŒï¼Œé€ æˆèµ„æºçš„æµªè´¹ã€‚</li><li>è¿™ç§æŒ‰ç…§è§„å®šæ¬¡åºç”³è¯·èµ„æºçš„æ–¹æ³•ä¼šé™åˆ¶ç”¨æˆ·ç®€å•ï¼Œè‡ªä¸»çš„ç¼–ç¨‹ã€‚</li></ol></li></ul><h1 id="6-4-é¿å…æ­»é”"><a href="#6-4-é¿å…æ­»é”" class="headerlink" title="6.4 é¿å…æ­»é”"></a>6.4 é¿å…æ­»é”</h1><h2 id="6-4-1-ç³»ç»Ÿå®‰å…¨çŠ¶æ€"><a href="#6-4-1-ç³»ç»Ÿå®‰å…¨çŠ¶æ€" class="headerlink" title="6.4.1 ç³»ç»Ÿå®‰å…¨çŠ¶æ€"></a>6.4.1 ç³»ç»Ÿå®‰å…¨çŠ¶æ€</h2><p>åœ¨æ­»é”é¿å…æ–¹æ³•ä¸­ï¼ŒæŠŠç³»ç»Ÿçš„çŠ¶æ€åˆ†ä¸ºå®‰å…¨çŠ¶æ€å’Œä¸å®‰å…¨çŠ¶æ€ã€‚å½“ç³»ç»Ÿå¤„äºå®‰å…¨çŠ¶æ€æ—¶ï¼Œå¯é¿å…å‘ç”Ÿæ­»é”ã€‚åä¹‹ï¼Œå½“ç³»ç»Ÿå¤„äºä¸å®‰å…¨çŠ¶æ€æ—¶ï¼Œåˆ™å¯èƒ½è¿›å…¥åˆ°æ­»é”çŠ¶æ€ã€‚</p><p>åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œå…è®¸è¿›ç¨‹åŠ¨æ€çš„ç”³è¯·èµ„æºå—ï¼Œä½†ç³»ç»Ÿåœ¨è¿›è¡Œèµ„æºåˆ†é…ä¹‹å‰ï¼Œåº”å…ˆè®¡ç®—æ­¤æ¬¡èµ„æºåˆ†é…çš„å®‰å…¨æ€§ã€‚è‹¥æ­¤æ¬¡åˆ†é…ä¸ä¼šå¯¼è‡´ç³»ç»Ÿè¿›å…¥ä¸å®‰å…¨çŠ¶æ€ï¼Œæ‰å¯å°†èµ„æºåˆ†é…ç»™è¿›ç¨‹ï¼Œå¦åˆ™ï¼Œå¦è¿›ç¨‹ç­‰å¾…ã€‚</p><p>å®‰å…¨çŠ¶æ€æ˜¯æŒ‡ç³»ç»Ÿèƒ½æŒ‰æŸç§è¿›ç¨‹æ¨è¿›é¡ºåºä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…å…¶æ‰€éœ€èµ„æºï¼Œç›´è‡³æ»¡è¶³æ¯ä¸ªè¿›ç¨‹å¯¹èµ„æºçš„æœ€å¤§éœ€æ±‚ã€‚å¦‚æœæ— æ³•æ‰¾åˆ°è¿™æ ·ä¸€ä¸ªåºåˆ—ï¼Œåˆ™ç§°ç³»ç»Ÿå¤„äºä¸å®‰å…¨çŠ¶æ€ã€‚</p><h2 id="6-4-2-åˆ©ç”¨é“¶è¡Œå®¶ç®—æ³•é¿å…æ­»é”"><a href="#6-4-2-åˆ©ç”¨é“¶è¡Œå®¶ç®—æ³•é¿å…æ­»é”" class="headerlink" title="6.4.2 åˆ©ç”¨é“¶è¡Œå®¶ç®—æ³•é¿å…æ­»é”"></a>6.4.2 åˆ©ç”¨é“¶è¡Œå®¶ç®—æ³•é¿å…æ­»é”</h2><p>ä¸ºå®ç°é“¶è¡Œå®¶ç®—æ³•ï¼Œæ¯ä¸€ä¸ªæ–°è¿›ç¨‹åœ¨è¿›å…¥ç³»ç»Ÿæ—¶ï¼Œä»–å¿…é¡»ç”³æ˜åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½éœ€è¦æ¯ç§èµ„æºç±»å‹çš„æœ€å¤§å•å…ƒæ•°ç›®ï¼Œå…¶æ•°ç›®ä¸åº”è¶…è¿‡ç³»ç»Ÿæ‰€æ‹¥æœ‰çš„èµ„æºæ€»é‡ã€‚å½“è¿›ç¨‹è¯·æ±‚ä¸€ç»„èµ„æºæ—¶ï¼Œç³»ç»Ÿå¿…é¡»é¦–å…ˆç¡®å®šæ˜¯å¦æœ‰è¶³å¤Ÿçš„èµ„æºåˆ†é…ç»™è¿›ç¨‹ã€‚è‹¥æœ‰ï¼Œå†è¿›ä¸€æ­¥è®¡ç®—åœ¨å°†è¿™äº›èµ„æºåˆ†é…ç»™è¿›ç¨‹åï¼Œæ˜¯å¦ä¼šä½¿ç³»ç»Ÿå¤„äºä¸å®‰å…¨çŠ¶æ€ã€‚å¦‚æœä¸ä¼šï¼Œæ‰åˆ†é…èµ„æºã€‚</p><h3 id="6-4-2-1-é“¶è¡Œå®¶ç®—æ³•ä¸­çš„æ•°æ®ç»“æ„"><a href="#6-4-2-1-é“¶è¡Œå®¶ç®—æ³•ä¸­çš„æ•°æ®ç»“æ„" class="headerlink" title="6.4.2.1 é“¶è¡Œå®¶ç®—æ³•ä¸­çš„æ•°æ®ç»“æ„"></a>6.4.2.1 é“¶è¡Œå®¶ç®—æ³•ä¸­çš„æ•°æ®ç»“æ„</h3><ol><li>å¯åˆ©ç”¨èµ„æºå‘é‡Availableã€‚ä»£è¡¨ç³»ç»Ÿä¸­ç›®å‰å·²æœ‰çš„å¯åˆ†é…çš„è¯¥ç§èµ„æºçš„æœ€å¤§æ•°ã€‚</li><li>æœ€å¤§éœ€æ±‚çŸ©é˜µMaxã€‚ä»£è¡¨è¯¥è¿›ç¨‹å¯¹è¯¥èµ„æºçš„æœ€å¤§éœ€æ±‚æ•°ã€‚</li><li>åˆ†é…çŸ©é˜µAllocationã€‚ä»£è¡¨ç›®å‰å·²ç»åˆ†é…ç»™è¯¥è¿›ç¨‹çš„è¯¥èµ„æºçš„æ•°ç›®ã€‚</li><li>éœ€æ±‚çŸ©é˜µNeedã€‚ä»£è¡¨è¯¥è¿›ç¨‹è¿˜éœ€è¦è¯¥èµ„æºçš„æ•°ç›®ã€‚</li></ol><h3 id="6-4-2-2-é“¶è¡Œå®¶ç®—æ³•"><a href="#6-4-2-2-é“¶è¡Œå®¶ç®—æ³•" class="headerlink" title="6.4.2.2 é“¶è¡Œå®¶ç®—æ³•"></a>6.4.2.2 é“¶è¡Œå®¶ç®—æ³•</h3><p>è®¾$Request_i$æ˜¯è¿›ç¨‹$P_i$çš„è¯·æ±‚å‘é‡ï¼Œå¦‚æœ$Request_i[j]=K$ï¼Œè¡¨ç¤ºè¿›ç¨‹$P_i$éœ€è¦$K$ä¸ª$R_j$ç±»å‹çš„èµ„æºã€‚å½“$P_i$å‘å‡ºèµ„æºè¯·æ±‚åï¼Œç³»ç»ŸæŒ‰ä¸‹è¿°æ­¥éª¤è¿›è¡Œæ£€æŸ¥ï¼š</p><ol><li>å¦‚æœ$Request_i[j] \le Need[i, j]$ï¼Œä¾¿è½¬å‘æ­¥éª¤2ï¼›å¦åˆ™ä»»åŠ¡å‡ºé”™ï¼Œå› ä¸ºå®ƒæ‰€éœ€è¦çš„èµ„æºæ•°å·²è¶…è¿‡å®ƒæ‰€å®£å¸ƒçš„æœ€å¤§å€¼ã€‚</li><li>å¦‚æœ$Request_i[j] \le Available[j]$ï¼Œä¾¿è½¬å‘æ­¥éª¤3ï¼›å¦åˆ™ï¼Œè¡¨ç¤ºå°šæ— è¶³å¤Ÿèµ„æºï¼Œ$P_i$éœ€ç­‰å¾…ã€‚</li><li>ç³»ç»Ÿè¯•æ¢ç€æŠŠèµ„æºåˆ†é…ç»™è¿›ç¨‹$P_i$ï¼Œå¹¶ä¿®æ”¹ä¸‹é¢æ•°æ®ç»“æ„ä¸­çš„æ•°å€¼ï¼š$Available[j] = Available[j] - Request_i[j]$<br> $Allocation[i,j] = Allocation[i,j] + Request_i[j]$<br> $Need[i,j] = Need[i,j] - Request_i[j]$</li><li>ç³»ç»Ÿæ‰§è¡Œå®‰å…¨æ€§ç®—æ³•ï¼Œæ£€æŸ¥æ­¤æ¬¡èµ„æºåˆ†é…åç³»ç»Ÿæ˜¯å¦å¤„äºå®‰å…¨çŠ¶æ€ã€‚è‹¥å®‰å…¨ï¼Œæ‰æ­£å¼å°†èµ„æºåˆ†é…ç»™è¿›ç¨‹$P_i$ï¼Œå·²å®Œæˆæœ¬æ¬¡åˆ†é…ï¼›å¦åˆ™ï¼Œå°†æœ¬æ¬¡çš„è¯•æ¢åˆ†é…ä½œåºŸï¼Œæ¢å¤åŸæ¥çš„èµ„æºåˆ†é…çŠ¶æ€ï¼Œè®©è¿›ç¨‹$P_i$ç­‰å¾…ã€‚</li></ol><h3 id="6-4-2-3-å®‰å…¨æ€§ç®—æ³•"><a href="#6-4-2-3-å®‰å…¨æ€§ç®—æ³•" class="headerlink" title="6.4.2.3 å®‰å…¨æ€§ç®—æ³•"></a>6.4.2.3 å®‰å…¨æ€§ç®—æ³•</h3><ol><li>è®¾ç½®ä¸¤ä¸ªå‘é‡ï¼šâ‘ å·¥ä½œå‘é‡Workï¼Œä»–è¡¨ç¤ºç³»ç»Ÿå¯æä¾›ç»™è¿›ç¨‹ç»§ç»­è¿è¡Œæ‰€éœ€çš„å„ç±»èµ„æºæ•°ç›®ï¼Œå®ƒå«æœ‰mä¸ªå…ƒç´ ï¼Œåœ¨æ‰§è¡Œå®‰å…¨ç®—æ³•å¼€å§‹æ—¶ï¼Œ$Word = Available$ï¼›â‘¡FInishï¼šä»–è¡¨ç¤ºç³»ç»Ÿæ˜¯å¦æœ‰è¶³å¤Ÿçš„èµ„æºåˆ†é…ç»™è¿›ç¨‹ï¼Œä½¿ä¹‹è¿è¡Œå®Œæˆã€‚å¼€å§‹æ—¶å…ˆåš$Finish[i] = false$ï¼›å½“æœ‰è¶³å¤Ÿèµ„æºåˆ†é…ç»™è¿›ç¨‹æ—¶ï¼Œå†ä»¤$Finish[i] = true$ã€‚</li><li>ä»è¿›ç¨‹é›†åˆä¸­æ‰¾åˆ°ä¸€ä¸ªèƒ½æ»¡è¶³ä¸‹è¿°æ¡ä»¶çš„è¿›ç¨‹ï¼šâ‘ $Finish[i]=false$ï¼›â‘¡$Need[i,j] \le Work[j]$ï¼›è‹¥æ‰¾åˆ°åˆ™æ‰§è¡Œæ­¥éª¤3ï¼Œå¦åˆ™æ‰§è¡Œæ­¥éª¤4.</li><li>è‹¥è¿›ç¨‹$P_i$è·å¾—èµ„æºåï¼Œå¯é¡ºåˆ©æ‰§è¡Œï¼Œç›´è‡³å®Œæˆï¼Œå¹¶é‡Šæ”¾å‡ºåˆ†é…ç»™ä»–çš„èµ„æºï¼Œæ•…åº”æ‰§è¡Œï¼š<br> $Word[j] = Work[j] + Allocation[i,j];$<br> $Finish[i]=true;$<br> go to step 2;</li><li>å¦‚æœæ‰€æœ‰è¿›ç¨‹çš„$Finish[i]=true$éƒ½æ»¡è¶³ï¼Œåˆ™è¡¨ç¤ºç³»ç»Ÿå¤„äºå®‰å…¨çŠ¶æ€ï¼›å¦åˆ™ï¼Œç³»ç»Ÿå¤„äºä¸å®‰å…¨çŠ¶æ€ã€‚</li></ol><h3 id="6-4-2-4-é“¶è¡Œå®¶ç®—æ³•ä¾‹å­"><a href="#6-4-2-4-é“¶è¡Œå®¶ç®—æ³•ä¾‹å­" class="headerlink" title="6.4.2.4 é“¶è¡Œå®¶ç®—æ³•ä¾‹å­"></a>6.4.2.4 é“¶è¡Œå®¶ç®—æ³•ä¾‹å­</h3><h4 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h4><p>å‡å®šç³»ç»Ÿä¸­æœ‰äº”ä¸ªè¿›ç¨‹${P_0, P_1, P_2, P_3, P_4}$å’Œä¸‰ç±»èµ„æº${A, B, C}$ï¼Œå„ç§èµ„æºçš„æ•°é‡åˆ†åˆ«ä¸º10ã€5ã€7ï¼Œåœ¨$T_0$æ—¶åˆ»çš„èµ„æºåˆ†é…æƒ…å†µå¦‚å›¾æ‰€ç¤ºï¼š<br><img src="https://cdn.littlecorgi.top/mweb/2019-09-20/T0%E6%97%B6%E5%88%BB%E7%9A%84%E8%B5%84%E6%BA%90%E5%88%86%E9%85%8D%E8%A1%A8.png" alt="T0æ—¶åˆ»çš„èµ„æºåˆ†é…è¡¨"></p><h4 id="åœ¨-T-0-æ—¶åˆ»çš„å®‰å…¨æ€§"><a href="#åœ¨-T-0-æ—¶åˆ»çš„å®‰å…¨æ€§" class="headerlink" title="åœ¨$T_0$æ—¶åˆ»çš„å®‰å…¨æ€§"></a>åœ¨$T_0$æ—¶åˆ»çš„å®‰å…¨æ€§</h4><p>åˆ©ç”¨å®‰å…¨æ€§ç®—æ³•å¯¹$T_0$æ—¶åˆ»çš„èµ„æºåˆ†é…æƒ…å†µè¿›è¡Œåˆ†æå¯çŸ¥ï¼Œåœ¨$T_0$æ—¶åˆ»å­˜åœ¨ç€ä¸€ä¸ªå®‰å…¨åºåˆ—${P_1,P_3,P_4,P_2,P_0}$ï¼Œæ•…ç³»ç»Ÿæ˜¯å®‰å…¨çš„ã€‚<br><img src="https://cdn.littlecorgi.top/mweb/2019-09-20/T0%E6%97%B6%E5%88%BB%E7%9A%84%E5%AE%89%E5%85%A8%E5%BA%8F%E5%88%97.png" alt="T0æ—¶åˆ»çš„å®‰å…¨åºåˆ—"></p><h4 id="P-1-è¯·æ±‚èµ„æº"><a href="#P-1-è¯·æ±‚èµ„æº" class="headerlink" title="$P_1$è¯·æ±‚èµ„æº"></a>$P_1$è¯·æ±‚èµ„æº</h4><p>$P_1$å‘å‡ºè¯·æ±‚å‘é‡$Request_1(1,0,2)$ï¼Œç³»ç»ŸæŒ‰é“¶è¡Œå®¶ç®—æ³•è¿›è¡Œæ£€æŸ¥ï¼š<br>â‘ $Request_1(1,0,2) \le Need_1(1,2,2)$ï¼›<br>â‘¡$Request_1(1,0,2) \le Available_1(3,3,2)$ï¼›<br>â‘¢ç³»ç»Ÿå…ˆå‡å®šå¯ä¸º$P_1$åˆ†é…èµ„æºï¼Œå¹¶ä¿®æ”¹$Avaliable$ï¼Œ$Allocation_1$å’Œ$Need_1$å‘é‡ï¼Œç”±æ­¤å½¢æˆçš„èµ„æºå˜åŒ–æƒ…å†µå¦‚1å›¾ä¸­çš„åœ†æ‹¬å·æ‰€ç¤ºï¼›<br>â‘£å†åˆ©ç”¨å®‰å…¨æ€§ç®—æ³•æ£€æŸ¥æ­¤æ—¶ç³»ç»Ÿæ˜¯å¦å®‰å…¨ï¼Œå¦‚å›¾æ‰€ç¤º<br><img src="https://cdn.littlecorgi.top/mweb/2019-09-20/P1%E7%94%B3%E8%AF%B7%E8%B5%84%E6%BA%90%E6%97%B6%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7%E6%A3%80%E6%9F%A5.png" alt="P1ç”³è¯·èµ„æºæ—¶çš„å®‰å…¨æ€§æ£€æŸ¥"></p><p>æœ‰æ‰€è¿›è¡Œçš„å®‰å…¨æ€§æ£€æŸ¥å¾—çŸ¥ï¼Œå¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå®‰å…¨åºåˆ—${P_1,P_3,P_4,P_2,P_0}$ã€‚å› æ­¤ï¼Œç³»ç»Ÿæ˜¯å®‰å…¨çš„ï¼Œå¯ä»¥ç«‹å³å°†$P_1$æ‰€ç”³è¯·çš„èµ„æºåˆ†é…ç»™å®ƒã€‚</p><h4 id="P-4-è¯·æ±‚èµ„æº"><a href="#P-4-è¯·æ±‚èµ„æº" class="headerlink" title="$P_4$è¯·æ±‚èµ„æº"></a>$P_4$è¯·æ±‚èµ„æº</h4><p>$P_4$å‘å‡ºè¯·æ±‚å‘é‡$Request_4(3,3,0)$ï¼Œç³»ç»ŸæŒ‰é“¶è¡Œå®¶ç®—æ³•è¿›è¡Œæ£€æŸ¥ï¼š<br>â‘ $Request_4(3,3,0) \le Need_4(4,3,1)$ï¼›<br>â‘¡$Request_4(3,3,0) \ge Available(2,3,0)$ï¼Œè®©$P_4$ç­‰å¾…ã€‚</p><h4 id="P-0-è¯·æ±‚èµ„æº"><a href="#P-0-è¯·æ±‚èµ„æº" class="headerlink" title="$P_0$è¯·æ±‚èµ„æº"></a>$P_0$è¯·æ±‚èµ„æº</h4><p>$P_0$å‘å‡ºè¯·æ±‚å‘é‡$Request_0(0,2,0)$ï¼Œç³»ç»ŸæŒ‰é“¶è¡Œå®¶ç®—æ³•è¿›è¡Œæ£€æŸ¥ï¼š<br>â‘ $Request_0(0,2,0) \le Need_0(7,4,3)$ï¼›<br>â‘¡$Request_0(0,2,0) \le Available(2,3,0)$ï¼›<br>â‘¢ç³»ç»Ÿæš‚æ—¶å…ˆå‡å®šå¯ä¸º$P_0$åˆ†é…èµ„æºï¼Œå¹¶ä¿®æ”¹æœ‰å…³æ•°æ®ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚<br><img src="https://cdn.littlecorgi.top/mweb/2019-09-20/%E4%B8%BAP0%E5%88%86%E9%85%8D%E8%B5%84%E6%BA%90%E5%90%8E%E7%9A%84%E6%9C%89%E5%85%B3%E8%B5%84%E6%BA%90%E6%95%B0%E6%8D%AE.png" alt="ä¸ºP0åˆ†é…èµ„æºåçš„æœ‰å…³èµ„æºæ•°æ®"></p><h4 id="è¿›å…¥å®‰å…¨æ€§æ£€æŸ¥"><a href="#è¿›å…¥å®‰å…¨æ€§æ£€æŸ¥" class="headerlink" title="è¿›å…¥å®‰å…¨æ€§æ£€æŸ¥"></a>è¿›å…¥å®‰å…¨æ€§æ£€æŸ¥</h4><p>å¯ç”¨èµ„æº$Available(2,1,0)$å·²ä¸èƒ½æ»¡è¶³ä»»ä½•è¿›ç¨‹çš„éœ€è¦ï¼Œæ•…ç³»ç»Ÿè¿›å…¥ä¸å®‰å…¨çŠ¶æ€ï¼Œæ­¤æ—¶ç³»ç»Ÿä¸åˆ†é…èµ„æºã€‚</p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ</category>
      
      
      <comments>https://www.littlecorgi.top/posts/68dc89d4.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>æ“ä½œç³»ç»Ÿ5--å¤„ç†æœºè°ƒåº¦</title>
      <link>https://www.littlecorgi.top/posts/8b4e2673.html</link>
      <guid>https://www.littlecorgi.top/posts/8b4e2673.html</guid>
      <pubDate>Mon, 12 Aug 2019 07:40:55 GMT</pubDate>
      
      <description>&lt;blockquote&gt;
&lt;p&gt;å¤§å®¶å¯ä»¥çœ‹ä¸‹æˆ‘ä½¿ç”¨å¹•å¸ƒè½¯ä»¶ç”»çš„&lt;a href=&quot;https://mubu.com/doc/3Pf0zwzrgw&quot;&gt;æ€ç»´å¯¼å›¾&lt;/a&gt;ï¼Œå¦‚æœå¤§å®¶æƒ³ä½¿ç”¨å¹•å¸ƒå¯ä»¥é€šè¿‡æˆ‘çš„é‚€è¯·é“¾æ¥æ³¨å†Œï¼Œå¯å…è´¹è·å¾—ä¸€ä¸ªæœˆé«˜çº§ä¼šå‘˜&lt;a href=&quot;https://mubu.com/inv/477598&quot;&gt;https://mubu.com/inv/477598&lt;/a&gt;&lt;br&gt;</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>å¤§å®¶å¯ä»¥çœ‹ä¸‹æˆ‘ä½¿ç”¨å¹•å¸ƒè½¯ä»¶ç”»çš„<a href="https://mubu.com/doc/3Pf0zwzrgw">æ€ç»´å¯¼å›¾</a>ï¼Œå¦‚æœå¤§å®¶æƒ³ä½¿ç”¨å¹•å¸ƒå¯ä»¥é€šè¿‡æˆ‘çš„é‚€è¯·é“¾æ¥æ³¨å†Œï¼Œå¯å…è´¹è·å¾—ä¸€ä¸ªæœˆé«˜çº§ä¼šå‘˜<a href="https://mubu.com/inv/477598">https://mubu.com/inv/477598</a><br><span id="more"></span></p></blockquote><p>åœ¨å¤šé“ç¨‹åºä¸­ï¼Œè°ƒåº¦çš„å®è´¨æ˜¯ä¸€ç§èµ„æºåˆ†é…ï¼Œå¤„ç†æœºè°ƒåº¦æ˜¯å¯¹å¤„ç†æœºèµ„æºè¿›è¡Œåˆ†é…ã€‚</p><h1 id="5-1-å¤„ç†æœºè°ƒåº¦çš„å±‚æ¬¡å’Œè°ƒåº¦ç®—æ³•çš„ç›®æ ‡"><a href="#5-1-å¤„ç†æœºè°ƒåº¦çš„å±‚æ¬¡å’Œè°ƒåº¦ç®—æ³•çš„ç›®æ ‡" class="headerlink" title="5.1 å¤„ç†æœºè°ƒåº¦çš„å±‚æ¬¡å’Œè°ƒåº¦ç®—æ³•çš„ç›®æ ‡"></a>5.1 å¤„ç†æœºè°ƒåº¦çš„å±‚æ¬¡å’Œè°ƒåº¦ç®—æ³•çš„ç›®æ ‡</h1><p>åœ¨å¤šé“æ‰¹å¤„ç†ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªä½œä¸šä»æäº¤åˆ°è·å¾—å¤„ç†æœºæ‰§è¡Œï¼Œç›´è‡³ä½œä¸šè¿è¡Œå®Œæˆï¼Œå¯èƒ½éœ€è¦ç»å†å¤šæ¬¡å¤„ç†æœºè°ƒåº¦ã€‚</p><h2 id="5-1-1-å¤„ç†æœºè°ƒåº¦çš„å±‚æ¬¡"><a href="#5-1-1-å¤„ç†æœºè°ƒåº¦çš„å±‚æ¬¡" class="headerlink" title="5.1.1 å¤„ç†æœºè°ƒåº¦çš„å±‚æ¬¡"></a>5.1.1 å¤„ç†æœºè°ƒåº¦çš„å±‚æ¬¡</h2><ol><li><p>é«˜çº§è°ƒåº¦<br> é«˜çº§è°ƒåº¦åˆç§°ä¸ºé•¿ç¨‹è°ƒåº¦æˆ–ä½œä¸šè°ƒåº¦ï¼Œä»–çš„è°ƒåº¦å¯¹è±¡æ˜¯ä½œä¸šã€‚ä¸»è¦åŠŸèƒ½æ˜¯æ ¹æ®æŸç§ç®—æ³•ï¼Œå†³å®šå°†å¤–å­˜ä¸Šå¤„äºåå¤‡é˜Ÿåˆ—ä¸­çš„å“ªå‡ ä¸ªä½œä¸šè°ƒå…¥å†…å­˜ã€ä¸ºä»–ä»¬åˆ›å»ºè¿›ç¨‹ï¼Œåˆ†é…å¿…è¦çš„èµ„æºï¼Œå¹¶å°†ä»–ä»¬æ”¾å…¥å°±ç»ªé˜Ÿåˆ—ã€‚</p></li><li><p>ä½çº§è°ƒåº¦<br> ä½çº§è°ƒåº¦åˆç§°ä¸ºçŸ­ç¨‹è°ƒåº¦æˆ–ä½œä¸šè°ƒåº¦ï¼Œä»–çš„è°ƒåº¦å¯¹è±¡æ˜¯è¿›ç¨‹ã€‚ä¸»è¦åŠŸèƒ½æ˜¯æ ¹æ®æŸç§ç®—æ³•ï¼Œå†³å®šå°±ç»ªé˜Ÿåˆ—ä¸­å“ªä¸ªè¿›ç¨‹åº”è·å¾—å¤„ç†æœºï¼Œå¹¶ç”±åˆ†æ´¾ç¨‹åºå°†å¤„ç†æœºåˆ†é…ç»™è¢«é€‰ä¸­çš„è¿›ç¨‹ã€‚</p></li><li><p>ä¸­çº§è°ƒåº¦<br> ä¸­çº§è°ƒåº¦åˆç§°ä¸ºå†…å­˜è°ƒåº¦ã€‚ä¸»è¦åŠŸèƒ½æ˜¯å°†é‚£äº›æš‚æ—¶ä¸èƒ½è¿è¡Œçš„è¿›ç¨‹ï¼Œè°ƒè‡³å¤–å­˜ç­‰å¾…ï¼Œå½“ä»–ä»¬å…·å¤‡è¿è¡Œæ¡ä»¶ä¸”å†…å­˜åˆç¨æœ‰ç©ºé—²æ—¶å†è°ƒå…¥å†…å­˜ã€‚</p></li></ol><h2 id="5-1-2-å¤„ç†æœºè°ƒåº¦ç®—æ³•çš„ç›®æ ‡"><a href="#5-1-2-å¤„ç†æœºè°ƒåº¦ç®—æ³•çš„ç›®æ ‡" class="headerlink" title="5.1.2 å¤„ç†æœºè°ƒåº¦ç®—æ³•çš„ç›®æ ‡"></a>5.1.2 å¤„ç†æœºè°ƒåº¦ç®—æ³•çš„ç›®æ ‡</h2><h3 id="5-1-2-1-å¤„ç†æœºè°ƒåº¦ç®—æ³•çš„å…±åŒç›®æ ‡"><a href="#5-1-2-1-å¤„ç†æœºè°ƒåº¦ç®—æ³•çš„å…±åŒç›®æ ‡" class="headerlink" title="5.1.2.1 å¤„ç†æœºè°ƒåº¦ç®—æ³•çš„å…±åŒç›®æ ‡"></a>5.1.2.1 å¤„ç†æœºè°ƒåº¦ç®—æ³•çš„å…±åŒç›®æ ‡</h3><ol><li>èµ„æºåˆ©ç”¨ç‡<br> ç³»ç»Ÿä¸­çš„å¤„ç†æœºå’Œå…¶å®ƒæ‰€æœ‰èµ„æºåº”å°½å¯èƒ½ä¿æŒå¿™ç¢ŒçŠ¶æ€ï¼Œå…¶ä¸­æœ€é‡è¦çš„å¤„ç†æœºåˆ©ç”¨ç‡å¯ç”¨ä»¥ä¸‹æ–¹å¼è®¡ç®—ï¼š<script type="math/tex; mode=display">CPUçš„åˆ©ç”¨ç‡=\frac{CPUæœ‰æ•ˆå·¥ä½œæ—¶é—´}{CPUæœ‰æ•ˆå·¥ä½œæ—¶é—´+CPUç©ºé—²ç­‰å¾…æ—¶é—´}</script></li><li>å…¬å¹³æ€§<br> ç³»ç»Ÿä¸­çš„æ‰€æœ‰çš„è¿›ç¨‹éƒ½åº”è¯¥è·å¾—åˆç†çš„CPUæ—¶é—´ï¼Œä¸ä¼šå‘ç”Ÿè¿›ç¨‹é¥¥é¥¿ç°è±¡ã€‚ï¼Œå¯¹åŒç±»å‹çš„è¿›ç¨‹è·å¾—ç›¸åŒçš„æœåŠ¡ï¼›ä¸åŒç±»å‹çš„è¿›ç¨‹ï¼Œç”±äºç´§æ€¥ç¨‹åº¦ä¸åŒæˆ–è€…é‡è¦æ€§ä¸åŒï¼Œåº”æä¾›ä¸åŒçš„æœåŠ¡ã€‚</li><li><p>å¹³è¡¡æ€§<br> ç³»ç»Ÿä¸­å¯èƒ½å…·æœ‰å¤šç§ç±»å‹çš„è¿›ç¨‹ï¼Œæœ‰çš„æ˜¯è®¡ç®—å‹ä½œä¸šï¼Œæœ‰çš„æ˜¯I/Oå‹ä½œä¸šã€‚ä¸ºäº†ä½¿CPUå’Œèµ„æºå°½å¯èƒ½çš„å¤„äºå¿™ç¢ŒçŠ¶æ€ï¼Œè°ƒåº¦ç®—æ³•åº”å°½å¯èƒ½çš„ä¿æŒç³»ç»Ÿèµ„æºä½¿ç”¨çš„å¹³è¡¡æ€§ã€‚</p></li><li><p>ç­–ç•¥å¼ºåˆ¶æ‰§è¡Œ<br> å¯¹æ‰€å®šåˆ¶çš„ç­–ç•¥ï¼Œåªè¦éœ€è¦ï¼Œå°±å¿…é¡»å‡†ç¡®çš„æ‰§è¡Œã€‚</p></li></ol><h3 id="5-1-2-2-æ‰¹å¤„ç†ç³»ç»Ÿçš„ç›®æ ‡"><a href="#5-1-2-2-æ‰¹å¤„ç†ç³»ç»Ÿçš„ç›®æ ‡" class="headerlink" title="5.1.2.2 æ‰¹å¤„ç†ç³»ç»Ÿçš„ç›®æ ‡"></a>5.1.2.2 æ‰¹å¤„ç†ç³»ç»Ÿçš„ç›®æ ‡</h3><ol><li>å¹³å‡å‘¨è½¬æ—¶é—´æ®µ<br> å‘¨è½¬æ—¶é—´ï¼Œæ˜¯æŒ‡ä»ä½œä¸šè¢«æäº¤ç»™ç³»ç»Ÿï¼Œç›´åˆ°ä½œä¸šæ‰§è¡Œå®Œæ¯•æ‰€èŠ±è´¹çš„æ—¶é—´ã€‚<br> å¯¹äºæ¯ä¸ªç”¨æˆ·æ¥è¨€ï¼Œéƒ½å¸Œæœ›è‡ªå·±çš„å‘¨è½¬æ—¶é—´æœ€çŸ­ï¼›ä½†æ˜¯å¯¹äºç³»ç»Ÿæ¥è¨€ï¼Œä»–è¦æ±‚çš„æ˜¯å¹³å‡å‘¨è½¬æ—¶é—´æœ€çŸ­ï¼Œè¿™ä¸ä»…å¯ä»¥æé«˜ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡ï¼Œè€Œä¸”è¿˜å¯ä½¿å¤§å¤šæ•°ç”¨æˆ·éƒ½æ„Ÿåˆ°æ»¡æ„ã€‚<br> å¯æŠŠå‘¨è½¬æ—¶é—´æè¿°ä¸ºï¼š<script type="math/tex; mode=display">T=\frac{1}{n}[\sum_{i=1}^{n}{T_i}]</script> ä¸ºäº†è¿›ä¸€æ­¥ååº”è°ƒåº¦çš„æ€§èƒ½ï¼Œæ›´æ¸…æ¥šçš„æè¿°å„è¿›ç¨‹åœ¨å…¶å‘¨è½¬æ—¶é—´ä¸­ï¼Œç­‰å¾…å’Œæ‰§è¡Œæ—¶é—´çš„å…·ä½“åˆ†é…æƒ…å†µï¼Œå¾€å¾€ä½¿ç”¨å¸¦æƒå‘¨è½¬æ—¶é—´ï¼Œå³ä½œä¸šå‘¨è½¬æ—¶é—´Tä¸ç³»ç»Ÿä¸ºä»–æä¾›çš„æ—¶é—´Tsä¹‹æ¯”ï¼Œå³$ W=\frac{T}{T_s} $ï¼Œå¹³å‡å¸¦æƒå‘¨è½¬æ—¶é—´å¯è¡¨ç¤ºä¸ºï¼š<script type="math/tex; mode=display">W = \frac{1}{n}\sum_{i=1}^{n}\frac{T_i}{T_s}</script></li><li><p>ç³»ç»Ÿååé‡é«˜</p></li><li><p>å¤„ç†æœºåˆ©ç”¨ç‡é«˜</p></li></ol><h3 id="5-1-2-3-åˆ†æ—¶ç³»ç»Ÿçš„ç›®æ ‡"><a href="#5-1-2-3-åˆ†æ—¶ç³»ç»Ÿçš„ç›®æ ‡" class="headerlink" title="5.1.2.3 åˆ†æ—¶ç³»ç»Ÿçš„ç›®æ ‡"></a>5.1.2.3 åˆ†æ—¶ç³»ç»Ÿçš„ç›®æ ‡</h3><ol><li><p>ç›¸åº”äº‹æ—¶é—´å¿«<br> å“åº”æ—¶é—´æ˜¯æŒ‡ä»ç”¨æˆ·é€šè¿‡é”®ç›˜æäº¤ä¸€ä¸ªè¯·æ±‚å¼€å§‹ï¼Œç›´åˆ°å±å¹•ä¸Šæ˜¾ç¤ºå‡ºå¤„ç†ç»“æœä¸ºä¹‹çš„ä¸€æ®µæ—¶é—´é—´éš”ï¼Œå®ƒåŒ…æ‹¬ä¸‰éƒ¨åˆ†æ—¶é—´ï¼šä¸€æ˜¯è¯·æ±‚ä¿¡æ¯ä»é”®ç›˜è¾“å…¥å¼€å§‹ï¼Œç›´è‡³å°†å…¶ä¼ é€åˆ°å¤„ç†æœºçš„æ—¶é—´ï¼›äºŒæ˜¯å¤„ç†æœºå¯¹è¯·æ±‚ä¿¡æ¯è¿›è¡Œå¤„ç†çš„æ—¶é—´ï¼›ä¸‰æ˜¯å°†æ‰€å½¢æˆçš„çš„å“åº”ä¿¡æ¯å›é€åˆ°ç»ˆç«¯æ˜¾ç¤ºå™¨çš„æ—¶é—´ã€‚</p></li><li><p>å‡è¡¡æ€§<br> ç”¨æˆ·å¯¹å“åº”æ—¶é—´çš„è¦æ±‚å¹¶éå®Œå…¨ç›¸åŒã€‚é€šå¸¸ï¼Œç”¨æˆ·å¯¹äºå¤æ‚çš„çš„ä½œä¸šï¼Œå“åº”æ—¶é—´å…è®¸è¾ƒé•¿ï¼›å¯¹äºç®€å•çš„ä½œä¸šï¼Œå“åº”æ—¶é—´åˆ™è¦çŸ­ã€‚</p></li></ol><h3 id="5-1-2-4-å®æ—¶ç³»ç»Ÿçš„ç›®æ ‡"><a href="#5-1-2-4-å®æ—¶ç³»ç»Ÿçš„ç›®æ ‡" class="headerlink" title="5.1.2.4 å®æ—¶ç³»ç»Ÿçš„ç›®æ ‡"></a>5.1.2.4 å®æ—¶ç³»ç»Ÿçš„ç›®æ ‡</h3><ol><li>æˆªæ­¢æ—¶é—´çš„ä¿è¯<br> æˆªæ­¢æ—¶é—´æ˜¯æŒ‡æŸä»»åŠ¡å¿…é¡»å¼€å§‹æ‰§è¡Œçš„æœ€è¿Ÿæ—¶é—´ï¼Œæˆ–è€…å¿…é¡»å®Œæˆçš„æœ€è¿Ÿæ—¶é—´ã€‚</li><li>å¯é¢„æµ‹æ€§</li></ol><h1 id="5-2-ä½œä¸šä¸ä½œä¸šè°ƒåº¦"><a href="#5-2-ä½œä¸šä¸ä½œä¸šè°ƒåº¦" class="headerlink" title="5.2 ä½œä¸šä¸ä½œä¸šè°ƒåº¦"></a>5.2 ä½œä¸šä¸ä½œä¸šè°ƒåº¦</h1><p>æˆ‘ä»¬å‰é¢è®²åˆ°è¿‡ï¼Œåœ¨å¤šé“æ‰¹å¤„ç†ç³»ç»Ÿä¸­ï¼Œä½œä¸šç”±ç”¨æˆ·æäº¤ç»™ç³»ç»Ÿæ“ä½œå‘˜ï¼Œå†ç”±ç³»ç»Ÿæ“ä½œå‘˜æŠŠä½œä¸šè¾“å…¥ç»™ç›¸åº”çš„è¾“å…¥è®¾å¤‡ï¼Œå¹¶ä¿å­˜åœ¨ä¸€ä¸ªåå¤‡é˜Ÿåˆ—ä¸­ï¼Œç„¶åå°±ç”±ä½œä¸šè°ƒåº¦ç¨‹åºå°†å…¶ä»å¤–å­˜è°ƒå…¥å†…å­˜å†æ¥è¿›è¡Œå¤„ç†ã€‚</p><h2 id="5-2-1-ä½œä¸š"><a href="#5-2-1-ä½œä¸š" class="headerlink" title="5.2.1 ä½œä¸š"></a>5.2.1 ä½œä¸š</h2><h3 id="5-2-1-1-ä½œä¸šå’Œä½œä¸šæ­¥"><a href="#5-2-1-1-ä½œä¸šå’Œä½œä¸šæ­¥" class="headerlink" title="5.2.1.1 ä½œä¸šå’Œä½œä¸šæ­¥"></a>5.2.1.1 ä½œä¸šå’Œä½œä¸šæ­¥</h3><ol><li><p>ä½œä¸š<br> ä½œä¸šä¸€èˆ¬åŒ…æ‹¬ç¨‹åºè¿˜æ•°æ®ï¼Œè¿˜åº”é…æœ‰ä¸€ä»½ä½œä¸šè¯´æ˜ä¹¦ï¼Œç³»ç»Ÿæ ¹æ®è¯¥è¯´æ˜ä¹¦æ¥å¯¹ç¨‹åºçš„è¿è¡Œè¿›è¡Œæ§åˆ¶ã€‚</p></li><li><p>ä½œä¸šæ­¥<br> åœ¨ä½œä¸šè¿è¡ŒæœŸé—´ï¼Œæ¯ä¸ªä½œä¸šéƒ½å¿…é¡»ç»è¿‡è‹¥å¹²ä¸ªç›¸å¯¹ç‹¬ç«‹ï¼Œåˆç›¸äº’å…³è”çš„é¡ºåºåŠ å·¥æ­¥éª¤æ‰èƒ½å¾—åˆ°ç»“æœã€‚æˆ‘ä»¬æŠŠå…¶ä¸­çš„æ¯ä¸€ä¸ªåŠ å·¥æ­¥éª¤ç§°ä¸ºä¸€ä¸ªä½œä¸šæ­¥ã€‚</p></li></ol><h3 id="5-2-1-2-ä½œä¸šæ§åˆ¶å—JCB"><a href="#5-2-1-2-ä½œä¸šæ§åˆ¶å—JCB" class="headerlink" title="5.2.1.2 ä½œä¸šæ§åˆ¶å—JCB"></a>5.2.1.2 ä½œä¸šæ§åˆ¶å—JCB</h3><p>ä¸ºäº†ç®¡ç†å’Œè°ƒåº¦ä½œä¸šï¼Œåœ¨å¤šé“æ‰¹å¤„ç†ç³»ç»Ÿä¸­ï¼Œä¸ºæ¯ä¸ªä½œä¸šè®¾ç½®äº†ä¸€ä¸ªä½œä¸šæ§åˆ¶å—JCBï¼Œå¥¹æ˜¯ä½œä¸šåœ¨ç³»ç»Ÿä¸­å­˜åœ¨çš„æ ‡å¿—ï¼Œå…¶ä¸­ä¿å­˜äº†ç³»ç»Ÿå¯¹ä½œä¸šè¿›è¡Œç®¡ç†å’Œè°ƒåº¦æ‰€éœ€çš„å…¨éƒ¨ä¿¡æ¯ã€‚<br>é€šå¸¸å†…å®¹æœ‰ä½œä¸šæ ‡è¯†ã€ç”¨æˆ·åç§°ã€ç”¨æˆ·è´¦å·ã€ä½œä¸šç±»å‹ã€ä½œä¸šçŠ¶æ€ã€è°ƒåº¦ä¿¡æ¯ã€èµ„æºéœ€æ±‚ã€èµ„æºä½¿ç”¨æƒ…å†µç­‰ã€‚</p><h3 id="5-2-1-3-ä½œä¸šè¿è¡Œçš„ä¸‰ä¸ªé˜¶æ®µå’Œä¸‰ç§çŠ¶æ€"><a href="#5-2-1-3-ä½œä¸šè¿è¡Œçš„ä¸‰ä¸ªé˜¶æ®µå’Œä¸‰ç§çŠ¶æ€" class="headerlink" title="5.2.1.3 ä½œä¸šè¿è¡Œçš„ä¸‰ä¸ªé˜¶æ®µå’Œä¸‰ç§çŠ¶æ€"></a>5.2.1.3 ä½œä¸šè¿è¡Œçš„ä¸‰ä¸ªé˜¶æ®µå’Œä¸‰ç§çŠ¶æ€</h3><ol><li>æ”¶å®¹é˜¶æ®µ<br> æ“ä½œå‘˜æŠŠç”¨æˆ·æäº¤çš„ä½œä¸šé€šè¿‡æŸç§è¾“å…¥æ–¹å¼æˆ–SPOOLingç³»ç»Ÿè¾“å…¥åˆ°ç¡¬ç›˜ä¸Šï¼Œå†ä¸ºæ”¹ä½œä¸šå»ºç«‹PCBï¼Œå¹¶æŠŠå®ƒæ”¾å…¥ä½œä¸šåå¤‡é˜Ÿåˆ—ä¸­ã€‚ä½œä¸šæ­¤æ—¶çš„çŠ¶æ€ä¸º<strong>åå¤‡çŠ¶æ€</strong></li><li>è¿è¡Œé˜¶æ®µ<br> å½“ä½œä¸šè¢«ä½œä¸šè°ƒåº¦é€‰ä¸­åï¼Œå˜ä¸ºå®ƒåˆ†é…å¿…è¦çš„èµ„æºå’Œå»ºç«‹è¿›ç¨‹ï¼Œå¹¶å°†å®ƒæ”¾å…¥å°±ç»ªé˜Ÿåˆ—ã€‚ä¸€ä¸ªä½œä¸šä»ç¬¬ä¸€æ¬¡è¿›å…¥å°±ç»ªçŠ¶æ€å¼€å§‹ï¼ŒçŸ¥é“ä»–è¿è¡Œç»“æŸå‰ï¼Œéƒ½å¤„äº<strong>è¿è¡ŒçŠ¶æ€</strong></li><li>å®Œæˆé˜¶æ®µ<br> å½“ä½œä¸šè¿è¡Œå®Œæˆï¼Œæˆ–è€…å‘ç”Ÿå¼‚å¸¸æƒ…å†µæå‰ç»“æŸæ—¶ï¼Œä½œä¸šä¾¿è¿›å…¥å®Œæˆé˜¶æ®µï¼Œç›¸åº”çš„ä½œä¸šçŠ¶æ€ä¸ºâ€œå®ŒæˆçŠ¶æ€â€ã€‚</li></ol><h2 id="5-2-2-ä½œä¸šè°ƒåº¦çš„ä¸»è¦ä»»åŠ¡"><a href="#5-2-2-ä½œä¸šè°ƒåº¦çš„ä¸»è¦ä»»åŠ¡" class="headerlink" title="5.2.2 ä½œä¸šè°ƒåº¦çš„ä¸»è¦ä»»åŠ¡"></a>5.2.2 ä½œä¸šè°ƒåº¦çš„ä¸»è¦ä»»åŠ¡</h2><p>ä½œä¸šè°ƒåº¦çš„ä¸»è¦ä»»åŠ¡å°±æ˜¯æ ¹æ®JCBä¸­çš„å†…å®¹ï¼Œæ£€æŸ¥ç³»ç»Ÿä¸­çš„èµ„æºèƒ½å¦æ»¡è¶³ä½œä¸šå¯¹èµ„æºçš„éœ€æ±‚ï¼Œä»¥åŠæŒ‰ç…§ä¸€å®šçš„è°ƒåº¦ç®—æ³•ï¼Œä»å¤–å­˜çš„åå¤‡é˜Ÿåˆ—ä¸­é€‰å–æŸäº›ä½œä¸šè°ƒå…¥å†…å­˜ã€‚å¹¶ä¸ºå®ƒä»¬åˆ›å»ºè¿›ç¨‹ã€åˆ†é…å¿…è¦çš„èµ„æºã€‚ç„¶åå†å°†æ–°åˆ›å»ºçš„è¿›ç¨‹æ’åœ¨å°±ç»ªé˜Ÿåˆ—ä¸Šç­‰å¾…è°ƒåº¦ã€‚å› æ­¤ï¼Œä¹ŸæŠŠä½œä¸šè°ƒåº¦ç§°ä¸ºæ¥çº³è°ƒåº¦ã€‚åœ¨æ¯æ¬¡æ‰§è¡Œä½œä¸šè°ƒåº¦æ—¶ï¼Œéƒ½éœ€è¦åšå‡ºä»¥ä¸‹ä¸¤ä¸ªå†³å®šï¼š</p><ol><li>æ¥çº³å¤šå°‘ä¸ªä½œä¸š<br> åœ¨æ¯ä¸€æ¬¡ä½œä¸šè°ƒåº¦æ—¶ï¼Œåº”å½“ä»åå¤‡é˜Ÿåˆ—ä¸­é€‰å–å¤šå°‘ä½œä¸šè°ƒå…¥å†…å­˜ï¼Œå–å†³äºå¤šé“ç¨‹åºåº¦ï¼Œå³å…è®¸å¤šå°‘ä¸ªä½œä¸šåŒæ—¶åœ¨å†…å­˜ä¸­è¿è¡Œã€‚</li><li>æ¥çº³å“ªäº›ä½œä¸š<br> é€‰æ‹©å“ªäº›ä½œä¸šå–å†³äºï¼Œä½œä¸šè°ƒåº¦é‡‡ç”¨å“ªç§ç®—æ³•ã€‚</li></ol><h1 id="5-3-ä½œä¸šè°ƒåº¦ç®—æ³•"><a href="#5-3-ä½œä¸šè°ƒåº¦ç®—æ³•" class="headerlink" title="5.3 ä½œä¸šè°ƒåº¦ç®—æ³•"></a>5.3 ä½œä¸šè°ƒåº¦ç®—æ³•</h1><h2 id="5-3-1-å…ˆæ¥å…ˆæœåŠ¡ï¼ˆFCFSï¼‰ç®—æ³•ç®—æ³•"><a href="#5-3-1-å…ˆæ¥å…ˆæœåŠ¡ï¼ˆFCFSï¼‰ç®—æ³•ç®—æ³•" class="headerlink" title="5.3.1 å…ˆæ¥å…ˆæœåŠ¡ï¼ˆFCFSï¼‰ç®—æ³•ç®—æ³•"></a>5.3.1 å…ˆæ¥å…ˆæœåŠ¡ï¼ˆFCFSï¼‰ç®—æ³•ç®—æ³•</h2><p>å¯¹äºè¿™ä¸ªç®—æ³•ï¼Œå…«ä¸ªå­—â€”â€”ç®€å•ç²—æš´ï¼Œæ²¡å•¥å¯è®²ã€‚ä½ æ¥çš„æ—©æˆ‘å°±å…ˆæœåŠ¡ä½ ï¼Œå…¶ä»–äººä¸ç®¡å†ç‰›é€¼ä½ æ¥æ™šäº†ä½ å°±æ˜¯å¼Ÿå¼Ÿï¼Œä½ å¾—ç­‰æˆ‘å…ˆæŠŠå‰é¢è¿™ä½æœåŠ¡å¥½äº†å†æ¥æœåŠ¡ä½ ã€‚</p><h2 id="5-3-2-çŸ­ä½œä¸šä¼˜å…ˆï¼ˆSJFï¼‰è°ƒåº¦ç®—æ³•"><a href="#5-3-2-çŸ­ä½œä¸šä¼˜å…ˆï¼ˆSJFï¼‰è°ƒåº¦ç®—æ³•" class="headerlink" title="5.3.2 çŸ­ä½œä¸šä¼˜å…ˆï¼ˆSJFï¼‰è°ƒåº¦ç®—æ³•"></a>5.3.2 çŸ­ä½œä¸šä¼˜å…ˆï¼ˆSJFï¼‰è°ƒåº¦ç®—æ³•</h2><p>å¯¹äºè¿™ä¸ªç®—æ³•ï¼Œä»–ä¹Ÿæ˜¯åŸºäºå…ˆæ¥å…ˆæœåŠ¡ï¼Œåªæ˜¯å¤šäº†ä¸ªè€ƒè™‘èŒƒå›´ï¼Œå°±æ˜¯åŸåˆ™ä¸Šè¿˜æ˜¯å…ˆåˆ°å…ˆæœåŠ¡ï¼Œä½†æ˜¯å½“æœåŠ¡å®Œä¸€ä¸ªä¹‹åå¹¶ä¸”è¿˜æœ‰å¾ˆå¤šä¸ªå†ç­‰ç€è¢«æœåŠ¡æ—¶ï¼Œå°±ä»ä¸­æ‰¾ä¸€ä¸ªéœ€è¦æœåŠ¡æ—¶é—´æœ€çŸ­çš„å…ˆæ¥æœåŠ¡ï¼ŒæœåŠ¡å®Œä»–äº†ï¼Œåœ¨ä»å‰©ä¸‹çš„æ‰¾ä¸€ä¸ªæœ€çŸ­çš„æ¥æœåŠ¡ã€‚<br>è¿™ä¸ªç®—æ³•æœ‰å‡ ä¸ªç¼ºç‚¹ï¼š</p><ol><li>å¿…é¡»é¢„çŸ¥ä½œä¸šçš„è¿è¡Œæ—¶é—´</li><li>å¯¹é•¿ä½œä¸šå¾ˆä¸åˆ©</li><li>äººæœºæ— æ³•äº¤äº’</li><li>æ²¡æœ‰è€ƒè™‘ä½œä¸šæ‰§è¡Œçš„ç´§è¿«æ„Ÿï¼Œå¯¹æ€¥éœ€æœåŠ¡çš„ä½œä¸šä¸ç®¡</li></ol><h2 id="5-3-3-ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•ï¼ˆPSAï¼‰"><a href="#5-3-3-ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•ï¼ˆPSAï¼‰" class="headerlink" title="5.3.3 ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•ï¼ˆPSAï¼‰"></a>5.3.3 ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•ï¼ˆPSAï¼‰</h2><p>åœ¨ä¼˜å…ˆçº§ç®—æ³•ä¸­ï¼ŒåŸºäºä½œä¸šçš„ç´§è¿«ç¨‹åº¦ï¼Œå¤–éƒ¨ä¼šèµ‹äºˆè¿›ç¨‹çš„ä¼˜å…ˆçº§ï¼Œç„¶åä¼˜å…ˆçº§ç®—æ³•å°±æ ¹æ®ç®—æ³•çš„ä¼˜å…ˆçº§ï¼Œè¿›è¡Œè°ƒåº¦ã€‚ç®—æ³•å®è´¨ä¸Šç±»ä¼¼äºçŸ­ä½œä¸šä¼˜å…ˆï¼Œä½ ç”šè‡³å¯ä»¥æŠŠçŸ­ä½œä¸šä¼˜å…ˆçº§ç®—æ³•ä¹Ÿçœ‹åšæ˜¯ä¼˜å…ˆçº§ç®—æ³•ï¼Œåªä¸è¿‡ä»–çš„ä¼˜å…ˆçº§æ˜¯ä½œä¸šé•¿çŸ­ï¼Œè€Œä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•çš„ä¼˜å…ˆçº§æ˜¯è¿›ç¨‹çš„ç´§è¿«ç¨‹åº¦ã€‚</p><h2 id="5-3-4-é«˜å“åº”æ¯”ä¼˜å…ˆè°ƒåº¦ç®—æ³•ï¼ˆHRRNï¼‰"><a href="#5-3-4-é«˜å“åº”æ¯”ä¼˜å…ˆè°ƒåº¦ç®—æ³•ï¼ˆHRRNï¼‰" class="headerlink" title="5.3.4 é«˜å“åº”æ¯”ä¼˜å…ˆè°ƒåº¦ç®—æ³•ï¼ˆHRRNï¼‰"></a>5.3.4 é«˜å“åº”æ¯”ä¼˜å…ˆè°ƒåº¦ç®—æ³•ï¼ˆHRRNï¼‰</h2><p>FCFSç®—æ³•æ˜¯è€ƒè™‘äº†ä½œä¸šçš„ç­‰å¾…æ—¶é—´ï¼Œå´å¿½ç•¥çš„ä½œä¸šçš„è¿è¡Œæ—¶é—´ï¼›è€ŒSJFç®—æ³•æ˜¯åªè€ƒè™‘äº†ä½œä¸šçš„è¿è¡Œæ—¶é—´ï¼Œå´å¿½ç•¥äº†ä½œä¸šçš„ç­‰å¾…æ—¶é—´ã€‚é«˜å“åº”æ¯”ç®—æ³•æ˜¯åˆè€ƒè™‘è¿è¡Œæ—¶é—´åˆè€ƒè™‘ç­‰å¾…æ—¶é—´ï¼Œå› æ­¤æ—¢èƒ½ç…§é¡¾çŸ­ä½œä¸šï¼Œåˆä¸è‡´ä½¿é•¿ä½œä¸šçš„ç­‰å¾…æ—¶é—´è¿‡é•¿ã€‚</p><p>ä»–ä¸ºæ¯ä¸ªä½œä¸šå¼•å…¥äº†ä¸€ä¸ªåŠ¨æ€ä¼˜å…ˆçº§ï¼Œå³ä¼˜å…ˆçº§æ˜¯å¯ä»¥æ”¹å˜çš„ï¼Œå®ƒéšç€ç­‰å¾…æ—¶é—´çš„å»¶é•¿è€Œå¢åŠ ï¼Œè¿™ä½¿å¾—é•¿ä½œä¸šçš„ä¼˜å…ˆçº§åœ¨ç­‰å¾…æœŸé—´ä¸æ–­åœ°å¢åŠ ï¼Œç­‰åˆ°è¶³å¤Ÿçš„æ—¶é—´åï¼Œå¿…ç„¶æœ‰æœºä¼šè·å¾—å¤„ç†æœºã€‚è¿™ä¸ªå˜åŒ–è§„å¾‹å¯æè¿°ä¸ºï¼š</p><script type="math/tex; mode=display">ä¼˜å…ˆçº§=\frac{ç­‰å¾…æ—¶é—´+è¦æ±‚æœåŠ¡æ—¶é—´}{è¦æ±‚æœåŠ¡æ—¶é—´}</script><p>ç”±äºç­‰å¾…æ—¶é—´ä¸æœåŠ¡æ—¶é—´ä¹‹å’Œå°±æ˜¯ç³»ç»Ÿå¯¹è¯¥ä½œä¸šçš„å“åº”æ—¶é—´ï¼Œæ•…è¯¥ä¼˜å…ˆçº§åˆç›¸å½“äºå“åº”æ¯”$R_p$ã€‚æ‰€ä»¥ï¼Œä¼˜å…ˆçº§åˆå¯è¡¨ç¤ºä¸ºï¼š<script type="math/tex">R_p=\frac{ç­‰å¾…æ—¶é—´+è¦æ±‚æœåŠ¡æ—¶é—´}{è¦æ±‚æœåŠ¡æ—¶é—´}=\frac{å“åº”æ—¶é—´}{è¦æ±‚æœåŠ¡æ—¶é—´}</script></p><p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡º</p><ol><li>å¦‚æœä½œä¸šçš„ç­‰å¾…æ—¶é—´ç›¸åŒï¼Œåˆ™è¦æ±‚æœåŠ¡çš„æ—¶é—´è¶ŠçŸ­ï¼Œä¼˜å…ˆçº§è¶Šé«˜</li><li>å½“è¦æ±‚æœåŠ¡æ—¶é—´ç›¸åŒæ—¶ï¼Œä½œä¸šçš„ä¼˜å…ˆçº§å†³å®šäºå…¶ç­‰å¾…æ—¶é—´</li><li>å¯¹äºé•¿ä½œä¸šçš„ä¼˜å…ˆçº§ï¼Œå¯ä»¥éšç­‰å¾…æ—¶é—´çš„å¢åŠ è€Œæé«˜</li></ol><h1 id="5-4-è¿›ç¨‹è°ƒåº¦"><a href="#5-4-è¿›ç¨‹è°ƒåº¦" class="headerlink" title="5.4 è¿›ç¨‹è°ƒåº¦"></a>5.4 è¿›ç¨‹è°ƒåº¦</h1><h2 id="5-4-1-è¿›ç¨‹è°ƒåº¦çš„ä»»åŠ¡ã€æœºåˆ¶å’Œæ–¹å¼"><a href="#5-4-1-è¿›ç¨‹è°ƒåº¦çš„ä»»åŠ¡ã€æœºåˆ¶å’Œæ–¹å¼" class="headerlink" title="5.4.1 è¿›ç¨‹è°ƒåº¦çš„ä»»åŠ¡ã€æœºåˆ¶å’Œæ–¹å¼"></a>5.4.1 è¿›ç¨‹è°ƒåº¦çš„ä»»åŠ¡ã€æœºåˆ¶å’Œæ–¹å¼</h2><h3 id="5-4-1-1-è¿›ç¨‹è°ƒåº¦çš„ä»»åŠ¡"><a href="#5-4-1-1-è¿›ç¨‹è°ƒåº¦çš„ä»»åŠ¡" class="headerlink" title="5.4.1.1 è¿›ç¨‹è°ƒåº¦çš„ä»»åŠ¡"></a>5.4.1.1 è¿›ç¨‹è°ƒåº¦çš„ä»»åŠ¡</h3><ol><li>ä¿å­˜å¤„ç†æœºçš„ç°åœºä¿¡æ¯<br> åœ¨è¿›è¡Œè°ƒåº¦æ—¶é¦–å…ˆéœ€è¦ä¿å­˜å½“å‰è¿›ç¨‹å¤„ç†æœºçš„ç°åœºä¿¡æ¯ã€‚</li><li>æŒ‰æŸç§ç®—æ³•é€‰å–è¿›ç¨‹<br> è°ƒåº¦ç¨‹åºæŒ‰æŸç§ç®—æ³•ä»å°±ç»ªé˜Ÿåˆ—ä¸­é€‰å–ä¸€ä¸ªè¿›ç¨‹ï¼Œå°†å…¶çŠ¶æ€æ”¹ä¸ºè¿è¡ŒçŠ¶æ€ï¼Œå¹¶å‡†å¤‡æŠŠå¤„ç†æœºåˆ†é…ç»™ä»–ã€‚</li><li>æŠŠå¤„ç†æœºåˆ†é…ç»™è¿›ç¨‹<br> ç”±åˆ†æ´¾ç¨‹åºæŠŠå¤„ç†å™¨åˆ†é…ç»™è¯¥è¿›ç¨‹ï¼Œæ­¤æ—¶éœ€è¦å°†é€‰ä¸­è¿›ç¨‹çš„è¿›ç¨‹æ§åˆ¶å—å†…æœ‰å…³å¤„ç†æœºç°åœºçš„ä¿¡æ¯è£…å…¥å¤„ç†å™¨ç›¸åº”çš„å„ä¸ªå¯„å­˜å™¨ä¸­ï¼ŒæŠŠå¤„ç†å™¨çš„æ§åˆ¶æƒäº¤äºˆè¯¥è¿›ç¨‹ï¼Œè®©å®ƒä»ä¸Šæ¬¡çš„æ–­ç‚¹å¤„æ¢å¤è¿è¡Œã€‚</li></ol><h3 id="5-4-1-2-è¿›ç¨‹è°ƒåº¦æœºåˆ¶"><a href="#5-4-1-2-è¿›ç¨‹è°ƒåº¦æœºåˆ¶" class="headerlink" title="5.4.1.2 è¿›ç¨‹è°ƒåº¦æœºåˆ¶"></a>5.4.1.2 è¿›ç¨‹è°ƒåº¦æœºåˆ¶</h3><p>ä¸ºäº†å®ç°è¿›ç¨‹è°ƒåº¦ï¼Œåœ¨è¿›ç¨‹è°ƒåº¦æœºåˆ¶ä¸­ï¼Œåº”å…·æœ‰å¦‚ä¸‹ä¸‰ä¸ªåŸºæœ¬éƒ¨åˆ†ï¼š<br><img src="https://cdn.littlecorgi.top/mweb/è¿›ç¨‹è°ƒåº¦æœºåˆ¶.jpg" alt="è¿›ç¨‹è°ƒåº¦æœºåˆ¶"></p><ol><li>æ’é˜Ÿå™¨<br>ä¸ºäº†æé«˜è¿›ç¨‹è°ƒåº¦çš„æ•ˆç‡ï¼Œåº”äº‹å…ˆå°†ç³»ç»Ÿä¸­çš„æ‰€æœ‰å°±ç»ªè¿›ç¨‹æŒ‰ç…§ä¸€å®šçš„ç­–ç•¥æ’æˆä¸€ä¸ªæˆ–å¤šä¸ªé˜Ÿåˆ—ï¼Œä»¥ä¾¿è°ƒåº¦ç¨‹åºèƒ½æœ€å¿«çš„æ‰¾åˆ°å®ƒã€‚</li><li>åˆ†æ´¾å™¨<br>åˆ†æ´¾å™¨ä¾æ®è¿›ç¨‹è°ƒåº¦ç¨‹åºæ‰€é€‰å®šçš„è¿›ç¨‹ï¼Œå°†å…¶ä»å°±ç»ªé˜Ÿåˆ—ä¸­å–å‡ºï¼Œç„¶åè¿›è¡Œä»åˆ†æ´¾å™¨åˆ°æ–°é€‰å‡ºè¿›ç¨‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå°†å¤„ç†æœºåˆ†é…ç»™æ–°é€‰å‡ºçš„è¿›ç¨‹ã€‚</li><li>ä¸Šä¸‹æ–‡åˆ‡æ¢å™¨<br>åœ¨å¯¹å¤„ç†æœºè¿›è¡Œåˆ‡æ¢æ—¶ï¼Œä¼šå‘ç”Ÿä¸¤å¯¹ä¸Šä¸‹æ–‡çš„åˆ‡æ¢æ“ä½œ<ol><li>å¯¹ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶ï¼ŒOSå°†ä¿å­˜å½“å‰è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œå³æŠŠå½“å‰è¿›ç¨‹çš„å¤„ç†æœºå¯„å­˜å™¨çš„å†…å®¹ä¿å­˜åˆ°è¯¥è¿›ç¨‹çš„è¿›ç¨‹æ§åˆ¶å—ä¸­çš„ç›¸åº”å•å…ƒï¼Œå†è£…å…¥åˆ†æ´¾ç¨‹åºçš„ä¸Šä¸‹æ–‡ï¼Œä»¥ä¾¿åˆ†æ´¾ç¨‹åºè¿è¡Œ</li><li>å¯¹ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯ç§»é™¤åˆ†æ´¾ç¨‹åºçš„ä¸Šä¸‹æ–‡ï¼Œè€ŒæŠŠæ–°é€‰è¿›ç¨‹çš„CPUç°åœºä¿¡æ¯è£…å…¥åˆ°å¤„ç†æœºçš„å„ä¸ªç›¸åº”å¯„å­˜å™¨ä¸­ï¼Œä»¥ä¾¿æ–°é€‰è¿›ç¨‹è¿è¡Œ</li></ol></li></ol><h3 id="5-4-1-3-è¿›ç¨‹è°ƒåº¦æ–¹å¼"><a href="#5-4-1-3-è¿›ç¨‹è°ƒåº¦æ–¹å¼" class="headerlink" title="5.4.1.3 è¿›ç¨‹è°ƒåº¦æ–¹å¼"></a>5.4.1.3 è¿›ç¨‹è°ƒåº¦æ–¹å¼</h3><ol><li>éæŠ¢å æ–¹å¼<br> åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œä¸€æ—¦å¤„ç†æœºåˆ†æ´¾ç»™ä¸€ä¸ªè¿›ç¨‹åï¼Œå°±ä¸€æ¬¡æ€§ä¸€ç›´å¤„ç†ä¸‹å»ï¼Œç›´åˆ°è¯¥è¿›ç¨‹è¢«å¤„ç†å®Œã€‚</li><li>æŠ¢å æ–¹å¼<br> è¿™ç§è°ƒåº¦æ–¹å¼å…è®¸è°ƒåº¦ç¨‹åºæ ¹æ®æŸç§åŸåˆ™ï¼Œå»æš‚åœæŸä¸ªæ­£åœ¨æ‰§è¡Œçš„ç¨‹åºï¼Œå°†å·²åˆ†é…ç»™è¯¥è¿›ç¨‹çš„å¤„ç†æœºé‡æ–°åˆ†é…ç»™å¦ä¸€è¿›ç¨‹ã€‚<br> å®ƒéµå¾ªçš„ä¸»è¦åŸåˆ™æœ‰ï¼š<ol><li>ä¼˜å…ˆæƒåŸåˆ™ï¼Œä¼˜å…ˆçº§é«˜çš„æ–°åˆ°è¿›ç¨‹æŠ¢å æ­£åœ¨è¿è¡Œçš„ä¼˜å…ˆçº§ä½çš„è¿›ç¨‹</li><li>çŸ­è¿›ç¨‹ä¼˜å…ˆåŸåˆ™ï¼Œéœ€è¦è¿è¡Œæ—¶é—´æ›´çŸ­çš„æ–°åˆ°è¿›ç¨‹æŠ¢å æ­£åœ¨è¿è¡Œçš„éœ€è¦è¿è¡Œæ—¶é—´æ›´é•¿çš„è¿›ç¨‹</li><li>æ—¶é—´ç‰‡åŸåˆ™ï¼Œå„è¿›ç¨‹æŒ‰æ—¶é—´ç‰‡è½®è½¬è¿è¡Œï¼Œå½“æ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹çš„ä¸€ä¸ªæ—¶é—´ç‰‡ç”¨å®Œåï¼Œä¾¿åœæ­¢è¯¥è¿›ç¨‹çš„æ‰§è¡Œè€Œé‡æ–°è¿›è¡Œè°ƒåº¦</li></ol></li></ol><h2 id="5-4-2-è½®è½¬è°ƒåº¦ç®—æ³•"><a href="#5-4-2-è½®è½¬è°ƒåº¦ç®—æ³•" class="headerlink" title="5.4.2 è½®è½¬è°ƒåº¦ç®—æ³•"></a>5.4.2 è½®è½¬è°ƒåº¦ç®—æ³•</h2><p>åœ¨åˆ†æ—¶ç³»ç»Ÿä¸­ï¼Œæœ€å¸¸ç”¨ä¹Ÿæ˜¯æœ€ç®€å•çš„å°±æ˜¯åŸºäºæ—¶é—´ç‰‡çš„è½®è½¬è°ƒåº¦ç®—æ³•ã€‚è¯¥ç®—æ³•é‡‡å–äº†éå¸¸å…¬å¹³çš„å¤„ç†æœºåˆ†é…æ–¹å¼ï¼Œå³è®©å°±ç»ªé˜Ÿåˆ—ä¸Šæ¯ä¸ªè¿›ç¨‹æ¯æ¬¡ä»…è¿è¡Œä¸€ä¸ªæ—¶é—´ç‰‡ã€‚nä¸ªè¿›ç¨‹æ¯ä¸ªéƒ½è¿è¡Œ$\frac{1}{n}$çš„å¤„ç†æœºæ—¶é—´ã€‚</p><h3 id="5-4-2-1-åŸºæœ¬åŸç†"><a href="#5-4-2-1-åŸºæœ¬åŸç†" class="headerlink" title="5.4.2.1 åŸºæœ¬åŸç†"></a>5.4.2.1 åŸºæœ¬åŸç†</h3><p>åœ¨RRç®—æ³•ä¸­ï¼Œç³»ç»Ÿæ ¹æ®FCFSç­–ç•¥ï¼Œå°†æ‰€æœ‰çš„å°±ç»ªè¿›ç¨‹æ’æˆä¸€ä¸ªå°±ç»ªé˜Ÿåˆ—ï¼Œå¹¶å¯è®¾ç½®æ¯éš”ä¸€å®šæ—¶é—´é—´éš”å³äº§ç”Ÿä¸€æ¬¡ä¸­æ–­ï¼Œæ¿€æ´»ç³»ç»Ÿä¸­çš„è¿›ç¨‹è°ƒåº¦ç¨‹åºï¼Œå®Œæˆä¸€æ¬¡è°ƒåº¦ï¼Œå°†CPUåˆ†é…ç»™é˜Ÿé¦–è¿›ç¨‹ï¼Œä»¤å…¶æ‰§è¡Œã€‚</p><h3 id="5-4-2-2-è¿›ç¨‹åˆ‡æ¢æ—¶æœº"><a href="#5-4-2-2-è¿›ç¨‹åˆ‡æ¢æ—¶æœº" class="headerlink" title="5.4.2.2 è¿›ç¨‹åˆ‡æ¢æ—¶æœº"></a>5.4.2.2 è¿›ç¨‹åˆ‡æ¢æ—¶æœº</h3><ol><li>å¦‚æœä¸€ä¸ªæ—¶é—´ç‰‡å°šæœªç”¨å®Œä½†æ˜¯æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹å·²ç»å®Œæˆï¼Œæ­¤æ—¶å¯ä»¥åˆ‡æ¢</li><li>åœ¨ä¸€ä¸ªæ—¶é—´ç‰‡ç”¨å®Œï¼Œæ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹è¿˜æœªæ‰§è¡Œå®Œæˆï¼Œè¿™æ—¶ä¹Ÿå¯ä»¥åˆ‡æ¢</li></ol><h3 id="5-4-2-3-æ—¶é—´ç‰‡å¤§å°çš„ç¡®å®š"><a href="#5-4-2-3-æ—¶é—´ç‰‡å¤§å°çš„ç¡®å®š" class="headerlink" title="5.4.2.3 æ—¶é—´ç‰‡å¤§å°çš„ç¡®å®š"></a>5.4.2.3 æ—¶é—´ç‰‡å¤§å°çš„ç¡®å®š</h3><p>åœ¨RRç®—æ³•ä¸­ï¼Œæ—¶é—´ç‰‡çš„å¤§å°å¯¹ç³»ç»Ÿæ€§èƒ½æœ‰å¾ˆå¤§çš„å½±å“ã€‚<br>å¦‚æœé€‰æ‹©å¾ˆå°çš„æ—¶é—´ç‰‡ï¼Œæœ‰åˆ©äºçŸ­ä½œä¸šï¼Œå› ä¸ºä»–èƒ½åœ¨è¯¥æ—¶é—´ç‰‡å†…å®Œæˆï¼Œä½†æ—¶é—´ç‰‡å°ï¼Œæ„å‘³ç€ä¼šé¢‘ç¹è°ƒåº¦ï¼Œè¿™æ— ç–‘ä¼šå¢åŠ ç³»ç»Ÿå¼€é”€ã€‚<br><img src="https://cdn.littlecorgi.top/mweb/æ—¶é—´ç‰‡å°äºäº¤äº’æ—¶é—´.jpg" alt="æ—¶é—´ç‰‡å°äºäº¤äº’æ—¶é—´"></p><p>å¦‚æœæ—¶é—´ç‰‡é€‰æ‹©å¤ªé•¿ï¼Œè¿™æ ·çš„è¯RRå¯èƒ½ä¼šé€€åŒ–æˆFCFSï¼Œæ— æ³•æ»¡è¶³çŸ­ä½œä¸šå’Œäº¤äº’å¼ç”¨æˆ·çš„éœ€æ±‚ã€‚<br><img src="https://cdn.littlecorgi.top/mweb/æ—¶é—´ç‰‡å¤§äºäº¤äº’æ—¶é—´.jpg" alt="æ—¶é—´ç‰‡å¤§äºäº¤äº’æ—¶é—´"></p><h2 id="5-4-3-ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•"><a href="#5-4-3-ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•" class="headerlink" title="5.4.3 ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•"></a>5.4.3 ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•</h2><p>åœ¨RRç®—æ³•ä¸­ï¼Œæˆ‘ä»¬å‡è®¾äº†æ‰€æœ‰è¿›ç¨‹çš„ç´§è¿«æ€§æ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯å®é™…æƒ…å†µå¹¶éå¦‚æ­¤ã€‚æˆ‘ä»¬ä¸ºäº†æ»¡è¶³å®é™…æƒ…å†µï¼Œåœ¨è¿›ç¨‹è°ƒåº¦ç®—æ³•ä¸­å¼•å…¥äº†ä¼˜å…ˆçº§ï¼Œè€Œå½¢æˆçš„ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•ã€‚</p><h3 id="5-4-3-1-ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•çš„ç±»å‹"><a href="#5-4-3-1-ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•çš„ç±»å‹" class="headerlink" title="5.4.3.1 ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•çš„ç±»å‹"></a>5.4.3.1 ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•çš„ç±»å‹</h3><ol><li>éæŠ¢å å¼ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•</li><li>æŠ¢å å¼ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•</li></ol><p>è¿™å—å’Œå‰é¢è°ƒåº¦ç®—æ³•æ–¹å¼ä¸€æ ·ï¼Œåœ¨æ­¤å°±ä¸å¤šè¯´ã€‚</p><h3 id="5-4-3-2-ä¼˜å…ˆçº§ç±»å‹"><a href="#5-4-3-2-ä¼˜å…ˆçº§ç±»å‹" class="headerlink" title="5.4.3.2 ä¼˜å…ˆçº§ç±»å‹"></a>5.4.3.2 ä¼˜å…ˆçº§ç±»å‹</h3><h4 id="5-4-3-2-1-é™æ€ä¼˜å…ˆçº§"><a href="#5-4-3-2-1-é™æ€ä¼˜å…ˆçº§" class="headerlink" title="5.4.3.2.1 é™æ€ä¼˜å…ˆçº§"></a>5.4.3.2.1 é™æ€ä¼˜å…ˆçº§</h4><p>é™æ€ä¼˜å…ˆçº§æ˜¯åœ¨åˆ›å»ºè¿›ç¨‹æ—¶ç¡®å®šçš„ï¼Œåœ¨è¿›ç¨‹çš„æ•´ä¸ªè¿è¡ŒæœŸé—´ä¿æŒä¸å˜ã€‚ä¼˜å…ˆçº§æ˜¯åˆ©ç”¨æŸä¸€èŒƒå›´å†…çš„ä¸€ä¸ªæ•´æ•°æ¥è¡¨ç¤ºçš„ã€‚ç¡®å®šè¿›ç¨‹ä¼˜å…ˆçº§å¤§å°çš„ä¾æ®æœ‰å¦‚ä¸‹ä¸‰ä¸ªï¼š</p><ol><li>è¿›ç¨‹ç±»å‹ï¼Œé€šå¸¸ç³»ç»Ÿè¿›ç¨‹çš„ä¼˜å…ˆçº§ä¸€èˆ¬é«˜äºç”¨æˆ·è¿›ç¨‹ã€‚</li><li>è¿›ç¨‹å¯¹èµ„æºçš„éœ€æ±‚ï¼Œå¯¹èµ„æºè¦æ±‚è¾ƒå°‘çš„è¿›ç¨‹åº”èµ‹äºˆè¾ƒé«˜çš„ä¼˜å…ˆçº§ã€‚</li><li>ç”¨æˆ·è¦æ±‚ï¼Œæ ¹æ®è¿›ç¨‹çš„ç´§è¿«ç¨‹åº¦åŠç”¨æˆ·æ‰€ä»˜è´¹ç”¨çš„å¤šå°‘ç¡®å®šä¼˜å…ˆçº§ã€‚</li></ol><p>é™æ€ä¼˜å…ˆçº§æ³•ç®€å•æ˜“è¡Œï¼Œç³»ç»Ÿå¼€é”€å°ï¼Œä½†æ˜¯ä¸å¤Ÿç²¾ç¡®ï¼Œå¯èƒ½ä¼šå‡ºç°ä¼˜å…ˆçº§ä½çš„è¿›ç¨‹é•¿æœŸæ²¡æœ‰è¢«è°ƒåº¦çš„æƒ…å†µã€‚</p><h4 id="5-4-3-2-2-åŠ¨æ€ä¼˜å…ˆçº§"><a href="#5-4-3-2-2-åŠ¨æ€ä¼˜å…ˆçº§" class="headerlink" title="5.4.3.2.2 åŠ¨æ€ä¼˜å…ˆçº§"></a>5.4.3.2.2 åŠ¨æ€ä¼˜å…ˆçº§</h4><p>åŠ¨æ€ä¼˜å…ˆçº§æ˜¯æŒ‡è¿›ç¨‹åˆ›å»ºä¹‹åˆï¼Œå…ˆèµ‹äºˆä¸€ä¸ªä¼˜å…ˆçº§ï¼Œç„¶åæ ¹æ®è¿›ç¨‹çš„æ¨è¿›æˆ–ç­‰å¾…æ—¶é—´çš„å¢åŠ è€Œæ”¹å˜ï¼Œä»¥ä¾¿è·å¾—æ›´å¥½çš„è°ƒåº¦æ€§èƒ½ã€‚</p><h2 id="5-4-4-å¤šé˜Ÿåˆ—è°ƒåº¦ç®—æ³•"><a href="#5-4-4-å¤šé˜Ÿåˆ—è°ƒåº¦ç®—æ³•" class="headerlink" title="5.4.4 å¤šé˜Ÿåˆ—è°ƒåº¦ç®—æ³•"></a>5.4.4 å¤šé˜Ÿåˆ—è°ƒåº¦ç®—æ³•</h2><p>ä¹‹å‰æ‰€è¿°çš„å„ç§è°ƒåº¦ç®—æ³•ï¼Œåœ¨åº”ç”¨äºè¿›ç¨‹è°ƒåº¦æ—¶ï¼Œç”±äºç³»ç»Ÿä¸­ä»…è®¾ç½®ä¸€ä¸ªè¿›ç¨‹çš„å°±ç»ªé˜Ÿåˆ—ï¼Œå³ä½çº§è°ƒåº¦çš„ç®—æ³•æ˜¯å•ä¸€çš„ï¼Œå›ºå®šçš„ï¼Œæ— æ³•æ»¡è¶³ç³»ç»Ÿä¸­ä¸åŒç”¨æˆ·å¯¹è¿›ç¨‹è°ƒåº¦ç­–ç•¥çš„ä¸åŒè¦æ±‚ï¼Œåœ¨å¤šå¤„ç†æœºç³»ç»Ÿä¸­ï¼Œè¿™ç§å•ä¸€è°ƒåº¦ç­–ç•¥å®ç°æœºåˆ¶ç¼ºç‚¹æ›´åŠ æ˜æ˜¾ã€‚å› æ­¤å¤šçº§é˜Ÿåˆ—ç®—æ³•èƒ½å¤Ÿåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¼¥è¡¥è¿™ä¸€ç¼ºç‚¹ã€‚</p><p>å¤šçº§é˜Ÿåˆ—ç®—æ³•å°†è¿›ç¨‹å°±ç»ªé˜Ÿåˆ—æ‹†åˆ†æˆè‹¥å¹²ä¸ªï¼Œä¸åŒçš„å°±ç»ªé˜Ÿåˆ—é‡‡ç”¨ä¸åŒçš„è°ƒåº¦ç®—ç®—æ³•ï¼Œæ‰€ä»¥å¯ä»¥å¾ˆå¥½çš„æ»¡è¶³ä¸åŒç”¨æˆ·å¯¹è¿›ç¨‹è°ƒåº¦ç­–ç•¥çš„ä¸åŒéœ€æ±‚ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥æ»¡è¶³å¤šå¤„ç†æœºç³»ç»Ÿçš„éœ€æ±‚ã€‚</p><h2 id="5-4-5-å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•"><a href="#5-4-5-å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•" class="headerlink" title="5.4.5 å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•"></a>5.4.5 å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•</h2><p>å‰é¢çš„ç®—æ³•éƒ½æœ‰ä¸€å®šçš„å±€é™æ€§ï¼Œå¦‚æœæœªæŒ‡æ˜è¿›ç¨‹é•¿åº¦ï¼Œåˆ™çŸ­è¿›ç¨‹ä¼˜å…ˆå’ŒåŸºäºè¿›ç¨‹é•¿åº¦çš„æŠ¢å å¼è°ƒåº¦ç®—æ³•éƒ½å°†æ— æ³•ä½¿ç”¨ã€‚è€Œä¸‹è¿°çš„å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•åˆ™ä¸å¿…äº‹å…ˆçŸ¥é“å„ç§è¿›ç¨‹æ‰€éœ€çš„æ‰§è¡Œæ—¶é—´ï¼Œè¿˜å¯ä»¥å¾ˆå¥½åœ°æ»¡è¶³å„ç§ç±»å‹è¿›ç¨‹çš„éœ€è¦ï¼Œå› è€Œä»–æ˜¯ç›®å‰å…¬è®¤çš„ä¸€ç§è¾ƒå¥½çš„è¿›ç¨‹è°ƒåº¦ç®—æ³•ã€‚</p><h3 id="5-4-5-1-è°ƒåº¦æœºåˆ¶"><a href="#5-4-5-1-è°ƒåº¦æœºåˆ¶" class="headerlink" title="5.4.5.1 è°ƒåº¦æœºåˆ¶"></a>5.4.5.1 è°ƒåº¦æœºåˆ¶</h3><ol><li><p>è®¾ç½®å¤šä¸ªå°±ç»ªé˜Ÿåˆ—ã€‚åœ¨ç³»ç»Ÿä¸­è®¾ç½®å¤šä¸ªå°±ç»ªé˜Ÿåˆ—ï¼Œå¹¶æœªæ¯ä¸ªé˜Ÿåˆ—èµ‹äºˆä¸åŒçš„ä¼˜å…ˆçº§ã€‚ç¬¬ä¸€ä¸ªé˜Ÿåˆ—çš„ä¼˜å…ˆçº§æœ€é«˜ï¼Œç¬¬äºŒæ¬¡ä¹‹ï¼Œå…¶ä½™é˜Ÿåˆ—çš„ä¼˜å…ˆçº§é€ä¸ªé™ä½ã€‚è¯¥ç®—æ³•ä¸ºä¸åŒé˜Ÿåˆ—ä¸­çš„è¿›ç¨‹æ‰€èµ‹äºˆçš„æ‰§è¡Œæ—¶é—´ç‰‡çš„å¤§å°ä¹Ÿä¸åŒï¼Œåœ¨ä¼˜å…ˆçº§è¶Šé«˜çš„é˜Ÿåˆ—ä¸­æ—¶é—´ç‰‡è¶Šå°ã€‚<br><img src="https://cdn.littlecorgi.top/mweb/å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•.jpg" alt="å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•"></p></li><li><p>æ¯ä¸ªé˜Ÿåˆ—éƒ½é‡‡ç”¨FCFSç®—æ³•ã€‚å½“æ–°è¿›ç¨‹è¿›å…¥å†…å­˜åï¼Œé¦–å…ˆå°†å®ƒæ”¾å…¥ç¬¬ä¸€é˜Ÿåˆ—çš„æœ«å°¾ï¼ŒæŒ‰FCFSåŸåˆ™ç­‰å¾…è°ƒåº¦ã€‚å½“è½®åˆ°è¯¥è¿›ç¨‹æ—¶ï¼Œå¦‚ä»–èƒ½åœ¨æ—¶é—´ç‰‡å†…å®Œæˆï¼Œä¾¿å¯æ’¤ç¦»ç³»ç»Ÿï¼Œå¦åˆ™ï¼Œä»–åœ¨ä¸€ä¸ªæ—¶é—´ç‰‡ç»“æŸè¿˜æœªå®Œæˆæ—¶ï¼Œè½¬å…¥ç¬¬äºŒé˜Ÿåˆ—æœ«å°¾ç­‰å¾…ï¼Œä¾æ¬¡ç±»æ¨ã€‚</p></li><li>æŒ‰é˜Ÿåˆ—ä¼˜å…ˆçº§è°ƒåº¦ï¼Œé¦–å…ˆè°ƒåº¦æœ€é«˜ä¼˜å…ˆçº§é˜Ÿåˆ—ä¸­çš„è¯¸è¿›ç¨‹è¿è¡Œï¼Œä»…å½“ç¬¬ä¸€é˜Ÿåˆ—ç©ºé—²æ—¶æ‰è°ƒåº¦ç¬¬äºŒé˜Ÿåˆ—ã€‚</li></ol><h3 id="5-4-5-2-è°ƒåº¦ç®—æ³•çš„æ€§èƒ½"><a href="#5-4-5-2-è°ƒåº¦ç®—æ³•çš„æ€§èƒ½" class="headerlink" title="5.4.5.2 è°ƒåº¦ç®—æ³•çš„æ€§èƒ½"></a>5.4.5.2 è°ƒåº¦ç®—æ³•çš„æ€§èƒ½</h3><p>åœ¨å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•ä¸­ï¼Œå¦‚æœè§„å®šç¬¬ä¸€ä¸ªé˜Ÿåˆ—çš„æ—¶é—´ç‰‡ç•¥å¤§äºå¤šæ•°äººæœºäº¤äº’ç³»ç»Ÿæ‰€éœ€å¤„ç†æ—¶é—´æ—¶ï¼Œä¾¿èƒ½è¾ƒå¥½çš„æ»¡è¶³å„ç§ç±»å‹ç”¨æˆ·çš„éœ€è¦ã€‚ </p><h2 id="5-4-6-åŸºäºå…¬å¹³åŸåˆ™çš„è°ƒåº¦ç®—æ³•"><a href="#5-4-6-åŸºäºå…¬å¹³åŸåˆ™çš„è°ƒåº¦ç®—æ³•" class="headerlink" title="5.4.6 åŸºäºå…¬å¹³åŸåˆ™çš„è°ƒåº¦ç®—æ³•"></a>5.4.6 åŸºäºå…¬å¹³åŸåˆ™çš„è°ƒåº¦ç®—æ³•</h2><h3 id="5-4-6-1-ä¿è¯è°ƒåº¦ç®—æ³•"><a href="#5-4-6-1-ä¿è¯è°ƒåº¦ç®—æ³•" class="headerlink" title="5.4.6.1 ä¿è¯è°ƒåº¦ç®—æ³•"></a>5.4.6.1 ä¿è¯è°ƒåº¦ç®—æ³•</h3><p>ä¿è¯è°ƒåº¦ç®—æ³•æ˜¯å¦ä¸€ç§ç±»å‹çš„è°ƒåº¦ç®—æ³•ï¼Œå®ƒæƒ³ç”¨æˆ·æ‰€ä½œå‡ºçš„ä¿è¯å¹¶ä¸æ˜¯ä¼˜å…ˆè¿è¡Œï¼Œè€Œæ˜¯æ˜ç¡®çš„æ€§èƒ½ä¿è¯ï¼Œè¯¥ç®—æ³•å¯ä»¥åšåˆ°è°ƒåº¦çš„å…¬å¹³æ€§ã€‚ä¸€ç§æ¯”è¾ƒå®¹æ˜“çš„æ€§èƒ½ä¿è¯æ˜¯å¤„ç†æœºçš„å…¬å¹³æ€§ï¼Œå¦‚æœåœ¨ç³»ç»Ÿä¸­æœ‰nä¸ªç±»å‹ç›¸åŒçš„è¿›ç¨‹åŒæ—¶è¿è¡Œï¼Œä¸ºäº†å…¬å¹³æœŸé—´ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½è·å¾—ç›¸åŒçš„å¤„ç†æœºæ—¶é—´$\frac{1}{n}$ã€‚</p><p>åœ¨å®æ–½ä¿è¯è°ƒåº¦ç®—æ³•æ—¶ï¼Œç³»ç»Ÿå¿…é¡»å…·å¤‡è¿™æ ·ä¸€äº›åŠŸèƒ½ï¼š</p><ol><li>è·Ÿè¸ªè®¡ç®—æ¯ä¸ªè¿›ç¨‹è‡ªåˆ›å»ºä»¥æ¥å·²ç»æ‰§è¡Œçš„å¤„ç†æ—¶é—´ã€‚</li><li>è®¡ç®—æ¯ä¸ªè¿›ç¨‹åº”è·å¾—çš„å¤„ç†æœºæ—¶é—´ï¼Œå³è‡ªåˆ›å»ºä»¥æ¥çš„æ—¶é—´é™¤ä»¥nã€‚</li><li>è®¡ç®—è¿›ç¨‹è·å¾—å¤„ç†æœºæ—¶é—´çš„æ¯”ç‡ï¼Œå³è¿›ç¨‹å®é™…æ‰§è¡Œçš„å¤„ç†æ—¶é—´å’Œåº”è·å¾—çš„å¤„ç†æœºæ—¶é—´ä¹‹æ¯”ã€‚</li><li>æ¯”è¾ƒå„è¿›ç¨‹è·å¾—å¤„ç†æœºæ—¶é—´çš„æ¯”ç‡ã€‚å¦‚è¿›ç¨‹Açš„æ¯”ç‡æœ€ä½ï¼Œä¸º0.5ï¼Œè€Œè¿›ç¨‹Bçš„æ¯”ç‡ä¸º0.8ï¼Œè¿›ç¨‹Cçš„æ¯”ç‡ä¸º1.2ç­‰ã€‚</li><li>è°ƒåº¦ç¨‹åºåº”é€‰æ‹©æ¯”ç‡æœ€å°çš„è¿›ç¨‹å°†å¤„ç†æœºåˆ†é…ç»™å®ƒï¼Œå¹¶è®©è¯¥è¿›ç¨‹ä¸€ç›´è¿è¡Œï¼Œç›´åˆ°è¶…è¿‡æœ€æ¥è¿‘å®ƒçš„è¿›ç¨‹æ¯”ç‡ä¸ºæ­¢ã€‚</li></ol><h3 id="5-4-6-2-å…¬å¹³åˆ†äº«è°ƒåº¦ç®—æ³•"><a href="#5-4-6-2-å…¬å¹³åˆ†äº«è°ƒåº¦ç®—æ³•" class="headerlink" title="5.4.6.2 å…¬å¹³åˆ†äº«è°ƒåº¦ç®—æ³•"></a>5.4.6.2 å…¬å¹³åˆ†äº«è°ƒåº¦ç®—æ³•</h3><p>åˆ†é…ç»™æ¯ä¸ªè¿›ç¨‹ç›¸åŒçš„å¤„ç†æœºæ—¶é—´ï¼Œæ˜¾ç„¶ï¼Œè¿™å¯¹è¯¸è¿›ç¨‹è€Œè¨€ï¼Œæ˜¯ä½“ç°äº†ä¸€å®šç¨‹åº¦çš„å…¬å¹³ï¼Œä½†å¦‚æœå„ä¸ªç”¨æˆ·æ‰€æ‹¥æœ‰çš„è¿›ç¨‹æ•°ä¸åŒï¼Œå°±ä¼šå‘ç”Ÿå¯¹ç”¨æˆ·çš„ä¸å…¬å¹³é—®é¢˜ã€‚ åœ¨è¯¥ç®—æ³•ä¸­ï¼Œè°ƒåº¦çš„å…¬å¹³æ€§æ˜¯ä½“é’ˆå¯¹äºç”¨æˆ·è€Œè¨€ã€‚ä½¿æ‰€æœ‰çš„ç”¨æˆ·è·å¾—ç›¸åŒçš„å¤„ç†æœºæ—¶é—´ï¼Œæˆ–è¦æ±‚çš„æ—¶é—´æ¯”ä¾‹ã€‚</p><h1 id="5-5-å®æ—¶è°ƒåº¦"><a href="#5-5-å®æ—¶è°ƒåº¦" class="headerlink" title="5.5 å®æ—¶è°ƒåº¦"></a>5.5 å®æ—¶è°ƒåº¦</h1><h2 id="5-5-1-å®ç°å®æ—¶è°ƒåº¦çš„åŸºæœ¬æ¡ä»¶"><a href="#5-5-1-å®ç°å®æ—¶è°ƒåº¦çš„åŸºæœ¬æ¡ä»¶" class="headerlink" title="5.5.1 å®ç°å®æ—¶è°ƒåº¦çš„åŸºæœ¬æ¡ä»¶"></a>5.5.1 å®ç°å®æ—¶è°ƒåº¦çš„åŸºæœ¬æ¡ä»¶</h2><ol><li>æä¾›å¿…è¦çš„ä¿¡æ¯<ol><li>å°±ç»ªæ—¶é—´ï¼Œæ˜¯æŒ‡æŸä»»åŠ¡ç§°ä¸ºå°±ç»ªçŠ¶æ€çš„æ—¶é—´ï¼Œåœ¨å‘¨æœŸä»»åŠ¡çš„æƒ…å†µä¸‹ï¼Œå¥¹æ˜¯å®ç°é¢„çŸ¥çš„ä¸€ä¸²æ—¶é—´åºåˆ—ã€‚</li><li>å¼€å§‹æˆªæ­¢æ—¶é—´å’Œå®Œæˆæˆªæ­¢æ—¶é—´ï¼Œå¯¹äºå…¸å‹çš„å®æ—¶åº”ç”¨ï¼Œåªéœ€çŸ¥é“å¼€å§‹æˆªæ­¢æ—¶é—´æˆ–è€…å®Œæˆæˆªæ­¢æ—¶é—´</li><li>å¤„ç†æ—¶é—´ï¼Œä¸€ä¸ªä»»åŠ¡ä»å¼€å§‹æ‰§è¡Œï¼Œç›´è‡³å®Œæˆæ—¶æ‰€éœ€çš„æ—¶é—´</li><li>èµ„æºè¦æ±‚ï¼Œä»»åŠ¡æ‰§è¡Œæ—¶æ‰€éœ€è¦çš„ä¸€ç»„èµ„æº</li><li>ä¼˜å…ˆçº§ï¼Œå¦‚æœæŸä»»åŠ¡çš„å¼€å§‹æˆªæ­¢æ—¶é—´é”™è¿‡ï¼ŒåŠ¿å¿…å¼•èµ·æ•…éšœï¼Œåˆ™åº”ä¸ºè¯¥ä»»åŠ¡èµ‹äºˆâ€œç»å¯¹â€ä¼˜å…ˆçº§ï¼›å¦‚æœå…¶å¼€å§‹æˆªæ­¢æ—¶é—´çš„é”™è¿‡ï¼Œå¯¹ä»»åŠ¡çš„ç»§ç»­è¿è¡Œæ— é‡å¤§å½±å“ï¼Œåˆ™å¯ä¸ºå…¶èµ‹äºˆâ€œç›¸å¯¹ä¼˜å…ˆçº§â€ï¼Œä¾›è°ƒåº¦ç¨‹åºå‚è€ƒ</li></ol></li><li>ç³»ç»Ÿå¤„ç†èƒ½åŠ›å¼º<br> åœ¨å®æ—¶ç³»ç»Ÿä¸­ï¼Œè‹¥å¤„ç†æœºçš„å¤„ç†èƒ½åŠ›ä¸å¤Ÿå¼ºï¼Œåˆ™æœ‰å¯èƒ½å› å¤„ç†æœºå¿™ä¸è¿‡ï¼Œè€Œè‡´ä½¿æŸäº›å®æ—¶ä»»åŠ¡ä¸èƒ½å¾—åˆ°åŠæ—¶å¤„ç†ï¼Œä»è€Œå¯¼è‡´å‘ç”Ÿéš¾ä»¥é¢„æ–™çš„åæœã€‚<br> å‡å®šç³»ç»Ÿä¸­æœ‰mä¸ªå‘¨æœŸæ€§çš„ç¡¬å®æ—¶ä»»åŠ¡HRTï¼Œä»–ä»¬çš„å¤„ç†æ—¶é—´å¯è¡¨ç¤ºä¸º$C<em>i$ï¼Œå‘¨æœŸæ—¶é—´è¡¨ç¤ºä¸º$P_i$ï¼Œåˆ™åœ¨å•å¤„ç†æœºæƒ…å†µä¸‹ï¼Œå¿…é¡»æ»¡è¶³ä¸‹é¢çš„é™åˆ¶æ¡ä»¶ç³»ç»Ÿæ‰æ˜¯å¯è°ƒåº¦çš„ï¼š$$ \sum</em>{i=1}^{m}\frac{C<em>i}{P_i}\le1 <script type="math/tex">æé«˜ç³»ç»Ÿå¤„ç†èƒ½åŠ›çš„é€”å¾„æœ‰äºŒï¼šä¸€æ˜¯é‡‡ç”¨å•å¤„ç†æœºç³»ç»Ÿï¼Œä½†é¡»å¢å¼ºå…¶å¤„ç†èƒ½åŠ›ï¼Œä»¥æ˜¾è‘—åœ°å‡å°‘å¯¹æ¯ä¸€ä¸ªä»»åŠ¡çš„å¤„ç†æ—¶é—´ï¼›äºŒæ˜¯é‡‡ç”¨å¤šå¤„ç†æœºç³»ç»Ÿã€‚å‡å®šç³»ç»Ÿä¸­çš„å¤„ç†æœºæ•°ä¸ºNï¼Œåˆ™åº”å°†ä¸Šè¿°çš„é™åˆ¶æ¡ä»¶æ”¹ä¸ºï¼š</script> \sum</em>{i=1}^{m}\frac{C_i}{P_i}\le N $$</li><li>é‡‡ç”¨æŠ¢å å¼è°ƒåº¦æœºåˆ¶<br> åœ¨å«æœ‰HRTä»»åŠ¡çš„å®æ—¶ç³»ç»Ÿä¸­ï¼Œå¹¿æ³›é‡‡ç”¨æŠ¢å æœºåˆ¶ã€‚è¿™æ ·ä¾¿å¯æ»¡è¶³HRTä»»åŠ¡å¯¹æˆªæ­¢æ—¶é—´çš„è¦æ±‚ã€‚ä½†è¿™ç§è°ƒåº¦æœºåˆ¶æ¯”è¾ƒå¤æ‚ã€‚ å¯¹äºä¸€äº›å°çš„å®æ—¶ç³»ç»Ÿï¼Œå¦‚æœèƒ½å¤Ÿé¢„çŸ¥ä»»åŠ¡æ³•å¼€å§‹æˆªæ­¢æ—¶é—´ï¼Œåˆ™å¯¹äºå®æ—¶ä»»åŠ¡çš„è°ƒåº¦å¯ä»¥é‡‡ç”¨éæŠ¢å å¼è°ƒåº¦ã€‚</li><li>å…·æœ‰å¿«é€Ÿåˆ‡æ¢æœºåˆ¶<br> ä¸ºä¿è¯ç¡¬å®æ—¶ä»»åŠ¡èƒ½åŠæ—¶è¿è¡Œï¼Œåœ¨ç³»ç»Ÿä¸­è¿˜åº”å…·æœ‰å¿«é€Ÿåˆ‡æ¢æœºåˆ¶ï¼Œä½¿ä¹‹èƒ½è¿›è¡Œä»»åŠ¡çš„å¿«é€Ÿåˆ‡æ¢ã€‚è¯¥æœºåˆ¶åº”å…·æœ‰å¦‚ä¸‹ä¸¤æ–¹é¢çš„èƒ½åŠ›ï¼š<ol><li>å¯¹ä¸­æ–­çš„å¿«é€Ÿå“åº”èƒ½åŠ›ã€‚å¯¹ç´§è¿«çš„å¤–éƒ¨äº‹ä»¶è¯·æ±‚ä¸­æ–­èƒ½åŠæ—¶å“åº”ï¼Œè¦æ±‚ç³»ç»Ÿå…·æœ‰å¿«é€Ÿç¡¬ä»¶ä¸­æ–­æœºæ„ï¼Œè¿˜åº”ä½¿ç¦æ­¢ä¸­æ–­çš„æ—¶é—´é—´éš”å°½é‡çŸ­ï¼Œä»¥å…è€½è¯¯æ—¶æœº(å…¶å®ƒç´§è¿«ä»»åŠ¡)ã€‚</li><li>å¿«é€Ÿçš„ä»»åŠ¡åˆ†æ´¾èƒ½åŠ›ã€‚ä¸ºäº†æé«˜åˆ†æ´¾ç¨‹åºè¿›è¡Œä»»åŠ¡åˆ‡æ¢æ—¶çš„é€Ÿåº¦ï¼Œåº”ä½¿ç³»ç»Ÿä¸­çš„æ¯ä¸ªè¿è¡ŒåŠŸèƒ½å•ä½é€‚å½“çš„å°ï¼Œä»¥å‡å°‘ä»»åŠ¡åˆ‡æ¢çš„æ—¶é—´å¼€é”€ã€‚</li></ol></li></ol><h2 id="5-5-2-å®æ—¶è°ƒåº¦ç®—æ³•çš„åˆ†ç±»"><a href="#5-5-2-å®æ—¶è°ƒåº¦ç®—æ³•çš„åˆ†ç±»" class="headerlink" title="5.5.2 å®æ—¶è°ƒåº¦ç®—æ³•çš„åˆ†ç±»"></a>5.5.2 å®æ—¶è°ƒåº¦ç®—æ³•çš„åˆ†ç±»</h2><h3 id="5-5-2-1-éæŠ¢å å¼è°ƒåº¦ç®—æ³•"><a href="#5-5-2-1-éæŠ¢å å¼è°ƒåº¦ç®—æ³•" class="headerlink" title="5.5.2.1 éæŠ¢å å¼è°ƒåº¦ç®—æ³•"></a>5.5.2.1 éæŠ¢å å¼è°ƒåº¦ç®—æ³•</h3><ol><li><p>éæŠ¢å å¼è½®è½¬è°ƒåº¦ç®—æ³•<br> ç”±ä¸€å°è®¡ç®—æœºæ§åˆ¶è‹¥å¹²ä¸ªç›¸åŒçš„å¯¹è±¡ï¼Œä¸ºæ¯ä¸ªè¢«æ§å¯¹è±¡å»ºç«‹ä¸€ä¸ªå®æ—¶ä»»åŠ¡ã€‚å¹¶å°†ä»–ä»¬æ’æˆä¸€ä¸ªè½®è½¬é˜Ÿåˆ—ã€‚è°ƒåº¦ç¨‹åºæ¯æ¬¡é€‰æ‹©é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªä»»åŠ¡æŠ•å…¥è¿è¡Œï¼Œå½“è¯¥ä»»åŠ¡å®Œæˆåï¼Œä¾¿æŠŠå®ƒæŒ‚åœ¨è½®è½¬é˜Ÿåˆ—çš„æœ«å°¾ç­‰å¾…ï¼Œè°ƒåº¦ç¨‹åºå†é€‰æ‹©ä¸‹ä¸€ä¸ªé˜Ÿé¦–ä»»åŠ¡è¿è¡Œã€‚</p></li><li><p>éæŠ¢å å¼ä¼˜å…ˆè°ƒåº¦ç®—æ³•<br> å¦‚æœåœ¨ç³»ç»Ÿä¸­è¿˜å«æœ‰å°‘æ•°å…·æœ‰ä¸€å®šè¦æ±‚çš„å®æ—¶ä»»åŠ¡ï¼Œåˆ™å¯é‡‡ç”¨éæŠ¢å å¼ä¼˜å…ˆè°ƒåº¦ç®—æ³•ï¼Œç³»ç»Ÿä¸ºè¿™äº›ä»»åŠ¡èµ‹äºˆäº†è¾ƒé«˜çš„ä¼˜å…ˆçº§ã€‚å½“è¿™äº›å®æ—¶ä»»åŠ¡åˆ°è¾¾æ—¶ï¼ŒæŠŠå®ƒä»¬å®‰æ’åœ¨å°±ç»ªé˜Ÿåˆ—çš„é˜Ÿé¦–ï¼Œç­‰å¾…å½“å‰ä»»åŠ¡è‡ªæˆ‘ç»ˆæ­¢æˆ–è¿è¡Œå®Œæˆåï¼Œä¾¿å¯å»è°ƒåº¦æ‰§è¡Œé˜Ÿé¦–çš„é«˜ä¼˜å…ˆçº§è¿›ç¨‹ã€‚</p></li></ol><h3 id="5-5-2-2-æŠ¢å å¼è°ƒåº¦ç®—æ³•"><a href="#5-5-2-2-æŠ¢å å¼è°ƒåº¦ç®—æ³•" class="headerlink" title="5.5.2.2 æŠ¢å å¼è°ƒåº¦ç®—æ³•"></a>5.5.2.2 æŠ¢å å¼è°ƒåº¦ç®—æ³•</h3><ol><li><p>åŸºäºæ—¶é’Ÿä¸­æ–­çš„æŠ¢å å¼ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•ã€‚<br> åœ¨æŸå®æ—¶ä»»åŠ¡åˆ°è¾¾åï¼Œå¦‚æœä»–çš„ä¼˜å…ˆçº§é«˜äºå½“å‰ä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼Œè¿™æ˜¯å¹¶ä¸ç«‹å³æŠ¢å å½“å‰ä»»åŠ¡çš„å¤„ç†æœºï¼Œè€Œæ˜¯ç­‰åˆ°æ—¶é’Ÿä¸­æ–­å‘ç”Ÿæ—¶ï¼Œè°ƒåº¦ç¨‹åºæ‰å‰¥å¤ºå¤§å¹´ä»»åŠ¡çš„æ‰§è¡Œï¼ŒæŠŠå¤„ç†æœºåˆ†é…ç»™æ–°åˆ°çš„é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ã€‚</p></li><li><p>ç«‹å³æŠ¢å çš„ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•ã€‚<br> åœ¨è¿™ç§è°ƒåº¦ç­–ç•¥ä¸­ï¼Œè¦æ±‚æ“ä½œç³»ç»Ÿå…·æœ‰å¿«é€Ÿå“åº”å¤–éƒ¨äº‹ä»¶ä¸­æ–­çš„èƒ½åŠ›ï¼Œä¸€æ—¦å‡ºç°å¤–éƒ¨ä¸­æ–­ï¼Œåªè¦å½“å‰ä»»åŠ¡æœªå¤„äºä¸´ç•ŒåŒºï¼Œä¾¿èƒ½ç«‹å³å‰¥å¤ºå½“å‰ä»»åŠ¡çš„æ‰§è¡Œï¼ŒæŠŠå¤„ç†æœºåˆ†é…ç»™è¯·æ±‚ä¸­æ–­çš„ç´§è¿«ä»»åŠ¡ã€‚<br> <img src="https://cdn.littlecorgi.top/mweb/å®æ—¶è¿›ç¨‹è°ƒåº¦.png" alt="å®æ—¶è¿›ç¨‹è°ƒåº¦"></p></li></ol><h2 id="5-5-3-æœ€æ—©æˆªæ­¢æ—¶é—´ä¼˜å…ˆ"><a href="#5-5-3-æœ€æ—©æˆªæ­¢æ—¶é—´ä¼˜å…ˆ" class="headerlink" title="5.5.3 æœ€æ—©æˆªæ­¢æ—¶é—´ä¼˜å…ˆ"></a>5.5.3 æœ€æ—©æˆªæ­¢æ—¶é—´ä¼˜å…ˆ</h2><p>è¯¥ç®—æ³•æ˜¯æ ¹æ®ä»»åŠ¡æˆªæ­¢æ—¶é—´ç¡®å®šä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼Œä»»åŠ¡çš„æˆªæ­¢æ—¶é—´è¶Šæ—©ï¼Œå…¶ä¼˜å…ˆçº§è¶Šé«˜ï¼Œå…·æœ‰æœ€æ—©æˆªæ­¢æ—¶é—´çš„ä»»åŠ¡æ’åœ¨é˜Ÿé¦–ã€‚</p><h3 id="5-5-3-1-éæŠ¢å å¼è°ƒåº¦æ–¹å¼ç”¨äºéå‘¨æœŸå®æ—¶ä»»åŠ¡"><a href="#5-5-3-1-éæŠ¢å å¼è°ƒåº¦æ–¹å¼ç”¨äºéå‘¨æœŸå®æ—¶ä»»åŠ¡" class="headerlink" title="5.5.3.1 éæŠ¢å å¼è°ƒåº¦æ–¹å¼ç”¨äºéå‘¨æœŸå®æ—¶ä»»åŠ¡"></a>5.5.3.1 éæŠ¢å å¼è°ƒåº¦æ–¹å¼ç”¨äºéå‘¨æœŸå®æ—¶ä»»åŠ¡</h3><p><img src="https://cdn.littlecorgi.top/mweb/EDFç®—æ³•ç”¨äºéæŠ¢å å¼è°ƒåº¦æ–¹æ³•.jpg" alt="EDFç®—æ³•ç”¨äºéæŠ¢å å¼è°ƒåº¦æ–¹æ³•"></p><h3 id="5-5-3-2-æŠ¢å å¼è°ƒåº¦æ–¹å¼ç”¨äºéå‘¨æœŸå®æ—¶ä»»åŠ¡"><a href="#5-5-3-2-æŠ¢å å¼è°ƒåº¦æ–¹å¼ç”¨äºéå‘¨æœŸå®æ—¶ä»»åŠ¡" class="headerlink" title="5.5.3.2 æŠ¢å å¼è°ƒåº¦æ–¹å¼ç”¨äºéå‘¨æœŸå®æ—¶ä»»åŠ¡"></a>5.5.3.2 æŠ¢å å¼è°ƒåº¦æ–¹å¼ç”¨äºéå‘¨æœŸå®æ—¶ä»»åŠ¡</h3><p><img src="https://cdn.littlecorgi.top/mweb/æœ€æ—©æˆªæ­¢æ—¶é—´ä¼˜å…ˆç®—æ³•ç”¨äºæŠ¢å è°ƒåº¦æ–¹å¼ä¹‹ä¾‹.png" alt="æœ€æ—©æˆªæ­¢æ—¶é—´ä¼˜å…ˆç®—æ³•ç”¨äºæŠ¢å è°ƒåº¦æ–¹å¼ä¹‹ä¾‹"></p><h2 id="5-5-4-æœ€ä½æ¾å¼›åº¦ä¼˜å…ˆLLFç®—æ³•"><a href="#5-5-4-æœ€ä½æ¾å¼›åº¦ä¼˜å…ˆLLFç®—æ³•" class="headerlink" title="5.5.4 æœ€ä½æ¾å¼›åº¦ä¼˜å…ˆLLFç®—æ³•"></a>5.5.4 æœ€ä½æ¾å¼›åº¦ä¼˜å…ˆLLFç®—æ³•</h2><p>è¯¥ç®—æ³•åœ¨ç¡®å®šä»»åŠ¡çš„ä¼˜å…ˆçº§æ—¶ï¼Œæ ¹æ®çš„æ˜¯ä»»åŠ¡çš„ç´§æ€¥(æˆ–æ¾å¼›)ç¨‹åº¦ã€‚ä»»åŠ¡ç´§æ€¥ç¨‹åº¦æ„ˆé«˜ï¼Œèµ‹äºˆè¯¥ä»»åŠ¡çš„ä¼˜å…ˆçº§å°±æ„ˆé«˜ï¼Œä»¥ä½¿ä¹‹ä¼˜å…ˆæ‰§è¡Œã€‚ è¯¥æ–¹å¼ä¸»è¦ç”¨å¯æŠ¢å å¼è°ƒåº¦ã€‚</p><p>å‡å¦‚åœ¨ä¸€ä¸ªå®æ—¶ç³»ç»Ÿä¸­æœ‰ä¸¤ä¸ªå‘¨æœŸæ€§å®æ—¶ä»»åŠ¡Aå’ŒBï¼Œä»»åŠ¡Aè¦æ±‚æ¯20â€…msæ‰§è¡Œä¸€æ¬¡ï¼Œæ‰§è¡Œæ—¶é—´ä¸º10â€…msï¼Œä»»åŠ¡Bè¦æ±‚æ¯50â€…msæ‰§è¡Œä¸€æ¬¡ï¼Œæ‰§è¡Œæ—¶é—´ä¸º25â€…msã€‚ç”±æ­¤å¯çŸ¥ï¼Œä»»åŠ¡Aå’ŒBæ¯æ¬¡å¿…é¡»å®Œæˆçš„æ—¶é—´åˆ†åˆ«ä¸ºï¼šA1ã€A2ã€A3ã€â€¦å’ŒB1ã€B2ã€B3ã€â€¦ï¼Œå¦‚ä¸‹å›¾<br><img src="https://cdn.littlecorgi.top/mweb/Aä»»åŠ¡å’ŒBä»»åŠ¡æ¯æ¬¡å¿…é¡»å®Œæˆçš„æ—¶é—´.png" alt="Aä»»åŠ¡å’ŒBä»»åŠ¡æ¯æ¬¡å¿…é¡»å®Œæˆçš„æ—¶é—´"></p><p>åˆ©ç”¨ELLFç®—æ³•è¿›è¡Œè°ƒåº¦çš„æƒ…å†µï¼š<br><img src="https://cdn.littlecorgi.top/mweb/åˆ©ç”¨ELLFç®—æ³•è¿›è¡Œè°ƒåº¦çš„æƒ…å†µ.png" alt="åˆ©ç”¨ELLFç®—æ³•è¿›è¡Œè°ƒåº¦çš„æƒ…å†µ"></p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ</category>
      
      
      <comments>https://www.littlecorgi.top/posts/8b4e2673.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Androidç½‘ç»œè¯·æ±‚1--HttpClientä¸HttpURLConnection</title>
      <link>https://www.littlecorgi.top/posts/eb898689.html</link>
      <guid>https://www.littlecorgi.top/posts/eb898689.html</guid>
      <pubDate>Tue, 06 Aug 2019 11:51:46 GMT</pubDate>
      
      <description>&lt;p&gt;åœ¨æ—©æœŸçš„æ—¶å€™ï¼ŒAndroidä¸Šè¿˜æ²¡æœ‰åƒ&lt;code&gt;Volley&lt;/code&gt;ã€&lt;code&gt;OkHttp&lt;/code&gt;ã€&lt;code&gt;Retrofit&lt;/code&gt;è¿™äº›ä¼˜ç§€çš„å¼€æºåº“ï¼Œå¦‚æœæƒ³è¦ä½¿ç”¨ç½‘ç»œè¯·æ±‚çš„è¯ï¼Œå°±åªèƒ½è‡ªå·±å°è£…&lt;code&gt;HttpClient&lt;/code&gt;å’Œ&lt;code&gt;HttpURLConnection&lt;/code&gt;ã€‚ç°åœ¨æˆ‘ä»¬å°±æ¥çœ‹ä¸‹&lt;code&gt;Apache&lt;/code&gt;çš„è¿™ä¸¤ä¸ªç±»ã€‚&lt;br&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>åœ¨æ—©æœŸçš„æ—¶å€™ï¼ŒAndroidä¸Šè¿˜æ²¡æœ‰åƒ<code>Volley</code>ã€<code>OkHttp</code>ã€<code>Retrofit</code>è¿™äº›ä¼˜ç§€çš„å¼€æºåº“ï¼Œå¦‚æœæƒ³è¦ä½¿ç”¨ç½‘ç»œè¯·æ±‚çš„è¯ï¼Œå°±åªèƒ½è‡ªå·±å°è£…<code>HttpClient</code>å’Œ<code>HttpURLConnection</code>ã€‚ç°åœ¨æˆ‘ä»¬å°±æ¥çœ‹ä¸‹<code>Apache</code>çš„è¿™ä¸¤ä¸ªç±»ã€‚<br><span id="more"></span></p><h1 id="1-HttpClient"><a href="#1-HttpClient" class="headerlink" title="1. HttpClient"></a>1. HttpClient</h1><h2 id="2-1-å¯¼å…¥HttpClient"><a href="#2-1-å¯¼å…¥HttpClient" class="headerlink" title="2.1 å¯¼å…¥HttpClient"></a>2.1 å¯¼å…¥HttpClient</h2><p>ç”±äºä»Android 6.0 å¼€å§‹ï¼Œè°·æ­Œå°±å°†HttpClientä»Androidä¸­åˆ é™¤äº†ï¼Œæ‰€ä»¥è‹¥ç°åœ¨æƒ³ä½¿ç”¨ä»–ï¼Œè¿˜å¾—å¯¼å…¥ä¾èµ–ï¼š<br>åœ¨é¡¹ç›®çš„<code>build.gradle</code>çš„<code>Android</code>ä»£ç å—ä¸‹åŠ å…¥ä¾èµ–ï¼Œç¤ºä¾‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    useLibrary <span class="string">&#x27;org.apache.http.legacy&#x27;</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="2-2-HttpClientçš„Get"><a href="#2-2-HttpClientçš„Get" class="headerlink" title="2.2 HttpClientçš„Get"></a>2.2 HttpClientçš„Get</h2><p>é¦–å…ˆé€šè¿‡<code>DefaultHttpClient</code>æ¥å®ä¾‹åŒ–ä¸€ä¸ª<code>HttpClient</code>ï¼Œå¹¶é…ç½®å¥½å‚æ•°ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//åˆ›å»ºHttpClient</span></span><br><span class="line"><span class="keyword">private</span> HttpClient <span class="title function_">createHttpClient</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">HttpParams</span> <span class="variable">mDefaultHttpParams</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicHttpParams</span>();</span><br><span class="line">    <span class="comment">//è®¾ç½®è¿æ¥è¶…æ—¶</span></span><br><span class="line">    HttpConnectionParams.setConnectionTimeout(mDefaultHttpParams, <span class="number">15000</span>);</span><br><span class="line">    <span class="comment">//è®¾ç½®è¯·æ±‚è¶…æ—¶</span></span><br><span class="line">    HttpConnectionParams.setSoTimeout(mDefaultHttpParams, <span class="number">15000</span>);</span><br><span class="line">    HttpConnectionParams.setTcpNoDelay(mDefaultHttpParams, <span class="literal">true</span>);</span><br><span class="line">    HttpProtocolParams.setVersion(mDefaultHttpParams, HttpVersion.HTTP_1_1);</span><br><span class="line">    HttpProtocolParams.setContentCharset(mDefaultHttpParams, HTTP.UTF_8);</span><br><span class="line">    <span class="comment">//æŒç»­æ¡æ‰‹</span></span><br><span class="line">    HttpProtocolParams.setUseExpectContinue(mDefaultHttpParams, <span class="literal">true</span>);</span><br><span class="line">    <span class="type">HttpClient</span> <span class="variable">mHttpClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultHttpClient</span>(mDefaultHttpParams);</span><br><span class="line">    <span class="keyword">return</span> mHttpClient;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æ¥ç€åˆ›å»º<code>HttpGet</code>å’Œ<code>HttpClient</code>ï¼Œè¯·æ±‚ç½‘ç»œå¹¶å¾—åˆ°<code>HttpResponse</code>ï¼Œå¹¶å¯¹<code>HttpResponse</code>è¿›è¡Œå¤„ç†ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">useHttpClientGet</span><span class="params">(String url)</span> &#123;</span><br><span class="line">    <span class="type">HttpGet</span> <span class="variable">mHttpGet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(url);</span><br><span class="line">    mHttpGet.addHeader(<span class="string">&quot;Connection&quot;</span>, <span class="string">&quot;Keep-Alive&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">HttpClient</span> <span class="variable">mHttpClient</span> <span class="operator">=</span> createHttpClient();</span><br><span class="line">        <span class="type">HttpResponse</span> <span class="variable">mHttpResponse</span> <span class="operator">=</span> mHttpClient.execute(mHttpGet);</span><br><span class="line">        <span class="type">HttpEntity</span> <span class="variable">mHttpEntity</span> <span class="operator">=</span> mHttpResponse.getEntity();</span><br><span class="line">        <span class="type">int</span> <span class="variable">code</span> <span class="operator">=</span> mHttpResponse.getStatusLine().getStatusCode();</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != mHttpEntity) &#123;</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">mInputStream</span> <span class="operator">=</span> mHttpEntity.getContent();</span><br><span class="line">            <span class="type">String</span> <span class="variable">respose</span> <span class="operator">=</span> converStreamToString(mInputStream);</span><br><span class="line">            Log.i(<span class="string">&quot;wangshu&quot;</span>, <span class="string">&quot;è¯·æ±‚çŠ¶æ€ç :&quot;</span> + code + <span class="string">&quot;\nè¯·æ±‚ç»“æœ:\n&quot;</span> + respose);</span><br><span class="line">            mInputStream.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><code>converStreamToString()</code>æ–¹æ³•å°†è¯·æ±‚ç»“æœè½¬æ¢æˆ<code>String</code>ç±»å‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String <span class="title function_">converStreamToString</span><span class="params">(InputStream is)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(is));</span><br><span class="line">    <span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">    <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">        sb.append(line + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">respose</span> <span class="operator">=</span> sb.toString();</span><br><span class="line">    <span class="keyword">return</span> respose;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æœ€åå¼€å¯çº¿ç¨‹è®¿é—®:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        useHttpClientGet(<span class="string">&quot;http://www.baidu.com&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).start();</span><br></pre></td></tr></table></figure></p><h2 id="1-3-HttpClientçš„POST"><a href="#1-3-HttpClientçš„POST" class="headerlink" title="1.3 HttpClientçš„POST"></a>1.3 HttpClientçš„POST</h2><p>å’ŒGETå·®ä¸å¤šï¼Œåªéœ€è¦ä¿®æ”¹ä¼ é€’çš„å‚æ•°ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">useHttpClientPost</span><span class="params">(String url)</span> &#123;</span><br><span class="line">    <span class="type">HttpPost</span> <span class="variable">mHttpPost</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpPost</span>(url);</span><br><span class="line">    mHttpPost.addHeader(<span class="string">&quot;Connection&quot;</span>, <span class="string">&quot;Keep-Alive&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">HttpClient</span> <span class="variable">mHttpClient</span> <span class="operator">=</span> createHttpClient();</span><br><span class="line">        List&lt;NameValuePair&gt; postParams = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//è¦ä¼ é€’çš„å‚æ•°</span></span><br><span class="line">        postParams.add(<span class="keyword">new</span> <span class="title class_">BasicNameValuePair</span>(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;moon&quot;</span>));</span><br><span class="line">        postParams.add(<span class="keyword">new</span> <span class="title class_">BasicNameValuePair</span>(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;123&quot;</span>));</span><br><span class="line">        mHttpPost.setEntity(<span class="keyword">new</span> <span class="title class_">UrlEncodedFormEntity</span>(postParams));</span><br><span class="line">        <span class="type">HttpResponse</span> <span class="variable">mHttpResponse</span> <span class="operator">=</span> mHttpClient.execute(mHttpPost);</span><br><span class="line">        <span class="type">HttpEntity</span> <span class="variable">mHttpEntity</span> <span class="operator">=</span> mHttpResponse.getEntity();</span><br><span class="line">        <span class="type">int</span> <span class="variable">code</span> <span class="operator">=</span> mHttpResponse.getStatusLine().getStatusCode();</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != mHttpEntity) &#123;</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">mInputStream</span> <span class="operator">=</span> mHttpEntity.getContent();</span><br><span class="line">            <span class="type">String</span> <span class="variable">respose</span> <span class="operator">=</span> converStreamToString(mInputStream);</span><br><span class="line">            Log.i(<span class="string">&quot;wangshu&quot;</span>, <span class="string">&quot;è¯·æ±‚çŠ¶æ€ç :&quot;</span> + code + <span class="string">&quot;\nè¯·æ±‚ç»“æœ:\n&quot;</span> + respose);</span><br><span class="line">            mInputStream.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="2-HttpURLConnection"><a href="#2-HttpURLConnection" class="headerlink" title="2. HttpURLConnection"></a>2. HttpURLConnection</h1><p><code>HttpURLConnection</code>è¾ƒ<code>HttpClient</code>æ¥è¯´æ›´è½»é‡ï¼Œè€Œä¸”ä»–<code>API</code>ä¹Ÿæ¯”<code>HttpClient</code>ç®€å•ã€‚ç‰¹åˆ«æ˜¯<code>Android 6.0</code>å°†<code>HttpClient</code>ç§»é™¤ä¹‹åï¼Œç°åœ¨åªèƒ½ä½¿ç”¨<code>HttpURLConnection</code>ã€‚</p><h2 id="2-1-HttpURLConnectionçš„POSTè¯·æ±‚"><a href="#2-1-HttpURLConnectionçš„POSTè¯·æ±‚" class="headerlink" title="2.1 HttpURLConnectionçš„POSTè¯·æ±‚"></a>2.1 HttpURLConnectionçš„POSTè¯·æ±‚</h2><p>é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªUrlConnManagerç±»ï¼Œç„¶åé‡Œé¢æä¾›getHttpURLConnection()æ–¹æ³•ç”¨äºé…ç½®é»˜è®¤çš„å‚æ•°å¹¶è¿”å›HttpURLConnectionï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> HttpURLConnection <span class="title function_">getHttpURLConnection</span><span class="params">(String url)</span>&#123;</span><br><span class="line">    HttpURLConnection mHttpURLConnection=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        URL mUrl=<span class="keyword">new</span> <span class="title class_">URL</span>(url);</span><br><span class="line">        mHttpURLConnection=(HttpURLConnection)mUrl.openConnection();</span><br><span class="line">        <span class="comment">//è®¾ç½®é“¾æ¥è¶…æ—¶æ—¶é—´</span></span><br><span class="line">        mHttpURLConnection.setConnectTimeout(<span class="number">15000</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®è¯»å–è¶…æ—¶æ—¶é—´</span></span><br><span class="line">        mHttpURLConnection.setReadTimeout(<span class="number">15000</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®è¯·æ±‚å‚æ•°</span></span><br><span class="line">        mHttpURLConnection.setRequestMethod(<span class="string">&quot;POST&quot;</span>);</span><br><span class="line">        <span class="comment">//æ·»åŠ Header</span></span><br><span class="line">        mHttpURLConnection.setRequestProperty(<span class="string">&quot;Connection&quot;</span>,<span class="string">&quot;Keep-Alive&quot;</span>);</span><br><span class="line">        <span class="comment">//æ¥æ”¶è¾“å…¥æµ</span></span><br><span class="line">        mHttpURLConnection.setDoInput(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//ä¼ é€’å‚æ•°æ—¶éœ€è¦å¼€å¯</span></span><br><span class="line">        mHttpURLConnection.setDoOutput(<span class="literal">true</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mHttpURLConnection ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å› ä¸ºæˆ‘ä»¬è¦å‘é€POSTè¯·æ±‚ï¼Œæ‰€ä»¥åœ¨UrlConnManagerç±»ä¸­å†å†™ä¸€ä¸ªpostParams()æ–¹æ³•ç”¨æ¥ç»„ç»‡ä¸€ä¸‹è¯·æ±‚å‚æ•°å¹¶å°†è¯·æ±‚å‚æ•°å†™å…¥åˆ°è¾“å‡ºæµä¸­ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">postParams</span><span class="params">(OutputStream output,List&lt;NameValuePair&gt;paramsList)</span> <span class="keyword">throws</span> IOException&#123;</span><br><span class="line">    StringBuilder mStringBuilder=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">    <span class="keyword">for</span> (NameValuePair pair:paramsList)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!TextUtils.isEmpty(mStringBuilder))&#123;</span><br><span class="line">            mStringBuilder.append(<span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        mStringBuilder.append(URLEncoder.encode(pair.getName(),<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        mStringBuilder.append(<span class="string">&quot;=&quot;</span>);</span><br><span class="line">        mStringBuilder.append(URLEncoder.encode(pair.getValue(),<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    BufferedWriter writer=<span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(<span class="keyword">new</span> <span class="title class_">OutputStreamWriter</span>(output,<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">    writer.write(mStringBuilder.toString());</span><br><span class="line">    writer.flush();</span><br><span class="line">    writer.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æ¥ä¸‹æ¥æˆ‘ä»¬æ·»åŠ è¯·æ±‚å‚æ•°ï¼Œè°ƒç”¨postParams()æ–¹æ³•å°†è¯·æ±‚çš„å‚æ•°ç»„ç»‡å¥½ä¼ ç»™HttpURLConnectionçš„è¾“å‡ºæµï¼Œè¯·æ±‚è¿æ¥å¹¶å¤„ç†è¿”å›çš„ç»“æœï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">useHttpUrlConnectionPost</span><span class="params">(String url)</span> &#123;</span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">mInputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">HttpURLConnection</span> <span class="variable">mHttpURLConnection</span> <span class="operator">=</span> UrlConnManager.getHttpURLConnection(url);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        List&lt;NameValuePair&gt; postParams = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//è¦ä¼ é€’çš„å‚æ•°</span></span><br><span class="line">        postParams.add(<span class="keyword">new</span> <span class="title class_">BasicNameValuePair</span>(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;moon&quot;</span>));</span><br><span class="line">        postParams.add(<span class="keyword">new</span> <span class="title class_">BasicNameValuePair</span>(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;123&quot;</span>));</span><br><span class="line">        UrlConnManager.postParams(mHttpURLConnection.getOutputStream(), postParams);</span><br><span class="line">        mHttpURLConnection.connect();</span><br><span class="line">        mInputStream = mHttpURLConnection.getInputStream();</span><br><span class="line">        <span class="type">int</span> <span class="variable">code</span> <span class="operator">=</span> mHttpURLConnection.getResponseCode();</span><br><span class="line">        <span class="type">String</span> <span class="variable">respose</span> <span class="operator">=</span> converStreamToString(mInputStream);</span><br><span class="line">        Log.i(<span class="string">&quot;wangshu&quot;</span>, <span class="string">&quot;è¯·æ±‚çŠ¶æ€ç :&quot;</span> + code + <span class="string">&quot;\nè¯·æ±‚ç»“æœ:\n&quot;</span> + respose);</span><br><span class="line">        mInputStream.close();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æœ€åå¼€å¯çº¿ç¨‹è¯·æ±‚ç½‘ç»œï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">useHttpUrlConnectionGetThread</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            useHttpUrlConnectionPost(<span class="string">&quot;http://www.baidu.com&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Android/">Android</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E6%BA%90%E7%A0%81/">æºç </category>
      
      <category domain="https://www.littlecorgi.top/tags/kotlin/">kotlin</category>
      
      <category domain="https://www.littlecorgi.top/tags/Volley/">Volley</category>
      
      
      <comments>https://www.littlecorgi.top/posts/eb898689.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>ijkPlayerç¼–è¯‘-Android</title>
      <link>https://www.littlecorgi.top/posts/d61d5542.html</link>
      <guid>https://www.littlecorgi.top/posts/d61d5542.html</guid>
      <pubDate>Tue, 06 Aug 2019 11:51:28 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;1-ç®€ä»‹&quot;&gt;&lt;a href=&quot;#1-ç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;1. ç®€ä»‹&quot;&gt;&lt;/a&gt;1. ç®€ä»‹&lt;/h1&gt;&lt;p&gt;ijkplayeræ˜¯å“”å“©å“”å“©çš„ä¸€ä¸ªå¼€æºè§†é¢‘æ’­æ”¾æ¡†æ¶ï¼Œæ”¯æŒAndroidã€iOSã€‚åº•å±‚æ˜¯ffplayã€‚&lt;/p&gt;
&lt;p&gt;Githubåœ°å€ï¼š&lt;a href=&quot;https://github.com/bilibili/ijkplayer&quot;&gt;bilibili/ijkplayer&lt;/a&gt;&lt;br&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1. ç®€ä»‹"></a>1. ç®€ä»‹</h1><p>ijkplayeræ˜¯å“”å“©å“”å“©çš„ä¸€ä¸ªå¼€æºè§†é¢‘æ’­æ”¾æ¡†æ¶ï¼Œæ”¯æŒAndroidã€iOSã€‚åº•å±‚æ˜¯ffplayã€‚</p><p>Githubåœ°å€ï¼š<a href="https://github.com/bilibili/ijkplayer">bilibili/ijkplayer</a><br><span id="more"></span></p><h1 id="2-ç¼–è¯‘æ–¹æ³•"><a href="#2-ç¼–è¯‘æ–¹æ³•" class="headerlink" title="2. ç¼–è¯‘æ–¹æ³•"></a>2. ç¼–è¯‘æ–¹æ³•</h1><p>ç”±äºé€šè¿‡Gradleç¼–è¯‘èµ·æ¥å¾ˆæ…¢è€Œä¸”ä¸€æ—¦å¤±è´¥åˆå¾—é‡å¤´æ¥ï¼Œæ‰€ä»¥è¿™å—å°±ä½¿ç”¨AndroidNDKçš„æ–¹å¼æ¥ç¼–è¯‘ã€‚</p><h2 id="2-1-ç¼–è¯‘ä¹‹å‰"><a href="#2-1-ç¼–è¯‘ä¹‹å‰" class="headerlink" title="2.1 ç¼–è¯‘ä¹‹å‰"></a>2.1 ç¼–è¯‘ä¹‹å‰</h2><p>é¦–å…ˆä½ å¾—é…ç½®å¥½ç­‰ä¼šç¼–è¯‘éœ€è¦çš„ä¸œè¥¿ã€‚è¿™å—æˆ‘ä»¬éƒ½ä¼šä½¿ç”¨<a href="https://brew.sh/index_zh-cn">Homebrew</a>æ¥å®‰è£…gitå’Œyasmã€‚<br>Homebrewç±»ä¼¼äºUbuntuçš„dpkgã€RedHatå’ŒcentOSçš„yumï¼Œä»–æ˜¯macOSä¸Šçš„ä¸€ä¸ªè½¯ä»¶åŒ…ç®¡ç†å™¨ã€‚ä½†æ˜¯åæ¥å‡ºäº†Linuxç‰ˆã€‚<br>ç”±äºijkplayerå®˜æ–¹è¯´ç”¨çš„å®ƒï¼Œé‚£å’±ä»¬å°±ç”¨å®ƒå§ã€‚</p><h3 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h3><h4 id="1-å…ˆæŠŠç›®å‰å·²æœ‰çš„åŒ…æ›´æ–°"><a href="#1-å…ˆæŠŠç›®å‰å·²æœ‰çš„åŒ…æ›´æ–°" class="headerlink" title="1. å…ˆæŠŠç›®å‰å·²æœ‰çš„åŒ…æ›´æ–°"></a>1. å…ˆæŠŠç›®å‰å·²æœ‰çš„åŒ…æ›´æ–°</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// ä»é•œåƒç«™ä¸‹è½½è½¯ä»¶åˆ—è¡¨ï¼Œå¹¶æ£€æŸ¥æœ‰æ²¡æœ‰éœ€è¦æ›´æ–°çš„åŒ…</span><br><span class="line">sudo apt update</span><br><span class="line"></span><br><span class="line">// æ›´æ–°éœ€è¦æ›´æ–°çš„åŒ…</span><br><span class="line">sudo apt upgrade</span><br><span class="line"></span><br><span class="line">// è‡ªåŠ¨å¸è½½æ‰å½“åˆä¸ºäº†å®‰è£…å…¶ä»–è½¯ä»¶æˆ–å…¶ä»–åŸå› è€Œå®‰è£…ä½†æ˜¯ç›®å‰å·²ç»æ²¡ç”¨çš„åŒ…</span><br><span class="line">sudo apt autoremove</span><br></pre></td></tr></table></figure><h4 id="2-å®‰è£…Homebrew"><a href="#2-å®‰è£…Homebrew" class="headerlink" title="2. å®‰è£…Homebrew"></a>2. å®‰è£…Homebrew</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1. é¦–å…ˆç¡®å®šæ˜¯å¦å®‰è£…ruby  </span><br><span class="line">    apt install ruby<span class="string">&#x27;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">2. ç„¶åé€šè¿‡rubyå®‰è£…Homebrew  </span></span><br><span class="line"><span class="string">    ruby -c &quot;$(curl -fsSL https://raw.githubusercontent.com/Linuxbrew/install/master/install.sh)&quot;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">3. å†é€šè¿‡Homebrewå®‰è£…gitå’Œyasm</span></span><br><span class="line"><span class="string">    brew install git</span></span><br><span class="line"><span class="string">    brew install yasm</span></span><br></pre></td></tr></table></figure><h4 id="3-é…ç½®Android-SDKå’ŒNDK"><a href="#3-é…ç½®Android-SDKå’ŒNDK" class="headerlink" title="3. é…ç½®Android SDKå’ŒNDK"></a>3. é…ç½®Android SDKå’ŒNDK</h4><ol><li><p>Android SDK<br> ä½ å¯ä»¥æ‰“å¼€ä½ çš„AndroidStudioï¼Œè¿›å…¥<code>Preferences -&gt; Appearance &amp; Behavior -&gt; System Settings -&gt; Android SDK</code>ã€‚è¿™å—å°±ä¼šæ˜¾ç¤ºä½ SDKå®‰è£…ç›®å½•ã€‚<br> ç„¶ååœ¨ç»ˆç«¯ä¸­è¾“å…¥<code>vim ~/.bash_profile</code>ã€‚ç„¶åè¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> ANDROID_SDK_HOME=AndroidSDKçš„ç›®å½•/android-sdk-linux</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$&#123;ANDROID_SDK_HOME&#125;</span>/tools</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$&#123;ANDROID_SDK_HOME&#125;</span>/platform-tools</span><br></pre></td></tr></table></figure><p> ä¿å­˜ï¼Œç„¶åå†åœ¨ç»ˆç«¯è¾“å…¥<code>source ~/.bash_profile</code>ï¼Œå°±å¯ä»¥äº†ã€‚</p></li><li><p>Android NDK<br> é¦–å…ˆä½ å¾—åˆ°å®˜ç½‘ä¸‹è½½NDKï¼š<a href="https://developer.android.com/ndk/downloads/older_releases.html?hl=zh-cn">NDK å½’æ¡£</a>ã€‚è€Œä¸”ä½ åªèƒ½ä¸‹è½½r10eç‰ˆæœ¬çš„ï¼Œä¸‹è½½å…¶å®ƒç‰ˆæœ¬ç¼–è¯‘ä¼šæŠ¥é”™ã€‚<br> ä¸‹è½½ä¸‹æ¥è§£å‹åï¼ŒåŒæ ·å’Œä¸Šé¢ä¸€æ ·å¾—é…ç½®ç¯å¢ƒå˜é‡ï¼š</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> ANDROID_NDK_HOME=NDKç›®å½•</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$&#123;ANDROID_SDK_HOME&#125;</span></span><br></pre></td></tr></table></figure><p> ä¿å­˜ï¼Œç„¶åå†åœ¨ç»ˆç«¯è¾“å…¥<code>source ~/.bash_profile</code>ï¼Œå°±å¯ä»¥äº†ã€‚</p></li></ol><h3 id="macOS"><a href="#macOS" class="headerlink" title="macOS"></a>macOS</h3><p>å®‰è£…Homebrewï¼Œç”±äºmacOSè‡ªå¸¦rubyï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥å¯ä»¥å¼€å§‹å®‰è£…Homebrewã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ruby -e <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)</span>&quot;</span></span><br><span class="line">brew install git</span><br><span class="line">brew install yasm</span><br></pre></td></tr></table></figure><br>ç„¶åå°±æ˜¯é…ç½®ä½ çš„Android SDKå’ŒAndroid NDKï¼š<br>å’Œä¸Šé¢Ubuntuä¸‹ä¸€æ ·ã€‚</p><h2 id="2-2-ç¼–è¯‘Android"><a href="#2-2-ç¼–è¯‘Android" class="headerlink" title="2.2 ç¼–è¯‘Android"></a>2.2 ç¼–è¯‘Android</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/Bilibili/ijkplayer.git ijkplayer-android</span><br><span class="line"><span class="built_in">cd</span> ijkplayer-android</span><br><span class="line">git checkout -B latest k0.8.8</span><br><span class="line"></span><br><span class="line">./init-android.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> android/contrib</span><br><span class="line">./compile-ffmpeg.sh clean</span><br><span class="line">// è¿™æ­¥ç‰¹æ…¢ï¼Œè€—æ—¶å¾ˆé•¿</span><br><span class="line">./compile-ffmpeg.sh all</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line">./compile-ijk.sh all</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™äº›æ‰§è¡Œå®Œå°±å¯ä»¥äº†ã€‚<br>ç„¶åä½ å°±èƒ½åœ¨ä½ çš„<code>/ijkplayer-android/android/ijkplayer</code>è·¯å¾„ä¸‹å°±èƒ½çœ‹åˆ°ç¼–è¯‘åçš„é¡¹ç›®äº†ï¼Œå…¶ä¸­æ¯ä¸ª<code>moduleçš„/src/mian/libs</code>é‡Œé¢å°±æ˜¯soæ–‡ä»¶ã€‚</p><h1 id="3-æœ€å"><a href="#3-æœ€å" class="headerlink" title="3. æœ€å"></a>3. æœ€å</h1><p>ä½ å¯ä»¥ç›´æ¥é€šè¿‡AndroidStudioæ‰“å¼€<code>/ijkplayer-android/android/ijkplayer</code>ï¼Œç„¶ååœ¨é‡Œé¢çš„<code>/ijkplayer-example</code>ä¸‹è°¢ä½ è‡ªå·±çš„ä»£ç å°±å¯ä»¥äº†ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Android/">Android</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/ijkplayer/">ijkplayer</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E9%9F%B3%E8%A7%86%E9%A2%91/">éŸ³è§†é¢‘</category>
      
      
      <comments>https://www.littlecorgi.top/posts/d61d5542.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Androidç½‘ç»œè¯·æ±‚4--è§£æRetrofitæºç </title>
      <link>https://www.littlecorgi.top/posts/a2a8de56.html</link>
      <guid>https://www.littlecorgi.top/posts/a2a8de56.html</guid>
      <pubDate>Tue, 06 Aug 2019 06:34:05 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;1-Retrofitç®€ä»‹&quot;&gt;&lt;a href=&quot;#1-Retrofitç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;1. Retrofitç®€ä»‹&quot;&gt;&lt;/a&gt;1. Retrofitç®€ä»‹&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/square/retrofit&quot;&gt;Retrofit - github&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://square.github.io/retrofit/&quot;&gt;Retrofit - Doc&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;Retrofit&lt;/code&gt;æ˜¯Squareå…¬å¸çš„åˆä¸€åŠ›ä½œï¼Œé’ˆå¯¹Androidç½‘ç»œè¯·æ±‚çš„æ¡†æ¶ï¼Œéµå¾ª&lt;code&gt;Restful&lt;/code&gt;è®¾è®¡é£æ ¼ï¼Œåº•å±‚åŸºäº&lt;code&gt;OkHttp&lt;/code&gt;ã€‚&lt;br&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="1-Retrofitç®€ä»‹"><a href="#1-Retrofitç®€ä»‹" class="headerlink" title="1. Retrofitç®€ä»‹"></a>1. Retrofitç®€ä»‹</h1><ul><li><a href="https://github.com/square/retrofit">Retrofit - github</a></li><li><a href="https://square.github.io/retrofit/">Retrofit - Doc</a></li></ul><p><code>Retrofit</code>æ˜¯Squareå…¬å¸çš„åˆä¸€åŠ›ä½œï¼Œé’ˆå¯¹Androidç½‘ç»œè¯·æ±‚çš„æ¡†æ¶ï¼Œéµå¾ª<code>Restful</code>è®¾è®¡é£æ ¼ï¼Œåº•å±‚åŸºäº<code>OkHttp</code>ã€‚<br><span id="more"></span></p><p>ä»–å¯¹æ¯”å…¶ä»–æ¡†æ¶</p><ul><li>æ€§èƒ½æœ€å¥½</li><li>å°è£…ç¨‹åº¦é«˜ï¼Œæ‹“å±•æ€§å·®</li><li>ç®€ä»‹æ˜“ç”¨ï¼Œä»£ç ç®€å•</li><li>è§£è€¦å½»åº•</li><li>å¯ä»¥éå¸¸æ–¹ä¾¿çš„ä¸RxJavaè¿ç”¨</li></ul><h1 id="2-Retrofitç”¨æ³•ï¼ˆå¼‚æ­¥ï¼‰"><a href="#2-Retrofitç”¨æ³•ï¼ˆå¼‚æ­¥ï¼‰" class="headerlink" title="2. Retrofitç”¨æ³•ï¼ˆå¼‚æ­¥ï¼‰"></a>2. Retrofitç”¨æ³•ï¼ˆå¼‚æ­¥ï¼‰</h1><h2 id="2-1-æ·»åŠ ä¾èµ–"><a href="#2-1-æ·»åŠ ä¾èµ–" class="headerlink" title="2.1 æ·»åŠ ä¾èµ–"></a>2.1 æ·»åŠ ä¾èµ–</h2><p>å¯ä»¥åœ¨Retrofit Githubåº“é¡µé¢é‡Œé¢æ‰¾åˆ°æœ€æ–°ç‰ˆæœ¬å·ï¼Œæˆ‘å†™è¿™ç¯‡åšå®¢æ—¶æœ€æ–°ç‰ˆå¯¼å…¥æ–¹å¼</p><p>åœ¨ä½ é¡¹ç›®çš„appçš„<code>build.gradle</code>é‡Œé¢æ·»åŠ <br><code>implementation &#39;com.squareup.retrofit2:retrofit:2.6.1&#39;</code></p><p>åŒæ—¶ï¼Œå¦‚æœä½ éœ€è¦é…å¥—çš„æ•°æ®è½¬æ¢å™¨è¿˜éœ€è¦å¯¼å…¥ä»¥ä¸‹çš„ä¾èµ–</p><ul><li>Gson: <code>com.squareup.retrofit2:converter-gson</code></li><li>Jackson: <code>com.squareup.retrofit2:converter-jackson</code></li><li>Moshi: <code>com.squareup.retrofit2:converter-moshi</code></li><li>Protobuf: <code>com.squareup.retrofit2:converter-protobuf</code></li><li>Wire: <code>com.squareup.retrofit2:converter-wire</code></li><li>Simple XML: <code>com.squareup.retrofit2:converter-simplexml</code></li><li>Scalars (primitives, boxed, and String): <code>com.squareup.retrofit2:converter-scalars</code></li></ul><h2 id="2-2-æ·»åŠ ç½‘ç»œæƒé™"><a href="#2-2-æ·»åŠ ç½‘ç»œæƒé™" class="headerlink" title="2.2 æ·»åŠ ç½‘ç»œæƒé™"></a>2.2 æ·»åŠ ç½‘ç»œæƒé™</h2><p>åœ¨ä½ APPçš„AndroidManifest.xmlé‡Œæ·»åŠ <br><code>&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot;/&gt;</code></p><h2 id="2-3-åˆ›å»º-æ¥æ”¶æœåŠ¡å™¨è¿”å›æ•°æ®-çš„ç±»"><a href="#2-3-åˆ›å»º-æ¥æ”¶æœåŠ¡å™¨è¿”å›æ•°æ®-çš„ç±»" class="headerlink" title="2.3 åˆ›å»º æ¥æ”¶æœåŠ¡å™¨è¿”å›æ•°æ® çš„ç±»"></a>2.3 åˆ›å»º æ¥æ”¶æœåŠ¡å™¨è¿”å›æ•°æ® çš„ç±»</h2><p><em>Reception.java</em><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">puublic <span class="keyword">class</span> <span class="title class_">Reception</span> &#123;</span><br><span class="line">    <span class="comment">// æ ¹æ®è¿”å›æ•°æ®çš„æ ¼å¼å’Œæ•°æ®è§£ææ–¹å¼å®šä¹‰</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="2-4-åˆ›å»º-ç”¨äºæè¿°ç½‘ç»œè¯·æ±‚-çš„æ¥å£"><a href="#2-4-åˆ›å»º-ç”¨äºæè¿°ç½‘ç»œè¯·æ±‚-çš„æ¥å£" class="headerlink" title="2.4 åˆ›å»º ç”¨äºæè¿°ç½‘ç»œè¯·æ±‚ çš„æ¥å£"></a>2.4 åˆ›å»º ç”¨äºæè¿°ç½‘ç»œè¯·æ±‚ çš„æ¥å£</h2><p><em>GetRequest_Interface.interface</em><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">GetRequest_Interface</span> &#123;</span><br><span class="line">    <span class="meta">@GET(&quot;openapi.do?keyfrom=Yanzhikai&amp;key=2032414398&amp;type=data&amp;doctype=json&amp;version=1.1&amp;q=car&quot;)</span></span><br><span class="line">    Call&lt;Translation&gt;  <span class="title function_">getCall</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">// @GETæ³¨è§£çš„ä½œç”¨:é‡‡ç”¨Getæ–¹æ³•å‘é€ç½‘ç»œè¯·æ±‚</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">// getCall() = æ¥æ”¶ç½‘ç»œè¯·æ±‚æ•°æ®çš„æ–¹æ³•</span></span><br><span class="line">    <span class="comment">// å…¶ä¸­è¿”å›ç±»å‹ä¸ºCall&lt;*&gt;ï¼Œ*æ˜¯æ¥æ”¶æ•°æ®çš„ç±»ï¼ˆå³ä¸Šé¢å®šä¹‰çš„Translationç±»ï¼‰</span></span><br><span class="line">    <span class="comment">// å¦‚æœæƒ³ç›´æ¥è·å¾—Responsebodyä¸­çš„å†…å®¹ï¼Œå¯ä»¥å®šä¹‰ç½‘ç»œè¯·æ±‚è¿”å›å€¼ä¸ºCall&lt;ResponseBody&gt;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="2-5-åˆ›å»ºRetrofitå®ä¾‹"><a href="#2-5-åˆ›å»ºRetrofitå®ä¾‹" class="headerlink" title="2.5 åˆ›å»ºRetrofitå®ä¾‹"></a>2.5 åˆ›å»ºRetrofitå®ä¾‹</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Retrofit</span> <span class="variable">retrofit</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Retrofit</span>.Builder()</span><br><span class="line">               .baseUrl(<span class="string">&quot;http://fanyi.youdao.com/&quot;</span>) <span class="comment">// è®¾ç½®ç½‘ç»œè¯·æ±‚çš„Urlåœ°å€</span></span><br><span class="line">               .addConverterFactory(GsonConverterFactory.create()) <span class="comment">// è®¾ç½®æ•°æ®è§£æå™¨</span></span><br><span class="line">               .addCallAdapterFactory(RxJavaCallAdapterFactory.create()) <span class="comment">// æ”¯æŒRxJavaå¹³å°</span></span><br><span class="line">               .build();</span><br></pre></td></tr></table></figure><h2 id="2-6-åˆ›å»ºç½‘ç»œè¯·æ±‚æ¥å£å®ä¾‹"><a href="#2-6-åˆ›å»ºç½‘ç»œè¯·æ±‚æ¥å£å®ä¾‹" class="headerlink" title="2.6 åˆ›å»ºç½‘ç»œè¯·æ±‚æ¥å£å®ä¾‹"></a>2.6 åˆ›å»ºç½‘ç»œè¯·æ±‚æ¥å£å®ä¾‹</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»º ç½‘ç»œè¯·æ±‚æ¥å£ çš„å®ä¾‹</span></span><br><span class="line"><span class="type">GetRequest_Interface</span> <span class="variable">request</span> <span class="operator">=</span> retrofit.create(GetRequest_Interface.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯¹ å‘é€è¯·æ±‚ è¿›è¡Œå°è£…</span></span><br><span class="line">Call&lt;Reception&gt; call = request.getCall();</span><br></pre></td></tr></table></figure><h2 id="2-7-å‘é€ç½‘ç»œè¯·æ±‚"><a href="#2-7-å‘é€ç½‘ç»œè¯·æ±‚" class="headerlink" title="2.7 å‘é€ç½‘ç»œè¯·æ±‚"></a>2.7 å‘é€ç½‘ç»œè¯·æ±‚</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‘é€ç½‘ç»œè¯·æ±‚(å¼‚æ­¥)</span></span><br><span class="line">call.enqueue(<span class="keyword">new</span> <span class="title class_">Callback</span>&lt;Translation&gt;() &#123;</span><br><span class="line">    <span class="comment">//è¯·æ±‚æˆåŠŸæ—¶å›è°ƒ</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onResponse</span><span class="params">(Call&lt;Translation&gt; call, Response&lt;Translation&gt; response)</span> &#123;</span><br><span class="line">        <span class="comment">//è¯·æ±‚å¤„ç†,è¾“å‡ºç»“æœ</span></span><br><span class="line">        response.body().show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¯·æ±‚å¤±è´¥æ—¶å€™çš„å›è°ƒ</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onFailure</span><span class="params">(Call&lt;Translation&gt; call, Throwable throwable)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è¿æ¥å¤±è´¥&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="2-8-å¤„ç†è¿”å›æ•°æ®"><a href="#2-8-å¤„ç†è¿”å›æ•°æ®" class="headerlink" title="2.8 å¤„ç†è¿”å›æ•°æ®"></a>2.8 å¤„ç†è¿”å›æ•°æ®</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‘é€ç½‘ç»œè¯·æ±‚(å¼‚æ­¥)</span></span><br><span class="line">call.enqueue(<span class="keyword">new</span> <span class="title class_">Callback</span>&lt;Translation&gt;() &#123;</span><br><span class="line">    <span class="comment">//è¯·æ±‚æˆåŠŸæ—¶å›è°ƒ</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onResponse</span><span class="params">(Call&lt;Translation&gt; call, Response&lt;Translation&gt; response)</span> &#123;</span><br><span class="line">        <span class="comment">// å¯¹è¿”å›æ•°æ®è¿›è¡Œå¤„ç†</span></span><br><span class="line">        response.body().show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¯·æ±‚å¤±è´¥æ—¶å€™çš„å›è°ƒ</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onFailure</span><span class="params">(Call&lt;Translation&gt; call, Throwable throwable)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è¿æ¥å¤±è´¥&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ç”±äºæœ¬æ–‡çš„æ ¸å¿ƒä¸æ˜¯è®²ç”¨æ³•ï¼Œæ‰€ä»¥å…³äºç”¨æ³•è¿™å—ï¼Œæˆ‘å¹¶æ²¡æœ‰å¤šè®²ï¼Œå¤§å®¶è‹¥æƒ³å¤šäº†è§£ï¼Œå¯ä»¥çœ‹æ­¤åšå®¢ï¼š<a href="https://blog.csdn.net/carson_ho/article/details/73732076">è¿™æ˜¯ä¸€ä»½å¾ˆè¯¦ç»†çš„ Retrofit 2.0 ä½¿ç”¨æ•™ç¨‹ï¼ˆå«å®ä¾‹è®²è§£ï¼‰</a></p><h1 id="3-Retrofitæºç "><a href="#3-Retrofitæºç " class="headerlink" title="3. Retrofitæºç "></a>3. Retrofitæºç </h1><h2 id="3-1-Retrofitå¯¹è±¡æ„é€ æºç "><a href="#3-1-Retrofitå¯¹è±¡æ„é€ æºç " class="headerlink" title="3.1 Retrofitå¯¹è±¡æ„é€ æºç "></a>3.1 Retrofitå¯¹è±¡æ„é€ æºç </h2><p>åº”å¯¹ä¸€ä¸ªæ¡†æ¶çš„æºç é¦–å…ˆä»ä½¿ç”¨å®ƒçš„åœ°æ–¹å¼€å§‹ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹<code>Retrofit</code>çš„åˆ›å»ºä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Retrofit</span> <span class="variable">retrofit</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Retrofit</span>.Builder()</span><br><span class="line">       .baseUrl(<span class="string">&quot;http://fanyi.youdao.com/&quot;</span>)</span><br><span class="line">       .addConverterFactory(GsonConverterFactory.create())</span><br><span class="line">       .build();</span><br></pre></td></tr></table></figure></p><p>æˆ‘ä»¬å¯ä»¥æŠŠå®ƒåˆ†ä¸º5ä¸ªéƒ¨åˆ†æ¥åˆ†ææºç ï¼š<br><img src="https://user-gold-cdn.xitu.io/2018/3/7/161fdeda6c0120c1?imageslim" alt="æºç åˆ†ææ­¥éª¤"></p><p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹ç¬¬ä¸€æ­¥</p><h3 id="3-1-1-æ­¥éª¤1ï¼šRetrofitç±»"><a href="#3-1-1-æ­¥éª¤1ï¼šRetrofitç±»" class="headerlink" title="3.1.1 æ­¥éª¤1ï¼šRetrofitç±»"></a>3.1.1 æ­¥éª¤1ï¼šRetrofitç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Retrofit</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;Method, ServiceMethod&lt;?&gt;&gt; serviceMethodCache = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// ç½‘ç»œè¯·æ±‚å·¥å‚</span></span><br><span class="line">    <span class="keyword">final</span> okhttp3.Call.Factory callFactory;</span><br><span class="line">    <span class="comment">// è¯·æ±‚çš„Urlåœ°å€</span></span><br><span class="line">    <span class="keyword">final</span> HttpUrl baseUrl;</span><br><span class="line">    <span class="comment">// æ•°æ®è½¬æ¢å™¨å·¥å‚çš„é›†åˆ</span></span><br><span class="line">    <span class="keyword">final</span> List&lt;Converter.Factory&gt; converterFactories;</span><br><span class="line">    <span class="comment">// ç½‘ç»œè¯·æ±‚é€‚é…å™¨å·¥å‚çš„é›†åˆ</span></span><br><span class="line">    <span class="keyword">final</span> List&lt;CallAdapter.Factory&gt; callAdapterFactories;</span><br><span class="line">    <span class="comment">// å›è°ƒ</span></span><br><span class="line">    <span class="keyword">final</span> <span class="meta">@Nullable</span> Executor callbackExecutor;</span><br><span class="line">    <span class="comment">// æ˜¯å¦æå‰å¯¹ä¸šåŠ¡æ¥å£ä¸­çš„æ³¨è§£è¿›è¡ŒéªŒè¯è½¬æ¢çš„æ ‡å¿—ä½</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">boolean</span> validateEagerly;</span><br><span class="line"></span><br><span class="line">    Retrofit(okhttp3.Call.Factory callFactory, HttpUrl baseUrl,</span><br><span class="line">        List&lt;Converter.Factory&gt; converterFactories, List&lt;CallAdapter.Factory&gt; callAdapterFactories,</span><br><span class="line">        <span class="meta">@Nullable</span> Executor callbackExecutor, <span class="type">boolean</span> validateEagerly) &#123;</span><br><span class="line">        <span class="built_in">this</span>.callFactory = callFactory;</span><br><span class="line">        <span class="built_in">this</span>.baseUrl = baseUrl;</span><br><span class="line">        <span class="built_in">this</span>.converterFactories = converterFactories; <span class="comment">// Copy+unmodifiable at call site.</span></span><br><span class="line">        <span class="built_in">this</span>.callAdapterFactories = callAdapterFactories; <span class="comment">// Copy+unmodifiable at call site.</span></span><br><span class="line">        <span class="built_in">this</span>.callbackExecutor = callbackExecutor;</span><br><span class="line">        <span class="built_in">this</span>.validateEagerly = validateEagerly;</span><br><span class="line">    &#125;</span><br><span class="line">    ...<span class="comment">// çœç•¥åé¢çš„ä»£ç </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>Retrofit</code>çš„æ„é€ æ–¹æ³•éœ€è¦ä¸€æ¬¡æ€§æŠŠéœ€è¦çš„æ•°æ®å…¨éƒ¨å‡†å¤‡å¥½ã€‚<br>è€Œä¸”è¿™å—æœ‰ç‰¹åˆ«å¤šçš„å·¥å‚ï¼Œä½¿ç”¨äº†å·¥å‚æ¨¡å¼ã€‚è¿™ä¸ªæˆ‘ä»¬ä¹‹åå†è®²ï¼Œæ¥ä¸‹æ¥çœ‹æ­¥éª¤2ï¼š</p><h3 id="3-1-2-æ­¥éª¤2ï¼šBuilder-æ–¹æ³•"><a href="#3-1-2-æ­¥éª¤2ï¼šBuilder-æ–¹æ³•" class="headerlink" title="3.1.2 æ­¥éª¤2ï¼šBuilder()æ–¹æ³•"></a>3.1.2 æ­¥éª¤2ï¼šBuilder()æ–¹æ³•</h3><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹<code>Builder()</code>æ–¹æ³•çš„æºç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">Builder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>(Platform.get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œè°ƒç”¨äº†<code>Rlatform.get()</code>æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> Platform <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> PLATFORM;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><code>PLATFORM</code>çš„å®šä¹‰å°±åœ¨ä¸Šé¢ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Platform</span> <span class="variable">PLATFORM</span> <span class="operator">=</span> findPlatform();</span><br></pre></td></tr></table></figure></p><p>æˆ‘ä»¬å†æ¥çœ‹ä¸‹<code>findPlatform()</code>æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Platform <span class="title function_">findPlatform</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Class.forName(<span class="string">&quot;android.os.Build&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Android</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassNotFoundException ignored) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Platform</span>(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™å—åˆ›å»ºäº†ä¸€ä¸ª<code>Android</code>å¯¹è±¡ï¼Œæ¥ç€è¿”å›äº†ä¼ å…¥<code>true</code>åˆ›å»ºçš„<code>Platform</code>å¯¹è±¡ã€‚æˆ‘ä»¬å†æ¥çœ‹ä¸‹<code>Android</code>ç±»ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Android</span> <span class="keyword">extends</span> <span class="title class_">Platform</span> &#123;</span><br><span class="line">    Android() &#123;</span><br><span class="line">        <span class="built_in">super</span>(Build.VERSION.SDK_INT &gt;= <span class="number">24</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="keyword">public</span> Executor <span class="title function_">defaultCallbackExecutor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// è¿”å›ä¸€ä¸ªé»˜è®¤çš„å›è°ƒæ–¹æ³•æ‰§è¡Œå™¨</span></span><br><span class="line">        <span class="comment">// è¯¥æ‰§è¡Œå™¨ä½œç”¨ï¼šåˆ‡æ¢çº¿ç¨‹ï¼ˆå­-&gt;&gt;ä¸»çº¿ç¨‹ï¼‰ï¼Œå¹¶åœ¨ä¸»çº¿ç¨‹ï¼ˆUIçº¿ç¨‹ï¼‰ä¸­æ‰§è¡Œå›è°ƒæ–¹æ³•</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MainThreadExecutor</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MainThreadExecutor</span> <span class="keyword">implements</span> <span class="title class_">Executor</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–ä¸Android ä¸»çº¿ç¨‹ç»‘å®šçš„Handler </span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Handler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Handler</span>(Looper.getMainLooper());</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(Runnable r)</span> &#123;</span><br><span class="line">            <span class="comment">// è¯¥Handleræ˜¯ä¸Šé¢è·å–çš„ä¸Android ä¸»çº¿ç¨‹ç»‘å®šçš„Handler </span></span><br><span class="line">            <span class="comment">// åœ¨UIçº¿ç¨‹è¿›è¡Œå¯¹ç½‘ç»œè¯·æ±‚è¿”å›æ•°æ®å¤„ç†ç­‰æ“ä½œã€‚</span></span><br><span class="line">            handler.post(r);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="3-1-3-æ­¥éª¤3ï¼šbaseUrl-æ–¹æ³•"><a href="#3-1-3-æ­¥éª¤3ï¼šbaseUrl-æ–¹æ³•" class="headerlink" title="3.1.3 æ­¥éª¤3ï¼šbaseUrl()æ–¹æ³•"></a>3.1.3 æ­¥éª¤3ï¼šbaseUrl()æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Builder <span class="title function_">baseUrl</span><span class="params">(String baseUrl)</span> &#123;</span><br><span class="line">    Objects.requireNonNull(baseUrl, <span class="string">&quot;baseUrl == null&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> baseUrl(HttpUrl.get(baseUrl));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åè¿˜æ˜¯è°ƒç”¨äº†ä¸€ä¸ª<code>baseUrl()</code>æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ª<code>baseUrl()</code>æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Builder <span class="title function_">baseUrl</span><span class="params">(HttpUrl baseUrl)</span> &#123;</span><br><span class="line">    Objects.requireNonNull(baseUrl, <span class="string">&quot;baseUrl == null&quot;</span>);</span><br><span class="line">    <span class="comment">// æŠŠURLå‚æ•°åˆ†å‰²æˆå‡ ä¸ªè·¯å¾„ç¢ç‰‡</span></span><br><span class="line">    List&lt;String&gt; pathSegments = baseUrl.pathSegments();</span><br><span class="line">    <span class="comment">// æ£€æµ‹æœ€åä¸€ä¸ªç¢ç‰‡æ¥æ£€æŸ¥URLå‚æ•°æ˜¯ä¸æ˜¯ä»¥&quot;/&quot;ç»“å°¾,ä¸æ˜¯å°±æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="string">&quot;&quot;</span>.equals(pathSegments.get(pathSegments.size() - <span class="number">1</span>))) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;baseUrl must end in /: &quot;</span> + baseUrl);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.baseUrl = baseUrl;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æ­¥éª¤3ç”¨äºè®¾ç½®ç½‘ç»œè¯·æ±‚çš„<code>Url</code></p><h3 id="3-1-4-æ­¥éª¤4ï¼šaddConverterFactory-æ–¹æ³•"><a href="#3-1-4-æ­¥éª¤4ï¼šaddConverterFactory-æ–¹æ³•" class="headerlink" title="3.1.4 æ­¥éª¤4ï¼šaddConverterFactory()æ–¹æ³•"></a>3.1.4 æ­¥éª¤4ï¼šaddConverterFactory()æ–¹æ³•</h3><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹<code>GsonConverterFactory.create()</code>æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> GsonConverterFactory <span class="title function_">create</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> create(<span class="keyword">new</span> <span class="title class_">Gson</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åˆè°ƒç”¨äº†å¦ä¸€ä¸ª<code>create()</code>æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> GsonConverterFactory <span class="title function_">create</span><span class="params">(Gson gson)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (gson == <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;gson == null&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">GsonConverterFactory</span>(gson);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¦‚æœä¼ å…¥çš„<code>gson</code>ä¸ºç©ºå°±æŠ¥å¼‚å¸¸ï¼Œä¸ä¸ºç©ºå°±è°ƒç”¨<code>GsonConverterFactory</code>çš„æ„é€ æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="title function_">GsonConverterFactory</span><span class="params">(Gson gson)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.gson = gson;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ‰€ä»¥è¿™ä¸ªæ–¹æ³•æœ¬è´¨å°±æ˜¯è¿”å›äº†ä¸€ä¸ª<code>gson</code>å¯¹è±¡ç»™äº†<code>addConverterFactory()</code>æ–¹æ³•ï¼Œé‚£æˆ‘ä»¬å†æ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** ä¸ºå¯¹è±¡çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ·»åŠ è½¬æ¢å™¨å·¥å‚ã€‚ */</span></span><br><span class="line"><span class="keyword">public</span> Builder <span class="title function_">addConverterFactory</span><span class="params">(Converter.Factory factory)</span> &#123;</span><br><span class="line">    converterFactories.add(Objects.requireNonNull(factory, <span class="string">&quot;factory == null&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æ­¥éª¤4åˆ›å»ºäº†ä¸€ä¸ªå«æœ‰<code>Gson</code>å®ä¾‹çš„<code>GsonConverterFactory</code>å¯¹è±¡ï¼Œå¹¶æ”¾å…¥äº†<code>ConverterFactory</code>ã€‚</p><h3 id="3-1-5-æ­¥éª¤5ï¼šbuild-æ–¹æ³•"><a href="#3-1-5-æ­¥éª¤5ï¼šbuild-æ–¹æ³•" class="headerlink" title="3.1.5 æ­¥éª¤5ï¼šbuild()æ–¹æ³•"></a>3.1.5 æ­¥éª¤5ï¼šbuild()æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Retrofit <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (baseUrl == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Base URL required.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é…ç½®ç½‘ç»œè¯·æ±‚æ‰§è¡Œå™¨</span></span><br><span class="line">    okhttp3.Call.<span class="type">Factory</span> <span class="variable">callFactory</span> <span class="operator">=</span> <span class="built_in">this</span>.callFactory;</span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰æŒ‡å®šcallFactoryï¼Œåˆ™åˆ›å»ºOkHttpClient</span></span><br><span class="line">    <span class="keyword">if</span> (callFactory == <span class="literal">null</span>) &#123;</span><br><span class="line">        callFactory = <span class="keyword">new</span> <span class="title class_">OkHttpClient</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é…ç½®å›è°ƒæ‰§è¡Œå™¨</span></span><br><span class="line">    <span class="type">Executor</span> <span class="variable">callbackExecutor</span> <span class="operator">=</span> <span class="built_in">this</span>.callbackExecutor;</span><br><span class="line">    <span class="keyword">if</span> (callbackExecutor == <span class="literal">null</span>) &#123;</span><br><span class="line">        callbackExecutor = platform.defaultCallbackExecutor();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é…ç½®ç½‘ç»œè¯·æ±‚é€‚é…å™¨å·¥å‚</span></span><br><span class="line">    List&lt;CallAdapter.Factory&gt; callAdapterFactories = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(<span class="built_in">this</span>.callAdapterFactories);</span><br><span class="line">    callAdapterFactories.addAll(platform.defaultCallAdapterFactories(callbackExecutor));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é…ç½®æ•°æ®è½¬æ¢å™¨å·¥å‚</span></span><br><span class="line">    List&lt;Converter.Factory&gt; converterFactories = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(</span><br><span class="line">        <span class="number">1</span> + <span class="built_in">this</span>.converterFactories.size() + platform.defaultConverterFactoriesSize());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é¦–å…ˆæ·»åŠ å†…ç½®è½¬æ¢å™¨å·¥å‚ã€‚è¿™å¯ä»¥é˜²æ­¢é‡å†™å®ƒçš„è¡Œä¸ºï¼Œä½†ä¹Ÿå¯ä»¥ç¡®ä¿åœ¨ä½¿ç”¨ä½¿ç”¨ä½¿ç”¨æ‰€æœ‰ç±»å‹çš„è½¬æ¢å™¨æ—¶æ­£ç¡®çš„è¡Œä¸ºã€‚</span></span><br><span class="line">    converterFactories.add(<span class="keyword">new</span> <span class="title class_">BuiltInConverters</span>());</span><br><span class="line">    converterFactories.addAll(<span class="built_in">this</span>.converterFactories);</span><br><span class="line">    converterFactories.addAll(platform.defaultConverterFactories());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Retrofit</span>(callFactory, baseUrl, unmodifiableList(converterFactories),</span><br><span class="line">        unmodifiableList(callAdapterFactories), callbackExecutor, validateEagerly);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŒ‰å‰é¢é…ç½®çš„å˜é‡ï¼Œå°†<code>Retrofit</code>æ‰€æœ‰çš„å˜é‡éƒ½é…ç½®å¥½ï¼Œæœ€åå®Œæˆåˆ›å»º<code>Retrofit</code>å®ä¾‹ã€‚</p><p>åˆ°è¿™Retrofitçš„åˆ›å»ºéƒ¨åˆ†å°±å®Œäº†ã€‚<br>Retrofité€šè¿‡å»ºé€ è€…æ¨¡å¼åˆ›å»ºäº†ä¸€ä¸ªRetrofitå®ä¾‹ï¼š</p><ul><li>è¯·æ±‚å·¥å‚callFactoryï¼šé»˜è®¤æ˜¯OkHttpClient</li><li>æ•°æ®è½¬æ¢å™¨å·¥å‚converterFactories</li><li>ç½‘ç»œè¯·æ±‚é€‚é…å™¨å·¥å‚callAdapterFactoriesï¼šé»˜è®¤æ˜¯ExecutorCallAdapterFactory</li><li>å›è°ƒæ‰§è¡Œå™¨callbackExecutor</li></ul><p><img src="https://cdn.littlecorgi.top/mweb/Retrofitå¯¹è±¡æ„å»ºæµç¨‹.jpg" alt="Retrofitå¯¹è±¡æ„å»ºæµç¨‹"></p><h2 id="3-2-åˆ›å»ºç½‘ç»œè¯·æ±‚æ¥å£çš„å®ä¾‹"><a href="#3-2-åˆ›å»ºç½‘ç»œè¯·æ±‚æ¥å£çš„å®ä¾‹" class="headerlink" title="3.2 åˆ›å»ºç½‘ç»œè¯·æ±‚æ¥å£çš„å®ä¾‹"></a>3.2 åˆ›å»ºç½‘ç»œè¯·æ±‚æ¥å£çš„å®ä¾‹</h2><p>å¤§è‡´åˆ›å»ºæ–¹æ³•å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Reception.java --&gt;</span><br><span class="line">puublic <span class="keyword">class</span> <span class="title class_">Reception</span> &#123;</span><br><span class="line">    <span class="comment">// æ ¹æ®è¿”å›æ•°æ®çš„æ ¼å¼å’Œæ•°æ®è§£ææ–¹å¼å®šä¹‰</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;!-- GetRequest_Interface.interface --&gt;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">GetRequest_Interface</span> &#123;</span><br><span class="line">    <span class="meta">@GET(&quot;openapi.do?keyfrom=Yanzhikai&amp;key=2032414398&amp;type=data&amp;doctype=json&amp;version=1.1&amp;q=car&quot;)</span></span><br><span class="line">    Call&lt;Translation&gt;  <span class="title function_">getCall</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">// @GETæ³¨è§£çš„ä½œç”¨:é‡‡ç”¨Getæ–¹æ³•å‘é€ç½‘ç»œè¯·æ±‚</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">// getCall() = æ¥æ”¶ç½‘ç»œè¯·æ±‚æ•°æ®çš„æ–¹æ³•</span></span><br><span class="line">    <span class="comment">// å…¶ä¸­è¿”å›ç±»å‹ä¸ºCall&lt;*&gt;ï¼Œ*æ˜¯æ¥æ”¶æ•°æ®çš„ç±»ï¼ˆå³ä¸Šé¢å®šä¹‰çš„Translationç±»ï¼‰</span></span><br><span class="line">    <span class="comment">// å¦‚æœæƒ³ç›´æ¥è·å¾—Responsebodyä¸­çš„å†…å®¹ï¼Œå¯ä»¥å®šä¹‰ç½‘ç»œè¯·æ±‚è¿”å›å€¼ä¸ºCall&lt;ResponseBody&gt;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;!-- MainActivity.java --&gt;</span><br><span class="line"><span class="comment">// åˆ›å»º ç½‘ç»œè¯·æ±‚æ¥å£ çš„å®ä¾‹</span></span><br><span class="line"><span class="type">GetRequest_Interface</span> <span class="variable">request</span> <span class="operator">=</span> retrofit.create(GetRequest_Interface.class);</span><br><span class="line"><span class="comment">//å¯¹ å‘é€è¯·æ±‚ è¿›è¡Œå°è£…</span></span><br><span class="line">Call&lt;Reception&gt; call = request.getCall();</span><br></pre></td></tr></table></figure></p><p>æˆ‘ä»¬å…ˆçœ‹çœ‹<code>retrofit.create()</code>å¹²äº†å•¥ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; T <span class="title function_">create</span><span class="params">(<span class="keyword">final</span> Class&lt;T&gt; service)</span> &#123;</span><br><span class="line">    validateServiceInterface(service);</span><br><span class="line">    <span class="keyword">return</span> (T) Proxy.newProxyInstance(service.getClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>&lt;?&gt;[] &#123; service &#125;,</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">InvocationHandler</span>() &#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Platform</span> <span class="variable">platform</span> <span class="operator">=</span> Platform.get();</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">final</span> Object[] emptyArgs = <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span> <span class="keyword">public</span> <span class="meta">@Nullable</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method,</span></span><br><span class="line"><span class="params">                    <span class="meta">@Nullable</span> Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœè¯¥æ–¹æ³•æ˜¯æ¥è‡ªå¯¹è±¡çš„æ–¹æ³•ï¼Œåˆ™æ¨è¿Ÿåˆ°æ­£å¸¸è°ƒç”¨ã€‚</span></span><br><span class="line">                <span class="keyword">if</span> (method.getDeclaringClass() == Object.class) &#123;</span><br><span class="line">                    <span class="keyword">return</span> method.invoke(<span class="built_in">this</span>, args);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (platform.isDefaultMethod(method)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> platform.invokeDefaultMethod(method, service, proxy, args);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> loadServiceMethod(method).invoke(args != <span class="literal">null</span> ? args : emptyArgs);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>é¦–å…ˆè°ƒç”¨äº†<code>validateServiceInterface()</code>è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">validateServiceInterface</span><span class="params">(Class&lt;?&gt; service)</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœä¸æ˜¯æ¥å£å°±æŠ›å¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">if</span> (!service.isInterface()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;API declarations must be interfaces.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„é€ äº†ä¸€ä¸ªå®¹é‡ä¸‹é™ä¸º1çš„ç©ºåŒå‘é˜Ÿåˆ—æ¥å­˜å‚¨æ•°æ®</span></span><br><span class="line">    Deque&lt;Class&lt;?&gt;&gt; check = <span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">// æ·»åŠ åˆ°é˜Ÿåˆ—</span></span><br><span class="line">    check.add(service);</span><br><span class="line">    <span class="keyword">while</span> (!check.isEmpty()) &#123;</span><br><span class="line">        <span class="comment">// å°†é˜Ÿåˆ—çš„æ­£å‘ç¬¬ä¸€ä¸ªå…ƒç´ ç§»é™¤</span></span><br><span class="line">        Class&lt;?&gt; candidate = check.removeFirst();</span><br><span class="line">        <span class="comment">// getTypeParameters()çš„ä½œç”¨æ˜¯å¾—åˆ°æ³›å‹ç±»å‹ï¼Œå¦‚æœæ³›å‹çš„æ•°é‡ä¸ä¸º0çš„è¯è¿›å…¥</span></span><br><span class="line">        <span class="keyword">if</span> (candidate.getTypeParameters().length != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">StringBuilder</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="string">&quot;Type parameters are unsupported on &quot;</span>)</span><br><span class="line">                .append(candidate.getName());</span><br><span class="line">            <span class="keyword">if</span> (candidate != service) &#123;</span><br><span class="line">                message.append(<span class="string">&quot; which is an interface of &quot;</span>)</span><br><span class="line">                    .append(service.getName());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(message.toString());</span><br><span class="line">        &#125;</span><br><span class="line">        Collections.addAll(check, candidate.getInterfaces());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (validateEagerly) &#123;</span><br><span class="line">        <span class="type">Platform</span> <span class="variable">platform</span> <span class="operator">=</span> Platform.get();</span><br><span class="line">        <span class="keyword">for</span> (Method method : service.getDeclaredMethods()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!platform.isDefaultMethod(method) &amp;&amp; !Modifier.isStatic(method.getModifiers())) &#123;</span><br><span class="line">                loadServiceMethod(method);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è·å–åˆ°<code>Platform</code>ï¼ˆå¹³å°ï¼‰ï¼Œç„¶åå†éå†æ¥å£ä¸­çš„æ–¹æ³•ï¼Œè°ƒç”¨<code>loadServiceMethod()</code>æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ServiceMethod&lt;?&gt; loadServiceMethod(Method method) &#123;</span><br><span class="line">    ServiceMethod&lt;?&gt; result = serviceMethodCache.get(method);</span><br><span class="line">    <span class="keyword">if</span> (result != <span class="literal">null</span>) <span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">synchronized</span> (serviceMethodCache) &#123;</span><br><span class="line">        result = serviceMethodCache.get(method);</span><br><span class="line">        <span class="keyword">if</span> (result == <span class="literal">null</span>) &#123;</span><br><span class="line">            result = ServiceMethod.parseAnnotations(<span class="built_in">this</span>, method);</span><br><span class="line">            serviceMethodCache.put(method, result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¿™ä¸ªæ–¹æ³•ä¸»è¦å°±æ˜¯é€šè¿‡<code>serviceMethodCache</code>æ¥å­˜å‚¨è½¬æ¢ä¸º<code>ServiceMethod</code>ç±»å‹çš„<code>Method</code>ã€‚</p><p>é‚£æˆ‘ä»¬åœ¨å›è¿‡å»çœ‹<code>InvocationHandler</code>çš„<code>invoke()</code>æ–¹æ³•ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">InvocationHandler</span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Platform</span> <span class="variable">platform</span> <span class="operator">=</span> Platform.get();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object[] emptyArgs = <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="keyword">public</span> <span class="meta">@Nullable</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method,</span></span><br><span class="line"><span class="params">            <span class="meta">@Nullable</span> Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœè¯¥æ–¹æ³•æ˜¯æ¥è‡ªå¯¹è±¡çš„æ–¹æ³•ï¼Œåˆ™æ¨è¿Ÿåˆ°æ­£å¸¸è°ƒç”¨ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (method.getDeclaringClass() == Object.class) &#123;</span><br><span class="line">            <span class="keyword">return</span> method.invoke(<span class="built_in">this</span>, args);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (platform.isDefaultMethod(method)) &#123;</span><br><span class="line">            <span class="keyword">return</span> platform.invokeDefaultMethod(method, service, proxy, args);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> loadServiceMethod(method).invoke(args != <span class="literal">null</span> ? args : emptyArgs);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><br>ä¸¤ä¸ªifå…ˆä¸ç®¡ï¼Œå…ˆçœ‹æœ€åçš„<code>return</code>ï¼Œå¯ä»¥çœ‹åˆ°ä»–è°ƒç”¨äº†ä¸€ä¸ª<code>loadServiceMethod()</code>æ–¹æ³•ï¼Œè€Œè¿™ä¸ªæ–¹æ³•åœ¨å‰é¢å°±è¯´è¿‡ï¼Œä¸»è¦å°±è¿”å›äº†ä¸€ä¸ª<code>ServiceMethod</code>ã€‚é‚£æˆ‘ä»¬æ¥ç€æ¥çœ‹<code>invoke()</code>æ–¹æ³•ï¼š<br>æŒ‰ä½<code>command+é¼ æ ‡å·¦é”®</code>è¿›å…¥åï¼Œæ˜¾ç¤ºçš„æ˜¯ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">ServiceMethod</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="keyword">static</span> &lt;T&gt; ServiceMethod&lt;T&gt; <span class="title function_">parseAnnotations</span><span class="params">(Retrofit retrofit, Method method)</span> &#123;</span><br><span class="line">    <span class="type">RequestFactory</span> <span class="variable">requestFactory</span> <span class="operator">=</span> RequestFactory.parseAnnotations(retrofit, method);</span><br><span class="line"></span><br><span class="line">    <span class="type">Type</span> <span class="variable">returnType</span> <span class="operator">=</span> method.getGenericReturnType();</span><br><span class="line">    <span class="keyword">if</span> (Utils.hasUnresolvableType(returnType)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> methodError(method,</span><br><span class="line">          <span class="string">&quot;Method return type must not include a type variable or wildcard: %s&quot;</span>, returnType);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (returnType == <span class="keyword">void</span>.class) &#123;</span><br><span class="line">      <span class="keyword">throw</span> methodError(method, <span class="string">&quot;Service methods cannot return void.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpServiceMethod.parseAnnotations(retrofit, method, requestFactory);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">abstract</span> <span class="meta">@Nullable</span> T <span class="title function_">invoke</span><span class="params">(Object[] args)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¿™ä¸ª<code>invoke()</code>æ ¹æœ¬å°±æ˜¯ä¸ªæŠ½è±¡æ–¹æ³•å•Šï¼Œç„¶åæˆ‘åˆå›å»æ‰¾çœ‹çœ‹æœ‰æ²¡æœ‰è¯´æ˜¯å“ªä¸ªç»§æ‰¿è‡ª<code>ServiceMethod</code>çš„ç±»å®ç°äº†è¿™ä¸ªæ–¹æ³•ï¼Œç»“æœä¹Ÿæ²¡æ‰¾åˆ°ï¼Œæœ€åæƒ³åˆ°äº†AndroidStudioå¯ä»¥<code>command+å·¦é”®</code>æ‰¾å®ç°äº†è¿™ä¸ªç±»çš„åœ°æ–¹å•Šã€‚äºæ˜¯æˆ‘å°±ç‚¹äº†ä¸‹è¿™ä¸ªç±»ï¼Œç»“æœæˆåŠŸæ‰¾åˆ°äº†<code>HttpServiceMethod</code>è¿™ä¸ªç±»ï¼Œä»–æ˜¯<code>ServiceMethod</code>çš„å­ç±»ä¸­å”¯ä¸€ä¸€ä¸ªå®ç°äº†<code>invoke()</code>æ–¹æ³•çš„ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="keyword">final</span> <span class="meta">@Nullable</span> ReturnT <span class="title function_">invoke</span><span class="params">(Object[] args)</span> &#123;</span><br><span class="line">    Call&lt;ResponseT&gt; call = <span class="keyword">new</span> <span class="title class_">OkHttpCall</span>&lt;&gt;(requestFactory, args, callFactory, responseConverter);</span><br><span class="line">    <span class="keyword">return</span> adapt(call, args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°è¿™å—ä»–åˆ›å»ºäº†ä¸€ä¸ªOkHttpCallå¯¹è±¡ï¼Œæ­¤å¤„ä¸åšè¯¦è§£ï¼Œå¯ä»¥çœ‹æˆ‘å…³äºOkHttpçš„ä¸€ç¯‡åšå®¢ï¼š<a href="https://www.littlecorgi.top/posts/151ac78a.html">Androidç½‘ç»œè¯·æ±‚3â€”è§£æOkHttpæºç </a>ã€‚ç„¶åè°ƒç”¨äº†adaptæ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="meta">@Nullable</span> ReturnT <span class="title function_">adapt</span><span class="params">(Call&lt;ResponseT&gt; call, Object[] args)</span>;</span><br></pre></td></tr></table></figure><br>è¿™åˆæ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ã€‚åªä¸è¿‡å¥½çš„æ˜¯ï¼Œè¿™ä¸ªæ–¹æ³•ä¸‹é¢æˆ‘ä»¬å°±æ‰¾åˆ°äº†ä»–çš„å®ç°ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">CallAdapted</span>&lt;ResponseT, ReturnT&gt; <span class="keyword">extends</span> <span class="title class_">HttpServiceMethod</span>&lt;ResponseT, ReturnT&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CallAdapter&lt;ResponseT, ReturnT&gt; callAdapter;</span><br><span class="line"></span><br><span class="line">    CallAdapted(RequestFactory requestFactory, okhttp3.Call.Factory callFactory,</span><br><span class="line">            Converter&lt;ResponseBody, ResponseT&gt; responseConverter,</span><br><span class="line">            CallAdapter&lt;ResponseT, ReturnT&gt; callAdapter) &#123;</span><br><span class="line">        <span class="built_in">super</span>(requestFactory, callFactory, responseConverter);</span><br><span class="line">        <span class="built_in">this</span>.callAdapter = callAdapter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="keyword">protected</span> ReturnT <span class="title function_">adapt</span><span class="params">(Call&lt;ResponseT&gt; call, Object[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> callAdapter.adapt(call);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å¯æ˜¯ä»–åˆè¿”å›ç»™äº†ä¸€ä¸ª<code>CallAdapter</code>æ¥å£çš„å®ç°ç±»çš„<code>adapt()</code>æ–¹æ³•ã€‚ã€‚ã€‚ã€‚è‰¹</p><p>æ‰€ä»¥ï¼Œè¿™å—æˆ‘å°±ä¸æ‡‚äº†ï¼Œæˆ‘ä¸çŸ¥é“ä»–åˆ°åº•å’‹å®ç°è¿™ä¸ªçš„è¿™ä¸ªæ–¹æ³•çš„ï¼Œæˆ‘çœ‹äº†ã€ŠAndroidè¿›é˜¶ä¹‹å…‰ã€‹å’Œå…¶å®ƒå¾ˆå¤šåšå®¢ï¼Œä»–ä»¬éƒ½æ˜¯è€ç‰ˆæœ¬çš„<code>Retrofit</code>ï¼Œ<code>create()</code>æ–¹æ³•ä¸åŒï¼Œè€Œä¸”è°ƒç”¨çš„<code>adapt()</code>æ–¹æ³•ä¹Ÿä¸åŒã€‚ã€‚ã€‚</p><p><img src="https://Â¡cdn.littlecorgi.top/mweb/Retrofitç½‘ç»œè¯·æ±‚æ¥å£åˆ›å»º.jpg" alt="Retrofitç½‘ç»œè¯·æ±‚æ¥å£åˆ›å»º"></p><h2 id="3-3-ç½‘ç»œè¯·æ±‚"><a href="#3-3-ç½‘ç»œè¯·æ±‚" class="headerlink" title="3.3 ç½‘ç»œè¯·æ±‚"></a>3.3 ç½‘ç»œè¯·æ±‚</h2><p>ç½‘ç»œè¯·æ±‚è¿™å—Retrofitå®é™…ä¸Šå°±æ˜¯ç”¨OkHttpå®ç°çš„ï¼Œæ‰€ä»¥è¿™å—æˆ‘å°±ä¸åœ¨è¿™å¤šè¯´äº†ï¼Œå¤§å®¶è¦äº†è§£çš„å¯ä»¥çœ‹æˆ‘ä¹‹å‰å†™çš„åšå®¢ï¼š<a href="https://www.littlecorgi.top/posts/151ac78a.html">Androidç½‘ç»œè¯·æ±‚3â€”è§£æOkHttpæºç </a>ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Android/">Android</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E6%BA%90%E7%A0%81/">æºç </category>
      
      <category domain="https://www.littlecorgi.top/tags/kotlin/">kotlin</category>
      
      <category domain="https://www.littlecorgi.top/tags/OkHttp/">OkHttp</category>
      
      <category domain="https://www.littlecorgi.top/tags/Retrofit/">Retrofit</category>
      
      
      <comments>https://www.littlecorgi.top/posts/a2a8de56.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>æ“ä½œç³»ç»Ÿ4--è¿›ç¨‹çš„é€šä¿¡å’Œçº¿ç¨‹</title>
      <link>https://www.littlecorgi.top/posts/30b7e738.html</link>
      <guid>https://www.littlecorgi.top/posts/30b7e738.html</guid>
      <pubDate>Mon, 05 Aug 2019 07:13:43 GMT</pubDate>
      
      <description>&lt;blockquote&gt;
&lt;p&gt;å¤§å®¶å¯ä»¥çœ‹ä¸‹æˆ‘ä½¿ç”¨å¹•å¸ƒè½¯ä»¶ç”»çš„&lt;a href=&quot;https://mubu.com/doc/3Pf0zwzrgw&quot;&gt;æ€ç»´å¯¼å›¾&lt;/a&gt;ï¼Œå¦‚æœå¤§å®¶æƒ³ä½¿ç”¨å¹•å¸ƒå¯ä»¥é€šè¿‡æˆ‘çš„é‚€è¯·é“¾æ¥æ³¨å†Œï¼Œå¯å…è´¹è·å¾—ä¸€ä¸ªæœˆé«˜çº§ä¼šå‘˜&lt;a href=&quot;https://mubu.com/inv/477598&quot;&gt;https://mubu.com/inv/477598&lt;/a&gt;&lt;br&gt;</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>å¤§å®¶å¯ä»¥çœ‹ä¸‹æˆ‘ä½¿ç”¨å¹•å¸ƒè½¯ä»¶ç”»çš„<a href="https://mubu.com/doc/3Pf0zwzrgw">æ€ç»´å¯¼å›¾</a>ï¼Œå¦‚æœå¤§å®¶æƒ³ä½¿ç”¨å¹•å¸ƒå¯ä»¥é€šè¿‡æˆ‘çš„é‚€è¯·é“¾æ¥æ³¨å†Œï¼Œå¯å…è´¹è·å¾—ä¸€ä¸ªæœˆé«˜çº§ä¼šå‘˜<a href="https://mubu.com/inv/477598">https://mubu.com/inv/477598</a><br><span id="more"></span></p><h1 id="4-1-è¿›ç¨‹é€šä¿¡"><a href="#4-1-è¿›ç¨‹é€šä¿¡" class="headerlink" title="4.1 è¿›ç¨‹é€šä¿¡"></a>4.1 è¿›ç¨‹é€šä¿¡</h1><p>è¿›ç¨‹é€šä¿¡å°±æ˜¯æŒ‡è¿›ç¨‹ä¹‹é—´çš„ä¿¡æ¯äº¤æ¢ã€‚</p></blockquote><p>æ—©æœŸçš„æ—¶å€™ï¼Œç”±äºæŠ€æœ¯ä¸å‘è¾¾ï¼Œä»¥åŠç”±äºè¿›ç¨‹çš„åŒæ­¥å’Œäº’æ–¥éœ€è¦åœ¨è¿›ç¨‹é—´äº¤æ¢ä¸€å®šçš„æ•°æ®ï¼Œæ‰€ä»¥ä¸å°‘äººä¹Ÿå°†ä»–ä»¬ç§°ä¸ºè¿›ç¨‹é€šä¿¡ï¼Œä½†æ˜¯å®è´¨ä¸Šä»–ä»¬åªèƒ½è¢«æˆä¸ºä½çº§çš„è¿›ç¨‹é€šä¿¡ã€‚<br>ä»¥ä¿¡å·é‡ä¸ºä¾‹ï¼Œä»–</p><ol><li>æ•ˆç‡ä½<br> ç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…æ¯æ¬¡åªèƒ½å‘ç¼“å†²åŒºæŠ•æ”¾ä¸€ä¸ªäº§å“æˆ–è€…å–å‡ºä¸€ä¸ªäº§å“ã€‚</li><li>é€šä¿¡å¯¹ç”¨æˆ·ä¸é€æ˜</li></ol><p>è€Œå…³äºè¿›ç¨‹é—´é€šä¿¡æ‰€éœ€çš„æ•°æ®ç»“æ„çš„è®¾ç½®å’Œæ•°æ®çš„ä¼ é€ã€è¿›ç¨‹çš„åŒæ­¥å’Œäº’æ–¥ï¼Œéƒ½éœ€è¦ç¨‹åºå‘˜å»å®Œæˆï¼Œæ˜¾ç„¶æ˜¯éå¸¸ä¸æ–¹ä¾¿çš„ã€‚</p><p>æ‰€ä»¥é«˜çº§è¿›ç¨‹é€šä¿¡å¿…é¡»æ»¡è¶³å¦‚ä¸‹ç‰¹ç‚¹ï¼š</p><ol><li>ä½¿ç”¨æ–¹ä¾¿ã€‚<br> OSéšè—äº†å®ç°è¿›ç¨‹é€šä¿¡çš„å…·ä½“ç»†èŠ‚ï¼Œå‘ç”¨æˆ·æä¾›äº†ä¸€ç»„ç”¨äºå®ç°é«˜çº§é€šä¿¡çš„å‘½ä»¤ï¼Œç”¨æˆ·å¯ä»¥æ–¹ä¾¿åœ°ç›´æ¥åˆ©ç”¨å®ƒå®ç°è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚</li><li>é«˜æ•ˆçš„ä¼ é€æ•°æ®ã€‚<br> ç”¨æˆ·å¯ä»¥ç›´æ¥åˆ©ç”¨é«˜çº§é€šä¿¡å‘½ä»¤é«˜æ•ˆçš„ä¼ é€å¤§é‡çš„æ•°æ®ã€‚</li></ol><p>è¿›ç¨‹é€šä¿¡ä¸»è¦æœ‰å…±äº«å­˜å‚¨å™¨ç³»ç»Ÿã€ç®¡é“é€šä¿¡ç³»ç»Ÿã€æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿä»¥åŠå®¢æˆ·æœº-æœåŠ¡å™¨ç³»ç»Ÿã€‚</p><h2 id="4-1-1-å…±äº«å­˜å‚¨å™¨ç³»ç»Ÿ"><a href="#4-1-1-å…±äº«å­˜å‚¨å™¨ç³»ç»Ÿ" class="headerlink" title="4.1.1 å…±äº«å­˜å‚¨å™¨ç³»ç»Ÿ"></a>4.1.1 å…±äº«å­˜å‚¨å™¨ç³»ç»Ÿ</h2><p>å…±äº«å­˜å‚¨å™¨ç³»ç»Ÿåˆåˆ†ä¸ºäº†ä¸¤ç§ï¼š</p><ol><li>åŸºäºå…±äº«æ•°æ®ç»“æ„çš„é€šä¿¡æ–¹å¼<br> åœ¨è¿™ç§é€šä¿¡æ–¹å¼ä¸‹ï¼Œè¦æ±‚è¿›ç¨‹å…¬ç”¨æŸäº›æ•°æ®ç»“æ„ï¼Œå€Ÿä»¥å®ç°è¯¸è¿›ç¨‹é—´çš„ä¿¡æ¯äº¤æ¢ã€‚è¿™ç§æ–¹å¼ä»…é€‚ç”¨äºä¼ é€’ç›¸å¯¹å°‘é‡çš„æ•°æ®ï¼Œé€šä¿¡æ•ˆç‡ä½ä¸‹ï¼Œå±äºä½çº§é€šä¿¡ã€‚</li><li>åŸºäºå…±äº«å­˜å‚¨åŒºçš„é€šä¿¡æ–¹å¼<br> ä¸ºäº†ä¼ è¾“å¤§é‡æ•°æ®ï¼Œå°±åœ¨å†…å­˜ä¸­åˆ’å‡ºäº†ä¸€å—å…±äº«å­˜å‚¨åŒºåŸŸï¼Œè¯¸è¿›ç¨‹å¯é€šè¿‡å¯¹è¯¥å…±äº«åŒºçš„è¯»æˆ–å†™äº¤æ¢æ•°æ®ï¼Œå®ç°é€šä¿¡ï¼Œæ•°æ®çš„å½¢å¼å’Œä½ç½®ç”šè‡³è®¿é—®æ§åˆ¶éƒ½æ˜¯ç”±è¿›ç¨‹è´Ÿè´£ï¼Œè€Œä¸æ˜¯OSã€‚</li></ol><h2 id="4-1-2-ç®¡é“é€šä¿¡ç³»ç»Ÿ"><a href="#4-1-2-ç®¡é“é€šä¿¡ç³»ç»Ÿ" class="headerlink" title="4.1.2 ç®¡é“é€šä¿¡ç³»ç»Ÿ"></a>4.1.2 ç®¡é“é€šä¿¡ç³»ç»Ÿ</h2><p>æ‰€è°“ç®¡é“ï¼Œæ˜¯æŒ‡ç”¨äºè¿æ¥ä¸€ä¸ªè¯»è¿›ç¨‹å’Œä¸€ä¸ªå†™è¿›ç¨‹ä»¥å®ç°ä»–ä»¬ä¹‹é—´é€šä¿¡çš„ä¸€å—å…±äº«å­˜å‚¨æ–‡ä»¶ï¼Œåˆå«pipeæ–‡ä»¶ã€‚<br>å‘ç®¡é“æä¾›è¾“å…¥çš„å‘é€è¿›ç¨‹ä»¥å­—ç¬¦æµå½¢å¼å°†è¾¾é‡çš„æ•°æ®é€å…¥ç®¡é“ï¼Œè€Œæ¥æ”¶ç®¡é“è¾“å‡ºçš„æ¥æ”¶è¿›ç¨‹åˆ™ä»ç®¡é“ä¸­æ¥æ”¶æ•°æ®ã€‚<br>è¿™ç§æ–¹å¼æ˜¯UNIXç³»ç»ŸIPCæœ€å¤è€çš„å½¢å¼ã€‚</p><p>ä¸ºäº†åè°ƒåŒæ–¹çš„é€šä¿¡ï¼Œä»–å¿…é¡»æä¾›ä¸€ä¸‹ä¸‰ä¸ªåŠŸèƒ½çš„åè°ƒèƒ½åŠ›ï¼š</p><ol><li>äº’æ–¥</li><li>åŒæ­¥</li><li>ç¡®å®šå¯¹æ–¹æ˜¯å¦å­˜åœ¨</li></ol><h2 id="4-1-3-æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿ"><a href="#4-1-3-æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿ" class="headerlink" title="4.1.3 æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿ"></a>4.1.3 æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿ</h2><p>åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œé›†æˆä¸å†å€ŸåŠ©ä»»ä½•å…±äº«å­˜å‚¨åŒºæˆ–æ•°æ®ç»“æ„ï¼Œè€Œæ˜¯ä»¥æ ¼å¼åŒ–çš„æ¶ˆæ¯(Message)ä¸ºå•ä½ï¼Œå°†é€šä¿¡çš„æ•°æ®å°è£…åœ¨æ¶ˆæ¯ä¸­ï¼Œå¹¶åˆ©ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„ä¸€ç»„é€šä¿¡å‘½ä»¤ï¼Œåœ¨è¿›ç¨‹é—´è¿›è¡Œæ¶ˆæ¯ä¼ é€’ï¼Œå®Œæˆè¿›ç¨‹é—´çš„æ•°æ®äº¤æ¢ã€‚</p><p>è¯¥æ–¹å¼éšè—äº†é€šä¿¡å®ç°ç»†èŠ‚ï¼Œä½¿é€šä¿¡è¿‡ç¨‹å¯¹ç”¨æˆ·é€æ˜åŒ–ï¼Œé™ä½äº†é€šä¿¡ç¨‹åºè®¾è®¡çš„å¤æ‚æ€§å’Œé”™è¯¯ç‡ï¼Œæˆä¸ºå½“å‰åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ä¸€ç±»è¿›ç¨‹é—´çš„é€šä¿¡æœºåˆ¶.</p><h2 id="4-1-4-å®¢æˆ·æœº-æœåŠ¡å™¨ç³»ç»Ÿ"><a href="#4-1-4-å®¢æˆ·æœº-æœåŠ¡å™¨ç³»ç»Ÿ" class="headerlink" title="4.1.4 å®¢æˆ·æœº-æœåŠ¡å™¨ç³»ç»Ÿ"></a>4.1.4 å®¢æˆ·æœº-æœåŠ¡å™¨ç³»ç»Ÿ</h2><p>å‰é¢çš„å‡ ç§é€šä¿¡ç³»ç»Ÿï¼Œè™½ç„¶ä¹Ÿå¯ä»¥ç”¨äºå®ç°ä¸åŒè®¡ç®—æœºé—´è¿›ç¨‹çš„åŒå‘é€šä¿¡ï¼Œä½†æ˜¯å®¢æˆ·æœº-æœåŠ¡å™¨ç³»ç»Ÿçš„é€šä¿¡æœºåˆ¶ï¼Œåœ¨ç½‘ç»œç¯å¢ƒçš„å„ç§åº”ç”¨é¢†åŸŸå·²æˆä¸ºå½“å‰ä¸»æµçš„é€šä¿¡å®ç°æœºåˆ¶ï¼Œä¸»è¦åˆ†ä¸ºä¸‰ç±»ï¼šå¥—æ¥å­—ã€è¿œç¨‹è¿‡ç¨‹è°ƒç”¨å’Œè¿œç¨‹æ–¹æ³•è°ƒç”¨ã€‚åœ¨è¿™å°±ä¸å¤šèµ˜è¿°äº†ã€‚</p><h1 id="4-2-çº¿ç¨‹"><a href="#4-2-çº¿ç¨‹" class="headerlink" title="4.2 çº¿ç¨‹"></a>4.2 çº¿ç¨‹</h1><h2 id="4-2-1-ä¸ºä»€ä¹ˆè¦å¼•å…¥çº¿ç¨‹"><a href="#4-2-1-ä¸ºä»€ä¹ˆè¦å¼•å…¥çº¿ç¨‹" class="headerlink" title="4.2.1 ä¸ºä»€ä¹ˆè¦å¼•å…¥çº¿ç¨‹"></a>4.2.1 ä¸ºä»€ä¹ˆè¦å¼•å…¥çº¿ç¨‹</h2><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œè¿›ç¨‹æœ‰ä¸¤ä¸ªåŸºæœ¬å±æ€§ï¼šâ‘ è¿›ç¨‹æ˜¯ä¸€ä¸ªå¯æ‹¥æœ‰èµ„æºçš„ç‹¬ç«‹å•ä½ï¼Œä¸€ä¸ªè¿›ç¨‹è¦èƒ½ç‹¬ç«‹è¿è¡Œï¼Œä»–å¿…é¡»æ‹¥æœ‰ä¸€å®šçš„æ•°æ®ç»“æ„ã€‚â‘¡è¿›ç¨‹åŒæ—¶åˆæ˜¯ä¸€ä¸ªå¯ç‹¬ç«‹è°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½ã€‚</p><p>ä¸ºäº†ç¨‹åºèƒ½å¹¶å‘æ‰§è¡Œï¼Œç³»ç»Ÿå¿…é¡»èƒ½è¿›è¡Œåˆ›å»ºè¿›ç¨‹ã€æ’¤é”€è¿›ç¨‹å’Œåˆ‡æ¢è¿›ç¨‹æ“ä½œã€‚ä½†æ˜¯ç”±äºè¿›ç¨‹æ˜¯èµ„æºçš„æ‹¥æœ‰è€…ï¼Œæ‰€ä»¥åœ¨ä¸Šè¿°è¿™äº›æ“ä½œä¸­ï¼Œç³»ç»Ÿå¿…é¡»ä¸ºä¹‹ä»˜å‡ºè¾ƒå¤§çš„æ—¶ç©ºå¼€é”€ã€‚è¿™å°±é™åˆ¶äº†ç³»ç»Ÿä¸­æ‰€è®¾ç½®è¿›ç¨‹çš„æ•°ç›®ï¼Œè€Œä¸”è¿›ç¨‹åˆ‡æ¢ä¹Ÿä¸å®œè¿‡äºé¢‘ç¹ï¼Œä»è€Œé™åˆ¶äº†å¹¶å‘ç¨‹åº¦çš„è¿›ä¸€æ­¥æé«˜ã€‚</p><h2 id="4-2-2-çº¿ç¨‹çš„æ¦‚å¿µ"><a href="#4-2-2-çº¿ç¨‹çš„æ¦‚å¿µ" class="headerlink" title="4.2.2 çº¿ç¨‹çš„æ¦‚å¿µ"></a>4.2.2 çº¿ç¨‹çš„æ¦‚å¿µ</h2><p>åœ¨ä¸Šè¿°åŸå› ä¸‹ï¼Œå¼•å…¥äº†çº¿ç¨‹çš„æ¦‚å¿µã€‚å­¦è€…ä»¬å°†è¿›ç¨‹çš„ä¸¤ä¸ªå±æ€§åˆ†å¼€ï¼Œè®©ä½œä¸ºè°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½ä¸æ‹¥æœ‰èµ„æºï¼Œè®©æ‹¥æœ‰èµ„æºçš„åŸºæœ¬å•å€ä¸è¢«é¢‘ç¹çš„è°ƒåº¦ã€‚è¿™æ ·çš„è¯ï¼Œå°±å½¢æˆäº†çº¿ç¨‹çš„æ¦‚å¿µã€‚</p><p>ä¸‹é¢æˆ‘ä»¬ä»6ä¸ªæ–¹é¢æ¥æ¯”è¾ƒä¸‹è¿›å’Œçº¿ç¨‹ï¼š</p><ol><li>è°ƒåº¦çš„åŸºæœ¬å•ä½<br> ä¼ ç»ŸOSä¸­ï¼Œè¿›ç¨‹æ˜¯ä½œä¸ºç‹¬ç«‹è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œæ¯æ¬¡è°ƒåº¦æ—¶ï¼Œéƒ½éœ€è¦ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¼€é”€å¤§ã€‚åœ¨å¼•å…¥äº†çº¿ç¨‹çš„OSä¸­ï¼Œçº¿ç¨‹æ˜¯ä½œä¸ºç‹¬ç«‹è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œçº¿ç¨‹åˆ‡æ¢æ—¶åªéœ€è¦ä¿å­˜å’Œè®¾ç½®å°‘é‡çš„å¯„å­˜å™¨å†…å®¹ï¼Œåˆ‡æ¢ä»£ä»·è¿œå°äºè¿›ç¨‹ã€‚</li><li>å¹¶å‘æ€§<br> åœ¨å¼•å…¥çº¿ç¨‹çš„OSä¸­ï¼Œä¸ä»…è¿›ç¨‹ä¹‹é—´å¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œè€Œä¸”åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹ä¹‹é—´äº¦å¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œç”šè‡³è¿˜å…è®¸åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­çš„æ‰€æœ‰çº¿ç¨‹éƒ½èƒ½å¹¶å‘æ‰§è¡Œã€‚</li><li>æ‹¥æœ‰èµ„æº<br> è¿›ç¨‹å¯ä»¥æ‹¥æœ‰èµ„æºï¼Œè€Œä¸”è¿˜æ˜¯ç³»ç»Ÿä¸­æ‹¥æœ‰èµ„æºçš„ä¸€ä¸ªåŸºæœ¬å•ä½ã€‚ä½†æ˜¯çº¿ç¨‹æœ¬èº«å¹¶ä¸æ‹¥æœ‰èµ„æºï¼Œè€Œæ˜¯ä»…æœ‰ä¸€ç‚¹å¿…ä¸å¯å°‘çš„ã€èƒ½ä¿è¯ç‹¬ç«‹è¿è¡Œçš„èµ„æºã€‚</li><li>ç‹¬ç«‹æ€§<br> åŒä¸€è¿›ç¨‹ä¸­çš„çº¿ç¨‹ä¹‹é—´çš„ç‹¬ç«‹æ€§æ¯”ä¸åŒè¿›ç¨‹é—´çš„ç‹¬ç«‹æ€§ä½å¾—å¤šã€‚</li><li>ç³»ç»Ÿå¼€é”€<br> è¿›ç¨‹åˆ‡æ¢éœ€è¦å¤§é‡çš„ç³»ç»Ÿå¼€é”€ï¼Œè€Œçº¿ç¨‹é—´åˆ™éœ€è¦çš„å¾ˆå°‘</li><li>æ”¯æŒå¤šå¤„ç†æœºç³»ç»Ÿ<br> åœ¨å¤šå¤„ç†æœºç³»ç»Ÿä¸­ï¼Œå¯¹äºä¼ ç»Ÿè¿›ç¨‹ï¼Œä¸ç®¡æœ‰å¤šå°‘å¤„ç†æœºï¼Œè¯¥è¿›ç¨‹åªèƒ½è¿è¡Œåœ¨ä¸€ä¸ªå¤„ç†æœºä¸Šã€‚ä½†æ˜¯å¯¹äºå¤šçº¿ç¨‹è¿›ç¨‹ï¼Œå¯ä»¥å°†ä¸€ä¸ªè¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹åˆ†é…åˆ°å¤šä¸ªå¤„ç†æœºä¸Šã€‚</li></ol><h2 id="4-2-3-çº¿ç¨‹çš„çŠ¶æ€å’Œçº¿ç¨‹æ§åˆ¶å—"><a href="#4-2-3-çº¿ç¨‹çš„çŠ¶æ€å’Œçº¿ç¨‹æ§åˆ¶å—" class="headerlink" title="4.2.3 çº¿ç¨‹çš„çŠ¶æ€å’Œçº¿ç¨‹æ§åˆ¶å—"></a>4.2.3 çº¿ç¨‹çš„çŠ¶æ€å’Œçº¿ç¨‹æ§åˆ¶å—</h2><p>ä¸è¿›ç¨‹ä¸€æ ·ï¼Œçº¿ç¨‹ä¹Ÿæ‹¥æœ‰ä¸‰ä¸ªçŠ¶æ€å’Œçº¿ç¨‹æ§åˆ¶å—ã€‚</p><h3 id="4-2-3-1-çº¿ç¨‹è¿è¡Œçš„ä¸‰ä¸ªçŠ¶æ€"><a href="#4-2-3-1-çº¿ç¨‹è¿è¡Œçš„ä¸‰ä¸ªçŠ¶æ€" class="headerlink" title="4.2.3.1 çº¿ç¨‹è¿è¡Œçš„ä¸‰ä¸ªçŠ¶æ€"></a>4.2.3.1 çº¿ç¨‹è¿è¡Œçš„ä¸‰ä¸ªçŠ¶æ€</h3><p>çº¿ç¨‹çš„ä¸‰ä¸ªçŠ¶æ€å’Œè¿›ç¨‹ç±»ä¼¼ã€‚</p><ol><li>è¿è¡ŒçŠ¶æ€ï¼Œè¡¨ç¤ºçº¿ç¨‹å·²è·å¾—å¤„ç†æœºè€Œæ­£åœ¨è¿è¡Œã€‚</li><li>å°±ç»ªçŠ¶æ€ï¼Œè¡¨ç¤ºçº¿ç¨‹å·²å…·å¤‡å„ç§æ‰§è¡Œæ¡ä»¶ï¼Œåªé¡»å†è·å¾—CPUä¾¿å¯ç«‹å³æ‰§è¡Œã€‚</li><li>é˜»å¡çŠ¶æ€ï¼Œåªçº¿ç¨‹åœ¨æ‰§è¡Œä¸­å› æŸäº‹ä»¶å—é˜»è€Œå¤„äºæš‚åœçŠ¶æ€ã€‚</li></ol><h3 id="4-2-3-2-çº¿ç¨‹æ§åˆ¶å—TCB"><a href="#4-2-3-2-çº¿ç¨‹æ§åˆ¶å—TCB" class="headerlink" title="4.2.3.2 çº¿ç¨‹æ§åˆ¶å—TCB"></a>4.2.3.2 çº¿ç¨‹æ§åˆ¶å—TCB</h3><p>çº¿ç¨‹æ§åˆ¶å—ç”¨æ¥çºªå½•ç”¨äºæ§åˆ¶å’Œç®¡ç†çº¿ç¨‹çš„ä¿¡æ¯ã€‚<br>çº¿ç¨‹æ§åˆ¶å—ä¸­é€šå¸¸ç”±è¿™å‡ é¡¹ï¼š</p><ol><li>çº¿ç¨‹æ ‡è¯†ç¬¦ï¼Œä¸ºæ¯ä¸ªçº¿ç¨‹è®¾ç½®å”¯ä¸€åœ°æ ‡è¯†ç¬¦ã€‚</li><li>ä¸€ç»„å¯„å­˜å™¨ï¼ŒåŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨PCã€çŠ¶æ€å¯„å­˜å™¨å’Œé€šç”¨å¯„å­˜å™¨çš„å†…å®¹ã€‚</li><li>çº¿ç¨‹è¿è¡ŒçŠ¶æ€ï¼Œç”¨äºæè¿°çº¿ç¨‹æ­£å¤„äºä½•ç§è¿è¡ŒçŠ¶æ€ã€‚</li><li>ä¼˜å…ˆçº§ï¼Œæè¿°çº¿ç¨‹æ‰§è¡Œçš„ä¼˜å…ˆç¨‹åº¦ã€‚</li><li>çº¿ç¨‹ä¸“æœ‰å­˜å‚¨åŒºï¼Œç”¨äºçº¿ç¨‹åˆ‡æ¢æ—¶å­˜æ”¾ç°åœºä¿æŠ¤ä¿¡æ¯ï¼Œå’Œä¸è¯¥çº¿ç¨‹ç›¸å…³çš„ç»Ÿè®¡ä¿¡æ¯ç­‰ã€‚</li><li>ä¿¡å·å±è”½ï¼Œå³å¯¹æŸäº›ä¿¡å·åŠ ä»¥å±è”½ã€‚</li><li>å †æ ˆæŒ‡é’ˆã€‚</li></ol>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ</category>
      
      
      <comments>https://www.littlecorgi.top/posts/30b7e738.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>uCropæ¡†æ¶ç”¨æ³•å’Œæºç è§£æ</title>
      <link>https://www.littlecorgi.top/posts/4e4b8b52.html</link>
      <guid>https://www.littlecorgi.top/posts/4e4b8b52.html</guid>
      <pubDate>Sun, 04 Aug 2019 09:37:57 GMT</pubDate>
      
      <description>&lt;blockquote&gt;
&lt;p&gt;æœ¬äººèƒ½åŠ›ä¸è¶³ï¼Œåœ¨çœ‹åˆ°æºç æœ€åä¸€éƒ¨åˆ†çš„æ—¶å€™å¤§é‡æŠ„è¢­&lt;a href=&quot;https://www.jianshu.com/p/1d3fb16fb412&quot;&gt;å¯èƒ½æ˜¯æœ€è¯¦ç»†çš„UCropæºç è§£æ&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;1-uCropç®€ä»‹&quot;&gt;&lt;a href=&quot;#1-uCropç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;1. uCropç®€ä»‹&quot;&gt;&lt;/a&gt;1. uCropç®€ä»‹&lt;/h1&gt;&lt;p&gt;uCropæ˜¯ç›®å‰è¾ƒç«çš„å›¾ç‰‡è£å‰ªæ¡†æ¶ï¼Œå¼€å‘è€…å®£ç§°ä»–ä¼šæ¯”ç›®å‰å¸‚é¢ä¸Šæ‰€æœ‰çš„å›¾ç‰‡è£å‰ªæ–¹æ¡ˆéƒ½è¦æ›´æµç•…ã€‚å¤–åŠ ä»–å°è£…ç¨‹åº¦è¾ƒé«˜ï¼Œå¯è‡ªå®šä¹‰ï¼Œè€Œä¸”é¢œå€¼å¾ˆé«˜ï¼ˆä¼¼ä¹è¿™ä¸ªæ‰æ˜¯é‡ç‚¹ï¼‰ï¼Œç°åœ¨è¶Šæ¥è¶Šå¤šAPPé€‰æ‹©ä½¿ç”¨å®ƒã€‚&lt;br&gt;&lt;a href=&quot;https://github.com/Yalantis/uCrop&quot;&gt;github&lt;/a&gt;&lt;br&gt;</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>æœ¬äººèƒ½åŠ›ä¸è¶³ï¼Œåœ¨çœ‹åˆ°æºç æœ€åä¸€éƒ¨åˆ†çš„æ—¶å€™å¤§é‡æŠ„è¢­<a href="https://www.jianshu.com/p/1d3fb16fb412">å¯èƒ½æ˜¯æœ€è¯¦ç»†çš„UCropæºç è§£æ</a></p></blockquote><h1 id="1-uCropç®€ä»‹"><a href="#1-uCropç®€ä»‹" class="headerlink" title="1. uCropç®€ä»‹"></a>1. uCropç®€ä»‹</h1><p>uCropæ˜¯ç›®å‰è¾ƒç«çš„å›¾ç‰‡è£å‰ªæ¡†æ¶ï¼Œå¼€å‘è€…å®£ç§°ä»–ä¼šæ¯”ç›®å‰å¸‚é¢ä¸Šæ‰€æœ‰çš„å›¾ç‰‡è£å‰ªæ–¹æ¡ˆéƒ½è¦æ›´æµç•…ã€‚å¤–åŠ ä»–å°è£…ç¨‹åº¦è¾ƒé«˜ï¼Œå¯è‡ªå®šä¹‰ï¼Œè€Œä¸”é¢œå€¼å¾ˆé«˜ï¼ˆä¼¼ä¹è¿™ä¸ªæ‰æ˜¯é‡ç‚¹ï¼‰ï¼Œç°åœ¨è¶Šæ¥è¶Šå¤šAPPé€‰æ‹©ä½¿ç”¨å®ƒã€‚<br><a href="https://github.com/Yalantis/uCrop">github</a><br><span id="more"></span></p><h1 id="2-ä½¿ç”¨æ–¹æ³•"><a href="#2-ä½¿ç”¨æ–¹æ³•" class="headerlink" title="2. ä½¿ç”¨æ–¹æ³•"></a>2. ä½¿ç”¨æ–¹æ³•</h1><p>å¾—ç›ŠäºuCropä¼˜ç§€çš„å°è£…ï¼ŒuCropçš„ä½¿ç”¨æ–¹æ³•ç‰¹ç®€å•ã€‚</p><h2 id="2-1-å¯¼å…¥ä¾èµ–"><a href="#2-1-å¯¼å…¥ä¾èµ–" class="headerlink" title="2.1 å¯¼å…¥ä¾èµ–"></a>2.1 å¯¼å…¥ä¾èµ–</h2><ol><li><p>å…ˆåœ¨é¡¹ç›®çš„<code>build.gradle</code>ä¸­æ·»åŠ </p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">allprojects &#123;</span><br><span class="line">  repositories &#123;</span><br><span class="line">    jcenter()</span><br><span class="line">    maven &#123; url <span class="string">&quot;https://jitpack.io&quot;</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> å¹¶åœ¨<code>module</code>çš„<code>build.gradle</code>ä¸­æ·»åŠ </p><p> <code>implementation &#39;com.github.yalantis:ucrop:2.2.3&#39;</code> - è½»é‡çº§æ¡†æ¶</p><p> <code>implementation &#39;com.github.yalantis:ucrop:2.2.3-native&#39;</code> - è·å¾—æ¡†æ¶å…¨éƒ¨å¼ºå¤§çš„åŠŸèƒ½ä»¥åŠå›¾ç‰‡çš„é«˜è´¨é‡(æœ€ç»ˆå¯èƒ½ä¼šå¯¼è‡´apkçš„å¤§å°å¢åŠ 1.5MBä»¥ä¸Š)</p></li><li>ç”±äºæ¡†æ¶çš„æœ¬è´¨æ˜¯è°ƒç”¨åˆ°å¦ä¸€ä¸ªActivityå»å¤„ç†å›¾ç‰‡ï¼Œæ‰€ä»¥éœ€è¦åœ¨AndroidManifest.xmlä¸­å°†UCropActivityæ·»åŠ è¿›å» <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;com.yalantis.ucrop.UCropActivity&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:screenOrientation</span>=<span class="string">&quot;portrait&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:theme</span>=<span class="string">&quot;@style/Theme.AppCompat.Light.NoActionBar&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></li></ol><p>åˆ°è¿™ä½ å°±èƒ½æŠŠcUropå…¨éƒ¨å¯¼å…¥åˆ°ä½ çš„é¡¹ç›®é‡Œé¢äº†ï¼Œæ¥ä¸‹æ¥å’±ä»¬å°±æ‹‰å°†å¦‚ä½•è°ƒç”¨</p><h2 id="2-2-å¼€å§‹åŸºæœ¬çš„è°ƒç”¨"><a href="#2-2-å¼€å§‹åŸºæœ¬çš„è°ƒç”¨" class="headerlink" title="2.2 å¼€å§‹åŸºæœ¬çš„è°ƒç”¨"></a>2.2 å¼€å§‹åŸºæœ¬çš„è°ƒç”¨</h2><p>è°ƒç”¨èµ·æ¥å¾ˆç®€å•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UCrop.of(sourceUri, destinationUri)</span><br><span class="line">    .start(context);</span><br></pre></td></tr></table></figure><br>å…¶ä¸­<code>sourceUri</code>æ˜¯è¾“å…¥å›¾ç‰‡çš„<code>Uri</code>ï¼Œ<code>destinationUri</code>æ˜¯è¾“å‡ºå›¾ç‰‡çš„<code>Uri</code>ã€‚ç„¶åä»–å°±ä¼šç”±<code>Intent</code>çš„è°ƒåŠ¨è·³åˆ°<code>UCropActivity</code>ï¼Œç”¨æˆ·å°±åœ¨<code>UCropActivity</code>é‡Œé¢è¿›è¡Œå›¾ç‰‡è£å‰ªæ“ä½œï¼Œç„¶åæœ€åç”±<code>UCropActivity</code>å‘èµ·ä¸€ä¸ª<code>Intent</code>å›åˆ°ä½ çš„<code>Activity</code>ã€‚</p><h2 id="2-3-å¤„ç†å›æ¥çš„æ•°æ®"><a href="#2-3-å¤„ç†å›æ¥çš„æ•°æ®" class="headerlink" title="2.3 å¤„ç†å›æ¥çš„æ•°æ®"></a>2.3 å¤„ç†å›æ¥çš„æ•°æ®</h2><p>ç”±äºæ˜¯ä»<code>UCropAcitivity</code>ä¼ å›æ•°æ®ï¼Œæ‰€ä»¥ä½ éœ€è¦åœ¨ä½ çš„<code>Activity</code>é‡Œé¢çš„<code>onActivityResult</code>æ–¹æ³•å¤„ç†<code>uCrop</code>è¿”å›çš„ä¿¡æ¯ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onActivityResult</span><span class="params">(<span class="type">int</span> requestCode, <span class="type">int</span> resultCode, Intent data)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (resultCode == RESULT_OK &amp;&amp; requestCode == UCrop.REQUEST_CROP) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Uri</span> <span class="variable">resultUri</span> <span class="operator">=</span> UCrop.getOutput(data);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (resultCode == UCrop.RESULT_ERROR) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Throwable</span> <span class="variable">cropError</span> <span class="operator">=</span> UCrop.getError(data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åˆ°è¿™ï¼ŒåŸºæœ¬ç”¨æ³•å°±å®Œäº†ï¼Œä½ å°±å¯ä»¥å°½æƒ…çš„ä½¿ç”¨uCropã€‚ä½†æ˜¯æˆ‘å‰é¢è¯´è¿‡ï¼ŒuCropå°è£…ç¨‹åº¦å¥½ï¼Œè¿™ç‚¹å¾ˆå¤šå›¾ç‰‡å¤„ç†æ¡†æ¶éƒ½å¯ä»¥åšåˆ°ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯æŠŠéœ€è¦çš„æ•°æ®ä¼ åˆ°è‡ªå·±çš„Activityä¹‹åç”±è‡ªå·±çš„Activityå¤„ç†ï¼Œæ‰€ä»¥å¾ˆå¤šæ¡†æ¶çœ‹èµ·æ¥éƒ½æœ‰ä¼˜ç§€çš„å°è£…ï¼Œé‚£uCropç›¸æ¯”å…¶ä»–åˆæœ‰å•¥å¥½å‘¢ï¼Œç­”æ¡ˆå°±æ˜¯è‡ªå®šä¹‰çµæ´»ï¼š</p><h2 id="2-4-uCropé«˜é˜¶ç”¨æ³•"><a href="#2-4-uCropé«˜é˜¶ç”¨æ³•" class="headerlink" title="2.4 uCropé«˜é˜¶ç”¨æ³•"></a>2.4 uCropé«˜é˜¶ç”¨æ³•</h2><h3 id="2-4-1-é…ç½®uCrop"><a href="#2-4-1-é…ç½®uCrop" class="headerlink" title="2.4.1 é…ç½®uCrop"></a>2.4.1 é…ç½®uCrop</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * å¯åŠ¨è£å‰ª</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> activity ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> sourceFilePath éœ€è¦è£å‰ªå›¾ç‰‡çš„ç»å¯¹è·¯å¾„</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> requestCode æ¯”å¦‚ï¼šUCrop.REQUEST_CROP</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> aspectRatioX è£å‰ªå›¾ç‰‡å®½é«˜æ¯”</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> aspectRatioY è£å‰ªå›¾ç‰‡å®½é«˜æ¯”</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">startUCrop</span><span class="params">(Activity activity, String sourceFilePath, </span></span><br><span class="line"><span class="params"><span class="type">int</span> requestCode, <span class="type">float</span> aspectRatioX, <span class="type">float</span> aspectRatioY)</span> &#123;</span><br><span class="line">    <span class="type">Uri</span> <span class="variable">sourceUri</span> <span class="operator">=</span> Uri.fromFile(<span class="keyword">new</span> <span class="title class_">File</span>(sourceFilePath));</span><br><span class="line">    <span class="type">File</span> <span class="variable">outDir</span> <span class="operator">=</span> Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES);</span><br><span class="line">    <span class="keyword">if</span> (!outDir.exists()) &#123;</span><br><span class="line">        outDir.mkdirs();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">File</span> <span class="variable">outFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(outDir, System.currentTimeMillis() + <span class="string">&quot;.jpg&quot;</span>);</span><br><span class="line">    <span class="comment">//è£å‰ªåå›¾ç‰‡çš„ç»å¯¹è·¯å¾„</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">cameraScalePath</span> <span class="operator">=</span> outFile.getAbsolutePath();</span><br><span class="line">    <span class="type">Uri</span> <span class="variable">destinationUri</span> <span class="operator">=</span> Uri.fromFile(outFile);</span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ï¼šéœ€è¦è£å‰ªçš„å›¾ç‰‡ï¼›ç¬¬äºŒä¸ªå‚æ•°ï¼šè£å‰ªåå›¾ç‰‡</span></span><br><span class="line">    <span class="type">UCrop</span> <span class="variable">uCrop</span> <span class="operator">=</span> UCrop.of(sourceUri, destinationUri);</span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–UCropé…ç½®</span></span><br><span class="line">    UCrop.<span class="type">Options</span> <span class="variable">options</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UCrop</span>.Options();</span><br><span class="line">    <span class="comment">//è®¾ç½®è£å‰ªå›¾ç‰‡å¯æ“ä½œçš„æ‰‹åŠ¿</span></span><br><span class="line">    options.setAllowedGestures(UCropActivity.SCALE, UCropActivity.ROTATE, UCropActivity.ALL);</span><br><span class="line">    <span class="comment">//æ˜¯å¦éšè—åº•éƒ¨å®¹å™¨ï¼Œé»˜è®¤æ˜¾ç¤º</span></span><br><span class="line">    options.setHideBottomControls(<span class="literal">true</span>);</span><br><span class="line">    <span class="comment">//è®¾ç½®toolbaré¢œè‰²</span></span><br><span class="line">    options.setToolbarColor(ActivityCompat.getColor(activity, R.color.colorPrimary));</span><br><span class="line">    <span class="comment">//è®¾ç½®çŠ¶æ€æ é¢œè‰²</span></span><br><span class="line">    options.setStatusBarColor(ActivityCompat.getColor(activity, R.color.colorPrimary));</span><br><span class="line">    <span class="comment">//æ˜¯å¦èƒ½è°ƒæ•´è£å‰ªæ¡†</span></span><br><span class="line">    options.setFreeStyleCropEnabled(<span class="literal">true</span>);</span><br><span class="line">    <span class="comment">//UCropé…ç½®</span></span><br><span class="line">    uCrop.withOptions(options);</span><br><span class="line">    <span class="comment">//è®¾ç½®è£å‰ªå›¾ç‰‡çš„å®½é«˜æ¯”ï¼Œæ¯”å¦‚16ï¼š9</span></span><br><span class="line">    uCrop.withAspectRatio(aspectRatioX, aspectRatioY);</span><br><span class="line">    <span class="comment">//uCrop.useSourceImageAspectRatio();</span></span><br><span class="line">    <span class="comment">//è·³è½¬è£å‰ªé¡µé¢</span></span><br><span class="line">    uCrop.start(activity, requestCode);</span><br><span class="line">    <span class="keyword">return</span> cameraScalePath;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-4-2-å…¶ä»–é…ç½®"><a href="#2-4-2-å…¶ä»–é…ç½®" class="headerlink" title="2.4.2 å…¶ä»–é…ç½®"></a>2.4.2 å…¶ä»–é…ç½®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è®¾ç½®Toolbaræ ‡é¢˜</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setToolbarTitle</span><span class="params">(<span class="meta">@Nullable</span> String text)</span></span><br><span class="line"><span class="comment">//è®¾ç½®è£å‰ªçš„å›¾ç‰‡æ ¼å¼</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setCompressionFormat</span><span class="params">(<span class="meta">@NonNull</span> Bitmap.CompressFormat format)</span></span><br><span class="line"><span class="comment">//è®¾ç½®è£å‰ªçš„å›¾ç‰‡è´¨é‡ï¼Œå–å€¼0-100</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setCompressionQuality</span><span class="params">(<span class="meta">@IntRange(from = 0)</span> <span class="type">int</span> compressQuality)</span></span><br><span class="line"><span class="comment">//è®¾ç½®æœ€å¤šç¼©æ”¾çš„æ¯”ä¾‹å°º</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setMaxScaleMultiplier</span><span class="params">(<span class="meta">@FloatRange(from = 1.0, fromInclusive = false)</span> <span class="type">float</span> maxScaleMultiplier)</span></span><br><span class="line"><span class="comment">//åŠ¨ç”»æ—¶é—´</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setImageToCropBoundsAnimDuration</span><span class="params">(<span class="meta">@IntRange(from = 100)</span> <span class="type">int</span> durationMillis)</span></span><br><span class="line"><span class="comment">//è®¾ç½®å›¾ç‰‡å‹ç¼©æœ€å¤§å€¼</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setMaxBitmapSize</span><span class="params">(<span class="meta">@IntRange(from = 100)</span> <span class="type">int</span> maxBitmapSize)</span></span><br><span class="line"><span class="comment">//æ˜¯å¦æ˜¾ç¤ºæ¤­åœ†è£å‰ªæ¡†é˜´å½±</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setOvalDimmedLayer</span><span class="params">(<span class="type">boolean</span> isOval)</span> </span><br><span class="line"><span class="comment">//è®¾ç½®æ¤­åœ†è£å‰ªæ¡†é˜´å½±é¢œè‰²</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setDimmedLayerColor</span><span class="params">(<span class="meta">@ColorInt</span> <span class="type">int</span> color)</span></span><br><span class="line"><span class="comment">//æ˜¯å¦æ˜¾ç¤ºè£å‰ªæ¡†</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setShowCropFrame</span><span class="params">(<span class="type">boolean</span> show)</span></span><br><span class="line"><span class="comment">//è®¾ç½®è£å‰ªæ¡†è¾¹çš„å®½åº¦</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setCropFrameStrokeWidth</span><span class="params">(<span class="meta">@IntRange(from = 0)</span> <span class="type">int</span> width)</span></span><br><span class="line"><span class="comment">//æ˜¯å¦æ˜¾ç¤ºè£å‰ªæ¡†ç½‘æ ¼</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setShowCropGrid</span><span class="params">(<span class="type">boolean</span> show)</span> </span><br><span class="line"><span class="comment">//è®¾ç½®è£å‰ªæ¡†ç½‘æ ¼é¢œè‰²</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setCropGridColor</span><span class="params">(<span class="meta">@ColorInt</span> <span class="type">int</span> color)</span></span><br><span class="line"><span class="comment">//è®¾ç½®è£å‰ªæ¡†ç½‘æ ¼å®½</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setCropGridStrokeWidth</span><span class="params">(<span class="meta">@IntRange(from = 0)</span> <span class="type">int</span> width)</span></span><br></pre></td></tr></table></figure><h1 id="3-æºç è§£æ"><a href="#3-æºç è§£æ" class="headerlink" title="3. æºç è§£æ"></a>3. æºç è§£æ</h1><blockquote><p>åœ¨æˆ‘å¼€å§‹è¯´æºç ä¹‹å‰ï¼Œæˆ‘å»ºè®®å¤§å®¶å¯ä»¥å…ˆçœ‹ä¸‹æˆ‘ä¸‹é¢çš„è¿æ¥ï¼Œå› ä¸ºæœ¬æ¡†æ¶çš„ä½œè€…çœŸçš„æ˜¯ä¸ªå¥½äººï¼Œä»–ä¸ä»…ä¸ºæˆ‘ä»¬è´¡çŒ®äº†è¿™ä¹ˆå¥½çš„ä¸€ä¸ªæ¡†æ¶ï¼Œè¿˜æŠŠè‡ªå·±å†™è¿™ä¸ªæ¡†æ¶çš„æ€è·¯éƒ½å†™äº†å‡ºæ¥ï¼Œå¤§å®¶å¯ä»¥çœ‹çœ‹<br><a href="https://yalantis.com/blog/how-we-created-ucrop-our-own-image-cropping-library-for-android/">è‹±æ–‡åŸç‰ˆ</a><br><a href="https://blog.csdn.net/wood_water_peng/article/details/51306274">å›½å†…ç½‘å‹ç¿»è¯‘ç‰ˆ</a><br><a href="https://fanyi.baidu.com/transpage?query=https%3A%2F%2Fyalantis.com%2Fblog%2Fhow-we-created-ucrop-our-own-image-cropping-library-for-android%2F%23&amp;source=url&amp;ie=utf8&amp;from=auto&amp;to=zh&amp;render=1">ç™¾åº¦ç½‘é¡µç¿»è¯‘æœºç¿»ç‰ˆ</a><br>å…¶å®æˆ‘ä¸ªäººæ„Ÿè§‰ç™¾åº¦æœºç¿»æ²¡æœ‰è°·æ­Œç¿»è¯‘çš„å¥½ï¼Œå¤§å®¶æœ‰æ¡ä»¶çš„å¯ä»¥ä½¿ç”¨è°·æ­Œç¿»è¯‘æµè§ˆå™¨æ’ä»¶ç¿»è¯‘æ•´ä¸ªç½‘é¡µï¼ˆè°·æ­Œç¿»è¯‘å¥½åƒå›½å†…å¯ä»¥ç›´æ¥è®¿é—®ï¼‰</p></blockquote><p>ä»£ç ç»“æ„å¤§è‡´åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†:</p><h2 id="3-1-ç¬¬ä¸€éƒ¨åˆ†ï¼šUCropActivityï¼ˆæ•´ä¸ªæ¡†æ¶çš„å¤–åœ¨ï¼Œç”¨æˆ·æ“ä½œå›¾ç‰‡çš„åœ°æ–¹ï¼‰"><a href="#3-1-ç¬¬ä¸€éƒ¨åˆ†ï¼šUCropActivityï¼ˆæ•´ä¸ªæ¡†æ¶çš„å¤–åœ¨ï¼Œç”¨æˆ·æ“ä½œå›¾ç‰‡çš„åœ°æ–¹ï¼‰" class="headerlink" title="3.1 ç¬¬ä¸€éƒ¨åˆ†ï¼šUCropActivityï¼ˆæ•´ä¸ªæ¡†æ¶çš„å¤–åœ¨ï¼Œç”¨æˆ·æ“ä½œå›¾ç‰‡çš„åœ°æ–¹ï¼‰"></a>3.1 ç¬¬ä¸€éƒ¨åˆ†ï¼šUCropActivityï¼ˆæ•´ä¸ªæ¡†æ¶çš„å¤–åœ¨ï¼Œç”¨æˆ·æ“ä½œå›¾ç‰‡çš„åœ°æ–¹ï¼‰</h2><p>ä»–çš„åŠŸèƒ½å°±æ˜¯é¡¹ç›®ä¸»è¦çš„ç•Œé¢ï¼Œä»¥åŠå®ç°ä¸€äº›åŸºæœ¬çš„åˆå§‹åŒ–ã€‚ä½ è·³è½¬åˆ°uCropçœ‹åˆ°çš„é‚£ä¸ªæ“ä½œå›¾ç‰‡çš„ç•Œé¢å°±æ˜¯å®ƒã€‚</p><p>è¿™å—çœ‹æºç çš„æ—¶å€™ä»£ç å±…å¤šï¼Œä½†æ˜¯ï¼Œè¯´å®è¯ï¼Œå°±åƒåˆšåˆšè¯´çš„ä¸€æ ·ï¼Œä»–é™¤äº†åˆå§‹åŒ–è¿˜æ˜¯åˆå§‹åŒ–ã€‚åˆå§‹åŒ–å®Œ<code>Toolbar</code>æ¥ç€åˆå§‹åŒ–<code>ViewGroup</code>ï¼Œåˆå§‹åŒ–å®Œ<code>ViewGroup</code>æ¥ç€åˆå§‹åŒ–<code>Image</code>æ•°æ®ç­‰ç­‰ã€‚æ‰€ä»¥è¿™å—æˆ‘å°±æ²¡å’‹ç»†çœ‹<del>ï¼ˆå…¶å®æ˜¯å› ä¸ºä»£ç å¤ªé•¿äº†ï¼Œé€ƒï¼‰</del></p><h2 id="3-2-ç¬¬äºŒéƒ¨åˆ†ï¼šOverlayViewï¼ˆç»˜åˆ¶è£å‰ªæ¡†ï¼‰"><a href="#3-2-ç¬¬äºŒéƒ¨åˆ†ï¼šOverlayViewï¼ˆç»˜åˆ¶è£å‰ªæ¡†ï¼‰" class="headerlink" title="3.2 ç¬¬äºŒéƒ¨åˆ†ï¼šOverlayViewï¼ˆç»˜åˆ¶è£å‰ªæ¡†ï¼‰"></a>3.2 ç¬¬äºŒéƒ¨åˆ†ï¼šOverlayViewï¼ˆç»˜åˆ¶è£å‰ªæ¡†ï¼‰</h2><p>è¿™ä¸€å—ä¸»è¦å°±æ˜¯æ¥ç”»ä½ æ‰€çœ‹åˆ°çš„å›¾ç‰‡ä¸­çš„è£å‰ªçš„è¾…åŠ©çº¿ã€‚</p><p>åœ¨æ„é€ æ–¹æ³•é‡Œé¢å°±è°ƒç”¨äº†ä¸€ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯<code>init()</code>ï¼Œè€Œ<code>init()</code>æ–¹æ³•ä¹Ÿå°±å¹²äº†ä¸€ä»¶äº‹â€”â€”åˆ¤æ–­ã€‚å½“ç³»ç»Ÿå°äº<code>JELLY_BEA_MR2</code>ä¹Ÿå°±æ˜¯<code>Android4.3</code>æ—¶ï¼Œå¯åŠ¨äº†ç¡¬ä»¶åŠ é€Ÿï¼Œè‡³äºä¸ºä»€ä¹ˆ<code>setLayerType(LAYER_TYPE_SOFTWARE, null);</code>è¿™ä¸ªçœ‹ç€å°±åƒå¯åŠ¨ç¡¬ä»¶åŠ é€Ÿçš„æ–¹æ³•ï¼Œç”šè‡³å‚æ•°é‡Œé¢è¿˜æœ‰è½¯ä»¶è¿™ä¸ªå•è¯çš„æ–¹æ³•èƒ½å¯åŠ¨ç¡¬ä»¶åŠ é€Ÿï¼Œè¯·å¤§å®¶ç§»æ­¥<a href="https://hencoder.com/ui-1-8/">HenCoder Android è‡ªå®šä¹‰ View 1-8 ç¡¬ä»¶åŠ é€Ÿ</a>ï¼ˆè¿›å»ç›´æ¥æœç´¢è¿™ä¸ªæ–¹æ³•å³å¯ï¼Œå°±èƒ½æ‰¾åˆ°è§£é‡Šçš„åœ°æ–¹ï¼‰ï¼Œæˆ‘å†æ¬¡ä¸åšè§£é‡Šã€‚</p><p>è¿™ä¸ªç±»ä¸»è¦æœ‰ä¸¤ä¸ªæ–¹æ³•</p><ol><li><code>drawDimmedLayer()</code>ç»˜åˆ¶è£å‰ªæ¡†ä¹‹å¤–çš„ç°è‰²éƒ¨åˆ†</li><li><code>drawCropGrid()</code>ç»˜åˆ¶è£å‰ªæ¡†</li></ol><p>é‚£æˆ‘ä»¬åˆ†åˆ«æ¥çœ‹ä¸‹è¿™ä¸¤ä¸ªæ–¹æ³•ï¼š</p><h3 id="3-2-1-drawDimmedLayer"><a href="#3-2-1-drawDimmedLayer" class="headerlink" title="3.2.1 drawDimmedLayer()"></a>3.2.1 drawDimmedLayer()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">drawDimmedLayer</span><span class="params">(<span class="meta">@NonNull</span> Canvas canvas)</span> &#123;</span><br><span class="line">    <span class="comment">//å…ˆä¿å­˜å½“å‰å½“å‰ç”»å¸ƒ</span></span><br><span class="line">    canvas.save();</span><br><span class="line">    <span class="comment">//åˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºåœ†æ¡†</span></span><br><span class="line">    <span class="keyword">if</span> (mCircleDimmedLayer) &#123;</span><br><span class="line">        <span class="comment">//æŒ‰Pathè·¯å¾„è£å‰ª</span></span><br><span class="line">        canvas.clipPath(mCircularPath, Region.Op.DIFFERENCE);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//è£å‰ªçŸ©å½¢</span></span><br><span class="line">        canvas.clipRect(mCropViewRect, Region.Op.DIFFERENCE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ç€è‰²</span></span><br><span class="line">    canvas.drawColor(mDimmedColor);</span><br><span class="line">    <span class="comment">//æ¢å¤ä¹‹å‰ä¿å­˜çš„Canvasçš„çŠ¶æ€</span></span><br><span class="line">    canvas.restore();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (mCircleDimmedLayer) &#123; <span class="comment">// ç»˜åˆ¶1pxç¬”åˆ’ä»¥ä¿®å¤åé”¯é½¿</span></span><br><span class="line">        canvas.drawCircle(mCropViewRect.centerX(), mCropViewRect.centerY(),</span><br><span class="line">                Math.min(mCropViewRect.width(), mCropViewRect.height()) / <span class="number">2.f</span>, mDimmedStrokePaint);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆå°±æ˜¯ä¸€ä¸ª<code>mCircleDimmedLayer</code>ï¼Œè¿™ä¸ªæˆ‘çœŸçš„å¾ˆè¿·ï¼Œå› ä¸ºæˆ‘ä¸çŸ¥é“å¥¹æ˜¯å’‹æ¥çš„ï¼Œäºæ˜¯æˆ‘å°±çœ‹<code>OverlayView</code>æœ‰æ²¡æœ‰å¯¹è¿™ä¸ªå˜é‡çš„èµ‹å€¼ï¼Œäºæ˜¯æ•´ä¸ªç±»æˆ‘å°±æ‰¾åˆ°äº†ä¸€ä¸ª<code>setCircleDimmedLayer()</code>æ–¹æ³•ï¼Œäºæ˜¯æˆ‘çœ‹è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨å“ªè¢«è°ƒç”¨äº†çš„ï¼Œç„¶åæˆ‘å°±æ‰¾åˆ°ä»–åˆ†åˆ«è¢«UCropActivityå’ŒUCropFragmentä¸¤ä¸ªç±»è°ƒç”¨åˆ°ï¼Œè€Œä¸”ä¸€ä¸ªæ˜¯<code>intent.getBooleanExtra()</code>æ–¹æ³•ä¸€ä¸ªæ˜¯<code>bundle.getBoolean()</code>æ–¹æ³•ï¼Œçœ‹åˆ°è¿™ä¸ªæˆ‘ç›¸ä¿¡å¤§å®¶éƒ½æœ‰ç‚¹æ•°äº†ï¼Œè¿™æ˜æ˜¾å°±æ˜¯å…¶ä»–ç±»ä¼ è¿‡æ¥çš„å•Šï¼Œæˆ‘å‘ç°ä»–ä¸¤çš„keyçš„å€¼éƒ½æ˜¯<code>UCrop.Options.EXTRA_CIRCLE_DIMMED_LAYER</code>ï¼Œé‚£æˆ‘å°±æ‡‚äº†ï¼Œæ‰¾æ•´ä¸ªæ¡†æ¶é‡Œé¢å“ªå„¿æåˆ°è¿‡è¿™ä¸ªå€¼ä¸å°±å¾—äº†ï¼Œäºæ˜¯æˆ‘å°±å‘ç°é™¤äº†ä¸Šé¢ä¸¤ä¸ªæ–¹æ³•ä»¥åŠä»–çš„åˆå§‹åŒ–ä»¥å¤–ï¼Œæˆ‘å‘ç°äº†ç¬¬4ä¸ªè°ƒç”¨çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ªè°ƒç”¨çš„åœ°æ–¹â€”â€”Ucrop.setCircleDimmedLayer()ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> isCircle - set it to true if you want dimmed layer to have an circle inside</span></span><br><span class="line"><span class="comment"> * iscircle-å¦‚æœå¸Œæœ›æš—æ˜¾å±‚ä¸­æœ‰ä¸€ä¸ªåœ†ï¼Œè¯·å°†å…¶è®¾ç½®ä¸ºtrueã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCircleDimmedLayer</span><span class="params">(<span class="type">boolean</span> isCircle)</span> &#123;</span><br><span class="line">    mOptionBundle.putBoolean(EXTRA_CIRCLE_DIMMED_LAYER, isCircle);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æ³¨é‡Šä¸Šé¢æ˜¯åŸè¯ï¼Œä¸‹é¢æ˜¯æˆ‘ç™¾åº¦æœºç¿»çš„ç¿»è¯‘ã€‚çœ‹äº†å°±æ‡‚äº†å§ï¼Œåæ­£æˆ‘æ²¡æ‡‚ï¼Œæˆ‘ä¹Ÿå®Œå…¨æ²¡æœ‰è§åˆ°å“ªè°ƒç”¨è¿‡è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘æ›´ä¸æ‡‚å•¥å«å¸Œæœ›æš—æ˜¾å±‚æœ‰ä¸ªåœ†ï¼Œå•¥ç©æ„ï¼Ÿå……æ»¡çº¿æ¡çš„é»‘ï¼Ÿï¼Ÿï¼Ÿ<br>ç›´åˆ°æˆ‘å°†UCropçš„è°ƒç”¨æ–¹æ³•ä¿®æ”¹äº†å¹¶è¿è¡Œä¹‹åæˆ‘æ‰æ‡‚äº†ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">val</span> <span class="variable">options</span> <span class="operator">=</span> UCrop.Options()</span><br><span class="line">options.setCircleDimmedLayer(<span class="literal">true</span>)</span><br><span class="line">UCrop.of(uri, destinationUri)</span><br><span class="line">        .withOptions(options)</span><br><span class="line">        .start(<span class="built_in">this</span>)</span><br></pre></td></tr></table></figure><br>ç»“æœæ˜¯ï¼š<br><img src="https://cdn.littlecorgi.top/mweb/Screenshot_20190802-211515_PhotoXiu_puzzle.jpg" alt="Screenshot_20190802-211515_PhotoXiu_puzzle"></p><p>ç„¶åå°±æ‡‚äº†ï¼Œåº”è¯¥æ˜¯èƒ½æˆªä¸€ä¸ªåœ†å½¢çš„å›¾æ¡ˆå§ï¼Œç„¶åæˆ‘ç‚¹ä¸‹äº†âœ”ï¸ï¼Œç„¶åâ€¦â€¦</p><p><img src="https://cdn.littlecorgi.top/mweb/Screenshot_20190802-211547_PhotoXiu_puzzle.jpg" alt="Screenshot_20190802-211547_PhotoXiu_puzzle"><br>æ— è¯å¯è¯´ï¼Œä½œè€…ç‰›é€¼ï¼ï¼ï¼</p><p>å›å»å›å»ï¼Œåˆšåˆšè¯´åˆ°<code>drawDimmedLayer()</code>ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœ<code>mCircleDimmedLayer</code>ä¸º<code>true</code>å°±è°ƒç”¨<code>clipPath()</code>è·Ÿç€è·¯å¾„è£åˆ‡ä¸€ä¸ªçŸ©å½¢åŠ åŸï¼Œä¸ç„¶çš„è¯å°±è°ƒç”¨<code>clipRect()</code>è£åˆ‡ä¸€ä¸ªçŸ©å½¢ã€‚ç„¶ååŠ å…¥é¢œè‰²ï¼Œç„¶åå®Œäº†</p><h3 id="3-2-2-drawCropGrid"><a href="#3-2-2-drawCropGrid" class="headerlink" title="3.2.2 drawCropGrid()"></a>3.2.2 drawCropGrid()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">drawCropGrid</span><span class="params">(<span class="meta">@NonNull</span> Canvas canvas)</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºå‰ªè£æ¡†</span></span><br><span class="line">    <span class="keyword">if</span> (mShowCropGrid) &#123;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­çŸ©å½¢æ•°æ®æ˜¯å¦ä¸ºç©ºï¼ŒmGridPoints å¦‚æœç­‰äºç©ºçš„è¯è¿›å…¥å¡«å……æ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> (mGridPoints == <span class="literal">null</span> &amp;&amp; !mCropViewRect.isEmpty()) &#123;</span><br><span class="line">            <span class="comment">// è¯¥æ•°ç»„ä¸º canvas.drawLines çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°è¦æ±‚å…¶å…ƒç´ ä¸ªæ•°ä¸º 4 çš„å€æ•°</span></span><br><span class="line">            mGridPoints = <span class="keyword">new</span> <span class="title class_">float</span>[(mCropGridRowCount) * <span class="number">4</span> + (mCropGridColumnCount) * <span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="comment">// ç»„è£…æ•°æ®ï¼Œæ•°æ®ä¸ºæ¯ä¸€ç»„çº¿æ®µçš„åæ ‡ç‚¹</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; mCropGridRowCount; i++) &#123;</span><br><span class="line">                mGridPoints[index++] = mCropViewRect.left;</span><br><span class="line">                mGridPoints[index++] = (mCropViewRect.height() * (((<span class="type">float</span>) i + <span class="number">1.0f</span>) / (<span class="type">float</span>) (mCropGridRowCount + <span class="number">1</span>))) + mCropViewRect.top;</span><br><span class="line">                mGridPoints[index++] = mCropViewRect.right;</span><br><span class="line">                mGridPoints[index++] = (mCropViewRect.height() * (((<span class="type">float</span>) i + <span class="number">1.0f</span>) / (<span class="type">float</span>) (mCropGridRowCount + <span class="number">1</span>))) + mCropViewRect.top;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; mCropGridColumnCount; i++) &#123;</span><br><span class="line">                mGridPoints[index++] = (mCropViewRect.width() * (((<span class="type">float</span>) i + <span class="number">1.0f</span>) / (<span class="type">float</span>) (mCropGridColumnCount + <span class="number">1</span>))) + mCropViewRect.left;</span><br><span class="line">                mGridPoints[index++] = mCropViewRect.top;</span><br><span class="line">                mGridPoints[index++] = (mCropViewRect.width() * (((<span class="type">float</span>) i + <span class="number">1.0f</span>) / (<span class="type">float</span>) (mCropGridColumnCount + <span class="number">1</span>))) + mCropViewRect.left;</span><br><span class="line">                mGridPoints[index++] = mCropViewRect.bottom;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//ç»˜åˆ¶çº¿æ®µ</span></span><br><span class="line">        <span class="keyword">if</span> (mGridPoints != <span class="literal">null</span>) &#123;</span><br><span class="line">            canvas.drawLines(mGridPoints, mCropGridPaint);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ç»˜åˆ¶çŸ©å½¢åŒ…è£¹çº¿æ®µ</span></span><br><span class="line">    <span class="keyword">if</span> (mShowCropFrame) &#123;</span><br><span class="line">        canvas.drawRect(mCropViewRect, mCropFramePaint);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ç»˜åˆ¶è¾¹è§’åŒ…è£¹,mFreestyleCropModeæ­¤å‚æ•°å¦‚æœç­‰äº1çš„è¯ å‰ªè£æ¡†ä¸ºå¯ç§»åŠ¨çŠ¶æ€ï¼Œä¸€èˆ¬ä¸ç”¨</span></span><br><span class="line">    <span class="keyword">if</span> (mFreestyleCropMode != FREESTYLE_CROP_MODE_DISABLE) &#123;</span><br><span class="line">        canvas.save();</span><br><span class="line"></span><br><span class="line">        mTempRect.set(mCropViewRect);</span><br><span class="line">        mTempRect.inset(mCropRectCornerTouchAreaLineLength, -mCropRectCornerTouchAreaLineLength);</span><br><span class="line">        canvas.clipRect(mTempRect, Region.Op.DIFFERENCE);</span><br><span class="line"></span><br><span class="line">        mTempRect.set(mCropViewRect);</span><br><span class="line">        mTempRect.inset(-mCropRectCornerTouchAreaLineLength, mCropRectCornerTouchAreaLineLength);</span><br><span class="line">        canvas.clipRect(mTempRect, Region.Op.DIFFERENCE);</span><br><span class="line"></span><br><span class="line">        canvas.drawRect(mCropViewRect, mCropFrameCornersPaint);</span><br><span class="line"></span><br><span class="line">        canvas.restore();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€å¼€å¤´åˆæ˜¯ä¸€ä¸ªå’Œä¸Šé¢ç±»ä¼¼çš„å˜é‡<code>mShowCropGrid</code>ï¼Œè¿™ä¸‹æˆ‘å°±ä¸è¯´æˆ‘æ‰¾çš„å…·ä½“æ­¥éª¤ï¼Œä»–çš„åŠŸèƒ½å°±æ˜¯å¦‚æœä»–æ˜¯<code>true</code>å°±ä¼šåœ¨è£å‰ªæ¡†ä¸­æ˜¾ç¤º9å®«æ ¼çº¿ï¼Œä¸º<code>false</code>å°±æ²¡æœ‰ã€‚æ¥ç€å°±æ˜¯ç”»çº¿éƒ¨åˆ†ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªæˆ‘ä¸ç”¨è®²å•¥ï¼Œä¹Ÿæ²¡å•¥è®²çš„ï¼Œå”¯ä¸€å°±æ˜¯ä¸ºä»€ä¹ˆmGridPointsè¿™ä¸ªæ•°ç»„çš„å¤§å°æ˜¯4çš„å€æ•°ï¼Œå¤§å®¶å¯ä»¥çœ‹ä¸‹è¿™ä¸ªåšå®¢<a href="https://blog.csdn.net/pimkle/article/details/16946423">Android Canvas DrawLinesä¸­ç¬¬ä¸€ä¸ªå‚æ•°çš„è§£é‡Š</a></p><h2 id="3-3-ç¬¬ä¸‰éƒ¨åˆ†ï¼šGestureCropImageViewï¼ˆæ­£åœ¨æ¡†æ¶çš„å†…åœ¨ï¼Œä»£ç æ“ä½œæ“ä½œå›¾ç‰‡çš„åœ°æ–¹ï¼‰"><a href="#3-3-ç¬¬ä¸‰éƒ¨åˆ†ï¼šGestureCropImageViewï¼ˆæ­£åœ¨æ¡†æ¶çš„å†…åœ¨ï¼Œä»£ç æ“ä½œæ“ä½œå›¾ç‰‡çš„åœ°æ–¹ï¼‰" class="headerlink" title="3.3 ç¬¬ä¸‰éƒ¨åˆ†ï¼šGestureCropImageViewï¼ˆæ­£åœ¨æ¡†æ¶çš„å†…åœ¨ï¼Œä»£ç æ“ä½œæ“ä½œå›¾ç‰‡çš„åœ°æ–¹ï¼‰"></a>3.3 ç¬¬ä¸‰éƒ¨åˆ†ï¼šGestureCropImageViewï¼ˆæ­£åœ¨æ¡†æ¶çš„å†…åœ¨ï¼Œä»£ç æ“ä½œæ“ä½œå›¾ç‰‡çš„åœ°æ–¹ï¼‰</h2><p>è¿™ä¸ªæ˜¯æ•´ä¸ªé¡¹ç›®æœ€æ ¸å¿ƒçš„åœ°æ–¹ã€‚å‰é¢çš„ä¸¤éƒ¨åˆ†éƒ½æ˜¯UIçš„ï¼Œè€Œè¿™ä¸ªæ‰æ˜¯çœŸæ­£çš„å¯¹å›¾ç‰‡è¿›è¡Œå¤„ç†çš„éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯æˆ‘æœ€æƒ³çŸ¥é“äº†è§£çš„éƒ¨åˆ†ã€‚<br>è¿™éƒ¨åˆ†ä½œè€…ä¹Ÿåœ¨ä»–çš„åšå®¢é‡Œé¢è¯´çš„æœ€å¤šæœ€æ¸…æ¥šã€‚<br>ä½œè€…æŠŠè¿™éƒ¨åˆ†çš„é€»è¾‘åˆ†ä¸ºäº†ä¸‰ä¸ªéƒ¨åˆ†</p><ol><li><p><code>TransformImageView extends ImageView</code><br> ä»–å¤„ç†äº†</p><ol><li>ä»æºæ‹¿åˆ°å›¾ç‰‡</li><li>å°†å›¾ç‰‡è¿›å˜æ¢ï¼ˆå¹³ç§»ã€ç¼©æ”¾ã€æ—‹è½¬ï¼‰ï¼Œå¹¶åº”ç”¨åˆ°å½“å‰å›¾ç‰‡ä¸Š</li></ol></li><li><p><code>CropImageView extends TransformImageView</code><br> ä»–å¤„ç†äº†</p><ol><li>ç»˜åˆ¶è£å‰ªè¾¹æ¡†å’Œç½‘æ ¼</li><li>ä¸ºè£å‰ªåŒºåŸŸè®¾ç½®ä¸€å¼ å›¾ç‰‡ï¼ˆå¦‚æœç”¨æˆ·å¯¹å›¾ç‰‡æ“ä½œå¯¼è‡´è£å‰ªåŒºåŸŸå‡ºç°äº†ç©ºç™½ï¼Œé‚£ä¹ˆå›¾ç‰‡åº”è‡ªåŠ¨ç§»åŠ¨åˆ°è¾¹ç•Œå¡«å……ç©ºç™½åŒºåŸŸï¼‰</li><li>ç»§æ‰¿çˆ¶ç±»æ–¹æ³•ï¼Œä½¿ç”¨æ›´ç²¾å‡†çš„è§„åˆ™æ¥æ“ä½œçŸ©é˜µï¼ˆé™åˆ¶æœ€å¤§å’Œæœ€å°ç¼©æ”¾æ¯”ï¼‰</li><li>æ·»åŠ æ–¹æ³•å’Œç¼©å°çš„æ–¹æ³•</li><li>è£å‰ªå›¾ç‰‡</li></ol></li><li><code>GestureCropImageView extends CropImageView</code><br> ä»–å¤„ç†äº†<ol><li>ç›‘å¬ç”¨æˆ·æ‰‹åŠ¿ï¼Œå¹¶è°ƒç”¨å¯¹åº”çš„æ­£ç¡®çš„æ–¹æ³•</li></ol></li></ol><h3 id="3-3-1-TransformImageView"><a href="#3-3-1-TransformImageView" class="headerlink" title="3.3.1 TransformImageView"></a>3.3.1 TransformImageView</h3><p>ä½œè€…è¯´è¿™æ˜¯æœ€å®¹æ˜“çš„éƒ¨åˆ†ã€‚<br>åœ¨çœ‹è¿™ä¸ªç±»ä¹‹å‰æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹<code>BitmapLoadTask</code>ç±»ï¼Œè¿™ä¸ªç±»æ˜¯ä¸€åˆ‡å›¾åƒå¤„ç†çš„åŸºç¡€ï¼Œè¿™ä¸ªç±»è´Ÿè´£äº†<code>Uri</code>è§£ç <code>bitmap</code>ï¼Œå¹¶å¤„ç†åˆ†è¾¨ç‡ï¼š<br>é¦–å…ˆæ ¹æ®æ‹¿åˆ°çš„<code>Uri</code>è§£æä½å›¾ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> ParcelFileDescriptor parcelFileDescriptor;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    parcelFileDescriptor = mContext.getContentResolver().openFileDescriptor(mInputUri, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BitmapWorkerResult</span>(e);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> FileDescriptor fileDescriptor;</span><br><span class="line"><span class="keyword">if</span> (parcelFileDescriptor != <span class="literal">null</span>) &#123;</span><br><span class="line">    fileDescriptor = parcelFileDescriptor.getFileDescriptor();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BitmapWorkerResult</span>(<span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;ParcelFileDescriptor was null for given Uri: [&quot;</span> + mInputUri + <span class="string">&quot;]&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ç°åœ¨ï¼Œå¯ä»¥ä½¿ç”¨<code>BitmapFactory</code>æ–¹æ³•è§£ç <code>FileDescriptor</code>ã€‚</p><p>ä½†åœ¨è§£ç ä½å›¾ä¹‹å‰ï¼Œæœ‰å¿…è¦çŸ¥é“å®ƒçš„å¤§å°ï¼Œå› ä¸ºå¦‚æœåˆ†è¾¨ç‡å¤ªé«˜ï¼Œä½å›¾å°†è¢«äºŒæ¬¡é‡‡æ ·ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> BitmapFactory.<span class="type">Options</span> <span class="variable">options</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BitmapFactory</span>.Options();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">options.inJustDecodeBounds = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">BitmapFactory.decodeFileDescriptor(fileDescriptor, <span class="literal">null</span>, options);</span><br><span class="line"></span><br><span class="line">options.inSampleSize = calculateInSampleSize(options, requiredWidth, requiredHeight);</span><br><span class="line"></span><br><span class="line">options.inJustDecodeBounds = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">Bitmap</span> <span class="variable">decodeSampledBitmap</span> <span class="operator">=</span> BitmapFactory.decodeFileDescriptor(fileDescriptor, <span class="literal">null</span>, options);</span><br><span class="line"></span><br><span class="line">close(parcelFileDescriptor);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">ExifInterface</span> <span class="variable">exif</span> <span class="operator">=</span> getExif(uri);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (exif != <span class="literal">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> <span class="variable">exifOrientation</span> <span class="operator">=</span> exif.getAttributeInt(ExifInterface.TAG_ORIENTATION, ExifInterface.ORIENTATION_NORMAL);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> rotateBitmap(decodeSampledBitmap, exifToDegrees(exifOrientation));</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> decodeSampledBitmap;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¿™æ ·å°±æ‹¿åˆ°äº†<code>bitmap</code>å®ä¾‹äº†ï¼Œå°±å¯ä»¥å»<code>TansformImageView</code>å»å¯¹å›¾ç‰‡è¿›è¡Œè°ƒæ•´äº†ã€‚<br>å…¶å®è¿™ä¸ªç±»æˆ‘ä¹Ÿä¸çŸ¥é“è¯´å•¥ğŸ˜‚ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªç±»ä¹Ÿå°±æ˜¯æŠŠ<code>Matrix</code>çš„<code>postTranslate()</code>ã€<code>postRotate()</code>å’Œ<code>postScale()</code>æ–¹æ³•ç»™å°è£…äº†ä¸‹ã€‚<br>å…³äºMatrixçš„çŸ¥è¯†å¤§å®¶å¯ä»¥å‚è€ƒè¿™ç¯‡åšå®¢ï¼š<a href="https://www.gcssloop.com/customview/Matrix_Basic">å®‰å“è‡ªå®šä¹‰Viewè¿›é˜¶-MatrixåŸç†</a></p><h3 id="3-3-2-CropImageView"><a href="#3-3-2-CropImageView" class="headerlink" title="3.3.2 CropImageView"></a>3.3.2 CropImageView</h3><p>è¿™ä¸€å±‚æ˜¯æœ€å¤æ‚çš„ä¸€å±‚ï¼Œä½œè€…çš„æ“ä½œå¤§è‡´å¯ä»¥åˆ†ä¸º3æ­¥ï¼šå›¾ç‰‡è£å‰ªæ¡†åç§»è®¡ç®—ã€å›¾ç‰‡å½’ä¸ºåŠ¨ç”»å¤„ç†ã€è£å‰ªå›¾ç‰‡</p><ul><li>ç¬¬ä¸€æ­¥ï¼šå›¾ç‰‡è£å‰ªæ¡†åç§»è®¡ç®—<br>å½“ç”¨æˆ·æ‰‹æŒ‡ç§»å¼€æ—¶ï¼Œè¦ç¡®ä¿å›¾ç‰‡å¤„äºè£å‰ªåŒºåŸŸä¸­ï¼Œå¦‚æœä¸å¤„äºï¼Œéœ€è¦é€šè¿‡å¹³ç§»æŠŠå®ƒç§»è¿‡æ¥ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setImageToWrapCropBounds</span><span class="params">(<span class="type">boolean</span> animate)</span> &#123;</span><br><span class="line">    <span class="comment">//å¦‚æœå›¾ç‰‡åŠ è½½å®Œæ¯•å¹¶ä¸”å›¾ç‰‡ä¸å¤„äºå‰ªè£åŒºåŸŸ</span></span><br><span class="line">    <span class="keyword">if</span> (mBitmapLaidOut &amp;&amp; !isImageWrapCropBounds()) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–ä¸­å¿ƒç‚¹X,Yåæ ‡</span></span><br><span class="line">        <span class="type">float</span> <span class="variable">currentX</span> <span class="operator">=</span> mCurrentImageCenter[<span class="number">0</span>];</span><br><span class="line">        <span class="type">float</span> <span class="variable">currentY</span> <span class="operator">=</span> mCurrentImageCenter[<span class="number">1</span>];</span><br><span class="line">        <span class="comment">//è·å–ç¼©æ”¾æ¯”ä¾‹</span></span><br><span class="line">        <span class="type">float</span> <span class="variable">currentScale</span> <span class="operator">=</span> getCurrentScale();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–åç§»è·ç¦»</span></span><br><span class="line">        <span class="type">float</span> <span class="variable">deltaX</span> <span class="operator">=</span> mCropRect.centerX() - currentX;</span><br><span class="line">        <span class="type">float</span> <span class="variable">deltaY</span> <span class="operator">=</span> mCropRect.centerY() - currentY;</span><br><span class="line">        <span class="type">float</span> <span class="variable">deltaScale</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        mTempMatrix.reset();</span><br><span class="line">        mTempMatrix.setTranslate(deltaX, deltaY);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">float</span>[] tempCurrentImageCorners = Arrays.copyOf(mCurrentImageCorners, mCurrentImageCorners.length);</span><br><span class="line">        mTempMatrix.mapPoints(tempCurrentImageCorners);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ¤æ–­å›¾ç‰‡æ˜¯å¦åŒ…å«åœ¨å‰ªè£åŒºåŸŸ</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">willImageWrapCropBoundsAfterTranslate</span> <span class="operator">=</span> isImageWrapCropBounds(tempCurrentImageCorners);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¦‚æœåŒ…å«åœ¨å‰ªè£åŒºåŸŸ</span></span><br><span class="line">        <span class="keyword">if</span> (willImageWrapCropBoundsAfterTranslate) &#123;</span><br><span class="line">            <span class="comment">//è·å–åç§»çš„è·ç¦»</span></span><br><span class="line">            <span class="keyword">final</span> <span class="type">float</span>[] imageIndents = calculateImageIndents();</span><br><span class="line">            <span class="comment">//åç§»çš„è·ç¦»ï¼Œæ¨ªåæ ‡åŠ æ¨ªåæ ‡ çºµåæ ‡åŠ çºµåæ ‡</span></span><br><span class="line">            deltaX = -(imageIndents[<span class="number">0</span>] + imageIndents[<span class="number">2</span>]);</span><br><span class="line">            deltaY = -(imageIndents[<span class="number">1</span>] + imageIndents[<span class="number">3</span>]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœä¸åŒ…å«åœ¨å‰ªè£åŒºåŸŸï¼Œåˆ›å»ºä¸´æ—¶çŸ©å½¢</span></span><br><span class="line">            <span class="type">RectF</span> <span class="variable">tempCropRect</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RectF</span>(mCropRect);</span><br><span class="line">            mTempMatrix.reset();</span><br><span class="line">            <span class="comment">//è®¾ç½®åç§»è§’åº¦</span></span><br><span class="line">            mTempMatrix.setRotate(getCurrentAngle());</span><br><span class="line">            mTempMatrix.mapRect(tempCropRect);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//è·å¾—çŸ©å½¢çš„è¾¹é•¿åæ ‡</span></span><br><span class="line">            <span class="keyword">final</span> <span class="type">float</span>[] currentImageSides = RectUtils.getRectSidesFromCorners(mCurrentImageCorners);</span><br><span class="line">            <span class="comment">//è·å–æ”¾å¤§æ¯”ä¾‹</span></span><br><span class="line">            deltaScale = Math.max(tempCropRect.width() / currentImageSides[<span class="number">0</span>],</span><br><span class="line">                    tempCropRect.height() / currentImageSides[<span class="number">1</span>]);</span><br><span class="line">            deltaScale = deltaScale * currentScale - currentScale;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¦‚æœéœ€è¦åŠ¨ç”»</span></span><br><span class="line">        <span class="keyword">if</span> (animate) &#123;</span><br><span class="line">            post(mWrapCropBoundsRunnable = <span class="keyword">new</span> <span class="title class_">WrapCropBoundsRunnable</span>(</span><br><span class="line">                    CropImageView.<span class="built_in">this</span>, mImageToWrapCropBoundsAnimDuration, currentX, currentY, deltaX, deltaY,</span><br><span class="line">                    currentScale, deltaScale, willImageWrapCropBoundsAfterTranslate));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//ä¸éœ€è¦åŠ¨ç”»ï¼Œç›´æ¥ç§»åŠ¨åˆ°ç›®æ ‡ä½ç½®</span></span><br><span class="line">            postTranslate(deltaX, deltaY);</span><br><span class="line">            <span class="keyword">if</span> (!willImageWrapCropBoundsAfterTranslate) &#123;</span><br><span class="line">                zoomInImage(currentScale + deltaScale, mCropRect.centerX(), mCropRect.centerY());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç¬¬äºŒæ­¥ï¼šå¤„ç†å¹³ç§»<br>é€šè¿‡ä¸€ä¸ªRunnableçº¿ç¨‹æ¥å¤„ç†å¹³ç§»ï¼Œå¹¶ä¸”é€šè¿‡æ—¶é—´å·®å€¼çš„è®¡ç®—æ¥ç§»åŠ¨åŠ¨ç”»ï¼Œä½¿åŠ¨ç”»çœ‹èµ·æ¥æ›´çœŸå®ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ­¤å¯è¿è¡Œæ–‡ä»¶ç”¨äºåŠ¨ç”»å›¾åƒï¼Œä½¿å…¶å®Œå…¨å¡«å……è£å‰ªè¾¹ç•Œã€‚</span></span><br><span class="line"><span class="comment"> * ç»™å®šå€¼åœ¨åŠ¨ç”»æœŸé—´å†…æ’ã€‚</span></span><br><span class="line"><span class="comment"> * runnableå¯ä»¥ç»ˆæ­¢äºvie&#123;<span class="doctag">@link</span> #cancelAllAnimations()&#125;æ–¹æ³•ï¼Œ</span></span><br><span class="line"><span class="comment"> * ä¹Ÿå¯ä»¥åœ¨è§¦å‘&#123;<span class="doctag">@link</span> WrapCropBoundsRunnable#run()&#125;æ–¹æ³•å†…çš„æŸäº›æ¡ä»¶æ—¶ç»ˆæ­¢ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">WrapCropBoundsRunnable</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WeakReference&lt;CropImageView&gt; mCropImageView;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> mDurationMs, mStartTime;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">float</span> mOldX, mOldY;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">float</span> mCenterDiffX, mCenterDiffY;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">float</span> mOldScale;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">float</span> mDeltaScale;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">boolean</span> mWillBeImageInBoundsAfterTranslate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WrapCropBoundsRunnable</span><span class="params">(CropImageView cropImageView,</span></span><br><span class="line"><span class="params">                                <span class="type">long</span> durationMs,</span></span><br><span class="line"><span class="params">                                <span class="type">float</span> oldX, <span class="type">float</span> oldY,</span></span><br><span class="line"><span class="params">                                <span class="type">float</span> centerDiffX, <span class="type">float</span> centerDiffY,</span></span><br><span class="line"><span class="params">                                <span class="type">float</span> oldScale, <span class="type">float</span> deltaScale,</span></span><br><span class="line"><span class="params">                                <span class="type">boolean</span> willBeImageInBoundsAfterTranslate)</span> &#123;</span><br><span class="line"></span><br><span class="line">        mCropImageView = <span class="keyword">new</span> <span class="title class_">WeakReference</span>&lt;&gt;(cropImageView);</span><br><span class="line"></span><br><span class="line">        mDurationMs = durationMs;</span><br><span class="line">        mStartTime = System.currentTimeMillis();</span><br><span class="line">        mOldX = oldX;</span><br><span class="line">        mOldY = oldY;</span><br><span class="line">        mCenterDiffX = centerDiffX;</span><br><span class="line">        mCenterDiffY = centerDiffY;</span><br><span class="line">        mOldScale = oldScale;</span><br><span class="line">        mDeltaScale = deltaScale;</span><br><span class="line">        mWillBeImageInBoundsAfterTranslate = willBeImageInBoundsAfterTranslate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">CropImageView</span> <span class="variable">cropImageView</span> <span class="operator">=</span> mCropImageView.get();</span><br><span class="line">        <span class="keyword">if</span> (cropImageView == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">now</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">float</span> <span class="variable">currentMs</span> <span class="operator">=</span> Math.min(mDurationMs, now - mStartTime);</span><br><span class="line"></span><br><span class="line">        <span class="type">float</span> <span class="variable">newX</span> <span class="operator">=</span> CubicEasing.easeOut(currentMs, <span class="number">0</span>, mCenterDiffX, mDurationMs);</span><br><span class="line">        <span class="type">float</span> <span class="variable">newY</span> <span class="operator">=</span> CubicEasing.easeOut(currentMs, <span class="number">0</span>, mCenterDiffY, mDurationMs);</span><br><span class="line">        <span class="type">float</span> <span class="variable">newScale</span> <span class="operator">=</span> CubicEasing.easeInOut(currentMs, <span class="number">0</span>, mDeltaScale, mDurationMs);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (currentMs &lt; mDurationMs) &#123;</span><br><span class="line">            cropImageView.postTranslate(newX - (cropImageView.mCurrentImageCenter[<span class="number">0</span>] - mOldX), newY - (cropImageView.mCurrentImageCenter[<span class="number">1</span>] - mOldY));</span><br><span class="line">            <span class="keyword">if</span> (!mWillBeImageInBoundsAfterTranslate) &#123;</span><br><span class="line">                cropImageView.zoomInImage(mOldScale + newScale, cropImageView.mCropRect.centerX(), cropImageView.mCropRect.centerY());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!cropImageView.isImageWrapCropBounds()) &#123;</span><br><span class="line">                cropImageView.post(<span class="built_in">this</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>ä¸‹é¢è¿˜æœ‰å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œç”¨äºåŒå‡»æ”¾å¤§:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ­¤å¯è¿è¡Œé¡¹ç”¨äºè®¾ç½®å›¾åƒç¼©æ”¾çš„åŠ¨ç”»ã€‚</span></span><br><span class="line"><span class="comment"> * ç»™å®šå€¼åœ¨åŠ¨ç”»æœŸé—´å†…æ’ã€‚</span></span><br><span class="line"><span class="comment"> * runnableå¯ä»¥ç»ˆæ­¢vie &#123;<span class="doctag">@link</span> #cancelAllAnimations()&#125;æ–¹æ³•ï¼Œ</span></span><br><span class="line"><span class="comment"> * ä¹Ÿå¯ä»¥åœ¨è§¦å‘&#123;<span class="doctag">@link</span> ZoomImageToPosition#run()&#125;æ–¹æ³•å†…çš„æŸäº›æ¡ä»¶æ—¶ç»ˆæ­¢ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ZoomImageToPosition</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WeakReference&lt;CropImageView&gt; mCropImageView;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> mDurationMs, mStartTime;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">float</span> mOldScale;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">float</span> mDeltaScale;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">float</span> mDestX;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">float</span> mDestY;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ZoomImageToPosition</span><span class="params">(CropImageView cropImageView,</span></span><br><span class="line"><span class="params">                                <span class="type">long</span> durationMs,</span></span><br><span class="line"><span class="params">                                <span class="type">float</span> oldScale, <span class="type">float</span> deltaScale,</span></span><br><span class="line"><span class="params">                                <span class="type">float</span> destX, <span class="type">float</span> destY)</span> &#123;</span><br><span class="line"></span><br><span class="line">        mCropImageView = <span class="keyword">new</span> <span class="title class_">WeakReference</span>&lt;&gt;(cropImageView);</span><br><span class="line"></span><br><span class="line">        mStartTime = System.currentTimeMillis();</span><br><span class="line">        mDurationMs = durationMs;</span><br><span class="line">        mOldScale = oldScale;</span><br><span class="line">        mDeltaScale = deltaScale;</span><br><span class="line">        mDestX = destX;</span><br><span class="line">        mDestY = destY;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">CropImageView</span> <span class="variable">cropImageView</span> <span class="operator">=</span> mCropImageView.get();</span><br><span class="line">        <span class="keyword">if</span> (cropImageView == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">now</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">float</span> <span class="variable">currentMs</span> <span class="operator">=</span> Math.min(mDurationMs, now - mStartTime);</span><br><span class="line">        <span class="type">float</span> <span class="variable">newScale</span> <span class="operator">=</span> CubicEasing.easeInOut(currentMs, <span class="number">0</span>, mDeltaScale, mDurationMs);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (currentMs &lt; mDurationMs) &#123;</span><br><span class="line">            cropImageView.zoomInImage(mOldScale + newScale, mDestX, mDestY);</span><br><span class="line">            cropImageView.post(<span class="built_in">this</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            cropImageView.setImageToWrapCropBounds();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç¬¬ä¸‰æ­¥ï¼šè£å‰ªå›¾ç‰‡</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å–æ¶ˆæ‰€æœ‰å½“å‰åŠ¨ç”»å¹¶è®¾ç½®å›¾åƒä»¥å¡«å……è£å‰ªåŒºåŸŸï¼ˆä¸å¸¦åŠ¨ç”»ï¼‰ã€‚</span></span><br><span class="line"><span class="comment"> * ç„¶åç”¨é€‚å½“çš„å‚æ•°åˆ›å»ºå¹¶æ‰§è¡Œ&#123;<span class="doctag">@link</span> BitmapCropTask&#125;ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cropAndSaveImage</span><span class="params">(<span class="meta">@NonNull</span> Bitmap.CompressFormat compressFormat, <span class="type">int</span> compressQuality,</span></span><br><span class="line"><span class="params">                            <span class="meta">@Nullable</span> BitmapCropCallback cropCallback)</span> &#123;</span><br><span class="line">    <span class="comment">//ç»“æŸå­çº¿ç¨‹</span></span><br><span class="line">    cancelAllAnimations();</span><br><span class="line">    <span class="comment">//è®¾ç½®è¦å‰ªè£çš„å›¾ç‰‡ï¼Œä¸éœ€è¦ä½ç§»åŠ¨ç”»</span></span><br><span class="line">    setImageToWrapCropBounds(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å­˜å‚¨å›¾ç‰‡ä¿¡æ¯ï¼Œå››ä¸ªå‚æ•°åˆ†åˆ«ä¸ºï¼šmCropRectè¦å‰ªè£çš„å›¾ç‰‡çŸ©é˜µï¼Œå½“å‰å›¾ç‰‡è¦å‰ªè£çš„çŸ©é˜µï¼Œå½“å‰æ”¾å¤§çš„å€¼ï¼Œå½“å‰æ—‹è½¬çš„è§’åº¦</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">ImageState</span> <span class="variable">imageState</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ImageState</span>(</span><br><span class="line">            mCropRect, RectUtils.trapToRect(mCurrentImageCorners),</span><br><span class="line">            getCurrentScale(), getCurrentAngle());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‰ªè£å‚æ•°ï¼ŒmMaxResultImageSizeXï¼ŒmMaxResultImageSizeYï¼šå‰ªè£å›¾ç‰‡çš„æœ€å¤§å®½åº¦ã€é«˜åº¦ã€‚</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">CropParameters</span> <span class="variable">cropParameters</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CropParameters</span>(</span><br><span class="line">            mMaxResultImageSizeX, mMaxResultImageSizeY,</span><br><span class="line">            compressFormat, compressQuality,</span><br><span class="line">            getImageInputPath(), getImageOutputPath(), getExifInfo());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‰ªè£æ“ä½œæ”¾åˆ°AsyncTaskä¸­æ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">BitmapCropTask</span>(getViewBitmap(), imageState, cropParameters, cropCallback).execute();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å—æ ¸å¿ƒæ–¹æ³•è¿˜æ˜¯åœ¨<code>BitmapCropTask</code>ä¸­ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è°ƒæ•´å‰ªè£å¤§å°ï¼Œå¦‚æœæœ‰è®¾ç½®æœ€å¤§å‰ªè£å¤§å°ä¹Ÿä¼šåœ¨è¿™é‡Œåšè°ƒæ•´åˆ°è®¾ç½®èŒƒå›´</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">float</span> <span class="title function_">resize</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> BitmapFactory.<span class="type">Options</span> <span class="variable">options</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BitmapFactory</span>.Options();</span><br><span class="line">    options.inJustDecodeBounds = <span class="literal">true</span>;</span><br><span class="line">    BitmapFactory.decodeFile(mImageInputPath, options);</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">swapSides</span> <span class="operator">=</span> mExifInfo.getExifDegrees() == <span class="number">90</span> || mExifInfo.getExifDegrees() == <span class="number">270</span>;</span><br><span class="line">    <span class="type">float</span> <span class="variable">scaleX</span> <span class="operator">=</span> (swapSides ? options.outHeight : options.outWidth) / (<span class="type">float</span>) mViewBitmap.getWidth();</span><br><span class="line">    <span class="type">float</span> <span class="variable">scaleY</span> <span class="operator">=</span> (swapSides ? options.outWidth : options.outHeight) / (<span class="type">float</span>) mViewBitmap.getHeight();</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> <span class="variable">resizeScale</span> <span class="operator">=</span> Math.min(scaleX, scaleY);</span><br><span class="line"></span><br><span class="line">    mCurrentScale /= resizeScale;</span><br><span class="line"></span><br><span class="line">    resizeScale = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (mMaxResultImageSizeX &gt; <span class="number">0</span> &amp;&amp; mMaxResultImageSizeY &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="type">float</span> <span class="variable">cropWidth</span> <span class="operator">=</span> mCropRect.width() / mCurrentScale;</span><br><span class="line">        <span class="type">float</span> <span class="variable">cropHeight</span> <span class="operator">=</span> mCropRect.height() / mCurrentScale;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (cropWidth &gt; mMaxResultImageSizeX || cropHeight &gt; mMaxResultImageSizeY) &#123;</span><br><span class="line"></span><br><span class="line">            scaleX = mMaxResultImageSizeX / cropWidth;</span><br><span class="line">            scaleY = mMaxResultImageSizeY / cropHeight;</span><br><span class="line">            resizeScale = Math.min(scaleX, scaleY);</span><br><span class="line"></span><br><span class="line">            mCurrentScale /= resizeScale;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> resizeScale;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‰ªè£å›¾ç‰‡</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">crop</span><span class="params">(<span class="type">float</span> resizeScale)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">ExifInterface</span> <span class="variable">originalExif</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExifInterface</span>(mImageInputPath);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å››èˆäº”å…¥å–æ•´</span></span><br><span class="line">    cropOffsetX = Math.round((mCropRect.left - mCurrentImageRect.left) / mCurrentScale);</span><br><span class="line">    cropOffsetY = Math.round((mCropRect.top - mCurrentImageRect.top) / mCurrentScale);</span><br><span class="line">    mCroppedImageWidth = Math.round(mCropRect.width() / mCurrentScale);</span><br><span class="line">    mCroppedImageHeight = Math.round(mCropRect.height() / mCurrentScale);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è®¡ç®—å‡ºå›¾ç‰‡æ˜¯å¦éœ€è¦è¢«å‰ªè£</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">shouldCrop</span> <span class="operator">=</span> shouldCrop(mCroppedImageWidth, mCroppedImageHeight);</span><br><span class="line">    Log.i(TAG, <span class="string">&quot;Should crop: &quot;</span> + shouldCrop);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (shouldCrop) &#123;</span><br><span class="line">        <span class="comment">//è°ƒç”¨C++æ–¹æ³•å‰ªè£</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">cropped</span> <span class="operator">=</span> cropCImg(mImageInputPath, mImageOutputPath,</span><br><span class="line">                cropOffsetX, cropOffsetY, mCroppedImageWidth, mCroppedImageHeight,</span><br><span class="line">                mCurrentAngle, resizeScale, mCompressFormat.ordinal(), mCompressQuality,</span><br><span class="line">                mExifInfo.getExifDegrees(), mExifInfo.getExifTranslation());</span><br><span class="line">        <span class="comment">//å‰ªè£æˆåŠŸå¤åˆ¶å›¾ç‰‡EXIFä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">if</span> (cropped &amp;&amp; mCompressFormat.equals(Bitmap.CompressFormat.JPEG)) &#123;</span><br><span class="line">            ImageHeaderParser.copyExif(originalExif, mCroppedImageWidth, mCroppedImageHeight, mImageOutputPath);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cropped;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//ç›´æ¥å¤åˆ¶å›¾ç‰‡åˆ°ç›®æ ‡æ–‡ä»¶å¤¹</span></span><br><span class="line">        FileUtils.copyFile(mImageInputPath, mImageOutputPath);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="3-3-3-GestureCropImageView"><a href="#3-3-3-GestureCropImageView" class="headerlink" title="3.3.3 GestureCropImageView"></a>3.3.3 GestureCropImageView</h3><p>è¿™ä¸ªç±»ä¸»è¦å°±æ˜¯å¯¹æ‰‹åŠ¿çš„ç›‘å¬ï¼Œæ‰€ä»¥æˆ‘ä»¬ç®€å•ç²—æš´ï¼Œç›´æ¥æ‰¾ä»–çš„onTouchEventæ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¦‚æœæ˜¯ACTION_DOWN eventï¼Œç”¨æˆ·è§¦æ‘¸å±å¹•ï¼Œå¿…é¡»å–æ¶ˆæ‰€æœ‰å½“å‰åŠ¨ç”»ã€‚</span></span><br><span class="line"><span class="comment"> * å¦‚æœæ˜¯ACTION_UP eventï¼Œç”¨æˆ·ä»å±å¹•ä¸Šå–ä¸‹æ‰€æœ‰æ‰‹æŒ‡ï¼Œå¿…é¡»çº æ­£å½“å‰å›¾åƒä½ç½®ã€‚</span></span><br><span class="line"><span class="comment"> * å¦‚æœæœ‰ä¸¤ä¸ªä»¥ä¸Šçš„æ‰‹æŒ‡-æ›´æ–°ç„¦ç‚¹åæ ‡ã€‚</span></span><br><span class="line"><span class="comment"> * å¦‚æœå·²å¯ç”¨ï¼Œåˆ™å°†äº‹ä»¶ä¼ é€’ç»™æ‰‹åŠ¿æ£€æµ‹å™¨ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onTouchEvent</span><span class="params">(MotionEvent event)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ((event.getAction() &amp; MotionEvent.ACTION_MASK) == MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">        cancelAllAnimations();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (event.getPointerCount() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        mMidPntX = (event.getX(<span class="number">0</span>) + event.getX(<span class="number">1</span>)) / <span class="number">2</span>;</span><br><span class="line">        mMidPntY = (event.getY(<span class="number">0</span>) + event.getY(<span class="number">1</span>)) / <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åŒå‡»ç›‘å¬å’Œæ‹–åŠ¨ç›‘å¬</span></span><br><span class="line">    mGestureDetector.onTouchEvent(event);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¸¤æŒ‡ç¼©æ”¾ç›‘å¬</span></span><br><span class="line">    <span class="keyword">if</span> (mIsScaleEnabled) &#123;</span><br><span class="line">        mScaleDetector.onTouchEvent(event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ—‹è½¬ç›‘å¬</span></span><br><span class="line">    <span class="keyword">if</span> (mIsRotateEnabled) &#123;</span><br><span class="line">        mRotateDetector.onTouchEvent(event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((event.getAction() &amp; MotionEvent.ACTION_MASK) == MotionEvent.ACTION_UP) &#123;</span><br><span class="line">        <span class="comment">//æœ€åä¸€æŒ‡æŠ¬èµ·æ—¶åˆ¤æ–­å›¾ç‰‡æ˜¯å¦å¡«å……å‰ªè£æ¡†</span></span><br><span class="line">        setImageToWrapCropBounds();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Android/">Android</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E6%BA%90%E7%A0%81/">æºç </category>
      
      <category domain="https://www.littlecorgi.top/tags/uCrop/">uCrop</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86/">å›¾ç‰‡å¤„ç†</category>
      
      
      <comments>https://www.littlecorgi.top/posts/4e4b8b52.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Aria2macOSå®‰è£…</title>
      <link>https://www.littlecorgi.top/posts/4f46fdbb.html</link>
      <guid>https://www.littlecorgi.top/posts/4f46fdbb.html</guid>
      <pubDate>Fri, 02 Aug 2019 02:13:16 GMT</pubDate>
      
      <description>&lt;blockquote&gt;
&lt;p&gt;å¯¹ä¸èµ·å¤§å®¶ï¼Œåœ¨æˆ‘é…ç½®å¥½è¿™ä¸ªè½¯ä»¶ä¹‹åï¼Œæˆ‘å…´å†²å†²çš„æ‰“å¼€äº†githubæƒ³ä¸‹è½½ä¸‹ssr4.0forWindowsï¼Œè¿«ä¸åŠå¾…æƒ³æ„Ÿå—ä¸‹aria2çš„å¿«æ„Ÿï¼Œç»“æœå‘ç°æˆ‘é”™äº†ã€‚&lt;br&gt;ä¸‹è½½é€Ÿåº¦å°±æ‰å‡ åk/sï¼Œé‚£ä¸€ç¬é—´ï¼Œæˆ‘æ„Ÿè§¦å¾ˆå¤šï¼Œæˆ‘çªç„¶æƒ³åˆ°æˆ‘æ˜¨æ™šçš„è¿…é›·ä¸‹è½½åŒæ ·çš„èµ„æºåŒæ ·çš„ç½‘åŒæ ·çš„vpnä¸‹å¤§å‡ ç™¾k/s çš„é€Ÿåº¦ï¼Œç„¶ååˆçœ‹åˆ°äº†æ­¤æ—¶æˆ‘ç»™äºˆå¸Œæœ›çš„ariaï¼Œæˆ‘é™·å…¥äº†æ²‰æ€ï¼Œæˆ–è®¸è¿™å°±æ˜¯äººç”Ÿå§ã€‚&lt;br&gt;çªç„¶è§‰å¾—macOSè¿…é›·ï¼Œä¹Ÿè¿˜æŒºå¥½çœ‹çš„ï¼Œä¹ŸæŒºå¥½ç”¨çš„ï¼Œå®Œå…¨æ²¡æœ‰å¹¿å‘Šï¼Œè¦ä¸‹è½½æ‰“å¼€ï¼Œä¸‹è½½å®Œäº†å°±é€€å‡ºï¼Œå”¯ä¸€é—®é¢˜å°±æ˜¯Chromeçš„è¿…é›·æ‹“å±•ä¼¼ä¹å¤ªçµæ•äº†ç‚¹ï¼Œæˆ‘å•¥éƒ½æ²¡ç‚¹å°±è«åå…¶å¦™å¼¹å‡ºä¸‹è½½é¡µé¢ï¼Œé™¤äº†è¿™ä¸ªï¼Œä¼¼ä¹éå¸¸å®Œç¾ã€‚&lt;br&gt;æ‰€ä»¥ï¼Œåœ¨æˆ‘é…ç½®å¥½aria2å¹¶å†™ä¸‹è¿™ç¯‡åšå®¢åçš„ä¸åˆ°1ä¸ªå°æ—¶æ—¶é—´ï¼Œæˆ‘å¸è½½äº†aira2ï¼Œå¹¶é‡æ–°ç”¨ä¸Šäº†è¿…é›·ã€‚æ‰€ä»¥ï¼Œæˆ‘æœ€ååªæƒ³è¯´ä¸€å¥ï¼Œè´¢å¤§nbï¼è´¢å¤§nbï¼è´¢å¤§nbï¼å¯¹ä¸èµ·ï¼Œèµ°é”™ç‰‡åœºäº†ï¼Œé‡æ¥ï¼ŒIDMç‰›é€¼ï¼IDMç‰›é€¼ï¼IDMç‰›é€¼ï¼&lt;br&gt;å¦‚æœå“ªä½ç‰›é€¼çš„å¤§å“¥çœ‹åˆ°äº†è¿™ç¯‡åšå®¢ï¼Œè®°å¾—å¸®æˆ‘ç»™IDMè¯´å£°ï¼Œä¸€ä¸ªWindowsçš„IDMæ­£ç‰ˆç”¨æˆ·æ€¥éœ€IDM macOSç‰ˆï¼ï¼ï¼&lt;/p&gt;
&lt;/blockquote&gt;</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>å¯¹ä¸èµ·å¤§å®¶ï¼Œåœ¨æˆ‘é…ç½®å¥½è¿™ä¸ªè½¯ä»¶ä¹‹åï¼Œæˆ‘å…´å†²å†²çš„æ‰“å¼€äº†githubæƒ³ä¸‹è½½ä¸‹ssr4.0forWindowsï¼Œè¿«ä¸åŠå¾…æƒ³æ„Ÿå—ä¸‹aria2çš„å¿«æ„Ÿï¼Œç»“æœå‘ç°æˆ‘é”™äº†ã€‚<br>ä¸‹è½½é€Ÿåº¦å°±æ‰å‡ åk/sï¼Œé‚£ä¸€ç¬é—´ï¼Œæˆ‘æ„Ÿè§¦å¾ˆå¤šï¼Œæˆ‘çªç„¶æƒ³åˆ°æˆ‘æ˜¨æ™šçš„è¿…é›·ä¸‹è½½åŒæ ·çš„èµ„æºåŒæ ·çš„ç½‘åŒæ ·çš„vpnä¸‹å¤§å‡ ç™¾k/s çš„é€Ÿåº¦ï¼Œç„¶ååˆçœ‹åˆ°äº†æ­¤æ—¶æˆ‘ç»™äºˆå¸Œæœ›çš„ariaï¼Œæˆ‘é™·å…¥äº†æ²‰æ€ï¼Œæˆ–è®¸è¿™å°±æ˜¯äººç”Ÿå§ã€‚<br>çªç„¶è§‰å¾—macOSè¿…é›·ï¼Œä¹Ÿè¿˜æŒºå¥½çœ‹çš„ï¼Œä¹ŸæŒºå¥½ç”¨çš„ï¼Œå®Œå…¨æ²¡æœ‰å¹¿å‘Šï¼Œè¦ä¸‹è½½æ‰“å¼€ï¼Œä¸‹è½½å®Œäº†å°±é€€å‡ºï¼Œå”¯ä¸€é—®é¢˜å°±æ˜¯Chromeçš„è¿…é›·æ‹“å±•ä¼¼ä¹å¤ªçµæ•äº†ç‚¹ï¼Œæˆ‘å•¥éƒ½æ²¡ç‚¹å°±è«åå…¶å¦™å¼¹å‡ºä¸‹è½½é¡µé¢ï¼Œé™¤äº†è¿™ä¸ªï¼Œä¼¼ä¹éå¸¸å®Œç¾ã€‚<br>æ‰€ä»¥ï¼Œåœ¨æˆ‘é…ç½®å¥½aria2å¹¶å†™ä¸‹è¿™ç¯‡åšå®¢åçš„ä¸åˆ°1ä¸ªå°æ—¶æ—¶é—´ï¼Œæˆ‘å¸è½½äº†aira2ï¼Œå¹¶é‡æ–°ç”¨ä¸Šäº†è¿…é›·ã€‚æ‰€ä»¥ï¼Œæˆ‘æœ€ååªæƒ³è¯´ä¸€å¥ï¼Œè´¢å¤§nbï¼è´¢å¤§nbï¼è´¢å¤§nbï¼å¯¹ä¸èµ·ï¼Œèµ°é”™ç‰‡åœºäº†ï¼Œé‡æ¥ï¼ŒIDMç‰›é€¼ï¼IDMç‰›é€¼ï¼IDMç‰›é€¼ï¼<br>å¦‚æœå“ªä½ç‰›é€¼çš„å¤§å“¥çœ‹åˆ°äº†è¿™ç¯‡åšå®¢ï¼Œè®°å¾—å¸®æˆ‘ç»™IDMè¯´å£°ï¼Œä¸€ä¸ªWindowsçš„IDMæ­£ç‰ˆç”¨æˆ·æ€¥éœ€IDM macOSç‰ˆï¼ï¼ï¼</p></blockquote><span id="more"></span><h1 id="ä¸‹è½½Aira2"><a href="#ä¸‹è½½Aira2" class="headerlink" title="ä¸‹è½½Aira2"></a>ä¸‹è½½Aira2</h1><h2 id="é€šè¿‡githubå®‰è£…"><a href="#é€šè¿‡githubå®‰è£…" class="headerlink" title="é€šè¿‡githubå®‰è£…"></a>é€šè¿‡githubå®‰è£…</h2><ul><li>æ‰“å¼€githubä¸»é¡µ <a href="https://github.com/aria2/aria2/releases">aria2/aria2-Release</a></li><li>æ‰¾åˆ°å¯¹åº”çš„ç³»ç»Ÿä¸‹è½½å®‰è£…å³å¯</li></ul><h2 id="é€šè¿‡Homebrewå®‰è£…"><a href="#é€šè¿‡Homebrewå®‰è£…" class="headerlink" title="é€šè¿‡Homebrewå®‰è£…"></a>é€šè¿‡Homebrewå®‰è£…</h2><p>ç»ˆç«¯è¾“å…¥å‘½ä»¤<code>brew install aria2</code>å®‰è£…å³å¯ã€‚<br>æ²¡æœ‰å®‰è£…Homebrewçš„åŒå­¦å¯ä»¥æœç´¢å®‰è£…Homebrewå³å¯ã€‚</p><blockquote><p>è¿™ä¸ªè½¯ä»¶æ˜¯æ²¡æœ‰å›¾å½¢ç•Œé¢çš„ï¼Œæ‰€ä»¥å®‰è£…å¥½ä¹‹ååœ¨å¯åŠ¨å°é‡Œé¢æ˜¯æ‰¾ä¸åˆ°Aria2çš„å›¾æ ‡çš„</p></blockquote><h1 id="é…ç½®Aira2"><a href="#é…ç½®Aira2" class="headerlink" title="é…ç½®Aira2"></a>é…ç½®Aira2</h1><h2 id="å…ˆåˆ›å»ºAria2çš„é…ç½®æ–‡ä»¶"><a href="#å…ˆåˆ›å»ºAria2çš„é…ç½®æ–‡ä»¶" class="headerlink" title="å…ˆåˆ›å»ºAria2çš„é…ç½®æ–‡ä»¶"></a>å…ˆåˆ›å»ºAria2çš„é…ç½®æ–‡ä»¶</h2><p>Aria2æä¾›äº†ä¸¤ç§å·¥ä½œæ¨¡å¼ï¼š</p><ol><li>ç›´æ¥å‘½ä»¤è¡Œæ¨¡å¼ä¸‹è½½<br> ä¸å¤ªæ¨èè¿™ç§ï¼Œå› ä¸ºå‘½ä»¤è¡Œä¸‹ä¸‹è½½æ¯”è¾ƒç¹çï¼Œè€Œä¸”ä¹Ÿä¸å¤ªå¥½æ“ä½œ</li><li>RPCæ¨¡å¼<br> åœ¨è¿™ç§æ–¹å¼ï¼ŒAria2å¯åŠ¨ä¹‹åå°±ä¼šä»¥åå°çš„æ–¹å¼è¿è¡Œï¼Œä½ å°±å¯ä»¥é€šè¿‡WebUIæˆ–è€…å®‰è£…å®¢æˆ·ç«¯çš„æ–¹å¼æ¥ä½¿ç”¨å›¾å½¢ç•Œé¢æ§åˆ¶Aria2.<br>ä½†æ˜¯è¿™ç§æ–¹å¼ä¸‹éœ€è¦é…ç½®æ–‡ä»¶ï¼Œç°åœ¨å°±å‘Šè¯‰å¤§å®¶å¦‚ä½•é…ç½®ï¼š<br>é¦–å…ˆåˆ›å»ºæ–‡ä»¶</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd ~</span><br><span class="line">mkdir /.aria2</span><br><span class="line">cd /.aria2</span><br><span class="line">touch aria2.conf</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰“å¼€Finderï¼Œä½¿ç”¨å¿«æ·é”®<code>Shift+Cmd+G</code>å¼¹å‡ºè·¯å¾„è¾“å…¥æ¡†ï¼Œæ¥ç€å¤åˆ¶ç²˜è´´<code>~/.aria2/</code>å›è½¦å°±è¿›å…¥äº†<code>.aria2</code>æ–‡ä»¶å¤¹ï¼Œä½ å°±ä¼šçœ‹åˆ°é‡Œé¢çš„<code>aria2.conf</code>æ–‡ä»¶ï¼Œæ¥ç€ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ï¼Œå¤åˆ¶ç²˜è´´ä»¥ä¸‹å†…å®¹<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">#ç”¨æˆ·å</span><br><span class="line">#rpc-user=user</span><br><span class="line">#å¯†ç </span><br><span class="line">#rpc-passwd=passwd</span><br><span class="line">#ä¸Šé¢çš„è®¤è¯æ–¹å¼ä¸å»ºè®®ä½¿ç”¨,å»ºè®®ä½¿ç”¨ä¸‹é¢çš„tokenæ–¹å¼</span><br><span class="line">#è®¾ç½®åŠ å¯†çš„å¯†é’¥</span><br><span class="line">#rpc-secret=token</span><br><span class="line">#å…è®¸rpc</span><br><span class="line">enable-rpc=true</span><br><span class="line">#å…è®¸æ‰€æœ‰æ¥æº, webç•Œé¢è·¨åŸŸæƒé™éœ€è¦</span><br><span class="line">rpc-allow-origin-all=true</span><br><span class="line">#å…è®¸å¤–éƒ¨è®¿é—®ï¼Œfalseçš„è¯åªç›‘å¬æœ¬åœ°ç«¯å£</span><br><span class="line">rpc-listen-all=true</span><br><span class="line">#RPCç«¯å£, ä»…å½“é»˜è®¤ç«¯å£è¢«å ç”¨æ—¶ä¿®æ”¹</span><br><span class="line">#rpc-listen-port=6800</span><br><span class="line">#æœ€å¤§åŒæ—¶ä¸‹è½½æ•°(ä»»åŠ¡æ•°), è·¯ç”±å»ºè®®å€¼: 3</span><br><span class="line">max-concurrent-downloads=5</span><br><span class="line">#æ–­ç‚¹ç»­ä¼ </span><br><span class="line">continue=true</span><br><span class="line">#åŒæœåŠ¡å™¨è¿æ¥æ•°</span><br><span class="line">max-connection-per-server=5</span><br><span class="line">#æœ€å°æ–‡ä»¶åˆ†ç‰‡å¤§å°, ä¸‹è½½çº¿ç¨‹æ•°ä¸Šé™å–å†³äºèƒ½åˆ†å‡ºå¤šå°‘ç‰‡, å¯¹äºå°æ–‡ä»¶é‡è¦</span><br><span class="line">min-split-size=10M</span><br><span class="line">#å•æ–‡ä»¶æœ€å¤§çº¿ç¨‹æ•°, è·¯ç”±å»ºè®®å€¼: 5</span><br><span class="line">split=10</span><br><span class="line">#ä¸‹è½½é€Ÿåº¦é™åˆ¶</span><br><span class="line">max-overall-download-limit=0</span><br><span class="line">#å•æ–‡ä»¶é€Ÿåº¦é™åˆ¶</span><br><span class="line">max-download-limit=0</span><br><span class="line">#ä¸Šä¼ é€Ÿåº¦é™åˆ¶</span><br><span class="line">max-overall-upload-limit=0</span><br><span class="line">#å•æ–‡ä»¶é€Ÿåº¦é™åˆ¶</span><br><span class="line">max-upload-limit=0</span><br><span class="line">#æ–­å¼€é€Ÿåº¦è¿‡æ…¢çš„è¿æ¥</span><br><span class="line">#lowest-speed-limit=0</span><br><span class="line">#éªŒè¯ç”¨ï¼Œéœ€è¦1.16.1ä¹‹åçš„releaseç‰ˆæœ¬</span><br><span class="line">#referer=*</span><br><span class="line">#æ–‡ä»¶ä¿å­˜è·¯å¾„, é»˜è®¤ä¸ºå½“å‰å¯åŠ¨ä½ç½®</span><br><span class="line">dir=/Users/xxx/Downloads</span><br><span class="line">#æ–‡ä»¶ç¼“å­˜, ä½¿ç”¨å†…ç½®çš„æ–‡ä»¶ç¼“å­˜, å¦‚æœä½ ä¸ç›¸ä¿¡Linuxå†…æ ¸æ–‡ä»¶ç¼“å­˜å’Œç£ç›˜å†…ç½®ç¼“å­˜æ—¶ä½¿ç”¨, éœ€è¦1.16åŠä»¥ä¸Šç‰ˆæœ¬</span><br><span class="line">#disk-cache=0</span><br><span class="line">#å¦ä¸€ç§Linuxæ–‡ä»¶ç¼“å­˜æ–¹å¼, ä½¿ç”¨å‰ç¡®ä¿æ‚¨ä½¿ç”¨çš„å†…æ ¸æ”¯æŒæ­¤é€‰é¡¹, éœ€è¦1.15åŠä»¥ä¸Šç‰ˆæœ¬(?)</span><br><span class="line">#enable-mmap=true</span><br><span class="line">#æ–‡ä»¶é¢„åˆ†é…, èƒ½æœ‰æ•ˆé™ä½æ–‡ä»¶ç¢ç‰‡, æé«˜ç£ç›˜æ€§èƒ½. ç¼ºç‚¹æ˜¯é¢„åˆ†é…æ—¶é—´è¾ƒé•¿</span><br><span class="line">#æ‰€éœ€æ—¶é—´ none &lt; falloc ? trunc Â« prealloc, fallocå’Œtruncéœ€è¦æ–‡ä»¶ç³»ç»Ÿå’Œå†…æ ¸æ”¯æŒ</span><br><span class="line">file-allocation=prealloc</span><br><span class="line"></span><br><span class="line">#å¼€å¯BTä¸‹è½½</span><br><span class="line">enable-dht=true</span><br><span class="line">bt-enable-lpd=true</span><br><span class="line">enable-peer-exchange=true</span><br><span class="line"># bt-tracker æ›´æ–°ï¼Œè§£å†³Aria2 BTä¸‹è½½é€Ÿåº¦æ…¢æ²¡é€Ÿåº¦çš„é—®é¢˜</span><br><span class="line">udp://tracker.coppersurfer.tk:6969/announce,http://tracker.internetwarriors.net:1337/announce,udp://tracker.opentrackr.org:1337/announce,udp://9.rarbg.to:2710/announce,udp://9.rarbg.me:2710/announce,udp://tracker.openbittorrent.com:80/announce,http://tracker3.itzmx.com:6961/announce,http://tracker1.itzmx.com:8080/announce,udp://exodus.desync.com:6969/announce,udp://retracker.lanta-net.ru:2710/announce,udp://tracker.torrent.eu.org:451/announce,udp://tracker.tiny-vps.com:6969/announce,udp://bt.xxx-tracker.com:2710/announce,udp://tracker2.itzmx.com:6961/announce,udp://tracker.cyberia.is:6969/announce,udp://open.demonii.si:1337/announce,udp://explodie.org:6969/announce,udp://denis.stalker.upeer.me:6969/announce,udp://open.stealth.si:80/announce,http://tracker4.itzmx.com:2710/announce</span><br></pre></td></tr></table></figure></p><p>ä¸ç”¨æ›´æ”¹å•¥ï¼Œä¹Ÿä¸å»ºè®®æ›´æ”¹å•¥ï¼Œå¤§å®¶å¯ä»¥çœ‹ä¸€ä¸‹ä¸Šé¢çš„é…ç½®å†…å®¹ï¼Œè‡³å°‘è®°å¾—æ¯ä¸€é¡¹å¤§è‡´æ˜¯ä¸ªå•¥ï¼Œå› ä¸ºç­‰ä¼šé…ç½®å›¾å½¢ç•Œé¢éœ€è¦è¿™äº›ä¿¡æ¯ã€‚</p><p>æœ€åé¢çš„BTä¸‹è½½çš„<code>bt-tracker</code>å¤§å®¶é…ç½®è®°å¾—åˆ°è¿™ä¸ªé¡µé¢æ›´æ–°ï¼š<a href="https://raw.githubusercontent.com/ngosang/trackerslist/master/trackers_best.txt">https://raw.githubusercontent.com/ngosang/trackerslist/master/trackers_best.txt</a></p><p>ç„¶åå†æŠŠå†…å®¹å¤åˆ¶ç²˜è´´è¿‡å»ã€‚</p><p>ä¸‹è½½è·¯å¾„ä½ å¯ä»¥è‡ªå·±é€‰æ‹©ï¼Œå¯ä»¥å°±æŠŠ<code>/Users/xxx/Downloads</code>ä¸­çš„<code>xxx</code>æ¢æˆä½ è‡ªå·±çš„macOSç”¨æˆ·åå³å¯ã€‚</p><h1 id="å¯åŠ¨Aria2-RPCæ¨¡å¼"><a href="#å¯åŠ¨Aria2-RPCæ¨¡å¼" class="headerlink" title="å¯åŠ¨Aria2 RPCæ¨¡å¼"></a>å¯åŠ¨Aria2 RPCæ¨¡å¼</h1><p>ç»ˆç«¯è¾“å…¥<code>aria2c --conf-path=&quot;/Users/xxx/.aria2/aria2.conf&quot; -D</code>å°±å¯ä»¥å¯åŠ¨äº†ã€‚ä¸€æ ·çš„ï¼Œxxxæ˜¯ä½ çš„ç”¨æˆ·åã€‚</p><h1 id="è¿›å…¥å›¾å½¢ç•Œé¢"><a href="#è¿›å…¥å›¾å½¢ç•Œé¢" class="headerlink" title="è¿›å…¥å›¾å½¢ç•Œé¢"></a>è¿›å…¥å›¾å½¢ç•Œé¢</h1><p>Aria2æœ‰å¾ˆå¤šç¬¬ä¸‰æ–¹å›¾å½¢ç•Œé¢ï¼Œå®¢æˆ·ç«¯æœ‰ï¼Œä½†æ˜¯æˆ‘æ²¡ç”¨è¿‡æ‰€ä»¥æˆ‘ä¸åšä»‹ç»ï¼Œåœ¨è¿™ä¸»è¦ä»‹ç»WebUIã€‚</p><h2 id="YAAWæ’ä»¶"><a href="#YAAWæ’ä»¶" class="headerlink" title="YAAWæ’ä»¶"></a>YAAWæ’ä»¶</h2><ol><li>åœ¨chromeçš„æ‹“å±•ä¸­å¿ƒæœç´¢<code>YAAW</code>ï¼Œç„¶åå®‰è£…å³å¯ï¼Œæ¥ç€å°±ä¼šå‡ºç°YAAMçš„æ’ä»¶</li><li>ç‚¹å‡»æ‰“å¼€å®ƒï¼Œå°±ä¼šè¿›å…¥YAAWçš„WebUIã€‚<br><img src="https://cdn.littlecorgi.top/mweb/15647112624749.jpg" alt=""></li><li>ç‚¹å‡»å³ä¸Šè§’çš„ğŸ”§å›¾æ ‡ï¼Œè¿›å…¥è®¾ç½®ç•Œé¢<br><img src="https://cdn.littlecorgi.top/mweb/15647113330438.jpg" alt=""></li><li>å¦‚æœä½ ä¸Šé¢çš„<code>aria2.conf</code>æ˜¯ç›´æ¥å¤åˆ¶ç²˜è´´çš„æˆ‘çš„è¯ï¼Œç…§ç€æˆ‘å›¾ä¸­çš„å¡«å†™å°±å¯ä»¥äº†ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨äº†ã€‚æ‰¾åˆ°éœ€è¦ä¸‹è½½çš„èµ„æºå³é”®ç„¶åé€‰æ‹©YAAWå°±ä¼šè‡ªåŠ¨å¼€å§‹ä¸‹è½½ã€‚</li></ol><h2 id="AriaNg-WebUI"><a href="#AriaNg-WebUI" class="headerlink" title="AriaNg WebUI"></a>AriaNg WebUI</h2><p>è¿™ä¸ªæ¯”ä¸Šé¢é‚£ä¸ªå¥½çœ‹ç‚¹ï¼Œç¼ºç‚¹æ˜¯æ²¡æœ‰æ’ä»¶ï¼Œä½ åªèƒ½å¤åˆ¶ä¸‹è½½é“¾æ¥æ‰‹åŠ¨æ–°å»ºä¸‹è½½ä»»åŠ¡</p><ol><li>åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ç½‘å€ <code>http://ariang.mayswind.net/latest/#!/downloading</code><br><img src="https://cdn.littlecorgi.top/mweb/15647115205711.jpg" alt=""></li></ol><ol><li>ç‚¹å‡»AriaNgè®¾ç½®<br><img src="https://cdn.littlecorgi.top/mweb/15647115637006.jpg" alt=""></li><li>ä¸€æ ·ï¼Œå¦‚æœä½ ä¸Šé¢çš„<code>aria2.conf</code>æ˜¯ç›´æ¥å¤åˆ¶ç²˜è´´çš„æˆ‘çš„è¯ï¼Œç…§ç€æˆ‘å›¾ä¸­çš„å¡«å†™å°±å¯ä»¥äº†ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨äº†ã€‚</li><li>ä½ å¯ä»¥ç‚¹å‡»Aria2çŠ¶æ€ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯å·²è¿æ¥ï¼Œå¦‚æœä¸æ˜¯å°±çœ‹çœ‹æœ‰æ²¡æœ‰å“ªå„¿å’Œ<code>aria2.conf</code>è®¾ç½®çš„ä¸ä¸€æ ·ã€‚<br><img src="https://cdn.littlecorgi.top/mweb/15647116500131.jpg" alt=""></li></ol><h1 id="å…³é—­Aria2"><a href="#å…³é—­Aria2" class="headerlink" title="å…³é—­Aria2"></a>å…³é—­Aria2</h1><p>è¿™ä¸ªå¥½åƒå®˜æ–¹æ²¡æœ‰æ–¹æ³•å…³é—­ï¼Œäºæ˜¯æˆ‘ä»¬å°±ç”¨æœ€ç®€å•ç²—æš´çš„æ–¹æ³•ã€‚</p><ol><li>ç»ˆç«¯è¾“å…¥<code>ps aux|grep aria2</code>å¾—åˆ°Aria2çš„è¿›ç¨‹å·</li><li>ç„¶åè¾“å…¥<code>kill number</code>è°ƒç”¨ç³»ç»Ÿå‘½ä»¤ç›´æ¥æ€æ­»è¿™ä¸ªè¿›ç¨‹ï¼Œ<code>number</code>æ”¹ä¸ºä¸Šé¢çš„åˆ°çš„è¿›ç¨‹å·å³å¯ã€‚</li></ol><h1 id="é…ç½®è‡ªå¯åŠ¨"><a href="#é…ç½®è‡ªå¯åŠ¨" class="headerlink" title="é…ç½®è‡ªå¯åŠ¨"></a>é…ç½®è‡ªå¯åŠ¨</h1><h2 id="åˆ›å»ºshæ–‡ä»¶"><a href="#åˆ›å»ºshæ–‡ä»¶" class="headerlink" title="åˆ›å»ºshæ–‡ä»¶"></a>åˆ›å»ºshæ–‡ä»¶</h2><p>è¿›å…¥åˆ°å¸Œæœ›ä¿å­˜çš„ç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶<code>aria2.sh</code>ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch aria2.sh</span><br></pre></td></tr></table></figure><br>ç„¶åè¾“å…¥ä¸‹é¢çš„ä»£ç å¹¶ä¿å­˜ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">echo &quot;start aria2 server&quot;</span><br><span class="line">aria2c --conf-path=&quot;/Users/xxx/.aria2/aria2.conf&quot; -D</span><br><span class="line">echo &quot;exiting&quot;</span><br><span class="line">exit</span><br></pre></td></tr></table></figure></p><h2 id="ä¿®æ”¹æ–‡ä»¶æƒé™"><a href="#ä¿®æ”¹æ–‡ä»¶æƒé™" class="headerlink" title="ä¿®æ”¹æ–‡ä»¶æƒé™"></a>ä¿®æ”¹æ–‡ä»¶æƒé™</h2><ol><li>ç»™<code>aria2.sh</code>æ–‡ä»¶æ‰§è¡Œæƒé™ï¼š<code>chmod +x aria2.sh</code></li><li>è®©<code>aria2.sh</code>é»˜è®¤ç”¨è‡ªå·±å¸¸ç”¨çš„terminalå·¥å…·æ‰“å¼€ã€‚å³é”®æ–‡ä»¶ ï¼&gt; æ˜¾ç¤ºç®€ä»‹ï¼šè®¾ç½®â€œæ‰“å¼€æ–¹å¼-&gt;æ‰€æœ‰åº”ç”¨ç¨‹åºâ€ä¸ºè‡ªå·±çš„terminalå³å¯ã€‚</li></ol><h2 id="æ·»åŠ åˆ°å¼€æœºå¯åŠ¨é¡¹"><a href="#æ·»åŠ åˆ°å¼€æœºå¯åŠ¨é¡¹" class="headerlink" title="æ·»åŠ åˆ°å¼€æœºå¯åŠ¨é¡¹"></a>æ·»åŠ åˆ°å¼€æœºå¯åŠ¨é¡¹</h2><ol><li>åœ¨<code>Mac</code>æ¡Œé¢é¡¶éƒ¨èœå•ä¸­ï¼Œç‚¹å‡»è‹¹æœå›¾æ ‡ï¼Œåœ¨å¼¹å‡ºçš„èœå•ä¸­ï¼Œç‚¹å‡»è¿›å…¥ç³»ç»Ÿåå¥½è®¾ç½®ã€‚</li><li>åœ¨æ‰“å¼€ç³»ç»Ÿåå¥½è®¾ç½®åï¼Œç„¶åç‚¹å‡»è¿›å…¥ç”¨æˆ·ä¸ç¾¤ç»„è®¾ç½®é€‰é¡¹ã€‚</li><li>ç„¶ååœ¨ç”¨æˆ·ä¸ç¾¤ç»„è®¾ç½®ç•Œé¢ï¼Œå…ˆåœ¨å·¦ä¾§é€‰æ‹©ç™»é™†ç”¨æˆ·-å½“å‰ç”¨æˆ·ï¼Œç„¶ååœ¨å³ä¾§åˆ‡æ¢åˆ°ç™»å½•é¡¹</li><li>ç„¶åç‚¹ä¸‹é¢çš„+è¿›è¡Œæ·»åŠ ï¼Œé€‰æ‹©åˆšæ‰æˆ‘ä»¬åˆ›å»ºçš„æ–‡ä»¶aria2.shï¼Œå¹¶å‹¾é€‰éšè—ã€‚<br>è¿™æ · aria2 å°±å¯ä»¥åœ¨æ¯æ¬¡å¼€æœºçš„æ—¶å€™è‡ªå¯åŠ¨äº†ã€‚</li></ol><h3 id="æœ€åï¼ŒAria2å¸è½½æ–¹å¼"><a href="#æœ€åï¼ŒAria2å¸è½½æ–¹å¼" class="headerlink" title="æœ€åï¼ŒAria2å¸è½½æ–¹å¼"></a>æœ€åï¼ŒAria2å¸è½½æ–¹å¼</h3><p>ç»ˆç«¯ä¸‹æ‰§è¡Œ<code>sudo pkgutil --forget aria2</code>ä»¥åŠ<code>sudo pkgutil --forget aria2.path</code>ï¼Œç„¶åä¸Šé¢åˆ›å»ºçš„<code>.aria2</code>æ–‡ä»¶å¤¹</p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/%E6%9D%82%E9%A1%B9/">æ‚é¡¹</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Aria2/">Aria2</category>
      
      
      <comments>https://www.littlecorgi.top/posts/4f46fdbb.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>æ“ä½œç³»ç»Ÿ3--è¿›ç¨‹çš„åŒæ­¥</title>
      <link>https://www.littlecorgi.top/posts/362e394f.html</link>
      <guid>https://www.littlecorgi.top/posts/362e394f.html</guid>
      <pubDate>Wed, 31 Jul 2019 02:58:39 GMT</pubDate>
      
      <description>&lt;blockquote&gt;
&lt;p&gt;å¤§å®¶å¯ä»¥çœ‹ä¸‹æˆ‘ä½¿ç”¨å¹•å¸ƒè½¯ä»¶ç”»çš„&lt;a href=&quot;https://mubu.com/doc/3Pf0zwzrgw&quot;&gt;æ€ç»´å¯¼å›¾&lt;/a&gt;ï¼Œå¦‚æœå¤§å®¶æƒ³ä½¿ç”¨å¹•å¸ƒå¯ä»¥é€šè¿‡æˆ‘çš„é‚€è¯·é“¾æ¥æ³¨å†Œï¼Œå¯å…è´¹è·å¾—ä¸€ä¸ªæœˆé«˜çº§ä¼šå‘˜&lt;a href=&quot;https://mubu.com/inv/477598&quot;&gt;https://mubu.com/inv/477598&lt;/a&gt;&lt;br&gt;</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>å¤§å®¶å¯ä»¥çœ‹ä¸‹æˆ‘ä½¿ç”¨å¹•å¸ƒè½¯ä»¶ç”»çš„<a href="https://mubu.com/doc/3Pf0zwzrgw">æ€ç»´å¯¼å›¾</a>ï¼Œå¦‚æœå¤§å®¶æƒ³ä½¿ç”¨å¹•å¸ƒå¯ä»¥é€šè¿‡æˆ‘çš„é‚€è¯·é“¾æ¥æ³¨å†Œï¼Œå¯å…è´¹è·å¾—ä¸€ä¸ªæœˆé«˜çº§ä¼šå‘˜<a href="https://mubu.com/inv/477598">https://mubu.com/inv/477598</a><br><span id="more"></span></p><h1 id="3-1-è¿›ç¨‹åŒæ­¥"><a href="#3-1-è¿›ç¨‹åŒæ­¥" class="headerlink" title="3.1 è¿›ç¨‹åŒæ­¥"></a>3.1 è¿›ç¨‹åŒæ­¥</h1><h2 id="3-1-1-åŒæ­¥æ¦‚å¿µ"><a href="#3-1-1-åŒæ­¥æ¦‚å¿µ" class="headerlink" title="3.1.1 åŒæ­¥æ¦‚å¿µ"></a>3.1.1 åŒæ­¥æ¦‚å¿µ</h2><h3 id="3-1-1-1-è¿›ç¨‹åŒæ­¥çš„æ¦‚å¿µ"><a href="#3-1-1-1-è¿›ç¨‹åŒæ­¥çš„æ¦‚å¿µ" class="headerlink" title="3.1.1.1 è¿›ç¨‹åŒæ­¥çš„æ¦‚å¿µ"></a>3.1.1.1 è¿›ç¨‹åŒæ­¥çš„æ¦‚å¿µ</h3><p>è¿›ç¨‹åŒæ­¥æœºåˆ¶çš„ä¸»è¦ä»»åŠ¡å°±æ˜¯å¯¹å¤šä¸ªç›¸å…³è¿›ç¨‹åœ¨æ‰§è¡Œæ¬¡åºä¸Šè¿›è¡Œåè°ƒï¼Œä½¿å¹¶å‘æ‰§è¡Œçš„è¿›ç¨‹ä¹‹é—´èƒ½æŒ‰ç…§ä¸€å®šçš„è§„åˆ™å…±äº«ç³»ç»Ÿèµ„æºï¼Œå¹¶èƒ½å¾ˆå¥½çš„é…åˆå·¥ä½œï¼Œä»è€Œä½¿ç¨‹åºçš„æ‰§è¡Œå…·æœ‰å¯å†ç°æ€§ã€‚</p></blockquote><h3 id="3-1-1-2-åˆ¶çº¦å…³ç³»"><a href="#3-1-1-2-åˆ¶çº¦å…³ç³»" class="headerlink" title="3.1.1.2 åˆ¶çº¦å…³ç³»"></a>3.1.1.2 åˆ¶çº¦å…³ç³»</h3><p>å¯¹äºå¤„äºåŒä¸€ä¸ªç³»ç»Ÿä¸­çš„å¤šä¸ªè¿›ç¨‹ï¼Œç”±äºä»–ä»¬å…±äº«ç€ç³»ç»Ÿçš„èµ„æºï¼Œæˆ–è€…ä¸ºäº†å®ŒæˆåŒä¸€ä¸ªä»»åŠ¡è€Œç›¸äº’åˆä½œï¼Œæ‰€ä»¥ä»–ä»¬ä¹‹é—´å¯èƒ½å­˜åœ¨ä¸‹é¢ä¸¤ç§åˆ¶çº¦å…³ç³»ï¼š</p><ol><li>é—´æ¥ç›¸äº’åˆ¶çº¦å…³ç³»<br> ç³»ç»Ÿä¸­çš„è¿›ç¨‹éš¾å…ä¼šè°ƒç”¨åƒæ‰“å°æœºã€CPUç­‰è¿™æ ·çš„ä¸´ç•Œèµ„æºã€‚å¦‚æœæƒ³è¿™äº›èµ„æºæ­£å¸¸è°ƒç”¨ï¼Œå¿…é¡»ä¿è¯å¤šä¸ªè¿›ç¨‹ä¹‹é—´äº’æ–¥åœ°è®¿é—®è¿™äº›èµ„æºï¼Œè¿›è€Œå°±åœ¨è¿™äº›è¿›ç¨‹é—´å½¢æˆäº†é—´æ¥ç›¸äº’åˆ¶çº¦å…³ç³»ã€‚<br> ä¸ºäº†ä¿è¯è¿™äº›è¿›ç¨‹èƒ½æœ‰åºçš„è¿›è¡Œï¼Œå¯¹äºç³»ç»Ÿä¸­çš„è¿™ç±»èµ„æºï¼Œå¿…é¡»ç”±ç³»ç»Ÿå®æ–½ç»Ÿä¸€åˆ†é…ï¼Œå³ç”¨æˆ·åœ¨ä½¿ç”¨ä¹‹å‰å¿…é¡»å…ˆæå‡ºç”³è¯·ï¼Œç»ä¸å…è®¸ç”¨æˆ·ç›´æ¥ä½¿ç”¨ã€‚</li><li>ç›´æ¥ç›¸äº’åˆ¶çº¦å…³ç³»<br> åœ¨ç³»ç»Ÿä¸­ä¹Ÿä¼šå­˜åœ¨ä¸€äº›è¿›ç¨‹ï¼Œä»–ä»¬ä¸ºäº†å®ŒæˆåŒä¸€ä¸ªç›®æ ‡è€Œç›¸äº’é…åˆåˆä½œå·¥ä½œï¼Œè¿™ç§å°±æ˜¯ç›´æ¥äº’ç›¸åˆ¶çº¦å…³ç³»ã€‚<br> è¿›ç¨‹é—´çš„ç›´æ¥åˆ¶çº¦å…³ç³»å°±æ˜¯æºäºä»–ä»¬ä¹‹é—´çš„ç›¸äº’åˆä½œã€‚</li></ol><h3 id="3-1-1-3-ä¸´ç•Œèµ„æº"><a href="#3-1-1-3-ä¸´ç•Œèµ„æº" class="headerlink" title="3.1.1.3 ä¸´ç•Œèµ„æº"></a>3.1.1.3 ä¸´ç•Œèµ„æº</h3><p>è™½ç„¶å¤šä¸ªè¿›ç¨‹å¯ä»¥å…±äº«ç³»ç»Ÿä¸­çš„å„ç§èµ„æºï¼Œä½†å…¶ä¸­è®¸å¤šèµ„æºä¸€æ¬¡åªèƒ½ä¸ºä¸€ä¸ªè¿›ç¨‹æ‰€ä½¿ç”¨ï¼Œæˆ‘ä»¬æŠŠä¸€æ¬¡ä»…å…è®¸ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨çš„èµ„æºç§°ä¸ºä¸´ç•Œèµ„æºã€‚è®¸å¤šç‰©ç†è®¾å¤‡éƒ½å±äºä¸´ç•Œèµ„æºï¼Œå¦‚æ‰“å°æœºç­‰ã€‚æ­¤å¤–ï¼Œå¦‚æœå˜é‡ã€æ•°æ®ç­‰éƒ½å¯ä»¥è¢«è‹¥å¹²è¿›ç¨‹å…±äº«ï¼Œä¹Ÿå±äºä¸´ç•Œèµ„æºã€‚</p><h3 id="3-1-1-4-ä¸´ç•ŒåŒº"><a href="#3-1-1-4-ä¸´ç•ŒåŒº" class="headerlink" title="3.1.1.4 ä¸´ç•ŒåŒº"></a>3.1.1.4 ä¸´ç•ŒåŒº</h3><p>äººä»¬æŠŠåœ¨æ¯ä¸ªè¿›ç¨‹ä¸­è®¿é—®ä¸´ç•Œèµ„æºçš„é‚£æ®µä»£ç ç§°ä¸ºä¸´ç•ŒåŒºã€‚è‹¥èƒ½ä¿è¯è¯¸è¿›ç¨‹äº’æ–¥åœ°è¿›å…¥è‡ªå·±çš„ä¸´ç•ŒåŒºï¼Œä¾¿å¯å®ç°è¯¸è¿›ç¨‹å¯¹ä¸´ç•Œèµ„æºçš„äº’æ–¥è®¿é—®ã€‚<br>ä¸ºæ­¤ï¼Œæ¯ä¸ªè¿›ç¨‹åœ¨è¿›å…¥ä¸´ç•ŒåŒºä¹‹å‰ï¼Œåº”å…ˆå¯¹è¦è®¿é—®çš„ä¸´ç•ŒåŒºè¿›ç¨‹æ£€æŸ¥ï¼šå¦‚æœä¸´ç•ŒåŒºæ­£åœ¨è¢«è®¿é—®ï¼Œåˆ™è¿›ç¨‹ä¸èƒ½è¿›å…¥ä¸´ç•ŒåŒºï¼›å¦‚æœä¸´ç•ŒåŒºæ²¡æœ‰è¢«è®¿é—®ï¼Œé‚£è¿›ç¨‹å°±å¯è¿›å…¥ä¸´ç•ŒåŒºï¼Œå¹¶å°†ä¸´ç•ŒåŒºæ­£åœ¨è¢«è®¿é—®çš„æ ‡å¿—ç½®ä¸ºæ­£è¢«è®¿é—®ã€‚<br>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†è®¿é—®ä¸´ç•Œèµ„æºçš„çº¿ç¨‹çš„å¾ªç¯ä»£ç åˆ†ä¸ºå¦‚ä¸‹éƒ¨åˆ†ï¼š</p><ul><li>è®¿é—®ä¸´ç•ŒåŒºä¹‹å‰ç”¨äºä¸Šè¿°åˆ¤æ–­çš„ä»£ç åŒºç§°ä¸º<strong>è¿›å…¥åŒº</strong></li><li>åœ¨è®¿é—®å®Œä¸´ç•ŒåŒºä¹‹åç”¨äºå°†ä¸´ç•ŒåŒºæ­£è¢«è®¿é—®çš„æ ‡å¿—æ¢å¤ä¸ºæœªè¢«è®¿é—®çš„æ ‡å¿—çš„ä»£ç åŒºç§°ä¸º<strong>é€€å‡ºåŒº</strong></li><li>é™¤äº†è¿›å…¥å»ã€ä¸´ç•ŒåŒºã€é€€å‡ºåŒºä»£ç ä¹‹å¤–çš„å…¶å®ƒä»£ç ç§°ä¸º<strong>å‰©ä½™åŒº</strong></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    è¿›å…¥åŒº</span><br><span class="line">    ä¸´ç•ŒåŒº</span><br><span class="line">    é€€å‡ºåŒº</span><br><span class="line">    å‰©ä½™åŒº</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-1-1-5-åŒæ­¥æœºåˆ¶åº”éµå¾ªçš„è§„åˆ™"><a href="#3-1-1-5-åŒæ­¥æœºåˆ¶åº”éµå¾ªçš„è§„åˆ™" class="headerlink" title="3.1.1.5 åŒæ­¥æœºåˆ¶åº”éµå¾ªçš„è§„åˆ™"></a>3.1.1.5 åŒæ­¥æœºåˆ¶åº”éµå¾ªçš„è§„åˆ™</h3><ol><li>ç©ºé—²è®©è¿›ï¼šå½“æ— è¿›ç¨‹å¤„äºä¸´ç•ŒåŒºæ—¶ï¼Œè¡¨æ˜ä¸´ç•Œèµ„æºå¤„äºç©ºé—²çŠ¶æ€ï¼Œåº”å…è®¸ä¸€ä¸ªè¯·æ±‚è¿›å…¥ä¸´ç•ŒåŒºçš„è¿›ç¨‹ç«‹å³è¿›å…¥è‡ªå·±çš„ä¸´ç•ŒåŒºï¼Œä»¥æœ‰æ•ˆçš„åˆ©ç”¨ä¸´ç•Œèµ„æº</li><li>å¿™åˆ™ç­‰å¾…ï¼šå½“å·²æœ‰è¿›ç¨‹è¿›å…¥ä¸´ç•ŒåŒºï¼Œè¡¨æ˜ä¸´ç•Œèµ„æºæ­£åœ¨è¢«è®¿é—®ï¼Œå› è€Œå…¶å®ƒè§†å›¾è¿›å…¥ä¸´ç•ŒåŒºçš„è¿›ç¨‹å¿…é¡»ç­‰å¾…ï¼Œä»¥ä¿è¯å¯¹ä¸´ç•Œèµ„æºçš„äº’æ–¥è®¿é—®</li><li>æœ‰é™ç­‰å¾…ï¼šå¯¹è¦æ±‚è®¿é—®ä¸´ç•Œèµ„æºçš„è¿›ç¨‹ï¼Œåº”ä¿è¯åœ¨æœ‰é™çš„æ—¶é—´å†…èƒ½è¿›å…¥è‡ªå·±çš„ä¸´ç•ŒåŒºï¼Œä»¥å…é™·å…¥â€œæ­»ç­‰â€çŠ¶æ€</li><li>è®©æƒç­‰å¾…ï¼šå½“è¿›ç¨‹ä¸èƒ½è¿›å…¥è‡ªå·±çš„ä¸´ç•ŒåŒºæ—¶ï¼Œåº”ç«‹å³é‡Šæ”¾å¤„ç†æœºï¼Œä»¥å…è¿›ç¨‹é™·å…¥â€œå¿™ç­‰â€çŠ¶æ€</li></ol><h2 id="3-1-2-åŒæ­¥æœºåˆ¶"><a href="#3-1-2-åŒæ­¥æœºåˆ¶" class="headerlink" title="3.1.2 åŒæ­¥æœºåˆ¶"></a>3.1.2 åŒæ­¥æœºåˆ¶</h2><h3 id="3-2-2-1-ä¿¡å·é‡æœºåˆ¶"><a href="#3-2-2-1-ä¿¡å·é‡æœºåˆ¶" class="headerlink" title="3.2.2.1 ä¿¡å·é‡æœºåˆ¶"></a>3.2.2.1 ä¿¡å·é‡æœºåˆ¶</h3><h4 id="1-ä»€ä¹ˆæ˜¯ä¿¡å·é‡"><a href="#1-ä»€ä¹ˆæ˜¯ä¿¡å·é‡" class="headerlink" title="1. ä»€ä¹ˆæ˜¯ä¿¡å·é‡"></a>1. ä»€ä¹ˆæ˜¯ä¿¡å·é‡</h4><p>ä¿¡å·é‡çš„æ•°æ®ç»“æ„ä¸ºä¸€ä¸ªå€¼å’Œä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡é’ˆæŒ‡å‘ç­‰å¾…è¯¥ä¿¡å·é‡çš„ä¸‹ä¸€ä¸ªè¿›ç¨‹ï¼Œå€¼åˆ™ä¸ç›¸åº”çš„èµ„æºçš„ä½¿ç”¨æƒ…å†µæœ‰å…³ï¼š</p><ul><li>å½“ä»–çš„å€¼å¤§äº0æ—¶ï¼Œè¡¨ç¤ºå½“å‰å¯ç”¨èµ„æºçš„æ•°é‡</li><li>å½“ä»–çš„å€¼å°äº0æ—¶ï¼Œå…¶ç»å¯¹å€¼è¡¨ç¤ºç­‰å¾…ä½¿ç”¨è¯¥èµ„æºçš„è¿›ç¨‹ä¸ªæ•°</li></ul><h4 id="2-ä»€ä¹ˆæ˜¯ä¿¡å·é‡æœºåˆ¶"><a href="#2-ä»€ä¹ˆæ˜¯ä¿¡å·é‡æœºåˆ¶" class="headerlink" title="2. ä»€ä¹ˆæ˜¯ä¿¡å·é‡æœºåˆ¶"></a>2. ä»€ä¹ˆæ˜¯ä¿¡å·é‡æœºåˆ¶</h4><p>ä¿¡å·é‡æœºåˆ¶å³åˆ©ç”¨pvæ“ä½œå¯¹ä¿¡å·é‡è¿›è¡Œå¤„ç†ã€‚è€Œä¸”ä¿¡å·é‡åªèƒ½ç”±pvæ“ä½œè¿›ç¨‹å¤„ç†ã€‚<br>å½“S&gt;0æ—¶ï¼ŒSè¡¨ç¤ºå¯ç”¨èµ„æºçš„æ•°é‡ã€‚æ‰§è¡Œä¸€æ¬¡Pæ“ä½œæ„å‘³ç€åˆ†é…ä¸€ä¸ªå•ä½èµ„æºï¼Œå› æ­¤Så€¼å‡1ï¼›å½“S<0æ—¶ï¼Œè¡¨ç¤ºå·²ç»æ²¡æœ‰å¯ç”¨èµ„æºï¼Œè¯·æ±‚è€…å¿…é¡»ç­‰å¾…åˆ«çš„è¿›ç¨‹é‡Šæ”¾è¯¥ç±»èµ„æºï¼Œä»–æ‰èƒ½è¿è¡Œä¸‹å»ã€‚è€Œæ‰§è¡Œä¸€ä¸ªVæ“ä½œä»¥ä¸ºç€é‡Šæ”¾ä¸€ä¸ªå•ä½èµ„æºï¼Œå› æ­¤Sçš„å€¼åŠ 1ï¼›å½“S>0ï¼Œè¡¨ç¤ºæœ‰æŸäº›èµ„æºæ­£åœ¨ç­‰å¾…è¯¥èµ„æºï¼Œå› æ­¤è¦å”¤é†’ä¸€ä¸ªç­‰å¾…çŠ¶æ€çš„è¿›ç¨‹ï¼Œä½¿ä¹‹è¿è¡Œä¸‹å»ã€‚</p><h3 id="3-2-2-2-PVæ“ä½œ"><a href="#3-2-2-2-PVæ“ä½œ" class="headerlink" title="3.2.2.2 PVæ“ä½œ"></a>3.2.2.2 PVæ“ä½œ</h3><h4 id="1-Pæ“ä½œ"><a href="#1-Pæ“ä½œ" class="headerlink" title="1. Pæ“ä½œ"></a>1. Pæ“ä½œ</h4><p>ç”³è¯·ä¸€ä¸ªå•ä½èµ„æºï¼Œè¿›ç¨‹è¿›å…¥ä¸´ç•ŒåŒº<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wait (S) &#123;</span><br><span class="line">    <span class="keyword">while</span> (s &lt;= <span class="number">0</span>) ;<span class="comment">// å¦‚æœæ²¡æœ‰èµ„æºåˆ™å¾ªç¯ç­‰å¾…</span></span><br><span class="line">    S--;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ol><li>å°†ä¿¡å·é‡Sçš„å€¼å‡1ï¼Œå³S=S-1ï¼›</li><li>å¦‚æœS&lt;=0ï¼Œåˆ™è¯¥è¿›ç¨‹ç»§ç»­æ‰§è¡Œï¼›å¦åˆ™è¯¥è¿›ç¨‹ç½®ä¸ºç­‰å¾…çŠ¶æ€ï¼Œæ’å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚</li></ol><h4 id="2-Væ“ä½œ"><a href="#2-Væ“ä½œ" class="headerlink" title="2. Væ“ä½œ"></a>2. Væ“ä½œ</h4><p>é‡Šæ”¾ä¸€ä¸ªå•ä½èµ„æºï¼Œè¿›ç¨‹ä»ä¸´ç•ŒåŒºå‡ºæ¥<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">signal (S) &#123;</span><br><span class="line">    S++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ol><li>å°†ä¿¡å·é‡Sçš„å€¼åŠ 1ï¼Œå³S=S+1ï¼›</li><li>å¦‚æœS&gt;0ï¼Œåˆ™è¯¥è¿›ç¨‹ç»§ç»­æ‰§è¡Œï¼›å¦åˆ™é‡Šæ”¾é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªç­‰å¾…ä¿¡å·é‡çš„è¿›ç¨‹ã€‚</li></ol><h4 id="3-PVæ“ä½œçš„æ„ä¹‰"><a href="#3-PVæ“ä½œçš„æ„ä¹‰" class="headerlink" title="3. PVæ“ä½œçš„æ„ä¹‰"></a>3. PVæ“ä½œçš„æ„ä¹‰</h4><p>ç”¨PVæ“ä½œæ¥å®ç°è¿›ç¨‹çš„åŒæ­¥å’Œäº’æ–¥</p><h3 id="3-2-3-ç®¡ç¨‹æœºåˆ¶"><a href="#3-2-3-ç®¡ç¨‹æœºåˆ¶" class="headerlink" title="3.2.3 ç®¡ç¨‹æœºåˆ¶"></a>3.2.3 ç®¡ç¨‹æœºåˆ¶</h3><p>å°½ç®¡ä¿¡å·é‡æœºåˆ¶å¾ˆæ–¹åˆé«˜æ•ˆï¼Œä½†æ˜¯æ¯ä¸ªè¦è®¿é—®ä¸´ç•Œèµ„æºçš„è¿›ç¨‹éƒ½å¿…é¡»å¿…å¤‡åŒæ­¥æ“ä½œï¼Œè¿™å°±ä½¿å¾—å¤§é‡çš„åŒæ­¥æ“ä½œåˆ†æ•£åœ¨å„ä¸ªè¿›ç¨‹ä¸­ã€‚è¿™ä¸ä»…ç»™ç³»ç»Ÿçš„ç®¡ç†å¸¦æ¥éº»çƒ¦ï¼Œè¿˜ä¼šå› åŒæ­¥æ“ä½œä¸å½“è€Œäº§ç”Ÿæ­»é”ã€‚ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå˜äº§ç”Ÿäº†ä¸€ç§æ–°çš„åŒæ­¥å·¥å…·â€”â€”ç®¡ç¨‹ã€‚</p><h4 id="1-ç®¡ç¨‹çš„å®šä¹‰"><a href="#1-ç®¡ç¨‹çš„å®šä¹‰" class="headerlink" title="1. ç®¡ç¨‹çš„å®šä¹‰"></a>1. ç®¡ç¨‹çš„å®šä¹‰</h4><p>ç³»ç»Ÿä¸­å„ç§ç¡¬ä»¶èµ„æºå’Œè½¯ä»¶èµ„æºå‡å¯ç”¨æ•°æ®ç»“æ„æŠ½è±¡åœ°æè¿°å…¶èµ„æºç‰¹å¾ï¼Œå³ç”¨å°‘é‡ä¿¡æ¯å’Œå¯¹è¯¥èµ„æºæ‰€æ‰§è¡Œçš„æ“ä½œæ¥è¡¨å¾è¯¥èµ„æºã€‚æ‰€ä»¥å°±å‡ºç°äº†ç®¡ç¨‹ã€‚<br>ç®¡ç¨‹å¯ä»¥çœ‹æˆä¸€ä¸ªè½¯ä»¶æ¨¡å—ï¼Œå®ƒæ˜¯å°†å…±äº«çš„å˜é‡å’Œå¯¹äºè¿™äº›å…±äº«å˜é‡çš„æ“ä½œå°è£…èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªå…·æœ‰ä¸€å®šæ¥å£çš„åŠŸèƒ½æ¨¡å—ï¼Œè¿›ç¨‹å¯ä»¥è°ƒç”¨ç®¡ç¨‹æ¥å®ç°è¿›ç¨‹çº§åˆ«çš„å¹¶å‘æ§åˆ¶ã€‚<br>åœ¨ç®¡ç¨‹å…¥å£å¤„çš„ç­‰å¾…é˜Ÿåˆ—ç§°ä¸ºå…¥å£ç­‰å¾…é˜Ÿåˆ—ï¼Œç”±äºè¿›ç¨‹ä¼šæ‰§è¡Œå”¤é†’æ“ä½œï¼Œå› æ­¤å¯èƒ½æœ‰å¤šä¸ªç­‰å¾…ä½¿ç”¨ç®¡ç¨‹çš„é˜Ÿåˆ—ï¼Œè¿™æ ·çš„é˜Ÿåˆ—ç§°ä¸ºç´§æ€¥é˜Ÿåˆ—ï¼Œå®ƒçš„ä¼˜å…ˆçº§é«˜äºç­‰å¾…é˜Ÿåˆ—ã€‚</p><h4 id="2-ç®¡ç¨‹çš„ç‰¹å¾"><a href="#2-ç®¡ç¨‹çš„ç‰¹å¾" class="headerlink" title="2. ç®¡ç¨‹çš„ç‰¹å¾"></a>2. ç®¡ç¨‹çš„ç‰¹å¾</h4><ol><li>æ¨¡å—åŒ–<br> ç®¡ç¨‹æ˜¯ä¸€ä¸ªåŸºæœ¬çš„è½¯ä»¶æ¨¡å—ï¼Œå¯ä»¥å•ç‹¬ç¼–è¯‘</li><li>æŠ½è±¡æ•°æ®ç±»å‹<br> ç®¡ç¨‹ä¸­å°è£…äº†æ•°æ®åŠå¯¹äºæ•°æ®çš„æ“ä½œ</li><li>ä¿¡æ¯éšè—<br> ç®¡ç¨‹å¤–çš„è¿›ç¨‹æˆ–å…¶ä»–è½¯ä»¶æ¨¡å—åªèƒ½é€šè¿‡ç®¡ç¨‹å¯¹å¤–çš„æ¥å£æ¥è®¿é—®ç®¡ç¨‹æä¾›çš„æ“ä½œï¼Œç®¡ç¨‹å†…éƒ¨çš„å®ç°ç»†èŠ‚å¯¹å¤–ç•Œæ˜¯é€æ˜çš„</li><li>ä½¿ç”¨çš„äº’æ–¥æ€§<br> ä»»ä½•ä¸€ä¸ªæ—¶åˆ»ï¼Œç®¡ç¨‹åªèƒ½ç”±ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ã€‚è¿›å…¥ç®¡ç¨‹æ—¶çš„äº’æ–¥ç”±ç¼–è¯‘å™¨è´Ÿè´£å®Œæˆ</li></ol><h4 id="3-æ¡ä»¶å˜é‡"><a href="#3-æ¡ä»¶å˜é‡" class="headerlink" title="3. æ¡ä»¶å˜é‡"></a>3. æ¡ä»¶å˜é‡</h4><p>ä¸€ä¸ªè¿›ç¨‹è¢«é˜»å¡æˆ–æŒ‚èµ·çš„æ¡ä»¶ï¼ˆåŸå› ï¼‰æœ‰å¤šä¸ªï¼Œå› æ­¤åœ¨ç®¡ç¨‹ä¸­è®¾ç½®äº†å¤šä¸ªæ¡ä»¶å˜é‡ï¼Œå¯¹è¿™äº›æ¡ä»¶å˜é‡çš„è®¿é—®åªèƒ½åœ¨ç®¡ç¨‹ä¸­è¿›è¡Œã€‚<br>ç®¡ç¨‹ä¸­æ¯ä¸ªæ¡ä»¶å˜é‡éƒ½éœ€äºˆä»¥è¯´æ˜ï¼Œå½¢å¼ä¸ºï¼š<code>condition x</code>ã€‚å¯¹å…¶çš„æ“ä½œåªæœ‰<code>wait</code>å’Œ<code>signal</code>ï¼Œå…¶å«ä¹‰æ˜¯ï¼š</p><ol><li><code>x.wait</code>ï¼šæ­£åœ¨è°ƒç”¨ç®¡ç¨‹çš„è¿›ç¨‹å› xæ¡ä»¶éœ€è¦è¢«é˜»å¡æˆ–æŒ‚èµ·ï¼Œåˆ™è°ƒç”¨<code>x.wait</code>å°†è‡ªå·±æ’å…¥åˆ°xæ¡ä»¶çš„ç­‰å¾…é˜Ÿåˆ—ä¸Šï¼Œå¹¶é‡Šæ”¾ç®¡ç¨‹ï¼ŒçŸ¥é“xæ¡ä»¶å‘ç”Ÿå˜åŒ–ã€‚æ­¤æ—¶å…¶å®ƒè¿›ç¨‹å¯ä»¥ä½¿ç”¨è¯¥ç®¡ç¨‹ã€‚</li><li><code>x.signal</code>ï¼š æ­£åœ¨è°ƒç”¨ç®¡ç¨‹çš„è¿›ç¨‹å‘ç°xæ¡ä»¶å‘ç”Ÿäº†å˜åŒ–ï¼Œåˆ™è°ƒç”¨<code>x.signal</code>ï¼Œé‡æ–°å¯åŠ¨ä¸€ä¸ªå› xæ¡ä»¶è€Œé˜»å¡æˆ–æŒ‚èµ·çš„è¿›ç¨‹ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªè¿™æ ·çš„è¿›ç¨‹ï¼Œåˆ™é€‰æ‹©å…¶ä¸­çš„ä¸€ä¸ªï¼Œå¦‚æœæ²¡æœ‰ï¼Œç»§ç»­æ‰§è¡ŒåŸè¿›ç¨‹ï¼Œä¸äº§ç”Ÿä»»ä½•ç»“æœã€‚ï¼ˆä¸ä¿¡å·é‡çš„signalä¸åŒï¼Œæ²¡æœ‰s=s+1çš„æ“ä½œï¼‰</li></ol><h1 id="3-2-è¿›ç¨‹åŒæ­¥çš„ç»å…¸é—®é¢˜"><a href="#3-2-è¿›ç¨‹åŒæ­¥çš„ç»å…¸é—®é¢˜" class="headerlink" title="3.2 è¿›ç¨‹åŒæ­¥çš„ç»å…¸é—®é¢˜"></a>3.2 è¿›ç¨‹åŒæ­¥çš„ç»å…¸é—®é¢˜</h1><h2 id="3-2-1-ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜"><a href="#3-2-1-ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜" class="headerlink" title="3.2.1 ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜"></a>3.2.1 ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜</h2><h3 id="1-é—®é¢˜æè¿°"><a href="#1-é—®é¢˜æè¿°" class="headerlink" title="1. é—®é¢˜æè¿°"></a>1. é—®é¢˜æè¿°</h3><p>æœ‰ä¸€ç¾¤ç”Ÿäº§è€…è¿›ç¨‹åœ¨ç”Ÿäº§äº§å“ï¼Œå¹¶å°†è¿™äº›äº§å“æä¾›ç»™æ¶ˆè´¹è€…è¿›ç¨‹å»æ¶ˆè´¹ã€‚ä¸ºä½¿ç”Ÿäº§è€…è¿›ç¨‹ä¸æ¶ˆè´¹è€…è¿›ç¨‹èƒ½å¹¶å‘æ‰§è¡Œï¼Œåœ¨ä¸¤è€…ä¹‹é—´è®¾ç½®äº†ä¸€ä¸ªå¤§å°ä¸ºnçš„ç¼“å†²åŒºï¼Œç”Ÿäº§è€…è¿›ç¨‹å°†å…¶æ‰€äº§ç”Ÿçš„äº§å“æ”¾å…¥ç¼“å†²åŒºä¸­ï¼›æ¶ˆè´¹è€…å¯ä»ç¼“å†²åŒºä¸­å–èµ°äº§å“å»æ¶ˆè´¹ã€‚ä»–ä»¬ä¹‹é—´å¿…é¡»ä¿æŒåŒæ­¥ï¼Œä¹Ÿå°±æ˜¯æ—¢ä¸å…è®¸æ¶ˆè´¹è€…è¿›ç¨‹åˆ°ä¸€ä¸ªç©ºç¼“å†²åŒºå»å–äº§å“ï¼Œä¹Ÿä¸å…è®¸ç”Ÿäº§è€…è¿›ç¨‹å‘ä¸€ä¸ªå·²è£…æ»¡äº§å“ä¸”å°šæœªè¢«å–èµ°çš„ç¼“å†²åŒºä¸­æŠ•æ”¾äº§å“ã€‚<br><img src="https://cdn.littlecorgi.top/mweb/2019-07-31/ProducerConsumerProblem.jpg" alt="ProducerConsumerProble"></p><h3 id="2-é—®é¢˜åˆ†æ"><a href="#2-é—®é¢˜åˆ†æ" class="headerlink" title="2. é—®é¢˜åˆ†æ"></a>2. é—®é¢˜åˆ†æ</h3><p>éœ€è¦æ³¨æ„çš„å‡ ç‚¹ï¼š</p><ul><li>åœ¨ç¼“å†²åŒºä¸ºç©ºæ—¶ï¼Œæ¶ˆè´¹è€…ä¸èƒ½å†è¿›è¡Œæ¶ˆè´¹</li><li>åœ¨ç¼“å†²åŒºå·²æ»¡æ—¶ï¼Œç”Ÿäº§è€…ä¸èƒ½å†è¿›è¡Œç”Ÿäº§</li><li>å½“ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œç”Ÿäº§æˆ–æ¶ˆè´¹æ—¶ï¼Œå…¶ä½™çº¿ç¨‹ä¸èƒ½å†è¿›è¡Œç”Ÿäº§æˆ–æ¶ˆè´¹</li></ul><h3 id="3-ä¼ªä»£ç "><a href="#3-ä¼ªä»£ç " class="headerlink" title="3. ä¼ªä»£ç "></a>3. ä¼ªä»£ç </h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">var items = <span class="number">0</span>, space = <span class="number">10</span>, mutex = <span class="number">1</span>;</span><br><span class="line">var in = <span class="number">0</span>, out = <span class="number">0</span>;</span><br><span class="line">item buf[<span class="number">10</span>] = &#123; <span class="literal">NULL</span> &#125;;</span><br><span class="line"></span><br><span class="line">producer &#123;</span><br><span class="line">    <span class="keyword">while</span>( <span class="literal">true</span> ) &#123;</span><br><span class="line">        wait( space );  <span class="comment">// ç­‰å¾…ç¼“å†²åŒºæœ‰ç©ºé—²ä½ç½®ï¼Œ åœ¨ä½¿ç”¨PVæ“ä½œæ—¶ï¼Œæ¡ä»¶å˜é‡éœ€è¦åœ¨äº’æ–¥é”ä¹‹å‰</span></span><br><span class="line">        wait( mutex );  <span class="comment">// ä¿è¯åœ¨productæ—¶ä¸ä¼šæœ‰å…¶ä»–çº¿ç¨‹è®¿é—®ç¼“å†²åŒº</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// product</span></span><br><span class="line">        buf.push( item, in );  <span class="comment">// å°†æ–°èµ„æºæ”¾åˆ°buf[in]ä½ç½® </span></span><br><span class="line">        in = ( in + <span class="number">1</span> ) % <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">        signal( mutex );  <span class="comment">// å”¤é†’çš„é¡ºåºå¯ä»¥ä¸åŒ</span></span><br><span class="line">        signal( items );  <span class="comment">// é€šçŸ¥consumerç¼“å†²åŒºæœ‰èµ„æºå¯ä»¥å–èµ°</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">consumer &#123;</span><br><span class="line">    <span class="keyword">while</span>( <span class="literal">true</span> ) &#123;</span><br><span class="line">        wait( items );  <span class="comment">// ç­‰å¾…ç¼“å†²åŒºæœ‰èµ„æºå¯ä»¥ä½¿ç”¨</span></span><br><span class="line">        wait( mutex );  <span class="comment">// ä¿è¯åœ¨consumeæ—¶ä¸ä¼šæœ‰å…¶ä»–çº¿ç¨‹è®¿é—®ç¼“å†²åŒº</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// consume</span></span><br><span class="line">        buf.pop( out );  <span class="comment">// å°†buf[out]ä½ç½®çš„çš„èµ„æºå–èµ°</span></span><br><span class="line">        out = ( out + <span class="number">1</span> ) % <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">        signal( mutex );  <span class="comment">// å”¤é†’çš„é¡ºåºå¯ä»¥ä¸åŒ</span></span><br><span class="line">        signal( space );  <span class="comment">// é€šçŸ¥ç¼“å†²åŒºæœ‰ç©ºé—²ä½ç½®</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸èƒ½å°†çº¿ç¨‹é‡Œä¸¤ä¸ª<code>wait</code>çš„é¡ºåºè°ƒæ¢å¦åˆ™ä¼šå‡ºç°æ­»é”ã€‚ä¾‹å¦‚(è°ƒæ¢å)ï¼Œå°†<code>consumer</code>çš„ä¸¤ä¸ª<code>wait</code>è°ƒæ¢ï¼Œåœ¨<code>producer</code>å‘å‡º<code>signal</code>ä¿¡å·åï¼Œå¦‚æœ<code>producer</code>çº¿ç¨‹æ­¤æ—¶å†æ¬¡è·å¾—è¿è¡Œæœºä¼šï¼Œæ‰§è¡Œå®Œäº†<code>wait(space)</code>ï¼Œæ­¤æ—¶ï¼Œå¦ä¸€ä¸ª<code>consumer</code>çº¿ç¨‹è·å¾—è¿è¡Œæœºä¼šï¼Œæ‰§è¡Œäº†<code>wait(mutex)</code>ï¼Œå¦‚æœæ­¤æ—¶ç¼“å†²åŒºä¸ºç©ºï¼Œé‚£ä¹ˆ<code>consumer</code>å°†ä¼šé˜»å¡åœ¨<code>wait(items)</code>ï¼Œè€Œ<code>producer</code>ä¹Ÿä¼šå› ä¸ºæ— æ³•è·å¾—é”çš„æ‰€æœ‰æƒæ‰€ä»¥é˜»å¡åœ¨<code>wait(mutex)</code>ï¼Œè¿™æ ·ä¸¤ä¸ªçº¿ç¨‹éƒ½åœ¨é˜»å¡ï¼Œä¹Ÿå°±é€ æˆäº†æ­»é”ã€‚</p><h2 id="3-2-2-å“²å­¦å®¶è¿›é¤é—®é¢˜"><a href="#3-2-2-å“²å­¦å®¶è¿›é¤é—®é¢˜" class="headerlink" title="3.2.2 å“²å­¦å®¶è¿›é¤é—®é¢˜"></a>3.2.2 å“²å­¦å®¶è¿›é¤é—®é¢˜</h2><h3 id="1-é—®é¢˜æè¿°-1"><a href="#1-é—®é¢˜æè¿°-1" class="headerlink" title="1. é—®é¢˜æè¿°"></a>1. é—®é¢˜æè¿°</h3><p>æœ‰äº”ä½å“²å­¦å®¶å…±ç”¨ä¸€å¼ åœ†æ¡Œï¼Œåˆ†åˆ«ååœ¨å‘¨å›´çš„äº”å¼ æ¤…å­ä¸Šï¼Œåœ¨åœ†æ¡Œä¸Šæœ‰äº”ä¸ªç¢—å’Œäº”æ”¯ç­·å­ã€‚ä»–ä»¬çš„ç”Ÿæ´»çš„æ–¹å¼æ˜¯äº¤æ›¿çš„è¿›è¡Œæ€è€ƒå’Œè¿›é¤ï¼šå¹³æ—¶ï¼Œä¸€ä¸ªå“²å­¦å®¶è¿›è¡Œæ€è€ƒï¼Œé¥¥é¥¿æ—¶ä¾¿è§†å›¾å–å…¶å·¦å³ç¦»ä»–æœ€è¿‘çš„ç­·å­ï¼Œåªæœ‰åœ¨ä»–æ‹¿åˆ°ä¸¤åªç­·å­æ—¶æ‰èƒ½è¿›é¤ï¼Œè¿›é¤å®Œæ¯•ï¼Œæ”¾ä¸‹ç­·å­ç»§ç»­æ€è€ƒã€‚</p><h3 id="2-é—®é¢˜åˆ†æ-1"><a href="#2-é—®é¢˜åˆ†æ-1" class="headerlink" title="2. é—®é¢˜åˆ†æ"></a>2. é—®é¢˜åˆ†æ</h3><ul><li>åªæœ‰æ‹¿åˆ°ä¸¤åªç­·å­æ—¶ï¼Œå“²å­¦å®¶æ‰èƒ½åƒé¥­ã€‚</li><li>å¦‚æœç­·å­å·²è¢«åˆ«äººæ‹¿èµ°ï¼Œåˆ™å¿…é¡»ç­‰åˆ«äººåƒå®Œä¹‹åæ‰èƒ½æ‹¿åˆ°ç­·å­ã€‚</li><li>ä»»ä¸€å“²å­¦å®¶åœ¨è‡ªå·±æœªæ‹¿åˆ°ä¸¤åªç­·å­åƒå®Œé¥­å‰ï¼Œä¸ä¼šæ”¾ä¸‹æ‰‹ä¸­å·²ç»æ‹¿åˆ°çš„ç­·å­</li></ul><h3 id="3-ä¼ªä»£ç -1"><a href="#3-ä¼ªä»£ç -1" class="headerlink" title="3. ä¼ªä»£ç "></a>3. ä¼ªä»£ç </h3><p>è‡³å¤šåªå…è®¸å››ä¸ªå“²å­¦å®¶åŒæ—¶è¿›é¤ï¼Œä»¥ä¿è¯è‡³å°‘æœ‰ä¸€ä¸ªå“²å­¦å®¶èƒ½å¤Ÿè¿›é¤ï¼Œæœ€ç»ˆæ€»ä¼šé‡Šæ”¾å‡ºä»–æ‰€ä½¿ç”¨è¿‡çš„ä¸¤æ”¯ç­·å­ï¼Œä»è€Œå¯ä½¿æ›´å¤šçš„å“²å­¦å®¶è¿›é¤ã€‚å®šä¹‰ä¿¡å·é‡countï¼Œåªå…è®¸4ä¸ªå“²å­¦å®¶åŒæ—¶è¿›é¤ï¼Œè¿™æ ·å°±èƒ½ä¿è¯è‡³å°‘æœ‰ä¸€ä¸ªå“²å­¦å®¶å¯ä»¥å°±é¤ã€‚<br> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">semaphore chopstick[<span class="number">5</span>]=&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>&#125;;</span><br><span class="line">semaphore count=<span class="number">4</span>; <span class="comment">// è®¾ç½®ä¸€ä¸ªcountï¼Œæœ€å¤šæœ‰å››ä¸ªå“²å­¦å®¶å¯ä»¥è¿›æ¥</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">philosopher</span><span class="params">(<span class="type">int</span> i)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line">think();</span><br><span class="line">wait(count); <span class="comment">//è¯·æ±‚è¿›å…¥æˆ¿é—´è¿›é¤ å½“countä¸º0æ—¶ ä¸èƒ½å…è®¸å“²å­¦å®¶å†è¿›æ¥äº†</span></span><br><span class="line">wait(chopstick[i]); <span class="comment">//è¯·æ±‚å·¦æ‰‹è¾¹çš„ç­·å­</span></span><br><span class="line">wait(chopstick[(i+<span class="number">1</span>)%<span class="number">5</span>]); <span class="comment">//è¯·æ±‚å³æ‰‹è¾¹çš„ç­·å­</span></span><br><span class="line">eat();</span><br><span class="line">signal(chopstick[i]); <span class="comment">//é‡Šæ”¾å·¦æ‰‹è¾¹çš„ç­·å­</span></span><br><span class="line">signal(chopstick[(i+<span class="number">1</span>)%<span class="number">5</span>]); <span class="comment">//é‡Šæ”¾å³æ‰‹è¾¹çš„ç­·å­</span></span><br><span class="line">signal(count); <span class="comment">//ç¦»å¼€é¥­æ¡Œé‡Šæ”¾ä¿¡å·é‡</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="3-2-3-è¯»è€…-å†™è€…é—®é¢˜"><a href="#3-2-3-è¯»è€…-å†™è€…é—®é¢˜" class="headerlink" title="3.2.3 è¯»è€…-å†™è€…é—®é¢˜"></a>3.2.3 è¯»è€…-å†™è€…é—®é¢˜</h2><h3 id="1-é—®é¢˜æè¿°-2"><a href="#1-é—®é¢˜æè¿°-2" class="headerlink" title="1. é—®é¢˜æè¿°"></a>1. é—®é¢˜æè¿°</h3><p>ä¸€ä¸ªæ•°æ®æ–‡ä»¶æˆ–è®°å½•å¯è¢«å¤šä¸ªè¿›ç¨‹å…±äº«ï¼Œæˆ‘ä»¬æŠŠåªè¦æ±‚è¯»è¯¥æ–‡ä»¶çš„è¿›ç¨‹ç§°ä¸ºâ€œReaderè¿›ç¨‹â€ï¼Œå…¶å®ƒè¿›ç¨‹åˆ™ç§°ä¸ºâ€œWriterè¿›ç¨‹â€ã€‚å…è®¸å¤šä¸ªè¿›ç¨‹åŒæ—¶è¯»ä¸€ä¸ªå…±äº«å¯¹è±¡ï¼Œå› ä¸ºè¯»æ“ä½œä¸ä¼šä½¿æ•°æ®æ–‡ä»¶æ··ä¹±ã€‚ä½†ä¸å…è®¸ä¸€ä¸ªWriterè¿›ç¨‹å’Œå…¶å®ƒReaderè¿›ç¨‹æˆ–Writerè¿›ç¨‹åŒæ—¶è®¿é—®å…±äº«å¯¹è±¡ï¼Œè¿™æ ·å¾ˆæœ‰å¯èƒ½é€ æˆå…±äº«æ•°æ®æ··ä¹±ã€‚</p><h3 id="2-é—®é¢˜åˆ†æ-2"><a href="#2-é—®é¢˜åˆ†æ-2" class="headerlink" title="2. é—®é¢˜åˆ†æ"></a>2. é—®é¢˜åˆ†æ</h3><ul><li>å…è®¸å¤šä¸ªReaderè¿›ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ªå…±äº«å¯¹è±¡</li><li>ä¸å…è®¸Writerè¿›ç¨‹å’Œå…¶å®ƒè¿›ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ªå…±äº«å¯¹è±¡</li></ul><h3 id="3-ä¼ªä»£ç -2"><a href="#3-ä¼ªä»£ç -2" class="headerlink" title="3. ä¼ªä»£ç "></a>3. ä¼ªä»£ç </h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">semaphore rmutex = <span class="number">1</span>,wmutex = <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> readcount = <span class="number">0</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">reader</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="keyword">do</span>&#123;</span><br><span class="line">wait(rmutex);</span><br><span class="line"><span class="keyword">if</span>(readcount==<span class="number">0</span>) wait(wmutex);</span><br><span class="line">readcount++;</span><br><span class="line">signal(rmutex);</span><br><span class="line">Â·Â·Â·</span><br><span class="line">perform read operation;</span><br><span class="line">Â·Â·Â·</span><br><span class="line">waitï¼ˆrmutexï¼‰ï¼›</span><br><span class="line"><span class="keyword">if</span>(readcount==<span class="number">0</span>) signal(wmutex);</span><br><span class="line">readcount--;</span><br><span class="line">signal(rmutex);</span><br><span class="line">&#125;<span class="keyword">while</span>(TRUE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">writer</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="keyword">do</span>&#123;</span><br><span class="line">wait(wmutex);</span><br><span class="line">perfrom write operation;</span><br><span class="line">signal(wmutex); </span><br><span class="line">&#125;<span class="keyword">while</span>(TRUE);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ</category>
      
      
      <comments>https://www.littlecorgi.top/posts/362e394f.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Androidç½‘ç»œè¯·æ±‚3--è§£æOkHttpæºç </title>
      <link>https://www.littlecorgi.top/posts/151ac78a.html</link>
      <guid>https://www.littlecorgi.top/posts/151ac78a.html</guid>
      <pubDate>Fri, 26 Jul 2019 09:11:17 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;1-OkHttpç®€ä»‹&quot;&gt;&lt;a href=&quot;#1-OkHttpç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;1. OkHttpç®€ä»‹&quot;&gt;&lt;/a&gt;1. OkHttpç®€ä»‹&lt;/h1&gt;&lt;p&gt;&lt;code&gt;okhttp&lt;/code&gt;æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹ç±»åº“ï¼Œç”¨äºandroidä¸­è¯·æ±‚ç½‘ç»œã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®,æ˜¯å®‰å“ç«¯æœ€ç«çƒ­çš„è½»é‡çº§æ¡†æ¶,ç”±ç§»åŠ¨æ”¯ä»˜Squareå…¬å¸è´¡çŒ®ã€‚ç”¨äºæ›¿ä»£å› ç§»é™¤äº†&lt;code&gt;HttpClient&lt;/code&gt;è€Œå¯¼è‡´æ²¡ç”¨çš„&lt;code&gt;Volley&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰æ›´å¤šäººé€‰æ‹©äº†&lt;code&gt;Retrofit&lt;/code&gt;ã€‚&lt;br&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="1-OkHttpç®€ä»‹"><a href="#1-OkHttpç®€ä»‹" class="headerlink" title="1. OkHttpç®€ä»‹"></a>1. OkHttpç®€ä»‹</h1><p><code>okhttp</code>æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹ç±»åº“ï¼Œç”¨äºandroidä¸­è¯·æ±‚ç½‘ç»œã€‚</p><p>è¿™æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®,æ˜¯å®‰å“ç«¯æœ€ç«çƒ­çš„è½»é‡çº§æ¡†æ¶,ç”±ç§»åŠ¨æ”¯ä»˜Squareå…¬å¸è´¡çŒ®ã€‚ç”¨äºæ›¿ä»£å› ç§»é™¤äº†<code>HttpClient</code>è€Œå¯¼è‡´æ²¡ç”¨çš„<code>Volley</code>ã€‚</p><p>ç›®å‰æ›´å¤šäººé€‰æ‹©äº†<code>Retrofit</code>ã€‚<br><span id="more"></span></p><h1 id="2-æºç è§£æ"><a href="#2-æºç è§£æ" class="headerlink" title="2. æºç è§£æ"></a>2. æºç è§£æ</h1><blockquote><p>æœ¬æ–‡å¯¹OkHttpçš„æ¢è®¨å…¨éƒ¨åŸºäºç›®å‰çš„æœ€æ–°ç‰ˆOkHttp:4.0.1ï¼Œè€Œè¿™ä¸ªç‰ˆæœ¬ä½œè€…å·²ç»ä½¿ç”¨kotlinå¯¹æºç è¿›è¡Œäº†é‡å†™ï¼Œæ‰€ä»¥æœ‰äº›å°ä¼™ä¼´å¯èƒ½é˜…è¯»ç¨å¾®æœ‰ç‚¹é—®é¢˜ï¼Œä½†æ˜¯åˆ«æ‹…å¿ƒï¼Œæœ¬æ–‡ä¸­æ‰€æ¶‰åŠçš„æºç é˜…è¯»èµ·æ¥åŸºæœ¬ä¸Šå’ŒJavaä¸€æ ·ï¼Œæ‰€ä»¥è¯·ä¸ä¼škotlinçš„å°ä¼™ä¼´è¿˜æ˜¯è€å¿ƒçœ‹ä¸‹å»ï¼Œä¸å¤ªæ‡‚çš„è¯­æ³•å°±ç™¾åº¦ä¸‹ï¼ŒåŒæ—¶æˆ‘ä¹Ÿä¼šå¯¹æŸäº›è¯­æ³•ä½œæ³¨é‡Š</p></blockquote><h2 id="2-1-OkHttpè¯·æ±‚æµç¨‹"><a href="#2-1-OkHttpè¯·æ±‚æµç¨‹" class="headerlink" title="2.1 OkHttpè¯·æ±‚æµç¨‹"></a>2.1 OkHttpè¯·æ±‚æµç¨‹</h2><h3 id="2-1-1-ä»è¯·æ±‚å¤„ç†å¼€å§‹åˆ†æ"><a href="#2-1-1-ä»è¯·æ±‚å¤„ç†å¼€å§‹åˆ†æ" class="headerlink" title="2.1.1 ä»è¯·æ±‚å¤„ç†å¼€å§‹åˆ†æ"></a>2.1.1 ä»è¯·æ±‚å¤„ç†å¼€å§‹åˆ†æ</h3><p>æˆ‘ä»¬æ— è®ºåœ¨ä½¿ç”¨<code>OkHttp</code>è¿›è¡Œä»€ä¹ˆè¯·æ±‚çš„æ—¶å€™éƒ½ä¼šåˆ›å»º<code>OkHttpClient</code>å¯¹è±¡å¹¶è°ƒç”¨ä»–çš„<code>newCall()</code>æ–¹æ³•ï¼Œé‚£æˆ‘ä»¬å°±ä»è¿™ä¸ªæ–¹æ³•çœ‹èµ·ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">newCall</span><span class="params">(request: <span class="type">Request</span>)</span></span>: Call &#123;</span><br><span class="line"><span class="keyword">return</span> RealCall.newRealCall(<span class="keyword">this</span>, request, forWebSocket = <span class="literal">false</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿”å›äº†ä¸€ä¸ª<code>RealCall</code>å¯¹è±¡ï¼Œæ‰€ä»¥ä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬ä½¿ç”¨<code>OkHttpClient</code>å¯¹è±¡è°ƒç”¨çš„<code>execute()</code>æ“ä½œå®é™…ä¸Šæ˜¯<code>RealCall</code>çš„<code>execute()</code>æ“ä½œï¼Œé‚£æˆ‘ä»¬å°±æ¥çœ‹<code>RealCall</code>çš„<code>execute()</code>æ–¹æ³•ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">execute</span><span class="params">()</span></span>: Response &#123;</span><br><span class="line">    <span class="comment">// æ·»åŠ åŒæ­¥é”</span></span><br><span class="line">    synchronized(<span class="keyword">this</span>) &#123;</span><br><span class="line">        <span class="comment">// check()æ˜¯kotlinç‰¹æœ‰çš„ä¸€ä¸ªæ–¹æ³•ï¼Œä»–æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªifï¼Œ</span></span><br><span class="line">        <span class="comment">// ä½†æ˜¯å½“ä»–çš„åˆ¤æ–­è¯­å¥æ˜¯falseçš„è¯ï¼Œ</span></span><br><span class="line">        <span class="comment">// ä»–å°±ä¼šæŠ›å‡ºä¸€ä¸ªIllegalStateExceptionå¼‚å¸¸ï¼Œå¼‚å¸¸çš„å†…å®¹å°±æ˜¯åé¢çš„è¯­å¥</span></span><br><span class="line">        check(!executed) &#123; <span class="string">&quot;Already Executed&quot;</span> &#125;</span><br><span class="line">        executed = <span class="literal">true</span></span><br><span class="line">        <span class="comment">// executedæ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œä»–çš„ä½œç”¨å°±æ˜¯åˆ¤æ–­æ˜¯ä¸æ˜¯æ‰§è¡Œè¿‡äº†ï¼Œ</span></span><br><span class="line">        <span class="comment">// å¦‚æœæ‰§è¡Œè¿‡äº†è¿˜æ‰§è¡Œäº†è¿™ä¸ªæ–¹æ³•çš„è¯å°±æŠ›å¼‚å¸¸</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// transmitterç”¨äºè¿æ¥OKHTTPçš„åº”ç”¨ç¨‹åºå’Œç½‘ç»œå±‚ï¼Œä¸ç”¨å¤šç®¡</span></span><br><span class="line">    transmitter.timeoutEnter()</span><br><span class="line">    transmitter.callStart()</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        client.dispatcher.executed(<span class="keyword">this</span>)</span><br><span class="line">        <span class="keyword">return</span> getResponseWithInterceptorChain()</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        client.dispatcher.finished(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¿™å—åˆè°ƒç”¨äº†<code>client.dispatcher</code>ï¼Œç„¶åæ‰¾å›å»æ‰¾åˆ°<code>OkHttpClient</code>çš„<code>dispatcher</code>å¯¹è±¡ï¼Œå‘ç°ä»–å°±æ˜¯<code>Dispatcher</code>ç±»çš„ä¸€ä¸ªå¯¹è±¡ï¼Œæ¥ç€æˆ‘ä»¬ç»§ç»­çœ‹<code>Dispatcher</code>ç±»ã€‚</p><h3 id="2-1-2-Dispatcherä»»åŠ¡è°ƒåº¦"><a href="#2-1-2-Dispatcherä»»åŠ¡è°ƒåº¦" class="headerlink" title="2.1.2 Dispatcherä»»åŠ¡è°ƒåº¦"></a>2.1.2 Dispatcherä»»åŠ¡è°ƒåº¦</h3><p>è¿›å…¥<code>Dispatcher</code>ç±»ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æˆå‘˜å˜é‡å®šä¹‰:</p><blockquote><p>æ³¨ï¼škotlinä¸­ä¸€ä¸ªæˆå‘˜å˜é‡çš„@getå’Œ@setåˆ†åˆ«å¯¹åº”äº†Javaä¸­getå’Œsetæ–¹æ³•ï¼Œæ‰€ä»¥è¿™å—æˆ‘æ²¡æœ‰å®Œå®Œå…¨å…¨å¤åˆ¶ç²˜è´´åˆ°è¿™ï¼Œæˆ‘åªå–äº†å®šä¹‰éƒ¨åˆ†</p></blockquote><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœ€å¤§å¹¶å‘è¯·æ±‚æ•°</span></span><br><span class="line"><span class="keyword">var</span> maxRequests = <span class="number">64</span></span><br><span class="line"><span class="comment">// æ¯ä¸ªä¸»æœºçš„æœ€å¤§è¯·æ±‚æ•°</span></span><br><span class="line"><span class="keyword">var</span> maxRequestsPerHost = <span class="number">5</span></span><br><span class="line"><span class="comment">// æ¶ˆè´¹è€…çº¿ç¨‹</span></span><br><span class="line"><span class="keyword">val</span> executorService: ExecutorService</span><br><span class="line"><span class="comment">// å°†è¦è¿è¡Œçš„å¼‚æ­¥è¯·æ±‚é˜Ÿåˆ—</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> readyAsyncCalls = ArrayDeque&lt;AsyncCall&gt;()</span><br><span class="line"><span class="comment">// æ­£åœ¨è¿è¡Œçš„å¼‚æ­¥è¯·æ±‚é˜Ÿé˜Ÿåˆ—</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> runningAsyncCalls = ArrayDeque&lt;AsyncCall&gt;()</span><br><span class="line"><span class="comment">// æ­£åœ¨è¿è¡Œçš„åŒæ­¥è¯·æ±‚é˜Ÿåˆ—</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> runningSyncCalls = ArrayDeque&lt;RealCall&gt;()</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹<code>Dispatcher</code>çš„æ„é€ æ–¹æ³•<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸»æ„é€ æ–¹æ³•ï¼Œæ²¡å†™å…·ä½“å®ç°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dispatcher</span> <span class="keyword">constructor</span>() &#123;&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">constructor</span>(executorService: ExecutorService) : <span class="keyword">this</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.executorServiceOrNull = executorService</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»–å°†ä¼ è¿›æ¥çš„<code>executorService</code>ä¼ ç»™äº†<code>executorServiceOrNull</code>ï¼Œé‚£æˆ‘ä»¬æ¥çœ‹çœ‹<code>executorServiceOrNull</code>çš„å®šä¹‰ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// executorServiceOrNullè¿™ä¸ªåº”è¯¥æ˜¯å› ä¸ºkotlinçš„ç©ºå®‰å…¨æ£€æŸ¥ç‰¹æ€§è€Œå®šä¹‰çš„ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯executorService</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> executorServiceOrNull: ExecutorService? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@get:Synchronized</span></span><br><span class="line"><span class="meta">@get:JvmName</span>(<span class="string">&quot;executorService&quot;</span>) <span class="keyword">val</span> executorService: ExecutorService</span><br><span class="line">    <span class="keyword">get</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> (executorServiceOrNull == <span class="literal">null</span>) &#123;</span><br><span class="line">            executorServiceOrNull = ThreadPoolExecutor(<span class="number">0</span>, <span class="built_in">Int</span>.MAX_VALUE, <span class="number">60</span>, TimeUnit.SECONDS,</span><br><span class="line">                SynchronousQueue(), threadFactory(<span class="string">&quot;OkHttp Dispatcher&quot;</span>, <span class="literal">false</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> executorServiceOrNull!!</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><br>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>executorService</code>çš„<code>set</code>æ–¹æ³•ï¼Œå°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹æ± ã€‚å†ç»“åˆä»–æœ‰ä¸¤ä¸ªæ„é€ å™¨å°±çŸ¥é“ï¼šå¦‚æœæ²¡æœ‰ç»™<code>Dispatcher</code>ä¼ å…¥ä¸€ä¸ªçº¿ç¨‹æ± ä»–å°±ä¼šè‡ªå·±åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ã€‚è¿™ä¸ªçº¿ç¨‹æ± é€‚åˆæ‰§è¡Œå¤§é‡ä¸”è€—æ—¶è¾ƒå°‘çš„ä»»åŠ¡ã€‚</p><p>æ„é€ å™¨æˆ‘ä»¬çœ‹å®Œäº†ï¼Œæˆ‘ä»¬å°±æ¥çœ‹ä»–çš„<code>enqueue()</code>æ–¹æ³•ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> <span class="title">enqueue</span><span class="params">(call: <span class="type">AsyncCall</span>)</span></span> &#123;</span><br><span class="line">    synchronized(<span class="keyword">this</span>) &#123;</span><br><span class="line">        readyAsyncCalls.add(call)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Mutate the AsyncCall so that it shares the AtomicInteger of an existing running call to</span></span><br><span class="line">        <span class="comment">// the same host.</span></span><br><span class="line">        <span class="keyword">if</span> (!call.<span class="keyword">get</span>().forWebSocket) &#123;</span><br><span class="line">            <span class="keyword">val</span> existingCall = findExistingCallWithHost(call.host())</span><br><span class="line">            <span class="keyword">if</span> (existingCall != <span class="literal">null</span>)call.reuseCallsPerHostFrom(existingCall)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    promoteAndExecute()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æ¥ä¸€ä¸ªè¯·æ±‚å°±æŠŠä»–æ·»åŠ åˆ°å°±ç»ªè¯·æ±‚é˜Ÿåˆ—ä¸­å»ï¼Œç„¶åå°±æ¥åˆ¤æ–­<code>forWebSocket</code>è¿™ä¸ªå±æ€§ã€‚çœ‹åˆ°è¿™ä¸ªå±æ€§æˆ‘è¿˜è¿·äº†ä¸‹ï¼Œæœ‰ç‚¹æä¸æ‡‚å¥¹æ˜¯å¹²å˜›çš„ï¼Œç„¶åç»è¿‡æˆ‘çš„ä¸€ç•ªæœç´¢åï¼Œå‘ç°åŸæ¥<code>OkHttp</code>è¿˜å¯ä»¥è¿›è¡Œ<code>WebSocket</code>é€šä¿¡ï¼Œè€Œè¿™ä¸ªå±æ€§å°±æ˜¯ä¸º<code>WebSocket</code>é€šä¿¡å‡†å¤‡çš„ã€‚äºæ˜¯æˆ‘å°±åˆ°<code>RealCall</code>é‡Œé¢æ‰¾åœ¨å“ªå„¿å®šä¹‰äº†è¿™ä¸ªå±æ€§äº†ï¼Œç„¶åæˆ‘å°±å‘ç°äº†åœ¨<code>RealCall</code>çš„<code>newRealCall()</code>æ–¹æ³•è¿™å—ï¼Œè¿™ä¸ªæ–¹æ³•ä¼ å…¥çš„å‚æ•°ä¸­æœ‰ä¸€ä¸ª<code>Boolean</code>å€¼åå­—å°±å«<code>forWebSocket</code>ã€‚<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">newRealCall</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        client: <span class="type">OkHttpClient</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        originalRequest: <span class="type">Request</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        forWebSocket: <span class="type">Boolean</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>: RealCall &#123;</span><br><span class="line">        <span class="comment">// Safely publish the Call instance to the EventListener.</span></span><br><span class="line">        <span class="keyword">return</span> RealCall(client, originalRequest, forWebSocket).apply &#123;</span><br><span class="line">            transmitter = Transmitter(client, <span class="keyword">this</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰å°è±¡ï¼Œå’±ä»¬åœ¨ä¸Šé¢è¯´è¿‡ï¼Œæ‰§è¡Œ<code>OkHttpClient.newCall()</code>æ–¹æ³•å®é™…ä¸Šæ˜¯è¿”å›äº†ä¸€ä¸ª<code>RealCall</code>å¯¹è±¡ï¼Œäºæ˜¯åœ¨é‚£æ‰¾åˆ°äº†è¿™ä¸ªçš„ç­”æ¡ˆï¼Œ<code>forWebSocket=false</code><br>æ‰€ä»¥è¯´è¿™ä¸ª<code>if</code>å’±ä»¬ä¸ç”¨ç®¡ï¼Œç›´æ¥çœ‹<code>promoteAndExecute()</code>æ–¹æ³•ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">promoteAndExecute</span><span class="params">()</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">    <span class="comment">// ä¸çŸ¥é“å¤§å®¶è¿˜è®°ä¸è®°å¾—å’±ä»¬ä¹‹å‰è¯´çš„kotliné‡Œé¢çš„check()è¯­æ³•ï¼Œ</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ªå’Œcheckä¹Ÿä¸€æ ·ï¼Œåªä¸è¿‡æŠ›å‡ºçš„æ˜¯AssertionErrorå¼‚å¸¸</span></span><br><span class="line">    assert(!Thread.holdsLock(<span class="keyword">this</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// mutableListOfæ˜¯kotliné‡Œé¢çš„å¯å˜listé›†åˆ</span></span><br><span class="line">    <span class="keyword">val</span> executableCalls = mutableListOf&lt;AsyncCall&gt;()</span><br><span class="line">    <span class="keyword">val</span> isRunning: <span class="built_in">Boolean</span></span><br><span class="line">    synchronized(<span class="keyword">this</span>) &#123;</span><br><span class="line">        <span class="keyword">val</span> i = readyAsyncCalls.iterator()</span><br><span class="line">            <span class="keyword">while</span> (i.hasNext()) &#123;</span><br><span class="line">                <span class="keyword">val</span> asyncCall = i.next()</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (runningAsyncCalls.size &gt;= <span class="keyword">this</span>.maxRequests) <span class="keyword">break</span> <span class="comment">// æœ€å¤§å®¹é‡</span></span><br><span class="line">                <span class="keyword">if</span> (asyncCall.callsPerHost().<span class="keyword">get</span>() &gt;= <span class="keyword">this</span>.maxRequestsPerHost) <span class="keyword">continue</span> <span class="comment">// ä¸»æœºæœ€å¤§å®¹é‡</span></span><br><span class="line"></span><br><span class="line">                i.remove()</span><br><span class="line">                asyncCall.callsPerHost().incrementAndGet()</span><br><span class="line">                executableCalls.add(asyncCall)</span><br><span class="line">                runningAsyncCalls.add(asyncCall)</span><br><span class="line">            &#125;</span><br><span class="line">        isRunning = runningCallsCount() &gt; <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">0</span> until executableCalls.size) &#123;</span><br><span class="line">        <span class="keyword">val</span> asyncCall = executableCalls[i]</span><br><span class="line">        asyncCall.executeOn(executorService)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> isRunning</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>é¦–å…ˆå°†å·²å°±ç»ªé˜Ÿåˆ—éå†ä¸€éï¼Œåˆ¤æ–­æ­£åœ¨è¿è¡Œçš„æ•°é‡æ˜¯ä¸æ˜¯å¤§äºå®šä¹‰çš„æœ€å¤§è¯·æ±‚æ•°ï¼Œå¦‚æœå¤§äºçš„è¯ç›´æ¥é€€å‡ºå¾ªç¯ï¼›å¦‚æœä¸å¤§äºåˆ™åœ¨åˆ¤æ–­è¿™ä¸ªè¯·æ±‚çš„ä¸»æœºè¯·æ±‚æ•°æ˜¯ä¸æ˜¯å¤§äºå®šä¹‰çš„æ¯ä¸ªä¸»æœºæœ€å¤§è¯·æ±‚æ•°ï¼Œå¦‚æœå¤§äºå°±è·³è¿‡è¿™ä¸ªè¯·æ±‚æ¢ä¸‹ä¸€ä¸ªè¯·æ±‚ï¼›ä¸å¤§äºå°±æŠŠå®ƒè°ƒå…¥æ­£åœ¨è¿è¡Œçš„è¯·æ±‚é˜Ÿåˆ—é‡Œé¢ï¼Œç›´åˆ°éå†å®Œæˆã€‚ç„¶ååˆ¤æ–­è¿˜æœ‰æ²¡æœ‰æ­£åœ¨è¿è¡Œçš„è¯·æ±‚ï¼Œå¦‚æœæœ‰å°±<code>isRunning</code>ç½®<code>true</code>ã€‚æ¥ç€å†å–å‡º<code>executableCalls</code>é‡Œçš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œç„¶åæ‰§è¡Œ<code>executteOn()</code>æ–¹æ³•ã€‚æˆ‘ä»¬ç»§ç»­æ¥çœ‹<code>AsyncCall</code>çš„<code>executeOn()</code>æ–¹æ³•ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">executeOn</span><span class="params">(executorService: <span class="type">ExecutorService</span>)</span></span> &#123;</span><br><span class="line">    assert(!Thread.holdsLock(client.dispatcher))</span><br><span class="line">    <span class="keyword">var</span> success = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        executorService.execute(<span class="keyword">this</span>)</span><br><span class="line">        success = <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (e: RejectedExecutionException) &#123;</span><br><span class="line">        <span class="keyword">val</span> ioException = InterruptedIOException(<span class="string">&quot;executor rejected&quot;</span>)</span><br><span class="line">        ioException.initCause(e)</span><br><span class="line">        transmitter.noMoreExchanges(ioException)</span><br><span class="line">        responseCallback.onFailure(<span class="keyword">this</span><span class="symbol">@RealCall</span>, ioException)</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">            client.dispatcher.finished(<span class="keyword">this</span>) <span class="comment">// This call is no longer running!</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¿™æ®µä»£ç å°±æ˜¯åœ¨æ‰§è¡Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ï¼Œå¦‚æœæˆåŠŸæ‰§è¡Œå°±å°†<code>success</code>ç½®<code>true</code>ï¼Œå¦‚æœä¸æˆåŠŸï¼Œåˆ™æŠ›å¼‚å¸¸å¹¶è¿”å›ç»™<code>responseCallback</code>çš„<code>onFailure()</code>æ–¹æ³•ã€‚å¹¶ä¸”å¦‚æœæ²¡æœ‰æˆåŠŸæ‰§è¡Œä¹Ÿå°±æ˜¯<code>success</code>ä¸º<code>false</code>ï¼Œé‚£ä¹ˆåœ¨<code>finally</code>ä¸­å°±ä¼šæ‰§è¡Œ<code>client.dispatcher.finished()</code>æ–¹æ³•:<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> <span class="title">finished</span><span class="params">(call: <span class="type">AsyncCall</span>)</span></span> &#123;</span><br><span class="line">    call.callsPerHost().decrementAndGet()</span><br><span class="line">    finished(runningAsyncCalls, call)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><br>è¿™ä¸ªæ–¹æ³•å…ˆå°†ä¼ å…¥çš„<code>AsyncCall</code>çš„<code>callsPerHost</code>ç»™å‡1ï¼Œç„¶åå†è°ƒç”¨äº†<code>finished()</code>æ–¹æ³•ï¼Œæˆ‘ä»¬å†æ¥çœ‹è¿™ä¸ª<code>finished()</code>æ–¹æ³•ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> <span class="title">finished</span><span class="params">(calls: <span class="type">Deque</span>&lt;<span class="type">T</span>&gt;, call: <span class="type">T</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> idleCallback: Runnable?</span><br><span class="line">    synchronized(<span class="keyword">this</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!calls.remove(call)) <span class="keyword">throw</span> AssertionError(<span class="string">&quot;Call wasn&#x27;t in-flight!&quot;</span>)</span><br><span class="line">        idleCallback = <span class="keyword">this</span>.idleCallback</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> isRunning = promoteAndExecute()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!isRunning &amp;&amp; idleCallback != <span class="literal">null</span>) &#123;</span><br><span class="line">        idleCallback.run()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»–è®²æ­¤æ¬¡è¯·æ±‚ä»<code>runningAsyncCalls</code>ä¸­ç§»é™¤ï¼Œç„¶åæ‰§è¡Œäº†<code>promoteAndExecute()</code>æ–¹æ³•ï¼Œå’±ä»¬åœ¨ä¸Šé¢è¯´è¿‡è¿™ä¸ªæ–¹æ³•ï¼Œä»–çš„è¿”å›å€¼å°±æ˜¯åˆ¤æ–­å½“å‰è¿™ä¸ªè¿è¡Œé˜Ÿåˆ—ä¸­è¿˜æœ‰æ²¡æœ‰è¯·æ±‚ï¼Œå¦‚æœè¿˜æœ‰å°±è¿”å›<code>true</code>ï¼Œæ²¡æœ‰å°±<code>false</code>ã€‚æ¥ç€ä¸€ä¸ª<code>if</code>ï¼Œåˆ¤æ–­<code>isRunning</code>å’Œ<code>idleCallback</code>çš„ï¼Œé‚£ä¹ˆå¦‚æœå½“å‰è¿™ä¸ªè¯·æ±‚è¿˜æ²¡æœ‰æ‰§è¡Œçš„è¯ï¼Œå°±è°ƒç”¨<code>run()</code>æ–¹æ³•æ‰§è¡Œå½“å‰è¯·æ±‚ã€‚è¿™æ ·æ¯ä¸ªè¯·æ±‚éƒ½æ‰§è¡Œå®Œæ¯•äº†ã€‚<br>é‚£æˆ‘ä»¬å†æ¥çœ‹çœ‹ä»–çš„<code>run()</code>æ–¹æ³•ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">run</span><span class="params">()</span></span> &#123;</span><br><span class="line">      threadName(<span class="string">&quot;OkHttp <span class="subst">$&#123;redactedUrl()&#125;</span>&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> signalledCallback = <span class="literal">false</span></span><br><span class="line">            transmitter.timeoutEnter()</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">val</span> response = getResponseWithInterceptorChain()</span><br><span class="line">                signalledCallback = <span class="literal">true</span></span><br><span class="line">                responseCallback.onResponse(<span class="keyword">this</span><span class="symbol">@RealCall</span>, response)</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e: IOException) &#123;</span><br><span class="line">                <span class="keyword">if</span> (signalledCallback) &#123;</span><br><span class="line">                    <span class="comment">// Do not signal the callback twice!</span></span><br><span class="line">                    Platform.<span class="keyword">get</span>().log(INFO, <span class="string">&quot;Callback failure for <span class="subst">$&#123;toLoggableString()&#125;</span>&quot;</span>, e)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    responseCallback.onFailure(<span class="keyword">this</span><span class="symbol">@RealCall</span>, e)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                client.dispatcher.finished(<span class="keyword">this</span>)</span><br><span class="line">            &#125;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¿™å—è°ƒç”¨äº†ä¸€ä¸ª<code>getResponseWithInterceptorChain()</code>æ–¹æ³•ï¼Œå¹¶è¿”å›äº†<code>response</code>ï¼Œå¹¶å°†å®ƒè¿”å›ç»™äº†<code>responseCallback.onResponse()</code>æ–¹æ³•ã€‚å¦‚æœå¤±è´¥äº†å°±å°†ç»“æœè¿”å›ç»™<code>responseCallback.onFailure()</code>æ–¹æ³•ã€‚æœ€åè°ƒç”¨<code>client.dispatcher.finished()</code>æ–¹æ³•ã€‚</p><h3 id="2-1-3-Interceptoræ‹¦æˆªå™¨"><a href="#2-1-3-Interceptoræ‹¦æˆªå™¨" class="headerlink" title="2.1.3 Interceptoræ‹¦æˆªå™¨"></a>2.1.3 Interceptoræ‹¦æˆªå™¨</h3><h4 id="2-1-3-1-getResponseWithInterceptorChain-æ–¹æ³•"><a href="#2-1-3-1-getResponseWithInterceptorChain-æ–¹æ³•" class="headerlink" title="2.1.3.1 getResponseWithInterceptorChain()æ–¹æ³•"></a>2.1.3.1 getResponseWithInterceptorChain()æ–¹æ³•</h4><p>é¦–å…ˆæˆ‘ä»¬çœ‹çœ‹<code>getResponseWithInterceptorChain()</code>æ–¹æ³•ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Throws(IOException::class)</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">getResponseWithInterceptorChain</span><span class="params">()</span></span>: Response &#123;</span><br><span class="line">    <span class="comment">// Build a full stack of interceptors.</span></span><br><span class="line">    <span class="keyword">val</span> interceptors = mutableListOf&lt;Interceptor&gt;()</span><br><span class="line">    interceptors += client.interceptors</span><br><span class="line">    interceptors += RetryAndFollowUpInterceptor(client)</span><br><span class="line">    interceptors += BridgeInterceptor(client.cookieJar)</span><br><span class="line">    interceptors += CacheInterceptor(client.cache)</span><br><span class="line">    interceptors += ConnectInterceptor</span><br><span class="line">    <span class="keyword">if</span> (!forWebSocket) &#123;</span><br><span class="line">        interceptors += client.networkInterceptors</span><br><span class="line">    &#125;</span><br><span class="line">    interceptors += CallServerInterceptor(forWebSocket)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> chain = RealInterceptorChain(interceptors, transmitter, <span class="literal">null</span>, <span class="number">0</span>, originalRequest, <span class="keyword">this</span>,</span><br><span class="line">        client.connectTimeoutMillis, client.readTimeoutMillis, client.writeTimeoutMillis)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> calledNoMoreExchanges = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">val</span> response = chain.proceed(originalRequest)</span><br><span class="line">        <span class="keyword">if</span> (transmitter.isCanceled) &#123;</span><br><span class="line">            response.closeQuietly()</span><br><span class="line">            <span class="keyword">throw</span> IOException(<span class="string">&quot;Canceled&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e: IOException) &#123;</span><br><span class="line">        calledNoMoreExchanges = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">throw</span> transmitter.noMoreExchanges(e) <span class="keyword">as</span> Throwable</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!calledNoMoreExchanges) &#123;</span><br><span class="line">            transmitter.noMoreExchanges(<span class="literal">null</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>é¦–å…ˆå°±åˆ›å»ºäº†ä¸€å¤§å †çš„è¿æ¥å™¨å¹¶æ·»åŠ åˆ°<code>interceptors</code>é›†åˆä¸­ã€‚ç„¶ååˆ›å»ºäº†ä¸€ä¸ª<code>RealInterceptorChain</code>å¯¹è±¡ï¼Œå¹¶è°ƒç”¨äº†ä»–çš„<code>proceed()</code>æ–¹æ³•ï¼Œæ¥ç€ä¸»è¦ç›®çš„å°±æ˜¯è®²<code>proceed()</code>è¿”å›çš„<code>response</code>ç»™è¿”å›å»ã€‚<br>é‚£æˆ‘ä»¬å°±æ¥çœ‹çœ‹<code>RealInterceptorChain</code>çš„<code>proceed()</code>æ–¹æ³•ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">proceed</span><span class="params">(request: <span class="type">Request</span>)</span></span>: Response &#123;</span><br><span class="line">    <span class="keyword">return</span> proceed(request, transmitter, exchange)</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="meta">@Throws(IOException::class)</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">proceed</span><span class="params">(request: <span class="type">Request</span>, transmitter: <span class="type">Transmitter</span>, exchange: <span class="type">Exchange</span>?)</span></span>: Response &#123;</span><br><span class="line">    <span class="keyword">if</span> (index &gt;= interceptors.size) <span class="keyword">throw</span> AssertionError()</span><br><span class="line"></span><br><span class="line">    calls++</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If we already have a stream, confirm that the incoming request will use it.</span></span><br><span class="line">    check(<span class="keyword">this</span>.exchange == <span class="literal">null</span> || <span class="keyword">this</span>.exchange.connection()!!.supportsUrl(request.url)) &#123;</span><br><span class="line">        <span class="string">&quot;network interceptor <span class="subst">$&#123;interceptors[index - <span class="number">1</span>]&#125;</span> must retain the same host and port&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If we already have a stream, confirm that this is the only call to chain.proceed().</span></span><br><span class="line">    check(<span class="keyword">this</span>.exchange == <span class="literal">null</span> || calls &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="string">&quot;network interceptor <span class="subst">$&#123;interceptors[index - <span class="number">1</span>]&#125;</span> must call proceed() exactly once&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Call the next interceptor in the chain.</span></span><br><span class="line">    <span class="keyword">val</span> next = RealInterceptorChain(interceptors, transmitter, exchange,</span><br><span class="line">        index + <span class="number">1</span>, request, call, connectTimeout, readTimeout, writeTimeout)</span><br><span class="line">    <span class="keyword">val</span> interceptor = interceptors[index]</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Suppress(<span class="string">&quot;USELESS_ELVIS&quot;</span>)</span></span><br><span class="line">    <span class="keyword">val</span> response = interceptor.intercept(next) ?: <span class="keyword">throw</span> NullPointerException(</span><br><span class="line">        <span class="string">&quot;interceptor <span class="variable">$interceptor</span> returned null&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Confirm that the next interceptor made its required call to chain.proceed().</span></span><br><span class="line">    check(exchange == <span class="literal">null</span> || index + <span class="number">1</span> &gt;= interceptors.size || next.calls == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="string">&quot;network interceptor <span class="variable">$interceptor</span> must call proceed() exactly once&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    check(response.body != <span class="literal">null</span>) &#123; <span class="string">&quot;interceptor <span class="variable">$interceptor</span> returned a response with no body&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆå°±æ˜¯ä¸€ä¸ª<code>index</code>ï¼Œ<code>index</code>æ˜¯<code>RealInterceptorChain</code>æ„é€ å™¨ä¸­ä¼ å…¥çš„å‚æ•°ï¼Œå¥¹æ˜¯ç¬¬å››ä¸ªå‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹<code>getResponseWithInterceptorChain()</code>æ–¹æ³•ä¸­åˆ›å»º<code>RealInterceptorChain</code>å¯¹è±¡æ—¶æ„é€ å™¨çš„ç¬¬å››ä¸ªä¼ å…¥çš„å€¼ä¸º0ã€‚ç„¶ååˆ¤æ–­<code>index</code>çš„å€¼æ˜¯ä¸æ˜¯å¤§äº<code>interceptors</code>çš„å¤§å°ï¼Œå¦‚æœå¤§äºå°±æŠ›å¼‚å¸¸ï¼Œå¦åˆ™å°±ç»§ç»­ä¸€é¡¿æ£€æŸ¥ï¼ï¼ï¼ç„¶åå†åˆ›å»º<code>RealInterceptorChain</code>å¯¹è±¡ï¼Œæ­¤æ—¶åˆ›å»ºçš„å¯¹è±¡ä¼ å…¥çš„<code>index</code>ä¸ºæ­¤æ—¶çš„<code>index+1</code>ï¼Œç„¶åå†è°ƒç”¨<code>interceptor</code>çš„<code>intercept()</code>æ–¹æ³•ï¼Œå¹¶è¿”å›<code>response</code>ã€‚<br><code>interceptor</code>çš„<code>intercept()</code>ä½œç”¨æ˜¯å½“å­˜åœ¨å¤šä¸ªæ‹¦æˆªå™¨æ—¶éƒ½ä¼šåœ¨ä¸Šé¢ä»£ç æ³¨é‡Š1å¤„é˜»å¡ï¼Œå¹¶ç­‰å¾…ä¸‹ä¸€ä¸ªæ‹¦æˆªå™¨çš„è°ƒç”¨è¿”å›ã€‚</p><h4 id="2-1-3-2-Interceptoræºç "><a href="#2-1-3-2-Interceptoræºç " class="headerlink" title="2.1.3.2 Interceptoræºç "></a>2.1.3.2 Interceptoræºç </h4><p>é‚£ç°åœ¨æˆ‘ä»¬å†æ¥è®²å‡ ä¸ªé‡è¦çš„æ‹¦æˆªå™¨å§ã€‚<br><code>OkHttp</code>ä¸­<code>Interceptor</code>çš„å®ç°ç±»æœ‰ï¼š</p><ol><li><code>ConnectInterceptor</code>ï¼šè¿æ¥æ‹¦æˆªå™¨ã€‚ </li><li><code>CallServerInterceptor</code>ï¼šè¯·æ±‚æœåŠ¡å™¨æ‹¦æˆªå™¨ </li><li><code>CacheInterceptor</code>ï¼šç¼“å­˜æ‹¦æˆªå™¨ </li><li><code>BridgeInterceptor</code>ï¼šæ¡¥æ¢æ‹¦æˆªå™¨ã€‚ </li></ol><p>å…¶ä¸­è¾ƒä¸ºé‡è¦çš„å°±æ˜¯<code>ConnectInterceptor</code>å’Œ<code>CallServerInterceptor</code>ï¼Œé‚£æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸¤ä¸ªã€‚</p><h5 id="2-1-3-2-1-ConnectInterceptor"><a href="#2-1-3-2-1-ConnectInterceptor" class="headerlink" title="2.1.3.2.1 ConnectInterceptor"></a>2.1.3.2.1 ConnectInterceptor</h5><p>è¿™ä¸ªç±»ä¸»è¦ç”¨æ¥å®ç°ç½‘ç»œè¯·æ±‚è¿æ¥ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹ä»–çš„<code>intercept</code>æ–¹æ³•ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Throws(IOException::class)</span></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">intercept</span><span class="params">(chain: <span class="type">Interceptor</span>.<span class="type">Chain</span>)</span></span>: Response &#123;</span><br><span class="line">    <span class="keyword">val</span> realChain = chain <span class="keyword">as</span> RealInterceptorChain</span><br><span class="line">    <span class="keyword">val</span> request = realChain.request()</span><br><span class="line">    <span class="keyword">val</span> transmitter = realChain.transmitter()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// We need the network to satisfy this request. Possibly for validating a conditional GET.</span></span><br><span class="line">    <span class="keyword">val</span> doExtensiveHealthChecks = request.method != <span class="string">&quot;GET&quot;</span></span><br><span class="line">    <span class="keyword">val</span> exchange = transmitter.newExchange(chain, doExtensiveHealthChecks)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> realChain.proceed(request, transmitter, exchange)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¿™ä¸ªæ–¹æ³•å…ˆå°†ä¼ å…¥çš„<code>chain</code>å¯¹è±¡é€ å‹æˆäº†<code>RealInterceptorChain</code>çš„å¯¹è±¡ï¼Œè¿™ä¸ªç±»æˆ‘ä»¬åœ¨ä¸Šé¢æåˆ°è¿‡ï¼Œç„¶åè°ƒç”¨ä»–çš„<code>response()</code>å’Œ<code>transmitter()</code>æ–¹æ³•ï¼Œåˆ†åˆ«å¾—åˆ°å½“å‰<code>chain</code>çš„<code>response</code>å’Œ<code>transmitter</code>ã€‚ç„¶åæ‰§è¡Œäº†<code>request</code>çš„<code>method()</code>æ–¹æ³•ï¼Œåˆ¤æ–­<code>request</code>çš„ç±»å‹æ˜¯ä¸æ˜¯<code>GET</code>ï¼Œå¦‚æœæ˜¯<code>doExtensiveHealthChecks</code>å°±ä¸º<code>false</code>ï¼Œå¦åˆ™ä¸º<code>true</code>ï¼Œæ¥ç€æŠŠ<code>doExtensiveHealthChecks</code>ä¼ å…¥<code>transmitterçš„newExchange()</code>æ–¹æ³•ä¸­å»ï¼Œè¿™ä¸ªæ–¹æ³•æˆ‘ä»¬ç­‰ä¼šå†è¯´ï¼Œç„¶åå†è°ƒç”¨äº†<code>proceed()</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æˆ‘ä»¬åœ¨ä¸Šé¢è¯´è¿‡ã€‚</p><h5 id="2-1-3-2-2-CallServerInterceptor"><a href="#2-1-3-2-2-CallServerInterceptor" class="headerlink" title="2.1.3.2.2 CallServerInterceptor"></a>2.1.3.2.2 CallServerInterceptor</h5><p>è¿™ä¸ªç±»æ˜¯ç½‘ç»œè¯·æ±‚çš„æœ¬è´¨ã€‚å®ƒçš„<code>intercept</code>æ–¹æ³•æºç å¦‚ä¸‹ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Throws(IOException::class)</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">intercept</span><span class="params">(chain: <span class="type">Interceptor</span>.<span class="type">Chain</span>)</span></span>: Response &#123;</span><br><span class="line">    <span class="keyword">val</span> realChain = chain <span class="keyword">as</span> RealInterceptorChain</span><br><span class="line">    <span class="keyword">val</span> exchange = realChain.exchange()</span><br><span class="line">    <span class="keyword">val</span> request = realChain.request()</span><br><span class="line">    <span class="keyword">val</span> requestBody = request.body</span><br><span class="line">    <span class="keyword">val</span> sentRequestMillis = System.currentTimeMillis()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†™å…¥è¯·æ±‚å¤´</span></span><br><span class="line">    exchange.writeRequestHeaders(request)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> responseHeadersStarted = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">var</span> responseBuilder: Response.Builder? = <span class="literal">null</span></span><br><span class="line">    <span class="comment">// å†™å…¥è¯·æ±‚ä½“ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">if</span> (HttpMethod.permitsRequestBody(request.method) &amp;&amp; requestBody != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœè¯·æ±‚ä¸Šæœ‰â€œexpect:100 continueâ€å¤´</span></span><br><span class="line">        <span class="comment">// è¯·ç­‰å¾…â€œhttp/1.1 100 continueâ€å“åº”ï¼Œç„¶åå†ä¼ è¾“è¯·æ±‚ä¸»ä½“.</span></span><br><span class="line">        <span class="comment">// å¦‚æœæˆ‘ä»¬æ²¡æœ‰å¾—åˆ°ï¼Œè¿”å›æˆ‘ä»¬å¾—åˆ°çš„ï¼ˆä¾‹å¦‚4xxå“åº”ï¼‰ï¼Œè€Œä¸ä¼ è¾“è¯·æ±‚ä½“ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;100-continue&quot;</span>.equals(request.header(<span class="string">&quot;Expect&quot;</span>), ignoreCase = <span class="literal">true</span>)) &#123;</span><br><span class="line">            exchange.flushRequest()</span><br><span class="line">            responseHeadersStarted = <span class="literal">true</span></span><br><span class="line">            exchange.responseHeadersStart()</span><br><span class="line">            responseBuilder = exchange.readResponseHeaders(<span class="literal">true</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (responseBuilder == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (requestBody.isDuplex()) &#123;</span><br><span class="line">                <span class="comment">// å‡†å¤‡ä¸€ä¸ªåŒå·¥ä¸»ä½“ï¼Œä»¥ä¾¿åº”ç”¨ç¨‹åºç¨åå¯ä»¥å‘é€è¯·æ±‚ä¸»ä½“ã€‚</span></span><br><span class="line">                exchange.flushRequest()</span><br><span class="line">                <span class="keyword">val</span> bufferedRequestBody = exchange.createRequestBody(request, <span class="literal">true</span>).buffer()</span><br><span class="line">                requestBody.writeTo(bufferedRequestBody)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœæ»¡è¶³â€œexpect:100 continueâ€é¢„æœŸï¼Œåˆ™ç¼–å†™è¯·æ±‚æ­£æ–‡ã€‚</span></span><br><span class="line">                <span class="keyword">val</span> bufferedRequestBody = exchange.createRequestBody(request, <span class="literal">false</span>).buffer()</span><br><span class="line">                requestBody.writeTo(bufferedRequestBody)</span><br><span class="line">                bufferedRequestBody.close()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            exchange.noRequestBody()</span><br><span class="line">            <span class="keyword">if</span> (!exchange.connection()!!.isMultiplexed) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœä¸æ»¡è¶³â€œexpect:100 continueâ€çš„è¦æ±‚ï¼Œè¯·é˜²æ­¢é‡ç”¨HTTP/1è¿æ¥ã€‚</span></span><br><span class="line">                <span class="comment">// å¦åˆ™ï¼Œæˆ‘ä»¬ä»ç„¶æœ‰ä¹‰åŠ¡ä¼ è¾“è¯·æ±‚ä¸»ä½“ä»¥ä½¿è¿æ¥ä¿æŒä¸€è‡´çŠ¶æ€ã€‚</span></span><br><span class="line">                exchange.noNewExchangesOnConnection()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        exchange.noRequestBody()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»“æŸè¯·æ±‚</span></span><br><span class="line">    <span class="keyword">if</span> (requestBody == <span class="literal">null</span> || !requestBody.isDuplex()) &#123;</span><br><span class="line">        exchange.finishRequest()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!responseHeadersStarted) &#123;</span><br><span class="line">        exchange.responseHeadersStart()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (responseBuilder == <span class="literal">null</span>) &#123;</span><br><span class="line">        responseBuilder = exchange.readResponseHeaders(<span class="literal">false</span>)!!</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¯»å–å“åº”å¤´ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">var</span> response = responseBuilder</span><br><span class="line">        .request(request)</span><br><span class="line">        .handshake(exchange.connection()!!.handshake())</span><br><span class="line">        .sentRequestAtMillis(sentRequestMillis)</span><br><span class="line">        .receivedResponseAtMillis(System.currentTimeMillis())</span><br><span class="line">        .build()</span><br><span class="line">    <span class="keyword">var</span> code = response.code</span><br><span class="line">    <span class="keyword">if</span> (code == <span class="number">100</span>) &#123;</span><br><span class="line">        <span class="comment">// æœåŠ¡å™¨å‘é€äº†ä¸€ä¸ª100ç»§ç»­ï¼Œå³ä½¿æˆ‘ä»¬æ²¡æœ‰è¯·æ±‚ã€‚</span></span><br><span class="line">        <span class="comment">// å†æ¬¡å°è¯•è¯»å–å®é™…å“åº”</span></span><br><span class="line">        response = exchange.readResponseHeaders(<span class="literal">false</span>)!!</span><br><span class="line">            .request(request)</span><br><span class="line">            .handshake(exchange.connection()!!.handshake())</span><br><span class="line">            .sentRequestAtMillis(sentRequestMillis)</span><br><span class="line">            .receivedResponseAtMillis(System.currentTimeMillis())</span><br><span class="line">            .build()</span><br><span class="line">        code = response.code</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    exchange.responseHeadersEnd(response)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// openResponseBody è·å–å“åº”ä½“ä¿¡æ¯</span></span><br><span class="line">    response = <span class="keyword">if</span> (forWebSocket &amp;&amp; code == <span class="number">101</span>) &#123;</span><br><span class="line">        <span class="comment">// è¿æ¥æ­£åœ¨å‡çº§ï¼Œä½†æˆ‘ä»¬éœ€è¦ç¡®ä¿æ‹¦æˆªå™¨çœ‹åˆ°éç©ºçš„å“åº”ä¸»ä½“ã€‚</span></span><br><span class="line">        response.newBuilder()</span><br><span class="line">            .body(EMPTY_RESPONSE)</span><br><span class="line">            .build()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            response.newBuilder()</span><br><span class="line">                .body(exchange.openResponseBody(response))</span><br><span class="line">                .build()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;close&quot;</span>.equals(response.request.header(<span class="string">&quot;Connection&quot;</span>), ignoreCase = <span class="literal">true</span>) ||</span><br><span class="line">        <span class="string">&quot;close&quot;</span>.equals(response.header(<span class="string">&quot;Connection&quot;</span>), ignoreCase = <span class="literal">true</span>)) &#123;</span><br><span class="line">            exchange.noNewExchangesOnConnection()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ((code == <span class="number">204</span> || code == <span class="number">205</span>) &amp;&amp; response.body?.contentLength() ?: -<span class="number">1L</span> &gt; <span class="number">0L</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> ProtocolException(</span><br><span class="line">                <span class="string">&quot;HTTP <span class="variable">$code</span> had non-zero Content-Length: <span class="subst">$&#123;response.body?.contentLength()&#125;</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//è¿”å›ä¸€ä¸ªå“åº”</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å…·ä½“è¿‡ç¨‹å¯ä»¥çœ‹ä»£ç ä¸­çš„æ³¨é‡Šï¼Œå®ƒä¸»è¦æ˜¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ•°æ®å’Œæ¥å—æœåŠ¡å™¨è¿”å›çš„æ•°æ®ã€‚</p><h3 id="2-1-4-Transmiter"><a href="#2-1-4-Transmiter" class="headerlink" title="2.1.4 Transmiter"></a>2.1.4 Transmiter</h3><p><code>Transmitter</code>ç±»æ˜¯<code>OkHttp</code>çš„åº”ç”¨å±‚å’Œç½‘ç»œå±‚çš„ä¸€ä¸ªæ¡¥æ¢ç±»ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¯¥ç±»çš„åˆå§‹åŒ–ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Transmitter</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> client: OkHttpClient,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> call: Call</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> connectionPool: RealConnectionPool = client.connectionPool.delegate</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> eventListener: EventListener = client.eventListenerFactory.create(call)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> timeout = <span class="keyword">object</span> : AsyncTimeout() &#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">timedOut</span><span class="params">()</span></span> &#123;</span><br><span class="line">            cancel()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;.apply &#123;</span><br><span class="line">        timeout(client.callTimeoutMillis.toLong(), MILLISECONDS)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><br><code>Transmitter</code>ä¸»è¦çš„ä¸€äº›æˆå‘˜å˜é‡å°±è¿™äº›ï¼Œé¦–å…ˆæ„é€ å™¨ä¸­ä¼ å…¥äº†ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ª<code>OkHttpClient</code>ï¼Œä¸€ä¸ª<code>Call</code>ã€‚ç„¶ååˆåˆ›å»ºäº†ä¸€ä¸ªè¿æ¥æ± <code>connectionPool</code>ï¼Œè¿˜æœ‰ä¸€ä¸ªç›‘å¬å™¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰©å±•è¿™ä¸ªç±»æ¥ç›‘å¬ç¨‹åºçš„<code>HTTP</code>çš„è°ƒç”¨æ•°é‡ã€å¤§å°å’ŒæŒç»­æ—¶é—´ã€‚</p><h3 id="2-1-5-RealConnection"><a href="#2-1-5-RealConnection" class="headerlink" title="2.1.5 RealConnection"></a>2.1.5 RealConnection</h3><p>æˆ‘ä»¬å…ˆçœ‹çœ‹ä»–çš„ä¸€äº›å±æ€§ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RealConnection</span>(</span><br><span class="line">    <span class="keyword">val</span> connectionPool: RealConnectionPool,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> route: Route</span><br><span class="line">) : Http2Connection.Listener(), Connection &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»¥ä¸‹å­—æ®µç”±connectï¼ˆï¼‰åˆå§‹åŒ–ï¼Œä»ä¸é‡æ–°åˆ†é…ã€‚</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// åº•å±‚socket</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> rawSocket: Socket? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åº”ç”¨å±‚å¥—æ¥å­—ã€‚å¦‚æœæ­¤è¿æ¥ä¸ä½¿ç”¨SSLï¼Œåˆ™å¯ä»¥æ˜¯[sslsocket]åˆ†å±‚åœ¨[rawsocket]ä¸Šï¼Œä¹Ÿå¯ä»¥æ˜¯[rawsocket]æœ¬èº«ã€‚</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="comment">// åº”ç”¨å±‚socket</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> socket: Socket? = <span class="literal">null</span></span><br><span class="line">    <span class="comment">// æ¡æ‰‹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> handshake: Handshake? = <span class="literal">null</span></span><br><span class="line">    <span class="comment">//  åè®®</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> protocol: Protocol? = <span class="literal">null</span></span><br><span class="line">    <span class="comment">// http2çš„è¿æ¥</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> http2Connection: Http2Connection? = <span class="literal">null</span></span><br><span class="line">    <span class="comment">// ä¸æœåŠ¡å™¨äº¤äº’çš„è¾“å…¥è¾“å‡ºæµ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> source: BufferedSource? = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> sink: BufferedSink? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·Ÿè¸ªè¿æ¥çŠ¶æ€ä¸‹çš„å­—æ®µç”±è¿æ¥æ± ä¿æŠ¤ã€‚</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¦‚æœä¸ºtrueï¼Œåˆ™ä¸èƒ½åœ¨æ­¤è¿æ¥ä¸Šåˆ›å»ºæ–°çš„äº¤æ¢ã€‚ä¸€æ—¦æ˜¯trueçš„ï¼Œè¿™æ€»æ˜¯trueçš„ã€‚</span></span><br><span class="line"><span class="comment">     * ç”±[ConnectionPool]ç›‘è§†ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">var</span> noNewExchanges = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å»ºç«‹å¯èƒ½ç”±äºæ‰€é€‰è·¯ç”±è€Œå¯¼è‡´çš„æµæ—¶å‡ºç°é—®é¢˜çš„æ¬¡æ•°ã€‚ç”±[ConnectionPool]ä¿æŠ¤ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">var</span> routeFailureCount = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">var</span> successCount = <span class="number">0</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> refusedStreamCount = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ­¤è¿æ¥å¯ä»¥æ‰¿è½½çš„æœ€å¤§å¹¶å‘æµæ•°ã€‚</span></span><br><span class="line"><span class="comment">     * å¦‚æœâ€œallocations.sizeï¼ˆï¼‰&lt;allocationlimitâ€ï¼Œåˆ™å¯ä»¥åœ¨æ­¤è¿æ¥ä¸Šåˆ›å»ºæ–°æµã€‚     </span></span><br><span class="line"><span class="comment">     */</span> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> allocationLimit = <span class="number">1</span></span><br></pre></td></tr></table></figure><br>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹ä»–çš„<code>connect()</code>æ–¹æ³•ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">connect</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    connectTimeout: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    readTimeout: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    writeTimeout: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    pingIntervalMillis: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    connectionRetryEnabled: <span class="type">Boolean</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    call: <span class="type">Call</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    eventListener: <span class="type">EventListener</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line">    check(protocol == <span class="literal">null</span>) &#123; <span class="string">&quot;already connected&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çº¿è·¯çš„é€‰æ‹©</span></span><br><span class="line">    <span class="keyword">var</span> routeException: RouteException? = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">val</span> connectionSpecs = route.address.connectionSpecs</span><br><span class="line">    <span class="keyword">val</span> connectionSpecSelector = ConnectionSpecSelector(connectionSpecs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (route.address.sslSocketFactory == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (ConnectionSpec.CLEARTEXT !<span class="keyword">in</span> connectionSpecs) &#123;</span><br><span class="line">            <span class="keyword">throw</span> RouteException(UnknownServiceException(</span><br><span class="line">                <span class="string">&quot;CLEARTEXT communication not enabled for client&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">val</span> host = route.address.url.host</span><br><span class="line">        <span class="keyword">if</span> (!Platform.<span class="keyword">get</span>().isCleartextTrafficPermitted(host)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> RouteException(UnknownServiceException(</span><br><span class="line">                <span class="string">&quot;CLEARTEXT communication to <span class="variable">$host</span> not permitted by network security policy&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (Protocol.H2_PRIOR_KNOWLEDGE <span class="keyword">in</span> route.address.protocols) &#123;</span><br><span class="line">            <span class="keyword">throw</span> RouteException(UnknownServiceException(</span><br><span class="line">                <span class="string">&quot;H2_PRIOR_KNOWLEDGE cannot be used with HTTPS&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿æ¥å¼€å§‹</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœè¦æ±‚éš§é“æ¨¡å¼ï¼Œå»ºç«‹é€šé“è¿æ¥ï¼Œé€šå¸¸ä¸æ˜¯è¿™ç§</span></span><br><span class="line">            <span class="keyword">if</span> (route.requiresTunnel()) &#123;</span><br><span class="line">                connectTunnel(connectTimeout, readTimeout, writeTimeout, call, eventListener)</span><br><span class="line">                <span class="keyword">if</span> (rawSocket == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// æˆ‘ä»¬æ— æ³•è¿æ¥éš§é“ï¼Œä½†é€‚å½“å…³é—­äº†æˆ‘ä»¬çš„èµ„æºã€‚</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// ä¸€èˆ¬éƒ½èµ°è¿™æ¡é€»è¾‘äº†ï¼Œå®é™…ä¸Šå¾ˆç®€å•å°±æ˜¯socketçš„è¿æ¥</span></span><br><span class="line">                connectSocket(connectTimeout, readTimeout, call, eventListener)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// httpsçš„å»ºç«‹</span></span><br><span class="line">            establishProtocol(connectionSpecSelector, pingIntervalMillis, call, eventListener)</span><br><span class="line">            eventListener.connectEnd(call, route.socketAddress, route.proxy, protocol)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (e: IOException) &#123;</span><br><span class="line">            socket?.closeQuietly()</span><br><span class="line">            rawSocket?.closeQuietly()</span><br><span class="line">            socket = <span class="literal">null</span></span><br><span class="line">            rawSocket = <span class="literal">null</span></span><br><span class="line">            source = <span class="literal">null</span></span><br><span class="line">            sink = <span class="literal">null</span></span><br><span class="line">            handshake = <span class="literal">null</span></span><br><span class="line">            protocol = <span class="literal">null</span></span><br><span class="line">            http2Connection = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">            eventListener.connectFailed(call, route.socketAddress, route.proxy, <span class="literal">null</span>, e)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (routeException == <span class="literal">null</span>) &#123;</span><br><span class="line">                routeException = RouteException(e)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                routeException.addConnectException(e)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!connectionRetryEnabled || !connectionSpecSelector.connectionFailed(e)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> routeException</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (route.requiresTunnel() &amp;&amp; rawSocket == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> RouteException(ProtocolException(</span><br><span class="line">            <span class="string">&quot;Too many tunnel connections attempted: <span class="variable">$MAX_TUNNEL_ATTEMPTS</span>&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> http2Connection = <span class="keyword">this</span>.http2Connection</span><br><span class="line">    <span class="keyword">if</span> (http2Connection != <span class="literal">null</span>) &#123;</span><br><span class="line">        synchronized(connectionPool) &#123;</span><br><span class="line">            allocationLimit = http2Connection.maxConcurrentStreams()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>é¦–å…ˆæ£€æŸ¥æ˜¯å¦å·²ç»å»ºç«‹è¿æ¥ï¼Œå¦‚æœå·²ç»å»ºç«‹å°±æŠ›å¼‚å¸¸ï¼Œæ²¡æœ‰çš„è¯å°±ç»§ç»­ã€‚æ¥ç€å°±å¾—åˆ°äº†<code>ConnectionSpecs</code>ï¼Œç„¶åæ ¹æ®ä»–å»ºç«‹äº†ä¸€ä¸ª<code>connectionSpecSelector</code>é›†åˆã€‚æ¥ç€åˆ¤æ–­æ˜¯ä¸æ˜¯å®‰å…¨è¿æ¥ï¼Œä¹Ÿå°±æ˜¯sslè¿æ¥ï¼Œå¦‚æœä¸æ˜¯çš„è¯å°±åˆ¤æ–­äº†ä¸€äº›å±æ€§ï¼Œå…ˆç¡®å®šæ˜¯ä¸æ˜¯æ˜æ–‡ç„¶åå†ç¡®å®šä¸»æœºèƒ½ä¸èƒ½æ¥å—æ˜æ–‡æ“ä½œã€‚æ¥ç€å°±å¼€å§‹è¿æ¥ï¼Œåˆ¤æ–­æ˜¯ä¸æ˜¯è¦è¿›è¡Œéš§é“é€šä¿¡ï¼Œå¦‚æœæ˜¯å°±è°ƒç”¨<code>connectTunnel()</code>å»ºç«‹éš§é“é€šä¿¡ï¼Œå¦‚æœä¸æ˜¯å°±è°ƒç”¨<code>connectSocket()</code>å»ºç«‹æ™®é€šçš„é€šä¿¡ã€‚ç„¶åé€šè¿‡<code>establishProtocol()</code>å»ºç«‹åè®®ã€‚å¦‚æœæ˜¯<code>HTTP/2</code>å°±è®¾ç½®ç›¸å…³å±æ€§ã€‚</p><p>ç„¶åæˆ‘ä»¬å°±æ¥çœ‹çœ‹ä»–å…·ä½“å¦‚ä½•å®ç°çš„ï¼Œå…ˆçœ‹çœ‹<code>connectSocket()</code>æ–¹æ³•ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Throws(IOException::class)</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">connectSocket</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    connectTimeout: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    readTimeout: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    call: <span class="type">Call</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    eventListener: <span class="type">EventListener</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> proxy = route.proxy</span><br><span class="line">    <span class="keyword">val</span> address = route.address</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ®ä»£ç†ç±»å‹é€‰æ‹©socketç±»å‹æ˜¯ä»£ç†è¿˜æ˜¯ç›´è¿</span></span><br><span class="line">    <span class="keyword">val</span> rawSocket = <span class="keyword">when</span> (proxy.type()) &#123;</span><br><span class="line">        Proxy.Type.DIRECT, Proxy.Type.HTTP -&gt; address.socketFactory.createSocket()!!</span><br><span class="line">        <span class="keyword">else</span> -&gt; Socket(proxy)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.rawSocket = rawSocket</span><br><span class="line"></span><br><span class="line">    eventListener.connectStart(call, route.socketAddress, proxy)</span><br><span class="line">    rawSocket.soTimeout = readTimeout</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// è¿æ¥socketï¼Œä¹‹æ‰€ä»¥è¿™æ ·å†™æ˜¯å› ä¸ºæ”¯æŒä¸åŒçš„å¹³å°</span></span><br><span class="line">        <span class="comment">// é‡Œé¢å®é™…ä¸Šæ˜¯  socket.connect(address, connectTimeout);</span></span><br><span class="line">        Platform.<span class="keyword">get</span>().connectSocket(rawSocket, route.socketAddress, connectTimeout)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e: ConnectException) &#123;</span><br><span class="line">        <span class="keyword">throw</span> ConnectException(<span class="string">&quot;Failed to connect to <span class="subst">$&#123;route.socketAddress&#125;</span>&quot;</span>).apply &#123;</span><br><span class="line">            initCause(e)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸‹é¢çš„Try/Catchå—æ˜¯ä¸€ç§é¿å…Android 7.0å´©æºƒçš„ä¼ªé»‘å®¢æ–¹æ³•</span></span><br><span class="line">    <span class="comment">// More details:</span></span><br><span class="line">    <span class="comment">// https://github.com/square/okhttp/issues/3245</span></span><br><span class="line">    <span class="comment">// https://android-review.googlesource.com/#/c/271775/</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// å¾—åˆ°è¾“å…¥ï¼è¾“å‡ºæµ</span></span><br><span class="line">        source = rawSocket.source().buffer()</span><br><span class="line">        sink = rawSocket.sink().buffer()</span><br><span class="line">    &#125; <span class="keyword">catch</span> (npe: NullPointerException) &#123;</span><br><span class="line">        <span class="keyword">if</span> (npe.message == NPE_THROW_WITH_NULL) &#123;</span><br><span class="line">            <span class="keyword">throw</span> IOException(npe)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>é¦–å…ˆå…ˆåˆ¤æ–­è¿æ¥ç±»å‹ï¼Œå¦‚æœæ˜¯ç›´è¿æˆ–è€…<code>HTTP</code>è¿æ¥å°±ç›´è¿ï¼Œå¦åˆ™çš„è¯èµ°<code>Socket</code>ä»£ç†ï¼Œç„¶åé€šè¿‡<code>eventListener.connectStart()</code>æ–¹æ³•åˆ›å»ºè¿æ¥ï¼Œå†è®¾å®šè¶…æ—¶-&gt;å®Œæˆè¿æ¥-&gt;åˆ›å»ºç”¨äºI/Oçš„<code>source</code>å’Œ<code>sink</code>ã€‚</p><p>æˆ‘ä»¬æ¥ç€å†æ¥çœ‹<code>connectTunnel()</code>æ–¹æ³•ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Throws(IOException::class)</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">connectTunnel</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    connectTimeout: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    readTimeout: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    writeTimeout: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    call: <span class="type">Call</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    eventListener: <span class="type">EventListener</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> tunnelRequest: Request = createTunnelRequest()</span><br><span class="line">    <span class="keyword">val</span> url = tunnelRequest.url</span><br><span class="line">    <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">0</span> until MAX_TUNNEL_ATTEMPTS) &#123;</span><br><span class="line">        connectSocket(connectTimeout, readTimeout, call, eventListener)</span><br><span class="line">        tunnelRequest = createTunnel(readTimeout, writeTimeout, tunnelRequest, url)</span><br><span class="line">            ?: <span class="keyword">break</span> <span class="comment">// å·²æˆåŠŸåˆ›å»ºéš§é“ã€‚</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»£ç†å†³å®šåœ¨èº«ä»½éªŒè¯è´¨è¯¢åå…³é—­è¿æ¥ã€‚</span></span><br><span class="line">        <span class="comment">// æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œä½†è¿™æ¬¡éœ€è¦ä½¿ç”¨èº«ä»½éªŒè¯å‡­æ®ã€‚</span></span><br><span class="line">        rawSocket?.closeQuietly()</span><br><span class="line">        rawSocket = <span class="literal">null</span></span><br><span class="line">        sink = <span class="literal">null</span></span><br><span class="line">        source = <span class="literal">null</span></span><br><span class="line">        eventListener.connectEnd(call, route.socketAddress, route.proxy, <span class="literal">null</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å¤§ä½“å°±æ˜¯å…ˆåˆ›å»ºéš§é“è¯·æ±‚ï¼Œç„¶åå»ºç«‹<code>socket</code>è¿æ¥ï¼Œå†å‘é€è¯·æ±‚å»ºç«‹éš§é“ã€‚</p><h1 id="3-è¯·æ±‚æµç¨‹å›¾"><a href="#3-è¯·æ±‚æµç¨‹å›¾" class="headerlink" title="3. è¯·æ±‚æµç¨‹å›¾"></a>3. è¯·æ±‚æµç¨‹å›¾</h1><p>é‚£æˆ‘ä»¬æœ€åæ¥æ€»ç»“ä¸‹</p><h2 id="3-1-åŒæ­¥è¯·æ±‚æ˜¯å¦‚ä½•æ“ä½œçš„ï¼Ÿ"><a href="#3-1-åŒæ­¥è¯·æ±‚æ˜¯å¦‚ä½•æ“ä½œçš„ï¼Ÿ" class="headerlink" title="3.1 åŒæ­¥è¯·æ±‚æ˜¯å¦‚ä½•æ“ä½œçš„ï¼Ÿ"></a>3.1 åŒæ­¥è¯·æ±‚æ˜¯å¦‚ä½•æ“ä½œçš„ï¼Ÿ</h2><p><img src="https://cdn.littlecorgi.top/mweb/2019-07-26/OkHttpSync.jpg" alt="OkHttpSyn"></p><h2 id="3-2-å¼‚æ­¥è¯·æ±‚æ˜¯å¦‚ä½•æ“ä½œçš„ï¼Ÿ"><a href="#3-2-å¼‚æ­¥è¯·æ±‚æ˜¯å¦‚ä½•æ“ä½œçš„ï¼Ÿ" class="headerlink" title="3.2 å¼‚æ­¥è¯·æ±‚æ˜¯å¦‚ä½•æ“ä½œçš„ï¼Ÿ"></a>3.2 å¼‚æ­¥è¯·æ±‚æ˜¯å¦‚ä½•æ“ä½œçš„ï¼Ÿ</h2><p><img src="https://cdn.littlecorgi.top/mweb/2019-07-26/OkHttpAsync.jpg" alt="OkHttpAsyn"></p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Android/">Android</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E6%BA%90%E7%A0%81/">æºç </category>
      
      <category domain="https://www.littlecorgi.top/tags/kotlin/">kotlin</category>
      
      <category domain="https://www.littlecorgi.top/tags/OkHttp/">OkHttp</category>
      
      
      <comments>https://www.littlecorgi.top/posts/151ac78a.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Androidç½‘ç»œè¯·æ±‚2--è§£æVolleyæºç </title>
      <link>https://www.littlecorgi.top/posts/df8fd75e.html</link>
      <guid>https://www.littlecorgi.top/posts/df8fd75e.html</guid>
      <pubDate>Thu, 25 Jul 2019 09:24:14 GMT</pubDate>
      
      <description>&lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡å¤§ç¯‡å¹…å‚è€ƒ&lt;a href=&quot;https://www.jianshu.com/p/d8500e377f3e&quot;&gt;æ­¤ç¯‡æ–‡ç« &lt;/a&gt;ï¼Œå¤§å®¶å¯ä»¥ç»“åˆä¸¤ç¯‡æ–‡ç« çœ‹ä¸€ä¸‹&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;1-Volleyç®€ä»‹&quot;&gt;&lt;a href=&quot;#1-Volleyç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;1. Volleyç®€ä»‹&quot;&gt;&lt;/a&gt;1. Volleyç®€ä»‹&lt;/h1&gt;&lt;p&gt;åœ¨å¾ˆæ—©ä»¥å‰ï¼Œå¦‚æœAndroidå¼€å‘è€…æƒ³ä½¿ç”¨ç½‘ç»œè¯·æ±‚çš„è¯ï¼Œå¿…é¡»è‡ªå·±é€šè¿‡&lt;code&gt;HttpClient&lt;/code&gt;æˆ–è€…&lt;code&gt;HttpURLConnection&lt;/code&gt;ç¼–å†™ä»£ç æ¥è®¿é—®ã€‚ä½†æ˜¯ä»–ä¸¤çš„ç”¨æ³•è¿˜æ˜¯å¾ˆå¤æ‚çš„ï¼Œå¦‚æœä¸é€‚å½“çš„å°è£…çš„è¯ï¼Œå°±ä¼šæœ‰å¾ˆå¤šå¤šä½™ä»£ç ç”šè‡³æ•ˆç‡é™ä½ã€‚æ‰€ä»¥å½“æ—¶å‡ºç°äº†å¾ˆå¤šç¬¬ä¸‰æ–¹ç½‘ç»œé€šä¿¡æ¡†æ¶ï¼Œä½†æ˜¯éƒ½æ˜¯ç¬¬ä¸‰æ–¹çš„ï¼Œè€Œè°·æ­Œå®˜æ–¹ä¸€ç›´æ²¡æœ‰ä½œä¸ºã€‚&lt;br&gt;æœ€ç»ˆåœ¨2013å¹´ï¼Œè°·æ­Œç»ˆäºæ„è¯†åˆ°äº†é—®é¢˜ï¼Œäºæ˜¯ä»–ä»¬æ¨å‡ºäº†ä¸€ä¸ªå®˜æ–¹çš„å…¨æ–°çš„ç½‘ç»œæ¡†æ¶â€”â€”Volleyã€‚Volleyå®ƒåˆèƒ½éå¸¸ç®€å•çš„è¿›è¡ŒHTTPé€šä¿¡ï¼Œåˆèƒ½è½»æ¾åŠ è½½ç½‘ç»œä¸Šçš„å›¾ç‰‡ã€‚ä»–çš„è®¾è®¡ç›®çš„å°±æ˜¯åº”å¯¹æ•°æ®é‡ä¸å¤§ä½†æ˜¯é¢‘å‘çš„ç½‘ç»œæ“ä½œï¼Œä½†æ˜¯å¯¹äºä¸‹è½½ç­‰éœ€è¦å¤§æ•°æ®é‡çš„ç½‘ç»œæ“ä½œï¼Œä»–å°±ä¸å¤ªé€‚åˆã€‚&lt;br&gt;</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>æœ¬æ–‡å¤§ç¯‡å¹…å‚è€ƒ<a href="https://www.jianshu.com/p/d8500e377f3e">æ­¤ç¯‡æ–‡ç« </a>ï¼Œå¤§å®¶å¯ä»¥ç»“åˆä¸¤ç¯‡æ–‡ç« çœ‹ä¸€ä¸‹</p></blockquote><h1 id="1-Volleyç®€ä»‹"><a href="#1-Volleyç®€ä»‹" class="headerlink" title="1. Volleyç®€ä»‹"></a>1. Volleyç®€ä»‹</h1><p>åœ¨å¾ˆæ—©ä»¥å‰ï¼Œå¦‚æœAndroidå¼€å‘è€…æƒ³ä½¿ç”¨ç½‘ç»œè¯·æ±‚çš„è¯ï¼Œå¿…é¡»è‡ªå·±é€šè¿‡<code>HttpClient</code>æˆ–è€…<code>HttpURLConnection</code>ç¼–å†™ä»£ç æ¥è®¿é—®ã€‚ä½†æ˜¯ä»–ä¸¤çš„ç”¨æ³•è¿˜æ˜¯å¾ˆå¤æ‚çš„ï¼Œå¦‚æœä¸é€‚å½“çš„å°è£…çš„è¯ï¼Œå°±ä¼šæœ‰å¾ˆå¤šå¤šä½™ä»£ç ç”šè‡³æ•ˆç‡é™ä½ã€‚æ‰€ä»¥å½“æ—¶å‡ºç°äº†å¾ˆå¤šç¬¬ä¸‰æ–¹ç½‘ç»œé€šä¿¡æ¡†æ¶ï¼Œä½†æ˜¯éƒ½æ˜¯ç¬¬ä¸‰æ–¹çš„ï¼Œè€Œè°·æ­Œå®˜æ–¹ä¸€ç›´æ²¡æœ‰ä½œä¸ºã€‚<br>æœ€ç»ˆåœ¨2013å¹´ï¼Œè°·æ­Œç»ˆäºæ„è¯†åˆ°äº†é—®é¢˜ï¼Œäºæ˜¯ä»–ä»¬æ¨å‡ºäº†ä¸€ä¸ªå®˜æ–¹çš„å…¨æ–°çš„ç½‘ç»œæ¡†æ¶â€”â€”Volleyã€‚Volleyå®ƒåˆèƒ½éå¸¸ç®€å•çš„è¿›è¡ŒHTTPé€šä¿¡ï¼Œåˆèƒ½è½»æ¾åŠ è½½ç½‘ç»œä¸Šçš„å›¾ç‰‡ã€‚ä»–çš„è®¾è®¡ç›®çš„å°±æ˜¯åº”å¯¹æ•°æ®é‡ä¸å¤§ä½†æ˜¯é¢‘å‘çš„ç½‘ç»œæ“ä½œï¼Œä½†æ˜¯å¯¹äºä¸‹è½½ç­‰éœ€è¦å¤§æ•°æ®é‡çš„ç½‘ç»œæ“ä½œï¼Œä»–å°±ä¸å¤ªé€‚åˆã€‚<br><span id="more"></span></p><h1 id="2-æºç è§£æ"><a href="#2-æºç è§£æ" class="headerlink" title="2. æºç è§£æ"></a>2. æºç è§£æ</h1><h2 id="2-1-ä»RequestQueueå…¥æ‰‹"><a href="#2-1-ä»RequestQueueå…¥æ‰‹" class="headerlink" title="2.1 ä»RequestQueueå…¥æ‰‹"></a>2.1 ä»RequestQueueå…¥æ‰‹</h2><p>å¦‚æœä½ ä½¿ç”¨Volleyçš„è¯ï¼Œå°±ä¼šå‘ç°Volleyä¸ç®¡è¿›è¡Œä»€ä¹ˆæ“ä½œï¼Œé¦–å…ˆç¬¬ä¸€æ­¥å°±æ˜¯å…ˆåˆ›å»ºRequestQueueå¯¹è±¡ã€‚<br>æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥è®¤å®šä»–ä¸ºVolleyçš„å…¥å£ã€‚<br>åˆ›å»ºRequestQueueçš„æ–¹æ³•æ˜¯<code>RequestQueue mQueue = Volley.newRequestQueue(getApplicationContext());</code>,æˆ‘ä»¬å°±çœ‹çœ‹<code>newRequestQueue</code>å¹²äº†ä»€ä¹ˆï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> RequestQueue <span class="title function_">newRequestQueue</span><span class="params">(Context context, BaseHttpStack stack)</span> &#123;</span><br><span class="line">    BasicNetwork network;</span><br><span class="line">    <span class="keyword">if</span> (stack == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="number">9</span>) &#123;</span><br><span class="line">            network = <span class="keyword">new</span> <span class="title class_">BasicNetwork</span>(<span class="keyword">new</span> <span class="title class_">HurlStack</span>());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// åœ¨Android 2.3ä¹‹å‰ï¼ŒHttpURLConnectionæ˜¯ä¸å¯é çš„ã€‚</span></span><br><span class="line">            <span class="comment">// è¯·å‚é˜…ï¼šhttp://android-developers.blogspot.com/2011/09/androids-http-clients.html</span></span><br><span class="line">            <span class="comment">// åœ¨å°†æ¥çš„æŸä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°†æŠŠminsdkversionç§»åˆ°Android 2.2ä¹‹ä¸Šï¼Œ</span></span><br><span class="line">            <span class="comment">// å¹¶å¯ä»¥åˆ é™¤è¿™ä¸ªå›é€€ï¼ˆè¿åŒæ‰€æœ‰ApacheHTTPä»£ç ï¼‰ã€‚            </span></span><br><span class="line">            <span class="type">String</span> <span class="variable">userAgent</span> <span class="operator">=</span> <span class="string">&quot;volley/0&quot;</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">packageName</span> <span class="operator">=</span> context.getPackageName();</span><br><span class="line">                <span class="type">PackageInfo</span> <span class="variable">info</span> <span class="operator">=</span></span><br><span class="line">             context.getPackageManager().getPackageInfo(packageName, <span class="comment">/* flags= */</span> <span class="number">0</span>);</span><br><span class="line">                    userAgent = packageName + <span class="string">&quot;/&quot;</span> + info.versionCode;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (NameNotFoundException e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        network =</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">BasicNetwork</span>(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">HttpClientStack</span>(AndroidHttpClient.newInstance(userAgent)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        network = <span class="keyword">new</span> <span class="title class_">BasicNetwork</span>(stack);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> newRequestQueue(context, network);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è°ƒç”¨æ–¹æ³•åï¼Œå…ˆæŸ¥çœ‹Androidç‰ˆæœ¬æ˜¯å¦å¤§äºç­‰äº2.3ï¼Œå¦‚æœå¤§äºåˆ™è°ƒç”¨åŸºäº<code>HttpURLConnection</code>çš„<code>HurlStack</code>ï¼Œå¦åˆ™è°ƒç”¨åŸºäº<code>HttpClient</code>çš„<code>HttpClientStack</code>ã€‚æ¥ä¸‹æ¥åˆ›å»º<code>BasicNetwork</code>å¹¶è°ƒç”¨<code>newRequestQueue(context, network)</code>æ–¹ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹è¿™ä¸ª<code>newRequestQueue()</code>æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> RequestQueue <span class="title function_">newRequestQueue</span><span class="params">(Context context, Network network)</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">Context</span> <span class="variable">appContext</span> <span class="operator">=</span> context.getApplicationContext();</span><br><span class="line">    <span class="comment">// å¯¹ç¼“å­˜ç›®å½•ä½¿ç”¨æƒ°æ€§ä¾›åº”å•†ï¼Œä»¥ä¾¿å¯ä»¥åœ¨ä¸»çº¿ç¨‹ä¸Šè°ƒç”¨newRequestQueueï¼ˆï¼‰ï¼Œ</span></span><br><span class="line">    <span class="comment">// è€Œä¸ä¼šå¯¼è‡´ä¸¥æ ¼çš„æ¨¡å¼å†²çªã€‚    </span></span><br><span class="line">    DiskBasedCache.<span class="type">FileSupplier</span> <span class="variable">cacheSupplier</span> <span class="operator">=</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">DiskBasedCache</span>.FileSupplier() &#123;</span><br><span class="line">                <span class="keyword">private</span> <span class="type">File</span> <span class="variable">cacheDir</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> File <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (cacheDir == <span class="literal">null</span>) &#123;</span><br><span class="line">                        cacheDir = <span class="keyword">new</span> <span class="title class_">File</span>(appContext.getCacheDir(), DEFAULT_CACHE_DIR);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> cacheDir;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">    <span class="type">RequestQueue</span> <span class="variable">queue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RequestQueue</span>(<span class="keyword">new</span> <span class="title class_">DiskBasedCache</span>(cacheSupplier), network);</span><br><span class="line">    queue.start();</span><br><span class="line">    <span class="keyword">return</span> queue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ–¹æ³•ä¸»è¦ä¸ºVolleyåˆ›å»ºäº†ä¸€ä¸ªç¡¬ç›˜ç¼“å­˜<code>DiskBasedCache</code>ï¼Œç„¶åé€šè¿‡è¿™ä¸ªç£ç›˜ç¼“å­˜å’Œ<code>Network</code>åˆ›å»ºäº†ä¸€ä¸ª<code>RequestQueue</code>å¯¹è±¡ï¼Œå¹¶è°ƒç”¨äº†<code>start()</code>æ–¹æ³•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹<code>start()</code>æ–¹æ³•:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">    stop(); </span><br><span class="line">    <span class="comment">// ç¡®ä¿å½“å‰è¿è¡Œçš„æ‰€æœ‰è°ƒåº¦ç¨‹åºéƒ½å·²åœæ­¢ã€‚</span></span><br><span class="line">    <span class="comment">// åˆ›å»ºç¼“å­˜è°ƒåº¦å™¨å¹¶å¼€å§‹å®ƒã€‚</span></span><br><span class="line">    mCacheDispatcher = <span class="keyword">new</span> <span class="title class_">CacheDispatcher</span>(mCacheQueue, mNetworkQueue, mCache, mDelivery);</span><br><span class="line">    mCacheDispatcher.start();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºè¾¾åˆ°æ± å¤§å°çš„ç½‘ç»œè°ƒåº¦ç¨‹åºï¼ˆå’Œç›¸åº”çš„çº¿ç¨‹ï¼‰ã€‚</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; mDispatchers.length; i++) &#123;</span><br><span class="line">        <span class="type">NetworkDispatcher</span> <span class="variable">networkDispatcher</span> <span class="operator">=</span></span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">NetworkDispatcher</span>(mNetworkQueue, mNetwork, mCache, mDelivery);</span><br><span class="line">        mDispatchers[i] = networkDispatcher;</span><br><span class="line">        networkDispatcher.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><code>CacheDispatcher</code>æ˜¯ä¸€ä¸ªç¼“å­˜è°ƒåº¦çº¿ç¨‹ï¼Œå¹¶è°ƒç”¨äº†<code>start()</code>æ–¹æ³•ã€‚åœ¨å¾ªç¯ä¸­è°ƒç”¨<code>NetworkDispatcher</code>çš„<code>start()</code>æ–¹æ³•ã€‚<code>NetworkDispatcher</code>æ˜¯ç½‘ç»œè°ƒåº¦çº¿ç¨‹ï¼Œé»˜è®¤æƒ…å†µä¸‹<code>mDispatchers.length</code>ä¸º4ï¼Œé»˜è®¤å¼€å¯äº†4ä¸ªè°ƒåº¦çº¿ç¨‹ï¼Œå¤–åŠ 1ä¸ªç¼“å­˜è°ƒåº¦çº¿ç¨‹ï¼Œæ€»å…±5ä¸ªçº¿ç¨‹ã€‚<br>æ¥ä¸‹æ¥Volleyä¼šåˆ›å»ºå„ç§<code>Request</code>ï¼Œå¹¶è°ƒç”¨<code>RequestQueue</code>çš„<code>add()</code>æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; Request&lt;T&gt; <span class="title function_">add</span><span class="params">(Request&lt;T&gt; request)</span> &#123;</span><br><span class="line">    <span class="comment">// å°†è¯·æ±‚æ ‡è®°ä¸ºå±äºæ­¤é˜Ÿåˆ—ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°å½“å‰è¯·æ±‚é›†ã€‚</span></span><br><span class="line">    request.setRequestQueue(<span class="built_in">this</span>);</span><br><span class="line">    <span class="keyword">synchronized</span> (mCurrentRequests) &#123;</span><br><span class="line">        <span class="comment">//mCurrentRequestsæ˜¯ä¸€ä¸ªHashSet</span></span><br><span class="line">        mCurrentRequests.add(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒ‰æ·»åŠ çš„é¡ºåºå¤„ç†è¯·æ±‚ã€‚</span></span><br><span class="line">    request.setSequence(getSequenceNumber());</span><br><span class="line">    request.addMarker(<span class="string">&quot;add-to-queue&quot;</span>);</span><br><span class="line">    sendRequestEvent(request, RequestEvent.REQUEST_QUEUED);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœè¯·æ±‚æ˜¯ä¸å¯æ‰§è¡Œçš„ï¼Œè·³è¿‡ç¼“å­˜é˜Ÿåˆ—ï¼Œç„¶åç›´æ¥è¿›å…¥ç½‘ç»œã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (!request.shouldCache()) &#123;</span><br><span class="line">        mNetworkQueue.add(request);</span><br><span class="line">        <span class="keyword">return</span> request;</span><br><span class="line">    &#125;</span><br><span class="line">    mCacheQueue.add(request);</span><br><span class="line">    <span class="keyword">return</span> request;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¿™å—åœ°æ–¹çš„ä»£ç å°±å¾ˆç®€å•äº†ï¼Œå°±æ˜¯æ ¹æ®<code>request</code>çš„<code>shouldCache()</code>æ–¹æ³•æ¥è¿”å›<code>request</code>çš„<code>mShouldCache</code>å±æ€§æ¥åˆ¤æ–­æ˜¯å¦å¯ä»¥ç¼“å­˜ï¼Œé»˜è®¤æ˜¯å¯ä»¥çš„ã€‚å¦‚æœèƒ½ç¼“å­˜ï¼Œå°†æ­¤è¯·æ±‚åŠ å…¥<code>mCacheQueue</code>é˜Ÿåˆ—ï¼Œä¸å†é‡å¤è¯·æ±‚ï¼›ä¸å¯ä»¥çš„è¯å°±å°†è¯·æ±‚åŠ å…¥ç½‘ç»œè¯·æ±‚é˜Ÿåˆ—<code>mNetworkQueue</code>ã€‚</p><h2 id="2-2-CacheDispatcherç¼“å­˜è°ƒåº¦çº¿ç¨‹"><a href="#2-2-CacheDispatcherç¼“å­˜è°ƒåº¦çº¿ç¨‹" class="headerlink" title="2.2 CacheDispatcherç¼“å­˜è°ƒåº¦çº¿ç¨‹"></a>2.2 CacheDispatcherç¼“å­˜è°ƒåº¦çº¿ç¨‹</h2><p><code>RequestQueue</code>çš„<code>add()</code>æ–¹æ³•å¹¶æ²¡æœ‰è¯·æ±‚ç½‘ç»œæˆ–è€…å¯¹ç¼“å­˜è¿›è¡Œæ“ä½œã€‚å½“å°†è¯·æ±‚æ·»åŠ åˆ°ç½‘ç»œè¯·æ±‚é˜Ÿ åˆ—æˆ–è€…ç¼“å­˜é˜Ÿåˆ—æ—¶ï¼Œåœ¨åå°çš„ç½‘ç»œè°ƒåº¦çº¿ç¨‹å’Œç¼“å­˜è°ƒåº¦çº¿ç¨‹è½®è¯¢å„è‡ªçš„è¯·æ±‚é˜Ÿåˆ—ï¼Œè‹¥å‘ç°æœ‰è¯·æ±‚ä»»åŠ¡åˆ™å¼€ å§‹æ‰§è¡Œã€‚ä¸‹é¢å…ˆçœ‹çœ‹ç¼“å­˜è°ƒåº¦çº¿ç¨‹ã€‚</p><p>é¦–å…ˆå…ˆæ¥çœ‹çœ‹<code>CacheDispatcher</code>çš„<code>add()</code>æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (DEBUG) </span><br><span class="line">        VolleyLog.v(<span class="string">&quot;start new dispatcher&quot;</span>);</span><br><span class="line">    Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);</span><br><span class="line">    <span class="comment">// Process.THREAD_PRIORITY_BACKGROUNDé»˜è®¤å€¼ä¸º10</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿›è¡Œé˜»å¡è°ƒç”¨ä»¥åˆå§‹åŒ–ç¼“å­˜ã€‚</span></span><br><span class="line">    mCache.initialize();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            processRequest();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="comment">// å¯èƒ½è¢«æ‰“æ–­äº†ï¼Œå› ä¸ºæ˜¯æ—¶å€™è¦é€€å‡ºäº†ã€‚</span></span><br><span class="line">            <span class="keyword">if</span> (mQuit) &#123;</span><br><span class="line">                Thread.currentThread().interrupt();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            VolleyLog.e(</span><br><span class="line">                    <span class="string">&quot;Ignoring spurious interrupt of CacheDispatcher thread; &quot;</span></span><br><span class="line">                            + <span class="string">&quot;use quit() to terminate it&quot;</span>);</span><br><span class="line">            <span class="comment">// å¿½ç•¥cachedispatcherçº¿ç¨‹çš„å‡ä¸­æ–­ï¼›</span></span><br><span class="line">            <span class="comment">// ä½¿ç”¨quitï¼ˆï¼‰ç»ˆæ­¢å®ƒ</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¿™å—å¯ä»¥çœ‹å‡ºä¸»è¦å°±æ˜¯åˆå§‹åŒ–äº†ç¼“å­˜é˜Ÿåˆ—ï¼Œç„¶åå¼€äº†ä¸ªæ­»å¾ªç¯ï¼Œä¸€ç›´è°ƒç”¨<code>processRequest()</code>ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processRequest</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="comment">// ä»CacheQueueä¸­å–å‡ºä¸€ä¸ªå¯ç”¨çš„request</span></span><br><span class="line">    <span class="keyword">final</span> Request&lt;?&gt; request = mCacheQueue.take();</span><br><span class="line">    processRequest(request);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@VisibleForTesting</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">processRequest</span><span class="params">(<span class="keyword">final</span> Request&lt;?&gt; request)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    request.addMarker(<span class="string">&quot;cache-queue-take&quot;</span>);</span><br><span class="line">    request.sendEvent(RequestQueue.RequestEvent.REQUEST_CACHE_LOOKUP_STARTED);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//requestå¦‚æœè¢«å–æ¶ˆäº†ï¼Œå°±ç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span> (request.isCanceled()) &#123;</span><br><span class="line">            request.finish(<span class="string">&quot;cache-discard-canceled&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Cache.<span class="type">Entry</span> <span class="variable">entry</span> <span class="operator">=</span> mCache.get(request.getCacheKey());</span><br><span class="line">        <span class="comment">// æ²¡æœ‰ç¼“å­˜å°±æŠŠrequestæ·»åŠ åˆ°NetworkQueueä¸­</span></span><br><span class="line">        <span class="keyword">if</span> (entry == <span class="literal">null</span>) &#123;</span><br><span class="line">            request.addMarker(<span class="string">&quot;cache-miss&quot;</span>);</span><br><span class="line">            <span class="comment">// æ²¡æœ‰ç¼“å­˜ï¼Œå¹¶ä¸”ç­‰å¾…é˜Ÿåˆ—ä¸­ä¹Ÿæ²¡æœ‰æ­¤requestï¼Œé‚£ä¹ˆå°±ç›´æ¥åŠ å…¥åˆ°NetworkQueueä¸­</span></span><br><span class="line">            <span class="keyword">if</span> (!mWaitingRequestManager.maybeAddToWaitingRequests(request)) &#123;</span><br><span class="line">                mNetworkQueue.put(request);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœç¼“å­˜è¿‡æœŸäº†ï¼Œä¹Ÿæ˜¯ä¸€æ ·æŠŠrequestæ·»åŠ åˆ°NetworkQueueä¸­</span></span><br><span class="line">        <span class="keyword">if</span> (entry.isExpired()) &#123;</span><br><span class="line">            request.addMarker(<span class="string">&quot;cache-hit-expired&quot;</span>);</span><br><span class="line">            request.setCacheEntry(entry);</span><br><span class="line">            <span class="keyword">if</span> (!mWaitingRequestManager.maybeAddToWaitingRequests(request)) &#123;</span><br><span class="line">                mNetworkQueue.put(request);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æœ‰ç¼“å­˜å¹¶ä¸”æ²¡æœ‰è¿‡æœŸ</span></span><br><span class="line">        request.addMarker(<span class="string">&quot;cache-hit&quot;</span>);</span><br><span class="line">        <span class="comment">// æ ¹æ®ç¼“å­˜çš„å†…å®¹è§£æ</span></span><br><span class="line">        Response&lt;?&gt; response =</span><br><span class="line">                request.parseNetworkResponse(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">NetworkResponse</span>(entry.data, entry.responseHeaders));</span><br><span class="line">        request.addMarker(<span class="string">&quot;cache-hit-parsed&quot;</span>);</span><br><span class="line">        <span class="comment">// æ˜¯å¦éœ€è¦æ›´æ–°</span></span><br><span class="line">        <span class="keyword">if</span> (!entry.refreshNeeded()) &#123;</span><br><span class="line">            <span class="comment">// ä¸éœ€è¦æ›´æ–°ï¼Œç›´æ¥å°†ç»“æœè°ƒåº¦åˆ°ä¸»çº¿ç¨‹</span></span><br><span class="line">            mDelivery.postResponse(request, response);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            request.addMarker(<span class="string">&quot;cache-hit-refresh-needed&quot;</span>);</span><br><span class="line">            request.setCacheEntry(entry);</span><br><span class="line">            response.intermediate = <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">// åˆ¤æ–­æ˜¯å¦æœ‰ç›¸åŒç¼“å­˜é”®çš„ä»»åŠ¡åœ¨æ‰§è¡Œ</span></span><br><span class="line">            <span class="keyword">if</span> (!mWaitingRequestManager.maybeAddToWaitingRequests(request)) &#123;</span><br><span class="line">                <span class="comment">// éœ€è¦æ›´æ–°ç»“æœï¼Œå…ˆå°†ç»“æœè°ƒåº¦åˆ°ä¸»çº¿ç¨‹ï¼Œç„¶åæ‰§è¡Œnew runnable()&#123;&#125;</span></span><br><span class="line">                <span class="comment">// runnableä¸­å°±æ˜¯å°†requestæ·»åŠ åˆ°NetworkQueueä¸­ï¼Œæ›´æ–°ä¸€ä¸‹å†…å®¹</span></span><br><span class="line">                mDelivery.postResponse(</span><br><span class="line">                        request,</span><br><span class="line">                        response,</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">                            <span class="meta">@Override</span></span><br><span class="line">                            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                                <span class="keyword">try</span> &#123;</span><br><span class="line">                                    mNetworkQueue.put(request);</span><br><span class="line">                                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                                    <span class="comment">// Restore the interrupted status</span></span><br><span class="line">                                    Thread.currentThread().interrupt();</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// requestå·²ç»åŠ å…¥åˆ°mWaitingRequestsä¸­</span></span><br><span class="line">                <span class="comment">// ç›´æ¥æŠŠç»“æœè°ƒåº¦åˆ°ä¸»çº¿ç¨‹</span></span><br><span class="line">                mDelivery.postResponse(request, response);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        request.sendEvent(RequestQueue.RequestEvent.REQUEST_CACHE_LOOKUP_FINISHED);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æˆ‘ä»¬åœ¨<code>processRequest</code>ä¸­å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªæ–¹æ³•ç»å¸¸å‡ºç°ï¼Œé‚£å°±æ˜¯<code>mWaitingRequestManager.maybeAddToWaitingRequests(request)</code>ï¼Œå®ƒçš„ä½œç”¨æ˜¯åˆ¤æ–­å½“å‰è¿™ä¸ª<code>request</code>æ˜¯å¦æœ‰å­˜åœ¨ç›¸åŒç¼“å­˜é”®çš„è¯·æ±‚å·²ç»å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœæœ‰ï¼Œé‚£ä¹ˆå°±å°†è¿™ä¸ª<code>request</code>åŠ å…¥åˆ°ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œç­‰åˆ°ç›¸åŒç¼“å­˜é”®çš„è¯·æ±‚å®Œæˆã€‚</p><p>æ€»ç»“ä¸€ä¸‹<code>CacheDispatcher</code>ä¸»è¦æ­¥éª¤ï¼š</p><ul><li>ä»<code>CacheQueue</code>ä¸­å¾ªç¯å–å‡º<code>request</code>ï¼›</li><li>å¦‚æœç¼“å­˜ä¸¢å¤±ï¼ŒåŠ å…¥åˆ°<code>NetworkQueue</code>ä¸­ï¼›</li><li>å¦‚æœç¼“å­˜è¿‡æœŸï¼ŒåŠ å…¥åˆ°<code>NetworkQueue</code>ä¸­ï¼›</li><li>å°†ç¼“å­˜ä¸­çš„æ•°æ®è§£ææˆ<code>Response</code>å¯¹è±¡ï¼›</li><li>å¦‚æœä¸éœ€è¦æ›´æ–°ï¼Œç›´æ¥å°†ç»“æœå›è°ƒåˆ°ä¸»çº¿ç¨‹ï¼Œå›è°ƒæ“ä½œç­‰ä»‹ç»å®Œ<code>NetworkDispatcher</code>ä¹‹åä¸€èµ·æ·±å…¥å‰–æï¼›</li><li>å¦‚æœéœ€è¦æ›´æ–°ï¼Œå…ˆå°†ç»“æœå›è°ƒåˆ°ä¸»çº¿ç¨‹ï¼Œç„¶åå†å°†<code>request</code>åŠ å…¥åˆ°<code>NetworkQueue</code>ä¸­ã€‚</li></ul><p>ä¸‹é¢æ¥çœ‹çœ‹ç½‘ç»œè°ƒåº¦çº¿ç¨‹ã€‚</p><h2 id="2-3-NetWorkDispatcherç½‘ç»œè°ƒåº¦çº¿ç¨‹"><a href="#2-3-NetWorkDispatcherç½‘ç»œè°ƒåº¦çº¿ç¨‹" class="headerlink" title="2.3 NetWorkDispatcherç½‘ç»œè°ƒåº¦çº¿ç¨‹"></a>2.3 NetWorkDispatcherç½‘ç»œè°ƒåº¦çº¿ç¨‹</h2><p>NetworkDispatcherçš„runæ–¹æ³•ä»£ç å¦‚ä¸‹æ‰€ç¤º:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">    Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            processRequest();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="comment">// æˆ‘ä»¬å¯èƒ½è¢«æ‰“æ–­äº†ï¼Œå› ä¸ºæ˜¯æ—¶å€™é€€å‡ºäº†ã€‚</span></span><br><span class="line">            <span class="keyword">if</span> (mQuit) &#123;</span><br><span class="line">                Thread.currentThread().interrupt();</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            VolleyLog.e(</span><br><span class="line">                    <span class="string">&quot;Ignoring spurious interrupt of NetworkDispatcher thread; &quot;</span></span><br><span class="line">                            + <span class="string">&quot;use quit() to terminate it&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ç”±æ­¤å¯ä»¥çœ‹å‡ºï¼Œ<code>NetWordDispatch</code>å’Œ<code>CacheDispatch</code>éå¸¸ç±»ä¼¼ã€‚<br>ä»–çš„<code>run()</code>æ–¹æ³•å’Œ<code>CacheDispatch</code>çš„æ–¹æ³•åŸºæœ¬ä¸€æ ·ï¼Œè¿™å°±ä¸å¤šåšä»‹ç»ï¼Œä¸‹é¢æ¥çœ‹çœ‹ä»–çš„<code>processRequest()</code>æ–¹æ³•ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processRequest</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="comment">// ä»NetworkQueueä¸­å–å‡ºrequest</span></span><br><span class="line">    Request&lt;?&gt; request = mQueue.take();</span><br><span class="line">    processRequest(request);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@VisibleForTesting</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">processRequest</span><span class="params">(Request&lt;?&gt; request)</span> &#123;</span><br><span class="line">    <span class="type">long</span> <span class="variable">startTimeMs</span> <span class="operator">=</span> SystemClock.elapsedRealtime();</span><br><span class="line">    request.sendEvent(RequestQueue.RequestEvent.REQUEST_NETWORK_DISPATCH_STARTED);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        request.addMarker(<span class="string">&quot;network-queue-take&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœrequestè¢«å–æ¶ˆäº†ï¼Œé‚£ä¹ˆå°±ä¸æ‰§è¡Œæ­¤request</span></span><br><span class="line">        <span class="keyword">if</span> (request.isCanceled()) &#123;</span><br><span class="line">            request.finish(<span class="string">&quot;network-discard-cancelled&quot;</span>);</span><br><span class="line">            request.notifyListenerResponseNotUsable();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        addTrafficStatsTag(request);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿˜è®°å¾—è¿™ä¸ªmNetworkä¹ˆï¼Œå®ƒå°±æ˜¯Volley.newRequestQueue()æ–¹æ³•é‡Œçš„BasicNetworkå¯¹è±¡ï¼Œä¸€ä¼šæˆ‘ä»¬æ¥çœ‹çœ‹mNetwork.performRequest()æ–¹æ³•æ˜¯å¦‚ä½•å¾—åˆ°NetworkResponseçš„</span></span><br><span class="line">        <span class="type">NetworkResponse</span> <span class="variable">networkResponse</span> <span class="operator">=</span> mNetwork.performRequest(request);</span><br><span class="line">        request.addMarker(<span class="string">&quot;network-http-complete&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// notModifiedæ˜¯æœåŠ¡ç«¯è¿”å›304ï¼ŒhasHadResponseDelivered()æ˜¯requestå·²ç»å›è°ƒè¿‡äº†</span></span><br><span class="line">        <span class="keyword">if</span> (networkResponse.notModified &amp;&amp; request.hasHadResponseDelivered()) &#123;</span><br><span class="line">            request.finish(<span class="string">&quot;not-modified&quot;</span>);</span><br><span class="line">            request.notifyListenerResponseNotUsable();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†NetworkResponseè§£ææˆResponseå¯¹è±¡ï¼Œåœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œ</span></span><br><span class="line">        Response&lt;?&gt; response = request.parseNetworkResponse(networkResponse);</span><br><span class="line">        request.addMarker(<span class="string">&quot;network-parse-complete&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†requestå†™å…¥ç¼“å­˜</span></span><br><span class="line">        <span class="keyword">if</span> (request.shouldCache() &amp;&amp; response.cacheEntry != <span class="literal">null</span>) &#123;</span><br><span class="line">            mCache.put(request.getCacheKey(), response.cacheEntry);</span><br><span class="line">            request.addMarker(<span class="string">&quot;network-cache-written&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        request.markDelivered();</span><br><span class="line">        <span class="comment">// å›è°ƒç»“æœè‡³ä¸»çº¿ç¨‹</span></span><br><span class="line">        mDelivery.postResponse(request, response);</span><br><span class="line">        request.notifyListenerResponseReceived(response);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">// ä»¥ä¸‹éƒ½æ˜¯å¤„ç†å¼‚å¸¸é”™è¯¯ï¼Œç„¶åä¹Ÿéœ€è¦å›è°ƒè‡³ä¸»çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">catch</span> (VolleyError volleyError) &#123;</span><br><span class="line">        volleyError.setNetworkTimeMs(SystemClock.elapsedRealtime() - startTimeMs);</span><br><span class="line">        parseAndDeliverNetworkError(request, volleyError);</span><br><span class="line">        request.notifyListenerResponseNotUsable();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        VolleyLog.e(e, <span class="string">&quot;Unhandled exception %s&quot;</span>, e.toString());</span><br><span class="line">        <span class="type">VolleyError</span> <span class="variable">volleyError</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VolleyError</span>(e);</span><br><span class="line">        volleyError.setNetworkTimeMs(SystemClock.elapsedRealtime() - startTimeMs);</span><br><span class="line">        mDelivery.postError(request, volleyError);</span><br><span class="line">        request.notifyListenerResponseNotUsable();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        request.sendEvent(RequestQueue.RequestEvent.REQUEST_NETWORK_DISPATCH_FINISHED);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>é€šè¿‡<code>NetworkDispatcher.processRequest()</code>æ–¹æ³•å¯ä»¥å‘ç°ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š</p><ul><li>é€šè¿‡<code>BasicNetwork.performRequest(request)</code>å¾—åˆ°<code>NetworkResponse</code>å¯¹è±¡ï¼›</li><li>é€šè¿‡<code>request.parseNetworkResponse(networkResponse)</code>è§£æå¾—åˆ°<code>Response</code>å¯¹è±¡ï¼›</li><li>é€šè¿‡<code>mDelivery</code>å°†æˆåŠŸç»“æœæˆ–è€…å¤±è´¥ç»“æœå›è°ƒåˆ°ä¸»çº¿ç¨‹ã€‚</li></ul><p>ç°åœ¨æˆ‘ä»¬ä¾æ¬¡æ¥åˆ†æè¿™ä¸‰æ­¥ï¼š</p><ul><li>è¯·æ±‚ç½‘ç»œï¼Œå¾—åˆ°<code>NetworkResponse</code><br>  æˆ‘ä»¬çœ‹çœ‹<code>BasicNetwork</code>çš„<code>performRequest()</code>æ–¹æ³•ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> NetworkResponse <span class="title function_">performRequest</span><span class="params">(Request&lt;?&gt; request)</span> <span class="keyword">throws</span> VolleyError &#123;</span><br><span class="line">    <span class="type">long</span> <span class="variable">requestStart</span> <span class="operator">=</span> SystemClock.elapsedRealtime();</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="type">HttpResponse</span> <span class="variable">httpResponse</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">byte</span>[] responseContents = <span class="literal">null</span>;</span><br><span class="line">        List&lt;Header&gt; responseHeaders = Collections.emptyList();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Gather headers.</span></span><br><span class="line">            Map&lt;String, String&gt; additionalRequestHeaders =</span><br><span class="line">                    getCacheHeaders(request.getCacheEntry());</span><br><span class="line">            httpResponse = mBaseHttpStack.executeRequest(request, additionalRequestHeaders);</span><br><span class="line">            <span class="type">int</span> <span class="variable">statusCode</span> <span class="operator">=</span> httpResponse.getStatusCode();</span><br><span class="line"></span><br><span class="line">            responseHeaders = httpResponse.getHeaders();</span><br><span class="line">            <span class="comment">// Handle cache validation.</span></span><br><span class="line">            <span class="keyword">if</span> (statusCode == HttpURLConnection.HTTP_NOT_MODIFIED) &#123;</span><br><span class="line">                <span class="type">Entry</span> <span class="variable">entry</span> <span class="operator">=</span> request.getCacheEntry();</span><br><span class="line">                <span class="keyword">if</span> (entry == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">NetworkResponse</span>(</span><br><span class="line">                            HttpURLConnection.HTTP_NOT_MODIFIED,</span><br><span class="line">                            <span class="comment">/* data= */</span> <span class="literal">null</span>,</span><br><span class="line">                            <span class="comment">/* notModified= */</span> <span class="literal">true</span>,</span><br><span class="line">                            SystemClock.elapsedRealtime() - requestStart,</span><br><span class="line">                            responseHeaders);</span><br><span class="line">            &#125;</span><br><span class="line">                    â€¦â€¦â€¦â€¦çœç•¥</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢æºç å¯ä»¥çœ‹å‡ºï¼Œ<code>BasicNetwork</code>å°±æ˜¯å°è£…äº†ä¸€ä¸‹<code>NetworkResponse</code>ï¼Œå¹¶æ²¡æœ‰æ¶‰åŠåˆ°ç½‘ç»œè¯·æ±‚ï¼Œæˆ‘ä»¬ç»§ç»­æ·±å…¥åˆ°<code>BaseHttpStack.executeRequest(request, additionalRequestHeaders)</code>æºç ä¸­ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> HttpResponse <span class="title function_">executeRequest</span><span class="params">(</span></span><br><span class="line"><span class="params">        Request&lt;?&gt; request, Map&lt;String, String&gt; additionalHeaders)</span></span><br><span class="line">        <span class="keyword">throws</span> IOException, AuthFailureError;</span><br></pre></td></tr></table></figure><br>è¿™æ—¶å‘ç°è¿™ä¸ª<code>BaseHttpStack</code>å°±æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œè€Œè¿™ä¸ª<code>executeRequest()</code>ä¹Ÿå°±æ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ã€‚æˆ‘å½“æ—¶å°±å¡åœ¨è¿™äº†ï¼Œè°ƒç”¨äº†ä¸€ä¸ªæŠ½è±¡ç±»çš„æŠ½è±¡æ–¹æ³•ï¼Œè¿™å’‹æ“ä½œå˜›ã€‚ç„¶åæˆ‘å°±å¥½å¥½å†çœ‹äº†ä¸€éï¼Œæ‰¾åˆ°<code>BasicNetwork</code>çš„æ„é€ å‡½æ•°ä¸­å¯¹<code>mBaseHttpStck</code>å®šä¹‰çš„åœ°æ–¹ï¼Œå‘ç°è¿™ä¸ªæ˜¯æ„é€ å‡½æ•°ä¼ è¿›æ¥çš„ï¼Œç„¶åå°±æƒ³åˆ°äº†åœ¨è°ƒç”¨<code>Volley.newRequestQueue()</code>æ—¶ï¼Œæ˜¯æ ¹æ®Androidç‰ˆæœ¬ä¼ å…¥äº†ä¸åŒçš„<code>Stack</code>ï¼Œé‚£æˆ‘ä»¬å°±æ¥çœ‹çœ‹<code>HurlStack.executeRequest()</code>æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> HttpResponse <span class="title function_">executeRequest</span><span class="params">(Request&lt;?&gt; request, Map&lt;String, String&gt; additionalHeaders)</span></span><br><span class="line">        <span class="keyword">throws</span> IOException, AuthFailureError &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> request.getUrl();</span><br><span class="line">    HashMap&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.putAll(additionalHeaders);</span><br><span class="line">    <span class="comment">// request.getheadersï¼ˆï¼‰ä¼˜å…ˆäºç»™å®šçš„é™„åŠ ï¼ˆç¼“å­˜ï¼‰å¤´.</span></span><br><span class="line">    map.putAll(request.getHeaders());</span><br><span class="line">    <span class="keyword">if</span> (mUrlRewriter != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">rewritten</span> <span class="operator">=</span> mUrlRewriter.rewriteUrl(url);</span><br><span class="line">        <span class="keyword">if</span> (rewritten == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IOException</span>(<span class="string">&quot;URL blocked by rewriter: &quot;</span> + url);</span><br><span class="line">        &#125;</span><br><span class="line">        url = rewritten;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">URL</span> <span class="variable">parsedUrl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(url);</span><br><span class="line">    <span class="type">HttpURLConnection</span> <span class="variable">connection</span> <span class="operator">=</span> openConnection(parsedUrl, request);</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">keepConnectionOpen</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (String headerName : map.keySet()) &#123;</span><br><span class="line">            connection.setRequestProperty(headerName, map.get(headerName));</span><br><span class="line">        &#125;</span><br><span class="line">        setConnectionParametersForRequest(connection, request);</span><br><span class="line">        <span class="comment">// ä½¿ç”¨æ¥è‡ªhttpurlConnectionçš„æ•°æ®åˆå§‹åŒ–httpResponseã€‚</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">responseCode</span> <span class="operator">=</span> connection.getResponseCode();</span><br><span class="line">        <span class="keyword">if</span> (responseCode == -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœæ— æ³•æ£€ç´¢å“åº”ä»£ç ï¼ŒgetResponseCodeï¼ˆï¼‰å°†è¿”å›-1ã€‚</span></span><br><span class="line">            <span class="comment">// å‘å‘¼å«è€…å‘å‡ºä¿¡å·ï¼Œè¯´æ˜è¿æ¥æœ‰é—®é¢˜ã€‚</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IOException</span>(<span class="string">&quot;Could not retrieve response code from HttpUrlConnection.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!hasResponseBody(request.getMethod(), responseCode)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HttpResponse</span>(responseCode, convertHeaders(connection.getHeaderFields()));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// éœ€è¦ä¿æŒè¿æ¥æ‰“å¼€ï¼Œç›´åˆ°è°ƒç”¨æ–¹ä½¿ç”¨æµã€‚åŒ…è£…æµï¼Œä»¥ä¾¿closeï¼ˆï¼‰å°†æ–­å¼€è¿æ¥ã€‚</span></span><br><span class="line">        keepConnectionOpen = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HttpResponse</span>(</span><br><span class="line">                responseCode,</span><br><span class="line">                convertHeaders(connection.getHeaderFields()),</span><br><span class="line">                connection.getContentLength(),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">UrlConnectionInputStream</span>(connection));</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!keepConnectionOpen) &#123;</span><br><span class="line">            connection.disconnect();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å¯ä»¥çœ‹åˆ°ï¼Œä¸»è¦å°±æ˜¯å€ŸåŠ©äº†<code>HttpURLConnection</code>å¯¹è±¡æ¥è¯·æ±‚ç½‘ç»œï¼Œå¹¶æ ¹æ®ä¸åŒçš„æ¡ä»¶è¿”å›ä¸åŒçš„<code>HttpResponse</code>å¯¹è±¡ã€‚</p><ul><li>è§£æ<code>NetworkResponse</code>, å¾—åˆ°<code>Response</code>ï¼š<br>è§£æè¿‡ç¨‹æ˜¯å®šä¹‰åœ¨<code>Request</code>ç±»ä¸­ï¼Œä½†æ˜¯ä»–æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¸åŒçš„Requestéƒ½æœ‰è‡ªå·±çš„å®ç°ï¼Œæˆ‘ä»¬ç°åœ¨å°±ä»¥JsonRequestä¸ºä¾‹çœ‹çœ‹ï¼š<br>ç„¶åå‘ç°ä»–åˆæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œé‚£æˆ‘ä»¬å°±çœ‹çœ‹<code>JsonRequest</code>å…¶ä¸­ä¸€ä¸ªå®ç°ç±»<code>JsonObjectRequest</code>çš„<code>parseNetworkResponse()</code>æ–¹æ³•ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> Response&lt;JSONObject&gt; <span class="title function_">parseNetworkResponse</span><span class="params">(NetworkResponse response)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonString</span> <span class="operator">=</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">String</span>(</span><br><span class="line">                        response.data,</span><br><span class="line">                        HttpHeaderParser.parseCharset(response.headers, PROTOCOL_CHARSET));</span><br><span class="line">        <span class="keyword">return</span> Response.success(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">JSONObject</span>(jsonString), HttpHeaderParser.parseCacheHeaders(response));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">        <span class="keyword">return</span> Response.error(<span class="keyword">new</span> <span class="title class_">ParseError</span>(e));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (JSONException je) &#123;</span><br><span class="line">        <span class="keyword">return</span> Response.error(<span class="keyword">new</span> <span class="title class_">ParseError</span>(je));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå°±ä¸ç”¨å¤šè¯´äº†ï¼Œæ ¹æ®è¿”å›æ¥çš„<code>response</code>å»ºäº†ä¸€ä¸ª<code>String</code>ç„¶åæŠŠè¿™ä¸ª<code>String</code>æ”¾åˆ°<code>Response</code>é‡Œé¢å»ç„¶åå†è¿”å›å»ã€‚</p><ul><li>å›è°ƒä¸»çº¿ç¨‹<br>å›è°ƒä¸»è¦æ˜¯é€šè¿‡<code>Delivery</code>çš„<code>postResponse()</code>æ–¹æ³•å®ç°çš„ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•,æ‰¾è¿‡å»åˆæ‰¾åˆ°äº†ä¸€ä¸ª<code>ResponseDelivery</code>æŠ½è±¡ç±»ï¼Œç„¶ååˆå¾—æ‰¾ä»–çš„å®ç°ç±»ï¼Œè¿™æ—¶å¤§å®¶åº”è¯¥è®°å¾—<code>RequestQueue()</code>çš„æ—¶å€™åˆå§‹åŒ–äº†ä¸€ä¸ª<code>Delivery</code>ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">RequestQueue</span><span class="params">(Cache cache, Network network, <span class="type">int</span> threadPoolSize)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>(</span><br><span class="line">            cache,</span><br><span class="line">            network,</span><br><span class="line">            threadPoolSize,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ExecutorDelivery</span>(<span class="keyword">new</span> <span class="title class_">Handler</span>(Looper.getMainLooper())));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»–è¿”å›äº†ä¸€ä¸ª<code>ExecutorDelivery</code>ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªç±»ï¼Œç„¶åå°±æƒŠå–œçš„å‘ç°ï¼Œæˆ‘ä»¬ç»ˆäºæ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„ä¸œè¥¿äº†ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Creates a new response delivery interface.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> handler &#123;<span class="doctag">@link</span> Handler&#125; to post responses on</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ExecutorDelivery</span><span class="params">(<span class="keyword">final</span> Handler handler)</span> &#123;</span><br><span class="line">    <span class="comment">// Make an Executor that just wraps the handler.</span></span><br><span class="line">    mResponsePoster =</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Executor</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(Runnable command)</span> &#123;</span><br><span class="line">                        handler.post(command);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>çŸ¥é“äº†å®ƒçš„åˆå§‹åŒ–ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å®ç°å›è°ƒçš„ï¼š</p><p><code>Volley</code>ä¸­å›è°ƒæ˜¯é€šè¿‡<code>postResponse()</code>æ–¹æ³•çš„ :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postResponse</span><span class="params">(Request&lt;?&gt; request, Response&lt;?&gt; response)</span> &#123;</span><br><span class="line">    postResponse(request, response, <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postResponse</span><span class="params">(Request&lt;?&gt; request, Response&lt;?&gt; response, Runnable runnable)</span> &#123;</span><br><span class="line">    request.markDelivered();</span><br><span class="line">    request.addMarker(<span class="string">&quot;post-response&quot;</span>);</span><br><span class="line">    mResponsePoster.execute(<span class="keyword">new</span> <span class="title class_">ResponseDeliveryRunnable</span>(request, response, runnable));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>postResponse()</code>æœ€ç»ˆä¼šè°ƒç”¨<code>mResponsePoster</code>å¯¹è±¡çš„<code>execute()</code>æ–¹æ³•ï¼Œä¼ å…¥äº†ä¸€ä¸ª<code>ResponseDeliveryRunnable</code>å¯¹è±¡ï¼Œå®ƒå®ç°äº†<code>Runnable</code>æ¥å£ï¼Œ<code>execute()</code>æ–¹æ³•ä¼šé€šè¿‡<code>Handler.post(runnable)</code>å°†<code>ResponseDeliveryRunnable</code>æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—ã€‚æœ€åæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ª<code>ResponseDeliveryRunnable</code>çš„<code>run()</code>æ–¹æ³•åœ¨ä¸»çº¿ç¨‹ä¸­åšäº†ä»€ä¹ˆæ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If this request has canceled, finish it and don&#x27;t deliver.</span></span><br><span class="line">    <span class="keyword">if</span> (mRequest.isCanceled()) &#123;</span><br><span class="line">        mRequest.finish(<span class="string">&quot;canceled-at-delivery&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (mResponse.isSuccess()) &#123;</span><br><span class="line">        <span class="comment">// æ‰§è¡ŒæˆåŠŸçš„å›è°ƒï¼Œåœ¨å…·ä½“çš„Requestå®ç°ç±»ä¸­ï¼Œæ¯”å¦‚StringRequestå°±ä¼šè°ƒç”¨listener.onResponse(string)å›è°ƒ</span></span><br><span class="line">        mRequest.deliverResponse(mResponse.result);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// æ‰§è¡Œå¤±è´¥çš„å›è°ƒï¼Œåœ¨requestä¸­ï¼Œç›´æ¥å›è°ƒäº†listener.onErrorResponse(error)</span></span><br><span class="line">        mRequest.deliverError(mResponse.error);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// intermediateé»˜è®¤ä¸ºfalseï¼Œä½†æ˜¯åœ¨CacheDispatcherçš„run()ä¸­ï¼Œå¦‚æœéœ€è¦æ›´æ–°ç¼“å­˜ï¼Œé‚£ä¹ˆå°±ä¼šç½®ä¸ºtrue</span></span><br><span class="line">    <span class="keyword">if</span> (mResponse.intermediate) &#123;</span><br><span class="line">        mRequest.addMarker(<span class="string">&quot;intermediate-response&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        mRequest.finish(<span class="string">&quot;done&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœä¼ å…¥äº†runnableä¸ä¸ºç©ºï¼Œé‚£å°±å°±æ‰§è¡Œrunnable.run()æ–¹æ³•</span></span><br><span class="line">    <span class="comment">// å›å¿†ä¸‹åœ¨CacheDispatcherçš„run()æ–¹æ³•ä¸­ï¼Œå¦‚æœrequestæœ‰ç¼“å­˜ï¼Œä½†æ˜¯éœ€è¦æ›´æ–°ç¼“å­˜çš„æ—¶å€™ï¼ŒmDeliveryæ˜¯ä¸æ˜¯è°ƒç”¨çš„å¸¦runnableçš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">if</span> (mRunnable != <span class="literal">null</span>) &#123;</span><br><span class="line">        mRunnable.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="3-è¯·æ±‚æµç¨‹å›¾"><a href="#3-è¯·æ±‚æµç¨‹å›¾" class="headerlink" title="3 è¯·æ±‚æµç¨‹å›¾"></a>3 è¯·æ±‚æµç¨‹å›¾</h1><p>æœ€åé™„ä¸ŠVolleyçš„è¯·æ±‚æµç¨‹å›¾<br><img src="https://cdn.littlecorgi.top/mweb/2019-07-23/VolleyRequestProcess.jpg" alt="VolleyRequestProcess"></p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Android/">Android</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E6%BA%90%E7%A0%81/">æºç </category>
      
      <category domain="https://www.littlecorgi.top/tags/kotlin/">kotlin</category>
      
      <category domain="https://www.littlecorgi.top/tags/Volley/">Volley</category>
      
      
      <comments>https://www.littlecorgi.top/posts/df8fd75e.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>æ“ä½œç³»ç»Ÿ2--è¿›ç¨‹çš„æè¿°å’Œæ§åˆ¶</title>
      <link>https://www.littlecorgi.top/posts/2e847144.html</link>
      <guid>https://www.littlecorgi.top/posts/2e847144.html</guid>
      <pubDate>Sun, 21 Jul 2019 14:12:36 GMT</pubDate>
      
      <description>&lt;blockquote&gt;
&lt;p&gt;å¤§å®¶å¯ä»¥çœ‹ä¸‹æˆ‘ä½¿ç”¨å¹•å¸ƒè½¯ä»¶ç”»çš„&lt;a href=&quot;https://mubu.com/doc/3Pf0zwzrgw&quot;&gt;æ€ç»´å¯¼å›¾&lt;/a&gt;ï¼Œå¦‚æœå¤§å®¶æƒ³ä½¿ç”¨å¹•å¸ƒå¯ä»¥é€šè¿‡æˆ‘çš„é‚€è¯·é“¾æ¥æ³¨å†Œï¼Œå¯å…è´¹è·å¾—ä¸€ä¸ªæœˆé«˜çº§ä¼šå‘˜&lt;a href=&quot;https://mubu.com/inv/477598&quot;&gt;https://mubu.com/inv/477598&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>å¤§å®¶å¯ä»¥çœ‹ä¸‹æˆ‘ä½¿ç”¨å¹•å¸ƒè½¯ä»¶ç”»çš„<a href="https://mubu.com/doc/3Pf0zwzrgw">æ€ç»´å¯¼å›¾</a>ï¼Œå¦‚æœå¤§å®¶æƒ³ä½¿ç”¨å¹•å¸ƒå¯ä»¥é€šè¿‡æˆ‘çš„é‚€è¯·é“¾æ¥æ³¨å†Œï¼Œå¯å…è´¹è·å¾—ä¸€ä¸ªæœˆé«˜çº§ä¼šå‘˜<a href="https://mubu.com/inv/477598">https://mubu.com/inv/477598</a></p></blockquote><span id="more"></span><p>[TOC]</p><h1 id="2-1-è¿›ç¨‹çš„æè¿°"><a href="#2-1-è¿›ç¨‹çš„æè¿°" class="headerlink" title="2.1 è¿›ç¨‹çš„æè¿°"></a>2.1 è¿›ç¨‹çš„æè¿°</h1><h2 id="2-1-1-è¿›ç¨‹çš„å®šä¹‰å’Œç‰¹å¾"><a href="#2-1-1-è¿›ç¨‹çš„å®šä¹‰å’Œç‰¹å¾" class="headerlink" title="2.1.1 è¿›ç¨‹çš„å®šä¹‰å’Œç‰¹å¾"></a>2.1.1 è¿›ç¨‹çš„å®šä¹‰å’Œç‰¹å¾</h2><h3 id="2-1-1-1-è¿›ç¨‹çš„å®šä¹‰"><a href="#2-1-1-1-è¿›ç¨‹çš„å®šä¹‰" class="headerlink" title="2.1.1.1 è¿›ç¨‹çš„å®šä¹‰"></a>2.1.1.1 è¿›ç¨‹çš„å®šä¹‰</h3><p>ä¸ºäº†èƒ½å¤Ÿä½¿ç¨‹åºå¹¶å‘æ‰§è¡Œï¼Œå¹¶ä¸”å¯ä»¥å¯¹å¹¶å‘æ‰§è¡Œçš„ç¨‹åºåŠ ä»¥æè¿°å’Œæ§åˆ¶ï¼Œäººä»¬å¼•å…¥äº†â€œè¿›ç¨‹â€çš„æ¦‚å¿µã€‚<br>ä¸ºäº†ä½¿å‚ä¸å¹¶å‘æ‰§è¡Œçš„æ¯ä¸ªç¨‹åºéƒ½èƒ½ç‹¬ç«‹åœ°è¿è¡Œï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»ä¸ºä¹‹é…ç½®ä¸€ä¸ªä¸“é—¨çš„æ•°æ®ç»“æ„ï¼Œç§°ä¸º<strong>è¿›ç¨‹æ•°æ®å—ï¼ˆPCBï¼‰</strong>ã€‚ä»–ç”¨æ¥çºªå½•è¿›ç¨‹çš„å„ç§å±æ€§ï¼Œæè¿°è¿›ç¨‹çš„åŠ¨æ€å˜åŒ–è¿‡ç¨‹ã€‚ä¸»è¦åŒ…å«æœ‰è¿›ç¨‹çš„æè¿°ä¿¡æ¯ï¼ˆè¿›ç¨‹æ ‡è¯†ç¬¦ï¼Œè¿›ç¨‹åï¼Œç”¨æˆ·æ ‡è¯†ç¬¦ï¼Œè¿›ç¨‹ç»„å…³ç³»ç­‰ï¼‰ã€è¿›ç¨‹æ§åˆ¶ä¿¡æ¯ï¼ˆå½“å‰çŠ¶æ€ï¼Œä¼˜å…ˆçº§ï¼Œä»£ç æ‰§è¡Œå…¥å£åœ°å€ï¼Œä¿å­˜çš„ç£ç›˜åœ°å€ç­‰ç­‰ï¼‰ã€æ‰€æ‹¥æœ‰çš„èµ„æºå’Œä½¿ç”¨æƒ…å†µï¼ˆè™šæ‹Ÿåœ°å€ç©ºé—´çš„çŠ¶æ€ï¼Œæ–‡ä»¶æ‰“å¼€åˆ—è¡¨ç­‰ï¼‰å’ŒCPUç°åœºä¿¡æ¯ç­‰å†…å®¹ã€‚PCBæ˜¯ç³»ç»Ÿæ„ŸçŸ¥è¿›ç¨‹å­˜åœ¨çš„å”¯ä¸€æ ‡å¿—ã€‚<br>æ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æŠŠè¿›ç¨‹å®ä½“å°±ç®€ç§°ä¸ºè¿›ç¨‹ï¼Œåˆ›å»ºè¿›ç¨‹ï¼Œå®è´¨ä¸Šæ˜¯åˆ›å»ºè¿›ç¨‹å®ä½“ä¸­çš„PCBï¼›æ’¤é”€è¿›ç¨‹ï¼Œå®è´¨ä¸Šæ˜¯æ’¤é”€è¿›ç¨‹çš„PCBã€‚<br>å¯¹äºè¿›ç¨‹çš„å®šä¹‰ï¼Œæ¯”è¾ƒå…¸å‹çš„æœ‰ï¼š</p><ol><li>è¿›ç¨‹æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œ</li><li>è¿›ç¨‹æ˜¯ä¸€ä¸ªç¨‹åºåŠå…¶æ•°æ®åœ¨å¤„ç†æœºä¸Šé¡ºåºæ‰§è¡Œæ—¶æ‰€å‘ç”Ÿçš„æ´»åŠ¨</li><li>è¿›ç¨‹æ˜¯å…·æœ‰ç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºåœ¨ä¸€ä¸ªæ•°æ®é›†åˆä¸Šè¿è¡Œçš„è¿‡ç¨‹ï¼Œå®ƒæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„ä¸€ä¸ªç‹¬ç«‹å•ä½</li></ol><h3 id="2-1-1-2-è¿›ç¨‹çš„ç‰¹å¾"><a href="#2-1-1-2-è¿›ç¨‹çš„ç‰¹å¾" class="headerlink" title="2.1.1.2 è¿›ç¨‹çš„ç‰¹å¾"></a>2.1.1.2 è¿›ç¨‹çš„ç‰¹å¾</h3><ol><li>ç»“æ„æ€§<br>è¿›ç¨‹å®ä½“æ˜¯ç”±ç¨‹åºæ®µã€æ•°æ®æ®µåŠè¿›ç¨‹æ§åˆ¶å¿«ä¸‰éƒ¨åˆ†ç»„æˆã€‚</li><li>åŠ¨æ€æ€§<br>è¿›ç¨‹çš„å®è´¨æ˜¯è¿›ç¨‹å®ä½“çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œè€Œä¸”è¿›ç¨‹â€œç”±åˆ›å»ºè€Œäº§ç”Ÿï¼Œç”±è°ƒåº¦è€Œæ‰§è¡Œï¼Œç”±æ’¤é”€è€Œæ¶ˆäº¡â€ã€‚</li><li>å¹¶å‘æ€§<br>å¤šä¸ªè¿›ç¨‹å®ä½“åŒå­˜äºå†…å­˜ä¸­ï¼Œä¸”èƒ½åœ¨ä¸€æ®µæ—¶é—´å†…åŒæ—¶è¿è¡Œã€‚</li><li>ç‹¬ç«‹æ€§<br>è¿›ç¨‹å®ä½“æ˜¯ä¸€ä¸ªèƒ½ç‹¬ç«‹è¿è¡Œã€ç‹¬ç«‹è·å¾—èµ„æºå’Œç‹¬ç«‹æ¥æ”¶è°ƒåº¦çš„åŸºæœ¬å•ä½ã€‚</li><li>å¼‚æ­¥æ€§<br>è¿›ç¨‹æ˜¯æŒ‰å¼‚æ­¥æ–¹å¼è¿è¡Œçš„ã€‚</li></ol><h2 id="2-1-2-è¿›ç¨‹çš„åŸºæœ¬çŠ¶æ€åŠè½¬æ¢"><a href="#2-1-2-è¿›ç¨‹çš„åŸºæœ¬çŠ¶æ€åŠè½¬æ¢" class="headerlink" title="2.1.2 è¿›ç¨‹çš„åŸºæœ¬çŠ¶æ€åŠè½¬æ¢"></a>2.1.2 è¿›ç¨‹çš„åŸºæœ¬çŠ¶æ€åŠè½¬æ¢</h2><h3 id="2-1-2-1-è¿›ç¨‹çš„ä¸‰ç§åŸºæœ¬çŠ¶æ€"><a href="#2-1-2-1-è¿›ç¨‹çš„ä¸‰ç§åŸºæœ¬çŠ¶æ€" class="headerlink" title="2.1.2.1 è¿›ç¨‹çš„ä¸‰ç§åŸºæœ¬çŠ¶æ€"></a>2.1.2.1 è¿›ç¨‹çš„ä¸‰ç§åŸºæœ¬çŠ¶æ€</h3><p>è¿›ç¨‹ä¸»è¦åˆ†ä¸ºä¸‰ç§åŸºæœ¬çŠ¶æ€ï¼š</p><ol><li>è¿è¡Œæ€<br>æŒ‡è¿›ç¨‹å·²ç»è·å¾—äº†CPUï¼Œä»–æ­£åœ¨CPUä¸Šæ‰§è¡Œã€‚</li><li>å°±ç»ªæ€<br>æŒ‡è¿›ç¨‹å·²ç»å‡†å¤‡å°±ç»ªï¼Œå‡†å¤‡å¥½äº†è¢«CPUæ‰§è¡Œçš„çŠ¶æ€ã€‚å¦‚æœç³»ç»Ÿä¸­æœ‰å¾ˆå¤šå¤„äºå°±ç»ªæ€çš„è¿›ç¨‹ï¼Œé€šå¸¸æŠŠä»–ä»¬æŒ‰ä¸€å®šçš„ç­–ç•¥æ’æˆä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¿™ä¸ªé˜Ÿåˆ—ç§°ä¸ºå°±ç»ªé˜Ÿåˆ—ã€‚</li><li>ç­‰å¾…æ€<br>æŒ‡æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ç”±äºå‘ç”ŸæŸäº‹ä»¶ï¼ˆå¦‚I/Oè¯·æ±‚ã€ç”³è¯·ç¼“å†²åŒºå¤±è´¥ç­‰é—®é¢˜ï¼‰æš‚æ—¶æ— æ³•ç»§ç»­æ‰§è¡Œæ—¶çš„çŠ¶æ€ã€‚æ­¤æ—¶å¼•èµ·è¿›ç¨‹è°ƒåº¦ï¼ŒOSæŠŠå¤„ç†æœºåˆ†é…ç»™å°±ç»ªä¸­çš„è¿›ç¨‹ï¼Œè®©å—é˜»çš„è¿›ç¨‹å¤„äºé˜»å¡çŠ¶æ€ã€‚</li></ol><h3 id="2-1-2-2-ä¸‰ç§çŠ¶æ€çš„è½¬æ¢"><a href="#2-1-2-2-ä¸‰ç§çŠ¶æ€çš„è½¬æ¢" class="headerlink" title="2.1.2.2 ä¸‰ç§çŠ¶æ€çš„è½¬æ¢"></a>2.1.2.2 ä¸‰ç§çŠ¶æ€çš„è½¬æ¢</h3><p><img src="https://cdn.littlecorgi.top/mweb/2019-07-20/UntitledDiagram.jpg" alt="ä¸‰ç§çŠ¶æ€çš„è½¬æ¢"></p><h3 id="2-1-2-3-åˆ›å»ºçŠ¶æ€å’Œç»ˆæ­¢çŠ¶æ€"><a href="#2-1-2-3-åˆ›å»ºçŠ¶æ€å’Œç»ˆæ­¢çŠ¶æ€" class="headerlink" title="2.1.2.3 åˆ›å»ºçŠ¶æ€å’Œç»ˆæ­¢çŠ¶æ€"></a>2.1.2.3 åˆ›å»ºçŠ¶æ€å’Œç»ˆæ­¢çŠ¶æ€</h3><p>ä¸ºäº†æ»¡è¶³è¿›ç¨‹æ§åˆ¶å—å¯¹æ•°æ®åŠæ“ä½œçš„å®Œæ•´æ€§è¦æ±‚ä»¥åŠå¢å¼ºç®¡ç†çš„çµæ´»æ€§ï¼Œé€šå¸¸åœ¨ç³»ç»Ÿä¸­åˆä¸ºè¿›ç¨‹å¼•å…¥äº†ä¸¤ç§å¸¸è§çš„çŠ¶æ€ï¼šåˆ›å»ºçŠ¶æ€å’Œç»ˆæ­¢çŠ¶æ€ã€‚<br><img src="https://cdn.littlecorgi.top/mweb/2019-07-20/wuzhongzhuangtaizhuanhuan.png" alt="äº”ç§çŠ¶æ€è½¬æ¢"></p><h2 id="2-1-3-è¿›ç¨‹ç®¡ç†ä¸­çš„æ•°æ®ç»“æ„"><a href="#2-1-3-è¿›ç¨‹ç®¡ç†ä¸­çš„æ•°æ®ç»“æ„" class="headerlink" title="2.1.3 è¿›ç¨‹ç®¡ç†ä¸­çš„æ•°æ®ç»“æ„"></a>2.1.3 è¿›ç¨‹ç®¡ç†ä¸­çš„æ•°æ®ç»“æ„</h2><p>åœ¨æœ€å¼€å§‹æˆ‘å·²ç»ç»æåˆ°äº†è¿›ç¨‹æ§åˆ¶å—PCBè¿™ä¸ªä¸œè¥¿ï¼Œç°åœ¨æˆ‘ä»¬å°±è¿›ä¸€æ­¥æ¥äº†è§£ä»–ã€‚</p><h3 id="2-1-3-1-è¿›ç¨‹æ§åˆ¶å—ä¸­çš„ä½œç”¨"><a href="#2-1-3-1-è¿›ç¨‹æ§åˆ¶å—ä¸­çš„ä½œç”¨" class="headerlink" title="2.1.3.1 è¿›ç¨‹æ§åˆ¶å—ä¸­çš„ä½œç”¨"></a>2.1.3.1 è¿›ç¨‹æ§åˆ¶å—ä¸­çš„ä½œç”¨</h3><p>PCBçš„ä½œç”¨ä¸»è¦å°±æ˜¯ä½¿ä¸€ä¸ªåœ¨å¤šé“ç¨‹åºç¯å¢ƒä¸‹ä¸èƒ½ç‹¬ç«‹è¿è¡Œçš„ç¨‹åºç§°ä¸ºä¸€ä¸ªèƒ½ç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½ï¼Œä¸€ä¸ªèƒ½ä¸å…¶å®ƒè¿›ç¨‹å¹¶å‘æ‰§è¡Œçš„è¿›ç¨‹ã€‚</p><ol><li>ä½œä¸ºç‹¬ç«‹è¿è¡ŒåŸºæœ¬å•ä½çš„æ ‡å¿—ã€‚<br> å½“ä¸€ä¸ªç¨‹åºé…ç½®äº†PCBä¹‹åï¼Œå°±è¡¨ç¤ºä»–å·²æ˜¯ä¸€ä¸ªèƒ½åœ¨å¤šé“ç¨‹åºç¯å¢ƒä¸‹ç‹¬ç«‹è¿è¡Œçš„ã€åˆæ³•çš„åŸºæœ¬å•ä½ï¼Œä¹Ÿå°±å…·æœ‰å–å¾—OSæœåŠ¡çš„æƒåˆ©ã€‚å½“ç³»ç»Ÿåˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹çš„æ—¶å€™ï¼Œå°±ä¸ºä»–åˆ›å»ºäº†ä¸€ä¸ªPCBï¼Œè¿›ç¨‹ç»“æŸåæ”¶å›PCBã€‚</li><li>èƒ½å®ç°é—´æ–­æ€§è¿è¡Œæ–¹å¼ã€‚<br> åœ¨å¤šé“ç¨‹åºè¿è¡Œç¯å¢ƒä¸‹ï¼Œç”±äºå­˜åœ¨æ—¶é—´ç‰‡æˆ–è€…æœ‰ç­‰å¾…I/Oè¯·æ±‚çš„æƒ…å†µï¼Œæ‰€ä»¥è¿›ç¨‹ä¸€èˆ¬éƒ½æ˜¯å‡ºäºèµ°èµ°åœåœçš„çŠ¶æ€ï¼Œå½“ä¸€ä¸ªè¿›ç¨‹è¢«é˜»å¡çš„æ—¶å€™ï¼Œä»–åº”è¯¥æœ‰ä¸€ç§èƒ½ä¿å­˜å½“å‰è¿è¡ŒçŠ¶æ€çš„èƒ½åŠ›ä¹Ÿå°±æ˜¯ä¿æŠ¤ç°åœºæœºåˆ¶ï¼Œæ–¹ä¾¿åœ¨æ­¤è¢«è°ƒåº¦æ‰§è¡Œæ—¶æ¢å¤é˜»å¡å‰çš„çŠ¶æ€ã€‚æ‰€ä»¥å°±éœ€è¦åœ¨PCBé‡Œé¢æä¾›ä¸€ä¸ªæ•°æ®ç»“æ„æ¥ä¿å­˜è¯¥è¿›ç¨‹è¢«ä¸­æ–­æ—¶çš„ä¸€äº›ä¿¡æ¯ã€‚</li><li>æä¾›è¿›ç¨‹ç®¡ç†æ‰€éœ€è¦çš„ä¿¡æ¯ã€‚<br> è¿™ä¸ªå°±ä¸ç”¨å¤šè¯´å§ã€‚</li><li>æä¾›è¿›ç¨‹è°ƒåº¦æ‰€éœ€è¦çš„ä¿¡æ¯ã€‚<br> åªæœ‰å¤„äºå°±ç»ªçŠ¶æ€çš„è¿›ç¨‹æ‰èƒ½è¢«è°ƒåº¦æ‰§è¡Œï¼Œè€Œåœ¨PCBä¸­å°±æä¾›äº†è¿›ç¨‹å¤„äºä½•ç§çŠ¶æ€çš„ä¿¡æ¯ã€‚</li><li>å®ç°ä¸å…¶å®ƒè¿›ç¨‹çš„åŒæ­¥ä¸é€šä¿¡ã€‚</li></ol><h3 id="2-1-3-2-è¿›ç¨‹æ§åˆ¶å—ä¸­çš„ä¿¡æ¯"><a href="#2-1-3-2-è¿›ç¨‹æ§åˆ¶å—ä¸­çš„ä¿¡æ¯" class="headerlink" title="2.1.3.2 è¿›ç¨‹æ§åˆ¶å—ä¸­çš„ä¿¡æ¯"></a>2.1.3.2 è¿›ç¨‹æ§åˆ¶å—ä¸­çš„ä¿¡æ¯</h3><p>æ ¹æ®ä¸Šé¢è¿›ç¨‹æ§åˆ¶å—ä½œç”¨çš„æè¿°ï¼Œå¯¹åº”çš„è¿›ç¨‹æ§åˆ¶å—ä¸­å°±éœ€è¦åŒ…å«ä»¥ä¸‹ä¿¡æ¯ã€‚</p><ol><li>è¿›ç¨‹æ ‡è¯†ç¬¦<br> è¿›ç¨‹æ ‡è¯†ç¬¦ç”¨äºå”¯ä¸€åœ°æ ‡è¯†ä¸€ä¸ªè¿›ç¨‹ã€‚ä¸€ä¸ªè¿›ç¨‹é€šå¸¸å…·æœ‰ä¸¤ç§æ ‡è¯†ç¬¦ï¼š<ol><li>å¤–éƒ¨æ ‡è¯†ç¬¦<br> ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·ï¼ˆè¿›ç¨‹ï¼‰å¯¹è¿›ç¨‹çš„è®¿é—®ï¼Œè¿›ç¨‹éœ€è¦æä¾›ä¸€ä¸ªç”¨äºç”¨æˆ·ï¼ˆè¿›ç¨‹ï¼‰è®¿é—®çš„æ ‡è¯†ç¬¦ã€‚</li><li>å†…éƒ¨æ ‡è¯†ç¬¦<br> ä¸ºäº†æ–¹ä¾¿ç³»ç»Ÿå¯¹è¿›ç¨‹çš„ä½¿ç”¨ï¼Œåœ¨OSä¸­åˆä¸ºè¿›ç¨‹è®¾ç½®äº†å†…éƒ¨æ ‡è¯†ç¬¦ã€‚é€šå¸¸æ˜¯ä¸€ä¸ªè¿›ç¨‹çš„åºå·ã€‚</li></ol></li><li>å¤„ç†æœºçŠ¶æ€<br> å¤„ç†æœºçŠ¶æ€ä¿¡æ¯ä¹Ÿç§°ä¸ºå¤„ç†æœºçš„ä¸Šä¸‹æ–‡ï¼Œä¸»è¦æ˜¯ç”±å¤„ç†æœºçš„å„ç§å¯„å­˜å™¨ä¸­çš„å†…å®¹ç»„æˆçš„ã€‚è¿™äº›å¯„å­˜å™¨ä¿¡æ¯åŒ…æ‹¬é€šç”¨å¯„å­˜å™¨ã€æŒ‡ä»¤å¯„å­˜å™¨ã€ç¨‹åºçŠ¶æ€å­—PSWå’Œç”¨æˆ·æ ˆæŒ‡é’ˆã€‚</li><li>è¿›ç¨‹è°ƒåº¦ä¿¡æ¯<br> åœ¨OSè¿›è¡Œè°ƒåº¦çš„æ—¶å€™ï¼Œå¿…é¡»äº†è§£è¿›ç¨‹çš„çŠ¶æ€åŠæœ‰å…³è¿›ç¨‹è°ƒåº¦çš„ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯åŒ…æ‹¬ï¼šè¿›ç¨‹çŠ¶æ€ã€è¿›ç¨‹ä¼˜å…ˆçº§ã€è¿›ç¨‹è°ƒåº¦æ‰€éœ€å…¶ä»–ä¿¡æ¯ï¼ˆä¸æ‰€é‡‡ç”¨çš„çš„è°ƒåº¦ç®—æ³•æœ‰å…³ï¼‰å’Œäº‹ä»¶ï¼ˆé˜»å¡åŸå› ï¼‰ã€‚</li><li>è¿›ç¨‹æ§åˆ¶ä¿¡æ¯<br> ç”¨äºè¿›ç¨‹æ§åˆ¶æ‰€å¿…é¡»çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šç¨‹åºå’Œæ•°æ®çš„åœ°å€ã€è¿›ç¨‹åŒæ­¥å’Œé€šä¿¡æœºåˆ¶ã€èµ„æºæ¸…å•å’Œé“¾æ¥æŒ‡é’ˆã€‚</li></ol><h3 id="2-1-3-3-è¿›ç¨‹æ§åˆ¶å—çš„ç»„ç»‡æ–¹å¼"><a href="#2-1-3-3-è¿›ç¨‹æ§åˆ¶å—çš„ç»„ç»‡æ–¹å¼" class="headerlink" title="2.1.3.3 è¿›ç¨‹æ§åˆ¶å—çš„ç»„ç»‡æ–¹å¼"></a>2.1.3.3 è¿›ç¨‹æ§åˆ¶å—çš„ç»„ç»‡æ–¹å¼</h3><p>ä¸€ä¸ªç³»ç»Ÿä¸­æœ‰å¾ˆå¤šä¸ªPCBï¼Œä¸ºäº†å¯¹ä»–ä»¬è¿›è¡Œæœ‰æ•ˆçš„ç®¡ç†ï¼Œåº”è¯¥ç”¨é€‚å½“çš„æ–¹å¼å°†è¿™äº›PCBç»„ç»‡èµ·æ¥ï¼Œå¸¸ç”¨çš„ç»„ç»‡æ–¹å¼æœ‰ä¸‰ç§</p><ol><li><p>çº¿æ€§æ–¹å¼<br>ç›´æ¥å°†æ‰€æœ‰PCBæ”¾åœ¨ä¸€å¼ çº¿æ€§è¡¨ä¸­ï¼Œä¼˜ç‚¹æ˜¯ç®€å•ï¼Œå¼€é”€å°ï¼Œä½†æ˜¯æ¯æ¬¡æŸ¥æ‰¾èµ·æ¥å¾ˆéº»çƒ¦ã€‚<br><img src="https://cdn.littlecorgi.top/mweb/2019-07-21/linedPCB.jpg" alt="linedPCB"></p></li><li><p>é“¾æ¥æ–¹å¼<br>æŠŠå…·æœ‰ç›¸åŒçŠ¶æ€çš„PCBåˆ†åˆ«é€šè¿‡PCBä¸­çš„é“¾æ¥å­—é“¾æ¥æˆä¸€ä¸ªé˜Ÿåˆ—ã€‚<br><img src="https://cdn.littlecorgi.top/mweb/2019-07-21/linkedPCB.png" alt="linkedPCB"></p></li><li><p>ç´¢å¼•æ–¹å¼<br>æ ¹æ®æ‰€æœ‰è¿›ç¨‹çŠ¶æ€çš„ä¸åŒå»ºç«‹å‡ å¼ ç´¢å¼•è¡¨ï¼Œå¹¶æŠŠä¸ªç´¢å¼•è¡¨åœ¨å†…å­˜çš„é¦–åœ°å€çºªå½•åœ¨å†…å­˜çš„ä¸€äº›ä¸“ç”¨å•å…ƒä¸­ã€‚<br><img src="https://cdn.littlecorgi.top/mweb/2019-07-21/indexPCB.png" alt="indexPCB"></p></li></ol><h1 id="2-2-è¿›ç¨‹æ§åˆ¶"><a href="#2-2-è¿›ç¨‹æ§åˆ¶" class="headerlink" title="2.2 è¿›ç¨‹æ§åˆ¶"></a>2.2 è¿›ç¨‹æ§åˆ¶</h1><h2 id="2-2-1-è¿›ç¨‹çš„å±‚æ¬¡ç»“æ„"><a href="#2-2-1-è¿›ç¨‹çš„å±‚æ¬¡ç»“æ„" class="headerlink" title="2.2.1 è¿›ç¨‹çš„å±‚æ¬¡ç»“æ„"></a>2.2.1 è¿›ç¨‹çš„å±‚æ¬¡ç»“æ„</h2><p>åœ¨OSä¸­ï¼Œå…è®¸ä¸€ä¸ªè¿›ç¨‹åˆ›å»ºå¦ä¸€ä¸ªè¿›ç¨‹ï¼Œé€šå¸¸æŠŠåˆ›å»ºè¿›ç¨‹çš„è¿›ç¨‹ç§°ä¸ºçˆ¶è¿›ç¨‹ï¼Œè¢«åˆ›å»ºçš„è¿›ç¨‹ç§°ä¸ºå­è¿›ç¨‹ã€‚ç„¶åå­è¿›ç¨‹å¯ä»¥ä½œä¸ºçˆ¶è¿›ç¨‹ç»§ç»­å»åˆ›å»ºå­è¿›ç¨‹ï¼Œè¿›è€Œå½¢æˆä¸€ä¸ªè¿›ç¨‹å®¶æ—ã€‚</p><h2 id="2-2-2-è¿›ç¨‹çš„åˆ›å»º"><a href="#2-2-2-è¿›ç¨‹çš„åˆ›å»º" class="headerlink" title="2.2.2 è¿›ç¨‹çš„åˆ›å»º"></a>2.2.2 è¿›ç¨‹çš„åˆ›å»º</h2><p>æ¯å½“å‡ºç°äº†åˆ›å»ºæ–°è¿›ç¨‹çš„è¯·æ±‚åï¼ŒOSä¾¿è°ƒç”¨è¿›ç¨‹åˆ›å»ºåŸè¯­CreatæŒ‰ä¸‹è¿°æ­¥éª¤åˆ›å»ºæ–°è¿›ç¨‹ï¼š</p><ol><li>ç”³è¯·ç©ºç™½PCBï¼Œä¸ºæ–°è¿›ç¨‹ç”³è¯·è·å¾—å”¯ä¸€çš„æ•°å­—æ ‡è¯†ç¬¦ï¼Œå¹¶ä»PCBé›†åˆä¸­ç´¢å–ä¸€ä¸ªç©ºç™½PCBã€‚</li><li>ä¸ºæ–°è¿›ç¨‹åˆ†é…å…¶è¿è¡Œæ‰€éœ€çš„èµ„æºï¼ŒåŒ…æ‹¬å„ç§ç‰©ç†å’Œé€»è¾‘èµ„æºã€‚</li><li>åˆå§‹åŒ–è¿›ç¨‹æ§åˆ¶å—PCBã€‚</li><li>å¦‚æœè¿›ç¨‹å°±ç»ªé˜Ÿåˆ—èƒ½å¤Ÿæ¥çº³æ–°è¿›ç¨‹ï¼Œä¾¿å°†æ–°è¿›ç¨‹æ’å…¥å°±ç»ªé˜Ÿåˆ—ã€‚</li></ol><h2 id="2-2-3-è¿›ç¨‹çš„ç»ˆæ­¢"><a href="#2-2-3-è¿›ç¨‹çš„ç»ˆæ­¢" class="headerlink" title="2.2.3 è¿›ç¨‹çš„ç»ˆæ­¢"></a>2.2.3 è¿›ç¨‹çš„ç»ˆæ­¢</h2><ol><li>æ ¹æ®è¢«ç»ˆæ­¢è¿›ç¨‹çš„æ ‡è¯†ç¬¦ï¼Œä»PCBé›†åˆä¸­æ£€ç´¢å‡ºè¿›ç¨‹çš„PCBï¼Œä»ä¸­è¯»å‡ºè¯¥è¿›ç¨‹çš„çŠ¶æ€ã€‚</li><li>è‹¥è¢«ç»ˆæ­¢è¿›ç¨‹æ­£å¤„äºæ‰§è¡ŒçŠ¶æ€ï¼Œåº”ç«‹å³ç»ˆæ­¢è¯¥è¿›ç¨‹çš„æ‰§è¡Œï¼Œå¹¶ç½®è°ƒåº¦æ ‡å¿—ä½çœŸï¼Œç”¨äºæŒ‡ç¤ºè¯¥è¿›ç¨‹è¢«ç»ˆæ­¢ååº”é‡æ–°è¿›è¡Œè°ƒåº¦ã€‚</li><li>è‹¥è¯¥è¿›ç¨‹è¿˜æœ‰å­å­™è¿›ç¨‹ï¼Œè¿˜åº”å°†å…¶æ‰€æœ‰å­å­™è¿›ç¨‹ä¹Ÿéƒ½äºˆä»¥ç»ˆæ­¢ï¼Œä»¥é˜²å®ƒä»¬ç§°ä¸ºä¸å¯æ§çš„è¿›ç¨‹ã€‚</li><li>å°†è¢«ç»ˆæ­¢è¿›ç¨‹æ‰€æ‹¥æœ‰çš„çš„å…¨éƒ¨èµ„æºæˆ–è€…å½’è¿˜ç»™å…¶çˆ¶è¿›ç¨‹ï¼Œæˆ–è€…å½’è¿˜ç»™ç³»ç»Ÿã€‚</li><li>å°†è¢«ç»ˆæ­¢è¿›ç¨‹ï¼ˆPCBï¼‰ä»æ‰€åœ¨é˜Ÿåˆ—ï¼ˆæˆ–é“¾è¡¨ï¼‰ä¸­ç§»å‡ºï¼Œç­‰å¾…å…¶ä»–ç¨‹åºæ¥æœé›†ä¿¡æ¯ã€‚</li></ol>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ</category>
      
      
      <comments>https://www.littlecorgi.top/posts/2e847144.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>æ“ä½œç³»ç»Ÿ1--æ“ä½œç³»ç»Ÿæ¦‚è¿°</title>
      <link>https://www.littlecorgi.top/posts/62248b34.html</link>
      <guid>https://www.littlecorgi.top/posts/62248b34.html</guid>
      <pubDate>Sat, 20 Jul 2019 07:32:29 GMT</pubDate>
      
      <description>&lt;blockquote&gt;
&lt;p&gt;å¤§å®¶å¯ä»¥çœ‹ä¸‹æˆ‘ä½¿ç”¨å¹•å¸ƒè½¯ä»¶ç”»çš„&lt;a href=&quot;https://mubu.com/doc/3Pf0zwzrgw&quot;&gt;æ€ç»´å¯¼å›¾&lt;/a&gt;ï¼Œå¦‚æœå¤§å®¶æƒ³ä½¿ç”¨å¹•å¸ƒå¯ä»¥é€šè¿‡æˆ‘çš„é‚€è¯·é“¾æ¥æ³¨å†Œï¼Œå¯å…è´¹è·å¾—ä¸€ä¸ªæœˆé«˜çº§ä¼šå‘˜&lt;a href=&quot;https://mubu.com/inv/477598&quot;&gt;https://mubu.com/inv/477598&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>å¤§å®¶å¯ä»¥çœ‹ä¸‹æˆ‘ä½¿ç”¨å¹•å¸ƒè½¯ä»¶ç”»çš„<a href="https://mubu.com/doc/3Pf0zwzrgw">æ€ç»´å¯¼å›¾</a>ï¼Œå¦‚æœå¤§å®¶æƒ³ä½¿ç”¨å¹•å¸ƒå¯ä»¥é€šè¿‡æˆ‘çš„é‚€è¯·é“¾æ¥æ³¨å†Œï¼Œå¯å…è´¹è·å¾—ä¸€ä¸ªæœˆé«˜çº§ä¼šå‘˜<a href="https://mubu.com/inv/477598">https://mubu.com/inv/477598</a></p></blockquote><span id="more"></span><h1 id="ç°å¦‚ä»Šä¸»æµçš„æ“ä½œç³»ç»Ÿ"><a href="#ç°å¦‚ä»Šä¸»æµçš„æ“ä½œç³»ç»Ÿ" class="headerlink" title="ç°å¦‚ä»Šä¸»æµçš„æ“ä½œç³»ç»Ÿ"></a>ç°å¦‚ä»Šä¸»æµçš„æ“ä½œç³»ç»Ÿ</h1><h2 id="1-1-1-PC"><a href="#1-1-1-PC" class="headerlink" title="1.1.1 PC"></a>1.1.1 PC</h2><h3 id="1-1-1-1-Windows"><a href="#1-1-1-1-Windows" class="headerlink" title="1.1.1.1 Windows"></a>1.1.1.1 Windows</h3><p>Microsoft Windowsæ˜¯å¾®è½¯å…¬å¸æ¨å‡ºçš„ä¸€ç³»åˆ—æ“ä½œç³»ç»Ÿã€‚å…¶é—®ä¸–æ—¶é—´ä¸º1985å¹´ï¼Œèµ·åˆä¸ºè¿è¡ŒäºMS-DOSä¹‹ä¸‹çš„æ¡Œé¢ç¯å¢ƒï¼Œå…¶åç»­ç‰ˆæœ¬é€æ¸å‘å±•æˆä¸ºä¸»è¦ä¸ºä¸ªäººè®¡ç®—æœºå’ŒæœåŠ¡å™¨ç”¨æˆ·è®¾è®¡çš„æ“ä½œç³»ç»Ÿï¼Œå¹¶æœ€ç»ˆè·å¾—äº†ä¸–ç•Œä¸ªäººè®¡ç®—æœºæ“ä½œç³»ç»Ÿçš„å„æ–­åœ°ä½ã€‚æ­¤æ“ä½œç³»ç»Ÿå¯ä»¥åœ¨å‡ ç§ä¸åŒç±»å‹çš„å¹³å°ä¸Šè¿è¡Œï¼Œå¦‚ä¸ªäººè®¡ç®—æœºã€ç§»åŠ¨è®¾å¤‡ã€æœåŠ¡å™¨å’ŒåµŒå…¥å¼ç³»ç»Ÿç­‰ç­‰ï¼Œå…¶ä¸­åœ¨ä¸ªäººè®¡ç®—æœºçš„é¢†åŸŸåº”ç”¨å†…æœ€ä¸ºæ™®éã€‚<br>Windowsæ“ä½œç³»ç»Ÿå½“å‰æœ€æ–°çš„ç¨³å®šç‰ˆæ˜¯äº2015å¹´7æœˆ29æ—¥å‘å¸ƒçš„ Windows 10ã€‚Windows Serverå½“å‰æœ€æ–°çš„ç¨³å®šç‰ˆæ˜¯2018å¹´10æœˆ2æ—¥å‘å¸ƒçš„Windows Server 2019ã€‚Windows Phoneå½“å‰æœ€æ–°çš„ç¨³å®šç‰ˆæ˜¯Windows10 Mobileï¼Œä½†æ˜¯å·²åœæ­¢å¼€å‘æ–°ç‰ˆæœ¬ï¼Œä»…å¯¹ç°æœ‰ç‰ˆæœ¬è¿›è¡Œå®‰å…¨è¡¥ä¸å’Œç»´æŠ¤ï¼Œç›´åˆ°2019å¹´12æœˆã€‚</p><h3 id="1-1-1-2-macOS"><a href="#1-1-1-2-macOS" class="headerlink" title="1.1.1.2 macOS"></a>1.1.1.2 macOS</h3><p>macOSï¼ˆ2011å¹´åŠä¹‹å‰ç§°Mac OS Xï¼Œ2012å¹´è‡³2015å¹´ç§°OS Xï¼‰æ˜¯è‹¹æœå…¬å¸æ¨å‡ºçš„åŸºäºå›¾å½¢ç”¨æˆ·ç•Œé¢æ“ä½œç³»ç»Ÿï¼Œä¸ºéº¦é‡‘å¡”ï¼ˆMacintoshï¼‰çš„ä¸»æ“ä½œç³»ç»Ÿã€‚StatCounteråœ¨2018å¹´8æœˆçš„æ•°æ®è¡¨ç¤ºï¼Œåœ¨æ¡Œé¢æ“ä½œç³»ç»Ÿä¸­ï¼ŒmacOSçš„ä½¿ç”¨ä»½é¢ä¸º12.65%ï¼Œæ¬¡äºWindowsçš„82.51%ä½å±…ç¬¬äºŒã€‚<br>macOSå½“å‰æœ€æ–°çš„ç¨³å®šç‰ˆæ˜¯2018å¹´9æœˆ25æ—¥å‘å¸ƒçš„macOS 10.14 Mojaveï¼Œ2019å¹´6æœˆ4æ—¥æ¨å‡ºmacOS 10.15 Catalinaçš„ç¬¬ä¸€ä¸ªæµ‹è¯•ç‰ˆæœ¬ã€‚</p><h3 id="1-1-1-3-Linux"><a href="#1-1-1-3-Linux" class="headerlink" title="1.1.1.3 Linux"></a>1.1.1.3 Linux</h3><p>Linuxæ˜¯ä¸€ç§è‡ªç”±å’Œå¼€æ”¾æºç çš„ç±»UNIX æ“ä½œç³»ç»Ÿã€‚è¯¥æ“ä½œç³»ç»Ÿçš„å†…æ ¸ç”±æ—çº³æ–¯Â·æ‰˜ç“¦å…¹åœ¨1991å¹´10æœˆ5æ—¥é¦–æ¬¡å‘å¸ƒï¼Œåœ¨åŠ ä¸Šç”¨æˆ·ç©ºé—´çš„åº”ç”¨ç¨‹åºä¹‹åï¼Œæˆä¸º Linux æ“ä½œç³»ç»Ÿã€‚Linuxä¹Ÿæ˜¯è‡ªç”±è½¯ä»¶å’Œå¼€æ”¾æºä»£ç è½¯ä»¶å‘å±•ä¸­æœ€è‘—åçš„ä¾‹å­ã€‚åªè¦éµå¾ª GNU é€šç”¨å…¬å…±è®¸å¯è¯ï¼ˆGPLï¼‰ï¼Œä»»ä½•ä¸ªäººå’Œæœºæ„éƒ½å¯ä»¥è‡ªç”±åœ°ä½¿ç”¨ Linux çš„æ‰€æœ‰åº•å±‚æºä»£ç ï¼Œä¹Ÿå¯ä»¥è‡ªç”±åœ°ä¿®æ”¹å’Œå†å‘å¸ƒã€‚å¤§å¤šæ•° Linux ç³»ç»Ÿè¿˜åŒ…æ‹¬åƒæä¾› GUI çš„ X Window ä¹‹ç±»çš„ç¨‹åºã€‚é™¤äº†ä¸€éƒ¨åˆ†ä¸“å®¶ä¹‹å¤–ï¼Œå¤§å¤šæ•°äººéƒ½æ˜¯ç›´æ¥ä½¿ç”¨ Linux å‘è¡Œç‰ˆï¼Œè€Œä¸æ˜¯è‡ªå·±é€‰æ‹©æ¯ä¸€æ ·ç»„ä»¶æˆ–è‡ªè¡Œè®¾ç½®ã€‚</p><h3 id="1-1-1-4-Unix"><a href="#1-1-1-4-Unix" class="headerlink" title="1.1.1.4 Unix"></a>1.1.1.4 Unix</h3><p>UNIXæ“ä½œç³»ç»Ÿï¼ˆå°¤å°¼æ–¯ï¼‰ï¼Œæ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¤šç”¨æˆ·ã€å¤šä»»åŠ¡æ“ä½œç³»ç»Ÿï¼Œæ”¯æŒå¤šç§å¤„ç†å™¨æ¶æ„ï¼ŒæŒ‰ç…§æ“ä½œç³»ç»Ÿçš„åˆ†ç±»ï¼Œå±äºåˆ†æ—¶æ“ä½œç³»ç»Ÿï¼Œæœ€æ—©ç”±KenThompsonã€Dennis Ritchieå’ŒDouglas McIlroyäº1969å¹´åœ¨AT&amp;Tçš„è´å°”å®éªŒå®¤å¼€å‘ã€‚å®ƒçš„å•†æ ‡æƒç”±å›½é™…å¼€æ”¾æ ‡å‡†ç»„ç»‡æ‰€æ‹¥æœ‰ï¼Œåªæœ‰ç¬¦åˆå•ä¸€UNIXè§„èŒƒçš„UNIXç³»ç»Ÿæ‰èƒ½ä½¿ç”¨UNIXè¿™ä¸ªåç§°ï¼Œå¦åˆ™åªèƒ½ç§°ä¸ºç±»UNIXï¼ˆUNIX-likeï¼‰ã€‚</p><h2 id="1-1-2-ç§»åŠ¨ç«¯"><a href="#1-1-2-ç§»åŠ¨ç«¯" class="headerlink" title="1.1.2 ç§»åŠ¨ç«¯"></a>1.1.2 ç§»åŠ¨ç«¯</h2><h3 id="1-1-2-1-Android"><a href="#1-1-2-1-Android" class="headerlink" title="1.1.2.1 Android"></a>1.1.2.1 Android</h3><p>Androidï¼Œå¸¸è§çš„éå®˜æ–¹ä¸­æ–‡åç§°ä¸ºå®‰å“ï¼Œæ˜¯ä¸€ä¸ªåŸºäºLinuxå†…æ ¸çš„å¼€æ”¾æºä»£ç ç§»åŠ¨æ“ä½œç³»ç»Ÿï¼Œç”±Googleæˆç«‹çš„Open Handset AllianceæŒç»­é¢†å¯¼ä¸å¼€å‘ï¼Œä¸»è¦è®¾è®¡ç”¨äºè§¦æ‘¸å±ç§»åŠ¨è®¾å¤‡å¦‚æ™ºèƒ½æ‰‹æœºå’Œå¹³æ¿ç”µè„‘ä¸å…¶ä»–ä¾¿æºå¼è®¾å¤‡ã€‚<br>Android Inc.äº2003å¹´10æœˆç”±å®‰è¿ªÂ·é²å®¾ã€åˆ©å¥‡Â·ç±³çº³å°”ã€å°¼å…‹Â·å¸­å°”æ–¯ã€å…‹é‡Œæ–¯Â·æ€€ç‰¹åœ¨åŠ å·å¸•ç½—å¥¥å›¾åˆ›å»ºã€‚Androidæœ€åˆç”±å®‰è¿ªÂ·é²å®¾ç­‰äººå¼€å‘åˆ¶ä½œï¼Œæœ€åˆå¼€å‘è¿™ä¸ªç³»ç»Ÿçš„æ—©æœŸæ–¹å‘æ˜¯åˆ›å»ºä¸€ä¸ªæ•°å­—ç›¸æœºçš„å…ˆè¿›æ“ä½œç³»ç»Ÿï¼Œä½†æ˜¯åæ¥å‘ç°å¸‚åœºéœ€æ±‚ä¸å¤Ÿå¤§ï¼ŒåŠ ä¸Šæ™ºèƒ½æ‰‹æœºå¸‚åœºå¿«é€Ÿæˆé•¿ï¼Œäºæ˜¯Androidæˆä¸ºä¸€æ¬¾é¢å‘æ™ºèƒ½æ‰‹æœºçš„æ“ä½œç³»ç»Ÿã€‚äº2005å¹´7æœˆ11æ—¥Android Inc.è¢«ç¾å›½ç§‘æŠ€ä¼ä¸šGoogleæ”¶è´­ã€‚<br>2017å¹´3æœˆï¼ŒAndroidå…¨çƒç½‘ç»œæµé‡å’Œè®¾å¤‡è¶…è¶ŠMicrosoft Windowsï¼Œæ­£å¼æˆä¸ºå…¨çƒç¬¬ä¸€å¤§æ“ä½œç³»ç»Ÿã€‚</p><h3 id="1-1-2-2-iOS"><a href="#1-1-2-2-iOS" class="headerlink" title="1.1.2.2 iOS"></a>1.1.2.2 iOS</h3><p>iOSï¼ˆåŸåä¸ºiPhone OSï¼‰æ˜¯è‹¹æœå…¬å¸ä¸ºå…¶ç§»åŠ¨è®¾å¤‡æ‰€å¼€å‘çš„ä¸“æœ‰ç§»åŠ¨æ“ä½œç³»ç»Ÿï¼Œä¸ºå…¶å…¬å¸çš„è®¸å¤šç§»åŠ¨è®¾å¤‡æä¾›æ“ä½œç•Œé¢ï¼Œæ”¯æŒè®¾å¤‡åŒ…æ‹¬iPhoneã€iPadå’ŒiPod touchã€‚iPhone OSè‡ªiOS 4èµ·ä¾¿æ”¹åä¸ºiOSï¼Œå®ƒæ˜¯ç»§Androidåå…¨çƒç¬¬äºŒå¤§æœ€å—æ¬¢è¿çš„ç§»åŠ¨æ“ä½œç³»ç»Ÿï¼Œå¸‚å ç‡å·²ä¸Šå‡è‡³çº¦24.5% ï¼Œä½†ä»è¿œä½äºGoogleå¼€å‘çš„Androidç³»ç»Ÿçš„72.2%ã€‚</p><h1 id="1-2-æ“ä½œç³»ç»Ÿçš„ç®€ä»‹ä¸ä½œç”¨"><a href="#1-2-æ“ä½œç³»ç»Ÿçš„ç®€ä»‹ä¸ä½œç”¨" class="headerlink" title="1.2 æ“ä½œç³»ç»Ÿçš„ç®€ä»‹ä¸ä½œç”¨"></a>1.2 æ“ä½œç³»ç»Ÿçš„ç®€ä»‹ä¸ä½œç”¨</h1><h2 id="1-2-1-æ“ä½œç³»ç»Ÿçš„ç®€ä»‹"><a href="#1-2-1-æ“ä½œç³»ç»Ÿçš„ç®€ä»‹" class="headerlink" title="1.2.1 æ“ä½œç³»ç»Ÿçš„ç®€ä»‹"></a>1.2.1 æ“ä½œç³»ç»Ÿçš„ç®€ä»‹</h2><p>æ“ä½œç³»ç»Ÿæ˜¯é…ç½®åœ¨è®¡ç®—æœºç¡¬ä»¶ä¸Šçš„ç¬¬ä¸€å±‚è½¯ä»¶ï¼Œæ˜¯å¯¹ç¡¬ä»¶ç³»ç»Ÿçš„é¦–æ¬¡æ‰©å……ã€‚ä¸»è¦ä½œç”¨æ˜¯å¯¹ç®¡ç†å¥½è®¡ç®—æœºç¡¬ä»¶è®¾å¤‡ï¼Œæé«˜ä»–ä»¬çš„åˆ©ç”¨ç‡å’Œç³»ç»Ÿçš„ååé‡ï¼Œå¹¶ä¸ºç”¨æˆ·å’Œåº”ç”¨ç¨‹åºæä¾›ä¸€ä¸ªç®€å•æ¥å£ï¼Œä¾¿äºç”¨æˆ·ä½¿ç”¨ã€‚</p><h2 id="1-2-2-æ“ä½œç³»ç»Ÿçš„ç›®çš„"><a href="#1-2-2-æ“ä½œç³»ç»Ÿçš„ç›®çš„" class="headerlink" title="1.2.2 æ“ä½œç³»ç»Ÿçš„ç›®çš„"></a>1.2.2 æ“ä½œç³»ç»Ÿçš„ç›®çš„</h2><ol><li>æ–¹ä¾¿æ€§<br> å¦‚æœä¸€ä¸ªè®¡ç®—æœºæ²¡æœ‰OSï¼Œé‚£ä¹ˆä»–ä¼šéå¸¸éš¾ç”¨ã€‚ç”¨æˆ·ä¸ç®¡è¿›è¡Œå•¥æ“ä½œéƒ½å¾—é€šè¿‡æœºå™¨è¯­è¨€ç¼–å†™ç¨‹åºç„¶åè¿è¡Œï¼Œè€Œå¦‚æœæœ‰OSçš„è¯ï¼Œç”¨æˆ·å°±å¯ä»¥ä½¿ç”¨å„ç§å„æ ·çš„è¯­è¨€ç¼–å†™ç¨‹åºï¼Œç„¶åé€šè¿‡ç¼–è¯‘å°†é«˜çº§è¯­è¨€ç¼–è¯‘æˆæœºå™¨ä»£ç ï¼Œæ–¹ä¾¿äº†ç”¨æˆ·ã€‚</li><li>æœ‰æ•ˆæ€§<br> æœ‰æ•ˆæ€§åˆ†ä¸¤å±‚å«ä¹‰â€”â€”æé«˜ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡å’Œæé«˜ç³»ç»Ÿçš„ååé‡ã€‚æ—©æœŸæ²¡æœ‰OSçš„è®¡ç®—æœºä¸­ï¼Œå¤„ç†æœºå’ŒI/Oè®¾å¤‡ç­‰ç»å¸¸å¤„äºç©ºé—²çŠ¶æ€ï¼Œå„ç§èµ„æºä¸èƒ½å¾—åˆ°åˆç†åˆ©ç”¨ï¼Œæ‰€ä»¥æé«˜ç³»ç»Ÿèµ„æºåˆ©ç”¨ç‡æ˜¯æ¨åŠ¨OSå‘å±•çš„ä¸»è¦åŠ¨åŠ›ã€‚å¦ä¸€æ–¹é¢ï¼ŒOSå¯ä»¥é€šè¿‡åˆç†ç»„ç»‡è®¡ç®—æœºçš„å·¥ä½œæµç¨‹ï¼ŒåŠ é€Ÿç¨‹åºçš„è¿è¡Œï¼Œç¼©çŸ­ç¨‹åºçš„è¿è¡Œå‘¨æœŸï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„ååé‡ã€‚</li><li>å¯æ‰©å……æ€§<br> ä¸ºäº†é€‚åº”ç°åœ¨è¶Šæ¥è¶Šå¤šçš„è®¡ç®—æœºç¡¬ä»¶ä»¥åŠä½“ç³»ç»“æ„ï¼ŒOSå¿…ä¿®æœ‰è‰¯å¥½çš„å¯æ‰©å……æ€§ã€‚</li><li>å¼€æ”¾æ€§<br> OSéœ€è¦éµå¾ªä¸–ç•Œæ ‡å‡†è§„èŒƒï¼Œå‡¡éµå¾ªå›½é™…æ ‡å‡†æ‰€å¼€å‘çš„ç¡¬ä»¶å’Œè½¯ä»¶éƒ½èƒ½å½¼æ­¤å…¼å®¹ï¼Œæ–¹ä¾¿åœ°å®ç°äº’è”ã€‚</li></ol><h2 id="1-2-3-æ“ä½œç³»ç»Ÿçš„ä½œç”¨"><a href="#1-2-3-æ“ä½œç³»ç»Ÿçš„ä½œç”¨" class="headerlink" title="1.2.3 æ“ä½œç³»ç»Ÿçš„ä½œç”¨"></a>1.2.3 æ“ä½œç³»ç»Ÿçš„ä½œç”¨</h2><ol><li>OSä½œä¸ºç”¨æˆ·ä¸è®¡ç®—æœºç¡¬ä»¶ç³»ç»Ÿä¹‹é—´çš„æ¥å£<br> OSå¤„äºç”¨æˆ·å’Œç¡¬ä»¶ä¹‹é—´ï¼Œæ–¹ä¾¿ç”¨æˆ·é€šè¿‡OSä½¿ç”¨ç¡¬ä»¶ã€‚æˆ–è€…è¯´ï¼Œç”¨æˆ·åœ¨OSçš„å¸®åŠ©ä¸‹èƒ½å¤Ÿæ–¹ä¾¿ã€å¿«æ·ã€å¯é åœ°æ“çºµè®¡ç®—æœºç¡¬ä»¶å’Œè¿è¡Œè‡ªå·±çš„ç¨‹åºã€‚</li><li>OSä½œä¸ºè®¡ç®—æœºç³»ç»Ÿèµ„æºçš„ç®¡ç†è€…<br> è®¡ç®—æœºç³»ç»Ÿèµ„æºä¸»è¦å¯åˆ†ä¸ºå¤„ç†æœºã€å­˜å‚¨å™¨ã€I/Oè®¾å¤‡ä»¥åŠæ–‡ä»¶ã€‚OSä¸»è¦åŠŸèƒ½ä¹Ÿå°±æ˜¯å¯¹è¿™å››ç±»èµ„æºè¿›è¡Œæœ‰æ•ˆçš„ç®¡ç†ã€‚å¤„ç†æœºç®¡ç†æ˜¯ç”¨äºåˆ†é…å’Œæ§åˆ¶å¤„ç†æœºï¼›å­˜å‚¨å™¨ç®¡ç†ä¸»è¦è´Ÿè´£å†…å­˜çš„åˆ†é…ä¸å›æ”¶ï¼›I/Oè®¾å¤‡ç®¡ç†æ˜¯è´Ÿè´£I/Oè®¾å¤‡çš„åˆ†é…ä¸æ“çºµï¼›æ–‡ä»¶ç®¡ç†æ˜¯ç”¨äºå®ç°å¯¹æ–‡ä»¶çš„å­˜å–ã€å…±äº«å’Œä¿æŠ¤ã€‚</li><li>OSå®ç°äº†å¯¹è®¡ç®—æœºèµ„æºçš„æŠ½è±¡<br> åœ¨è£¸æœºä¸­ï¼Œç”¨æˆ·å¦‚æœæƒ³è¦å¯¹è®¡ç®—å™¨è¿›è¡Œæ“ä½œï¼Œå¿…é¡»å¯¹ç‰©ç†æ¥å£çš„å®ç°ç»†èŠ‚æœ‰å……åˆ†çš„äº†è§£ã€‚ä½†åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œç”¨æˆ·å¹¶ä¸éœ€è¦å…³å¿ƒå…·ä½“çš„ç‰©ç†ï¼Œè€Œç”±æ“ä½œç³»ç»Ÿæ¥å®ç°å…·ä½“çš„æ“ä½œç»†èŠ‚ï¼Œå¹¶å‘ä¸Šè®²æ“ä½œè®¾å¤‡æŠ½è±¡ä¸ºä¸€ç»„æ•°æ®ç»“æ„ä»¥åŠä¸€ç»„æ“ä½œå‘½ä»¤ã€‚æ­¤æ—¶åœ¨ç”¨æˆ·çœ¼é‡Œï¼Œçœ‹åˆ°çš„æ˜¯ä¸€å°æ¯”è£¸æœºåŠŸèƒ½æ›´å¼ºï¼Œä½¿ç”¨æ›´æ–¹ä¾¿çš„æœºå™¨ã€‚</li></ol><h2 id="1-2-4-æ¨åŠ¨æ“ä½œç³»ç»Ÿå‘å±•çš„ä¸»è¦åŠ¨åŠ›"><a href="#1-2-4-æ¨åŠ¨æ“ä½œç³»ç»Ÿå‘å±•çš„ä¸»è¦åŠ¨åŠ›" class="headerlink" title="1.2.4 æ¨åŠ¨æ“ä½œç³»ç»Ÿå‘å±•çš„ä¸»è¦åŠ¨åŠ›"></a>1.2.4 æ¨åŠ¨æ“ä½œç³»ç»Ÿå‘å±•çš„ä¸»è¦åŠ¨åŠ›</h2><ol><li>ä¸æ–­æé«˜è®¡ç®—æœºèµ„æºåˆ©ç”¨ç‡</li><li>æ–¹ä¾¿ç”¨æˆ·</li><li>å™¨ä»¶çš„ä¸æ–­æ›´æ–°æ¢ä»£</li><li>è®¡ç®—æœºä½“ç³»ç»“æ„çš„ä¸æ–­å‘å±•</li><li>ä¸æ–­æå‡ºæ–°çš„åº”ç”¨éœ€æ±‚</li></ol><h1 id="1-3-æ“ä½œç³»ç»Ÿçš„å‘å±•"><a href="#1-3-æ“ä½œç³»ç»Ÿçš„å‘å±•" class="headerlink" title="1.3 æ“ä½œç³»ç»Ÿçš„å‘å±•"></a>1.3 æ“ä½œç³»ç»Ÿçš„å‘å±•</h1><h2 id="1-3-1-å•é“æ‰¹å¤„ç†ç³»ç»Ÿ"><a href="#1-3-1-å•é“æ‰¹å¤„ç†ç³»ç»Ÿ" class="headerlink" title="1.3.1 å•é“æ‰¹å¤„ç†ç³»ç»Ÿ"></a>1.3.1 å•é“æ‰¹å¤„ç†ç³»ç»Ÿ</h2><p>åœ¨è¯´å•é“æ‰¹å¤„ç†ä¹‹å‰ç°è¦å¼•å…¥ä¸€ä¸ªæ¦‚å¿µâ€”â€”ä½œä¸šã€‚ä½œä¸šåŒ…æ‹¬ç”¨æˆ·ç¨‹åºã€æ•°æ®ã€ä½œä¸šè¯´æ˜ä¹¦ã€‚è¿™æ ·æ¯ä¸€ä¸ªå¤„ç†å¯¹è±¡éƒ½æ˜¯ä½œä¸šã€‚</p><h3 id="1-å¤„ç†è¿‡ç¨‹"><a href="#1-å¤„ç†è¿‡ç¨‹" class="headerlink" title="1. å¤„ç†è¿‡ç¨‹"></a>1. å¤„ç†è¿‡ç¨‹</h3><p>æ¯ä¸ªå•é“æ‰¹å¤„ç†ç³»ç»Ÿéƒ½æœ‰ä¸€ä¸ªç³»ç»Ÿæ“ä½œå‘˜ã€‚ç”¨æˆ·å…ˆå°†ä½œä¸šäº¤ç»™ç³»ç»Ÿæ“ä½œå‘˜ï¼Œç„¶åæ“ä½œç³»ç»Ÿæ“ä½œå‘˜å°±å°†ä¸€ä¸ªä¸ªä½œä¸šç»„æˆä¸€æ‰¹ä½œä¸šï¼Œè¾“å…¥åˆ°è®¡ç®—æœºä¸­ï¼Œåœ¨ç³»ç»Ÿä¸­å½¢æˆä¸€ä¸ªè‡ªåŠ¨è½¬æ¥çš„ä½œä¸šæµï¼Œç„¶åå¯åŠ¨æ“ä½œç³»ç»Ÿå¯¹ä½œä¸šè‡ªåŠ¨ã€ä¾æ¬¡çš„å¤„ç†ï¼Œå¤„ç†å®Œæˆåå†å°†å¤„ç†ç»“æœè¿”å›ç»™ç³»ç»Ÿæ“ä½œå‘˜ï¼Œæ“ä½œå‘˜åœ¨è¿”å›ç»™ç”¨æˆ·ã€‚è¿™æ ·å°±å½¢æˆäº†ä¸€ä¸ªå•é“æ‰¹å¤„ç†è¿‡ç¨‹ã€‚<br><img src="https://cdn.littlecorgi.top/mweb/2019-07-19/15635340778216.png" alt="å•é“æ‰¹å¤„ç†ç³»ç»Ÿå¤„ç†è¿‡ç¨‹"></p><h3 id="2-ç¼ºç‚¹"><a href="#2-ç¼ºç‚¹" class="headerlink" title="2. ç¼ºç‚¹"></a>2. ç¼ºç‚¹</h3><p>ç³»ç»Ÿèµ„æºå¾—ä¸åˆ°å……åˆ†åˆ©ç”¨ã€‚è¿™æ˜¯å› ä¸ºåœ¨å†…å­˜ä¸­ä»…æœ‰ä¸€é“ç¨‹åºï¼Œæ¯é€¢ç¨‹åºåœ¨è¿è¡Œä¸­å‘å‡ºI/Oè¯·æ±‚åï¼ŒCPUä¾¿å¤„äºç­‰å¾…çŠ¶æ€ï¼Œå¿…é¡»åœ¨I/Oå®Œæˆåæ‰ç»§ç»­è¿è¡Œã€‚</p><h2 id="1-3-2-å¤šé“æ‰¹å¤„ç†ç³»ç»Ÿ"><a href="#1-3-2-å¤šé“æ‰¹å¤„ç†ç³»ç»Ÿ" class="headerlink" title="1.3.2 å¤šé“æ‰¹å¤„ç†ç³»ç»Ÿ"></a>1.3.2 å¤šé“æ‰¹å¤„ç†ç³»ç»Ÿ</h2><h3 id="1-å¤„ç†è¿‡ç¨‹-1"><a href="#1-å¤„ç†è¿‡ç¨‹-1" class="headerlink" title="1. å¤„ç†è¿‡ç¨‹"></a>1. å¤„ç†è¿‡ç¨‹</h3><p>åœ¨è¯¥ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·æ‰€æäº¤çš„ä½œä¸šå…ˆæ”¾åœ¨å¤–å­˜ä¸­ï¼Œå¹¶æ’æˆä¸€ä¸ªé˜Ÿåˆ—ï¼Œç§°ä¸ºâ€œåå¤‡é˜Ÿåˆ—â€œã€‚ç„¶åç”±ä½œä¸šè°ƒåº¦ç¨‹åºæŒ‰ä¸€å®šçš„ç®—æ³•ï¼Œä»åå¤‡é˜Ÿåˆ—ä¸­é€‰æ‹©è‹¥å¹²ä½œä¸šè°ƒå…¥å†…å­˜ã€‚ç”±äºåŒæ—¶åœ¨å†…å­˜ä¸­è£…æœ‰è‹¥å¹²é“ç¨‹åºï¼Œè¿™æ ·ä¾¿å¯ä»¥åœ¨è¿è¡Œç¨‹åºAæ—¶ï¼Œåˆ©ç”¨å…¶I/Oæ“ä½œæš‚åœæ‰§è¡Œæ—¶çš„CPUç©ºæ¡£æœŸï¼Œå†è°ƒåº¦å¦ä¸€é“ç¨‹åºBè¿è¡Œã€‚</p><h3 id="2-ä¼˜ç¼ºç‚¹"><a href="#2-ä¼˜ç¼ºç‚¹" class="headerlink" title="2. ä¼˜ç¼ºç‚¹"></a>2. ä¼˜ç¼ºç‚¹</h3><ol><li>ä¼˜ç‚¹<ol><li>èµ„æºåˆ©ç”¨ç‡é«˜</li><li>ç³»ç»Ÿååé‡å¤§</li></ol></li><li>ç¼ºç‚¹<ol><li>å¹³å‡å‘¨è½¬æ—¶é—´é•¿</li><li>æ— äº¤äº’èƒ½åŠ›</li></ol></li></ol><h2 id="1-3-3-åˆ†æ—¶ç³»ç»Ÿ"><a href="#1-3-3-åˆ†æ—¶ç³»ç»Ÿ" class="headerlink" title="1.3.3 åˆ†æ—¶ç³»ç»Ÿ"></a>1.3.3 åˆ†æ—¶ç³»ç»Ÿ</h2><h3 id="1-è¿è¡Œæ–¹å¼"><a href="#1-è¿è¡Œæ–¹å¼" class="headerlink" title="1. è¿è¡Œæ–¹å¼"></a>1. è¿è¡Œæ–¹å¼</h3><ol><li>ä½œä¸šç›´æ¥è¿›å…¥å†…å­˜ã€‚å› ä¸ºä½œä¸šåœ¨ç£ç›˜ä¸Šä¸å¯è¿è¡Œï¼Œæ‰€ä»¥ä½œä¸šåº”ç›´æ¥è¿›å…¥å†…å­˜</li><li>é‡‡ç”¨è½®è½¬è¿è¡Œæ–¹å¼ã€‚å¦‚æœä¸€ä¸ªä½œä¸šç‹¬å CPUè¿ç»­è¿è¡Œï¼Œé‚£ä¹ˆå…¶ä»–ä½œä¸šæ²¡æ³•è¿è¡Œã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¼•å…¥äº†æ—¶é—´ç‰‡æ¦‚å¿µã€‚ä¸€ä¸ªæ—¶é—´ç‰‡æ˜¯ä¸€ä¸ªå¾ˆçŸ­çš„æ—¶é—´ï¼Œç³»ç»Ÿè§„å®šäº†æ¯ä¸ªä½œä¸šæ¯æ¬¡åªèƒ½è¿è¡Œä¸€ä¸ªæ—¶é—´ç‰‡ï¼Œç„¶åå°±æš‚åœè¯¥ä½œä¸šçš„è¿è¡Œï¼Œå¹¶ç«‹å³è°ƒåº¦ä¸‹ä¸€ä¸ªä½œä¸šè¿è¡Œã€‚å¦‚æœåœ¨ä¸é•¿çš„æ—¶é—´å†…èƒ½ä½¿æ‰€æœ‰çš„ä½œä¸šéƒ½æ‰§è¡Œä¸€ä¸ªæ—¶é—´ç‰‡çš„æ—¶é—´ï¼Œä¾¿å¯ä»¥ä½¿æ¯ä¸ªç”¨æˆ·éƒ½èƒ½åŠæ—¶åœ°ä¸è‡ªå·±çš„ä½œä¸šè¿›è¡Œäº¤äº’ï¼Œä»è€Œä½¿ç”¨æˆ·çš„è¯·æ±‚çš„åˆ°åŠæ—¶å“åº”ã€‚</li></ol><h3 id="2-ç‰¹å¾"><a href="#2-ç‰¹å¾" class="headerlink" title="2. ç‰¹å¾"></a>2. ç‰¹å¾</h3><ol><li>å¤šè·¯æ€§</li><li>ç‹¬ç«‹æ€§</li><li>åŠæ—¶æ€§</li><li>äº¤äº’æ€§</li></ol><h2 id="1-3-4-å®æ—¶ç³»ç»Ÿ"><a href="#1-3-4-å®æ—¶ç³»ç»Ÿ" class="headerlink" title="1.3.4 å®æ—¶ç³»ç»Ÿ"></a>1.3.4 å®æ—¶ç³»ç»Ÿ</h2><p>å®æ—¶ç³»ç»Ÿæ˜¯æŒ‡ç³»ç»Ÿèƒ½åŠæ—¶å“åº”å¤–éƒ¨äº‹ä»¶çš„è¯·æ±‚ï¼Œåœ¨è§„å®šæ—¶é—´å†…å®Œæˆå¯¹è¯¥äº‹ä»¶çš„å¤„ç†ï¼Œå¹¶æ§åˆ¶æ‰€æœ‰å®æ—¶ä»»åŠ¡åè°ƒä¸€è‡´åœ°è¿è¡Œã€‚<br>å®æ—¶ç³»ç»Ÿä¸»è¦åº”ç”¨äºï¼š</p><ol><li>å·¥ä¸šï¼ˆæ­¦å™¨ï¼‰æ§åˆ¶ç³»ç»Ÿ</li><li>ä¿¡æ¯æŸ¥è¯¢ç³»ç»Ÿ</li><li>å¤šåª’ä½“ç³»ç»Ÿ</li><li>åµŒå…¥å¼ç³»ç»Ÿ</li></ol><h1 id="1-4-æ“ä½œç³»ç»Ÿçš„åŸºæœ¬ç‰¹å¾"><a href="#1-4-æ“ä½œç³»ç»Ÿçš„åŸºæœ¬ç‰¹å¾" class="headerlink" title="1.4 æ“ä½œç³»ç»Ÿçš„åŸºæœ¬ç‰¹å¾"></a>1.4 æ“ä½œç³»ç»Ÿçš„åŸºæœ¬ç‰¹å¾</h1><h2 id="1-4-1-å¹¶å‘"><a href="#1-4-1-å¹¶å‘" class="headerlink" title="1.4.1 å¹¶å‘"></a>1.4.1 å¹¶å‘</h2><p>æ­£æ˜¯ç³»ç»Ÿä¸­æœ‰è¿™ä¸€ç‰¹å¾ï¼Œæ‰ä½¿å¾—OSèƒ½æœ‰æ•ˆåœ°æé«˜ç³»ç»Ÿä¸­çš„èµ„æºåˆ©ç”¨ç‡ï¼Œå¢åŠ ç³»ç»Ÿçš„ååé‡ã€‚</p><h3 id="å¹¶å‘ä¸å¹¶è¡Œ"><a href="#å¹¶å‘ä¸å¹¶è¡Œ" class="headerlink" title="å¹¶å‘ä¸å¹¶è¡Œ"></a>å¹¶å‘ä¸å¹¶è¡Œ</h3><p>å¹¶è¡Œæ˜¯æŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹ä»¶åœ¨åŒä¸€æ—¶åˆ»å‘ç”Ÿï¼Œå¾®è§‚ä¸Šæ˜¯åŒä¸€æ—¶åˆ»å¤šä¸ªçº¿ç¨‹åœ¨CPUä¸Šè¿è¡Œã€‚<br>å¹¶å‘æ˜¯æŒ‡å®è§‚ä¸Šä¸¤ä¸ªæˆ–å¤šä¸ªäº‹ä»¶åœ¨åŒä¸€æ—¶é—´å‘ç”Ÿï¼Œå¾®è§‚ä¸Šç¼ºæ˜¯æŸä¸€æ—¶åˆ»CPUä¸Šåªæœ‰ä¸€ä¸ªè¿›ç¨‹ã€‚</p><h2 id="1-4-2-å…±äº«"><a href="#1-4-2-å…±äº«" class="headerlink" title="1.4.2 å…±äº«"></a>1.4.2 å…±äº«</h2><p>èµ„æºå…±äº«ï¼Œå³æ“ä½œç³»ç»Ÿä¸­çš„èµ„æºå¯ä¾›å¤šä¸ªå¹¶å‘æ‰§è¡Œçš„è¿›ç¨‹å…±åŒä½¿ç”¨ï¼Œç”±äºèµ„æºå±æ€§ä¸åŒï¼Œå¤šä¸ªè¿›ç¨‹å¯¹èµ„æºçš„å…±äº«æ–¹å¼ä¹Ÿä¸åŒã€‚å¯åˆ†ä¸ºï¼šäº’æ–¥å…±äº«æ–¹å¼å’ŒåŒæ—¶è®¿é—®æ–¹å¼ã€‚</p><h3 id="1-äº’æ–¥å…±äº«æ–¹å¼"><a href="#1-äº’æ–¥å…±äº«æ–¹å¼" class="headerlink" title="1. äº’æ–¥å…±äº«æ–¹å¼"></a>1. äº’æ–¥å…±äº«æ–¹å¼</h3><p>ä¸€æ®µæ—¶é—´å†…åªå…è®¸ä¸€ä¸ªè¿›ç¨‹è®¿é—®è¯¥èµ„æºï¼Œå¦‚ç£å¸¦æœº,æ‰“å°æœºç­‰ã€‚è™½ç„¶å¯ä»¥ä¾›å¤šä¸ªè¿›ç¨‹ä½¿ç”¨ï¼Œä½†æ˜¯ä¸ºäº†æ‰“å°æˆ–è®°å½•ç»“æœä¸é€ æˆæ··æ·†ï¼Œåº”è§„å®šä¸€æ®µæ—¶é—´å†…åªå…è®¸ä¸€ä¸ªè¿›ç¨‹è®¿é—®è¯¥èµ„æºã€‚</p><h3 id="2-åŒæ—¶è®¿é—®æ–¹å¼"><a href="#2-åŒæ—¶è®¿é—®æ–¹å¼" class="headerlink" title="2. åŒæ—¶è®¿é—®æ–¹å¼"></a>2. åŒæ—¶è®¿é—®æ–¹å¼</h3><p>æŸäº›èµ„æºï¼Œä¸€æ®µæ—¶é—´å†…æ˜¯å¯ä»¥å…è®¸å¤šä¸ªè¿›ç¨‹â€œåŒæ—¶â€åŒæ—¶å¯¹ä»–ä»¬è¿›è¡Œè®¿é—®ï¼Œè¿™ä¸ªåŒæ—¶æ˜¯å®è§‚ä¸Šçš„ï¼Œåœ¨å¾®è§‚ä¸Šå¯èƒ½æ˜¯åˆ†æ—¶å…±äº«ã€‚</p><h2 id="1-4-3-è™šæ‹Ÿ"><a href="#1-4-3-è™šæ‹Ÿ" class="headerlink" title="1.4.3 è™šæ‹Ÿ"></a>1.4.3 è™šæ‹Ÿ</h2><p>åœ¨OSä¸­ï¼ŒæŠŠé€šè¿‡æŸç§æŠ€æœ¯å°†ä¸€ä¸ªç‰©ç†å®ä½“å˜ä¸ºè‹¥å¹²ä¸ªé€»è¾‘ä¸Šçš„å¯¹åº”ç‰©çš„åŠŸèƒ½ç§°ä¸ºâ€è™šæ‹Ÿâ€œã€‚</p><h2 id="1-4-4-å¼‚æ­¥"><a href="#1-4-4-å¼‚æ­¥" class="headerlink" title="1.4.4 å¼‚æ­¥"></a>1.4.4 å¼‚æ­¥</h2><p>åœ¨å¤šé“ç¯å¢ƒä¸‹ï¼Œå…è®¸å¤šä¸ªç¨‹åºå¹¶å‘æ‰§è¡Œã€‚ä½†ç”±äºèµ„æºæœ‰é™ï¼Œè¿›ç¨‹çš„æ‰§è¡Œä¸æ˜¯ä¸€è´¯åˆ°åº•ã€‚è€Œæ˜¯èµ°èµ°åœåœï¼Œä»¥ä¸å¯é¢„çŸ¥çš„é€Ÿåº¦å‘å‰æ¨è¿›ï¼Œè¿™å°±æ˜¯è¿›ç¨‹çš„å¼‚æ­¥ã€‚</p><h1 id="1-5-æ“ä½œç³»ç»Ÿçš„ä¸»è¦åŠŸèƒ½"><a href="#1-5-æ“ä½œç³»ç»Ÿçš„ä¸»è¦åŠŸèƒ½" class="headerlink" title="1.5 æ“ä½œç³»ç»Ÿçš„ä¸»è¦åŠŸèƒ½"></a>1.5 æ“ä½œç³»ç»Ÿçš„ä¸»è¦åŠŸèƒ½</h1><p>æ“ä½œç³»ç»Ÿçš„ä¸»è¦åŠŸèƒ½åº”åˆ†ä¸ºå¤„ç†æœºç®¡ç†ã€å­˜å‚¨å™¨ç®¡ç†ã€è®¾å¤‡ç®¡ç†å’Œæ–‡ä»¶ç®¡ç†ã€‚æ­¤å¤–ï¼Œè¿˜åº”å‘ç”¨æˆ·æä¾›æ–¹ä¾¿çš„ç”¨æˆ·æ¥å£ã€‚</p><h2 id="1-5-1-å¤„ç†æœºç®¡ç†åŠŸèƒ½"><a href="#1-5-1-å¤„ç†æœºç®¡ç†åŠŸèƒ½" class="headerlink" title="1.5.1 å¤„ç†æœºç®¡ç†åŠŸèƒ½"></a>1.5.1 å¤„ç†æœºç®¡ç†åŠŸèƒ½</h2><h3 id="1-è¿›ç¨‹æ§åˆ¶"><a href="#1-è¿›ç¨‹æ§åˆ¶" class="headerlink" title="1. è¿›ç¨‹æ§åˆ¶"></a>1. è¿›ç¨‹æ§åˆ¶</h3><p>åœ¨å¤šé“ç¨‹åºç¯å¢ƒä¸­ï¼Œä¸ºäº†ä½¿ä½œä¸šèƒ½å¹¶å‘æ‰§è¡Œï¼Œå¿…é¡»ä¸ºæ¯é“ä½œä¸šåˆ›å»ºä¸€ä¸ªæˆ–å‡ ä¸ªè¿›ç¨‹ï¼Œå¹¶ä¸ºä¹‹åˆ†é…å¿…è¦çš„èµ„æºã€‚å½“è¿›ç¨‹è¿è¡Œç»“æŸæ—¶ï¼Œåº”ç«‹å³æ’¤é”€è¯¥è¿›ç¨‹ï¼Œä»¥ä¾¿èƒ½åŠæ—¶å›æ”¶è¯¥è¿›ç¨‹æ‰€å ç”¨çš„å„ç§èµ„æºï¼Œä¾›å…¶å®ƒè¿›ç¨‹ä½¿ç”¨ã€‚</p><h3 id="2-è¿›ç¨‹åŒæ­¥"><a href="#2-è¿›ç¨‹åŒæ­¥" class="headerlink" title="2. è¿›ç¨‹åŒæ­¥"></a>2. è¿›ç¨‹åŒæ­¥</h3><p>ä¸ºäº†ä½¿å¤šä¸ªè¿›ç¨‹èƒ½æœ‰æ¡ä¸ç´Šçš„è¿è¡Œï¼Œç³»ç»Ÿä¸­å¿…é¡»è®¾ç½®ç›¸åº”çš„è¿›ç¨‹åŒæ­¥æœºåˆ¶ã€‚è¯¥æœºåˆ¶çš„ä¸»è¦ä»»åŠ¡æ˜¯ä¸ºå¤šä¸ªè¿›ç¨‹çš„è¿è¡Œè¿›è¡Œåè°ƒã€‚</p><h3 id="3-è¿›ç¨‹é€šä¿¡"><a href="#3-è¿›ç¨‹é€šä¿¡" class="headerlink" title="3. è¿›ç¨‹é€šä¿¡"></a>3. è¿›ç¨‹é€šä¿¡</h3><p>å¦‚æœä¸€ç»„ç›¸äº’åˆä½œçš„è¿›ç¨‹å»å®Œæˆä¸€ä¸ªå…±åŒçš„ä»»åŠ¡æ—¶ï¼Œåœ¨ä»–ä»¬ä¹‹é—´å¾€å¾€éœ€è¦äº¤æ¢ä¿¡æ¯ã€‚</p><h3 id="4-è°ƒåº¦"><a href="#4-è°ƒåº¦" class="headerlink" title="4. è°ƒåº¦"></a>4. è°ƒåº¦</h3><p>åœ¨ä¼ ç»ŸOSä¸­ï¼Œè°ƒåº¦åŒ…æ‹¬ä½œä¸šè°ƒåº¦å’Œè¿›ç¨‹è°ƒåº¦ã€‚</p><ol><li>ä½œä¸šè°ƒåº¦<br> ä½œä¸šè°ƒåº¦çš„åŸºæœ¬ä»»åŠ¡å°±æ˜¯ä»åå¤‡é˜Ÿåˆ—ä¸­æŒ‰ç…§ä¸€å®šçš„ç®—æ³•é€‰æ‹©å‡ºè‹¥å¹²ä¸ªä½œä¸šï¼Œä¸ºä»–ä»¬åˆ†é…æ‰€éœ€èµ„æºï¼Œåœ¨è¿™äº›ä½œä¸šè°ƒå…¥å†…å­˜åï¼Œåˆ†åˆ«ä¸ºä»–ä»¬åˆ›å»ºè¿›ç¨‹ï¼Œæ˜¯ä»–ä»¬éƒ½ç§°ä¸ºå¯èƒ½è·å¾—å¤„ç†æœºçš„å°±ç»ªè¿›ç¨‹ï¼Œå¹¶å°†ä»–ä»¬æ’å…¥å°±ç»ªé˜Ÿåˆ—ä¸­ã€‚</li><li>è¿›ç¨‹è°ƒåº¦<br> è¿›ç¨‹è°ƒåº¦çš„ä»»åŠ¡æ˜¯ä»è¿›ç¨‹çš„å°±ç»ªé˜Ÿåˆ—ä¸­æŒ‰ç…§ä¸€å®šçš„ç®—æ³•é€‰å‡ºä¸€ä¸ªè¿›ç¨‹ï¼Œå°†å¤„ç†æœºåˆ†é…ç»™ä»–ï¼Œå¹¶ä¸ºä»–è®¾ç½®è¿è¡Œçº¿ç¨‹ï¼Œä½¿å…¶æŠ•å…¥æ‰§è¡Œã€‚</li></ol><h2 id="1-5-2-å­˜å‚¨å™¨ç®¡ç†åŠŸèƒ½"><a href="#1-5-2-å­˜å‚¨å™¨ç®¡ç†åŠŸèƒ½" class="headerlink" title="1.5.2 å­˜å‚¨å™¨ç®¡ç†åŠŸèƒ½"></a>1.5.2 å­˜å‚¨å™¨ç®¡ç†åŠŸèƒ½</h2><p>å­˜å‚¨å™¨ç®¡ç†è§†ä¸ºå¤šé“ç¨‹åºçš„è¿è¡Œæä¾›è‰¯å¥½çš„ç¯å¢ƒï¼Œæé«˜å­˜å‚¨å™¨åˆ©ç”¨ç‡ï¼Œå¹¶èƒ½ä»é€»è¾‘ä¸Šæ‰©å……å†…å­˜ã€‚ä¸ºæ­¤ï¼Œå­˜å‚¨å™¨ç®¡ç†åº”å…·æœ‰å†…å­˜åˆ†é…å’Œå›æ”¶ã€å†…å­˜ä¿æŠ¤ã€åœ°å€æ˜ å°„å’Œå†…å­˜æ‰©å……ç­‰åŠŸèƒ½ã€‚</p><h3 id="1-å†…å­˜åˆ†é…"><a href="#1-å†…å­˜åˆ†é…" class="headerlink" title="1. å†…å­˜åˆ†é…"></a>1. å†…å­˜åˆ†é…</h3><p>å†…å­˜åˆ†é…ä¸»è¦ä»»åŠ¡æ˜¯ï¼š</p><ol><li>ä¸ºæ¯é“ç¨‹åºåˆ†é…å†…å­˜ç©ºé—´</li><li>æé«˜å­˜å‚¨å™¨çš„åˆ©ç”¨ç‡ï¼Œå°½é‡å‡å°‘ä¸å¯ç”¨çš„å†…å­˜ç©ºé—´</li><li>å…è®¸æ­£åœ¨è¿è¡Œçš„ç¨‹åºç”³è¯·é™„åŠ çš„å†…å­˜ç©ºé—´ï¼Œä»¥é€‚åº”ç¨‹åºå’Œæ•°æ®åŠ¨æ€å¢é•¿çš„éœ€è¦ã€‚</li></ol><p>OSåœ¨å®ç°å†…å­˜åˆ†é…æ—¶ï¼Œå¯é‡‡å–é™æ€å’ŒåŠ¨æ€ä¸¤ç§æ–¹å¼ï¼š</p><ol><li>é™æ€åˆ†é…å†…å­˜ã€‚æ¯ä¸ªä½œä¸šçš„å†…å­˜ç©ºé—´åœ¨ä½œä¸šè£…å…¥æ—¶ç¡®å®šï¼Œç¡®å®šåä¸å†æ”¹å˜ã€‚</li><li>åŠ¨æ€åˆ†é…å†…å­˜ã€‚æ¯ä¸ªä½œä¸šæ‰€è¦æ±‚çš„çš„åŸºæœ¬å†…å­˜ç©ºé—´è™½ç„¶ä¹Ÿæ˜¯åœ¨è£…å…¥æ—¶ç¡®å®šçš„ï¼Œä½†å…è®¸ä½œä¸šåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ç»§ç»­ç”³è¯·æ–°çš„é™„åŠ å†…å­˜ç©ºé—´ï¼Œä»¥é€‚åº”ç¨‹åºå’Œæ•°æ®çš„åŠ¨æ€å¢é•¿ã€‚</li></ol><h3 id="2-å†…å­˜ä¿æŠ¤"><a href="#2-å†…å­˜ä¿æŠ¤" class="headerlink" title="2. å†…å­˜ä¿æŠ¤"></a>2. å†…å­˜ä¿æŠ¤</h3><p>ç¡®ä¿æ¯é“ç”¨æˆ·ç¨‹åºéƒ½åœ¨è‡ªå·±çš„å†…å­˜ç©ºé—´å†…è¿è¡Œï¼Œå½¼æ­¤äº’ä¸å¹²æ‰°ã€‚å†³ä¸å…è®¸ç”¨æˆ·ç¨‹åºè®¿é—®æ“ä½œç³»ç»Ÿçš„ç¨‹åºå’Œæ•°æ®ï¼Œä¹Ÿä¸å…è®¸ç”¨æˆ·ç¨‹åºè½¬ç§»åˆ°éå…±äº«çš„å…¶ä»–ç”¨æˆ·ç¨‹åºä¸­å»æ‰§è¡Œã€‚</p><h3 id="3-åœ°å€æ˜ å°„"><a href="#3-åœ°å€æ˜ å°„" class="headerlink" title="3. åœ°å€æ˜ å°„"></a>3. åœ°å€æ˜ å°„</h3><p>æ¯é“ç¨‹åºç»ç¼–è¯‘è¿æ¥åæ‰€å½¢æˆçš„çš„å¯è£…å…¥ç¨‹åºå…¶åœ°å€éƒ½æ˜¯ä»0å¼€å§‹çš„ï¼Œä½†æ˜¯ä¸å¯èƒ½å°†ä»–ä»¬ä»â€œ0â€åœ°å€å¼€å§‹è£…å…¥å†…å­˜ï¼Œæ‰€ä»¥ç‰©ç†åœ°å€å’Œé€»è¾‘åœ°å€å¹¶ä¸ä¸€è‡´ï¼Œè¿™æ—¶å€™å°±éœ€è¦åœ°å€æ˜ å°„æ¥è®©ç¨‹åºèƒ½æ­£å¸¸è¿è¡Œã€‚</p><h3 id="4-å†…å­˜æ‰©å……"><a href="#4-å†…å­˜æ‰©å……" class="headerlink" title="4. å†…å­˜æ‰©å……"></a>4. å†…å­˜æ‰©å……</h3><p>å€ŸåŠ©è™šæ‹Ÿå­˜å‚¨æŠ€æœ¯æ¥å®ç°å†…å­˜æ‰©å……ï¼Œä¸»è¦è§£å†³ï¼š</p><ol><li>å†…å­˜å’ŒI/Oä¹‹é—´é€Ÿåº¦ä¸åŒ¹é…çš„é—®é¢˜</li><li>å¦‚æœå†…å­˜ç©ºé—´ä¸è¶³çš„é—®é¢˜</li></ol><h2 id="1-5-3-è®¾å¤‡ç®¡ç†åŠŸèƒ½"><a href="#1-5-3-è®¾å¤‡ç®¡ç†åŠŸèƒ½" class="headerlink" title="1.5.3 è®¾å¤‡ç®¡ç†åŠŸèƒ½"></a>1.5.3 è®¾å¤‡ç®¡ç†åŠŸèƒ½</h2><p>ä¸»è¦ä»»åŠ¡ï¼š</p><ol><li>å®Œæˆç”¨æˆ·è¿›ç¨‹æå‡ºçš„I/Oè¯·æ±‚ï¼Œä¸ºç”¨æˆ·è¿›ç¨‹åˆ†é…æ‰€éœ€çš„I/Oè®¾å¤‡ï¼Œå¹¶å®ŒæˆæŒ‡å®šçš„I/Oæ“ä½œ</li><li>æé«˜CPUä¸I/Oè®¾å¤‡çš„åˆ©ç”¨ç‡ï¼Œæé«˜I/Oé€Ÿåº¦ï¼Œæ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨I/O</li></ol><p>ä¸ºäº†å®ç°ä»¥ä¸ŠåŠŸèƒ½ï¼Œåº”å…·æœ‰ç¼“å†²ç®¡ç†ã€è®¾å¤‡åˆ†é…å’Œè®¾å¤‡å¤„ç†ä»¥åŠè™šæ‹Ÿè®¾å¤‡ç­‰åŠŸèƒ½ã€‚</p><h3 id="1-ç¼“å†²ç®¡ç†"><a href="#1-ç¼“å†²ç®¡ç†" class="headerlink" title="1. ç¼“å†²ç®¡ç†"></a>1. ç¼“å†²ç®¡ç†</h3><p>ä¸ºäº†æœ‰æ•ˆçš„ç¼“å’ŒCPUä¸I/Oè®¾å¤‡é—´é€Ÿåº¦ä¸åŒ¹é…çš„é—®é¢˜ï¼Œæé«˜CPUåˆ©ç”¨ç‡ï¼Œäºæ˜¯å¼•å…¥äº†ç¼“å†²ç®¡ç†ã€‚</p><h3 id="2-è®¾å¤‡åˆ†é…"><a href="#2-è®¾å¤‡åˆ†é…" class="headerlink" title="2. è®¾å¤‡åˆ†é…"></a>2. è®¾å¤‡åˆ†é…</h3><p>è®¾å¤‡åˆ†é…çš„åŸºæœ¬ä»»åŠ¡æ˜¯æ ¹æ®ç”¨æˆ·è¿›ç¨‹çš„I/Oè¯·æ±‚ã€ç³»ç»Ÿç°æœ‰èµ„æºæƒ…å†µä»¥åŠæŒ‰ç…§æŸç§è®¾å¤‡åˆ†é…ç­–ç•¥ï¼Œä¸ºä¹‹åˆ†é…å…¶æ‰€éœ€çš„è®¾å¤‡ã€‚</p><h3 id="3-è®¾å¤‡å¤„ç†"><a href="#3-è®¾å¤‡å¤„ç†" class="headerlink" title="3. è®¾å¤‡å¤„ç†"></a>3. è®¾å¤‡å¤„ç†</h3><p>å®ç°CPUå’Œè®¾å¤‡æ§åˆ¶å™¨ä¹‹é—´çš„é€šä¿¡ï¼Œå³ç”±CPUå‘è®¾å¤‡æ§åˆ¶å™¨å‘å‡ºI/Oå‘½ä»¤ï¼Œè¦æ±‚ä»–å®ŒæˆæŒ‡å®šçš„I/Oæ“ä½œï¼›åä¹‹ï¼Œç”±CPUæ§åˆ¶ä»æ¥æ”¶å™¨å‘æ¥çš„ä¸­æ–­è¯·æ±‚ï¼Œå¹¶ç»™äºˆè¿…é€Ÿçš„å“åº”å’Œç›¸åº”çš„å¤„ç†ã€‚</p><h2 id="1-5-4-æ–‡ä»¶ç®¡ç†åŠŸèƒ½"><a href="#1-5-4-æ–‡ä»¶ç®¡ç†åŠŸèƒ½" class="headerlink" title="1.5.4 æ–‡ä»¶ç®¡ç†åŠŸèƒ½"></a>1.5.4 æ–‡ä»¶ç®¡ç†åŠŸèƒ½</h2><p>ä¸»è¦æ˜¯å¯¹ç”¨æˆ·æ–‡ä»¶å’Œç³»ç»Ÿæ–‡ä»¶è¿›è¡Œç®¡ç†ä»¥æ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨ï¼Œå¹¶ä¿è¯æ–‡ä»¶çš„å®‰å…¨æ€§ã€‚ä¸ºæ­¤ï¼Œæ–‡ä»¶ç®¡ç†åº”å…·æœ‰å¯¹æ–‡ä»¶å­˜å‚¨ç©ºé—´ç®¡ç†ã€ç›®å½•ç®¡ç†ã€æ–‡ä»¶çš„è¯»/å†™ç®¡ç†ä»¥åŠæ–‡ä»¶çš„å…±äº«ä¸ä¿æŠ¤ç­‰åŠŸèƒ½ã€‚</p><h3 id="1-æ–‡ä»¶å­˜å‚¨ç©ºé—´çš„ç®¡ç†"><a href="#1-æ–‡ä»¶å­˜å‚¨ç©ºé—´çš„ç®¡ç†" class="headerlink" title="1. æ–‡ä»¶å­˜å‚¨ç©ºé—´çš„ç®¡ç†"></a>1. æ–‡ä»¶å­˜å‚¨ç©ºé—´çš„ç®¡ç†</h3><p>ä¸ºæ¯ä¸ªæ–‡ä»¶åˆ†é…å¿…è¦çš„å¤–å­˜ç©ºé—´ï¼Œæé«˜æˆ‘æ‘åˆ©ç”¨ç‡ï¼Œè¿›è€Œæé«˜æ–‡ä»¶ç³»ç»Ÿçš„å­˜ã€å–é€Ÿåº¦ã€‚</p><h3 id="2-ç›®å½•ç®¡ç†"><a href="#2-ç›®å½•ç®¡ç†" class="headerlink" title="2. ç›®å½•ç®¡ç†"></a>2. ç›®å½•ç®¡ç†</h3><p>ä¸ºæ¯ä¸ªæ–‡ä»¶å»ºç«‹ä¸€ä¸ªç›®å½•é¡¹ï¼Œç›®å½•é¡¹åŒ…æ‹¬æ–‡ä»¶åã€æ–‡ä»¶å±æ€§ã€æ–‡ä»¶åœ¨ç£ç›˜ä¸Šçš„ç‰©ç†ä½ç½®ç­‰ï¼Œå¹¶å¯¹ä¼—å¤šçš„ç›®å½•é¡¹åŠ ä»¥æœ‰æ•ˆçš„ç»„ç»‡ï¼Œä»¥å®ç°æ–¹ä¾¿çš„æŒ‰åå­—å­˜å–ã€‚</p><h3 id="3-æ–‡ä»¶çš„è¯»-å†™ç®¡ç†å’Œä¿æŠ¤"><a href="#3-æ–‡ä»¶çš„è¯»-å†™ç®¡ç†å’Œä¿æŠ¤" class="headerlink" title="3. æ–‡ä»¶çš„è¯»/å†™ç®¡ç†å’Œä¿æŠ¤"></a>3. æ–‡ä»¶çš„è¯»/å†™ç®¡ç†å’Œä¿æŠ¤</h3><p>æ ¹æ®ç”¨æˆ·çš„è¯·æ±‚ï¼Œä»å¤–å­˜ä¸­è¯»å–æ•°æ®æˆ–å°†æ•°æ®å†™å…¥å¤–å­˜ã€‚å¹¶ä¸”ä¿æŠ¤æ–‡ä»¶é˜²æ­¢å…¶è¢«éæ³•ç›—å–å’Œç ´åã€‚</p><h2 id="1-5-5-æ“ä½œç³»ç»Ÿä¸ç”¨æˆ·é—´çš„æ¥å£"><a href="#1-5-5-æ“ä½œç³»ç»Ÿä¸ç”¨æˆ·é—´çš„æ¥å£" class="headerlink" title="1.5.5 æ“ä½œç³»ç»Ÿä¸ç”¨æˆ·é—´çš„æ¥å£"></a>1.5.5 æ“ä½œç³»ç»Ÿä¸ç”¨æˆ·é—´çš„æ¥å£</h2><p>æ¥å£ä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼šç”¨æˆ·æ¥å£å’Œç¨‹åºæ¥å£ã€‚ç”¨æˆ·æ¥å£æ˜¯ä¾›ç”¨æˆ·è°ƒç”¨ï¼Œæ–¹ä¾¿ç”¨æˆ·ç›´æ¥æˆ–é—´æ¥æ§åˆ¶è‡ªå·±çš„ä½œä¸šã€‚ç¨‹åºæ¥å£æ˜¯ä¸ºç”¨æˆ·ç¨‹åºåœ¨æ‰§è¡Œä¸­è®¿é—®ç³»ç»Ÿèµ„æºè€Œè®¾å®šçš„ï¼Œæ˜¯ç”¨æˆ·å–å¾—æ“ä½œç³»ç»ŸæœåŠ¡çš„å”¯ä¸€é€”å¾„ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ</category>
      
      
      <comments>https://www.littlecorgi.top/posts/62248b34.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Androidå¤šçº¿ç¨‹2--Javaä¸­çš„çº¿ç¨‹æ± </title>
      <link>https://www.littlecorgi.top/posts/b39fd0ab.html</link>
      <guid>https://www.littlecorgi.top/posts/b39fd0ab.html</guid>
      <pubDate>Sun, 16 Jun 2019 07:49:47 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;ç®€ä»‹&quot;&gt;&lt;a href=&quot;#ç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;ç®€ä»‹&quot;&gt;&lt;/a&gt;ç®€ä»‹&lt;/h1&gt;&lt;p&gt;æˆ‘ä»¬åœ¨å†™é¡¹ç›®ç»å¸¸è¦ç”¨åˆ°å¤šçº¿ç¨‹ã€‚ä½†æ˜¯çº¿ç¨‹çš„åˆ›å»ºå’Œæ‘§æ¯éƒ½æ˜¯è¾ƒæ¶ˆè€—èµ„æºå’Œæ€§èƒ½çš„ï¼Œå¦‚æœä½ æ¯éœ€è¦ä¸€ä¸ªä»»åŠ¡å°±æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œé‚£å¯èƒ½ä¼šåœ¨çº¿ç¨‹çš„åˆ›å»ºå’Œæ‘§æ¯ä¸Šæµªè´¹æ‰å¾ˆå¤šèµ„æºã€‚é‚£å¦‚æœæˆ‘ä»¬è®©çº¿ç¨‹æ‰§è¡Œä»»åŠ¡åä¸æ‘§æ¯ï¼Œæ¥ç€æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ï¼Œè¿™æ ·æ˜¯ä¸æ˜¯å°±èƒ½é¿å…è¿™ç§æƒ…å†µäº†ã€‚Java1.5ä¸­æä¾›äº†&lt;code&gt;Executor&lt;/code&gt;æ¡†æ¶ç”¨äºæŠŠä»»åŠ¡çš„æäº¤å’Œæ‰§è¡Œè§£è€¦ï¼Œä»»åŠ¡çš„æ‰§è¡Œå°±äº¤ç»™&lt;code&gt;Runnable&lt;/code&gt;æˆ–è€…&lt;code&gt;Callable&lt;/code&gt;ï¼Œè€Œ&lt;code&gt;Executor&lt;/code&gt;æ¡†æ¶ç”¨äºå¤„ç†ä»»åŠ¡ã€‚&lt;code&gt;Executor&lt;/code&gt;ä¸­æœ€æ ¸å¿ƒçš„æˆå‘˜å°±æ˜¯&lt;code&gt;ThreadPoolExecutor&lt;/code&gt;ï¼Œä»–å°±æ˜¯çº¿ç¨‹æ± æ ¸å¿ƒå®ç°ç±»ã€‚&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>æˆ‘ä»¬åœ¨å†™é¡¹ç›®ç»å¸¸è¦ç”¨åˆ°å¤šçº¿ç¨‹ã€‚ä½†æ˜¯çº¿ç¨‹çš„åˆ›å»ºå’Œæ‘§æ¯éƒ½æ˜¯è¾ƒæ¶ˆè€—èµ„æºå’Œæ€§èƒ½çš„ï¼Œå¦‚æœä½ æ¯éœ€è¦ä¸€ä¸ªä»»åŠ¡å°±æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œé‚£å¯èƒ½ä¼šåœ¨çº¿ç¨‹çš„åˆ›å»ºå’Œæ‘§æ¯ä¸Šæµªè´¹æ‰å¾ˆå¤šèµ„æºã€‚é‚£å¦‚æœæˆ‘ä»¬è®©çº¿ç¨‹æ‰§è¡Œä»»åŠ¡åä¸æ‘§æ¯ï¼Œæ¥ç€æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ï¼Œè¿™æ ·æ˜¯ä¸æ˜¯å°±èƒ½é¿å…è¿™ç§æƒ…å†µäº†ã€‚Java1.5ä¸­æä¾›äº†<code>Executor</code>æ¡†æ¶ç”¨äºæŠŠä»»åŠ¡çš„æäº¤å’Œæ‰§è¡Œè§£è€¦ï¼Œä»»åŠ¡çš„æ‰§è¡Œå°±äº¤ç»™<code>Runnable</code>æˆ–è€…<code>Callable</code>ï¼Œè€Œ<code>Executor</code>æ¡†æ¶ç”¨äºå¤„ç†ä»»åŠ¡ã€‚<code>Executor</code>ä¸­æœ€æ ¸å¿ƒçš„æˆå‘˜å°±æ˜¯<code>ThreadPoolExecutor</code>ï¼Œä»–å°±æ˜¯çº¿ç¨‹æ± æ ¸å¿ƒå®ç°ç±»ã€‚</p><span id="more"></span><h1 id="ThreadPoolExecutor"><a href="#ThreadPoolExecutor" class="headerlink" title="ThreadPoolExecutor"></a>ThreadPoolExecutor</h1><p>æˆ‘ä»¬ç°åœ¨å…ˆæ¥çœ‹ä¸‹è¿™ä¸ªæ–¹æ³•ã€‚<br>æ„é€ å™¨ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ThreadPoolExecutor</span><span class="params">(<span class="type">int</span> corePoolSize,</span></span><br><span class="line"><span class="params">                        <span class="type">int</span> maximumPoolSize,markdownlint</span></span><br><span class="line"><span class="params">                        <span class="type">long</span> keepAliveTime,</span></span><br><span class="line"><span class="params">                        TimeUnit unit,</span></span><br><span class="line"><span class="params">                        BlockingQueue&lt;Runnable&gt; workQueue,</span></span><br><span class="line"><span class="params">                        ThreadFactory threadFactory,</span></span><br><span class="line"><span class="params">                        RejectedExecutionHandler handler)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (corePoolSize &lt; <span class="number">0</span> ||</span><br><span class="line">        maximumPoolSize &lt;= <span class="number">0</span> ||</span><br><span class="line">        maximumPoolSize &lt; corePoolSize ||</span><br><span class="line">        keepAliveTime &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>();</span><br><span class="line">    <span class="keyword">if</span> (workQueue == <span class="literal">null</span> || threadFactory == <span class="literal">null</span> || handler == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>();</span><br><span class="line">    <span class="built_in">this</span>.corePoolSize = corePoolSize;</span><br><span class="line">    <span class="built_in">this</span>.maximumPoolSize = maximumPoolSize;</span><br><span class="line">    <span class="built_in">this</span>.workQueue = workQueue;</span><br><span class="line">    <span class="built_in">this</span>.keepAliveTime = unit.toNanos(keepAliveTime);</span><br><span class="line">    <span class="built_in">this</span>.threadFactory = threadFactory;</span><br><span class="line">    <span class="built_in">this</span>.handler = handler;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æˆ‘ä»¬æ¥çœ‹ä¸‹è¿™äº›å‚æ•°ï¼š</p><ul><li><code>corePoolSize</code>ï¼šæ ¸å¿ƒçº¿ç¨‹æ•°ã€‚çº¿ç¨‹æ± åˆšåˆ›å»ºçš„æ—¶å€™ï¼Œçº¿ç¨‹æ•°é‡ä¸º0ï¼Œåªæœ‰ä»»åŠ¡æäº¤çš„æ—¶å€™æ‰ä¼šåˆ›å»ºçº¿ç¨‹ã€‚å¦‚æœå½“å‰çº¿ç¨‹æ•°é‡å°äº<code>corePoolSize</code>ï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹ï¼›å¦‚æœç­‰äºæˆ–è€…å¤§äºï¼Œåˆ™ä¸å†åˆ›å»ºã€‚</li><li><code>maximumPoolSize</code>ï¼šçº¿ç¨‹æ± å…è®¸åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°ã€‚å½“<code>workQueue</code>æ»¡äº†è€Œä¸”çº¿ç¨‹æ•°å°äº<code>maximumPoolSize</code>æ—¶ï¼Œçº¿ç¨‹æ± ä»ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹ã€‚ä½†æ˜¯å¦‚æœè¶…è¿‡äº†<code>maximumPoolSize</code>æ—¶ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</li><li><code>keepAliveTime</code>ï¼šéæ ¸å¿ƒçº¿ç¨‹é—²ç½®çš„è¶…è¿‡æ—¶é—´ã€‚å½“çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°é‡å¤§äºworkQueueï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹çš„ç©ºé—²æ—¶é—´å¤§äºkeepAliveTimeï¼Œåˆ™è¯¥çº¿ç¨‹ä¼šè¢«å›æ”¶ã€‚å¦‚æœä»»åŠ¡å¾ˆå¤šï¼Œå¹¶ä¸”æ¯ä¸ªä»»åŠ¡ çš„æ‰§è¡Œäº‹ä»¶å¾ˆçŸ­ï¼Œåˆ™å¯ä»¥è°ƒå¤§keepAliveTimeæ¥æé«˜çº¿ç¨‹çš„åˆ©ç”¨ç‡ã€‚å¦å¤–ï¼Œå¦‚æœè®¾ç½® allowCoreThreadTimeOutå±æ€§ä¸ºtrueæ—¶ï¼ŒkeepAliveTimeä¹Ÿä¼šåº”ç”¨åˆ°æ ¸å¿ƒçº¿ç¨‹ä¸Šã€‚</li><li><code>timeUnit</code>ï¼škeepAliveTimeå‚æ•°çš„æ—¶é—´å•ä½ã€‚å¯é€‰çš„å•ä½æœ‰å¤©(DAYS)ã€å°æ—¶(HOURS)ã€åˆ†é’Ÿ(MINUTES)ã€ç§’(SECONDS)ã€æ¯«ç§’(MILLISECONDS)ç­‰ã€‚</li><li><code>workQueue</code>ï¼šä»»åŠ¡é˜Ÿåˆ—ã€‚å¦‚æœå½“å‰çº¿ç¨‹æ•°å¤§äº<code>corePoolSize</code>ï¼Œåˆ™å°†ä»»åŠ¡æ·»åŠ åˆ°æ­¤ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚è¯¥ä»»åŠ¡ é˜Ÿåˆ—æ˜¯<code>BlockingQueue</code>ç±»å‹çš„ï¼Œä¹Ÿå°±æ˜¯é˜»å¡é˜Ÿåˆ—ã€‚</li><li><code>threadFactory</code>ï¼šçº¿ç¨‹å·¥å‚ã€‚å¯ä»¥ç”¨çº¿ç¨‹å·¥å‚ç»™æ¯ä¸ªåˆ›å»ºå‡ºæ¥çš„çº¿ç¨‹è®¾ç½®åå­—ã€‚ä¸€èˆ¬æƒ…å†µä¸‹æ— é¡»è®¾ç½®è¯¥å‚æ•°ã€‚</li><li><code>RejectedExecutionHandler</code>ï¼šé¥±å’Œç­–ç•¥ã€‚è¿™æ˜¯å½“ä»»åŠ¡é˜Ÿåˆ—å’Œçº¿ç¨‹æ± éƒ½æ»¡äº†æ—¶æ‰€é‡‡å–çš„åº”å¯¹ç­–ç•¥ï¼Œé»˜è®¤æ˜¯AbordPolicyï¼Œè¡¨ç¤ºæ— æ³•å¤„ç†æ–°ä»»åŠ¡ï¼Œå¹¶æŠ›å‡º<code>RejectedExecutionException</code>å¼‚å¸¸ã€‚æ­¤å¤–è¿˜æœ‰3ç§ç­–ç•¥ï¼Œå®ƒä»¬åˆ†åˆ«å¦‚ä¸‹:<ol><li><code>CallerRunsPolicy</code>ï¼šç”¨è°ƒç”¨è€…æ‰€åœ¨çš„çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ã€‚æ­¤ç­–ç•¥æä¾›ç®€å•çš„åé¦ˆæ§åˆ¶æœºåˆ¶ï¼Œèƒ½å¤Ÿå‡ç¼“æ–°ä»»åŠ¡çš„æäº¤é€Ÿåº¦ã€‚</li><li><code>DiscardPolicy</code>ï¼šä¸èƒ½æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¹¶å°†è¯¥ä»»åŠ¡åˆ é™¤ã€‚</li><li><code>DiscardOldestPolicy</code>ï¼šä¸¢å¼ƒé˜Ÿåˆ—æœ€è¿‘çš„ä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œå½“å‰çš„ä»»åŠ¡ã€‚</li></ol></li></ul><h1 id="çº¿ç¨‹æ± çš„å¤„ç†æµç¨‹"><a href="#çº¿ç¨‹æ± çš„å¤„ç†æµç¨‹" class="headerlink" title="çº¿ç¨‹æ± çš„å¤„ç†æµç¨‹"></a>çº¿ç¨‹æ± çš„å¤„ç†æµç¨‹</h1><p>çº¿ç¨‹æ± çš„ä»»åŠ¡å¤„ç†ä¸»è¦åˆ†ä¸º3ä¸ªæ­¥éª¤</p><ol><li>æäº¤ä»»åŠ¡åï¼Œçº¿ç¨‹æ± å…ˆåˆ¤æ–­çº¿ç¨‹æ•°æ˜¯å¦è¾¾åˆ°äº†æ ¸å¿ƒçº¿ç¨‹æ•°<code>corePoolSize</code>ã€‚å¦‚æœæœªè¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œåˆ™åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹å¤„ç†ä»»åŠ¡ï¼›å¦åˆ™ï¼Œå°±æ‰§è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚</li><li>æ¥ç€çº¿ç¨‹æ± åˆ¤æ–­ä»»åŠ¡é˜Ÿåˆ—æ˜¯å¦æ»¡äº†ã€‚å¦‚æœæ²¡æ»¡ï¼Œåˆ™å°†ä»»åŠ¡æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼›å¦åˆ™ï¼Œå°±æ‰§è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚</li><li>æ¥ç€å› ä¸ºä»»åŠ¡é˜Ÿåˆ—æ»¡äº†ï¼Œçº¿ç¨‹æ± å°±åˆ¤æ–­çº¿ç¨‹æ•°æ˜¯å¦è¾¾åˆ°äº†æœ€å¤§çº¿ç¨‹æ•°ã€‚å¦‚æœæœªè¾¾åˆ°ï¼Œåˆ™åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹å¤„ç†ä»»åŠ¡ï¼›å¦åˆ™ï¼Œå°±æ‰§è¡Œé¥±å’Œç­–ç•¥ï¼Œé»˜è®¤ä¼šæŠ›å‡º<code>RejectedExecutionException</code>å¼‚å¸¸ã€‚</li></ol><p><img src="https://psb1j8lvg.bkt.clouddn.com/mweb/å±å¹•å¿«ç…§2019-06-16ä¸‹åˆ3.03.51.png" alt="çº¿ç¨‹æ± æ‰§è¡Œæµç¨‹"></p><ol><li>å¦‚æœçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°æœªè¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œåˆ™åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹å¤„ç†ä»»åŠ¡ã€‚</li><li>å¦‚æœçº¿ç¨‹æ•°å¤§äºæˆ–è€…ç­‰äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œåˆ™å°†ä»»åŠ¡åŠ å…¥ä»»åŠ¡é˜Ÿåˆ—ï¼Œçº¿ç¨‹æ± ä¸­çš„ç©ºé—²çº¿ç¨‹ä¼šä¸æ–­åœ°ä» ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡è¿›è¡Œå¤„ç†ã€‚</li><li>å¦‚æœä»»åŠ¡é˜Ÿåˆ—æ»¡äº†ï¼Œå¹¶ä¸”çº¿ç¨‹æ•°æ²¡æœ‰è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°ï¼Œåˆ™åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹å»å¤„ç†ä»»åŠ¡ã€‚</li><li>å¦‚æœçº¿ç¨‹æ•°è¶…è¿‡äº†æœ€å¤§çº¿ç¨‹æ•°ï¼Œåˆ™æ‰§è¡Œé¥±å’Œç­–ç•¥ã€‚</li></ol><h1 id="çº¿ç¨‹æ± çš„ç§ç±»"><a href="#çº¿ç¨‹æ± çš„ç§ç±»" class="headerlink" title="çº¿ç¨‹æ± çš„ç§ç±»"></a>çº¿ç¨‹æ± çš„ç§ç±»</h1><h2 id="CachedThreadPoolï¼šå¯ç¼“å­˜çº¿ç¨‹æ± "><a href="#CachedThreadPoolï¼šå¯ç¼“å­˜çº¿ç¨‹æ± " class="headerlink" title="CachedThreadPoolï¼šå¯ç¼“å­˜çº¿ç¨‹æ± "></a>CachedThreadPoolï¼šå¯ç¼“å­˜çº¿ç¨‹æ± </h2><ol><li>çº¿ç¨‹æ•°æ— é™åˆ¶</li><li>æœ‰ç©ºé—²çº¿ç¨‹åˆ™å¤ç”¨ç©ºé—²çº¿ç¨‹ï¼Œè‹¥æ— ç©ºé—²çº¿ç¨‹åˆ™æ–°å»ºçº¿ç¨‹</li><li>ä¸€å®šç¨‹åºå‡å°‘é¢‘ç¹åˆ›å»º/é”€æ¯çº¿ç¨‹ï¼Œå‡å°‘ç³»ç»Ÿå¼€é”€</li></ol><p>åˆ›å»ºæºç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newCachedThreadPool</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">0</span>, Integer.MAX_VALUE,</span><br><span class="line">                                    <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">                                    <span class="keyword">new</span> <span class="title class_">SynchronousQueue</span>&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><code>CachedThreadPool</code>çš„<code>corePoolSize</code>ä¸º0ï¼Œ<code>maximumPoolSize</code>è®¾ç½®ä¸º<code>Integer.MAX_VALUE</code>ï¼Œè¿™æ„å‘³ç€<code>CachedThreadPool</code>æ²¡æœ‰æ ¸å¿ƒçº¿ç¨‹ï¼Œéæ ¸å¿ƒçº¿ç¨‹æ˜¯æ— ç•Œçš„ã€‚<code>keepAliveTime</code>è®¾ç½®ä¸º60Lï¼Œåˆ™ç©ºé—²çº¿ç¨‹ç­‰å¾…æ–°ä»»åŠ¡ çš„æœ€é•¿æ—¶é—´ä¸º60sã€‚åœ¨æ­¤ç”¨äº†é˜»å¡é˜Ÿåˆ—<code>SynchronousQueue</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼Œæ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹çš„ç§»é™¤æ“ä½œï¼ŒåŒæ ·ä»»ä½•ä¸€ä¸ªç§»é™¤æ“ä½œéƒ½ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹çš„æ’å…¥æ“ä½œã€‚</p><h2 id="FixedThreadPoolï¼šå®šé•¿çº¿ç¨‹æ± "><a href="#FixedThreadPoolï¼šå®šé•¿çº¿ç¨‹æ± " class="headerlink" title="FixedThreadPoolï¼šå®šé•¿çº¿ç¨‹æ± "></a>FixedThreadPoolï¼šå®šé•¿çº¿ç¨‹æ± </h2><ol><li>å¯æ§åˆ¶çº¿ç¨‹æœ€å¤§å¹¶å‘æ•°ï¼ˆåŒæ—¶æ‰§è¡Œçš„çº¿ç¨‹æ•°ï¼‰</li><li>è¶…å‡ºçš„çº¿ç¨‹ä¼šåœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…</li></ol><p>åˆ›å»ºæºç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newFixedThreadPool</span><span class="params">(<span class="type">int</span> nThreads)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(nThreads, nThreads,</span><br><span class="line">                                    <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                    <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><code>FixedThreadPool</code>çš„<code>corePoolSize</code>å’Œ<code>maximumPoolSize</code>éƒ½è®¾ç½®ä¸ºåˆ›å»º<code>FixedThreadPool</code>æŒ‡å®šçš„å‚æ•°<code>nThreads</code>ï¼Œä¹Ÿå°±æ„å‘³ç€<code>FixedThreadPool</code>åªæœ‰æ ¸å¿ƒçº¿ç¨‹ï¼Œå¹¶ä¸”æ•°é‡æ˜¯å›ºå®šçš„ï¼Œæ²¡æœ‰éæ ¸å¿ƒçº¿ç¨‹ã€‚<code>keepAliveTime</code>è®¾ç½®ä¸º0Læ„å‘³ç€å¤šä½™çš„çº¿ç¨‹ä¼šè¢«ç«‹å³ç»ˆæ­¢ã€‚å› ä¸ºä¸ä¼šäº§ç”Ÿå¤šä½™çš„çº¿ç¨‹ï¼Œæ‰€ä»¥<code>keepAliveTime</code>æ˜¯æ— æ•ˆçš„å‚æ•°ã€‚å¦å¤–ï¼Œä»»åŠ¡é˜Ÿåˆ—é‡‡ç”¨äº†æ— ç•Œçš„é˜»å¡é˜Ÿåˆ—<code>LinkedBlockingQueue</code>ã€‚</p><h2 id="ScheduledThreadPoolï¼šå®šé•¿çº¿ç¨‹æ± "><a href="#ScheduledThreadPoolï¼šå®šé•¿çº¿ç¨‹æ± " class="headerlink" title="ScheduledThreadPoolï¼šå®šé•¿çº¿ç¨‹æ± "></a>ScheduledThreadPoolï¼šå®šé•¿çº¿ç¨‹æ± </h2><p>æ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œã€‚</p><p>åˆ›å»ºæºç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ScheduledExecutorService <span class="title function_">newScheduledThreadPool</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="type">int</span> corePoolSize, ThreadFactory threadFactory)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ScheduledThreadPoolExecutor</span>(corePoolSize, threadFactory);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨åˆ›å»ºæºç ä¸­ä»–è·³è½¬åˆ°äº†<code>ScheduledThreadPoolExecutor</code>çš„æ„é€ æ–¹æ³•ï¼Œæˆ‘ä»¬ç»§ç»­çœ‹è¿›å»ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ScheduledThreadPoolExecutor</span><span class="params">(<span class="type">int</span> corePoolSize,</span></span><br><span class="line"><span class="params">                                    ThreadFactory threadFactory)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(corePoolSize, Integer.MAX_VALUE,</span><br><span class="line">            DEFAULT_KEEPALIVE_MILLIS, MILLISECONDS,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">DelayedWorkQueue</span>(), threadFactory);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œ<code>ScheduledThreadPoolExecutor</code>çš„æ„é€ æ–¹æ³•æœ€ç»ˆè°ƒç”¨çš„æ˜¯<code>ThreadPoolExecutor</code>çš„æ„é€ æ–¹æ³•ã€‚<code>corePoolSize</code>æ˜¯ä¼ è¿›æ¥çš„å›ºå®šæ•°å€¼ï¼Œ<code>maximumPoolSize</code>çš„å€¼æ˜¯<code>Integer.MAX_VALUE</code>ã€‚å› ä¸ºé‡‡ç”¨çš„<code>DelayedWorkQueue</code>æ˜¯æ— ç•Œçš„ï¼Œæ‰€ä»¥<code>maximumPoolSize</code>è¿™ä¸ªå‚æ•°æ˜¯æ— æ•ˆçš„ã€‚</p><h2 id="SingleThreadExecutorï¼šå•çº¿ç¨‹åŒ–çš„çº¿ç¨‹æ± "><a href="#SingleThreadExecutorï¼šå•çº¿ç¨‹åŒ–çš„çº¿ç¨‹æ± " class="headerlink" title="SingleThreadExecutorï¼šå•çº¿ç¨‹åŒ–çš„çº¿ç¨‹æ± "></a>SingleThreadExecutorï¼šå•çº¿ç¨‹åŒ–çš„çº¿ç¨‹æ± </h2><ol><li>æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå·¥ä½œçº¿ç¨‹æ‰§è¡Œä»»åŠ¡</li><li>æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æŒ‡å®šé¡ºåºæ‰§è¡Œï¼Œå³éµå¾ªé˜Ÿåˆ—çš„å…¥é˜Ÿå‡ºé˜Ÿè§„åˆ™</li></ol><p>åˆ›å»ºæºç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newSingleThreadExecutor</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FinalizableDelegatedExecutorService</span></span><br><span class="line">        (<span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">                                <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><code>corePoolSize</code>å’Œ<code>maximumPoolSize</code>éƒ½ä¸º1ï¼Œæ„å‘³ç€<code>SingleThreadExecutor</code>åªæœ‰ä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹ï¼Œå…¶ä»–çš„å‚æ•°éƒ½å’Œ<code>FixedThreadPool</code>ä¸€æ ·ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Java/">Java</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Java/">Java</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/">å¤šçº¿ç¨‹</category>
      
      
      <comments>https://www.littlecorgi.top/posts/b39fd0ab.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Nexté…ç½®å¤‡ä»½</title>
      <link>https://www.littlecorgi.top/posts/5b6e53a4.html</link>
      <guid>https://www.littlecorgi.top/posts/5b6e53a4.html</guid>
      <pubDate>Tue, 11 Jun 2019 13:41:12 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;Hexoé…ç½®å¤‡ä»½&quot;&gt;&lt;a href=&quot;#Hexoé…ç½®å¤‡ä»½&quot; class=&quot;headerlink&quot; title=&quot;Hexoé…ç½®å¤‡ä»½&quot;&gt;&lt;/a&gt;Hexoé…ç½®å¤‡ä»½&lt;/h1&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="Hexoé…ç½®å¤‡ä»½"><a href="#Hexoé…ç½®å¤‡ä»½" class="headerlink" title="Hexoé…ç½®å¤‡ä»½"></a>Hexoé…ç½®å¤‡ä»½</h1><span id="more"></span><h1 id="è¯„è®ºç³»ç»Ÿ"><a href="#è¯„è®ºç³»ç»Ÿ" class="headerlink" title="è¯„è®ºç³»ç»Ÿ"></a>è¯„è®ºç³»ç»Ÿ</h1><ul><li>æ¥å¿…åŠ› - <a href="https://www.livere.com/">https://www.livere.com/</a></li><li>valine(åœ¨ç”¨) - <a href="https://valine.js.org/">https://valine.js.org/</a></li></ul><h1 id="é˜…è¯»é‡æ˜¾ç¤º"><a href="#é˜…è¯»é‡æ˜¾ç¤º" class="headerlink" title="é˜…è¯»é‡æ˜¾ç¤º"></a>é˜…è¯»é‡æ˜¾ç¤º</h1><ul><li>leancloud - <a href="https://leancloud.cn/">https://leancloud.cn/</a></li><li>valine(åœ¨ç”¨) - <a href="https://valine.js.org/">https://valine.js.org/</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/%E6%9D%82%E9%A1%B9/">æ‚é¡¹</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Hexo/">Hexo</category>
      
      
      <comments>https://www.littlecorgi.top/posts/5b6e53a4.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Androidå¤šçº¿ç¨‹1--Javaä¸­çš„é˜»å¡é˜Ÿåˆ—</title>
      <link>https://www.littlecorgi.top/posts/63ab42b7.html</link>
      <guid>https://www.littlecorgi.top/posts/63ab42b7.html</guid>
      <pubDate>Sun, 09 Jun 2019 05:39:10 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;é˜»å¡é˜Ÿåˆ—&quot;&gt;&lt;a href=&quot;#é˜»å¡é˜Ÿåˆ—&quot; class=&quot;headerlink&quot; title=&quot;é˜»å¡é˜Ÿåˆ—&quot;&gt;&lt;/a&gt;é˜»å¡é˜Ÿåˆ—&lt;/h1&gt;&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;åœ¨è°ˆè®ºé˜»å¡é˜Ÿåˆ—ä¹‹å‰æˆ‘ä»¬å…ˆçœ‹ä¸‹æ“ä½œç³»ç»Ÿå¤šçº¿ç¨‹éƒ¨åˆ†ä¸€ä¸ªç»å…¸çš„ä¾‹å­â€”â€”ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç°åœ¨æœ‰ä¸¤ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªæ˜¯ç”Ÿäº§è€…ä¸€ä¸ªæ˜¯æ¶ˆè´¹è€…ï¼Œè¿˜æœ‰ä¸€ä¸ªçº¿ç¨‹ç¼“å†²åŒºã€‚ç”Ÿäº§è€…ä¸»è¦ä½œç”¨å°±æ˜¯å‘ç¼“å†²åŒºä¸­æ·»åŠ æ•°æ®ï¼Œæ¶ˆè´¹è€…å°±æ˜¯ä»ç¼“å†²åŒºä¸­å–å‡ºæ•°æ®ã€‚è¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒå°±æ˜¯å¦‚ä½•ç¡®ä¿ç”Ÿäº§è€…ä¸ä¼šåœ¨ç¼“å†²åŒºæ»¡äº†çš„æ—¶å€™è¿˜å¾€å…¶ä¸­æ·»åŠ å…ƒç´ ï¼Œæ¶ˆè´¹è€…ä¸ä¼šåœ¨ç¼“å†²åŒºç©ºäº†çš„æ—¶å€™è¿˜è¦æ±‚å–å‡ºæ•°æ®ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="é˜»å¡é˜Ÿåˆ—"><a href="#é˜»å¡é˜Ÿåˆ—" class="headerlink" title="é˜»å¡é˜Ÿåˆ—"></a>é˜»å¡é˜Ÿåˆ—</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨è°ˆè®ºé˜»å¡é˜Ÿåˆ—ä¹‹å‰æˆ‘ä»¬å…ˆçœ‹ä¸‹æ“ä½œç³»ç»Ÿå¤šçº¿ç¨‹éƒ¨åˆ†ä¸€ä¸ªç»å…¸çš„ä¾‹å­â€”â€”ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜ï¼š</p><blockquote><p>ç°åœ¨æœ‰ä¸¤ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªæ˜¯ç”Ÿäº§è€…ä¸€ä¸ªæ˜¯æ¶ˆè´¹è€…ï¼Œè¿˜æœ‰ä¸€ä¸ªçº¿ç¨‹ç¼“å†²åŒºã€‚ç”Ÿäº§è€…ä¸»è¦ä½œç”¨å°±æ˜¯å‘ç¼“å†²åŒºä¸­æ·»åŠ æ•°æ®ï¼Œæ¶ˆè´¹è€…å°±æ˜¯ä»ç¼“å†²åŒºä¸­å–å‡ºæ•°æ®ã€‚è¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒå°±æ˜¯å¦‚ä½•ç¡®ä¿ç”Ÿäº§è€…ä¸ä¼šåœ¨ç¼“å†²åŒºæ»¡äº†çš„æ—¶å€™è¿˜å¾€å…¶ä¸­æ·»åŠ å…ƒç´ ï¼Œæ¶ˆè´¹è€…ä¸ä¼šåœ¨ç¼“å†²åŒºç©ºäº†çš„æ—¶å€™è¿˜è¦æ±‚å–å‡ºæ•°æ®ã€‚</p></blockquote><span id="more"></span><p>å…³äºè¿™ä¸ªé—®é¢˜çš„è§£å†³åŠæ³•æˆ‘ä»¬ä»¥åå†è¯´ï¼Œæˆ‘ä»¬ç°åœ¨ä¸»è¦è®¨è®ºçº¿ç¨‹ç¼“å†²åŒºâ€”â€”é˜»å¡é˜Ÿåˆ—ã€‚</p><h2 id="é˜»å¡é˜Ÿåˆ—ç®€ä»‹"><a href="#é˜»å¡é˜Ÿåˆ—ç®€ä»‹" class="headerlink" title="é˜»å¡é˜Ÿåˆ—ç®€ä»‹"></a>é˜»å¡é˜Ÿåˆ—ç®€ä»‹</h2><p>é˜»å¡é˜Ÿåˆ—å°±æ˜¯é˜Ÿåˆ—ï¼Œåªæ˜¯åœ¨ä¸€èˆ¬çš„é˜Ÿåˆ—ä¸Šæ·»åŠ äº†ä¸¤ä¸ªæ¡ä»¶ï¼š</p><ol><li>å½“é˜Ÿåˆ—æ»¡äº†çš„æ—¶å€™ä¸å…è®¸å†æ·»åŠ æ•°æ®</li><li>å½“é˜Ÿåˆ—ç©ºäº†çš„æ—¶å€™ä¸å…è®¸ä»ä¸­å–æ•°æ®</li></ol><p>åœ¨Javaä¸­ï¼Œé˜»å¡é˜Ÿåˆ—æ˜¯é€šè¿‡<code>BlockingQueue</code>æ¥å®ç°çš„ï¼Œ<code>BlockingQueue</code>æ˜¯<code>Java.util.concurrent</code>åŒ…ä¸‹ä¸€ä¸ªé‡è¦çš„æ•°æ®ç»“æ„ã€‚</p><h2 id="BlockingQueueçš„æ“ä½œæ–¹æ³•"><a href="#BlockingQueueçš„æ“ä½œæ–¹æ³•" class="headerlink" title="BlockingQueueçš„æ“ä½œæ–¹æ³•"></a>BlockingQueueçš„æ“ä½œæ–¹æ³•</h2><div class="table-container"><table><thead><tr><th style="text-align:center">æ–¹æ³•</th><th style="text-align:center">æŠ›å¼‚å¸¸</th><th style="text-align:center">è¿”å›ç‰¹å®šå€¼</th><th style="text-align:center">é˜»å¡</th><th style="text-align:center">è¶…æ—¶</th></tr></thead><tbody><tr><td style="text-align:center">æ’å…¥</td><td style="text-align:center">add(E e)</td><td style="text-align:center">offer(E e)</td><td style="text-align:center">put(E e)</td><td style="text-align:center">offer(E e, long timeout, TimeUnit unit)</td></tr><tr><td style="text-align:center">ç§»é™¤</td><td style="text-align:center">remove()</td><td style="text-align:center">poll()</td><td style="text-align:center">take()</td><td style="text-align:center">poll(time, unit)</td></tr><tr><td style="text-align:center">æ£€æŸ¥</td><td style="text-align:center">element()</td><td style="text-align:center">peek()</td><td style="text-align:center">ä¸å¯ç”¨</td><td style="text-align:center">ä¸å¯ç”¨</td></tr></tbody></table></div><blockquote><p>è§£é‡Šï¼š</p><ol><li>æŠ›å¼‚å¸¸ï¼šå¦‚æœæ“ä½œæ— æ³•æ‰§è¡Œï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸</li><li>ç‰¹å®šå€¼ï¼šå¦‚æœæ“ä½œæ— æ³•æ‰§è¡Œï¼Œåˆ™è¿”å›ä¸€ä¸ªç‰¹å®šçš„å€¼</li><li>é˜»å¡ï¼š å¦‚æœæ“ä½œæ— æ³•æ‰§è¡Œï¼Œåˆ™æ–¹æ³•è°ƒç”¨è¢«é˜»å¡ï¼Œç›´åˆ°å¯ä»¥æ‰§è¡Œ</li><li>è¶…æ—¶ï¼šå¦‚æœæ“ä½œæ— æ³•æ‰§è¡Œï¼Œåˆ™æ–¹æ³•è°ƒç”¨è¢«é˜»å¡ï¼Œç›´åˆ°å¯ä»¥æ‰§è¡Œæˆ–è€…è¶…è¿‡é™å®šçš„æ—¶é—´ã€‚è¿”å›ä¸€ä¸ªç‰¹å®šå€¼ä»¥å‘ŠçŸ¥è¯¥æ“ä½œæ˜¯å¦æˆåŠŸ(å…¸å‹çš„æ˜¯true / false)ã€‚</li></ol></blockquote><h2 id="Javaä¸­çš„å„ç§é˜»å¡é˜Ÿåˆ—"><a href="#Javaä¸­çš„å„ç§é˜»å¡é˜Ÿåˆ—" class="headerlink" title="Javaä¸­çš„å„ç§é˜»å¡é˜Ÿåˆ—"></a>Javaä¸­çš„å„ç§é˜»å¡é˜Ÿåˆ—</h2><p><code>Java</code>åŸºäº<code>BlockingQueue</code>ç»™å¼€å‘è€…æä¾›äº†7ä¸ªé˜»å¡é˜Ÿåˆ—ï¼š</p><ol><li><code>ArrayBlockingQueue</code>ï¼šåŸºäºæ•°ç»„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚æœ‰ç•Œå°±æ„å‘³ç€ä»–æœ‰ä¸€ä¸ªæœ€å¤§é™åº¦ï¼Œæ‰€å­˜å‚¨çš„çº¿ç¨‹çš„æ•°é‡ä¸èƒ½è¶…è¿‡è¿™ä¸ªé™å®šå€¼ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨å¯¹å…¶åˆå§‹åŒ–çš„æ—¶å€™ç»™å®šè¿™ä¸ªé™å®šå€¼ã€‚ä½†æ˜¯ç”±äºå®ƒæ˜¯åŸºäºæ•°ç»„æ‰€ä»¥ä»–å’Œæ•°ç»„ä¸€æ ·ï¼Œåœ¨åˆå§‹åŒ–çš„æ—¶å€™é™å®šäº†è¿™ä¸ªå¤§å°ä»¥åå°±ä¸èƒ½æ”¹å˜ã€‚</li><li><code>LinkedBlockingQueue</code>ï¼šåŸºäºé“¾è¡¨çš„é˜»å¡é˜Ÿåˆ—ã€‚å®ƒå†…éƒ¨ä»¥ä¸€ä¸ªé“¾å¼ç»“æ„(é“¾æ¥èŠ‚ç‚¹)å¯¹å…¶å…ƒç´ è¿›è¡Œå­˜å‚¨ã€‚å¦‚æœéœ€è¦çš„è¯ï¼Œè¿™ä¸€é“¾å¼ç»“æ„å¯ä»¥é€‰æ‹©ä¸€ä¸ªä¸Šé™ã€‚å¦‚æœæ²¡æœ‰å®šä¹‰ä¸Šé™ï¼Œå°†ä½¿ç”¨<code>Integer.MAX_VALUE</code>ä½œä¸ºä¸Šé™ã€‚<code>LinkedBlockingQueue</code>å†…éƒ¨ä»¥FIFO(å…ˆè¿›å…ˆå‡º)çš„é¡ºåºå¯¹å…ƒç´ è¿›è¡Œå­˜å‚¨ã€‚é˜Ÿåˆ—ä¸­çš„å¤´å…ƒç´ åœ¨æ‰€æœ‰å…ƒç´ ä¹‹ä¸­æ˜¯æ”¾å…¥æ—¶é—´æœ€ä¹…çš„é‚£ä¸ªï¼Œè€Œå°¾å…ƒç´ åˆ™æ˜¯æœ€çŸ­çš„é‚£ä¸ªã€‚ç”±äºé»˜è®¤æ˜¯æ— ä¸Šé™çš„ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨ä»–çš„æ—¶å€™ï¼Œå¦‚æœç”Ÿäº§è€…çš„é€Ÿåº¦å¤§äºæ¶ˆè´¹è€…çš„é€Ÿåº¦ï¼Œç³»ç»Ÿå†…å­˜å¯èƒ½ä¼šè¢«è€—å°½ã€‚æ‰€ä»¥ä½¿ç”¨ä»–ä¸€å®šè¦è®¾ç½®åˆå€¼ã€‚</li><li><code>PriorityBlockingQueue</code>ï¼šæ”¯æŒä¼˜å…ˆçº§çš„æ— ç•Œé˜Ÿåˆ—ã€‚é»˜è®¤æƒ…å†µæŒ‰ç…§è‡ªç„¶é¡ºåºç”Ÿåºæ’åˆ—ï¼Œä½ å¯ä»¥é‡å†™<code>compateTo()</code>æ–¹æ³•æ¥åˆ¶å®šå…ƒç´ æŒ‰è§„å®šæ’åºã€‚</li><li><code>DelayQueue</code>ï¼šæ”¯æŒå»¶æ—¶è·å–å…ƒç´ çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚é˜Ÿåˆ—ä¸­çš„å…ƒç´ å¿…é¡»å®ç°<code>Delayed</code>æ¥å£ã€‚</li><li><code>SynchromousQueue</code>ï¼šæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„é˜Ÿåˆ—ã€‚ä»–ä¸èƒ½å­˜å‚¨ä»»ä½•å…ƒç´ ï¼Œä»–çš„æ¯ä¸€æ¬¡æ’å…¥æ“ä½œå¿…é¡»ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹ç›¸åº”çš„åˆ é™¤æ“ä½œï¼Œåä¹‹äº¦ç„¶ã€‚</li><li><code>LinkedTransferQueue</code>ï¼šåŸºäºé“¾è¡¨çš„æ— ç•Œé˜»å¡<code>TransferQueue</code>é˜Ÿåˆ—ã€‚ç›¸å¯¹äºå…¶ä»–é˜Ÿåˆ—ï¼Œä»–å¤šäº†<code>transfer(E e)</code>ã€<code>tryTransfer(E e)</code> å’Œ <code>tryTransfer(E e, long timeout, TimeUnit unit)</code>æ–¹æ³•ã€‚</li><li><code>LinkedBlockingDeque</code>ï¼šæ˜¯ä¸€ä¸ªé“¾è¡¨ç»“æ„çš„åŒå‘é˜»å¡é˜Ÿåˆ—ã€‚å¯åœ¨ä¸¤ç«¯å…¥é˜Ÿå‡ºå¯¹ã€‚æ‰€ä»¥å½“å¤šçº¿ç¨‹å…¥é˜Ÿæ—¶ï¼Œå‡å°‘äº†ä¸€åŠçš„ç«äº‰ã€‚</li></ol><h2 id="é˜»å¡é˜Ÿåˆ—å®ç°åŸç†"><a href="#é˜»å¡é˜Ÿåˆ—å®ç°åŸç†" class="headerlink" title="é˜»å¡é˜Ÿåˆ—å®ç°åŸç†"></a>é˜»å¡é˜Ÿåˆ—å®ç°åŸç†</h2><p>ä¸‹é¢æˆ‘ä»¬ä»¥<code>ArrayBlockingQueue</code>æºç ä¸ºä¾‹ï¼Œæ¥çœ‹ä¸‹é˜»å¡é˜Ÿåˆ—å®ç°åŸç†ï¼š</p><h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>é¦–å…ˆå°±æ˜¯ä¸€å †å˜é‡çš„å®šä¹‰ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** The queued items */</span></span><br><span class="line"><span class="keyword">final</span> Object[] items;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** items index for next take, poll, peek or remove */</span></span><br><span class="line"><span class="type">int</span> takeIndex;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** items index for next put, offer, or add */</span></span><br><span class="line"><span class="type">int</span> putIndex;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Number of elements in the queue */</span></span><br><span class="line"><span class="type">int</span> count;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Concurrency control uses the classic two-condition algorithm</span></span><br><span class="line"><span class="comment"> * found in any textbook.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** Main lock guarding all access */</span></span><br><span class="line"><span class="keyword">final</span> ReentrantLock lock;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Condition for waiting takes */</span></span><br><span class="line"><span class="keyword">private</span></span><br><span class="line"><span class="keyword">final</span> Condition notEmpty;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Condition for waiting puts */</span></span><br><span class="line"><span class="keyword">private</span></span><br><span class="line"><span class="keyword">final</span> Condition notFull;</span><br></pre></td></tr></table></figure><br><code>items</code>æ˜¯å­˜å‚¨é˜Ÿåˆ—å…ƒç´ çš„æ•°ç»„ï¼Œ<code>takeIndex</code>å’Œ<code>putIndex</code>åˆ†åˆ«æ˜¯å–æ•°æ®å’Œå­˜æ•°æ®çš„ç´¢å¼•ï¼Œ<code>count</code>æ˜¯é˜Ÿåˆ—ä¸­å…ƒç´ ä¸ªæ•°ï¼Œ<code>lock</code>ä¸ºçœ‹ä¸€ä¸ªå¯é‡å…¥é”ï¼Œ<code>notEmpty</code>å’Œ<code>notFull</code>å‡ä¸ºç­‰å¾…æ¡ä»¶ï¼Œç”±<code>loc</code>kåˆ›å»ºã€‚</p><h3 id="æ„é€ å™¨"><a href="#æ„é€ å™¨" class="headerlink" title="æ„é€ å™¨"></a>æ„é€ å™¨</h3><p>æ¥ä¸‹æ¥çœ‹ä¸‹å®ƒçš„æ„é€ å™¨<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ArrayBlockingQueue</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ArrayBlockingQueue</span><span class="params">(<span class="type">int</span> capacity, <span class="type">boolean</span> fair)</span> &#123; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ArrayBlockingQueue</span><span class="params">(<span class="type">int</span> capacity, <span class="type">boolean</span> fair, Collection&lt;? extends E&gt; c)</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æ„é€ å™¨æœ‰ä¸‰ä¸ªé‡è½½çš„ç‰ˆæœ¬ï¼Œç¬¬ä¸€ä¸ªæ„é€ å™¨åªæœ‰ä¸€ä¸ªå‚æ•°ç”¨æ¥æŒ‡å®šå®¹é‡ï¼Œç¬¬äºŒä¸ªæ„é€ å™¨å¤šäº†ä¸€ä¸ªå‚æ•°æ¥æŒ‡å®šè®¿é—®ç­–ç•¥ï¼Œç¬¬ä¸‰ä¸ªæ„é€ å™¨åˆå¤šäº†ä¸€ä¸ªå‚æ•°å¯ä»¥æŒ‡å®šç”¨å¦å¤–ä¸€ä¸ªé›†åˆè¿›è¡Œåˆå§‹åŒ–ã€‚</p><h3 id="æ•°æ®çš„æ·»åŠ "><a href="#æ•°æ®çš„æ·»åŠ " class="headerlink" title="æ•°æ®çš„æ·»åŠ "></a>æ•°æ®çš„æ·»åŠ </h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹<code>BlockingQueue</code>çš„ä¸‰ä¸ªæ’å…¥çš„æ–¹æ³•ï¼š<code>put()</code>ã€<code>add()</code>å’Œ<code>offer()</code>ï¼š</p><ul><li><code>put()</code> æ–¹æ³•ï¼šé˜Ÿåˆ—æ»¡ï¼Œä¼šé˜»å¡è°ƒç”¨å­˜å‚¨å…ƒç´ çš„çº¿ç¨‹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(E e)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="comment">// å…ˆæ£€æŸ¥eæ˜¯ä¸æ˜¯ç©ºï¼Œå¦‚æœç©ºåˆ™æŠ›å¼‚å¸¸</span></span><br><span class="line">    Objects.requireNonNull(e);</span><br><span class="line">    <span class="comment">// è·å–ä¸€ä¸ªé‡å…¥é”lock</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="built_in">this</span>.lock;</span><br><span class="line">    <span class="comment">// åŠ é”ï¼Œä¿è¯è°ƒç”¨putæ–¹æ³•çš„æ—¶å€™åªæœ‰1ä¸ªçº¿ç¨‹</span></span><br><span class="line">    lock.lockInterruptibly();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœçº¿ç¨‹ä¸­çš„å…ƒç´ æ•°é‡æ˜¯å¦ç­‰äºå½“å‰æ•°ç»„çš„é•¿åº¦ï¼Œå¦‚æœç›¸ç­‰åˆ™è°ƒç”¨awaitæ–¹æ³•ç­‰å¾…ï¼Œå¦‚æœä¸ç›¸ç­‰åˆ™enqueueæ–¹æ³•æ’å…¥å…ƒç´ </span></span><br><span class="line">        <span class="keyword">while</span> (count == items.length)</span><br><span class="line">            notFull.await();</span><br><span class="line">        enqueue(e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">// è§£é”</span></span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>add()</code>æ–¹æ³•ï¼šå®é™…ä¸Šè°ƒç”¨äº†<code>offer()</code>æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">add</span><span class="params">(E e)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (offer(e))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Queue full&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>offer()</code>æ–¹æ³•ï¼šæˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">offer</span><span class="params">(E e)</span> &#123;</span><br><span class="line">    <span class="comment">// æ£€æŸ¥eæ˜¯å¦ä¸ºç©º</span></span><br><span class="line">    Objects.requireNonNull(e);</span><br><span class="line">    <span class="comment">// è·å–é‡å…¥é”lock</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="built_in">this</span>.lock;</span><br><span class="line">    <span class="comment">// åŠ é”</span></span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå¦‚æœçº¿ç¨‹ä¸­çš„å…ƒç´ æ•°é‡æ˜¯å¦ç­‰äºå½“å‰æ•°ç»„çš„é•¿åº¦ï¼Œå¦‚æœç›¸ç­‰åˆ™è°ƒè¿”å›falseï¼Œå¦‚æœä¸ç›¸ç­‰åˆ™enqueueæ–¹æ³•æ’å…¥å…ƒç´ å¹¶è¿”å›true</span></span><br><span class="line">        <span class="keyword">if</span> (count == items.length)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            enqueue(e);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// è§£é”</span></span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä¸‰ä¸ªæ–¹æ³•éƒ½è°ƒç”¨äº†<code>enqueue()</code>æ–¹æ³•ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Inserts element at current put position, advances, and signals.</span></span><br><span class="line"><span class="comment"> * Call only when holding lock.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">enqueue</span><span class="params">(E e)</span> &#123;</span><br><span class="line">    <span class="comment">// assert lock.isHeldByCurrentThread();</span></span><br><span class="line">    <span class="comment">// assert lock.getHoldCount() == 1;</span></span><br><span class="line">    <span class="comment">// assert items[putIndex] == null;</span></span><br><span class="line">    <span class="keyword">final</span> Object[] items = <span class="built_in">this</span>.items;</span><br><span class="line">    items[putIndex] = e;</span><br><span class="line">    <span class="keyword">if</span> (++putIndex == items.length) </span><br><span class="line">        putIndex = <span class="number">0</span>;</span><br><span class="line">    count++;</span><br><span class="line">    notEmpty.signal();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å…ˆè·å–å…ƒç´ æ•°ç»„<code>items</code>ï¼Œç„¶åæ·»åŠ <code>putIndex</code>ä¸Šï¼Œå¦‚æœ<code>++putIndex</code>ç­‰äº<code>items</code>çš„é•¿åº¦ï¼Œåˆ™è¯æ˜å½“å‰è¿™ä¸ª<code>items</code>æ‰€æœ‰å…ƒç´ éƒ½æ·»åŠ è¿›äº†ï¼Œå°±è®©<code>putIndex</code>ç­‰äº0.ç„¶åè°ƒç”¨<code>notEmpty.signal()</code>æ–¹æ³•å”¤é†’æ­£åœ¨è·å–å…ƒç´ çš„çº¿ç¨‹ï¼Œè®©ä»–ä»¬ä»é˜Ÿåˆ—ä¸­å–æ•°æ®ã€‚</p><h3 id="æ•°æ®çš„å–å‡º"><a href="#æ•°æ®çš„å–å‡º" class="headerlink" title="æ•°æ®çš„å–å‡º"></a>æ•°æ®çš„å–å‡º</h3><p>ArrayBlockingQueueçš„å–æ•°æ®æ–¹æ³•æ€»å…±ä¹Ÿæœ‰ä¸‰ä¸ªæ–¹æ³•ï¼š<code>poll()</code>ã€<code>take()</code>å’Œ<code>remove()</code></p><ul><li><code>poll()</code>æ–¹æ³•ï¼šè·å–å…ƒç´ ï¼Œå­˜åœ¨è¿”å›å…ƒç´ e,ä¸å­˜åœ¨è¿”å›null</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> E <span class="title function_">poll</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–é‡å…¥é”lock</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="built_in">this</span>.lock;</span><br><span class="line">    <span class="comment">// åŠ é”</span></span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå…ƒç´ æ•°é‡ç­‰äº0å°±è¿”å›nullï¼Œå¦åˆ™è°ƒç”¨dequeue()æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">return</span> (count == <span class="number">0</span>) ? <span class="literal">null</span> : dequeue();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// è§£é”</span></span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>take()</code>æ–¹æ³•ï¼šå–å…ƒç´ ã€‚å¦‚æœé˜Ÿåˆ—ä¸ºç©º,åˆ™ä¼šé˜»å¡è°ƒç”¨è·å–å…ƒç´ çš„çº¿ç¨‹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> E <span class="title function_">take</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="comment">// è·å–é‡å…¥é”lock</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="built_in">this</span>.lock;</span><br><span class="line">    <span class="comment">// åŠ é”</span></span><br><span class="line">    lock.lockInterruptibly();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœçº¿ç¨‹ä¸­çš„å…ƒç´ æ•°é‡æ˜¯å¦ç­‰äº0ï¼Œå¦‚æœç›¸ç­‰åˆ™è°ƒç”¨awaitæ–¹æ³•ç­‰å¾…ï¼Œå¦‚æœä¸ç›¸ç­‰åˆ™dequeueæ–¹æ³•åˆ é™¤å…ƒç´ </span></span><br><span class="line">        <span class="keyword">while</span> (count == <span class="number">0</span>)</span><br><span class="line">            notEmpty.await();</span><br><span class="line">        <span class="keyword">return</span> dequeue();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// è§£é”</span></span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>remove()</code>æ–¹æ³•ï¼šå–å…ƒç´ ï¼Œå®ƒæ˜¯å–ç‰¹å®šçš„é‚£ä¸ªå…ƒç´ </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">remove</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­oæ˜¯å¦ä¸ºç©º</span></span><br><span class="line">    <span class="keyword">if</span> (o == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// è·å–é‡å…¥é”lock</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="built_in">this</span>.lock;</span><br><span class="line">    <span class="comment">// åŠ é”</span></span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå…ƒç´ æ•°é‡å¤§äº0ï¼Œåˆ™è·å–itemsï¼Œç„¶åä¾¿åˆ©å…ƒç´ ï¼Œåˆ¤æ–­oæ˜¯å…¶ä¸­çš„å“ªä¸ªï¼Œç„¶ååˆ é™¤é‚£ä¸ª</span></span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">final</span> Object[] items = <span class="built_in">this</span>.items;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> takeIndex, end = putIndex, to = (i &lt; end) ? end : items.length; ; i = <span class="number">0</span>, to = end) &#123;</span><br><span class="line">                <span class="keyword">for</span> (; i &lt; to; i++)</span><br><span class="line">                    <span class="keyword">if</span> (o.equals(items[i])) &#123;</span><br><span class="line">                        removeAt(i);</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">if</span> (to == end) <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// è§£é”</span></span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>poll()</code>å’Œ<code>take()</code>ä¸¤ä¸ªæ–¹æ³•éƒ½è°ƒç”¨äº†<code>dequeue()</code>æ–¹æ³•ï¼Œæˆ‘ä»¬å°±çœ‹ä¸‹<code>dequeue()</code>æ˜¯å¦‚ä½•æ¥å®ç°çš„ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Extracts element at current take position, advances, and signals.</span></span><br><span class="line"><span class="comment"> * Call only when holding lock.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> E <span class="title function_">dequeue</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// assert lock.isHeldByCurrentThread();</span></span><br><span class="line">    <span class="comment">// assert lock.getHoldCount() == 1;</span></span><br><span class="line">    <span class="comment">// assert items[takeIndex] != null;</span></span><br><span class="line">    <span class="keyword">final</span> Object[] items = <span class="built_in">this</span>.items;</span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="type">E</span> <span class="variable">e</span> <span class="operator">=</span> (E) items[takeIndex];</span><br><span class="line">    items[takeIndex] = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (++takeIndex == items.length) takeIndex = <span class="number">0</span>;</span><br><span class="line">    count--;</span><br><span class="line">    <span class="keyword">if</span> (itrs != <span class="literal">null</span>)</span><br><span class="line">        itrs.elementDequeued();</span><br><span class="line">    notFull.signal();</span><br><span class="line">    <span class="keyword">return</span> e;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å’Œä¸Šé¢çš„<code>enqueue()</code>æ–¹æ³•ç±»ä¼¼ï¼Œå†æ¬¡å°±ä¸å†èµ˜è¿°ã€‚</p><h2 id="é˜»å¡é˜Ÿåˆ—çš„åº”ç”¨"><a href="#é˜»å¡é˜Ÿåˆ—çš„åº”ç”¨" class="headerlink" title="é˜»å¡é˜Ÿåˆ—çš„åº”ç”¨"></a>é˜»å¡é˜Ÿåˆ—çš„åº”ç”¨</h2><p>å‰é¢æˆ‘è¯´è¿‡ï¼Œé˜»å¡é˜Ÿåˆ—ä¸»è¦ç”¨åœ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼ä¸­ï¼Œé‚£ä¸‹é¢æˆ‘ä»¬å°±æ¥å†™ä¸€ä¸ªç®€å•çš„å°demo</p><blockquote><blockquote><p>è¿™æ®µä»£ç æ¥è‡ªåˆ˜æœ›èˆ’æ‰€è‘—ã€ŠAndroidè¿›é˜¶ä¹‹å…‰ã€‹</p></blockquote></blockquote><p>å¦‚æœä¸ç”¨é˜»å¡é˜Ÿåˆ—ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">queueSize</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> PriorityQueue&lt;Integer&gt; queue = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(queueSize);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Test</span> <span class="variable">test</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line">        <span class="type">Producer</span> <span class="variable">producer</span> <span class="operator">=</span> test.<span class="keyword">new</span> <span class="title class_">Producer</span>();</span><br><span class="line">        <span class="type">Consumer</span> <span class="variable">consumer</span> <span class="operator">=</span> test.<span class="keyword">new</span> <span class="title class_">Consumer</span>();</span><br><span class="line">        producer.start();</span><br><span class="line">        consumer.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Consumer</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (queue) &#123;</span><br><span class="line">                    <span class="keyword">while</span> (queue.size() == <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            System.out.println(<span class="string">&quot;é˜Ÿåˆ—ç©ºï¼Œç­‰å¾…æ•°æ®&quot;</span>);</span><br><span class="line">                            queue.wait();</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                            queue.notify();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// æ¯æ¬¡ç§»èµ°é˜Ÿé¦–å…ƒç´ </span></span><br><span class="line">                    queue.poll();</span><br><span class="line">                    queue.notify();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">Producer</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (queue) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;é˜Ÿåˆ—æ»¡ï¼Œç­‰å¾…æœ‰ç©ºä½™ç©ºé—´&quot;</span>);</span><br><span class="line">                        queue.wait();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                        queue.notify();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// æ¯æ¬¡æ’å…¥ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">                queue.offer(<span class="number">1</span>);</span><br><span class="line">                queue.notify();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä½¿ç”¨é˜»å¡é˜Ÿåˆ—<code>ArrayBlockingQueue</code>ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.ArrayBlockingQueue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlockingQueueTest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">queueSize</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> ArrayBlockingQueue&lt;Integer&gt; queue = <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(queueSize);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">BlockingQueueTest</span> <span class="variable">test</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BlockingQueueTest</span>();</span><br><span class="line">        BlockingQueueTest.<span class="type">Producer</span> <span class="variable">producer</span> <span class="operator">=</span> test.<span class="keyword">new</span> <span class="title class_">Producer</span>();</span><br><span class="line">        BlockingQueueTest.<span class="type">Consumer</span> <span class="variable">consumer</span> <span class="operator">=</span> test.<span class="keyword">new</span> <span class="title class_">Consumer</span>();</span><br><span class="line">        producer.start();</span><br><span class="line">        consumer.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Consumer</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    queue.take();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">Producer</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    queue.put(<span class="number">1</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Java/">Java</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Java/">Java</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/">å¤šçº¿ç¨‹</category>
      
      
      <comments>https://www.littlecorgi.top/posts/63ab42b7.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Kotlinå…¥é—¨1:Kotlinå’ŒJavaåŒºåˆ«åŸºç¡€ç¯‡</title>
      <link>https://www.littlecorgi.top/posts/343b01ae.html</link>
      <guid>https://www.littlecorgi.top/posts/343b01ae.html</guid>
      <pubDate>Sun, 02 Jun 2019 09:16:17 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;Koltinå…¥é—¨&quot;&gt;&lt;a href=&quot;#Koltinå…¥é—¨&quot; class=&quot;headerlink&quot; title=&quot;Koltinå…¥é—¨&quot;&gt;&lt;/a&gt;Koltinå…¥é—¨&lt;/h1&gt;&lt;h1 id=&quot;Kotlinç®€ä»‹&quot;&gt;&lt;a href=&quot;#Kotlinç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;Kotlinç®€ä»‹&quot;&gt;&lt;/a&gt;Kotlinç®€ä»‹&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;ç§‘ç‰¹æ—å²›(ĞšĞ¾Ñ‚Ğ»Ğ¸Ğ½)æ˜¯ä¸€åº§ä¿„ç½—æ–¯çš„å²›å±¿,ä½äºåœ£å½¼å¾—å ¡ä»¥è¥¿çº¦30å…¬é‡Œå¤„,å½¢çŠ¶ç‹­é•¿,ä¸œè¥¿é•¿åº¦çº¦14å…¬é‡Œ,å—åŒ—å®½åº¦çº¦2å…¬é‡Œ,é¢ç§¯æœ‰16å¹³æ–¹å…¬é‡Œ,æ‰¼å®ˆä¿„å›½è¿›å…¥èŠ¬å…°æ¹¾çš„æ°´é“ã€‚ç§‘ç‰¹æ—å²›ä¸Šå»ºæœ‰å–€ç…æ–½å¡”å¾—å¸‚,ä¸ºåœ£å½¼å¾—å ¡ä¸‹è¾–çš„åŸå¸‚ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è€Œæˆ‘ä»¬è™½è¯´çš„kotlinï¼Œå°±æ˜¯ä¸€é—¨æ ¹æ®å®ƒå‘½åçš„ä¸€ç§ç°ä»£ç¨‹åºè®¾è®¡è¯­è¨€ã€‚Kotlin æ˜¯ä¸€ä¸ªç”¨äºç°ä»£å¤šå¹³å°åº”ç”¨çš„é™æ€ç¼–ç¨‹è¯­è¨€ï¼Œç”± JetBrains å¼€å‘ã€‚Kotlinå¯ä»¥ç¼–è¯‘æˆJavaå­—èŠ‚ç ï¼Œä¹Ÿå¯ä»¥ç¼–è¯‘JavaScriptï¼Œæ–¹ä¾¿åœ¨æ²¡æœ‰JVMçš„è®¾å¤‡ä¸Šè¿è¡Œã€‚Kotlinå·²æ­£å¼æˆä¸ºAndroidå®˜æ–¹æ”¯æŒå¼€å‘è¯­è¨€ã€‚&lt;/p&gt;
&lt;h2 id=&quot;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;headerlink&quot; title=&quot;&quot;&gt;&lt;/a&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="Koltinå…¥é—¨"><a href="#Koltinå…¥é—¨" class="headerlink" title="Koltinå…¥é—¨"></a>Koltinå…¥é—¨</h1><h1 id="Kotlinç®€ä»‹"><a href="#Kotlinç®€ä»‹" class="headerlink" title="Kotlinç®€ä»‹"></a>Kotlinç®€ä»‹</h1><blockquote><p>ç§‘ç‰¹æ—å²›(ĞšĞ¾Ñ‚Ğ»Ğ¸Ğ½)æ˜¯ä¸€åº§ä¿„ç½—æ–¯çš„å²›å±¿,ä½äºåœ£å½¼å¾—å ¡ä»¥è¥¿çº¦30å…¬é‡Œå¤„,å½¢çŠ¶ç‹­é•¿,ä¸œè¥¿é•¿åº¦çº¦14å…¬é‡Œ,å—åŒ—å®½åº¦çº¦2å…¬é‡Œ,é¢ç§¯æœ‰16å¹³æ–¹å…¬é‡Œ,æ‰¼å®ˆä¿„å›½è¿›å…¥èŠ¬å…°æ¹¾çš„æ°´é“ã€‚ç§‘ç‰¹æ—å²›ä¸Šå»ºæœ‰å–€ç…æ–½å¡”å¾—å¸‚,ä¸ºåœ£å½¼å¾—å ¡ä¸‹è¾–çš„åŸå¸‚ã€‚</p></blockquote><p>è€Œæˆ‘ä»¬è™½è¯´çš„kotlinï¼Œå°±æ˜¯ä¸€é—¨æ ¹æ®å®ƒå‘½åçš„ä¸€ç§ç°ä»£ç¨‹åºè®¾è®¡è¯­è¨€ã€‚Kotlin æ˜¯ä¸€ä¸ªç”¨äºç°ä»£å¤šå¹³å°åº”ç”¨çš„é™æ€ç¼–ç¨‹è¯­è¨€ï¼Œç”± JetBrains å¼€å‘ã€‚Kotlinå¯ä»¥ç¼–è¯‘æˆJavaå­—èŠ‚ç ï¼Œä¹Ÿå¯ä»¥ç¼–è¯‘JavaScriptï¼Œæ–¹ä¾¿åœ¨æ²¡æœ‰JVMçš„è®¾å¤‡ä¸Šè¿è¡Œã€‚Kotlinå·²æ­£å¼æˆä¸ºAndroidå®˜æ–¹æ”¯æŒå¼€å‘è¯­è¨€ã€‚</p><h2 id=""><a href="#" class="headerlink" title=""></a><span id="more"></span></h2><h1 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h1><p>kotlinå’ŒJavaçš„æœ€åŸºæœ¬çš„åŒºåˆ«å°±æ˜¯kotlinä¸­<strong>ä¸‡ç‰©çš†å¯¹è±¡</strong>ï¼ŒJavaä¸­è¿˜å­˜åœ¨ç€intã€floatç­‰åŸºæœ¬ç±»å‹ï¼Œä½†æ˜¯åœ¨kotlinä¸­ï¼Œå®ƒæŠŠè¿™äº›éƒ½å®šä¹‰æˆäº†å¯¹è±¡ï¼Œç±»ä¼¼äºJavaä¸­çš„å°è£…ç±»</p><h2 id="å˜é‡çš„å£°æ˜"><a href="#å˜é‡çš„å£°æ˜" class="headerlink" title="å˜é‡çš„å£°æ˜"></a>å˜é‡çš„å£°æ˜</h2><p>ä¸Šé¢è¯´äº†ï¼Œkotlinä¸‡ç‰©çš†å¯¹è±¡ï¼Œæ‰€ä»¥æ‰€æœ‰çš„å˜é‡ä¹Ÿéƒ½æ˜¯å¯¹è±¡ã€‚<br>åœ¨kotlinå®šä¹‰å¯¹è±¡å’ŒJavaæœ‰ç‚¹å°åŒºåˆ«ã€‚<br>kotlinå®šä¹‰å¯¹è±¡çš„æ ¼å¼ä¸º</p><blockquote><p> å£°æ˜ç±»å‹ å˜é‡åï¼š å˜é‡ç±»å‹</p></blockquote><p>å…¶ä¸­ï¼š</p><ul><li>å£°æ˜ç±»å‹åˆ†ä¸º<code>val</code>å’Œ<code>var</code>ã€‚<code>val</code>æ˜¯ä¸å¯å˜ç±»å‹ï¼Œç±»ä¼¼äºconstï¼Œå®šä¹‰æ—¶å¿…é¡»èµ‹å€¼ï¼Œèµ‹å€¼åä¸èƒ½è¢«ä¿®æ”¹ã€‚<code>var</code>æ˜¯å¯å˜ç±»å‹ã€‚</li><li>å˜é‡åå°±æ˜¯ä½ å®šä¹‰çš„è¿™ä¸ªå˜é‡çš„åç§°ã€‚</li><li>å˜é‡ç±»å‹å°±æ˜¯ä½ è¿™ä¸ªå˜é‡å¯¹åº”çš„ç±»çš„åå­—ã€‚</li></ul><h2 id="ç±»å‹æ¨æ–­"><a href="#ç±»å‹æ¨æ–­" class="headerlink" title="ç±»å‹æ¨æ–­"></a>ç±»å‹æ¨æ–­</h2><h3 id="çœå»å˜é‡ç±»å‹"><a href="#çœå»å˜é‡ç±»å‹" class="headerlink" title="çœå»å˜é‡ç±»å‹"></a>çœå»å˜é‡ç±»å‹</h3><p>kotliné‡Œé¢ç±»ä¼¼c++çš„<code>auto</code>ç±»å‹ï¼Œå¯¹äºåŸºæœ¬ç±»å‹ï¼Œä½ å¯ä»¥ä¸å†™å˜é‡ç±»å‹ï¼Œkotlinä¼šè‡ªåŠ¨å¸®ä½ åˆ¤æ–­ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">5</span></span><br><span class="line">println(a <span class="keyword">is</span> <span class="built_in">Int</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = â€œ<span class="number">123</span></span><br><span class="line">println(b <span class="keyword">is</span> String)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c = <span class="number">1.3</span></span><br><span class="line">println(c <span class="keyword">is</span> <span class="built_in">Float</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> d = <span class="literal">true</span></span><br><span class="line">println(d <span class="keyword">is</span> <span class="built_in">Boolean</span>)</span><br></pre></td></tr></table></figure><h3 id="iså…³é”®å­—"><a href="#iså…³é”®å­—" class="headerlink" title="iså…³é”®å­—"></a><code>is</code>å…³é”®å­—</h3><p><code>is</code>é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯åˆ¤æ–­è¿™ä¸ªå˜é‡æ˜¯ä¸æ˜¯è¿™ä¸ªç±»å‹çš„å®ä¾‹ã€‚<br>ä¾‹å­è§ä¸Šã€‚</p><h2 id="æ•°å­—ç±»å‹"><a href="#æ•°å­—ç±»å‹" class="headerlink" title="æ•°å­—ç±»å‹"></a>æ•°å­—ç±»å‹</h2><div class="table-container"><table><thead><tr><th>ç±»å‹</th><th>å®½åº¦(bit)</th></tr></thead><tbody><tr><td>Byte</td><td>8</td></tr><tr><td>Short</td><td>16</td></tr><tr><td>Int</td><td>32</td></tr><tr><td>Long</td><td>64</td></tr><tr><td>Float</td><td>32</td></tr><tr><td>Double</td><td>64</td></tr></tbody></table></div><p>è¿™äº›ç±»å‹éƒ½ç»§æ‰¿è‡ª<code>Number</code>å’Œ<code>Comparable</code>ç±»ã€‚</p><h3 id="å­—é¢å¸¸é‡å€¼"><a href="#å­—é¢å¸¸é‡å€¼" class="headerlink" title="å­—é¢å¸¸é‡å€¼"></a>å­—é¢å¸¸é‡å€¼</h3><ul><li>åè¿›åˆ¶ï¼š<code>123</code></li><li>åå…­è¿›åˆ¶ï¼š<code>0x0f</code></li><li>äºŒè¿›åˆ¶ï¼š<code>0b0010</code></li><li>Longç±»å‹ï¼š<code>123L</code></li><li>doubleç±»å‹ï¼š123.4</li><li>Floatç±»å‹ï¼š<code>123.4f</code>æˆ–è€…<code>123.4F</code></li></ul><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹åˆ’çº¿<code>_</code>æ¥æ–¹ä¾¿æˆ‘ä»¬é˜…è¯»</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1_000_000</span> <span class="comment">// 1000000</span></span><br><span class="line"><span class="number">0xFF_EC</span> <span class="comment">// 0xFFEC</span></span><br></pre></td></tr></table></figure><h3 id="æ˜¾ç¤ºè½¬æ¢"><a href="#æ˜¾ç¤ºè½¬æ¢" class="headerlink" title="æ˜¾ç¤ºè½¬æ¢"></a>æ˜¾ç¤ºè½¬æ¢</h3><p>kotlinä¸­ä¸å¯éšå¼è½¬æ¢<br>æ¯”å¦‚Java ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"><span class="type">long</span> <span class="variable">b</span> <span class="operator">=</span> a;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åœ¨kotlinä¸­</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a : <span class="built_in">Int</span>? = <span class="number">2</span></span><br><span class="line"><span class="keyword">var</span> b : <span class="built_in">Long</span>? = a; <span class="comment">// error</span></span><br><span class="line"><span class="keyword">var</span> b : <span class="built_in">Long</span>? = a.toLong()</span><br></pre></td></tr></table></figure><h2 id="Charç±»å‹"><a href="#Charç±»å‹" class="headerlink" title="Charç±»å‹"></a>Charç±»å‹</h2><p>kotlinä¸­çš„<code>Char</code>è¡¨ç¤ºå­—ç¬¦ã€‚ä½†æ˜¯å’ŒJavaä¸åŒï¼Œä»–ä¸èƒ½ç›´æ¥å½“ASCIIç å€¼ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">check</span><span class="params">(c : <span class="type">Char</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (c == <span class="number">1</span>) &#123; <span class="comment">// error </span></span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Booleanç±»å‹"><a href="#Booleanç±»å‹" class="headerlink" title="Booleanç±»å‹"></a>Booleanç±»å‹</h2><p>kotlinä¸­çš„å¸ƒå°”ç±»å‹ç”¨<code>Boolean</code>æ¥è¡¨ç¤ºï¼Œä»–æœ‰ä¸¤ä¸ªå€¼<code>true</code>å’Œ<code>false</code>ã€‚ç”¨æ³•å’ŒJavaä¸€æ ·ã€‚</p><h2 id="Stringç±»å‹"><a href="#Stringç±»å‹" class="headerlink" title="Stringç±»å‹"></a>Stringç±»å‹</h2><p>å’ŒJavaä¸€æ ·ï¼Œkotlinä¸­çš„å­—ç¬¦ä¸²ä¹Ÿæ˜¯<code>String</code>ã€‚ä½†æ˜¯kotlinä¸­<code>String</code>æ˜¯ä¸å¯å˜çš„ã€‚æ‰€ä»¥kotlinä¸­<code>String</code>å¿…é¡»æ˜¯<code>val</code>ç±»å‹ã€‚åŒæ—¶ï¼Œ<code>String</code>æ˜¯<code>final</code>ä¸å¯ç»§æ‰¿çš„ã€‚</p><h2 id="Arrayç±»å‹"><a href="#Arrayç±»å‹" class="headerlink" title="Arrayç±»å‹"></a>Arrayç±»å‹</h2><p>kotlinä¸­æ•°ç»„å¿…é¡»ä½¿ç”¨<code>Array</code>è¡¨ç¤ºã€‚<br>åŸºæœ¬å†™æ³•</p><blockquote><p>val array: Array&lt;ç±»å‹&gt; = arrayOf(..)</p></blockquote><p>ä¾‹å¦‚<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**æ•´å‹Intçš„æ•°ç»„*/</span></span><br><span class="line"><span class="keyword">val</span> arrayOfInt: IntArray = intArrayOf(<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">9</span>)</span><br><span class="line"><span class="comment">/**å­—ç¬¦Charç±»å‹çš„æ•°ç»„*/</span></span><br><span class="line"><span class="keyword">val</span> arrayOfChar: CharArray = charArrayOf(<span class="string">&#x27;H&#x27;</span>,<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;l&#x27;</span>,<span class="string">&#x27;l&#x27;</span>,<span class="string">&#x27;o&#x27;</span>,<span class="string">&#x27;W&#x27;</span>,<span class="string">&#x27;o&#x27;</span>,<span class="string">&#x27;r&#x27;</span>,<span class="string">&#x27;l&#x27;</span>,<span class="string">&#x27;d&#x27;</span>)</span><br><span class="line"><span class="comment">/**å­—ç¬¦ä¸²Stringæ•°ç»„*/</span></span><br><span class="line"><span class="keyword">val</span> arrayOfString: Array&lt;String&gt; = arrayOf(<span class="string">&quot;Hello&quot;</span>,<span class="string">&quot;World&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    <span class="comment">//æŸ¥çœ‹æœ‰å¤šå°‘ä¸ªå…ƒç´ </span></span><br><span class="line">    println(arrayOfInt.size)</span><br><span class="line">    <span class="comment">//éå†æ•°ç»„</span></span><br><span class="line">    <span class="keyword">for</span> (char <span class="keyword">in</span> arrayOfChar)&#123;</span><br><span class="line">        println(char)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ ¹æ®æ‰€å¼•è·å–æ•°æ®,æ•°ç»„æ˜¯ä»0å¼€å§‹çš„ï¼Œç°åœ¨è·å–ç¬¬äºŒä¸ªä¸œäº¬å¤§å­¦</span></span><br><span class="line">    println(arrayOfUniversity[<span class="number">1</span>])</span><br><span class="line">    <span class="comment">//é‡æ–°ç»™æ•°ç»„èµ‹å€¼ï¼Œæ—©ç¨»ç”°å¤§å­¦</span></span><br><span class="line">    arrayOfUniversity[<span class="number">1</span>] = University(<span class="string">&quot;æ—©ç¨»ç”°å¤§å­¦&quot;</span>)</span><br><span class="line">    println(arrayOfUniversity[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å°†charè¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²,é»˜è®¤æ˜¯è‡ªåŠ¨ç”±é€—å·&quot;,&quot;åˆ†å‰²çš„ï¼Œè¾“å‡ºH, e, l, l, o, W, o, r, l, d</span></span><br><span class="line">    println(arrayOfChar.joinToString())</span><br><span class="line">    <span class="comment">//å¦‚æœæƒ³è¦è¿æˆHelloWorld</span></span><br><span class="line">    println(arrayOfChar.joinToString (<span class="string">&quot;&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ•°ç»„çš„åˆ‡ç‰‡,è¾“å‡º3ï¼Œ5,ç»“å°¾éœ€è¦arrayOfInt-1ï¼Œä¸ç„¶ä¼šæŠ¥ç´¢å¼•è¶Šç•Œå¼‚å¸¸</span></span><br><span class="line">    println(arrayOfInt.slice(<span class="number">1.</span><span class="number">.2</span>))</span><br><span class="line"></span><br><span class="line">    println(arrayOfInt.size)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Kotlin/">Kotlin</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Kotlin/">Kotlin</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/">è¯­è¨€åŸºç¡€</category>
      
      
      <comments>https://www.littlecorgi.top/posts/343b01ae.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Kotlin Ankoå…¥é—¨</title>
      <link>https://www.littlecorgi.top/posts/62bb1dd7.html</link>
      <guid>https://www.littlecorgi.top/posts/62bb1dd7.html</guid>
      <pubDate>Sat, 01 Jun 2019 04:30:56 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;Kotlin-Ankoå…¥é—¨&quot;&gt;&lt;a href=&quot;#Kotlin-Ankoå…¥é—¨&quot; class=&quot;headerlink&quot; title=&quot;Kotlin Ankoå…¥é—¨&quot;&gt;&lt;/a&gt;Kotlin Ankoå…¥é—¨&lt;/h1&gt;&lt;h1 id=&quot;ç®€ä»‹&quot;&gt;&lt;a href=&quot;#ç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;ç®€ä»‹&quot;&gt;&lt;/a&gt;ç®€ä»‹&lt;/h1&gt;&lt;p&gt;Ankoçš„å®˜ç½‘å°±æ˜¯ä»–çš„GitHubåœ°å€&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/Kotlin/anko&quot;&gt;https://github.com/Kotlin/anko&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å®˜æ–¹å¯¹Ankoçš„è§£é‡Šæ˜¯&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Ankoæ˜¯ä¸€ä¸ª &lt;a href=&quot;https://www.kotlinlang.org/&quot;&gt;Kotlin&lt;/a&gt; åº“ï¼Œå®ƒä½¿Androidåº”ç”¨ç¨‹åºå¼€å‘æ›´å¿«æ›´å®¹æ˜“ã€‚å®ƒä½¿æ‚¨çš„ä»£ç æ¸…æ™°æ˜“è¯»ï¼Œè®©æ‚¨å¿˜è®°Android SDK for Javaçš„ç²—ç³™è¾¹ç¼˜ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="Kotlin-Ankoå…¥é—¨"><a href="#Kotlin-Ankoå…¥é—¨" class="headerlink" title="Kotlin Ankoå…¥é—¨"></a>Kotlin Ankoå…¥é—¨</h1><h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>Ankoçš„å®˜ç½‘å°±æ˜¯ä»–çš„GitHubåœ°å€</p><blockquote><p><a href="https://github.com/Kotlin/anko">https://github.com/Kotlin/anko</a></p></blockquote><p>å®˜æ–¹å¯¹Ankoçš„è§£é‡Šæ˜¯</p><blockquote><p>Ankoæ˜¯ä¸€ä¸ª <a href="https://www.kotlinlang.org/">Kotlin</a> åº“ï¼Œå®ƒä½¿Androidåº”ç”¨ç¨‹åºå¼€å‘æ›´å¿«æ›´å®¹æ˜“ã€‚å®ƒä½¿æ‚¨çš„ä»£ç æ¸…æ™°æ˜“è¯»ï¼Œè®©æ‚¨å¿˜è®°Android SDK for Javaçš„ç²—ç³™è¾¹ç¼˜ã€‚</p></blockquote><span id="more"></span><p>ä¸ºä»€ä¹ˆè¿™æ ·è¯´å‘¢ï¼Ÿ<br>æ¯”æ–¹è¯´å¦‚æœä½ å†™Androidï¼Œä½ åœ¨xmlä¸­å®šä¹‰äº†ä¸€ä¸ª<code>Button</code>ï¼Œä»–çš„IDæ˜¯<code>button_login</code>ã€‚<br>å¦‚æœæ˜¯Javaï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setContentView(R.layout.activity_words_detail);</span><br><span class="line"><span class="type">Button</span> <span class="variable">button</span> <span class="operator">=</span> findViewById(R.Id.button_login);</span><br></pre></td></tr></table></figure><br>è€Œå¦‚æœä½ ä½¿ç”¨kotlinçš„è¯ï¼Œä½ å¯ä»¥å°±æŒ‰å¦‚ä¸‹ä»£ç å†™<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> kotlinx.android.synthetic.main.activity_kotlin_main.*</span><br><span class="line">...</span><br><span class="line">button_login.setText(<span class="string">&quot;Kotlin Android Extensions æˆ‘ä¸å¤ªå–œæ¬¢&quot;</span>);</span><br></pre></td></tr></table></figure><br>è¿™æ ·ç¡®å®æ¯”Javaæ–¹ä¾¿å¤šäº†ï¼Œä¸éœ€è¦å¯¹æ¯ä¸€ä¸ªç»„ä»¶éƒ½å®šä¹‰å†findViewByIdï¼Œå¯ä»¥å°±ç›´æ¥è¾“å…¥ç»„ä»¶çš„idç„¶åå°±èƒ½ä½¿ç”¨äº†ã€‚ä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯è§‰å¾—ä¸å¤Ÿå•Šï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½å°±ç›´æ¥åœ¨ä»£ç ä¸­å†™å…¥å„ä¸ªç»„ä»¶å‘¢ï¼Œäºæ˜¯ï¼ŒAnkoæ¥äº†ã€‚</p><h1 id="å¯¼å…¥Anko"><a href="#å¯¼å…¥Anko" class="headerlink" title="å¯¼å…¥Anko"></a>å¯¼å…¥Anko</h1><p>Ankoç”±å‡ éƒ¨åˆ†ç»„æˆï¼š</p><ul><li><em>Anko Commons</em>ï¼šä¸€ä¸ªè½»é‡çº§çš„åº“ï¼ŒåŒ…å«ç”¨äºLayoutsï¼ŒIntentï¼ŒLogç­‰çš„å¸®åŠ©ç¨‹åº;</li><li><em>Anko Layouts</em>ï¼šä¸€ç§å¿«é€Ÿä¸”ç±»å‹å®‰å…¨çš„æ–¹å¼æ¥ç¼–å†™åŠ¨æ€Androidå¸ƒå±€;</li><li><em>Anko SQLite</em>ï¼šAndroid SQLiteçš„æŸ¥è¯¢DSLå’Œè§£æå™¨é›†åˆ;</li><li><em>Anko Coroutines</em>ï¼šåŸºäº<a href="https://github.com/Kotlin/kotlinx.coroutines">kotlinx.coroutines</a>åº“çš„å®ç”¨ç¨‹åºã€‚</li></ul><p>ä½ å¯ä»¥åœ¨appçš„<code>build.gradle</code>ä¸­æ·»åŠ <br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">     <span class="comment">// Anko Layouts</span></span><br><span class="line">    implementation <span class="string">&quot;org.jetbrains.anko:anko-sdk25:$anko_version&quot;</span> <span class="comment">// sdk15, sdk19, sdk21, sdk23 are also available</span></span><br><span class="line">    implementation <span class="string">&quot;org.jetbrains.anko:anko-appcompat-v7:$anko_version&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Coroutine listeners for Anko Layouts</span></span><br><span class="line">    implementation <span class="string">&quot;org.jetbrains.anko:anko-sdk25-coroutines:$anko_version&quot;</span></span><br><span class="line">    implementation <span class="string">&quot;org.jetbrains.anko:anko-appcompat-v7-coroutines:$anko_version&quot;</span>&#125;</span><br></pre></td></tr></table></figure><br>è¿™ä¸ªä¾èµ–å¯ä»¥ç›´æ¥å¯¼å…¥æ‰€æœ‰çš„å¯ç”¨ç‰¹æ€§ï¼ˆåŒ…æ‹¬Commons, Layouts, SQLite)ã€‚</p><h1 id="ä½¿ç”¨Anko-layout"><a href="#ä½¿ç”¨Anko-layout" class="headerlink" title="ä½¿ç”¨Anko layout"></a>ä½¿ç”¨Anko layout</h1><h2 id="åˆ›å»ºç®€å•å¸ƒå±€"><a href="#åˆ›å»ºç®€å•å¸ƒå±€" class="headerlink" title="åˆ›å»ºç®€å•å¸ƒå±€"></a>åˆ›å»ºç®€å•å¸ƒå±€</h2><p>ä½¿ç”¨Ankoåˆ›å»ºå¸ƒå±€å¾ˆç®€å•ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">AppCompatActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        verticalLayout &#123;</span><br><span class="line">            padding = dip(<span class="number">30</span>)</span><br><span class="line">            editText &#123;</span><br><span class="line">                hint = <span class="string">&quot;Name&quot;</span></span><br><span class="line">                textSize = <span class="number">24f</span></span><br><span class="line">            &#125;</span><br><span class="line">            editText &#123;</span><br><span class="line">                hint = <span class="string">&quot;Password&quot;</span></span><br><span class="line">                textSize = <span class="number">24f</span></span><br><span class="line">            &#125;</span><br><span class="line">            button(<span class="string">&quot;ç™»å½•&quot;</span>) &#123;</span><br><span class="line">                textSize = <span class="number">26f</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ åªéœ€è¦åœ¨Activityä¸­å†™å…¥DSLä»£ç å°±èƒ½ä½¿ç”¨å®ƒã€‚</p><h2 id="AnkoComponent"><a href="#AnkoComponent" class="headerlink" title="AnkoComponent"></a>AnkoComponent</h2><p>å°½ç®¡æˆ‘ä»¬ç°åœ¨å¯ä»¥ç›´æ¥åœ¨Activityä¸­å†™å…¥DSLä»£ç ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯è§‰å¾—æŠŠä»£ç å’Œå¸ƒå±€æ–‡ä»¶æ”¾åœ¨ä¸€èµ·ä¸å¤ªå¥½ï¼Œå¸Œæœ›æŠŠActivityå’ŒDSlä»£ç æ”¾åˆ°ä¸¤ä¸ªä¸åŒçš„ç±»é‡Œé¢ï¼Œæ‰€ä»¥AnkoComponentå°±å‡ºæ¥äº†ã€‚<br>ä»£ç å¦‚ä¸‹<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">AppCompatActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        MainActivityUI().setContentView(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivityUI</span> : <span class="type">AnkoComponent</span>&lt;<span class="type">MainActivity</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">createView</span><span class="params">(ui: <span class="type">AnkoContext</span>&lt;<span class="type">MainActivity</span>&gt;)</span></span> = with(ui) &#123;</span><br><span class="line">        verticalLayout &#123;</span><br><span class="line">            padding = dip(<span class="number">30</span>)</span><br><span class="line">            editText &#123;</span><br><span class="line">                hint = <span class="string">&quot;Name&quot;</span></span><br><span class="line">                textSize = <span class="number">24f</span></span><br><span class="line">            &#125;</span><br><span class="line">            editText &#123;</span><br><span class="line">                hint = <span class="string">&quot;Password&quot;</span></span><br><span class="line">                textSize = <span class="number">24f</span></span><br><span class="line">            &#125;</span><br><span class="line">            button(<span class="string">&quot;ç™»å½•&quot;</span>) &#123;</span><br><span class="line">                textSize = <span class="number">26f</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="Theme"><a href="#Theme" class="headerlink" title="Theme"></a>Theme</h2><p>åœ¨Ankoå¦‚æœä½ æƒ³è®¾ç½®Themeéœ€è¦ä½¿ç”¨<code>themeable</code><br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">verticalLayout &#123;</span><br><span class="line">    padding = dip(<span class="number">30</span>)</span><br><span class="line">    themedButton(<span class="string">&quot;ç™»é™†&quot;</span>, theme = R.style.Base_TextAppearance_AppCompat_Button)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="LayoutParams"><a href="#LayoutParams" class="headerlink" title="LayoutParams"></a>LayoutParams</h2><p>åœ¨Ankoä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨<code>LayoutParams</code>ã€‚<br>æ¯”æ–¹è¯´æˆ‘ç°åœ¨è¦æ˜¾ç¤ºä¸€ä¸ªbuttonï¼Œä¸‹é¢æ˜¾ç¤ºä¸€ä¸ªå›¾ç‰‡ã€‚</p><p>å¦‚æœä½¿ç”¨XML:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;.MainActivity&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Hello World!&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:gravity</span>=<span class="string">center</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textSize</span>=<span class="string">&quot;20sp&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">&quot;@color/colorAccent&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯ä½¿ç”¨Anko:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">verticalLayout &#123;</span><br><span class="line">    textView (<span class="string">&quot;Hello World!&quot;</span>) &#123;</span><br><span class="line">        textSize = sp(<span class="number">12</span>).toFloat()</span><br><span class="line">    &#125;.lparams(height = wrapContent, width = wrapContent) &#123;</span><br><span class="line">        horizontalGravity = Gravity.CENTER_HORIZONTAL</span><br><span class="line">    &#125;</span><br><span class="line">    imageView &#123;</span><br><span class="line">        backgroundColor = Color.BLUE</span><br><span class="line">    &#125;.lparams(height = matchParent, width = matchParent)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š</p><ul><li><code>horizontalMargin</code> åŒæ—¶è®¾ç½® left å’Œ right margins</li><li><code>verticalMargin</code> åŒæ—¶è®¾ç½® top å’Œ bottom</li><li><code>margin</code> åŒæ—¶è®¾ç½®4ä¸ªæ–¹å‘çš„ margins</li></ul><h2 id="Listeners"><a href="#Listeners" class="headerlink" title="Listeners"></a>Listeners</h2><p>åœ¨Ankoä¸­è®¾ç½®<code>Listeners</code>éå¸¸ç®€å•ï¼Œæˆ‘ä¸‹é¢ä»¥<code>Button</code>çš„<code>OnClick</code>ä¸¾ä¾‹ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">button(<span class="string">&quot;ç™»å½•&quot;</span>) &#123;</span><br><span class="line">    id = buttonLogin</span><br><span class="line">    textSize = <span class="number">26f</span></span><br><span class="line">    onClick &#123; toast(<span class="string">&quot;OnClickLoginButton&quot;</span>) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="ä½¿ç”¨FragmentåŠ è½½"><a href="#ä½¿ç”¨FragmentåŠ è½½" class="headerlink" title="ä½¿ç”¨FragmentåŠ è½½"></a>ä½¿ç”¨FragmentåŠ è½½</h2><p>å…ˆåˆ›å»ºä¸€ä¸ª<code>Activity</code>ï¼ŒæŠŠ<code>Fragment</code>åŠ è¿›å»<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AnkoFragmentActivity</span> : <span class="type">AppCompatActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        linearLayout &#123;</span><br><span class="line">            id = R.id.fragment_id</span><br><span class="line">            supportFragmentManager.beginTransaction().replace(id, AnkoFragment.newInstance()).commit()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ç„¶ååœ¨<code>Fragment</code>çš„<code>onCreateView()</code>ä¸­åŠ å…¥DSLä»£ç ï¼Œç„¶åè¿”å›<code>View</code>å³å¯<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AnkoFragment</span> : <span class="type">Fragment</span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateView</span><span class="params">(inflater: <span class="type">LayoutInflater</span>, container: <span class="type">ViewGroup</span>?, savedInstanceState: <span class="type">Bundle</span>?)</span></span>: View? &#123;</span><br><span class="line">        <span class="comment">// return inflater.inflate(R.layout.fragment_anko, container, false)</span></span><br><span class="line">        <span class="keyword">return</span> UI &#123;</span><br><span class="line">            verticalLayout &#123;</span><br><span class="line">                editText()</span><br><span class="line">                button(<span class="string">&quot;OK&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.view</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">newInstance</span><span class="params">()</span></span>: AnkoFragment &#123;</span><br><span class="line">            <span class="keyword">return</span> AnkoFragment()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="ä¸è¶³"><a href="#ä¸è¶³" class="headerlink" title="ä¸è¶³"></a>ä¸è¶³</h2><p>AnkoLayoutç¡®å®æŒºå¥½çš„ï¼Œå› ä¸ºä»–æŠŠUIä»£ç é›†æˆåˆ°äº†ä»£ç æ–‡ä»¶ä¸­ï¼Œä¸ç”¨å†åƒä»¥å‰ä¸€æ ·å†™ä¸€ä¸ªç‚¹å‡»äº‹ä»¶è¿˜å¾—å…ˆ<code>findViewBuId</code>ï¼Œç„¶åå†<code>setOnClickListeners</code>ã€‚ä»£ç èƒ½éå¸¸ç®€æ´ã€‚</p><p>ä½†æ˜¯AnkoLayoutè¿˜æ˜¯ä¸å¤Ÿå®Œç¾ï¼Œæ„Ÿè§‰å†™èµ·æ¥è¿˜æ˜¯æ²¡æœ‰XMLé‚£ä¸ªé¡ºæ‰‹ï¼ˆå¯èƒ½æ˜¯æˆ‘å†™æƒ¯äº†XMLï¼Œåˆšå¼€å§‹ç”¨Ankoè¿˜ä¸å¤Ÿç†Ÿç»ƒï¼‰ï¼Œè€Œä¸”Ankoè¿˜æœ‰å¾ˆå¤šæ§ä»¶éƒ½ä¸æ”¯æŒã€‚<br>æœ€é‡è¦çš„æ˜¯ï¼Œ<strong>ä»–æ²¡æœ‰å®æ—¶é¢„è§ˆ</strong>ï¼ï¼ï¼</p><blockquote><p>Android Studioé‡Œé¢æœ‰ä¸€ä¸ªå«<code>Anko Support</code>çš„æ’ä»¶ï¼Œå¯ä»¥å®ç°ankoçš„é¢„è§ˆï¼Œä½†æ˜¯ä»–å¿…é¡»æ˜¯å…ˆå°†é¡¹ç›®æ„å»ºäº†å†é¢„è§ˆçš„ï¼Œä¸ç®—æ˜¯å®æ—¶é¢„è§ˆ</p></blockquote>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Kotlin/">Kotlin</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Kotlin/">Kotlin</category>
      
      
      <comments>https://www.littlecorgi.top/posts/62bb1dd7.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>AndroidViewä¹‹PopupWindow</title>
      <link>https://www.littlecorgi.top/posts/1900f7eb.html</link>
      <guid>https://www.littlecorgi.top/posts/1900f7eb.html</guid>
      <pubDate>Fri, 31 May 2019 11:21:15 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;AndroidViewä¹‹PopupWindow&quot;&gt;&lt;a href=&quot;#AndroidViewä¹‹PopupWindow&quot; class=&quot;headerlink&quot; title=&quot;AndroidViewä¹‹PopupWindow&quot;&gt;&lt;/a&gt;AndroidViewä¹‹PopupWindow&lt;/h1&gt;&lt;p&gt;å› ä¸ºé¡¹ç›®ä¸­æœ‰å¾ˆå¤šåœ°æ–¹éƒ½éœ€è¦ä½¿ç”¨PopupWindowï¼Œæ‰€ä»¥ç‰¹åˆ«æŸ¥äº†ä¸€ä¸‹ï¼Œåšäº†ä¸€ä¸ªç®€å•çš„æ€»ç»“ï¼Œè¿‡ä¸¤å¤©å°±åŠ åˆ°é¡¹ç›®ä¸­å»ã€‚&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="AndroidViewä¹‹PopupWindow"><a href="#AndroidViewä¹‹PopupWindow" class="headerlink" title="AndroidViewä¹‹PopupWindow"></a>AndroidViewä¹‹PopupWindow</h1><p>å› ä¸ºé¡¹ç›®ä¸­æœ‰å¾ˆå¤šåœ°æ–¹éƒ½éœ€è¦ä½¿ç”¨PopupWindowï¼Œæ‰€ä»¥ç‰¹åˆ«æŸ¥äº†ä¸€ä¸‹ï¼Œåšäº†ä¸€ä¸ªç®€å•çš„æ€»ç»“ï¼Œè¿‡ä¸¤å¤©å°±åŠ åˆ°é¡¹ç›®ä¸­å»ã€‚</p><span id="more"></span><h1 id="PopupWindow"><a href="#PopupWindow" class="headerlink" title="PopupWindow"></a>PopupWindow</h1><p>PopupWindowï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ä¸€ä¸ªç”¨æ¥æ˜¾ç¤ºå¼¹çª—çš„ç»„ä»¶ã€‚</p><h1 id="åˆ›å»ºæ­¥éª¤"><a href="#åˆ›å»ºæ­¥éª¤" class="headerlink" title="åˆ›å»ºæ­¥éª¤"></a>åˆ›å»ºæ­¥éª¤</h1><ol><li>åˆ›å»ºPopupWindowå®ä¾‹</li><li>è®¾ç½®ä¸€äº›åŸºæœ¬å‚æ•°</li><li>æ˜¾ç¤ºPopupWindow<h1 id="æ„é€ æ–¹æ³•"><a href="#æ„é€ æ–¹æ³•" class="headerlink" title="æ„é€ æ–¹æ³•"></a>æ„é€ æ–¹æ³•</h1></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">PopupWindow</span> <span class="variable">window</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PopupWindow</span>(View contentView, <span class="type">int</span> width, <span class="type">int</span> height, <span class="type">boolean</span> focusable);</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•æœ‰å››ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç”¨äºPopupWindowä¸­çš„Viewï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯PopupWindowçš„å®½åº¦ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯PopupWindowçš„é«˜åº¦ï¼Œç¬¬å››ä¸ªå‚æ•°æŒ‡å®šPopupWindowèƒ½å¦è·å¾—ç„¦ç‚¹ã€‚</p><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">View</span> <span class="variable">contentView</span> <span class="operator">=</span> LayoutInflater.from(MainActivity.<span class="built_in">this</span>).inflate(R.layout.popuplayout, <span class="literal">null</span>);</span><br><span class="line"><span class="type">PopupWindwo</span> <span class="variable">window</span> <span class="operator">=</span> PopupWindow (contentView, ViewGroup.LayoutParams.WRAP_CONTENT, ViewGroup.LayoutParams.WRAP_CONTENT, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure><h1 id="åŸºæœ¬æ–¹æ³•"><a href="#åŸºæœ¬æ–¹æ³•" class="headerlink" title="åŸºæœ¬æ–¹æ³•"></a>åŸºæœ¬æ–¹æ³•</h1><ul><li>window.setBackgroundDrawable(Drawable background); è®¾ç½®PopupWindowçš„èƒŒæ™¯</li><li>window.setOutsideTouchable(boolean touchable); è®¾ç½®PopupWindowæ˜¯å¦èƒ½å“åº”å¤–éƒ¨ç‚¹å‡»äº‹ä»¶</li><li>window.setTouchable(boolean touchable); è®¾ç½®PopupWindowæ˜¯å¦èƒ½å“åº”ç‚¹å‡»äº‹ä»¶<br>åªæœ‰åŒæ—¶è®¾ç½®PopupWindowçš„èƒŒæ™¯å’Œå¯ä»¥å“åº”å¤–éƒ¨ç‚¹å‡»äº‹ä»¶ï¼Œå®ƒæ‰èƒ½â€œçœŸæ­£â€å“åº”å¤–éƒ¨ç‚¹å‡»äº‹ä»¶ã€‚</li></ul><h1 id="æ˜¾ç¤ºPopupWindow"><a href="#æ˜¾ç¤ºPopupWindow" class="headerlink" title="æ˜¾ç¤ºPopupWindow"></a>æ˜¾ç¤ºPopupWindow</h1><ul><li>window.showAtLocation(View parent, int gravity, int x, int y); ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯PopupWindowçš„çˆ¶Viewï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯PopupWindowç›¸å¯¹çˆ¶Viewçš„ä½ç½®ï¼Œç¬¬ä¸‰å’Œç¬¬å››ä¸ªå‚æ•°åˆ†åˆ«æ˜¯PopupWindowç›¸å¯¹çˆ¶Viewçš„xã€yåç§»</li><li>window.showAsDropDown(View anchor, int xoff, int yoff, int gravity); ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯PopupWindowçš„é”šç‚¹ï¼Œç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯PopupWindowç›¸å¯¹é”šç‚¹çš„xã€yåç§»</li></ul><h1 id="ä¸ºPopupWindowæ·»åŠ åŠ¨ç”»"><a href="#ä¸ºPopupWindowæ·»åŠ åŠ¨ç”»" class="headerlink" title="ä¸ºPopupWindowæ·»åŠ åŠ¨ç”»"></a>ä¸ºPopupWindowæ·»åŠ åŠ¨ç”»</h1><ul><li>è¿›å…¥æ—¶åŠ¨ç”»ï¼š(context_menu_enter.xml)</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="line">&lt;set xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span><br><span class="line">    &lt;translate</span><br><span class="line">        android:duration=<span class="string">&quot;@android:integer/config_shortAnimTime&quot;</span></span><br><span class="line">        android:fromXDelta=<span class="string">&quot;0&quot;</span></span><br><span class="line">        android:fromYDelta=<span class="string">&quot;100%p&quot;</span></span><br><span class="line">        android:interpolator=<span class="string">&quot;@android:anim/accelerate_decelerate_interpolator&quot;</span></span><br><span class="line">        android:toXDelta=<span class="string">&quot;0&quot;</span></span><br><span class="line">        android:toYDelta=<span class="string">&quot;0&quot;</span>/&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/set&gt;</span><br></pre></td></tr></table></figure><ul><li>é€€å‡ºæ—¶åŠ¨ç”»ï¼š(context_menu_exit.xml)</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="line">&lt;set xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span> &gt;</span><br><span class="line"> </span><br><span class="line">    &lt;translate</span><br><span class="line">        android:duration=<span class="string">&quot;@android:integer/config_shortAnimTime&quot;</span></span><br><span class="line">        android:fromXDelta=<span class="string">&quot;0&quot;</span></span><br><span class="line">        android:fromYDelta=<span class="string">&quot;0&quot;</span></span><br><span class="line">        android:interpolator=<span class="string">&quot;@android:anim/accelerate_decelerate_interpolator&quot;</span></span><br><span class="line">        android:toXDelta=<span class="string">&quot;0&quot;</span></span><br><span class="line">        android:toYDelta=<span class="string">&quot;100%p&quot;</span> /&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/set&gt;</span><br></pre></td></tr></table></figure><ul><li>ç”Ÿæˆstyle</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;style name=&quot;contextMenuAnim&quot; parent=&quot;@android:style/Animation.Activity&quot;&gt;</span><br><span class="line">    &lt;item name=&quot;android:windowEnterAnimation&quot;&gt;@anim/context_menu_enter&lt;/item&gt;</span><br><span class="line">    &lt;item name=&quot;android:windowExitAnimation&quot;&gt;@anim/context_menu_exit&lt;/item&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Android/">Android</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/View/">View</category>
      
      
      <comments>https://www.littlecorgi.top/posts/1900f7eb.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>é¢ç»-æ‰‹QAndroidé¢ç»</title>
      <link>https://www.littlecorgi.top/posts/9d6997ec.html</link>
      <guid>https://www.littlecorgi.top/posts/9d6997ec.html</guid>
      <pubDate>Mon, 31 Dec 2018 16:00:03 GMT</pubDate>
      
        
        
          
          
      <description></description>
          
        
      
      
      
      <content:encoded><![CDATA[<blockquote><p>2020/9/26æ•´ç†</p></blockquote><h1 id="å®¢æˆ·ç«¯0åŸºç¡€çš„ï¼Œæ„Ÿè§‰æ²¡é—®ä¸ªå•¥"><a href="#å®¢æˆ·ç«¯0åŸºç¡€çš„ï¼Œæ„Ÿè§‰æ²¡é—®ä¸ªå•¥" class="headerlink" title="å®¢æˆ·ç«¯0åŸºç¡€çš„ï¼Œæ„Ÿè§‰æ²¡é—®ä¸ªå•¥"></a>å®¢æˆ·ç«¯0åŸºç¡€çš„ï¼Œæ„Ÿè§‰æ²¡é—®ä¸ªå•¥</h1><h2 id="ä¸€é¢-2020-8-12"><a href="#ä¸€é¢-2020-8-12" class="headerlink" title="ä¸€é¢/2020-8-12"></a><a href="https://www.nowcoder.com/discuss/473953">ä¸€é¢/2020-8-12</a></h2><ul><li>Javaç›¸å…³ï¼ŒJavaåƒåœ¾å›æ”¶ï¼ŒJavaä»ç¼–è¯‘åˆ°åŠ è½½ç»è¿‡çš„æ­¥éª¤ï¼ŒJavaåå°„çš„æœºåˆ¶</li><li>è®¡ç®—æœºç½‘ç»œï¼Œæ¯å±‚å„æœ‰ä»€ä¹ˆåè®®ï¼Œè®²ä¸€è®²http1.1ï¼Œhttp2.0ï¼Œhttp3.0å„æœ‰ä»€ä¹ˆæ”¹å˜ï¼Œtcpå¯é ä¼ è¾“ï¼Œhttpæ§åˆ¶ç¼“å­˜çš„å¤´éƒ¨å­—æ®µï¼Œæœ‰ä»€ä¹ˆå®‰å…¨å¨èƒã€‚</li><li>æ“ä½œç³»ç»Ÿï¼Œçº¿ç¨‹ä¸è¿›ç¨‹ï¼Œå•æ ¸å¤„ç†å™¨æ€ä¹ˆå®ç°å¤šçº¿ç¨‹ã€‚</li><li>æ•°æ®åº“ï¼Œæ€ä¹ˆå›æ»šï¼Œæ€ä¹ˆä¼˜åŒ–æŸ¥è¯¢ã€‚</li><li>å‘é‡å’Œé“¾è¡¨çš„ä½¿ç”¨åœºæ™¯</li><li>ç®—æ³•é¢˜ï¼šä»éè´Ÿæ— åºæ•°ç»„ä¸­æ‰¾åˆ°ç¼ºå¤±çš„æœ€å°éè´Ÿæ•´æ•°ã€‚</li><li>åé—®ï¼šéƒ¨é—¨åšä»€ä¹ˆä¸šåŠ¡çš„ã€‚</li></ul><h2 id="äºŒé¢-2020-8-20"><a href="#äºŒé¢-2020-8-20" class="headerlink" title="äºŒé¢/2020/8/20"></a><a href="https://www.nowcoder.com/discuss/483850">äºŒé¢/2020/8/20</a></h2><ul><li>é¡¹ç›®ç›¸å…³</li><li>tcpã€udpç›¸å…³ï¼Œæ»‘åŠ¨çª—å£</li><li>çº¿ç¨‹ã€è¿›ç¨‹ç›¸å…³ï¼Œå †æ ˆç›¸å…³</li><li>volatileï¼Œsynchronized</li><li>Objectä¸­çš„æ–¹æ³•ï¼Œequalå’Œhashcodeçš„å…³ç³»</li><li>ä¸Šçº¿åšé“é¢˜</li><li>æ¥é›¨æ°´é‚£é“ï¼Œæˆ‘å…ˆç”¨å•è°ƒæ ˆè§£å‡ºæ¥äº†ã€‚</li><li>æŠŠç©ºé—´ä¼˜åŒ–ï¼Œç„¶åæˆ‘å‹‰å‹‰å¼ºå¼ºç”¨åŒæŒ‡é’ˆè§£å‡ºæ¥äº†ã€‚</li><li>ä½ å¯¹ç§»åŠ¨å®¢æˆ·ç«¯äº†è§£æœ‰å¤šå°‘</li><li>ä»¥åèŒä¸šè§„åˆ’ï¼Œä¸ºä»€ä¹ˆæƒ³åšå®¢æˆ·ç«¯</li><li>ç§‹æ‹›æœ‰ä»€ä¹ˆè¿›å±•ã€‚</li></ul><h2 id="ä¸‰é¢-2020-9-2"><a href="#ä¸‰é¢-2020-9-2" class="headerlink" title="ä¸‰é¢/2020-9-2"></a><a href="https://www.nowcoder.com/discuss/495879">ä¸‰é¢/2020-9-2</a></h2><ul><li>å¯’æš„ä¸€ä¸‹ï¼Œbaseæ·±åœ³å¯ä»¥å—ï¼Œä¸ºä»€ä¹ˆä¸è€ƒç ”ï¼Œä»‹ç»ä¸‹ä½ çš„ä¸“ä¸šï¼Œæˆ‘çœ‹ä½ ä¸»è¦ç”¨Javaçš„ï¼Œä¼šc++å—ã€‚</li><li>æœ¬åœ°ideå†™ä»£ç ï¼Œå•é“¾è¡¨æ¯kä¸ªä¸€ç¿»è½¬ï¼Œå‰©ä½™ä¸è¶³kä¸ªï¼Œä¿æŒåŸä½ç½®ï¼Œè‡ªå·±å®šä¹‰æ•°æ®ç»“æ„ï¼Œè‡ªå·±å†™æµ‹è¯•ç”¨ä¾‹ã€‚</li><li>Javaä¸­è½¯å¼•ç”¨ï¼Œå¼±å¼•ç”¨è¯´ä¸€ä¸‹ã€‚åƒåœ¾å›æ”¶è¯´ä¸€ä¸‹ã€‚</li><li>staticä¿®é¥°çš„ä»£ç å—ä»€ä¹ˆæ—¶å€™æ‰§è¡Œ</li><li>ç±»åŠ è½½è¿‡ç¨‹</li><li>çº¿ç¨‹ä¸è¿›ç¨‹çš„åŒºåˆ«ï¼Œè¿›ç¨‹å†…å­˜ä¸­æœ‰å“ªäº›ä¸œè¥¿ï¼Œå †æ ˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œå“ªä¸ªæ•ˆç‡æ›´é«˜ã€‚å¤šçº¿ç¨‹ç¼–ç¨‹ï¼Œæ€ä¹ˆä¿è¯çº¿ç¨‹åŒæ­¥ã€‚</li><li>å†…æ ¸æ€å’Œç”¨æˆ·æ€äº†è§£å—ï¼Œå†…æ ¸æ€å¯ä»¥è®¿é—®å“ªäº›èµ„æºã€‚</li><li>ç½‘ç»œï¼šMTUäº†è§£å—ï¼Ÿpingæ˜¯ç”¨åˆ°ä»€ä¹ˆåè®®</li><li>æ•°æ®ç»“æ„ï¼šé€šè®¯å½•ç¨‹åºï¼Œæ‰“å¼€æ—¶ï¼Œå°†æ•°æ®åº“ä¸­çš„æ•°æ®è¯»åˆ°å†…å­˜ï¼Œä½ ç”¨ä»€ä¹ˆæ•°æ®ç»“æ„æ¥å­˜ï¼Œä¿è¯æŸ¥è¯¢ã€æ·»åŠ ã€åˆ é™¤ã€æ’åºæ¯”è¾ƒé«˜æ•ˆã€‚</li><li>é¢è¯•å®˜ï¼šæˆ‘è¿™é‡Œç»™ä½ è¿‡äº†ï¼Œç­‰hré¢å§ï¼Œå“¦å¯¹äº†ï¼Œä½ æ˜¯ä¸€ç‚¹éƒ½ä¸ä¼šc++å—ï¼ˆçœŸä¸ä¼šï¼‰</li></ul><p>æ€»ç»“ï¼šé—®äº†å¥½å¤šåº•å±‚ï¼Œæ„Ÿè§‰å®Œå…¨è„±ç¦»äº†JavaæŠ€æœ¯æ ˆï¼ˆæˆ‘å¥½èœï¼‰ã€‚é¢äº†å„ä¸ªå¤§å‚çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼Œæˆ‘å‘ç°ï¼Œå®¢æˆ·ç«¯æ¯”è¾ƒå–œæ¬¢é—®æ“ä½œç³»ç»Ÿçš„åº•å±‚åŒ…æ‹¬jvmç”šè‡³åˆ°æ±‡ç¼–å±‚é¢ï¼ŒæœåŠ¡ç«¯å–œæ¬¢é—®å„ç§æ¡†æ¶ä¸­é—´ä»¶æ•°æ®åº“linuxï¼Œå½“ç„¶ä¸ç®¡å“ªä¸ªä¸€èˆ¬éƒ½æ˜¯è¦æ¥é“ç®—æ³•é¢˜çš„ã€‚</p><h2 id="HR-2020-9-19"><a href="#HR-2020-9-19" class="headerlink" title="HR/2020-9-19"></a><a href="https://www.nowcoder.com/discuss/500049?source_id=profile_create&amp;channel=1009">HR/2020-9-19</a></h2><p>ç®€å•çš„èƒŒæ™¯è°ƒæŸ¥ï¼Œå…·ä½“é—®é¢˜çœ‹ä¸Šé¢é“¾æ¥</p><h1 id="18å¹´çš„ï¼Œæœ‰ç‚¹è€äº†ï¼Œä½†æ˜¯å¯ä»¥çœ‹ä¸‹"><a href="#18å¹´çš„ï¼Œæœ‰ç‚¹è€äº†ï¼Œä½†æ˜¯å¯ä»¥çœ‹ä¸‹" class="headerlink" title="18å¹´çš„ï¼Œæœ‰ç‚¹è€äº†ï¼Œä½†æ˜¯å¯ä»¥çœ‹ä¸‹"></a>18å¹´çš„ï¼Œæœ‰ç‚¹è€äº†ï¼Œä½†æ˜¯å¯ä»¥çœ‹ä¸‹</h1><h2 id="ä¸€é¢"><a href="#ä¸€é¢" class="headerlink" title="ä¸€é¢"></a><a href="https://www.nowcoder.com/discuss/91873">ä¸€é¢</a></h2><p>é—®Cçš„æœ‰ç‚¹å¤šï¼Œå› ä¸ºæ˜¯é¢è¯•å®˜æ˜¯iOSçš„</p><ul><li>è°ˆè°ˆä½ å­¦ä¹ è¿‡çš„æ¶æ„æ¨¡å¼ MVC MVP MVVM</li><li>ä¸€ä¸ªUnionç±»å‹ï¼Œå…±æœ‰ä¸€ä¸ªintç±»å‹ã€Floatã€Doubleç±»å‹çš„å­—æ®µï¼Œè¯·é—®åœ¨32ä½çš„CPUåˆ›å»ºæ—¶éœ€è¦å ç”¨å¤šå°‘å­—èŠ‚ï¼Ÿ</li><li>Unionå’ŒStructçš„åŒºåˆ«</li><li>è°ˆè°ˆä½ æ‰€äº†è§£çš„Cè¯­è¨€çš„å†…å­˜ç®¡ç†</li><li>è¯´è¯´ä½ äº†è§£çš„ç¨‹åºè®¾è®¡æ¨¡å¼ï¼ŒçŸ¥é“å¤šå°‘è¯´å¤šå°‘</li><li>è¯´è¯´TCPå’ŒUDPçš„åŒºåˆ«ï¼Œä½ è®¤ä¸ºQQçš„å®ç°æ˜¯ä½¿ç”¨TCPè¿˜æ˜¯UDPï¼Ÿ</li><li>è°ˆè°ˆä½ äº†è§£çš„Cè¯­è¨€çš„ç¼–è¯‘è¿‡ç¨‹</li><li>è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«</li><li>è°ˆè°ˆä½ å¯¹Viperæ¶æ„æ¨¡å¼çš„äº†è§£</li><li>Fiddlerçš„å·¥ä½œåŸç†è§£é‡Šä¸€ä¸‹</li><li>æ­»é”äº§ç”Ÿçš„åŸå› ä»¥åŠè§£å†³åŠæ³•</li><li>è¿›ç¨‹çš„è°ƒåº¦ç®—æ³•æœ‰å“ªäº›ï¼Œåˆ†åˆ«è§£é‡Šä¸€ä¸‹ï¼Ÿ</li><li>Androidç¨‹åºå…±äº«æ•°æ®çš„æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</li><li>Androidçš„æ€§èƒ½ä¼˜åŒ–</li><li>Handlerå’ŒHandlerThreadçš„åŒºåˆ«</li><li>å…«çš‡åé—®é¢˜äº†è§£è¿‡å—ï¼Ÿå…·ä½“æ€ä¹ˆå®ç°çš„ï¼Ÿ</li><li>è§£é‡Šä¸€ä¸‹å¼‚æ­¥ç¼–ç¨‹ï¼Œè¯´è¯´å®ƒçš„åº”ç”¨</li><li>Androidåº”ç”¨çš„å¯åŠ¨è¿‡ç¨‹</li></ul><h2 id="äºŒé¢"><a href="#äºŒé¢" class="headerlink" title="äºŒé¢"></a>äºŒé¢</h2><ul><li>å¤šçº¿ç¨‹äº†è§£å—ï¼Ÿ</li><li>å¤šçº¿ç¨‹å¦‚ä½•å®ç°é€šä¿¡ï¼Ÿ</li><li>å¤šçº¿ç¨‹å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨ï¼Ÿ</li><li>å¤šçº¿ç¨‹å¦‚ä½•å®ç°åŒæ­¥æœºåˆ¶ï¼Ÿ</li><li>è¿›ç¨‹é—´çš„é€šä¿¡æ–¹å¼ï¼Ÿ</li><li>è°ˆè°ˆä½ å¯¹æ¶æ„æ¨¡å¼å’Œè®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚</li><li>ç°åœ¨è®©ä½ è®¾è®¡ä¸€ä¸ªå­—å…¸ï¼Œè¯´ä¸€ä¸‹ä½ çš„è®¾è®¡æ€è·¯ã€‚</li></ul><h2 id="ä¸‰é¢"><a href="#ä¸‰é¢" class="headerlink" title="ä¸‰é¢"></a>ä¸‰é¢</h2><ul><li>è¯·ä½ ç”»å‡ºMVPæ¶æ„å›¾ï¼Œå¹¶è§£é‡Šä¸€éå®ƒçš„è¿ä½œæµç¨‹ã€‚æ¯”å¦‚ç½‘ç»œæ“ä½œ</li><li>è§£é‡Šä¸€ä¸‹é¡µé¢å±•ç¤ºæ•°æ®è·å–çš„æ•°æ®æ¥æºã€‚</li><li>å¤šçº¿ç¨‹ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜ï¼Œåº”è¯¥æ€ä¹ˆè§£å†³ï¼Ÿ</li><li>Androidè¿›ç¨‹çš„ä¼˜å…ˆçº§æ˜¯æ€æ ·çš„ï¼Ÿ</li><li>è¯´ä¸€ä¸‹Activityçš„ç”Ÿå‘½å‘¨æœŸ</li><li>onStarå’ŒonResumeæ–¹æ³•çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿä»€ä¹ˆæ—¶å€™ç”¨onStartï¼Œä»€ä¹ˆæ—¶å€™ç”¨onResume.</li><li>è¯´ä¸€ä¸‹å†’æ³¡æ’åºå’Œé€‰æ‹©æ’åºçš„åŒºåˆ«ï¼Ÿ</li><li>å†’æ³¡æ’åºæœ€ä¼˜çš„æ—¶é—´å¤æ‚åº¦ï¼Ÿ</li><li>ä¸€æ£µæ²¡æœ‰ç‰¹å®šé¡ºåºçš„äºŒå‰æ ‘ï¼Œå¦‚ä½•å­˜æ”¾åœ¨æ–‡ä»¶ä¸­ï¼Ÿ</li><li>æ‰‹å†™ä»£ç ï¼Œç»™ä¸€ä¸ªintçš„æ•°ç»„ï¼Œå°†å…¶ç§»åŠ¨kä½ï¼ˆä½¿ç”¨äº¤æ¢çš„æ€æƒ³ï¼‰ã€‚å¦‚array = [1,2,3,4,5], k = 2, åˆ™ç§»åŠ¨åçš„arrayä¸º[4,5,1,2,3]</li><li>è®¾è®¡QQä¼ æ–‡ä»¶åŠŸèƒ½ï¼Œå¹¶ç”»å‡ºæ¨¡å—è®¾è®¡å›¾ã€‚</li><li>è¯´ä¸€ä¸‹é˜²ç«å¢™ç©¿è¶Šçš„å®ç°åŸç†</li><li>åŠ å¯†ç®—æ³•å’ŒåŠ å¯†åŸç†</li><li>Httpså®ç°åŸç†</li><li>æ‰‹å†™ä»£ç ï¼Œæ— é™å¤§æ•´æ•°è½¬16è¿›åˆ¶</li><li>è®²è§£ä¸€ä¸‹ç™»é™†æ—¶å¯†ç åŠ å¯†è¿‡ç¨‹</li></ul><blockquote><p>PS:æ„Ÿè§‰éš¾åº¦å¥½é«˜ï¼Œéƒ½æ€€ç–‘æ˜¯ç¤¾æ‹›çš„</p></blockquote><hr><blockquote><p>æ‰¾ä¸åˆ°æ‰‹Qçš„äº†ï¼Œå†æ€»ç»“ä¸‹è…¾è®¯çš„ï¼Œå¯ä»¥ç»“åˆä¸‹ä¹‹å‰å‘çš„ç‰›å®¢ç½‘çš„æ€»ç»“ï¼Œä¸‹é¢éƒ½æ˜¯ç½‘ç»œä¸Šçš„ï¼Œä»¥CSDNä¸ºä¸»</p></blockquote><h1 id="Androidé¢ç»-é—®é¢˜å½’çº³"><a href="#Androidé¢ç»-é—®é¢˜å½’çº³" class="headerlink" title="Androidé¢ç»| é—®é¢˜å½’çº³"></a><a href="https://blog.csdn.net/qq_42895379/article/details/89343675">Androidé¢ç»| é—®é¢˜å½’çº³</a></h1><h1 id="2020æ˜¥æ‹›PCG"><a href="#2020æ˜¥æ‹›PCG" class="headerlink" title="2020æ˜¥æ‹›PCG"></a><a href="https://blog.csdn.net/qq_40987010/article/details/106844530">2020æ˜¥æ‹›PCG</a></h1><h2 id="ç®€å†é¢-åº”ç”¨å®"><a href="#ç®€å†é¢-åº”ç”¨å®" class="headerlink" title="ç®€å†é¢-åº”ç”¨å®"></a>ç®€å†é¢-åº”ç”¨å®</h2><ul><li>Stringï¼ŒStringBufferï¼ŒStringBuilderå“ªä¸ªæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŸStringä¸StringBufferå†…éƒ¨å®ç°ä¸Šæœ‰ä»€ä¹ˆä¸åŒï¼Ÿç”¨çš„æ—¶å€™æ€ä¹ˆé€‰æ‹©ï¼Ÿ</li><li>HashMapçš„å†…éƒ¨å®ç°èƒ½è¯´ä¸€ä¸‹å—ï¼Ÿ</li><li>å•ä¾‹æ¨¡å¼äº†è§£å—ï¼Ÿçº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼è¯´ä¸€ä¸‹</li><li>JVMè™šæ‹Ÿæœºçš„å†…å­˜åˆ†åŒºæœ‰å“ªäº›ï¼Ÿå †å’Œæ ˆçš„åŒºåˆ«ï¼Ÿ</li><li>TCP/UDPçš„åŒºåˆ«ï¼Ÿ</li><li>TCPä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹è¯´ä¸€ä¸‹</li><li>HTTPç½‘ç»œè¯·æ±‚ç»è¿‡äº”å±‚çš„è§£æï¼Œæ¯ä¸€å±‚åˆ†åˆ«æ˜¯æ€ä¹ˆè§£æçš„ï¼Ÿ</li><li>Androidæ–¹é¢ï¼Œå¦‚ä½•è·¨è¿›ç¨‹é€šä¿¡ï¼Ÿè·¨è¿›ç¨‹é€šä¿¡çš„æ–¹å¼æœ‰å“ªäº›ï¼ŸBinderåº•å±‚åŸç†è¯´ä¸€ä¸‹</li><li>è·¨çº¿ç¨‹æ€ä¹ˆé€šä¿¡ï¼Ÿ</li><li>é‚£æ¶ˆæ¯é˜Ÿåˆ—äº†è§£è¿‡å—ï¼Œè°ˆè°ˆå…¶å†…éƒ¨å®ç°åŸç†ï¼ŸHandlerçš„åˆ›å»ºå’ŒMessageQueue/Looperæœ‰ä»€ä¹ˆè”ç³»ï¼Ÿ</li><li>å†…å­˜æ³„éœ²çš„åŸå› è¯´ä¸€ä¸‹ï¼Œæ€ä¹ˆæ£€æµ‹å†…å­˜æ³„æ¼ï¼Ÿæœ‰æ²¡æœ‰ä½¿ç”¨ä¸€äº›å·¥å…·æ£€æµ‹å†…å­˜æ³„æ¼çš„ç»éªŒï¼Ÿ</li><li>çŸ¥é“è®¾è®¡æ¨¡å¼å—ï¼Ÿè¯´ä¸€äº›ä½ ç”¨è¿‡çš„è®¾è®¡æ¨¡å¼</li><li>Viewçš„ç»˜åˆ¶è¿‡ç¨‹ä½ äº†è§£è¿‡å—ï¼Ÿè¯´ä¸€ä¸‹</li><li>å½“ç”¨æˆ·æ‰‹æŒ‡ç‚¹å‡»å±å¹•çš„æ—¶å€™ï¼Œä¼šäº§ç”Ÿä»€ä¹ˆäº‹ä»¶ï¼Ÿï¼ŒonClick()æ–¹æ³•åœ¨ä»€ä¹ˆäº‹ä»¶è§¦å‘ï¼Œåœ¨å“ªä¸ªåœ°æ–¹è°ƒç”¨</li></ul><h2 id="ä¸€é¢-åº”ç”¨å®"><a href="#ä¸€é¢-åº”ç”¨å®" class="headerlink" title="ä¸€é¢-åº”ç”¨å®"></a>ä¸€é¢-åº”ç”¨å®</h2><ul><li>HashMapäº†è§£å—ï¼Ÿè¯´è¯´å†…éƒ¨å®ç°åŸç†</li><li>javaå››ç±»çš„çº¿ç¨‹æ± æ˜¯å“ªå››ç±»ï¼Ÿåˆ†åˆ«ä»‹ç»ä¸‹</li><li>javaå››é’Ÿå¼•ç”¨ç±»å‹</li><li>å•ä¾‹æ¨¡å¼ä»‹ç»ä¸‹</li><li>GCæœºåˆ¶åƒåœ¾å›æ”¶ç®—æ³•æœ‰å“ªäº›ï¼Ÿ</li><li>è¯´ä¸€ä¸‹åˆ†ä»£æ”¶é›†ç®—æ³•çš„è¯¦ç»†è¿‡ç¨‹</li><li>TCPä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹</li><li>Androidè·¨è¿›ç¨‹é€šä¿¡æ–¹å¼æœ‰å“ªäº›</li><li>Androidè·¨çº¿ç¨‹æ–¹å¼æœ‰å“ªäº›</li><li>æ¶ˆæ¯é˜Ÿåˆ—å®ç°åŸç†ä»‹ç»ä¸‹</li><li>å†…å­˜æ³„æ¼çš„åŸå› è¯´ä¸€ä¸‹ï¼Œç”¨è¿‡ä»€ä¹ˆå·¥å…·æ£€æµ‹å†…å­˜æ³„æ¼ï¼Ÿçº¿ä¸Šçš„å·¥å…·ç”¨è¿‡å—</li><li>Viewç»˜åˆ¶çš„åŸç†äº†è§£å—ï¼Ÿä»‹ç»ä¸‹</li><li>äº†è§£è¿‡è®¾è®¡æ¨¡å¼å—ï¼Ÿè¯´è¯´ä½ å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼æœ‰å“ªäº›</li><li>ListViewå’ŒRecyclerViewçš„åŒºåˆ«äº†è§£å—ï¼Ÿè¯´è¯´RecyclerViewçš„ç¼“å­˜æœºåˆ¶</li><li>Viewäº‹ä»¶çš„åˆ†å‘æœºåˆ¶çŸ¥é“å—ï¼Ÿ</li><li>ç»„ä»¶åŒ–å’Œçƒ­ä¿®å¤ï¼Œä½ äº†è§£è¿‡è¿™äº›æŠ€æœ¯å—</li><li>Flutterä½ ç ”ç©¶è¿‡å—</li><li>æœ‰ä»€ä¹ˆé—®é¢˜æƒ³é—®æˆ‘çš„ï¼Ÿ</li></ul><h2 id="äºŒé¢-åº”ç”¨å®"><a href="#äºŒé¢-åº”ç”¨å®" class="headerlink" title="äºŒé¢-åº”ç”¨å®"></a>äºŒé¢-åº”ç”¨å®</h2><ul><li>ä¸Šæ¥å…ˆå’Œæˆ‘èŠåæ¥åˆ†é’Ÿçš„é¡¹ç›®ç»å†ï¼Œé¡¹ç›®çš„é—®é¢˜å°±å› äººè€Œå¼‚äº†ï¼Œæ²¡æœ‰å‚è€ƒä»·å€¼ï¼Œå°±ä¸æ”¾å‡ºæ¥äº†</li><li>Mysqlè”åˆä¸»é”®åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¤±æ•ˆï¼Œè¾¾ä¸åˆ°å¿«é€Ÿç´¢å¼•çš„æ•ˆæœï¼Ÿ</li><li>Linuxäº†è§£å—ï¼Ÿ<br>åªä¼šä½¿ç”¨å‘½ä»¤ï¼Œæ²¡æ·±å…¥äº†è§£è¿‡ï¼ˆï¼Ÿï¼Ÿï¼Ÿæ‡µé€¼çŠ¶æ€2ï¼‰</li><li>è€ƒè™‘10äº¿æ¡æ•°æ®ï¼Œé‡Œé¢å­˜å‚¨çš„éƒ½æ˜¯æ•°å­—ï¼Œè¦ä½ è®¾è®¡ä¸€ä¸ªæ€è·¯ï¼Œæ‰¾å‡ºé‡Œé¢ç›¸åŒçš„æ•°</li><li>ä»€ä¹ˆæ—¶å€™èƒ½æ¥å®ä¹ ï¼Œèƒ½å®ä¹ å¤šä¹…ï¼Ÿ</li><li>ä½ æœ‰ä»€ä¹ˆæƒ³é—®æˆ‘çš„</li></ul><h2 id="GM-åº”ç”¨å®"><a href="#GM-åº”ç”¨å®" class="headerlink" title="GM-åº”ç”¨å®"></a>GM-åº”ç”¨å®</h2><ul><li>ä½ æåˆ°ä½ ä¹‹å‰è´Ÿè´£è¿‡4ä¸ªæœˆçš„åç«¯å¼€å‘ï¼Œæ˜¯ä»€ä¹ˆè®©ä½ è½¬åˆ°äº†ç°åœ¨çš„å®¢æˆ·ç«¯å¼€å‘ï¼Ÿ</li><li>ä½ ä»ç°åœ¨åˆ°ä»¥åçš„èŒä¸šå‘å±•è§„åˆ’ï¼Ÿ</li><li>Androidä½ ä¸»è¦æ˜¯å¯¹åº”ç”¨å±‚åƒViewåŠ¨ç”»è¿™æ–¹é¢äº†è§£å¤šä¸€ç‚¹ï¼Œè¿˜æ˜¯å¯¹Androidåº•å±‚è¿™æ–¹é¢äº†è§£å¤šç‚¹ï¼Ÿ</li><li>ä½ åº•å±‚ä»£ç çœ‹è¿‡äº›ä»€ä¹ˆï¼Ÿ<ul><li>æŠŠæˆ‘æœ€è¿‘çœ‹è¿‡äº†åº•å±‚çŸ¥è¯†éƒ½åˆ—ä¸¾äº†ä¸€éï¼ŒViewäº‹ä»¶åˆ†å‘æœºåˆ¶ï¼ŒViewé‡ç»˜æœºåˆ¶ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼ŒBinderå·¥ä½œåŸç†ï¼ŒAndroidå››å¤§ç»„ä»¶çš„å·¥ä½œè¿‡ç¨‹ä»€ä¹ˆçš„ã€‚</li></ul></li><li>é‚£ä½ è¯´è¯´æ¶ˆæ¯é˜Ÿåˆ—æ€ä¹ˆå®ç°çš„å§</li></ul><h1 id="2020æ˜¥æ‹›IEG"><a href="#2020æ˜¥æ‹›IEG" class="headerlink" title="2020æ˜¥æ‹›IEG"></a><a href="https://blog.csdn.net/qq_40987010/article/details/106861169">2020æ˜¥æ‹›IEG</a></h1><h2 id="ä¸€é¢-1"><a href="#ä¸€é¢-1" class="headerlink" title="ä¸€é¢-"></a>ä¸€é¢-</h2><ul><li>å­¦æ ¡æœ‰å“ªäº›ä¸“ä¸šè¯¾ï¼Œè¯´ä¸€ä¸‹ï¼Ÿå­¦è¿‡å“ªäº›è¯­è¨€ï¼Ÿ</li><li>äº†è§£æ•°æ®ç»“æ„å—ï¼Ÿè¯´è¯´æœ‰å“ªäº›æ•°æ®ç»“æ„ï¼Ÿ</li><li>HashMapå†…éƒ¨å®ç°æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿæ‰©å®¹æœºåˆ¶æ˜¯å’‹æ ·çš„ï¼ŸArrayListçš„æ‰©å®¹æœºåˆ¶å‘¢ï¼Ÿ</li><li>æ•°ç»„å’Œåˆ—è¡¨çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼ŸArrayListå’ŒLinkedListçš„åŒºåˆ«ï¼Ÿ</li><li>åŒå‘é“¾è¡¨æ€ä¹ˆåˆ¤æ–­å½¢æˆäº†ç¯è·¯ï¼Ÿå¦‚æœç”¨ä»£ç å®ç°æ€ä¹ˆåˆ¤æ–­ï¼Ÿ</li><li>é—®ä¸ªç®—æ³•é¢˜ï¼Œå¦‚ä½•åˆå¹¶ä¸¤ä¸ªæœ‰åºçš„æ•°ç»„ï¼Œç„¶åè¾“å‡ºæ–°çš„æ•°ç»„ï¼Œæ€è·¯è¯´ä¸€ä¸‹ï¼Œç”¨æœ¬åœ°IDEæ•²ä¸€ä¸‹å§</li><li>é—®ä¸‹è®¡ç®—æœºç½‘ç»œåŸºç¡€å§ï¼ŒTCP/UDPçš„åŒºåˆ«æ˜¯å•¥ï¼ŸUDPçš„åº”ç”¨åœºæ™¯ï¼Ÿ</li><li>OSIäº”å±‚åè®®åˆ†åˆ«æ˜¯å“ªäº›ï¼ŸTCPæ˜¯ç¬¬å‡ å±‚åè®®ï¼ŒHTTPå‘¢ï¼ŸHTTPåè®®ä¸TCPåè®®çš„å…³ç³»</li><li>get/postè¯·æ±‚çš„åŒºåˆ«ï¼Ÿ</li><li>å“åº”çŠ¶æ€ç ï¼š1-5å¼€å¤´çš„çŠ¶æ€ç åˆ†åˆ«è¡¨ç¤ºä»€ä¹ˆæ„æ€ï¼Ÿ206çŠ¶æ€ç çŸ¥é“ä»€ä¹ˆæ„æ€å—ï¼Ÿ404çŸ¥é“å—ï¼Ÿ</li><li>ä½ æ˜¯ç”¨JAVAå¤šç‚¹å§ï¼Ÿé—®äº›JAVAåŸºç¡€ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶çŸ¥é“å¤šå°‘ï¼Ÿä»‹ç»ä¸€é</li><li>æ³›å‹ç”¨è¿‡å—ï¼Ÿä½ æ˜¯æ€ä¹ˆç”¨æ³›å‹çš„ï¼Ÿ</li><li>é—®äº›å®‰å“æ–¹é¢çš„é—®é¢˜å§ï¼Œå®‰å“å››å¤§ç»„ä»¶åˆ†åˆ«æ˜¯å“ªäº›ï¼Ÿ</li><li>Activityçš„ç”Ÿå‘½å‘¨æœŸè¯´ä¸€éï¼Ÿå½“ç”¨æˆ·æŒ‰ä¸‹homeé”®æ—¶ï¼ŒActivityä¼šç»è¿‡å“ªäº›ç”Ÿå‘½å‘¨æœŸï¼Ÿå¦‚æœæ˜¯ä»ä¸€ä¸ªActivityåˆ‡æ¢åˆ°å¦ä¸€ä¸ªActivityå‘¢</li><li>æ¶ˆæ¯é˜Ÿåˆ—çŸ¥é“å—ï¼Ÿä»‹ç»ä¸‹å†…éƒ¨åŸç†</li><li>WebViewçŸ¥é“å—ï¼Ÿ</li></ul><h2 id="äºŒé¢-1"><a href="#äºŒé¢-1" class="headerlink" title="äºŒé¢"></a>äºŒé¢</h2><ul><li>å…ˆåšä¸ªç®€çŸ­çš„è‡ªæˆ‘ä»‹ç»å§</li><li>ä½ ç®€å†ä¸Šæåˆ°äº†2ä¸ªé¡¹ç›®ï¼Œä½ èƒ½å…ˆå’Œæˆ‘è¯¦ç»†ä»‹ç»ä¸‹ä½ çš„ç¬¬äºŒä¸ªé¡¹ç›®å—ï¼Ÿï¼ˆæ¥ä¸‹æ¥å°±æ˜¯é¡¹ç›®é—®é¢˜äº†ï¼Œä¸»è¦é—®é¡¹ç›®ä¸»è¦æ˜¯å®ç°äº†ä»€ä¹ˆåŠŸèƒ½ï¼Œæ€ä¹ˆå®ç°çš„ï¼Ÿé¡¹ç›®æ¶æ„æ˜¯å’‹æ ·çš„ï¼Œé¡¹ç›®å¤§æ¦‚é—®äº†15åˆ†é’Ÿå§ï¼‰</li><li>ä½ é¡¹ç›®ç”¨åˆ°äº†FFMPEGæ¥å®æ—¶æ¨æµï¼Œé‚£FFMPEGå†…éƒ¨çš„å®ç°åŸç†é‚£äº›ä½ å»äº†è§£è¿‡å—ï¼Ÿï¼ˆè¿™é‡Œæˆ‘å›ç­”è¯´æˆ‘åœ¨å†™è¿™ä¸ªé¡¹ç›®çš„æ—¶å€™çœ‹è¿‡ï¼Œåªæ˜¯æ—¶é—´å¤ªä¹…è¿œäº†ï¼Œå¾ˆä¹…æ²¡çœ‹è¿‡è¿™éƒ¨åˆ†ï¼Œæ‰€ä»¥ç°åœ¨ä¹Ÿå¿˜å¾—å·®ä¸å¤šäº†ï¼‰</li><li>ä½ é¡¹ç›®ç”¨WebSocketæ¥å…¨åŒå·¥é€šè®¯ï¼Œé‚£WebSocketèƒ½ç»™æˆ‘ä»‹ç»ä¸‹å—ï¼ŒWebsocketå’ŒHttpçš„è”ç³»ï¼Ÿå®ƒæ˜¯åŸºäºTCPåè®®è¿˜æ˜¯UDPåè®®ï¼Ÿå®ƒæ˜¯é•¿è¿æ¥çš„è¯ï¼ŒæœåŠ¡å™¨å¦‚ä½•ä¿æ´»ï¼Ÿ</li><li>äº†è§£linuxå—ï¼ŒçŸ¥é“linuxâ€¦ï¼ˆlinuxæˆ‘ä¸ç†Ÿï¼ŒåªçŸ¥é“å‘½ä»¤ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†è·³äº†ï¼‰</li><li>MysqlçŸ¥é“å—ï¼Ÿç´¢å¼•æ˜¯ç”¨æ¥å¹²å•¥çš„ï¼ŸMysqlæ˜¯æ€ä¹ˆé€šè¿‡ç´¢å¼•å¿«é€ŸæŸ¥æ‰¾å…ƒç´ çš„ï¼Ÿ</li><li>ä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘æ“ä½œç³»ç»Ÿçš„åˆ†é¡µæœºåˆ¶ï¼Ÿ</li><li>è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼Ÿå®ˆæŠ¤çº¿ç¨‹æ˜¯ä»€ä¹ˆçº¿ç¨‹ï¼Ÿ</li><li>å¿«æ’çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿå®ƒæ˜¯ç¨³å®šæ’åºå—ï¼Ÿä¸ºä»€ä¹ˆä¸ç¨³å®šï¼Ÿ</li><li>è¯´è¯´ä½ ç”¨è¿‡çš„é›†åˆï¼Œéƒ½æœ‰å“ªäº›é›†åˆï¼ŸTreeMapçœ‹è¿‡å—ï¼Ÿå’ŒHashMapçš„åŒºåˆ«ï¼Ÿ</li><li>JVMå†…å­˜åˆ†åŒºä¸­ï¼Œå †å’Œæ ˆçš„åŒºåˆ«ï¼Ÿ</li><li>æœ‰è¿‡å¹¶å‘çš„ç»éªŒå—ï¼Ÿçº¿ç¨‹æ± çš„å·¥ä½œæµç¨‹è¯´ä¸€ä¸‹</li></ul><h1 id="è…¾è®¯æ–‡æ¡£2020"><a href="#è…¾è®¯æ–‡æ¡£2020" class="headerlink" title="è…¾è®¯æ–‡æ¡£2020"></a><a href="https://www.nowcoder.com/discuss/475087">è…¾è®¯æ–‡æ¡£2020</a></h1><h2 id="ä¸€é¢-2"><a href="#ä¸€é¢-2" class="headerlink" title="ä¸€é¢"></a>ä¸€é¢</h2><ul><li>ç®—æ³•é¢˜ï¼šå‡æœŸã€ç¿»è½¬æ•°åˆ—ï¼Œè¿˜æœ‰ä¸€ä¸ªåå­—å¿˜äº†ï¼Œä½†å…¶å®å°±æ˜¯å†™ä¸ªå¿«æ’</li><li>å¿«é€Ÿæ’åºçš„ä¼˜åŒ–æ–¹æ³•(æç¤ºåŸºå‡†å€¼)</li><li>Javaåº•å±‚äº†è§£ä»€ä¹ˆï¼Ÿ</li><li>Javaç¨‹åºæ‰§è¡Œçš„æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>JVMå†…å­˜ç»“æ„</li><li>å¤šçº¿ç¨‹éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ(ç»†è®²äº†javaä¸­çš„é”æœºåˆ¶)</li><li>è¯¦ç»†è®²ä¸€ä¸‹é¡¹ç›®</li><li>é¡¹ç›®ä¸­æ‹…ä»»çš„è§’è‰²</li><li>å„ç§å®ç°çš„ç»†èŠ‚</li><li>å¤šçº¿ç¨‹ä¿®æ”¹UIæ€ä¹ˆå¤„ç†</li><li>æ¯ä¸ªé¡¹ç›®éƒ½å¯ä»¥è®²ä¸€è®²â€¦</li><li>Javaä¸­å„ç§æ•°æ®ç»“æ„çš„å®ç°(ç»†è®²äº†HashMapåŸç†)</li><li>å„å±‚ç†Ÿæ‚‰çš„åè®®è®²ä¸€è®²(HTTP, DNS, TCP, UDP, ICMP, ARPâ€¦)</li><li>è¿˜æœ‰ä»€ä¹ˆä½ äº†è§£çš„æˆ‘ä»¬æ²¡é—®çš„ï¼Ÿ(æ“ä½œç³»ç»Ÿï¼šä¸­æ–­, è¿›ç¨‹è°ƒåº¦, åˆ†é¡µåˆ†æ®µ, è™šæ‹Ÿå†…å­˜â€¦)</li></ul><h2 id="äºŒé¢-2"><a href="#äºŒé¢-2" class="headerlink" title="äºŒé¢"></a>äºŒé¢</h2><ul><li>è®²äº†ä¸¤ä¸ªé¡¹ç›®ï¼Œé—®äº†å¤šçº¿ç¨‹çš„ç»†èŠ‚</li><li>Synchronizeå’Œvolatile</li><li>sleepå’Œwaitçš„åŒºåˆ«</li><li>ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼Œjavaä¸­çš„ä¸‰ç§å®ç°</li><li>JVMå†…å­˜ç»“æ„</li><li>OOMå‘ç”Ÿçš„ä½ç½®ï¼ŒåŸå› </li><li>çŸ¥é“å“ªäº›è®¾è®¡æ¨¡å¼ï¼Œé¡¹ç›®é‡Œç”¨è¿‡å—</li><li>ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹</li><li>TCPå’ŒUDPçš„åŒºåˆ«</li><li>HTTPSæµç¨‹</li><li>HTTPSæ˜¯ç»å¯¹å®‰å…¨çš„å—</li><li>Hashmapçš„å®ç°</li><li>æœ‰ä¸€ä¸ªç”Ÿæˆ[1, 5]éšæœºæ•´æ•°çš„å‡½æ•°ï¼Œåˆ©ç”¨å®ƒè®¾è®¡ä¸€ä¸ªç”Ÿæˆ[1, 7]éšæœºæ•°çš„å‡½æ•°ã€‚</li></ul><h2 id="CTO-åº”è¯¥æ˜¯æŒ‡GMå§"><a href="#CTO-åº”è¯¥æ˜¯æŒ‡GMå§" class="headerlink" title="CTO(åº”è¯¥æ˜¯æŒ‡GMå§)"></a>CTO(åº”è¯¥æ˜¯æŒ‡GMå§)</h2><ul><li>å…ˆè‡ªæˆ‘ä»‹ç»ï¼Œå¤§æ¦‚äº†è§£äº†ä¸€ä¸‹ä¹‹åï¼Œå…ˆèŠäº†é¡¹ç›®ï¼Œç„¶åé—®äº†ä¸€äº›åŸºç¡€é—®é¢˜ã€‚åŸºç¡€é—®é¢˜å¤§æ¦‚æœ‰è¿™å‡ ä¸ªå†…å®¹ï¼š</li><li>javaåƒåœ¾å›æ”¶</li><li>TCPæ¡æ‰‹æŒ¥æ‰‹</li><li>HTTPæŠ¥æ–‡æ ¼å¼</li><li>æ·±åº¦ä¼˜å…ˆã€å¹¿åº¦ä¼˜å…ˆ</li></ul><h1 id="è…¾è®¯PCGäº‹ä¸šç¾¤-æ˜¥æ‹›3æœˆ-ä½†æ˜¯åŸæœ¬æ˜¯åšJavaçš„"><a href="#è…¾è®¯PCGäº‹ä¸šç¾¤-æ˜¥æ‹›3æœˆ-ä½†æ˜¯åŸæœ¬æ˜¯åšJavaçš„" class="headerlink" title="è…¾è®¯PCGäº‹ä¸šç¾¤-æ˜¥æ‹›3æœˆ,ä½†æ˜¯åŸæœ¬æ˜¯åšJavaçš„"></a><a href="https://blog.csdn.net/weixin_40992982/article/details/105141252">è…¾è®¯PCGäº‹ä¸šç¾¤-æ˜¥æ‹›3æœˆ,ä½†æ˜¯åŸæœ¬æ˜¯åšJavaçš„</a></h1><h2 id="ä¸€é¢-3"><a href="#ä¸€é¢-3" class="headerlink" title="ä¸€é¢"></a>ä¸€é¢</h2><ul><li>è‡ªæˆ‘ä»‹ç»</li><li>æˆ‘çœ‹ä½ è¿™ç®€å†ä¸Šçš„æŠ€èƒ½å’‹éƒ½å†™çš„æ˜¯Javaçš„ä¸œè¥¿å‘¢ï¼Ÿå®‰å“çš„é¡¹ç›®åšè¿‡ï¼ŒSSMçš„ä¹Ÿåšè¿‡ï¼Œé‚£ä½ åå°å¼€å‘å’ŒAndroidå€¾å‘äºå“ªä¸€ä¸ªï¼Ÿ<ul><li>ä¸»è¦å‡†å¤‡çš„Javaï¼ŒAndroidæ²¡æœ‰å…·ä½“å­¦ä¹ è¿‡ï¼Œä½†æ˜¯å¯¹Androidå¾ˆæ„Ÿå…´è¶£ã€‚</li></ul></li><li>ä½ å’‹é€‰çš„å®ä¹ åœ°æ–¹åŒ—äº¬ï¼Œèƒ½æ¥æ·±åœ³å®ä¹ å˜›ï¼Ÿ</li><li>è¯´è¯´é¡¹ç›®ï¼Œæˆ‘çœ‹ä½ ä¸Šé¢æœ‰ä¸ªé¡¹ç›®åšAppçš„ï¼Œæœ‰å‡†å¤‡Androidæ–¹é¢å—?</li><li>æœ‰äº›SQLæ¯”è¾ƒæ…¢ï¼Œä½ å’‹åŠï¼Ÿä¸ºä»€ä¹ˆæœ‰çš„SQLè¿™ä¹ˆæ…¢ï¼Œè¯´è¯´ä½ è§‰å¾—å¯¼è‡´SQLå¾ˆæ…¢çš„åŸå› ã€‚</li><li>å†…å­˜æ³„æ¼ï¼ŸOOMï¼Ÿä»€ä¹ˆæƒ…å†µä¼šOOMï¼Ÿ</li><li>ç”¨è¿‡å¤šçº¿ç¨‹æ²¡ï¼Ÿè¯´è¯´å’‹ç”¨çš„ã€‚çº¿ç¨‹æ± çŸ¥é“ä¸ï¼Ÿè¯´è¯´çº¿ç¨‹æ± çš„åŸç†ï¼Ÿ</li><li>å¯¹ArrayListä¸€ä¸ªè¯»æ“ä½œï¼Œä¸€ä¸ªå†™æ“ä½œï¼Œä½ ç”¨å¤šçº¿ç¨‹å’‹å®ç°ã€‚æ­»é”ä½ çŸ¥é“ä¸ï¼Ÿä½ æ€ä¹ˆè§£å†³ï¼Ÿ</li><li>volatileçŸ¥é“å—ï¼Ÿvolatileçš„åŸå­æ€§ï¼Ÿ</li><li>Javaä¸­çš„é”çŸ¥é“å“ªäº›ï¼Ÿ</li><li>çº¿ç¨‹ä¹‹é—´é€šä¿¡çš„æ–¹å¼ï¼Ÿ</li><li>JVMè°ƒä¼˜ï¼Œè¯´è¯´ä½ èƒ½ä»å“ªäº›æ–¹é¢ç€æ‰‹ï¼Ÿ</li><li>JVMå’ŒGCç®€å•èŠèŠï¼Œç»“åˆJVMå†…å­˜è¯´è¯´GCã€‚</li><li>HashMapå’ŒHastTableï¼ŒHashMapå®‰å…¨ï¼Ÿä¸å®‰å…¨ç”¨ä»€ä¹ˆï¼Ÿhash()ï¼ŸHashTableæ˜¯æ€ä¹ˆå®ç°å®‰å…¨çš„ï¼Ÿ</li><li>æˆ‘å¯¹ä½ çš„JavaåŸºç¡€æœ‰äº†ä¸€ä¸ªäº†è§£äº†ï¼Œä¸‹é¢æˆ‘ä»¬é—®é—®ç½‘ç»œç›¸å…³çš„çŸ¥è¯†ï¼Œè®¡ç®—æœºç½‘ç»œåº”è¯¥å­¦è¿‡å§ï¼Œé‚£è¯´è¯´TCPä¸‰æ¬¡æ¡æ‰‹ï¼Ÿç¬¬ä¸‰æ¬¡æ¡æ‰‹èƒ½ä¸èƒ½å»æ‰ï¼ŸUDPå’ŒTCPçš„åŒºåˆ«ï¼Ÿ</li><li>ä½ çŸ¥é“é•¿è¿æ¥å—ï¼Œè¯´è¯´ï¼Ÿä¸ºå•¥ç”¨é•¿è¿æ¥ï¼Ÿ</li><li>HTTP1.0å’ŒHTTP2.0çš„åŒºåˆ«ï¼Ÿè¯´è¯´NIOï¼Ÿ</li><li>HTTPSçŸ¥é“å—ï¼Ÿè¯´è¯´SSLï¼Ÿ</li><li>å¥½äº†ï¼Œç½‘ç»œèŠåˆ°è¿™é‡Œå§ï¼Œæˆ‘ä»¬è¯´è¯´ç®—æ³•ä¹‹ç±»çš„å§ã€‚è·³å°é˜¶çŸ¥é“å§ï¼Œæ€ä¹ˆåšå•Šã€‚<ul><li>ä¸€ä¸ªé“¾è¡¨ï¼Œè®©ä½ æ‰¾æœ€ä¸­é—´çš„èŠ‚ç‚¹ï¼Œä½ æ€ä¹ˆæ‰¾ï¼Ÿ</li><li>ä¸¤ä¸ªå¤§æ–‡ä»¶ï¼Œä¸€ä¸ªæ¯”è¾ƒå¤§ï¼Œä¸€ä¸ªæ¯”è¾ƒå°ï¼Œè®©ä½ æ±‚äº¤é›†ï¼Œä½ æ€ä¹ˆåšï¼Ÿ</li></ul></li><li>é‚£ä¹ˆï¼Œæˆ‘ä»¬å†é—®ä¸¤ä¸ªæ™ºåŠ›é¢˜å§ï¼Œæ²¡æœ‰å›ºå®šç­”æ¡ˆï¼Œä¸è¦é™åˆ¶è‡ªå·±çš„æ€è·¯ï¼Œæƒ³åˆ°å•¥è¯´å•¥ï¼Œä¸€ä¸ªç²—ç»†ä¸ä¸€æ ·çš„ç»³å­ï¼Œå®Œæ•´çš„çƒ§å®Œ1ä¸ªå°æ—¶ï¼Œä½ æ€ä¹ˆè®©ä»–çƒ§15åˆ†é’Ÿï¼ˆä¸ä¸€å®šçƒ§å®Œï¼‰ã€‚</li><li>ä¸€å‰¯å…¨æ–°çš„æ‰‘å…‹ç‰Œï¼ŒæŒ‰é¡ºåºçš„ï¼ŒAAAAï¼Œ2222ï¼Œ3333ï¼Œè¿™ç§ï¼Œä½ æ€ä¹ˆæ´—ç‰Œèƒ½æ´—æ•£å¼€ï¼Ÿ</li><li>C++å’ŒCäº†è§£å—ï¼Ÿ</li></ul><h2 id="äºŒé¢-3"><a href="#äºŒé¢-3" class="headerlink" title="äºŒé¢"></a>äºŒé¢</h2><p>ç®—æ³•é¢˜</p><h2 id="ä¸‰é¢-1"><a href="#ä¸‰é¢-1" class="headerlink" title="ä¸‰é¢"></a>ä¸‰é¢</h2><ul><li>é¢è¯•å®˜ä¸Šæ¥åˆæ˜¯ä¸€é€šç¡®è®¤èº«ä»½ï¼Œç„¶åå†æ¬¡ç¡®è®¤å®ä¹ åœ°æœ‰æ²¡æœ‰è¦æ±‚ï¼Ÿæ·±åœ³ç¡®å®æ²¡å•¥é—®é¢˜æ˜¯å§ï¼Ÿï¼Ÿï¼Ÿ</li><li>è¯´è¯´JVMçš„å†…å­˜å§ï¼Œä»–ä»¬éƒ½æ˜¯å¹²å•¥çš„ï¼Ÿå¯¹è±¡æ€ä¹ˆåˆ›å»ºï¼Ÿ</li><li>æ¯ä¸ªåŒºåŸŸéƒ½ä¼šå‘ç”Ÿæ€æ ·çš„å¼‚å¸¸å•Šï¼Œè°ä¼šå‘ç”ŸOOMï¼Ÿ</li><li>è¯´è¯´ä½ å¯¹GCçš„è®¤è¯†å§ã€‚</li><li>çŸ¥é“å¼•ç”¨è®¡æ•°æ³•å—ï¼Ÿå¼•ç”¨è®¡æ•°æ³•æœ‰å•¥ä¼˜ç‚¹å—ï¼Ÿç¼ºç‚¹å‘¢ï¼Ÿ</li><li>å¯è¾¾æ€§åˆ†æï¼Ÿ</li><li>åƒåœ¾å›æ”¶çš„å‡ ç§ç®—æ³•ï¼Ÿæ¯”è¾ƒä¸€ä¸‹ã€‚</li><li>ä½ è§‰å¾—åƒåœ¾å›æ”¶æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ</li><li>è¯´è¯´åƒåœ¾æ”¶é›†å™¨ï¼Ÿæœ‰æ²¡æœ‰æƒ³è¿‡ä½ è¯´çš„è¿™äº›åƒåœ¾æ”¶é›†å™¨ä¸ºå•¥ä¼šæœ‰è¿™äº›ç¼ºç‚¹å‘¢ï¼Ÿ</li><li>å…³äºåƒåœ¾å›æ”¶å’ŒJVMé—®çš„å¾ˆè¯¦ç»†å¾ˆè¯¦ç»†ï¼Œæœ‰çš„é—®é¢˜è®°ä¸å¤ªæ¸…äº†â€¦</li><li>é‚£æˆ‘ä»¬å†è¯´è¯´é“¾è¡¨å’Œæ•°ç»„ï¼Ÿæ¯”è¾ƒä¸€ä¸‹å®ƒä»¬æœ‰å•¥åŒºåˆ«å§ï¼Œç„¶åå†è¯´è¯´æ•°ç»„é‡Œé¢åˆ é™¤ä¸€ä¸ªå…ƒç´ ä¼šæ€ä¹ˆæ ·ï¼Œæ’å…¥ä¸€ä¸ªå…ƒç´ ä¼šæ€ä¹ˆæ ·ï¼Œä¿®æ”¹ä¸€ä¸ªå…ƒç´ ä¼šæ€ä¹ˆæ ·ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…ï¼Ÿ</li><li>å¹³æ—¶ç”¨å•¥IDEï¼ŸçŸ¥é“é¡¹ç›®runä¹‹å‰å¹²ä»€ä¹ˆå—ï¼Ÿ<ul><li>è¯´äº†ä¸ªç¼–è¯‘å’Œæ£€æŸ¥é”™è¯¯ï¼Œä½†æ˜¯é¢è¯•å®˜ä¼¼ä¹è¿˜æƒ³è®©æˆ‘è¯´ç‚¹ä¸œè¥¿â€¦</li></ul></li><li>ç¼–è¯‘æœŸå’Œè¿è¡ŒæœŸçš„åŒºåˆ«ï¼Ÿ</li><li>æŒ‡é’ˆäº†è§£å—ï¼Ÿ</li><li>åäº¿ä¸ªæ•°ï¼Œä¸€ä¸ªæ•°4å­—èŠ‚ï¼Œç„¶åä½ æ€ä¹ˆæ‰¾æœ€å¤§çš„åä¸ªæ•°ï¼Ÿåäº¿ä¸ªæ•°ï¼Œå å¤šå°‘å†…å­˜ï¼Ÿ</li><li>æ“ä½œç³»ç»Ÿä¸­æœ‰å“ªäº›å†…å­˜çŸ¥é“å—ï¼Ÿå¹³æ—¶ç”¨ä»€ä¹ˆWindowsè¿˜æ˜¯Linuxï¼Ÿ</li><li>è¯´è¯´å¯„å­˜å™¨ï¼Ÿ</li><li>äº†è§£ç¼–è¯‘åŸç†å—ï¼ŸçŸ¥é“è®¡ç®—æœºç»„æˆåŸç†å—ï¼Ÿå¹³æ—¶éƒ½å­¦ä»€ä¹ˆè¯¾ï¼Ÿ</li><li>ä¸€ä¸ªäººç»™å¦ä¸€ä¸ªäººå‘å¾®ä¿¡æ¶ˆæ¯ï¼Œè¯´è¯´å¯èƒ½ä¼šå‘ç”Ÿå“ªäº›äº‹æƒ…ï¼Ÿ</li><li>é•¿è¿æ¥çŸ­è¿æ¥è¯´è¯´åŒºåˆ«ï¼Œä½ çŸ¥é“çš„å“ªäº›æ˜¯é•¿è¿æ¥ï¼Œå“ªäº›æ˜¯çŸ­è¿æ¥?TCPæ˜¯çŸ­è¿æ¥è¿˜æ˜¯é•¿è¿æ¥å—ï¼Ÿ</li><li>httpæ˜¯åŸºäºä»€ä¹ˆå®ç°çš„ï¼Ÿ1.0å’Œ1.1ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li><li>MTUçŸ¥é“å—ï¼Ÿä»¥å¤ªç½‘å¸§çŸ¥é“ä¸ï¼ŸMTUå¤§å°ä½ çŸ¥é“ä¸ï¼ŸMTUçš„ç»„æˆä½ çŸ¥é“ä¸ï¼Ÿ</li><li>TCPå’ŒUDPæ˜¯å¦å¯é ï¼Œä¸ºä»€ä¹ˆä¸å¯é orä¸ºä»€ä¹ˆå¯é ï¼Ÿ</li><li>å¦‚æœå®¢æˆ·ç«¯é•¿æ—¶é—´ä¸å‘æ¶ˆæ¯ï¼Œé‚£æœåŠ¡å™¨ç«¯å’‹åŠï¼Ÿã€å·®ä¸å¤šè¿™ä¸ªæ„æ€â€¦ã€‘</li></ul>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/%E9%9D%A2%E8%AF%95/">é¢è¯•</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Java/">Java</category>
      
      <category domain="https://www.littlecorgi.top/tags/Kotlin/">Kotlin</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ</category>
      
      <category domain="https://www.littlecorgi.top/tags/JVM/">JVM</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E8%AE%A1%E7%BB%84/">è®¡ç»„</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E8%AE%A1%E7%BD%91/">è®¡ç½‘</category>
      
      
      <comments>https://www.littlecorgi.top/posts/9d6997ec.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>sakuraè…¾è®¯é¢ç»</title>
      <link>https://www.littlecorgi.top/posts/406dd90d.html</link>
      <guid>https://www.littlecorgi.top/posts/406dd90d.html</guid>
      <pubDate>Mon, 31 Dec 2018 16:00:02 GMT</pubDate>
      
        
        
          
          
      <description></description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="å®ä¹ æ˜¥æ‹›-æ‰‹Q"><a href="#å®ä¹ æ˜¥æ‹›-æ‰‹Q" class="headerlink" title="å®ä¹ æ˜¥æ‹› (æ‰‹Q)"></a>å®ä¹ æ˜¥æ‹› (æ‰‹Q)</h1><h2 id="ä¸€é¢"><a href="#ä¸€é¢" class="headerlink" title="ä¸€é¢"></a>ä¸€é¢</h2><ul><li>è‡ªæˆ‘ä»‹ç»</li><li>åœ¨ç™¾åº¦å®ä¹ çš„ç»å†ï¼Œç„¶åé—®æˆ‘æ‰‹ç™¾çš„æ¡†æ¶ï¼Œå†™çš„éœ€æ±‚</li><li>HTTPSï¼Œå¯¹ç§°åŠ å¯†ï¼Œéå¯¹ç§°åŠ å¯†</li><li>ç”¨è¿‡çš„ç½‘ç»œæ¡†æ¶ okHttpæºç è§£æ</li><li>RecycleViewçš„æºç </li><li>ç®—æ³•é¢˜ ä¸¤æ•°ä¹‹å’Œ</li><li>æ™ºåŠ›é¢˜ ç“¶å­ä»100æ¥¼å¾€ä¸‹æ‰”ï¼Œä¸€å…±ä¸¤ä¸ªç“¶å­ï¼Œé—®ä»é‚£ä¸ªæ¥¼æ‰”ç“¶å­åˆšå¥½ç¢</li><li>Handleæºç åˆ†æ</li><li>è¿›ç¨‹ä¹‹é—´å¦‚ä½•é€šä¿¡</li></ul><h2 id="äºŒé¢"><a href="#äºŒé¢" class="headerlink" title="äºŒé¢"></a>äºŒé¢</h2><ul><li>è‡ªæˆ‘ä»‹ç»</li><li>ç™¾åº¦å®ä¹ çš„æ—¶å€™åšè¿‡çš„ä¸šåŠ¡</li><li>å®‰å“å’Œjsçš„äº¤äº’æ–¹å¼ï¼Œé‚£ç§æ›´å¥½ï¼Œå®‰å…¨æ€§æ¯”è¾ƒ</li><li>è®©æˆ‘è®²äº†ä¸‹è‡ªå·±å†™çš„unityæ¸¸æˆè¿‡ç¨‹</li><li>HTTPS</li><li>HashMap çš„hashæ“ä½œå’Œæ‰©å®¹æœºåˆ¶</li><li>çº¢é»‘æ ‘æ¦‚å¿µï¼ŒäºŒå‰æ ‘éå†</li><li>ç®—æ³•é¢˜ å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯2çš„æ¬¡æ–¹ å¦‚ä½•ä¼˜åŒ– æ—¶é—´å¤æ‚åº¦</li><li>å¿«æ’çš„æ€æƒ³ å¦‚ä½•ä¼˜åŒ– æ—¶é—´å¤æ‚åº¦</li><li>JVM å†…å­˜æ¨¡å‹</li><li>GC æœºåˆ¶åŸç†ï¼Œæ¦‚å¿µï¼Œå¦‚ä½•è‡ªå·±ç”¨</li><li>å†…å­˜æ³„æ¼é—®é¢˜</li><li>è‡ªå®šä¹‰View</li><li>ListViewçš„ä¼˜åŒ–</li><li>Glideæ¡†æ¶çš„åˆ†æ</li><li>Binderæœºåˆ¶</li><li>è·¨è¿›ç¨‹é€šä¿¡</li><li>ç½‘ç»œTCPï¼Œç½‘ç»œåˆ†å±‚</li></ul><h2 id="ä¸‰é¢"><a href="#ä¸‰é¢" class="headerlink" title="ä¸‰é¢"></a>ä¸‰é¢</h2><ul><li>è‡ªæˆ‘ä»‹ç»</li><li>è®²ä¸‹å†™çš„æœ€å¥½çš„ä¸€ä¸ªé¡¹ç›®</li><li>å¤§æ•°æ®æ’åº</li><li>å¯¹è‡ªå·±é¡¹ç›®çš„ä¼˜åŒ–æ–¹å¼</li><li>ç™¾åº¦å®ä¹ çš„æ—¶å€™ç”Ÿæ´»å’Œå­¦ä¹ </li></ul><h1 id="2019ç§‹æ‹›-csig"><a href="#2019ç§‹æ‹›-csig" class="headerlink" title="2019ç§‹æ‹› (csig)"></a>2019ç§‹æ‹› (csig)</h1><h2 id="ä¸€é¢-1"><a href="#ä¸€é¢-1" class="headerlink" title="ä¸€é¢"></a>ä¸€é¢</h2><ul><li>è‡ªæˆ‘ä»‹ç»</li><li>ä»‹ç»è‡ªå·±å†™çš„éœ€æ±‚</li><li>è‡ªå®šä¹‰viewçš„è¿‡ç¨‹</li><li>javaçº¿ç¨‹ï¼Œå®‰å“çº¿ç¨‹æ± </li><li>handle</li><li>GCï¼ŒGCçš„ä½¿ç”¨æ–¹å¼</li><li>å››å¤§å¼•ç”¨</li><li>OkHttpæºç </li><li>HashMapæºç </li></ul><h2 id="äºŒé¢-1"><a href="#äºŒé¢-1" class="headerlink" title="äºŒé¢"></a>äºŒé¢</h2><ul><li>javaé¢å‘å¯¹è±¡çš„ç†è§£ å¤šæ€çš„å®ä¹  æ¥å£å’ŒæŠ½è±¡ç±»</li><li>cè¯­è¨€å’Œjavaä¹‹é—´çš„åŒºåˆ«</li><li>cè¯­è¨€çš„æŒ‡é’ˆ æŒ‡é’ˆçš„æŒ‡å‘ æŒ‡é’ˆçš„æŒ‡é’ˆæ˜¯å•¥</li><li>å †å’Œæ ˆçš„åŒºåˆ«</li><li>è®¾è®¡æ¨¡å¼ å•ä¾‹ è§‚å¯Ÿè€…æ¶ˆè´¹è€…</li><li>javaçš„å†…å­˜æ¨¡å‹</li><li>åƒåœ¾å›æ”¶å¯¹è±¡ æ„ä¹‰ æ–¹æ³• ä»€ä¹ˆæ—¶å€™å›æ”¶ å›æ”¶é‚£äº› å¦‚ä½•åˆ¤æ–­</li><li>javaå¤šçº¿ç¨‹ é”é‚£å—äº†è§£æ–¹å¼ ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ waitåº•å±‚æ€ä¹ˆå®ç°çš„ sleepåº•å±‚æ€ä¹ˆå®ç°çš„</li><li>javaçº¿ç¨‹æ± åŸç†</li><li>ç„¶åé—®äº†éƒ¨é—¨æ˜¯å¹²å•¥çš„ åœ¨å“ªé‡Œ å‚¬äº†ä¸‹è¿›åº¦</li></ul><h2 id="ä¸‰é¢-1"><a href="#ä¸‰é¢-1" class="headerlink" title="ä¸‰é¢"></a>ä¸‰é¢</h2><ul><li>è‡ªæˆ‘ä»‹ç»</li><li>ç™¾åº¦å®ä¹ ç»å† æ‰‹ç™¾çš„æ¡†æ¶ç»“æ„</li><li>è…¾è®¯å®ä¹ åšäº†ä»€ä¹ˆ éœ€æ±‚å†™äº†é‚£äº› å¯¹éœ€æ±‚çš„ä¼˜åŒ–æœ‰é‚£äº› è‡ªå·±å†™éœ€æ±‚çš„æ–¹æ¡ˆæœ‰ä»€ä¹ˆ å†™éœ€æ±‚æ³¨æ„ä»€ä¹ˆ</li><li>è‡ªå·±æ¸¸æˆé¡¹ç›®æ„æ¶æ˜¯ä»€ä¹ˆ å¦‚ä½•å®ç°çˆ†ç‚¸æ•ˆæœçš„ æ¸¸æˆé‡Œé¢çš„AIæ€ä¹ˆå®ç°çš„ è‡ªå·±æ€ä¹ˆç»„å»ºæ¸¸æˆå›¢é˜Ÿçš„ AIæ€ªç‰©å…·ä½“çš„ç®—æ³•é€»è¾‘æ˜¯ä»€ä¹ˆ è‡ªå·±æ¸¸æˆå¦‚æœä»æ–°æ„å»ºè¦æ€ä¹ˆåš å¦‚ä½•æŠŠunityå¯¼å…¥å®‰å“é‡Œé¢ å¦‚ä½•å’Œå®‰å“è¿›è¡Œäº¤äº’</li><li>flutteråŠ¨æ€åŒ–æ–¹æ¡ˆçš„å®ç° è‡ªå·±å¦‚ä½•è®¾è®¡çš„ flutterç»˜åˆ¶åŸç†æ˜¯å•¥ åŠ¨æ€åŒ–å¦‚ä½•å®ç°çš„ RNåŠ¨æ€åŒ–çš„åŸç† ä¸¤ç§æ–¹æ¡ˆçš„å¯¹æ¯” iosé‚£è¾¹åŠ¨æ€åŒ–æœ‰æ–¹æ¡ˆæ²¡ æ‰‹qå¼€å§‹æ¥å…¥flutteräº†å—</li><li>è‡ªå·±å¯¹ç®—æ³•çš„ç†è§£ åœ¨å…¬å¸é‡Œé¢å†™éœ€æ±‚çš„è¯ ç”¨åˆ°äº†å— å¦‚ä½•ä¼˜åŒ–å®‰å“å„è‡ªæ–¹é¢ å†…å­˜æ³„æ¼å’‹å¤„ç†</li><li>å¯¹ç¼–ç¨‹è¯­è¨€çš„ç†è§£ dart c java kotlin c++ æœ‰é‚£äº›åŒºåˆ« ç¼–ç¨‹è¯­è¨€åº•å±‚å®ç°æ˜¯ä»€ä¹ˆ ä¸ºä»€ä¹ˆæœ‰è¿™ä¹ˆå¤šä¸åŒè¯­è¨€</li><li>è®²ä¸‹è‡ªå·±è§‰å¾—æœ€æœ‰æ„æ€çš„æ•°æ®ç»“æ„ // è·³è¡¨</li><li>è§‰å¾—ä»€ä¹ˆæ‰æ˜¯ä¸€ä¸ªç¨‹åºæœ€é‡è¦çš„åœ°æ–¹ å¦‚ä½•å»è®¾è®¡ä¸€ä¸ªç³»ç»Ÿ è‡ªå·±æ€ä¹ˆä¸‹æ‰‹</li><li>å®¶å“ªé‡Œçš„ï¼Œä¸ºä»€ä¹ˆé€‰æ‹©æ¥åŒ—äº¬ï¼Œè…¾è®¯å®ä¹ æœ€å¤§æ”¶è·æ˜¯å•¥</li><li>è‡ªå·±çš„æŠ€æœ¯å‘å±•æ–¹å‘ å¦‚ä½•å¯¹è‡ªå·±èŒä¸šçš„è§„åˆ’</li><li>é¢è¯•å®˜ä»‹ç»äº†ä¸‹ä»–ä»¬å›¢é˜Ÿä¸šåŠ¡ é—®æˆ‘ä»€ä¹ˆæ—¶å€™èƒ½å®ä¹ </li></ul>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/%E9%9D%A2%E8%AF%95/">é¢è¯•</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Java/">Java</category>
      
      <category domain="https://www.littlecorgi.top/tags/Kotlin/">Kotlin</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ</category>
      
      <category domain="https://www.littlecorgi.top/tags/JVM/">JVM</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E8%AE%A1%E7%BB%84/">è®¡ç»„</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E8%AE%A1%E7%BD%91/">è®¡ç½‘</category>
      
      
      <comments>https://www.littlecorgi.top/posts/406dd90d.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>è…¾è®¯2020å¹´ç§‹æ‹›ç‰›å®¢ç½‘é¢ç»æ€»ç»“</title>
      <link>https://www.littlecorgi.top/posts/702658f4.html</link>
      <guid>https://www.littlecorgi.top/posts/702658f4.html</guid>
      <pubDate>Mon, 31 Dec 2018 16:00:01 GMT</pubDate>
      
        
        
          
          
      <description></description>
          
        
      
      
      
      <content:encoded><![CDATA[<blockquote><p>è®°å½•äº†ç‰›å®¢ç½‘é¢ç»ä¸“åŒºï¼Œä»2020/4/22åˆ°2020/9/16çš„é¢ç»</p></blockquote><h1 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h1><h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><h3 id="Activity"><a href="#Activity" class="headerlink" title="Activity"></a>Activity</h3><ol><li>activityå’Œapplicationæœ‰ä»€ä¹ˆåŒºåˆ«</li><li>ç”Ÿå‘½å‘¨æœŸï¼ˆ*ï¼‰</li><li>å¯åŠ¨æ¨¡å¼ï¼ˆ*ï¼‰</li><li>åˆå§‹åŒ–æ•°æ®åº”è¯¥åœ¨onCreateè¿˜æ˜¯onStartâ€”â€”onCreate</li><li>activityå’Œfragmenté€šä¿¡ï¼ˆ*ï¼‰<ol><li>æ–‡ä»¶</li><li>handler</li><li>attachå›è°ƒ</li><li>eventbus</li><li>bundle</li></ol></li><li>fragmentå’Œactivityæœ‰ä»€ä¹ˆåŒºåˆ«</li><li>activityå’Œwindowå…³ç³»</li><li>Activityã€Viewã€Surfaceã€SurfaceViewä¹‹é—´çš„è”ç³»</li></ol><h3 id="Broadcast"><a href="#Broadcast" class="headerlink" title="Broadcast"></a>Broadcast</h3><ol><li>é™æ€å¹¿æ’­å’ŒåŠ¨æ€å¹¿æ’­åŒºåˆ«ï¼Ÿ</li><li>æœ‰åºå¹¿æ’­çš„åº”ç”¨</li></ol><h3 id="service"><a href="#service" class="headerlink" title="service"></a>service</h3><ol><li>æœåŠ¡startå’ŒbindåŒºåˆ«</li></ol><h3 id="View"><a href="#View" class="headerlink" title="View"></a>View</h3><ol><li>è®²ä¸€ä¸‹Viewçš„ç»˜åˆ¶ï¼ŒperformMeasureæ˜¯å“ªä¸ªè°ƒç”¨çš„ï¼ˆ*ï¼‰</li><li>Drawå’ŒonDrawä»€ä¹ˆåŒºåˆ«</li><li>è‡ªå®šä¹‰viewéœ€è¦å¹²ä»€ä¹ˆ</li><li>Viewäº‹ä»¶åˆ†å‘æœºåˆ¶åŸç†ï¼ˆ*ï¼‰</li><li>å®‰å“åŠ¨ç”»æœ‰å“ªäº›</li><li>ListViewç¼“å­˜ï¼Œæœ‰æ²¡æœ‰æƒ³è¿‡ListViewæ˜¯æ€ä¹ˆå®ç°çš„</li><li>RecyclerViewç€‘å¸ƒæµ</li><li>RecyclerViewç¼“å­˜ï¼ˆè¯¦ç»†è®²ï¼‰</li><li>RecyclerViewæ€§èƒ½ä¼˜åŒ–</li><li>å¦‚ä½•è‡ªå·±è®¾è®¡ä¸€ä¸ªRecyclerViewã€‚ã€‚ã€‚</li><li>æ•°æ®é”™ä¹±å¤„ç†æ–¹å¼</li><li>ä¸ºä»€ä¹ˆä¸ç”¨notifiChangeAll()</li><li>çŸ¥é“DiffUtilå—ï¼Œæºç </li></ol><h3 id="å›¾ç‰‡åŠ è½½"><a href="#å›¾ç‰‡åŠ è½½" class="headerlink" title="å›¾ç‰‡åŠ è½½"></a>å›¾ç‰‡åŠ è½½</h3><ol><li>å›¾ç‰‡å¦‚ä½•é«˜æ•ˆåŠ è½½</li><li>è®¾è®¡ä¸€ä¸ªå›¾ç‰‡åŠ è½½æ¡†æ¶ï¼Œæ€ä¹ˆåš</li><li>ç¼“å­˜æœ‰æ²¡æœ‰åšè¿‡å‘¢</li><li>DiskLrucache ç¼“å­˜</li><li>æ‰¹é‡åŠ è½½å›¾ç‰‡æ€ä¹ˆåš</li><li>LRUç®—æ³•æ˜¯ä»€ä¹ˆï¼Ÿç”¨åœ¨ä»€ä¹ˆåœºæ™¯ï¼Ÿç®€è¿°è½¯ä»¶å’Œç¡¬ä»¶å®ç°æ–¹æ³•ï¼Ÿ</li></ol><h3 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h3><ol><li>æ•°æ®å­˜å‚¨æœ‰å­¦è¿‡å—ï¼Ÿæ•°æ®åº“å’Œæ–‡ä»¶ä¿å­˜æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿï¼ˆ*ï¼‰</li><li>androidæ€ä¹ˆå®ç°å¤šè¿›ç¨‹é€šä¿¡<img src="https://uploadfiles.nowcoder.com/images/20200515/987124751_1589474702275_090C018F8472A332C47E28C3B3292C62" alt=""></li></ol><h2 id="æ¡†æ¶æºç "><a href="#æ¡†æ¶æºç " class="headerlink" title="æ¡†æ¶æºç "></a>æ¡†æ¶æºç </h2><h3 id="Handlerï¼ˆ-ï¼‰"><a href="#Handlerï¼ˆ-ï¼‰" class="headerlink" title="Handlerï¼ˆ**ï¼‰"></a>Handlerï¼ˆ<em>**</em>ï¼‰</h3><ol><li>Handleræœºåˆ¶</li><li>èƒ½å¦è®©messageè¢«pushåˆ°éä¸»çº¿ç¨‹çš„çº¿ç¨‹é‡Œï¼Ÿï¼ˆæç¤ºlooper)</li><li>threadLocalçš„åŸç†</li><li>looper ä¸ºä»€ä¹ˆè®¾è®¡æˆæ­»å¾ªç¯</li><li>looperæ­»å¾ªç¯ä¸ºä»€ä¹ˆä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹</li><li>å¦‚æœåœ¨looperä¸­åŠ å¾ˆå¤šå»¶æ—¶å‘½ä»¤ï¼Œ ä¼šé˜»å¡å—</li><li>æ˜¯å¦å¯ä»¥é˜»å¡ï¼Œå¦‚ä½•é˜»å¡</li><li>Handlerå¼•èµ·çš„å†…å­˜æ³„éœ²æ€ä¹ˆè§£å†³ï¼Œè½¯å¼•ç”¨ï¼Œå¼±å¼•ç”¨å…·ä½“ä½¿ç”¨åœºæ™¯</li><li>ä¸¤ä¸ªå­çº¿ç¨‹ä¹‹é—´å¯ä»¥é€šè¿‡Handlerä¼ é€’æ¶ˆæ¯å—</li><li>MessageQueueçš„æ•°æ®ç»“æ„ï¼Œä¸ºä»€ä¹ˆæ˜¯é“¾è¡¨ä¸æ˜¯é˜Ÿåˆ—</li></ol><h3 id="Binder"><a href="#Binder" class="headerlink" title="Binder(-)"></a>Binder(-)</h3><ol><li>Linuxçš„è¿›ç¨‹é€šä¿¡æœºåˆ¶ï¼Œandroidçš„è¿›ç¨‹é€šä¿¡æœºåˆ¶</li><li>bundle</li></ol><h3 id="OkHttp"><a href="#OkHttp" class="headerlink" title="OkHttp"></a>OkHttp</h3><ol><li>okhttp</li></ol><h3 id="EventBus"><a href="#EventBus" class="headerlink" title="EventBus"></a>EventBus</h3><ol><li>eventbus</li></ol><h2 id="æ€§èƒ½ä¼˜åŒ–"><a href="#æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–"></a>æ€§èƒ½ä¼˜åŒ–</h2><ol><li>å†…å­˜æ³„æ¼çš„åœºæ™¯å’Œè§£å†³æ–¹æ³•ï¼ˆ*ï¼‰</li><li>å•å…ƒæµ‹è¯•äº†è§£å—</li><li>å†…å­˜æ³„æ¼ æœ‰æ²¡æœ‰è§£å†³åŠæ³•<ol><li>Activityâ€”ã€‹onDestory()</li><li>å¼±åº”ç”¨ å¼±å¼•ç”¨çš„å…·ä½“å®ç°</li></ol></li><li>å®‰å“11 æœ‰å“ªäº›æ–°ç‰¹æ€§</li><li>mvc MVP mvvm åŒºåˆ«</li><li>å®‰å“å˜å¾—è¶Šæ¥è¶Šæµç•…ï¼Œä½ çŸ¥é“åº•å±‚è§’åº¦å®‰å“ç³»ç»Ÿåšäº†å“ªäº›å·¥ä½œå— ï¼Ÿï¼Ÿï¼Ÿ</li></ol><h1 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h1><h2 id="åŸºç¡€-1"><a href="#åŸºç¡€-1" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><ol><li>javaåŸºæœ¬æ•°æ®ç±»å‹è¯´ä¸€ä¸‹ï¼Œlongæœ€å¤§å€¼å¤šå°‘</li><li>Stringå­—ç¬¦ä¸²å®é™…å¯¹è±¡çš„é—®é¢˜ï¼ˆ*ï¼‰</li><li>String str = â€œ123â€ + â€œ456â€;ä¼šåˆ›å»ºå‡ ä¸ªå¯¹è±¡ã€‚</li><li>æˆ‘çœ‹ä½ ä»£ç é¢˜é‡Œç”¨äº† StringBuilderï¼Œé‚£ä½ è¯´ä¸‹ StringBuilder å’Œ StringBuffer</li><li>string stringbuilder stringbufferæœ‰å•¥åŒºåˆ«ï¼Ÿ</li><li>==å’ŒequalåŒºåˆ«ï¼Œhashcodeä½•æ—¶éœ€è¦è¢«é‡å†™</li><li>javaä¸­çš„å¼‚å¸¸å¤„ç†ï¼ˆç­”äº†try catchï¼‰</li><li>å››ç§å¼•ç”¨çš„ç‰¹ç‚¹ï¼ˆ<em>**</em>ï¼‰</li><li>é‡å†™å’Œé‡è½½çš„åŒºåˆ«</li><li>å†…éƒ¨ç±»</li><li>çŸ¥é“intå’ŒINTçš„åŒºåˆ«å—ï¼Ÿboolå’ŒBOOLçš„åŒºåˆ«å‘¢ï¼Ÿï¼ˆï¼Ÿï¼Ÿï¼Ÿï¼Ÿå•¥ç©æ„ï¼‰intå’Œintegerçš„åŒºåˆ«ï¼Ÿï¼ˆåº”è¯¥æ˜¯æƒ³é—®åŒ…è£…ç±»å§ï¼‰</li><li>åºåˆ—åŒ–ï¼ˆSerilizableå’ŒParcelableï¼‰</li><li>å‡½æ•°ä¸€ç›´é€’å½’ä¼šæœ‰ä»€ä¹ˆå½±å“ï¼Ÿï¼ˆæ ˆæº¢å‡ºï¼Ÿï¼‰å¦‚æœä¸ä¼ å‚ï¼Œæ ˆè¿˜ä¼šæº¢å‡ºå—</li></ol><h2 id="é›†åˆ"><a href="#é›†åˆ" class="headerlink" title="é›†åˆ"></a>é›†åˆ</h2><ol><li>ArrayList å’Œ LinkedListï¼ˆ<em>**</em>ï¼‰</li><li>HashMap å’Œ CurrentHashMap</li><li>getçš„æ—¶é—´å¤æ‚åº¦</li><li>å¦‚ä½•ä¼˜åŒ–å†²çª</li><li>List,Set,Mapä»€ä¹ˆåŒºåˆ«ï¼ŒArrayList, LinkedListåŒºåˆ«</li><li>HashMapåŸç†ï¼Œä¸ºä»€ä¹ˆæ¯æ¬¡æ‰©å®¹éƒ½æ˜¯2çš„å€æ•°ï¼Œä¸ºä»€ä¹ˆç”±å¤´æ’æ”¹æˆäº†å°¾æ’ï¼Œç¯åŒ–æ˜¯æ€ä¹ˆå¼•èµ·çš„ï¼ˆ<em>**</em>ï¼‰</li></ol><h2 id="å¤šçº¿ç¨‹"><a href="#å¤šçº¿ç¨‹" class="headerlink" title="å¤šçº¿ç¨‹"></a>å¤šçº¿ç¨‹</h2><ol><li>Java é‡Œæœ‰å“ªäº›åŠ é”çš„æ–¹å¼ï¼ˆ*ï¼‰</li><li>Java çš„çº¿ç¨‹æ± å‚æ•°æ€ä¹ˆè®¾ç½®</li><li>åŠ ä¸¤æ¬¡é”ä¼šæ­»é”å—</li><li>sleepå’Œwaitçš„åŒºåˆ«ï¼Œä¸ºä»€ä¹ˆå‰è€…åœ¨objectç±»ä¸­è€Œåè€…ä¸åœ¨ï¼ˆ*ï¼‰</li><li>volatileå’Œsynchronizedçš„åŒºåˆ«ï¼Œä»–ä»¬çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼ˆ*ï¼‰</li><li>volatileç”¨æ¥å¹²å˜›çš„ï¼Ÿ</li></ol><h2 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h2><ol><li>jvmå†…å­˜æ¨¡å‹ï¼ˆ2ï¼‰</li><li>åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åˆ†é…åœ¨å“ªé‡Œ</li><li>å †æ ˆå†…å­˜å…·ä½“æ˜¯æ€ä¹ˆç”³è¯·çš„</li><li>æ˜¯å¦äº†è§£åå°„ï¼ŒèƒŒåçš„æœºåˆ¶æ˜¯å¦äº†è§£</li><li>ç±»åŠ è½½æœºåˆ¶</li><li>æ³¨è§£ï¼Œåå°„æœºåˆ¶çš„åŸç†</li><li>åƒåœ¾å›æ”¶åŸç†ä»¥åŠç®—æ³•</li><li>GCçš„æ ‡è®°ç®—æ³•ç§ç±»ï¼Œå¼•ç”¨è®¡æ•°æ³•çš„é—®é¢˜æ€ä¹ˆè§£å†³</li><li>GCï¼ŒFullGCä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘</li></ol><h1 id="è®¡ç½‘"><a href="#è®¡ç½‘" class="headerlink" title="è®¡ç½‘"></a>è®¡ç½‘</h1><p>åœ¨æµè§ˆå™¨è¾“å…¥ç™¾åº¦ç„¶åå›è½¦ä¹‹åçš„æ•´ä¸ªè¿‡ç¨‹ï¼ˆè¯¦ç»†åˆ°åè®®å±‚éƒ½å‘ç”Ÿäº†ä»€ä¹ˆï¼‰</p><h2 id="TCP-UDPï¼ˆ-ï¼‰"><a href="#TCP-UDPï¼ˆ-ï¼‰" class="headerlink" title="TCP/UDPï¼ˆ*ï¼‰"></a>TCP/UDPï¼ˆ*ï¼‰</h2><ol><li>æ–­ç‚¹é‡ä¼ </li><li>TCPå’ŒUDPåŒºåˆ«</li><li>Tcpç‰¹ç‚¹</li><li>TCPçš„å¯é æ€§å’Œæ‹¥å¡æ§åˆ¶</li><li>TCPå¦‚ä½•ä¿è¯å¯é </li><li>ä¸‰æ¡å››æŒ¥</li><li>ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œä¸¤æ¬¡ä¸è¡Œå—</li><li>UDPæ€ä¹ˆå˜å¯é ï¼Œåº”ç”¨åœºæ™¯ï¼ŒUdp(æ¸¸æˆï¼Œè§†é¢‘ï¼Œå…¶ä¸­éŸ³é¢‘ä¸å¯ä»¥ï¼‰</li></ol><h2 id="http-httpsï¼ˆ-ï¼‰"><a href="#http-httpsï¼ˆ-ï¼‰" class="headerlink" title="http/httpsï¼ˆ*ï¼‰"></a>http/httpsï¼ˆ*ï¼‰</h2><ol><li>HTTPå’ŒHTTPS,æ€ä¹ˆåŠ å¯†çš„</li><li>httpå’Œhttpsçš„åŒºåˆ«</li><li>httpså®‰å…¨å—ï¼Ÿæåˆ°äº†ç¬¬ä¸‰æ–¹è¯ä¹¦</li><li>http1.0 1.1 2.0 åŒºåˆ«</li><li>http1.0 1.1 2.0 è§£å†³äº†ä»€ä¹ˆé—®é¢˜</li></ol><h2 id="IP"><a href="#IP" class="headerlink" title="IP"></a>IP</h2><ol><li>httpsèƒ½ä¸èƒ½é˜²dnsåŠ«æŒï¼Ÿ</li><li>dnsåŠ«æŒè¯¥æ€ä¹ˆåŠ</li></ol><h1 id="æ“ä½œç³»ç»Ÿ"><a href="#æ“ä½œç³»ç»Ÿ" class="headerlink" title="æ“ä½œç³»ç»Ÿ"></a>æ“ä½œç³»ç»Ÿ</h1><ol><li>çº¿ç¨‹å’Œè¿›ç¨‹ï¼ˆ*ï¼‰</li><li>è¿›ç¨‹çš„è°ƒåº¦ç®—æ³•</li><li>è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡æ–¹æ³•(IPC)</li><li>çº¿ç¨‹çš„å„ç§çŠ¶æ€æœ‰ä»€ä¹ˆï¼Ÿ</li><li>çº¿ç¨‹çš„åŒæ­¥æ–¹æ³•</li><li>æ­»é”æ˜¯ä»€ä¹ˆï¼Œé‡åˆ°è¿‡å—</li><li>æ“ä½œç³»ç»Ÿä¸­å¼‚å¸¸æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼ˆ1ï¼‰</li><li>æ“ä½œç³»ç»Ÿä¸­çš„ä¸­æ–­ï¼ˆ1ï¼‰</li><li>32ä½çš„æ“ä½œç³»ç»Ÿèƒ½å­˜å¤šå¤§çš„æ•°æ®ï¼ˆ1ï¼‰</li><li>è™šæ‹Ÿå†…å­˜æ˜¯ä»€ä¹ˆ</li><li>è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€</li></ol><h1 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h1><ol><li>å¿«æ’å’Œå †æ’çš„åŸç†</li></ol><h1 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h1><ol><li>æ˜¯å¦äº†è§£è®¾è®¡æ¨¡å¼å’Œé¢å‘å¯¹è±¡åŸåˆ™ï¼Ÿè®²ä¸€è®²é¡¹ç›®ä¸­ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼ï¼ˆè®²äº†è§‚å¯Ÿè€…å’Œå•ä¾‹è¿˜æœ‰å·¥å‚ï¼‰è¿˜é—®äº†æ€ä¹ˆæ ·ç®—ä¸€ä¸ªå¥½çš„æ¥å£ï¼šå‡½æ•°åè¦æ˜ç¡®ã€å‡½æ•°èŒè´£æ˜ç¡®ã€æœ‰æ ‡å‡†çš„è¾“å…¥è¾“å‡ºè¿™ä¸€ç‚¹æ²¡æœ‰ç­”ä¸Šæ¥ï¼ŒåŸæ¥é¢è¯•å®˜æƒ³é—®çš„æ˜¯è¾¹ç•Œæµ‹è¯•çš„é—®é¢˜</li><li>å•ä¾‹ï¼Œå•ä¾‹æœ‰å¤šå°‘ç§å†™æ³•</li></ol><h1 id="ç®—æ³•é¢˜"><a href="#ç®—æ³•é¢˜" class="headerlink" title="ç®—æ³•é¢˜"></a>ç®—æ³•é¢˜</h1><ol><li>ç¬¬kå¤§çš„æ•°(2)</li><li>åè½¬é“¾è¡¨ï¼ˆ2ï¼‰</li><li>äºŒå‰æ ‘éå†ï¼ˆ3ï¼‰</li><li>ç»™ä¸¤ä¸ªå­—ç¬¦ä¸²a,bï¼Œåˆ¤æ–­aä¸­æ˜¯å¦åŒ…å«äº†bçš„æ‰€æœ‰å­—ç¬¦</li><li>ç‰ˆæœ¬å·æ¯”è¾ƒå¤§å°</li><li>ç”Ÿæˆé•¿åº¦ä¸ºNçš„éšæœºæ•°ç»„</li><li>æœ€å°çš„kä¸ªæ•°</li><li>å¤§æ•°ç›¸åŠ ï¼ˆæ³¨æ„ï¼šå¸¦æ­£è´Ÿå·çš„æƒ…å†µï¼›å†æ³¨æ„ï¼šå¸¦å°æ•°çš„æƒ…å†µï¼‰</li><li>ä¸€ä¸ªå­—ç¬¦ä¸²é‡Œé¢ï¼Œæœ€é•¿ä¸é‡å¤å­—ç¬¦çš„é•¿åº¦</li><li>æ‹¬å·åŒ¹é…</li><li>è®¡ç®—0~nï¼ˆä¸åŒ…å«1ï¼‰ä¹‹é—´ï¼Œæ‰€æœ‰çš„3å’Œ5çš„å€æ•°çš„å’Œã€‚å¦‚n=10ï¼Œè¾“å‡º3+5+6+9=23</li><li>æ­£è´Ÿæ•°äº¤æ›¿æ’åˆ—ï¼Œæ‰¾å’Œæœ€å¤§çš„å­åºåˆ—</li><li>é“¾è¡¨æœ‰ç¯</li><li>æ¥é›¨æ°´</li><li>äºŒå‰æ ‘ç»“ç‚¹æœ€è¿‘å…¬å…±ç¥–å…ˆ</li><li>æœ€é•¿å…¬å…±å­ä¸²é•¿åº¦</li><li>ä¸¤ä¸ªæ— åºæ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„ä¸­çš„å…ƒç´ éƒ½æ˜¯å”¯ä¸€ï¼Œå¤šç§æ–¹æ³•æ‰¾å‡ºäºŒè€…é‡å¤çš„å…ƒç´ </li><li>æ±‚æœ€å¤§å…¬çº¦æ•°</li><li>2æ•°ä¹‹å’Œ</li><li>ä¸¤ä¸ªæ•°ç»„åˆå¹¶ï¼Œæœ‰åºè¾“å‡ºã€‚ä¸å»é‡</li><li>åˆ é™¤æ— åºé“¾è¡¨ä¸­çš„é‡å¤ç»“ç‚¹ï¼ˆèƒ½å¦ä¼˜åŒ–ï¼‰</li></ol><h1 id="æ™ºåŠ›é¢˜"><a href="#æ™ºåŠ›é¢˜" class="headerlink" title="æ™ºåŠ›é¢˜"></a>æ™ºåŠ›é¢˜</h1><ol><li>1000 æ¯æ°´ï¼Œæœ‰ä¸€æ¯æœ‰æ¯’ï¼Œå°é¼ å–ä¸‹å1å°æ—¶æ­»äº¡ï¼Œç°åœ¨æœ‰ 10 åªå°é¼ ï¼Œæ€ä¹ˆåœ¨ 1 å°æ—¶å†…æ‰¾å‡ºæœ‰æ¯’çš„é‚£æ¯æ°´</li></ol><h1 id="ç¤¾æ‹›é¢ç»"><a href="#ç¤¾æ‹›é¢ç»" class="headerlink" title="ç¤¾æ‹›é¢ç»"></a>ç¤¾æ‹›é¢ç»</h1><blockquote><p>å¯ä»¥çœ‹ä¸‹ï¼Œä¸éš¾ï¼Œè·Ÿå’±ä»¬é¢è¯•å·®ä¸å¤šã€‚<br>æœ‰ä¸€è¯´ä¸€ï¼Œå·¥ä½œ1-3å¹´å†…çš„ç¤¾æ‹›é¢è¯•é¢˜çœŸçš„ä¸éš¾</p></blockquote><p><a href="https://www.nowcoder.com/discuss/447563">è…¾è®¯Androidå²—ç¤¾æ‹›é¢ç­‹åˆ†äº«</a><br><a href="https://www.nowcoder.com/discuss/414580">è®°ç™¾åº¦è…¾è®¯oppoçš„Androidç¤¾æ‹›é¢ç»</a></p>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/%E9%9D%A2%E8%AF%95/">é¢è¯•</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Java/">Java</category>
      
      <category domain="https://www.littlecorgi.top/tags/Kotlin/">Kotlin</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ</category>
      
      <category domain="https://www.littlecorgi.top/tags/JVM/">JVM</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E8%AE%A1%E7%BB%84/">è®¡ç»„</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E8%AE%A1%E7%BD%91/">è®¡ç½‘</category>
      
      
      <comments>https://www.littlecorgi.top/posts/702658f4.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>ç™¾åº¦é¢è¯•é¢˜æ€»ç»“</title>
      <link>https://www.littlecorgi.top/posts/5c3dbcbd.html</link>
      <guid>https://www.littlecorgi.top/posts/5c3dbcbd.html</guid>
      <pubDate>Mon, 31 Dec 2018 16:00:00 GMT</pubDate>
      
      <description>è®°å½•ä¸‹ç½‘ç»œä¸Šåˆ«äººå‘çš„é¢è¯•æ±‡æ€»</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="1-ç¬¬ä¸€ä»½"><a href="#1-ç¬¬ä¸€ä»½" class="headerlink" title="1. ç¬¬ä¸€ä»½"></a>1. ç¬¬ä¸€ä»½</h1><ol><li>ç®—æ³•ï¼šé“¾è¡¨çš„é€†ç½®<br>ç®—æ³•æ€è·¯ä¸æ­£ç¡®</li><li>Javaçº¿ç¨‹æ± <br>ç…§ç€æºç è®²äº†ä¸€é<br>è¿½é—®ï¼šLinkedBlockingQueueæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ<br>è®²çš„ä¸æ¸…æ¥š<br>è¿½é—®ï¼šçº¿ç¨‹åŒæ­¥æœ‰ä»€ä¹ˆåŠæ³•ï¼Ÿ<br>åªå›ç­”äº†é”<br>è¿½é—®ï¼šé”æœ‰å“ªäº›ï¼Ÿå¯ç”¨äºä»€ä¹ˆåœºæ™¯ï¼Ÿ<br>synchronizedã€lockã€å¯é‡ç”¨é”ã€CAS<br>åŸºæœ¬åŸç†å›ç­”æ­£ç¡®ï¼Œä½†ä¸æ¸…æ¥šå…·ä½“åœºæ™¯  </li><li>ThreadLocalä½œç”¨<br>ä¸æ¸…æ¥š</li><li>Handlerä½¿ç”¨çš„æ—¶å€™éœ€è¦æ³¨æ„ä»€ä¹ˆé—®é¢˜ï¼Ÿ<br>å†…å­˜æ³„éœ²<br>å†…éƒ¨ç±»ã€å¼±å¼•ç”¨ï¼Œé™æ€å†…éƒ¨ç±»<br>onDestroyç§»é™¤æ¶ˆæ¯<br>è¿½é—®ï¼šHandleréƒ½èƒ½å¹²ä»€ä¹ˆäº‹ï¼Ÿ<br>å¡é¡¿ä¸¢å¸§æ£€æµ‹</li><li>Javaé‡Œé¢çš„å‡ ç§å¼•ç”¨åŒºåˆ«ï¼Ÿä½¿ç”¨åœºæ™¯<br>åŸç†å›ç­”æ­£ç¡®ï¼Œä½¿ç”¨åœºæ™¯ç†è§£ä¸å¤Ÿæ·±å…¥</li><li>å¡é¡¿æ£€æµ‹å’Œä¼˜åŒ–<br>æ£€æµ‹æ–¹æ³•ï¼šBlockCanaryã€TraceViewã€å±å¹•åˆ·æ–°æœºåˆ¶<br>é€ æˆå¡é¡¿çš„åŸå› å›ç­”æ­£ç¡®<br>ä¼˜åŒ–ï¼šæ‰å¹³åŒ–å¸ƒå±€ã€è¿‡æ¸¡ç»˜åˆ¶ã€åˆ·æ–°æ¬¡æ•°åŒºåŸŸæ§åˆ¶<br>ä¸»çº¿ç¨‹è€—æ—¶æ“ä½œã€SPåˆå§‹åŒ–ã€ä¸è¦æ”¾å¤§å¯¹è±¡ï¼Œä¸è¦é¢‘ç¹æäº¤ï¼Œå‡å°‘IOæ“ä½œ<br>è‡ªå®šä¹‰Viewçš„onDrawæ–¹æ³•</li><li>SPå†…éƒ¨æ•°æ®ç»“æ„<br>XMLæ–‡ä»¶ï¼Œmap kvå½¢å¼<br>è¿½é—®ï¼šçº¿ç¨‹å®‰å…¨å—ï¼Ÿ<br>å›ç­”æ­£ç¡®<br>è¿½é—®ï¼šè¿›ç¨‹å®‰å…¨å—ï¼Ÿ<br>ä¸å®‰å…¨<br>è¿½é—®ï¼šæ€ä¹ˆä¿è¯è¿›ç¨‹å®‰å…¨ï¼Ÿ<br>åŒ…ä¸€å±‚ContentProvider<br>è¿½é—®ï¼šç”¨SQLiteå¯ä»¥å—ï¼Ÿä¸ºä»€ä¹ˆ<br>åº”è¯¥å¯ä»¥</li><li>è¿›ç¨‹é—´é€šä¿¡çš„åŠæ³•<br>AIDLï¼ŒBinderï¼Œé™¤äº†Binderä¸çŸ¥é“å…¶ä»–çš„</li><li>LruCache<br>åŸºæœ¬åŸç†å›ç­”æ­£ç¡®<br>è¿½é—®ï¼šget/putæ–¹æ³•è®¾è®¡çš„æ—¶å€™éœ€è¦æ³¨æ„ä»€ä¹ˆé—®é¢˜ï¼Ÿ<br>LinkedHashMapä¸å®‰å…¨ï¼ŒåŠ åŒæ­¥é”</li><li>HTTPS<br>åŸºæœ¬æµç¨‹æ­£ç¡®ï¼Œä½†ä¸å®Œå–„ï¼Œä¸çŸ¥é“å¦‚ä½•ä¼˜åŒ–</li><li>Kotliné‡åˆ°çš„å‘ï¼Ÿ<br>æ²¡é‡åˆ°ä»€ä¹ˆå‘ï¼Œåªè§‰å¾—æœ‰å¥½å¤„<br>è¿½é—®ï¼šæœ‰ä»€ä¹ˆå¥½å¤„<br>ç®€æ´ã€è¯­æ³•ç³–<br>è¿½é—®ï¼šobjectå’Œcompaion objectåŒºåˆ«<br>å›ç­”çš„æ¯”è¾ƒç‰‡é¢<br>è¿½é—®ï¼šobjectå®ç°å•ä¾‹çš„åŸç†<br>å›ç­”é”™è¯¯</li></ol><h1 id="2-ç¬¬äºŒä»½"><a href="#2-ç¬¬äºŒä»½" class="headerlink" title="2. ç¬¬äºŒä»½"></a>2. ç¬¬äºŒä»½</h1><ol><li>2sumç®—æ³•<br>ç»™å‡ºäº†åŒé‡å¾ªç¯çš„åŠæ³•ï¼Œä½†ç®—æ³•ä¸å®Œå–„<br>è¿½é—®ï¼šæ˜¯å¦æœ‰æ›´å¿«çš„åŠæ³•ï¼Ÿ<br>æ²¡æƒ³æ³•</li><li>I am a studentå˜æˆstudent a am I<br>æ²¡æƒ³æ³•</li><li>Javaçš„HashMapçš„å“ˆå¸Œå†²çª<br>å›ç­”æ­£ç¡®<br>è¿½é—®ï¼šHashMapå’ŒHashTableï¼ŒConcurrentHashMap<br>å›ç­”æ­£ç¡®ï¼Œå¯¹æ¯”è¯¦ç»†</li><li>LinkedBlockQueueçš„ä½œç”¨<br>åŸºæœ¬åŸç†å›ç­”æ­£å¸¸ï¼Œä½¿ç”¨åœºæ™¯åŸºæœ¬æ­£ç¡® </li><li>ThreadLocalä½œç”¨ï¼Œä½¿ç”¨æ—¶éœ€è¦æ³¨æ„ä»€ä¹ˆé—®é¢˜ï¼Ÿ<br>åŸºæœ¬åŸç†å›ç­”æ­£ç¡®<br>æ³¨æ„çš„é—®é¢˜ï¼šå†…å­˜æ³„éœ²ç›¸å…³ï¼Œå…·ä½“è¯´çš„ä¸å¤ªæ¸…æ¥š</li><li>å‡ ç§å¼•ç”¨å½¢å¼çš„åŒºåˆ«<br>å†…å­˜æ§åˆ¶ä¸Šçš„åŒºåˆ«å›ç­”æ­£ç¡®ã€è¯¦ç»†<br>è¿½é—®ï¼šå…·ä½“ä½¿ç”¨åœºæ™¯<br>èƒ½ç­”å‡ºWeakçš„ä½¿ç”¨åœºæ™¯</li><li>Bitmapä½¿ç”¨çš„æ—¶å€™æ³¨æ„çš„é—®é¢˜<br>é¢œè‰²é…ç½®ã€è¿‡å¤§ï¼ˆç¼©æ”¾ã€BitmapFactoryã€optionï¼‰ã€åŠæ—¶recycle<br>è¿½é—®ï¼šRecycleäº†æ€ä¹ˆåŠï¼Ÿ<br>ç£ç›˜ç¼“å­˜<br>è¿½é—®ï¼šBitmapçš„OOMé¿å…<br>èƒ½è¯´å‡ºåŸºæœ¬çš„<br>è¿½é—®ï¼šAndroid 6.0å’Œ9.0ä¸Šçš„BitmapåŠ è½½æœ‰ä»€ä¹ˆåŒºåˆ«<br>åŸºæœ¬æ–¹å‘æ­£ç¡®ï¼Œä½†ä¸å®Œå…¨æ­£ç¡®<br>è¿½é—®ï¼š565å’Œ8888åŒºåˆ«<br>å ç”¨ç©ºé—´é—®é¢˜ï¼Œé€æ˜åº¦ä¿¡æ¯<br>è¿½é—®ï¼šBitmapåœ¨Androidä¸Šå˜ç»¿çš„é—®é¢˜ï¼ŒåŸå› ã€è§£å†³ï¼Ÿ<br>ä¸äº†è§£</li><li>MessageQueue<br>Javaå±‚å›ç­”æ¯”è¾ƒè¯¦ç»†<br>è¿½é—®ï¼šæ­»å¾ªç¯ä¸ºä»€ä¹ˆä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Ÿ<br>å›ç­”é”™è¯¯<br>è¿½é—®ï¼šæ“ä½œç³»ç»Ÿä¸Šå¯¹åº”ä»€ä¹ˆIOå¤ç”¨æ¨¡å‹ï¼Ÿ<br>ä¸å¤ªæ¸…æ¥š</li><li>å›¾ç‰‡åŠ è½½æ¡†æ¶çš„èŠ‚æµè®¾è®¡<br>æŒ‰éœ€åŠ è½½ï¼Œå…¶ä»–ä¸äº†è§£ï¼Œæç¤ºäº†ä»¥åï¼Œwebp<br>è¿½é—®ï¼šæ€ä¹ˆçŸ¥é“ç¼“å­˜ï¼Ÿ<br>ä¸æ¸…æ¥š<br>è¿½é—®ï¼šå…¶ä»–èŠ‚æµæ ¼å¼<br>å›ç­”ä¸å®Œå…¨æ­£ç¡®<br>è¿½é—®ï¼špngå’ŒjpegåŒºåˆ«<br>ä¸æ¸…æ¥š</li><li>ConstraintLayoutã€LinearLayoutã€FrameLayoutã€RelativeLayoutæ€§èƒ½&amp;ä½¿ç”¨åœºæ™¯<br>åŸºæœ¬æµ‹é‡ã€layoutåŸç†å¯¹æ¯”å›ç­”æ­£ç¡®<br>ä½¿ç”¨åœºæ™¯å›ç­”æ¯”è¾ƒæŠ½è±¡ï¼Œä¸æ˜¯å¾ˆå…·ä½“<br>è¿½é—®ï¼šåˆ—è¡¨å¡é¡¿ä¼˜åŒ–<br>æ³¨æ„onDrawæ–¹æ³•ã€é¿å…é‡å¤åˆ›å»º<br>è¿½é—®ï¼šç»“åˆä»¥ä¸Šå‡ ç§Layout<br>éœ€è¦çœ‹å…·ä½“ä½¿ç”¨åœºæ™¯ï¼ŒåŸºæœ¬æ–¹å‘æ­£ç¡®ï¼Œä½†ä¸æ˜¯å¾ˆå…·ä½“</li><li>http2<br>ä¸å¤ªæ¸…æ¥š</li><li>HTTPçŠ¶æ€ç <br>301ã€302åŒºåˆ«ï¼šä¸æ¸…æ¥š<br>404ã€403åŒºåˆ«ï¼š404å›ç­”åŸºæœ¬æ­£ç¡®ã€403ä¸æ¸…æ¥š</li></ol>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/%E9%9D%A2%E8%AF%95/">é¢è¯•</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      <category domain="https://www.littlecorgi.top/tags/Java/">Java</category>
      
      <category domain="https://www.littlecorgi.top/tags/Kotlin/">Kotlin</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ</category>
      
      <category domain="https://www.littlecorgi.top/tags/JVM/">JVM</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E8%AE%A1%E7%BB%84/">è®¡ç»„</category>
      
      <category domain="https://www.littlecorgi.top/tags/%E8%AE%A1%E7%BD%91/">è®¡ç½‘</category>
      
      
      <comments>https://www.littlecorgi.top/posts/5c3dbcbd.html#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>æ‚é¡¹</title>
      <link>https://www.littlecorgi.top/posts/bc8ba982.html</link>
      <guid>https://www.littlecorgi.top/posts/bc8ba982.html</guid>
      <pubDate>Wed, 12 Dec 2007 02:40:32 GMT</pubDate>
      
      <description>ä¸»è¦æ˜¯ç”¨äºå°è±¡ç¬”è®°å‰ªè—çš„ä¸´æ—¶æ–‡æ¡£</description>
      
      
      
      <content:encoded><![CDATA[<p>è¿™ç¯‡åšå®¢ä¸»è¦è®²è§£ä¸€ä¸‹å‡ ä¸ªé—®é¢˜</p><ul><li>ç²—ç•¥åœ°ä»‹ç»ä¸€ä¸‹Viewçš„äº‹ä»¶åˆ†å‘æœºåˆ¶</li><li>è§£å†³äº‹ä»¶æ»‘åŠ¨å†²çªçš„æ€è·¯åŠæ–¹æ³•</li><li>ScrollView é‡Œé¢åµŒå¥—ViewPagerå¯¼è‡´çš„æ»‘åŠ¨å†²çª</li><li>ViewPageré‡Œé¢åµŒå¥—ViewPager å¯¼è‡´çš„æ»‘åŠ¨å†²çª</li><li>è½®æ’­å›¾çš„å‡ ç§å®ç°æ–¹å¼</li></ul><h2 id="å…ˆçœ‹ä¸€ä¸‹æ•ˆæœå›¾"><a href="#å…ˆçœ‹ä¸€ä¸‹æ•ˆæœå›¾" class="headerlink" title="å…ˆçœ‹ä¸€ä¸‹æ•ˆæœå›¾"></a>å…ˆçœ‹ä¸€ä¸‹æ•ˆæœå›¾</h2><h3 id="ScrollViewé‡Œé¢åµŒå¥—ViewPager"><a href="#ScrollViewé‡Œé¢åµŒå¥—ViewPager" class="headerlink" title="ScrollViewé‡Œé¢åµŒå¥—ViewPager"></a>ScrollViewé‡Œé¢åµŒå¥—ViewPager</h3><p><img src="https://user-gold-cdn.xitu.io/2019/10/21/16dee435507efb1f?imageslim" alt=""></p><h3 id="ViewPageré‡Œé¢åµŒå¥—ViewPager"><a href="#ViewPageré‡Œé¢åµŒå¥—ViewPager" class="headerlink" title="ViewPageré‡Œé¢åµŒå¥—ViewPager"></a>ViewPageré‡Œé¢åµŒå¥—ViewPager</h3><p><img src="https://user-gold-cdn.xitu.io/2019/10/21/16dee43550cd196c?imageslim" alt=""></p><hr><h2 id="Viewçš„-äº‹ä»¶åˆ†å‘æœºåˆ¶"><a href="#Viewçš„-äº‹ä»¶åˆ†å‘æœºåˆ¶" class="headerlink" title="Viewçš„ äº‹ä»¶åˆ†å‘æœºåˆ¶"></a>Viewçš„ äº‹ä»¶åˆ†å‘æœºåˆ¶</h2><p>è¿™ç¯‡åšå®¢å¤§æ‰“ç®—è¯¦ç»†è®²è§£Viewçš„äº‹ä»¶åˆ†å‘æœºåˆ¶ï¼Œå› ä¸ºç½‘ä¸Šå·²ç»å‡ºç°äº†ä¸€ç³»åˆ—çš„å¥½ æ–‡ç« ï¼Œæˆ‘è‡ªå·±çš„æ°´å¹³ä¹Ÿæœ‰é™ï¼Œç›®å‰è‚¯å®šå†™å¾—ä¸å’‹çš„ã€‚</p><p>å…ˆå•°å—¦ä¸€ä¸‹ï¼ŒView çš„äº‹ä»¶åˆ†å‘æœºåˆ¶ä¸»è¦æ¶‰åŠåˆ°ä¸€ä¸‹ä¸‰ä¸ª æ–¹æ³•</p><ul><li>dispatchTouchEvent ï¼Œè¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯ç”¨æ¥åˆ†å‘äº‹ä»¶çš„</li><li>onInterceptTouchEventï¼Œè¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯ç”¨æ¥æ‹¦æˆªäº‹ä»¶çš„ï¼ˆéœ€è¦æ³¨æ„çš„æ˜¯ViewGroupæ‰æœ‰è¿™ä¸ªæ–¹æ³•ï¼ŒViewæ²¡æœ‰onInterceptTouchEventè¿™ä¸ªæ–¹æ³•</li><li>onTouchEventè¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯ç”¨æ¥å¤„ç†äº‹ä»¶çš„</li><li>requestDisallowInterceptTouchEvent(true)ï¼Œè¿™ä¸ªæ–¹æ³•èƒ½å¤Ÿå½±å“çˆ¶Viewæ˜¯å¦æ‹¦æˆªäº‹ä»¶ï¼Œtrueè¡¨ç¤º ä¸æ‹¦æˆªäº‹ä»¶ï¼Œfalseè¡¨ç¤ºæ‹¦æˆªäº‹ä»¶</li></ul><h3 id="ä¸‹é¢å¼•ç”¨å›¾è§£-Android-äº‹ä»¶åˆ†å‘æœºåˆ¶è¿™ä¸€ç¯‡åšå®¢çš„å†…å®¹"><a href="#ä¸‹é¢å¼•ç”¨å›¾è§£-Android-äº‹ä»¶åˆ†å‘æœºåˆ¶è¿™ä¸€ç¯‡åšå®¢çš„å†…å®¹" class="headerlink" title="ä¸‹é¢å¼•ç”¨å›¾è§£ Android äº‹ä»¶åˆ†å‘æœºåˆ¶è¿™ä¸€ç¯‡åšå®¢çš„å†…å®¹"></a>ä¸‹é¢å¼•ç”¨<a href="https://www.jianshu.com/p/e99b5e8bd67b">å›¾è§£ Android äº‹ä»¶åˆ†å‘æœºåˆ¶</a>è¿™ä¸€ç¯‡åšå®¢çš„å†…å®¹</h3><p><img src="https://user-gold-cdn.xitu.io/2019/10/21/16dee4355a83aa4e?imageslim" alt=""></p><blockquote><ul><li>ä»”ç»†çœ‹çš„è¯ï¼Œå›¾åˆ†ä¸º3å±‚ï¼Œä»ä¸Šå¾€ä¸‹ä¾æ¬¡æ˜¯Activityã€ViewGroupã€View</li><li>äº‹ä»¶ä»å·¦ä¸Šè§’é‚£ä¸ªç™½è‰²ç®­å¤´å¼€å§‹ï¼Œç”±Activityçš„dispatchTouchEventåšåˆ†å‘</li><li>ç®­å¤´çš„ä¸Šé¢å­—ä»£è¡¨æ–¹æ³•è¿”å›å€¼ï¼Œï¼ˆreturn trueã€return falseã€return super.xxxxx(),super çš„æ„æ€æ˜¯è°ƒç”¨çˆ¶ç±»å®ç°ã€‚</li><li>dispatchTouchEventå’Œ onTouchEventçš„æ¡†é‡Œæœ‰ä¸ªã€trueâ€”â€”&gt;æ¶ˆè´¹ã€‘çš„å­—ï¼Œè¡¨ç¤ºçš„æ„æ€æ˜¯å¦‚æœæ–¹æ³•è¿”å›trueï¼Œé‚£ä¹ˆä»£è¡¨äº‹ä»¶å°±æ­¤æ¶ˆè´¹ï¼Œä¸ä¼šç»§ç»­å¾€åˆ«çš„åœ°æ–¹ä¼ äº†ï¼Œäº‹ä»¶ç»ˆæ­¢ã€‚</li><li>ç›®å‰æ‰€æœ‰çš„å›¾çš„äº‹ä»¶æ˜¯é’ˆå¯¹ACTION_DOWNçš„ï¼Œå¯¹äºACTION_MOVEå’ŒACTION_UPæˆ‘ä»¬æœ€ååšåˆ†æã€‚</li><li>ä¹‹å‰å›¾ä¸­çš„Activity çš„dispatchTouchEvent æœ‰è¯¯ï¼ˆå›¾å·²ä¿®å¤ï¼‰ï¼Œåªæœ‰return super.dispatchTouchEvent(ev) æ‰æ˜¯å¾€ä¸‹èµ°ï¼Œè¿”å›true æˆ–è€… false äº‹ä»¶å°±è¢«æ¶ˆè´¹äº†ï¼ˆç»ˆæ­¢ä¼ é€’ï¼‰ã€‚</li></ul></blockquote><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>å½“TouchEventå‘ç”Ÿæ—¶ï¼Œé¦–å…ˆActivityå°†TouchEventä¼ é€’ç»™æœ€é¡¶å±‚çš„Viewï¼ŒTouchEventæœ€å…ˆåˆ°è¾¾æœ€é¡¶å±‚ view çš„ dispatchTouchEvent ï¼Œç„¶åç”± dispatchTouchEvent æ–¹æ³•è¿›è¡Œåˆ†å‘ï¼Œ</p><ul><li><p>å¦‚æœdispatchTouchEventè¿”å›true æ¶ˆè´¹äº‹ä»¶ï¼Œäº‹ä»¶ç»ˆç»“ã€‚</p></li><li><p>å¦‚æœdispatchTouchEventè¿”å› false ï¼Œåˆ™å›ä¼ ç»™çˆ¶Viewçš„onTouchEventäº‹ä»¶å¤„ç†ï¼›</p><blockquote><p>onTouchEventäº‹ä»¶è¿”å›trueï¼Œäº‹ä»¶ç»ˆç»“ï¼Œè¿”å›falseï¼Œäº¤ç»™çˆ¶Viewçš„OnTouchEventæ–¹æ³•å¤„ç†</p></blockquote></li><li><p>å¦‚æœdispatchTouchEventè¿”å›superçš„è¯ï¼Œé»˜è®¤ä¼šè°ƒç”¨è‡ªå·±çš„onInterceptTouchEventæ–¹æ³•</p><blockquote><p>é»˜è®¤çš„æƒ…å†µä¸‹interceptTouchEventå›è°ƒç”¨superæ–¹æ³•ï¼Œsuperæ–¹æ³•é»˜è®¤è¿”å›falseï¼Œæ‰€ä»¥ä¼šäº¤ç»™å­Viewçš„onDispatchTouchEventæ–¹æ³•å¤„ç†</p><p>å¦‚æœ interceptTouchEvent è¿”å› true ï¼Œä¹Ÿå°±æ˜¯æ‹¦æˆªæ‰äº†ï¼Œåˆ™äº¤ç»™å®ƒçš„ onTouchEvent æ¥å¤„ç†ï¼Œ</p><p>å¦‚æœ interceptTouchEvent è¿”å› false ï¼Œé‚£ä¹ˆå°±ä¼ é€’ç»™å­ view ï¼Œç”±å­ view çš„ dispatchTouchEvent å†æ¥å¼€å§‹è¿™ä¸ªäº‹ä»¶çš„åˆ†å‘ã€‚</p></blockquote></li></ul><p>å…³äºæ›´å¤šè¯¦ç»†åˆ†æï¼Œè¯·æŸ¥çœ‹åŸåšå®¢<a href="https://www.jianshu.com/p/e99b5e8bd67b">å›¾è§£ Android äº‹ä»¶åˆ†å‘æœºåˆ¶</a>ï¼ŒçœŸå¿ƒæ¨èï¼Œå†™å¾—å¾ˆå¥½ã€‚</p><hr><h2 id="è§£å†³äº‹ä»¶æ»‘åŠ¨å†²çªçš„æ€è·¯åŠæ–¹æ³•"><a href="#è§£å†³äº‹ä»¶æ»‘åŠ¨å†²çªçš„æ€è·¯åŠæ–¹æ³•" class="headerlink" title="è§£å†³äº‹ä»¶æ»‘åŠ¨å†²çªçš„æ€è·¯åŠæ–¹æ³•"></a>è§£å†³äº‹ä»¶æ»‘åŠ¨å†²çªçš„æ€è·¯åŠæ–¹æ³•</h2><h3 id="å¸¸è§çš„ä¸‰ç§æƒ…å†µ"><a href="#å¸¸è§çš„ä¸‰ç§æƒ…å†µ" class="headerlink" title="å¸¸è§çš„ä¸‰ç§æƒ…å†µ"></a>å¸¸è§çš„ä¸‰ç§æƒ…å†µ</h3><p>ç¬¬ä¸€ç§æƒ…å†µï¼Œæ»‘åŠ¨æ–¹å‘ä¸åŒ</p><p><img src="https://user-gold-cdn.xitu.io/2019/10/21/16dee4355c4af671?imageslim" alt=""></p><p>ç¬¬äºŒç§æƒ…å†µï¼Œæ»‘åŠ¨æ–¹å‘ç›¸åŒ</p><p><img src="https://user-gold-cdn.xitu.io/2019/10/21/16dee4355c396312?imageslim" alt=""></p><p>ç¬¬ä¸‰ç§æƒ…å†µï¼Œä¸Šè¿°ä¸¤ç§æƒ…å†µçš„åµŒå¥—</p><p><img src="https://user-gold-cdn.xitu.io/2019/10/21/16dee43589ee1059?imageslim" alt=""></p><h3 id="è§£å†³æ€è·¯"><a href="#è§£å†³æ€è·¯" class="headerlink" title="è§£å†³æ€è·¯"></a>è§£å†³æ€è·¯</h3><p>çœ‹äº†ä¸Šé¢ä¸‰ç§æƒ…å†µï¼Œæˆ‘ä»¬çŸ¥é“ä»–ä»¬çš„å…±åŒç‰¹ç‚¹æ˜¯çˆ¶View å’Œå­Viewéƒ½æƒ³äº‰ç€å“åº”æˆ‘ä»¬çš„è§¦æ‘¸äº‹ä»¶ï¼Œä½†é—æ†¾çš„æ˜¯æˆ‘ä»¬çš„è§¦æ‘¸äº‹ä»¶ åŒä¸€æ—¶åˆ»åªèƒ½è¢«æŸä¸€ä¸ªViewæˆ–è€…ViewGroupæ‹¦æˆªæ¶ˆè´¹ï¼Œæ‰€ä»¥å°±äº§ç”Ÿäº†æ»‘åŠ¨å†²çªï¼Ÿé‚£æ—¢ç„¶åŒä¸€æ—¶åˆ»åªèƒ½ç”±æŸä¸€ä¸ªViewæˆ–è€…ViewGroupæ¶ˆè´¹æ‹¦æˆªï¼Œé‚£æˆ‘ä»¬å°±åªéœ€è¦ å†³å®šåœ¨æŸä¸ªæ—¶åˆ»ç”±è¿™ä¸ªViewæˆ–è€…ViewGroupæ‹¦æˆªäº‹ä»¶ï¼Œå¦å¤–çš„ æŸä¸ªæ—¶åˆ» æœ‰å¦å¤–ä¸€ä¸ªViewæˆ–è€…ViewGroupæ‹¦æˆªäº‹ä»¶ä¸å°±OKäº†å—ï¼Ÿç»¼ä¸Šï¼Œæ­£å¦‚ åœ¨ <em><strong>ã€ŠAndroidå¼€å‘è‰ºæœ¯ã€‹</strong></em> ä¸€ä¹¦æå‡ºçš„ï¼Œæ€»å…± æœ‰ä¸¤ç§æ¥è§‰æ–¹æ¡ˆ</p><p>ä»¥ä¸‹è§£å†³æ€è·¯æ¥è‡ªäº <em><strong>ã€ŠAndroidå¼€å‘è‰ºæœ¯ã€‹</strong></em> ä¹¦ç±</p><p><strong>ä¸‹é¢çš„ä¸¤ç§æ–¹æ³•é’ˆå¯¹ç¬¬ä¸€ç§æƒ…å†µï¼ˆæ»‘åŠ¨æ–¹å‘ä¸åŒï¼‰ï¼Œçˆ¶Viewæ˜¯ä¸Šä¸‹æ»‘åŠ¨ï¼Œå­Viewæ˜¯å·¦å³æ»‘åŠ¨çš„æƒ…å†µã€‚</strong></p><h3 id="å¤–éƒ¨è§£å†³æ³•"><a href="#å¤–éƒ¨è§£å†³æ³•" class="headerlink" title="å¤–éƒ¨è§£å†³æ³•"></a>å¤–éƒ¨è§£å†³æ³•</h3><p>ä»çˆ¶Viewç€æ‰‹ï¼Œé‡å†™onInterceptTouchEventæ–¹æ³•ï¼Œåœ¨çˆ¶Viewéœ€è¦æ‹¦æˆªçš„æ—¶å€™æ‹¦æˆªï¼Œä¸è¦çš„æ—¶å€™è¿”å›falseï¼Œä¸ºä»£ç å¤§æ¦‚ å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onInterceptTouchEvent</span><span class="params">(MotionEvent ev)</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">float</span> <span class="variable">x</span> <span class="operator">=</span> ev.getX();</span><br><span class="line">    <span class="keyword">final</span> <span class="type">float</span> <span class="variable">y</span> <span class="operator">=</span> ev.getY();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">action</span> <span class="operator">=</span> ev.getAction();</span><br><span class="line">    <span class="keyword">switch</span> (action) &#123;</span><br><span class="line">        <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">            mDownPosX = x;</span><br><span class="line">            mDownPosY = y;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">            <span class="keyword">final</span> <span class="type">float</span> <span class="variable">deltaX</span> <span class="operator">=</span> Math.abs(x - mDownPosX);</span><br><span class="line">            <span class="keyword">final</span> <span class="type">float</span> <span class="variable">deltaY</span> <span class="operator">=</span> Math.abs(y - mDownPosY);</span><br><span class="line">            <span class="comment">// è¿™é‡Œæ˜¯å¤Ÿæ‹¦æˆªçš„åˆ¤æ–­ä¾æ®æ˜¯å·¦å³æ»‘åŠ¨ï¼Œè¯»è€…å¯æ ¹æ®è‡ªå·±çš„é€»è¾‘è¿›è¡Œæ˜¯å¦æ‹¦æˆª</span></span><br><span class="line">            <span class="keyword">if</span> (deltaX &gt; deltaY) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.onInterceptTouchEvent(ev);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å†…éƒ¨è§£å†³æ³•"><a href="#å†…éƒ¨è§£å†³æ³•" class="headerlink" title="å†…éƒ¨è§£å†³æ³•"></a>å†…éƒ¨è§£å†³æ³•</h3><p>ä»å­Viewå·¦å³ï¼Œçˆ¶Viewå…ˆä¸è¦æ‹¦æˆªä»»ä½•äº‹ä»¶ï¼Œæ‰€æœ‰çš„ äº‹ä»¶ä¼ é€’ç»™ å­Viewï¼Œå¦‚æœå­Viewéœ€è¦æ­¤äº‹ä»¶å°±æ¶ˆè´¹æ‰ï¼Œä¸éœ€è¦æ­¤äº‹ä»¶çš„è¯å°±äº¤ç»™ çˆ¶Viewå¤„ç†ã€‚</p><p>å®ç°æ€è·¯ å¦‚ä¸‹ï¼Œé‡å†™å­ Viewçš„dispatchTouchEventæ–¹æ³•ï¼Œåœ¨Action_down åŠ¨ä½œä¸­é€šè¿‡æ–¹æ³• requestDisallowInterceptTouchEventï¼ˆtrueï¼‰ å…ˆè¯·æ±‚ çˆ¶ Viewä¸è¦æ‹¦æˆªäº‹ä»¶ï¼Œè¿™æ ·ä¿è¯ å­Viewèƒ½å¤Ÿ æ¥å—åˆ°Action_moveäº‹ä»¶ï¼Œå†åœ¨Action_moveåŠ¨ä½œä¸­æ ¹æ® è‡ªå·±çš„é€»è¾‘æ˜¯å¦è¦æ‹¦æˆªäº‹ä»¶ï¼Œä¸è¦çš„ è¯äº¤ç»™ çˆ¶Viewå¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> (<span class="type">int</span>) ev.getRawX();</span><br><span class="line">    <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> (<span class="type">int</span>) ev.getRawY();</span><br><span class="line">    <span class="type">int</span> <span class="variable">dealtX</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">dealtY</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">switch</span> (ev.getAction()) &#123;</span><br><span class="line">        <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">            dealtX = <span class="number">0</span>;</span><br><span class="line">            dealtY = <span class="number">0</span>;</span><br><span class="line">            </span><br><span class="line">            getParent().requestDisallowInterceptTouchEvent(<span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">            dealtX += Math.abs(x - lastX);</span><br><span class="line">            dealtY += Math.abs(y - lastY);</span><br><span class="line">            Log.i(TAG, <span class="string">&quot;dealtX:=&quot;</span> + dealtX);</span><br><span class="line">            Log.i(TAG, <span class="string">&quot;dealtY:=&quot;</span> + dealtY);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (dealtX &gt;= dealtY) &#123;</span><br><span class="line">                getParent().requestDisallowInterceptTouchEvent(<span class="literal">true</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                getParent().requestDisallowInterceptTouchEvent(<span class="literal">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            lastX = x;</span><br><span class="line">            lastY = y;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> MotionEvent.ACTION_CANCEL:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.dispatchTouchEvent(ev);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="ScrollView-é‡Œé¢åµŒå¥—ViewPagerå¯¼è‡´çš„æ»‘åŠ¨å†²çª"><a href="#ScrollView-é‡Œé¢åµŒå¥—ViewPagerå¯¼è‡´çš„æ»‘åŠ¨å†²çª" class="headerlink" title="ScrollView é‡Œé¢åµŒå¥—ViewPagerå¯¼è‡´çš„æ»‘åŠ¨å†²çª"></a>ScrollView é‡Œé¢åµŒå¥—ViewPagerå¯¼è‡´çš„æ»‘åŠ¨å†²çª</h2><h3 id="å¤–éƒ¨è§£å†³æ³•-1"><a href="#å¤–éƒ¨è§£å†³æ³•-1" class="headerlink" title="å¤–éƒ¨è§£å†³æ³•"></a>å¤–éƒ¨è§£å†³æ³•</h3><p>å¦‚ä¸Šé¢æ‰€è¿°ï¼Œä» çˆ¶ViewScrollViewç€æ‰‹ï¼Œé‡å†™ OnInterceptTouchEventæ–¹æ³•ï¼Œåœ¨ä¸Šä¸‹æ»‘åŠ¨çš„æ—¶å€™æ‹¦æˆªäº‹ä»¶ï¼Œåœ¨å·¦å³æ»‘åŠ¨çš„æ—¶å€™ä¸æ‹¦æˆªäº‹ä»¶ï¼Œè¿”å› falseï¼Œè¿™æ ·ç¡®ä¿å­View çš„dispatchTouchEventæ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œä»£ç  å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @ explain:è¿™ä¸ªScrlloViewä¸æ‹¦æˆªæ°´å¹³æ»‘åŠ¨äº‹ä»¶ï¼Œ</span></span><br><span class="line"><span class="comment"> * æ˜¯ç”¨æ¥è§£å†³ ScrollViewé‡Œé¢åµŒå¥—ViewPagerä½¿ç”¨çš„</span></span><br><span class="line"><span class="comment"> * @ authorï¼šxujun on 2016/10/25 15:28</span></span><br><span class="line"><span class="comment"> * @ emailï¼šgdutxiaoxu@163.com</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VerticalScrollView</span> <span class="keyword">extends</span> <span class="title class_">ScrollView</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">VerticalScrollView</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">VerticalScrollView</span><span class="params">(Context context, AttributeSet attrs)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(context, attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">VerticalScrollView</span><span class="params">(Context context, AttributeSet attrs, <span class="type">int</span> defStyleAttr)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TargetApi(21)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">VerticalScrollView</span><span class="params">(Context context, AttributeSet attrs, <span class="type">int</span> defStyleAttr, <span class="type">int</span></span></span><br><span class="line"><span class="params">            defStyleRes)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(context, attrs, defStyleAttr, defStyleRes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> <span class="variable">mDownPosX</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> <span class="variable">mDownPosY</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onInterceptTouchEvent</span><span class="params">(MotionEvent ev)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">float</span> <span class="variable">x</span> <span class="operator">=</span> ev.getX();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">float</span> <span class="variable">y</span> <span class="operator">=</span> ev.getY();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">action</span> <span class="operator">=</span> ev.getAction();</span><br><span class="line">        <span class="keyword">switch</span> (action) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                mDownPosX = x;</span><br><span class="line">                mDownPosY = y;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">                <span class="keyword">final</span> <span class="type">float</span> <span class="variable">deltaX</span> <span class="operator">=</span> Math.abs(x - mDownPosX);</span><br><span class="line">                <span class="keyword">final</span> <span class="type">float</span> <span class="variable">deltaY</span> <span class="operator">=</span> Math.abs(y - mDownPosY);</span><br><span class="line">                <span class="comment">// è¿™é‡Œæ˜¯å¤Ÿæ‹¦æˆªçš„åˆ¤æ–­ä¾æ®æ˜¯å·¦å³æ»‘åŠ¨ï¼Œè¯»è€…å¯æ ¹æ®è‡ªå·±çš„é€»è¾‘è¿›è¡Œæ˜¯å¦æ‹¦æˆª</span></span><br><span class="line">                <span class="keyword">if</span> (deltaX &gt; deltaY) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.onInterceptTouchEvent(ev);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å†…éƒ¨è§£å†³æ³•-1"><a href="#å†…éƒ¨è§£å†³æ³•-1" class="headerlink" title="å†…éƒ¨è§£å†³æ³•"></a>å†…éƒ¨è§£å†³æ³•</h3><p>å¦‚ä¸Šé¢ä¸Šè¿°ï¼Œé€šè¿‡requestDisallowInterceptTouchEvent(true)æ–¹æ³•æ¥å½±å“çˆ¶Viewæ˜¯å¦æ‹¦æˆªäº‹ä»¶ï¼Œæˆ‘ä»¬é€šè¿‡é‡å†™ViewPagerçš„ dispatchTouchEventï¼ˆï¼‰æ–¹æ³•ï¼Œåœ¨å·¦å³æ»‘åŠ¨çš„æ—¶å€™è¯·æ±‚çˆ¶View ScrollViewä¸è¦æ‹¦æˆªäº‹ä»¶ï¼Œå…¶ä»–çš„æ—¶å€™æ‹¦æˆªäº‹ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyViewPager</span> <span class="keyword">extends</span> <span class="title class_">ViewPager</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TAG</span> <span class="operator">=</span> <span class="string">&quot;xujun&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">lastX</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">lastY</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyViewPager</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyViewPager</span><span class="params">(Context context, AttributeSet attrs)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(context, attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> (<span class="type">int</span>) ev.getRawX();</span><br><span class="line">        <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> (<span class="type">int</span>) ev.getRawY();</span><br><span class="line">        <span class="type">int</span> <span class="variable">dealtX</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">dealtY</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (ev.getAction()) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                dealtX = <span class="number">0</span>;</span><br><span class="line">                dealtY = <span class="number">0</span>;</span><br><span class="line">                </span><br><span class="line">                getParent().requestDisallowInterceptTouchEvent(<span class="literal">true</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">                dealtX += Math.abs(x - lastX);</span><br><span class="line">                dealtY += Math.abs(y - lastY);</span><br><span class="line">                Log.i(TAG, <span class="string">&quot;dealtX:=&quot;</span> + dealtX);</span><br><span class="line">                Log.i(TAG, <span class="string">&quot;dealtY:=&quot;</span> + dealtY);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> (dealtX &gt;= dealtY) &#123;</span><br><span class="line">                    getParent().requestDisallowInterceptTouchEvent(<span class="literal">true</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    getParent().requestDisallowInterceptTouchEvent(<span class="literal">false</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                lastX = x;</span><br><span class="line">                lastY = y;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_CANCEL:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.dispatchTouchEvent(ev);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ³¨æ„äº‹é¡¹ï¼ˆå‘ï¼‰"><a href="#æ³¨æ„äº‹é¡¹ï¼ˆå‘ï¼‰" class="headerlink" title="æ³¨æ„äº‹é¡¹ï¼ˆå‘ï¼‰"></a><strong>æ³¨æ„äº‹é¡¹ï¼ˆå‘ï¼‰</strong></h2><p>å½“æˆ‘ä»¬ScrollViewçš„æœ€ä¸Šå±‚çš„Layouté‡Œé¢å¤šå¤šä¸ªå­©å­çš„æ—¶å€™ï¼Œå½“ä¸‹é¢ä¸€ä¸ªå­©å­æ˜¯RecyclerViewæˆ–è€…ListViewçš„æ—¶å€™ï¼Œå¾€å¾€ä¼šæ´»åŠ¨æ»‘åŠ¨åˆ°ListViewæˆ–è€…RecyclerView çš„ç¬¬ä¸€ä¸ªitemï¼Œå¯¼è‡´è¿›å…¥ç•Œé¢çš„æ—¶å€™ä¼šå¯¼è‡´RecyclerView ä¸Šé¢çš„ Viewè¢«æ»‘åŠ¨åˆ°ç•Œé¢æ„å¤–ï¼Œçœ‹ä¸è§ï¼Œè¿™æ—¶å€™çš„ç”¨æˆ·ä½“éªŒæ˜¯æ¯”è¾ƒå·®çš„</p><p>å³ç»“æ„å¦‚ä¸‹é¢çš„æ—¶å€™</p><p><img src="https://user-gold-cdn.xitu.io/2019/10/21/16dee4359404fd20?imageslim" alt=""></p><h3 id="åœ¨Activityä¸­çš„ç›¸å…³è§£å†³æ–¹æ³•"><a href="#åœ¨Activityä¸­çš„ç›¸å…³è§£å†³æ–¹æ³•" class="headerlink" title="åœ¨Activityä¸­çš„ç›¸å…³è§£å†³æ–¹æ³•"></a>åœ¨Activityä¸­çš„ç›¸å…³è§£å†³æ–¹æ³•</h3><p>äºæ˜¯æˆ‘æŸ¥æ‰¾äº†ç›¸å…³çš„èµ„æ–™ï¼Œåœ¨Activityä¸­å®Œç¾è§£å†³ï¼Œä¸»è¦è¦ä¸€ä¸‹ä¸¤ç§æ–¹æ³•</p><p>ç¬¬ä¸€ç§æ–¹æ³•ï¼Œé‡å†™Activityçš„onWindowFocusChangedï¼ˆï¼‰æ–¹æ³•ï¼Œåœ¨é‡Œé¢è°ƒç”¨mNoHorizontalScrollView.scrollTo(0,0);æ–¹æ³•ï¼Œæ»‘åŠ¨åˆ°é¡¶éƒ¨ï¼Œå› ä¸ºonWindowFocusChangedæ˜¯åœ¨æ‰€æœ‰Viewç»˜åˆ¶å®Œæ¯•çš„æ—¶å€™æ‰ä¼šå›è°ƒçš„ï¼Œä¸ç†Ÿæ‚‰çš„è¯å»ºè®®å…ˆå›å»çœ‹ä¸€ä¸‹Activityçš„ç”Ÿå‘½å‘¨æœŸçš„ç›¸å…³ä»‹ç»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">scroll</span><span class="params">()</span> &#123;</span><br><span class="line">    mNoHorizontalScrollView.scrollTo(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onWindowFocusChanged</span><span class="params">(<span class="type">boolean</span> hasFocus)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onWindowFocusChanged(hasFocus);</span><br><span class="line">    <span class="keyword">if</span>(hasFocus  &amp;&amp; first)&#123;</span><br><span class="line">        first=<span class="literal">false</span>;</span><br><span class="line">        scroll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§è§£å†³æ–¹æ³•ï¼Œè°ƒç”¨RecyclerViewä¸Šé¢çš„Viewçš„ä¸€ä¸‹æ–¹æ³•ï¼Œè®©å…¶è·å–ç„¦ç‚¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">view.setFocusable(<span class="literal">true</span>);  </span><br><span class="line">view.setFocusableInTouchMode(<span class="literal">true</span>);  </span><br><span class="line">view.requestFocus();</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç åœ¨åˆå§‹åŒ–çš„æ—¶å€™å°±è®©è¯¥ç•Œé¢çš„é¡¶éƒ¨çš„æŸä¸€ä¸ªæ§ä»¶è·å¾—ç„¦ç‚¹ï¼Œæ»šåŠ¨æ¡è‡ªç„¶å°±æ˜¾ç¤ºåˆ°é¡¶éƒ¨äº†ã€‚</p><h3 id="åœ¨Fragmentä¸­çš„ç›¸å…³è§£å†³æ–¹æ³•"><a href="#åœ¨Fragmentä¸­çš„ç›¸å…³è§£å†³æ–¹æ³•" class="headerlink" title="åœ¨Fragmentä¸­çš„ç›¸å…³è§£å†³æ–¹æ³•"></a>åœ¨Fragmentä¸­çš„ç›¸å…³è§£å†³æ–¹æ³•</h3><p>åŒæ ·æ˜¯è°ƒç”¨ç¬¬äºŒç§æ–¹æ³•ï¼Œè°ƒç”¨RecyclerViewä¸Šé¢çš„Viewçš„ä¸€ä¸‹æ–¹æ³•ï¼Œè®©å…¶è·å–ç„¦ç‚¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">view.setFocusable(<span class="literal">true</span>);  </span><br><span class="line">view.setFocusableInTouchMode(<span class="literal">true</span>);  </span><br><span class="line">view.requestFocus();</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç åœ¨åˆå§‹åŒ–çš„æ—¶å€™å°±è®©è¯¥ç•Œé¢çš„é¡¶éƒ¨çš„æŸä¸€ä¸ªæ§ä»¶è·å¾—ç„¦ç‚¹ï¼Œæ»šåŠ¨æ¡è‡ªç„¶å°±æ˜¾ç¤ºåˆ°é¡¶éƒ¨äº†ã€‚ä½†æ˜¯ç»™æ–¹æ³•å­˜åœ¨ç¼ºç‚¹ï¼Œå°±æ˜¯å½“æˆ‘ä»¬ä¸Šé¢çš„viewå¦‚æœæ»‘åŠ¨åˆ°ä¸€åŠçš„æ—¶å€™ï¼Œåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªFragmentï¼Œåœ¨åˆ‡æ¢å›æ¥çš„æ—¶å€™ï¼ŒRecyclerViewçš„ç¬¬ä¸€ä¸ªitemä¼šè‡ªåŠ¨æ»‘åŠ¨åˆ°é¡¶éƒ¨ã€‚ç›®å‰æˆ‘è¿˜æ²¡æœ‰æ‰¾åˆ°ç›¸å¯¹æ¯”è¾ƒå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•ï¼Œå¤§å®¶çŸ¥é“ç›¸å…³è§£å†³æ–¹æ³•çš„è¯ä¹Ÿæ¬¢è¿è”ç³»æˆ‘ï¼Œå¯ä»¥åŠ æˆ‘ å¾®ä¿¡æˆ–è€…åœ¨ç•™è¨€åŒºè¯„è®ºï¼Œè°¢è°¢</p><h4 id="ä¸ªäººç–‘ç‚¹"><a href="#ä¸ªäººç–‘ç‚¹" class="headerlink" title="ä¸ªäººç–‘ç‚¹"></a><strong>ä¸ªäººç–‘ç‚¹</strong></h4><p>å€Ÿé‰´äºè§£å†³Activityçš„æ–¹æ³•ï¼Œç›®å‰æˆ‘è¿˜æ²¡æœ‰æ‰¾åˆ°ä¸€ä¸ªæ–¹æ³•æ˜¯åœ¨Fragemntç•Œé¢å®Œå…¨ç»˜åˆ¶å®Œæ¯•ä»¥åå›è°ƒçš„æ–¹æ³•ï¼Œå¦‚æœå¤§å®¶çŸ¥é“æ€æ ·å¤„ç†çš„ è¯ï¼Œæ¬¢è¿å¤§å®¶æå‡ºæ¥</p><hr><h2 id="ViewPageré‡Œé¢åµŒå¥—ViewPagerå¯¼è‡´çš„æ»‘åŠ¨å†²çª"><a href="#ViewPageré‡Œé¢åµŒå¥—ViewPagerå¯¼è‡´çš„æ»‘åŠ¨å†²çª" class="headerlink" title="ViewPageré‡Œé¢åµŒå¥—ViewPagerå¯¼è‡´çš„æ»‘åŠ¨å†²çª"></a>ViewPageré‡Œé¢åµŒå¥—ViewPagerå¯¼è‡´çš„æ»‘åŠ¨å†²çª</h2><h3 id="å†…éƒ¨è§£å†³æ³•-2"><a href="#å†…éƒ¨è§£å†³æ³•-2" class="headerlink" title="å†…éƒ¨è§£å†³æ³•"></a>å†…éƒ¨è§£å†³æ³•</h3><p>ä»å­View ViewPagerç€æ‰‹ï¼Œé‡å†™ å­Viewçš„ dispatchTouchEventæ–¹æ³•ï¼Œåœ¨å­ Viewéœ€è¦æ‹¦æˆªçš„æ—¶å€™è¿›è¡Œæ‹¦æˆªï¼Œå¦åˆ™äº¤ç»™çˆ¶Viewå¤„ç†ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChildViewPager</span> <span class="keyword">extends</span> <span class="title class_">ViewPager</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TAG</span> <span class="operator">=</span> <span class="string">&quot;xujun&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChildViewPager</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChildViewPager</span><span class="params">(Context context, AttributeSet attrs)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(context, attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> &#123;</span><br><span class="line">        <span class="type">int</span> curPosition;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (ev.getAction()) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                getParent().requestDisallowInterceptTouchEvent(<span class="literal">true</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">                curPosition = <span class="built_in">this</span>.getCurrentItem();</span><br><span class="line">                <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="built_in">this</span>.getAdapter().getCount();</span><br><span class="line">                Log.i(TAG, <span class="string">&quot;curPosition:=&quot;</span> +curPosition);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> (curPosition == count - <span class="number">1</span>|| curPosition==<span class="number">0</span>) &#123;</span><br><span class="line">                    getParent().requestDisallowInterceptTouchEvent(<span class="literal">false</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    getParent().requestDisallowInterceptTouchEvent(<span class="literal">true</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.dispatchTouchEvent(ev);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¤–éƒ¨è§£å†³æ³•-2"><a href="#å¤–éƒ¨è§£å†³æ³•-2" class="headerlink" title="å¤–éƒ¨è§£å†³æ³•"></a>å¤–éƒ¨è§£å†³æ³•</h3><p>è¿™ä¸ªå¦‚æœè¦é‡‡ç”¨å†…éƒ¨è§£å†³æ³•æ¥è§£å†³çš„è¯æƒ³ï¼Œç›¸å¯¹å¾ˆéº»çƒ¦ï¼Œæˆ‘æä¸€ä¸‹è‡ªå·±çš„ä¸ªäººæ€è·¯ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæµ‹é‡å­Viewåœ¨å“ªä¸ªåŒºåŸŸï¼Œç„¶åæˆ‘ä»¬åœ¨æ ¹æ®æˆ‘ä»¬æŒ‰ä¸‹çš„ç‚¹æ˜¯å¦åœ¨åŒºåŸŸä»¥å†…ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œåœ¨æ ¹æ®å­Viewæ—¶å€™éœ€è¦æ‹¦æˆªè¿›è¡Œå¤„ç†</p><hr><h2 id="è®¨è®º"><a href="#è®¨è®º" class="headerlink" title="è®¨è®º"></a>è®¨è®º</h2><p><img src="https://user-gold-cdn.xitu.io/2019/10/21/16dee43a1d305e5c?imageslim" alt=""></p><p>å¯¹äºè¿™ç§æ•ˆæœï¼Œä¸Šé¢æ˜¯è½®æ’­å›¾çš„ï¼Œä¸‹é¢æ˜¯RecyclerViewæˆ–è€…ListViewçš„ï¼Œä¸€èˆ¬æœ‰ä¸€ä¸‹å‡ ç§å®ç°æ–¹å¼</p><ul><li>ä½¿ç”¨æˆ‘ä»¬ä¸Šè¿°æé«˜çš„ScrollViewé‡Œé¢åµŒå¥—ViewPagerå’ŒRecyclerViewï¼Œè¿™ç§å®ç°æ–¹å¼éœ€è¦è‡ªå·±è§£å†³Viewæ»‘åŠ¨äº‹ä»¶çš„å†²çªï¼ŒåŒæ—¶è¿˜æœ‰æˆ‘åœ¨ä¸Šè¿°æé«˜çš„åœ¨Fragmentä¸­å­˜åœ¨çš„é—®é¢˜</li><li>ä½¿ç”¨listViewçš„addHeaderViewæ¥å®ç°ï¼Œæˆ–è€…æ˜¯é€šè¿‡å¤šç§ä¸åŒçš„itemæ¥å®ç°</li><li>ä½¿ç”¨RecyclerViewæ·»åŠ headerViewæ¥å®ç°ï¼Œæˆ–è€…å¤ç”¨å¤šç§ä¸åŒçš„itemæ¥å®ç°ã€‚å…³äºRecyclerViewå¦‚ä½•æ·»åŠ headerViewå¯ä»¥å‚è€ƒé¸¿æ´‹å¤§ç¥çš„è¿™ä¸€ç¯‡åšå®¢ <a href="https://blog.csdn.net/lmj623565791/article/details/51854533">Android ä¼˜é›…çš„ä¸ºRecyclerViewæ·»åŠ HeaderViewå’ŒFooterView</a></li><li>ä½¿ç”¨SupportLibraryä¸­çš„CoordinatorLayoutç­‰æ§ä»¶</li></ul><p>å…¶å¸ƒå±€æ–‡ä»¶å¦‚ä¸‹ï¼ŒActivityä»£ç è§é¡¹ç›®ä¸­çš„SixActivity</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">android.support.design.widget.CoordinatorLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">&quot;@android:color/background_light&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:fitsSystemWindows</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.design.widget.AppBarLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;300dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fitsSystemWindows</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:theme</span>=<span class="string">&quot;@style/ThemeOverlay.AppCompat.Dark.ActionBar&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">android.support.design.widget.CollapsingToolbarLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_scrollFlags</span>=<span class="string">&quot;scroll|snap&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">android.support.v4.view.ViewPager</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">&quot;@+id/viewPager&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">            &gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">android.support.v4.view.ViewPager</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">&quot;@+id/tv_page&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_gravity</span>=<span class="string">&quot;bottom&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:gravity</span>=<span class="string">&quot;right&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">&quot;1/10&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:textColor</span>=<span class="string">&quot;#000&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">android.support.design.widget.CollapsingToolbarLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">android.support.design.widget.AppBarLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.RecyclerView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/recyclerView&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_behavior</span>=<span class="string">&quot;@string/appbar_scrolling_view_behavior&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">android.support.v7.widget.RecyclerView</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.design.widget.CoordinatorLayout</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å…³äºCoordinatorLayoutçš„æ›´å¤šç”¨æ³•ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„è¿™ä¸€ç¯‡åšå®¢<a href="https://blog.csdn.net/gdutxiaoxu/article/details/52858598">ä½¿ç”¨CoordinatorLayoutæ‰“é€ å„ç§ç‚«é…·çš„æ•ˆæœ</a></p><hr><h2 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li>å½“æˆ‘ä»¬æ»‘åŠ¨æ–¹å‘ä¸åŒçš„æ—¶å€™ï¼Œé‡‡ç”¨å¤–éƒ¨è§£å†³æ³•å’Œå†…éƒ¨è§£å†³æ³•ï¼Œå¤æ‚åº¦å·®ä¸å¤šã€‚</li><li>å½“æˆ‘ä»¬æ»‘åŠ¨çš„æ–¹å‘ç›¸åŒçš„è¯ï¼Œå»ºè®®é‡‡ç”¨å†…éƒ¨è§£å†³æ³•æ¥è§£å†³ï¼Œå› ä¸ºé‡‡ç”¨å¤–éƒ¨è§£å†³æ³•å¤æ‚åº¦æ¯”è¾ƒé«˜ã€‚è€Œä¸”æœ‰æ—¶å€™æˆ‘ä»¬æ˜¯é‡‡ç”¨åˆ«äººçš„å¼€æºæ§ä»¶ï¼Œè¿™æ—¶å€™å»ä¿®æ”¹åˆ«äººçš„æºç å¯èƒ½ä¼šå‘ç”Ÿä¸€äº›æ„æƒ³ä¸åˆ°çš„bugã€‚</li></ul><h2 id="é¢˜å¤–è¯"><a href="#é¢˜å¤–è¯" class="headerlink" title="é¢˜å¤–è¯"></a>é¢˜å¤–è¯</h2><ul><li>åœ¨è¿™ç¯‡åšå®¢çš„æœ€åæé«˜çš„å®ç°è½®æ’­å›¾+liståˆ—è¡¨çš„å‡ ç§å®ç°å½¢å¼ï¼Œåˆšå¼€å§‹æ˜¯ä¸æƒ³å†™çš„ï¼Œåé¢å› ä¸ºScrollViewé‡Œé¢åµŒå¥—ViewPagerå’ŒRecyclerViewåœ¨fragmentä¸­RecyclerViewæŠ¢å ç„¦ç‚¹ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ç”¨æˆ·ä½“éªŒä¸å¥½ï¼Œæ‰å†™å‡ºæ¥çš„ï¼Œè·Ÿè¿™ç¯‡åšå®¢è¦è®²è§£çš„Viewæ»‘åŠ¨äº‹ä»¶å†²çªæ²¡æœ‰å¤šå¤§å…³ç³»ï¼Œåªæ˜¯ç»™è¯»è€…æä¾›å¤šç§æ€è·¯è€Œå·²</li><li>è‡³äºCoordinatorLayoutï¼Œæ˜¯google IO 2015ä¸­æå‡ºæ¥çš„ï¼ŒåŠŸèƒ½å¾ˆå¼ºå¤§ï¼Œå¯ä»¥è¯´æ˜¯ä¸“é—¨ä¸ºäº†è§£å†³åµŒå¥—å¯¼æ»‘åŠ¨è€Œäº§ç”Ÿçš„ï¼Œæå¤§åœ°æ–¹ä¾¿äº†å¼€å‘è€…ï¼Œå¯¹äºåˆå­¦è€…ï¼Œå¯ä»¥æš‚æ—¶ä¸å¿…æŒæ¡å®ƒï¼Œå…ˆæŠŠå…¶ä»–çš„åŸºç¡€å­¦å¥½å°±å¥½</li></ul>]]></content:encoded>
      
      
      <category domain="https://www.littlecorgi.top/categories/Android/">Android</category>
      
      
      <category domain="https://www.littlecorgi.top/tags/Android/">Android</category>
      
      
      <comments>https://www.littlecorgi.top/posts/bc8ba982.html#disqus_thread</comments>
      
    </item>
    
  </channel>
</rss>
